<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>GO-SHOPPING 商城项目笔记 | 林之介4rozeN</title><meta name="keywords" content="笔记"><meta name="author" content="4rozeN"><meta name="copyright" content="4rozeN"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="GO-SHOPPING 商城项目笔记"><meta name="application-name" content="GO-SHOPPING 商城项目笔记"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="GO-SHOPPING 商城项目笔记"><meta property="og:url" content="https://4rozen.github.io/posts/47412.html"><meta property="og:site_name" content="林之介4rozeN"><meta property="og:description" content="本项目是基于 uni-app 技术栈开发的，能够运行在多端 (微信小程序、h5、ios&amp;#x2F;Android) 的移动端商城项目。   重点：接口需要 token 的地方，header 中， Access-Token:${token}  重点：接口需要 platform 的地方，header 中，pl"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://ali-4rozen-oss.oss-cn-guangzhou.aliyuncs.com/blog/cover/%E5%89%8D%E7%AB%AF/vue%E7%AC%94%E8%AE%B0.webp"><meta property="article:author" content="4rozeN"><meta property="article:tag" content="blog, programming, CTF, Vue, backend, Git, Uni-app"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://ali-4rozen-oss.oss-cn-guangzhou.aliyuncs.com/blog/cover/%E5%89%8D%E7%AB%AF/vue%E7%AC%94%E8%AE%B0.webp"><meta name="description" content="本项目是基于 uni-app 技术栈开发的，能够运行在多端 (微信小程序、h5、ios&amp;#x2F;Android) 的移动端商城项目。   重点：接口需要 token 的地方，header 中， Access-Token:${token}  重点：接口需要 platform 的地方，header 中，pl"><link rel="shortcut icon" href="https://ali-4rozen-oss.oss-cn-guangzhou.aliyuncs.com/blog/ico/favicon.ico"><link rel="canonical" href="https://4rozen.github.io/posts/47412.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><meta name="google-site-verification" content="ggjgSh07y0_dbMruvoZhis-cgZn-t6ujdG7N1z7ZA88"/><meta name="msvalidate.01" content="F0E34077A7291AC38724F6A3804B1B29"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://s4.zstatic.net/ajax/libs/font-awesome/6.7.2/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://s4.zstatic.net/ajax/libs/node-snackbar/0.1.16/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://s4.zstatic.net/ajax/libs/fancyapps-ui/6.0.30/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: undefined,
  postHeadAiDescription: undefined,
  diytitle: {"enable":true,"leaveTitle":"等你回来(∠・ω< )⌒☆","backTitle":"欢迎回来(‾◡◝)"},
  LA51: undefined,
  greetingBox: {"enable":true,"default":"晚上好👋","list":[{"greeting":"晚安😴","startTime":0,"endTime":5},{"greeting":"早上好鸭👋, 祝你一天好心情！","startTime":6,"endTime":9},{"greeting":"上午好👋, 状态很好，鼓励一下～","startTime":10,"endTime":10},{"greeting":"11点多啦, 在坚持一下就吃饭啦～","startTime":11,"endTime":11},{"greeting":"午安👋, 宝贝","startTime":12,"endTime":14},{"greeting":"🌈充实的一天辛苦啦！","startTime":14,"endTime":18},{"greeting":"19点喽, 奖励一顿丰盛的大餐吧🍔。","startTime":19,"endTime":19},{"greeting":"晚上好👋, 在属于自己的时间好好放松😌~","startTime":20,"endTime":24}]},
  twikooEnvId: 'https://4rozen-blog.netlify.app/.netlify/functions/twikoo',
  commentBarrageConfig:undefined,
  music_page_default: "nav_music",
  root: '/',
  preloader: {"source":1},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: {"mode":"both","api":"https://img2color-go.vercel.app/api?img=","cover_change":true},
  authorStatus: undefined,
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: {"limitDay":365,"position":"bottom","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":120,"languages":{"author":"作者: 4rozeN","link":"链接: ","source":"来源: 林之介4rozeN","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2.1.2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: true,
  shortcutKey: undefined,
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: '林之介4rozeN',
  title: 'GO-SHOPPING 商城项目笔记',
  postAI: '',
  pageFillDescription: ' 项目结构,  二级路由配置,  实现底部导航栏 Tabbar,  实现二级路由配置,  登录静态页,  配置头部 NavBar,  完善主体,  完善登录逻辑,  解析 base64 并完善点击刷新图片验证码,  Toast 轻提示,  短信验证倒计时,  手机号和图形验证码类型校验,  封装发送短信验证码请求,  实现登录功能 - 封装登录接口,  响应处理器统一处理错误提示,  登录权证信息存储,  vuex 持久化处理,  添加请求 Loading 效果,  全局路由前置守卫,  首页,  完成首页静态结构,  首页 - 动态渲染,  搜索,  搜索页静态结构,  历史记录管理,  搜索列表页,  静态布局,  渲染,  基于分类页面的分类 id 进行渲染,  商品详情页,  静态结构,  商品说明动态渲染,  商品评论区渲染,  商品说明的图片渲染,  商品评价区,  加入购物车 / 购买,  数字框组件封装,  加入购物车 - 判断登录状态,  this.$router.replace 和 this.$router.push 的区别,  加入购物车 - 封装接口进行请求,  购物车页面,  静态页面,  构建 vuex cart 模块,  动态渲染,  封装 getters 实现动态统计,  全选反选,  数字框修改数量功能,  编辑切换状态删除功能,  删除商品,  空购物车处理,  地址管理,  配置,  地址列表,  地址编辑,  订单结算台,  静态结构,  渲染,  订单结算,  文件上传 ——unfinished,  图片上传,  安装 vue-cropper,  在组件中使用 vue-cropper,  打包优化,  优化访问路径,  懒加载本项目是基于技术栈开发的能够运行在多端微信小程序的移动端商城项目重点接口需要的地方中重点接口需要的地方中或接口调用基础地址关于接口的说明分为了状态码和接口中对应码码值说明状态码服务器端异常状态码服务器端异常状态码授权信息不正确测试环境登录短信验证码统一为不再提供真实的短信验证服务接口文档地址官网地址本项目使用的代码规范标准项目结构一级路由配置将每个基础的一级页面以文件夹形式存放于包中包括具体项目结构如下路由页如下二级路由配置实现底部导航栏配置二级路由之前需要完成底部栏的设计可以结合官网文档进行设计官网实现二级路由配置在组件中的的要实现路由模式如下于是有首页分类页购物车我的最后优化路由逻辑将默认匹配的页面重定向到登录静态页新建重置默认样式可以对一些想要多组件生效的样式进行重新调整重置默认样式文字溢出省略号导入于中接着准备一些素材图片于配置头部头部尊敬的用户请登录的作用是返回上一页接着将左边的返回符号颜色样式改为灰色于是找到进行编写两个类名增加权重添加导航的通用样式这样的好处是一旦配置好了将来其他页面使用到导航栏此处的返回颜色都是我们此时配好的颜色这就是通用样式的覆盖完善主体接着编写主体的静态结构头部尊敬的用户请登录主体部分自定义手机号登录未注册的手机号登录后将自动注册请输入手机号码请输入图形验证码请输入短信验证码获取验证码登录页面效果如下图形验证码暂时写死短信验证码暂时不作处理完善登录逻辑登录页面一共有三个请求需要发送图形验证码短信验证码和登录请求我们使用来请求后端接口一般都会对进行一些配置配置基础地址请求响应拦截器等于是封装为一个模块便于维护以后使用都是创建实例去请求这样多个实例相互独立互不干扰中文文档新建于包下创建一个实例中文文档中的实例和拦截器进行改造创建实例查看接口文档改造自定义配置请求响应拦截器如果希望不污染原本的需要将改为实例添加请求拦截器在发送请求之前做些什么对请求错误做些什么添加响应拦截器范围内的状态码都会触发该函数对响应数据做点什么默认会对响应多包装一层所以这里需要取出超出范围的状态码都会触发该函数对响应错误做点什么导出配置好的示例响应器中原本为这里改为上文是因为默认会对响应多包装一层所以这里需要取出接着回到登录页面上导入模块异步检查一下调试返回如下解析并完善点击刷新图片验证码由于提交的图形验证码必须带才能让后端进行唯一校验所以在中提供用户输入的图形验证码图形验证码的存放要渲染的图形验证码的接着进行响应结果的解构存储好数据以便后续提交后端进行校验完善相关代码请输入图形验证码封装登录请求到包下新建登录相关接口请求使用时按需导入于是到登录页中改为并修改调用语句上述语句不会因为重名冲突我们需要知道的是如果是引入的前面是不带的而自身的是需要在前面加上的轻提示校验手机号是否输入是否输入格式正确等并给予提示使用库中的轻提示完成提示显示需要注意的是他的两种调用方式提示内容提示文案引入组件后会自动在的上挂载方法便于在组件内调用这两种调用第一种是任意地方都可以调用显示出提示内容第二种是只有组件内才可以显示提示内容默认采用单例模式即同一时间只会存在一个如果需要在同一时间弹出多个可以参考下面的示例第一个第二个短信验证倒计时点击获取验证码之后要开始倒计时一分钟只能发送一次给获取短信验证码的按钮注册点击事件并改写显示文字请输入短信验证码获取验证码秒后重试提供短信验证码获取函数短信验证码获取只有当计时器处于未开启状态并且当前时间和总时间一致时说明可以开启倒计时开启计时器停止计时器获取成功给予提示获取短信验证码成功并考虑到性能问题于是增加在用户离开登录页面之后清除定时器的功能实现在生命函数当用户退出登录页面清除定时器手机号和图形验证码类型校验由于前端无法校验具体只能校验数据类型和长度所以新增两个正则数据和绑定用户输入的手机号手机号正则开头为第二位接着位数字图形正则用户输入的手机号码增加校验的函数校验手机号和图形验证码请输入正确的手机号图形验证码错误并在短信验证码获取函数中加入一行判断短信验证码获取校验手机号和图形验证码格式封装发送短信验证码请求转到中进行封装结合接口文档然后在短信验证码获取函数中加入调用代码短信验证码获取发送获取短信验证码的请求短信发送成功请注意查收实现登录功能封装登录接口封装登录请求绑定登录按钮事件为绑定用户输入的短信验证码为默认短信为登录功能校验手机号和图形验证码格式校验输入的短信验证码格式请输入正确的短信验证码登录成功登录失败请检查手机号和验证码是否正确后面失败的多种情况可以通过响应拦截器进行处理在这里暂时只考虑成功的情况响应处理器统一处理错误提示对包下的拦截器进行修改响应拦截器范围内的状态码都会触发该函数对响应数据做点什么默认会对响应多包装一层所以这里需要取出超出范围的状态码都会触发该函数对响应错误做点什么服务器返回了错误响应服务器错误请求已发出但没有收到响应请求超时或网络错误其他错误请求配置错误登录权证信息存储使用构建模块存储登录权证和好处是易获取响应式分模块便于管理维护在包下新建包然后在包下新建个人权证然后在中进行挂载并在登录页面将要实现跳转到首页的前一刻完成用户权证信息的存储持久化处理刷新就会丢失信息于是引入持久化存储我们将获取设置和移除信息的操作封装为模块在包下新建一个约定一个通用键名判断是否有值然后到的子模块中进行导入使用即可添加请求效果需求分析有时候因为网络原因一次请求的结果可能需要一段时间后才能回来此时需要给用户添加提示添加提示的好处节流处理防止用户在一次请求还没回来之前多次进行点击发送无效请求友好提示告知用户目前是在加载中请耐心等待用户体验会更好加在哪呢可以统一加在拦截器中这样一来后面也可以复用请求拦截器中每次请求打开响应拦截器中每次响应关闭转到包下的拦截器在请求的时候显示提示并设置背景不可点击且使其不会定时消失只能由我们清除在发送请求之前做些什么发送请求时显示提示背景不可点击加载中禁止背景点击值为时不会自动关闭在响应拦截器添加清除提示的代码对响应数据做点什么默认会对响应多包装一层所以这里需要取出关闭提示全局路由前置守卫官网地址在中编写定义数组存储需要登录才能访问的路由创建全局路由前置守卫判断的是否存在登录的路由数组中不需要登录直接进入判断是否有实际上需要调用后端接口校验有可以进入没有跳转到登录页首页完成首页静态结构要用到的组件有搜索框轮播图宫格宫格主要是使用自定义列数的所以在包下的中进行添加按需导入组件静态结构和样式导航条智慧商城搜索框请在此输入搜索关键词轮播图导航新品首发主会场猜你喜欢猜你喜欢主题导航条样式定制搜索框样式定制分类导航部分主会场猜你喜欢商品样式其中将商品项封装成组件在包下三星手机超视觉夜拍系统超清夜景悠雾紫手机游戏拍照旗舰机已售件首页动态渲染根据接口文档封装请求首页数据模块于包下新建获取首页数据接着转到的处理动态渲染获取轮播图数据获取导航组数据获取商品组数据改造中轮播图和导航部分轮播图导航接着改造商品组猜你喜欢猜你喜欢父传子将整个对象传给进行接收然后改造注意将商品携带进行跳转时要动态取值使用反引号搜索页面设计搜索页静态结构需要导入组件商品搜索请输入搜索关键词搜索搜索历史最近搜索炒锅电视冰箱手机自行车历史记录管理目标构建搜索页的静态布局完成历史记录的管理需求分析搜索历史基本渲染点击搜索添加历史添加历史说明点击搜索按钮或底下历史记录都能进行搜索若之前没有相同搜索关键字则直接追加到最前面若之前已有相同搜索关键字将该原有关键字移除再追加相当于置顶商品搜索请输入搜索关键词搜索搜索历史最近搜索判断输入的搜索词是否已经在中说明存在则将其进行删除语法将搜索词添加到的最前面跳转到搜索列表页面持久化存储代码获取搜索历史设置搜索历史搜索列表页静态布局商品列表手机排序选项按钮综合销量价格商品样式渲染封装请求获取商品列表按综合搜索默认按销量按价格价格从低到高价格从高到低分类示例值商品名称示例值酒页码示例值基于搜索词进行渲染商品列表排序选项按钮综合销量价格从的中拿到查询参数如果查询参数不存在就返回一个空字符串获取商品列表数据排序商品更新当前选中的排序类型商品样式基于分类页面的分类进行渲染封装请求分类页数据获取分类页数据完成分类页静态结构分类全部分类搜索框请输入搜索关键词分类列表主题导航条样式定制搜索框样式定制修改搜索页列表的查询参数从的中拿到查询参数如果查询参数不存在就返回一个空字符串获取商品列表数据排序商品更新当前选中的排序类型商品详情页静态结构商品详情页商品说明已售件三星手机超视觉夜拍系统超清夜景悠雾紫手机游戏拍照旗舰机七天无理由退货小时发货商品评价商品评价条查看更多神雕大侠质量很不错挺喜欢的商品描述底部首页购物车加入购物车立刻购买封装获取商品详情的请求模块获取商品详情获取的一个示例于是进行动态渲染商品说明动态渲染改造中对图片的渲染部分如下修改商品说明进行动态渲染商品说明已售件到这里还没有完成评论区的动态渲染商品评论区渲染封装请求获取商品评价详情的模块获取商品评价详情请求解构完成商品评价渲染默认只展示三条评价商品评价商品评价条查看更多在生命周期钩子中获取商品详情说明部分获取商品详情评价部分默认抓取好评提供商品说明商品评价现在剩下商品说明的图片未渲染商品评论区未渲染商品说明的图片渲染接口返回的数据中就是商品详细说明的图于是再于中提供两个数据用于处理匹配接口数据中的图商品详细介绍长图再到中编写获取商品详情说明部分获取商品详情评价部分正则匹配得到商品详细介绍长图将匹配到的添加到数组中输出结果数组接下来就剩下完全的评价区渲染了商品评价区这是一个新的页面所以直接新建了商品评价页全部评价可以在这里添加更多的错误处理逻辑比如显示错误提示商品评价并转到包下修改路由配置动态商品用于确认将来是哪个商品详情页页面用于调试加入购物车购买该功能使用到弹层组件可以在组件库中找到页面代码如下弹层加入购物车立刻购买库存数量数字框占位有库存才显示可购买加入购物车立刻购买该商品已抢完样式如下弹层样式中提供两个数据购物车或立即购买中提供两个方法接下来还需要将弹层中的数量展示封装成数字框组件数字框组件封装分析组件名静态结构左中右三部分数字框的数字应该是外部传递进来的父传子点击号可以修改数字子传父使用实现封装和的简写数字不能减到小于封装组件转数字处理数字输入了不合法的文本或输入了负值回退成原来的值使用组件数量加入购物车判断登录状态需要使用到的组件提示给弹层的加入购物车按钮绑定点击事件加入购物车添加鉴权判断跳转携带回跳地址加入购物车判断登录状态说明没有没有就需要提示登录当前操作需要登录后才能进行哦去登录再逛逛说明点击了去登录需要带上带上当前页面的全路径包括查询参数说明点击了再逛逛不做任何操作登录后如果有回跳地址则地回跳回去判断有无回跳地址和的区别假设有三个页面我从点击进入页面然后在页面需要进行跳转到页面此时我触发的是进行跳转那么跳转到之后就会将的访问记录完全覆盖如果我在页面的操作结束之后进行返回上一页的操作就会直接返回到页面而不是页面相对的则会将记录保持你的每次访问都是一个累加的过程不会清除如果把页面比作真实的纸张跳转的过程就像把我们手里的一张纸覆盖到桌子上的另一张纸上面一样桌子上纸张堆的是已经访问过的页面桌子上的纸张堆中最上面那一张就是我们现在正在访问的页面而手里的是将要访问的页面但覆盖的方式上述两种各有不同会在覆盖桌子上的纸张之前将桌子上最上面的那一张丢到垃圾桶然后再将手中的纸张覆盖上去则是简单的将纸张放在桌子上的纸张上面不进行其他任何操作最终你的访问记录都在桌子上加入购物车封装接口进行请求接口如下封装加入购物车的请求接口模块加入购物车的请求商品商品数量商品规格如红色手机由于需要携带请求头且携带的是鉴权信息每次请求手动去写比较麻烦所以直接在请求拦截器中携带只要有就在请求中携带便于请求需要权限的接口修改购物车渲染代码进行购物车内数量角标展示购物车导入并将商品规格赋值给数据获取商品详情说明部分得到商品规格得到商品轮播图提供数据来接收必要信息加入购物车的商品数量商品规格购物车内商品总数编写请求代码加入购物车判断登录状态说明有可以直接加入购物车加入购物车成功关闭弹层购物车页面需求分析基本静态结构快速实现构建模块获取数据存储基于数据居动态渲染购物车列表封装实现动态统计全选反选功能数字框修改数量功能编辑切换状态删除功能空购物车处理静态页面修改使用到了的组件静态页面如下购物车购物车开头共件商品编辑购物车列表新英寸远峰蓝平板电脑智能安卓娱乐十核游戏学习二合一低蓝光护眼超清全面三星屏全网通蓝魔快本平板全选合计结算删除主题构建模块新建子模块提供一个数组用于存储购物车列表提供方法可以设置购物车列表异步获取购物车列表由于后台返回数据中不包括是否选中的状态所以本地自己维护给每一项添加上被选中的状态到中挂载购物车页面中使用调用异步判断是否登录获取购物车数据动态渲染接口地址使用辅助函数映射数组将中对应的地方进行改造但未完成其他功能按钮等事件封装实现动态统计合计商品数量合计商品数量使用到求所有的商品累加总数函数的个高级用法合计价格结算最终完整结果求所有的商品累加总数选中的商品项目只会接收回调结果为的元素所以可以不用做其他判断选中的商品项目数量这里的可以获取到上面定义的选中的商品总价保留两位小数修改购物车页面的相关共件商品合计结算删除全选反选提供便于修改遍历购物车列表找到对应的商品修改其选中状态遍历购物车列表修改所有商品的选中状态给全选和商品选择框注册点击事件全选辅助函数导入数字框修改数量功能提供更新购物车的接口模块更新购物车商品在的子模块导入使用子模块增加修改商品数量的方法遍历购物车列表找到对应的商品修改其数量子模块增加同步购物车到后台的方法将本地购物车列表同步到服务器结算时优先调用接口只接受三个参数所以需要遍历本地购物车列表将选中的商品拆分为三个参数打印提示显示本地提交同步的参数对象给数量框组件添加绑定事件给结算按钮添加绑定事件结算中提供相对应的方法先触发购物车与后台数据的同步触发真正的结算真正的结算待做编辑切换状态删除功能点击编辑按钮结算按钮变为删除按钮给购物车页面提供一个数据用于标识是否处于编辑状态并监视其状态说明进入编辑状态说明退出编辑状态相对应的对中结算按钮和编辑按钮进行修改编辑结算删除功能待做删除商品封装接口模块删除购物车商品要删除的商品数组子模块提供异步方法删除选中的商品获取选中的商品然后进行删除删除成功删除后重新拉取购物车数据接着修复了一些小商品详情页初始不显示购物车数量添加到购物车之后数量不会自动更新购物车页面编辑状态退出后按钮未恢复到结算按钮下面是修复后的和提供一个数组用于存储购物车列表提供方法可以设置购物车列表修改商品选中状态遍历购物车列表找到对应的商品修改其选中状态全选和反选遍历购物车列表修改所有商品的选中状态改变商品数量遍历购物车列表找到对应的商品修改其数量添加商品到购物车先判断是否已经存在该商品如果存在则只修改商品数量如果不存在则添加到购物车列表重新拉取购物车信息添加成功异步获取购物车列表由于后台返回数据中不包括是否选中的状态所以本地自己维护给每一项添加上被选中的状态将本地购物车列表同步到服务器结算或者离开购物车页面立刻同步接口只接受三个参数所以需要遍历本地购物车列表将选中的商品拆分为三个参数删除选中的商品获取选中的商品然后进行删除删除成功删除后重新拉取购物车数据求所有的商品累加总数选中的商品项目只会接收回调结果为的元素所以可以不用做其他判断选中的商品项目数量这里的可以获取到上面定义的选中的商品总价保留两位小数是否全选返回说明数组中每一项都为否则为商品详情页增加此为内将匹配到的添加到数组中输出结果数组异步获取购物车列表获取购物车商品总数说明有可以直接加入购物车此为添加到购物车的点击事件获取购物车商品总数加入购物车成功关闭弹层监听的变化自动更新空购物车处理将除标题以外的盒子用大盒子包裹起来购物车判断登录且购物车列表不为空才渲染未登录或购物车列表为空时渲染提示页面空空如也快去逛逛吧去逛逛并提供计算属性并引入对应组件的样式地址管理地址选择里面涉及到一个地区选择器可以自行定义数据也可以使用官方的数据可以参考使用配置封装接口获取地址列表获取某个地址的详情添加收货地址直接使用中的数据更新收货地址直接使用中的数据设置默认地址删除收货地址子模块初始化时从中获取默认地址编辑地址更新默认地址的并保存到保存到获取地址列表获取某个地址的详情被调用返回的数据添加地址成功后重新通过上面的方法拉取地址列表设置默认地址无用的接口设置后拉取列表其中不包含默认地址是否设置的状态发送请求成功后重新拉取地址列表更新地址发送更新请求更新之后重新拉取地址列表删除地址发送删除请求删除成功后重新拉取地址列表获取默认地址优先从中获取否则从中获取子模块处理引入的官方地区数据代码到名称的映射名称到代码的映射根据名称获取代码根据代码获取名称构建映射表构建代码到名称的映射代码作为键名称作为值构建名称到代码的映射名称作为键代码作为值配置路由并新增守卫规则定义数组存储需要登录才能访问的路由地址列表地址列表代码地址列表用于区分的文字请选择或管理收货地址地址列表默认空空如也添加地址默认选中的地址地址列表禁用状态的地址列表超出快递范围以下地址超出配送范围构建地区映射表获取地址列表获取地址列表成功地址数据格式化地址列表数据过滤掉禁用的地址从中获取默认地址的默认地址遍历比对列表每一项的是否与相等找到后返回索引强等于比较注意类型找到后设置为默认地址没有默认地址则默认选中第一个地址小主还没有默认地址哦快来设置一个吧未找到有效的默认地址设置禁用的地址列表获取地址列表失败获取地址列表失败格式化地址跳转到编辑导航栏背景色设置导航栏的高度添加阴影效果增加顶部内边距以避免内容被导航栏遮挡地址列表项样式每一项之间的间距内边距使内容不贴边边框颜色圆角边框背景色允许内容换行自动换行长单词换行禁用状态的地址项样式禁用项的背景色禁用项的文字颜色地址编辑地址编辑可以是新建也可以是更新操作可编辑也可以作为添加地址的页面地址编辑请选择请选择请选择引入官方的地区数据地址初始地址详情对象若是新建地址则为空对象地区列表详细地址搜索结果默认地址的标识数据内的会随着设置按钮而改变此字段标识数据原始状态获取要进行编辑的地址如果为空则赋值为表示为新建地址构建映射表获取要进行编辑的地址如果为空则赋值为表示为新建地址如果不等于则进行地址详情的拉取说明是编辑地址则需要拉取地址详情从得到默认地址的比对当前地址是否为默认地址当前地址为默认地址设置默认按钮为打开状态为真说明该地址获取的时候就是默认地址说明当前地址不是默认地址当前地址不是默认地址设置默认按钮为关闭状态为假说明该地址获取的时候不是默认地址说明是新建地址不做操作保存地址判断是新建地址还是编辑地址新建地址中国使用映射表进行地区数据处理封装数据对象调用接口进行地址的保存保存成功保存成功后返回地址列表页面编辑地址编辑地址的封装对象用于发送请求保存成功处理默认地址的标识问题为真说明当前编辑的是默认地址当前是默认地址当前是默认地址说明用户取消了这个默认地址需要将的默认地址赋值为否则什么也不做说明当前编辑的不是默认地址当前不是默认地址当前不是默认地址说明用户将当前不是默认地址的地址设置为默认地址否则什么也不做处理完成后跳转会地址列表页判断是否删除的是默认地址如果是则将的默认地址赋值为删除默认地址的默认地址删除成功设置默认地址只有编辑才可以设置默认地址设置默认地址的按钮被触发增加与导航栏等高的内边距避免内容被导航栏覆盖给地址编辑区域增加一些内边距使内容不贴边设置背景色为白色导入组件略过订单结算台静态结构订单结算台地址相关小红江苏省无锡市南长街号请选择配送地址订单明细三星手机超视觉夜拍系统超清夜景悠雾紫手机游戏拍照旗舰机共件商品合计订单总金额优惠券无优惠券可用配送费用请先选择配送地址支付方式支付方式余额支付可用元请先选择配送地址买家留言选填买家留言字内底部提交实付款提交订单渲染订单结算台地址相关还没有地址哦点击右侧按钮添加吧订单明细共件共件商品合计订单总金额优惠券无优惠券可用配送费用请先选择配送地址支付方式支付方式余额支付可用元请先选择配送地址买家留言选填买家留言字内底部提交实付款提交订单构建地区映射表处理购物车详情展示拉取购物车列表购物车列表获取地址列表地址列表从中获取默认地址的默认地址如果有地址查询参数则说明进行了地址切换地址切换参数被赋值为切换的的地址切换后的地址如果没有地址切换参数则说明没有切换地址遍历比对列表每一项的是否与相等找到后返回索引强等于比较注意类型默认地址索引找到后将数组数据转对象赋值给属性处理地址转为调用方法未找到有效的默认地址索引没有默认地址则默认选中第一个地址设置属性为的第一个地址无默认地址展示数据地址列表被选择进行展示的地址将地址转为购物车列表订单结算购物车携带参数文件上传图片上传接口要求参数示例示例值参数对象上传图片通常涉及到裁剪操作于是使用插件辅助完成安装在组件中使用创建上传的组件允许用户选择图片裁剪图片并实时预览裁剪效果然后上传裁剪后的图片裁剪并上传取消存储裁剪后的头像存储用户选择的图片的控制是否显示裁剪器获取裁剪后的图片数据上传裁剪后的图片上传失败请重试上传失败请重试打包优化优化访问路径打包命令或者打包如果没有配置的默认生成的匹配文件的写法是绝对路径这意味着将来的可移植性降低于是配置默认为懒加载打包实际上将多个文件多合一如果一次性加载所有的文件是非常消耗性能的因此推荐配置懒加载路由懒加载异步组件改造路由中应用对比',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-09-11 10:43:39',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const now = new Date()
          const hour = now.getHours()
          const isNight = hour <= 8 || hour >= 22
          if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
          else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="referrer" content="no-referrer" /><link rel="shortcut icon" href="/img/ico/favicon.ico" type="image/x-icon"><link rel="stylesheet" href="/css/anzhiyu.css"><link href="https://fonts.googleapis.cn/css2?family=Fira+Code:wght@300..700&family=Noto+Sans+SC:wght@100..900&family=Noto+Serif+SC:wght@200..900&display=swap" rel="stylesheet"><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/rss2.xml" title="林之介4rozeN" type="application/rss+xml">
</head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://ali-4rozen-oss.oss-cn-guangzhou.aliyuncs.com/blog/avatar/avatar.jpg"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (false) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><div class="back-home-button"><i class="anzhiyufont anzhiyu-icon-grip-vertical"></i><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://4rozen.github.com/" title="我的博客"><img class="back-menu-item-icon" src= "/img/loading/loading.gif" onerror="this.onerror=null,this.src=&quot;/img/avatar/emo.webp&quot;" data-lazy-src="https://ali-4rozen-oss.oss-cn-guangzhou.aliyuncs.com/blog/ico/favicon.ico" alt="我的博客"/><span class="back-menu-item-text">我的博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/4rozeN/Simple-Animated-Guns-Fixed" title="MC枪械模组"><img class="back-menu-item-icon" src= "/img/loading/loading.gif" onerror="this.onerror=null,this.src=&quot;/img/avatar/emo.webp&quot;" data-lazy-src="https://ali-4rozen-oss.oss-cn-guangzhou.aliyuncs.com/blog/cover/%E6%88%91%E7%9A%84%E9%A1%B9%E7%9B%AE/SAG.jpg" alt="MC枪械模组"/><span class="back-menu-item-text">MC枪械模组</span></a><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/4rozeN/Datapack_S.A.G" title="SAG数据包"><img class="back-menu-item-icon" src= "/img/loading/loading.gif" onerror="this.onerror=null,this.src=&quot;/img/avatar/emo.webp&quot;" data-lazy-src="https://ali-4rozen-oss.oss-cn-guangzhou.aliyuncs.com/blog/cover/%E6%88%91%E7%9A%84%E9%A1%B9%E7%9B%AE/SAG.jpg" alt="SAG数据包"/><span class="back-menu-item-text">SAG数据包</span></a></div></div></div></div><a id="site-name" href="/" accesskey="h"><div class="title">林之介4rozeN</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)" rel="external nofollow noreferrer">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 文章归档</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 文章分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 文章标签</span></a></li></ul></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/link/"><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()" rel="external nofollow noreferrer"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> 随便逛逛</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" rel="external nofollow noreferrer" title="搜索🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> 搜索</span></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://ali-4rozen-oss.oss-cn-guangzhou.aliyuncs.com/blog/loveU/wx_zanshang.jpg" rel="external nofollow noreferrer" target="_blank"><img class="post-qr-code-img" alt="微信" src= "/img/loading/loading.gif" onerror="this.onerror=null,this.src=&quot;/img/avatar/emo.webp&quot;" data-lazy-src="https://ali-4rozen-oss.oss-cn-guangzhou.aliyuncs.com/blog/loveU/wx_zanshang.jpg"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://ali-4rozen-oss.oss-cn-guangzhou.aliyuncs.com/blog/loveU/alipay_zanshang.jpg" rel="external nofollow noreferrer" target="_blank"><img class="post-qr-code-img" alt="支付宝" src= "/img/loading/loading.gif" onerror="this.onerror=null,this.src=&quot;/img/avatar/emo.webp&quot;" data-lazy-src="https://ali-4rozen-oss.oss-cn-guangzhou.aliyuncs.com/blog/loveU/alipay_zanshang.jpg"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/API/" style="font-size: 1.05rem;">API<sup>1</sup></a><a href="/tags/Bootstrap/" style="font-size: 1.05rem;">Bootstrap<sup>1</sup></a><a href="/tags/Bug/" style="font-size: 1.05rem;">Bug<sup>1</sup></a><a href="/tags/CSS/" style="font-size: 1.05rem;">CSS<sup>2</sup></a><a href="/tags/CTF-WP/" style="font-size: 1.05rem;">CTF-WP<sup>1</sup></a><a href="/tags/DOH/" style="font-size: 1.05rem;">DOH<sup>1</sup></a><a href="/tags/Fabric/" style="font-size: 1.05rem;">Fabric<sup>3</sup></a><a href="/tags/Fluid/" style="font-size: 1.05rem;">Fluid<sup>1</sup></a><a href="/tags/Git/" style="font-size: 1.05rem;">Git<sup>1</sup></a><a href="/tags/GitHubActions/" style="font-size: 1.05rem;">GitHubActions<sup>1</sup></a><a href="/tags/Hexo/" style="font-size: 1.05rem;">Hexo<sup>6</sup></a><a href="/tags/JavaScript/" style="font-size: 1.05rem;">JavaScript<sup>5</sup></a><a href="/tags/Minecraft/" style="font-size: 1.05rem;">Minecraft<sup>5</sup></a><a href="/tags/Modding/" style="font-size: 1.05rem;">Modding<sup>1</sup></a><a href="/tags/PHP/" style="font-size: 1.05rem;">PHP<sup>1</sup></a><a href="/tags/React/" style="font-size: 1.05rem;">React<sup>1</sup></a><a href="/tags/Strapi/" style="font-size: 1.05rem;">Strapi<sup>1</sup></a><a href="/tags/Vue/" style="font-size: 1.05rem;">Vue<sup>2</sup></a><a href="/tags/Windows11/" style="font-size: 1.05rem;">Windows11<sup>1</sup></a><a href="/tags/ejs/" style="font-size: 1.05rem;">ejs<sup>1</sup></a><a href="/tags/fluid/" style="font-size: 1.05rem;">fluid<sup>2</sup></a><a href="/tags/git/" style="font-size: 1.05rem;">git<sup>1</sup></a><a href="/tags/github/" style="font-size: 1.05rem;">github<sup>1</sup></a><a href="/tags/http/" style="font-size: 1.05rem;">http<sup>1</sup></a><a href="/tags/indexnow/" style="font-size: 1.05rem;">indexnow<sup>1</sup></a><a href="/tags/python/" style="font-size: 1.05rem;">python<sup>1</sup></a><a href="/tags/ssh/" style="font-size: 1.05rem;">ssh<sup>1</sup></a><a href="/tags/styl/" style="font-size: 1.05rem;">styl<sup>1</sup></a><a href="/tags/uni-app/" style="font-size: 1.05rem;">uni-app<sup>1</sup></a><a href="/tags/webpack/" style="font-size: 1.05rem;">webpack<sup>1</sup></a><a href="/tags/%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF/" style="font-size: 1.05rem;">事件循环<sup>1</sup></a><a href="/tags/%E5%85%A8%E6%88%90%E5%B0%B1%E5%B8%AE%E6%89%8B/" style="font-size: 1.05rem;">全成就帮手<sup>1</sup></a><a href="/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" style="font-size: 1.05rem;">反序列化<sup>1</sup></a><a href="/tags/%E5%B1%9E%E6%80%A7%E6%8F%8F%E8%BF%B0%E7%AC%A6/" style="font-size: 1.05rem;">属性描述符<sup>2</sup></a><a href="/tags/%E6%95%B0%E6%8D%AE%E5%93%8D%E5%BA%94%E5%BC%8F/" style="font-size: 1.05rem;">数据响应式<sup>1</sup></a><a href="/tags/%E6%97%A5%E5%A4%9C%E5%88%87%E6%8D%A2%E8%83%8C%E6%99%AF/" style="font-size: 1.05rem;">日夜切换背景<sup>1</sup></a><a href="/tags/%E6%A8%A1%E7%BB%84%E5%BC%80%E5%8F%91/" style="font-size: 1.05rem;">模组开发<sup>1</sup></a><a href="/tags/%E7%AC%94%E8%AE%B0/" style="font-size: 1.05rem;">笔记<sup>4</sup></a><a href="/tags/%E7%BE%8E%E5%8C%96/" style="font-size: 1.05rem;">美化<sup>3</sup></a><a href="/tags/%E9%9D%9E%E9%A2%84%E6%9C%9F%E8%BE%93%E5%85%A5/" style="font-size: 1.05rem;">非预期输入<sup>1</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span><a class="card-more-btn" href="/archives/" title="查看更多">
    <i class="anzhiyufont anzhiyu-icon-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/09/"><span class="card-archive-list-date">九月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">4</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/07/"><span class="card-archive-list-date">七月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">5</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/06/"><span class="card-archive-list-date">六月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/05/"><span class="card-archive-list-date">五月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/03/"><span class="card-archive-list-date">三月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/01/"><span class="card-archive-list-date">一月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/11/"><span class="card-archive-list-date">十一月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/10/"><span class="card-archive-list-date">十月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">3</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);" rel="external nofollow noreferrer"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%89%8D%E7%AB%AF/" itemprop="url">前端</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/%E7%AC%94%E8%AE%B0/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>笔记</span></a></span></div></div><h1 class="post-title" itemprop="name headline">GO-SHOPPING 商城项目笔记</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2023-10-30T15:50:13.000Z" title="发表于 2023-10-30 23:50:13">2023-10-30</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2025-09-11T02:43:39.046Z" title="更新于 2025-09-11 10:43:39">2025-09-11</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-wordcount"><i class="anzhiyufont anzhiyu-icon-file-word post-meta-icon" title="文章字数"></i><span class="post-meta-label" title="文章字数">字数总计:</span><span class="word-count" title="文章字数">20.1k</span><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-clock post-meta-icon" title="阅读时长"></i><span class="post-meta-label" title="阅读时长">阅读时长:</span><span>95分钟</span></span></div></div></div><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="https://ali-4rozen-oss.oss-cn-guangzhou.aliyuncs.com/blog/cover/%E5%89%8D%E7%AB%AF/vue%E7%AC%94%E8%AE%B0.webp"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="https://4rozen.github.io/posts/47412"><header><a class="post-meta-categories" href="/categories/%E5%89%8D%E7%AB%AF/" itemprop="url">前端</a><a href="/tags/%E7%AC%94%E8%AE%B0/" tabindex="-1" itemprop="url">笔记</a><h1 id="CrawlerTitle" itemprop="name headline">GO-SHOPPING 商城项目笔记</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">4rozeN</span><time itemprop="dateCreated datePublished" datetime="2023-10-30T15:50:13.000Z" title="发表于 2023-10-30 23:50:13">2023-10-30</time><time itemprop="dateCreated datePublished" datetime="2025-09-11T02:43:39.046Z" title="更新于 2025-09-11 10:43:39">2025-09-11</time></header><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/hint.css/2.7.0/hint.min.css"><meta name="referrer" content="no-referrer">
<blockquote>
<p>本项目是基于 uni-app 技术栈开发的，能够运行在多端 (微信小程序、h5、ios/Android) 的移动端商城项目。</p>
</blockquote>
<ul>
<li>重点：接口需要 token 的地方，header 中， Access-Token:${token}</li>
<li> 重点：接口需要 platform 的地方，header 中，platform: h5 或 mp-weixin</li>
<li> 接口调用基础地址：<a target="_blank" rel="noopener external nofollow noreferrer" href="http://smart-shop.itheima.net/index.php?s=/api">http://smart-shop.itheima.net/index.php?s=/api</a></li>
<li> 关于接口的说明：分为了 http 状态码和接口中 code 对应码</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:left">码值</th>
<th style="text-align:left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"> http 状态码 500</td>
<td style="text-align:left"> 服务器端异常</td>
</tr>
<tr>
<td style="text-align:left"> http 状态码 404</td>
<td style="text-align:left"> 服务器端异常</td>
</tr>
<tr>
<td style="text-align:left"> http 状态码 401</td>
<td style="text-align:left"> 授权信息不正确</td>
</tr>
</tbody>
</table>
<blockquote>
<p>测试环境，登录短信验证码统一为：246810 （不再提供真实的短信验证服务）</p>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://apifox.com/apidoc/shared-12ab6b18-adc2-444c-ad11-0e60f5693f66/doc-2221080">接口文档地址</a></p>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://youzan.github.io/vant/v2/#/zh-CN/">Vant2 官网地址</a></p>
<p>本项目使用 <code>ESLint+Standard config</code> 的代码规范标准</p>
</blockquote>
<h2 id="项目结构"><a class="markdownIt-Anchor" href="#项目结构"></a> 项目结构</h2>
<meta name="description" content="记录学习过的Vue2商城项目，写法接近uniapp，稍加改造可以成为uniapp项目">
## 一级路由配置
<p>将每个基础的一级页面以文件夹形式存放于 views 包中。包括：</p>
<p><img src= "/img/loading/loading.gif" onerror="this.onerror=null,this.src=&quot;/img/avatar/emo.webp&quot;" data-lazy-src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202408281710771.png" alt="image-20240828171025686">具体项目结构如下：<br>
<img src= "/img/loading/loading.gif" onerror="this.onerror=null,this.src=&quot;/img/avatar/emo.webp&quot;" data-lazy-src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202408281709022.png" alt="image-20240828170920935" style="zoom:80%;"></p>
<p>路由页如下：<br>
<img src= "/img/loading/loading.gif" onerror="this.onerror=null,this.src=&quot;/img/avatar/emo.webp&quot;" data-lazy-src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202408281711591.png" alt="image-20240828171139419" style="zoom: 50%;"></p>
<h2 id="二级路由配置"><a class="markdownIt-Anchor" href="#二级路由配置"></a> 二级路由配置</h2>
<h3 id="实现底部导航栏-tabbar"><a class="markdownIt-Anchor" href="#实现底部导航栏-tabbar"></a> 实现底部导航栏 Tabbar</h3>
<p>配置二级路由之前需要完成底部 Tabbar 栏的设计，可以结合 vant 官网文档进行设计。<a target="_blank" rel="noopener external nofollow noreferrer" href="https://youzan.github.io/vant/v2/">vant2 官网</a><img src= "/img/loading/loading.gif" onerror="this.onerror=null,this.src=&quot;/img/avatar/emo.webp&quot;" data-lazy-src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202408281712602.png" alt="image-20240828171252550"></p>
<h3 id="实现二级路由配置"><a class="markdownIt-Anchor" href="#实现二级路由配置"></a> 实现二级路由配置</h3>
<p><img src= "/img/loading/loading.gif" onerror="this.onerror=null,this.src=&quot;/img/avatar/emo.webp&quot;" data-lazy-src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202408281741912.png" alt="image-20240828174123840"></p>
<p>在组件中的 vant2 的 Tabbar 要实现路由模式如下：</p>
<p><img src= "/img/loading/loading.gif" onerror="this.onerror=null,this.src=&quot;/img/avatar/emo.webp&quot;" data-lazy-src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202408281744188.png" alt="image-20240828174450143"></p>
<p>于是有：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;div&gt;</span><br><span class="line">    &lt;router-view&gt;&lt;/router-view&gt;</span><br><span class="line">    &lt;van-tabbar route v-model="active" active-color="#ee0a24" inactive-color="#000"&gt;</span><br><span class="line">      &lt;van-tabbar-item to= "/home" icon="gem-o"&gt;首页&lt;/van-tabbar-item&gt;</span><br><span class="line">      &lt;van-tabbar-item to= "/category" icon="apps-o"&gt;分类页&lt;/van-tabbar-item&gt;</span><br><span class="line">      &lt;van-tabbar-item to= "/cart" icon="shopping-cart-o"&gt;购物车&lt;/van-tabbar-item&gt;</span><br><span class="line">      &lt;van-tabbar-item to= "/user" icon="user-o"&gt;我的&lt;/van-tabbar-item&gt;</span><br><span class="line">    &lt;/van-tabbar&gt;</span><br><span class="line">  &lt;/div&gt;</span><br></pre></td></tr></tbody></table></figure>
<p>最后优化路由逻辑，将默认匹配的页面重定向到 home</p>
<p><img src= "/img/loading/loading.gif" onerror="this.onerror=null,this.src=&quot;/img/avatar/emo.webp&quot;" data-lazy-src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202408281748077.png" alt="image-20240828174814027"></p>
<h2 id="登录静态页"><a class="markdownIt-Anchor" href="#登录静态页"></a> 登录静态页</h2>
<p>新建 <code>styles/common.less</code> 重置默认样式（可以对一些想要多组件生效的样式进行重新调整）</p>
<figure class="highlight less"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 重置默认样式</span></span><br><span class="line">* {</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">box-sizing</span>: borde-box;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 文字溢出省略号</span></span><br><span class="line"><span class="selector-class">.text-ellipsis-2</span> {</span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">  -webkit-line-clamp: 2;</span><br><span class="line">  <span class="attribute">text-overflow</span>: ellipsis;</span><br><span class="line">  <span class="attribute">display</span>: -webkit-box;</span><br><span class="line">  -webkit-box-orient: vertical;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>导入于 main.js 中：<code>import '@/styles/common.less'</code></p>
<p>接着准备一些素材图片于 assets<br>
<img src= "/img/loading/loading.gif" onerror="this.onerror=null,this.src=&quot;/img/avatar/emo.webp&quot;" data-lazy-src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202408281759229.png" alt="image-20240828175944181"></p>
<h3 id="配置头部-navbar"><a class="markdownIt-Anchor" href="#配置头部-navbar"></a> 配置头部 NavBar</h3>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 头部 NavBar --&gt;</span><br><span class="line">&lt;van-nav-bar</span><br><span class="line">  title="尊敬的用户，请登录"</span><br><span class="line">  left-arrow</span><br><span class="line">  @click-left="$router.go(-1)"</span><br><span class="line">/&gt;</span><br></pre></td></tr></tbody></table></figure>
<p><code>$router.go(-1)</code> 的作用是返回上一页。</p>
<p>接着将左边的返回符号 left-arrow 颜色样式改为灰色 #333，于是找到 common.less 进行编写（两个类名增加权重）</p>
<figure class="highlight less"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 添加导航的通用样式</span></span><br><span class="line"><span class="selector-class">.van-nav-bar</span> {</span><br><span class="line">  <span class="selector-class">.van-nav-bar__arrow</span> {</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#333</span>;</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>这样的好处是，一旦配置好了将来其他页面使用到导航栏此处的返回颜色都是我们此时配好的颜色。这就是通用样式的覆盖。</p>
<h3 id="完善主体"><a class="markdownIt-Anchor" href="#完善主体"></a> 完善主体</h3>
<p>接着编写主体的静态结构：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class="login"&gt;</span><br><span class="line">    &lt;!-- 头部 NavBar --&gt;</span><br><span class="line">    &lt;van-nav-bar</span><br><span class="line">      title="尊敬的用户，请登录"</span><br><span class="line">      left-arrow</span><br><span class="line">      @click-left="$router.go(-1)"</span><br><span class="line">    /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 主体部分 自定义 --&gt;</span><br><span class="line">    &lt;div class="container"&gt;</span><br><span class="line">      &lt;div class="title"&gt;</span><br><span class="line">        &lt;h3&gt;手机号登录&lt;/h3&gt;</span><br><span class="line">        &lt;p&gt;未注册的手机号登录后将自动注册&lt;/p&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">      &lt;div class="form"&gt;</span><br><span class="line">        &lt;div class="form-item"&gt;</span><br><span class="line">          &lt;input</span><br><span class="line">            class="inp"</span><br><span class="line">            maxlength="11"</span><br><span class="line">            placeholder="请输入手机号码"</span><br><span class="line">            type="text"</span><br><span class="line">          /&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div class="form-item"&gt;</span><br><span class="line">          &lt;input</span><br><span class="line">            class="inp"</span><br><span class="line">            maxlength="5"</span><br><span class="line">            placeholder="请输入图形验证码"</span><br><span class="line">            type="text"</span><br><span class="line">          /&gt;</span><br><span class="line">          &lt;img src="@/assets/code.png" alt="" /&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div class="form-item"&gt;</span><br><span class="line">          &lt;input class="inp" placeholder="请输入短信验证码" type="text" /&gt;</span><br><span class="line">          &lt;button&gt;获取验证码&lt;/button&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">      &lt;div class="login-btn"&gt;登录&lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default {</span><br><span class="line">  name: "LoginIndex",</span><br><span class="line">};</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang="less" scoped&gt;</span><br><span class="line">.container {</span><br><span class="line">  padding: 49px 29px;</span><br><span class="line"></span><br><span class="line">  .title {</span><br><span class="line">    margin-bottom: 20px;</span><br><span class="line">    h3 {</span><br><span class="line">      font-size: 26px;</span><br><span class="line">      font-weight: normal;</span><br><span class="line">    }</span><br><span class="line">    p {</span><br><span class="line">      line-height: 40px;</span><br><span class="line">      font-size: 14px;</span><br><span class="line">      color: #b8b8b8;</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  .form-item {</span><br><span class="line">    border-bottom: 1px solid #f3f1f2;</span><br><span class="line">    padding: 8px;</span><br><span class="line">    margin-bottom: 14px;</span><br><span class="line">    display: flex;</span><br><span class="line">    align-items: center;</span><br><span class="line">    .inp {</span><br><span class="line">      display: block;</span><br><span class="line">      border: none;</span><br><span class="line">      outline: none;</span><br><span class="line">      height: 32px;</span><br><span class="line">      font-size: 14px;</span><br><span class="line">      flex: 1;</span><br><span class="line">    }</span><br><span class="line">    img {</span><br><span class="line">      width: 94px;</span><br><span class="line">      height: 31px;</span><br><span class="line">    }</span><br><span class="line">    button {</span><br><span class="line">      height: 31px;</span><br><span class="line">      border: none;</span><br><span class="line">      font-size: 13px;</span><br><span class="line">      color: #cea26a;</span><br><span class="line">      background-color: transparent;</span><br><span class="line">      padding-right: 9px;</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  .login-btn {</span><br><span class="line">    width: 100%;</span><br><span class="line">    height: 42px;</span><br><span class="line">    margin-top: 39px;</span><br><span class="line">    background: linear-gradient(90deg, #ecb53c, #ff9211);</span><br><span class="line">    color: #fff;</span><br><span class="line">    border-radius: 39px;</span><br><span class="line">    box-shadow: 0 10px 20px 0 rgba(0, 0, 0, 0.1);</span><br><span class="line">    letter-spacing: 2px;</span><br><span class="line">    display: flex;</span><br><span class="line">    justify-content: center;</span><br><span class="line">    align-items: center;</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></tbody></table></figure>
<p>页面效果如下：</p>
<img src= "/img/loading/loading.gif" onerror="this.onerror=null,this.src=&quot;/img/avatar/emo.webp&quot;" data-lazy-src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202408281818338.png" alt="image-20240828181803280" style="zoom: 80%;">
<p>图形验证码暂时写死，短信验证码暂时不作处理</p>
<h3 id="完善登录逻辑"><a class="markdownIt-Anchor" href="#完善登录逻辑"></a> 完善登录逻辑</h3>
<p>登录页面一共有三个请求需要发送，图形验证码、短信验证码和登录请求。我们使用 axios 来请求后端接口，一般都会对 axios 进行一些配置（配置基础地址，请求响应拦截器等），于是封装 axios 为一个 request 模块，便于维护。以后使用 axios 都是创建实例去请求，这样多个实例相互独立，互不干扰。</p>
<ul>
<li><a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.axios-http.cn/docs/instance">axios 中文文档</a></li>
</ul>
<p>新建 request.js 于 utils 包下，创建一个 axios 实例（cv 中文文档中的实例和拦截器进行改造）：</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">"axios"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建axios实例</span></span><br><span class="line"><span class="keyword">const</span> instance = axios.<span class="title function_">create</span>({</span><br><span class="line">  <span class="comment">// 查看接口文档改造</span></span><br><span class="line">  <span class="attr">baseURL</span>: <span class="string">"http://smart-shop.itheima.net/index.php?s=/api"</span>,</span><br><span class="line">  <span class="attr">timeout</span>: <span class="number">5000</span>,</span><br><span class="line">  <span class="attr">headers</span>: { <span class="attr">platform</span>: <span class="string">"h5"</span> },</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line"><span class="comment">// 自定义配置 - 请求/响应 拦截器 （如果希望不污染原本的axios需要将axios改为instance实例）</span></span><br><span class="line"><span class="comment">// 添加请求拦截器</span></span><br><span class="line">instance.<span class="property">interceptors</span>.<span class="property">request</span>.<span class="title function_">use</span>(</span><br><span class="line">  <span class="keyword">function</span> (<span class="params">config</span>) {</span><br><span class="line">    <span class="comment">// 在发送请求之前做些什么</span></span><br><span class="line">    <span class="keyword">return</span> config;</span><br><span class="line">  },</span><br><span class="line">  <span class="keyword">function</span> (<span class="params">error</span>) {</span><br><span class="line">    <span class="comment">// 对请求错误做些什么</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error);</span><br><span class="line">  }</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加响应拦截器</span></span><br><span class="line">instance.<span class="property">interceptors</span>.<span class="property">response</span>.<span class="title function_">use</span>(</span><br><span class="line">  <span class="keyword">function</span> (<span class="params">response</span>) {</span><br><span class="line">    <span class="comment">// 2xx 范围内的状态码都会触发该函数。</span></span><br><span class="line">    <span class="comment">// 对响应数据做点什么 (默认axios会对响应多包装一层data，所以这里需要取出data)</span></span><br><span class="line">    <span class="keyword">return</span> response.<span class="property">data</span>;</span><br><span class="line">  },</span><br><span class="line">  <span class="keyword">function</span> (<span class="params">error</span>) {</span><br><span class="line">    <span class="comment">// 超出 2xx 范围的状态码都会触发该函数。</span></span><br><span class="line">    <span class="comment">// 对响应错误做点什么</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error);</span><br><span class="line">  }</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导出配置好的示例</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> instance;</span><br></pre></td></tr></tbody></table></figure>
<p>响应器中，response.data 原本为 response，这里改为上文是因为 axios 默认会对响应多包装一层 data，所以这里需要取出 data</p>
<p>接着回到登录页面 index.vue 上，导入 request 模块，异步检查一下：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">import request from "@/utils/request";</span><br><span class="line"></span><br><span class="line">export default {</span><br><span class="line">  name: "LoginIndex",</span><br><span class="line">  async created() {</span><br><span class="line">    const res = await request.get("/captcha/image");</span><br><span class="line">    console.log(res);</span><br><span class="line">  },</span><br><span class="line">};</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></tbody></table></figure>
<p>调试返回如下</p>
<p><img src= "/img/loading/loading.gif" onerror="this.onerror=null,this.src=&quot;/img/avatar/emo.webp&quot;" data-lazy-src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202408281850640.png" alt="image-20240828185016590"></p>
<h4 id="解析-base64-并完善点击刷新图片验证码"><a class="markdownIt-Anchor" href="#解析-base64-并完善点击刷新图片验证码"></a> 解析 base64 并完善点击刷新图片验证码</h4>
<p>由于提交的图形验证码必须带 key 才能让后端进行唯一校验，所以在 data 中提供：</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">data</span> () {</span><br><span class="line">  <span class="keyword">return</span> {</span><br><span class="line">    <span class="attr">picCode</span>: <span class="string">''</span>, <span class="comment">// 用户输入的图形验证码</span></span><br><span class="line">    <span class="attr">picKey</span>: <span class="string">''</span>, <span class="comment">// 图形验证码的key</span></span><br><span class="line">    <span class="attr">picUrl</span>: <span class="string">''</span> <span class="comment">// 存放要渲染的图形验证码的url</span></span><br><span class="line">  }</span><br><span class="line">},</span><br></pre></td></tr></tbody></table></figure>
<p>接着进行响应结果的解构，存储好数据以便后续提交后端进行校验</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">async</span> <span class="title function_">created</span> () {</span><br><span class="line">   <span class="variable language_">this</span>.<span class="title function_">getPicCode</span>()</span><br><span class="line"> },</span><br><span class="line"><span class="attr">methods</span>: {</span><br><span class="line">   <span class="keyword">async</span> <span class="title function_">getPicCode</span> () {</span><br><span class="line">     <span class="keyword">const</span> { <span class="attr">data</span>: { base64, <span class="title class_">Key</span> } } = <span class="keyword">await</span> request.<span class="title function_">get</span>(<span class="string">'/captcha/image'</span>)</span><br><span class="line">     <span class="variable language_">this</span>.<span class="property">picUrl</span> = base64</span><br><span class="line">     <span class="variable language_">this</span>.<span class="property">picKey</span> = <span class="title class_">Key</span></span><br><span class="line">   }</span><br><span class="line"> }</span><br></pre></td></tr></tbody></table></figure>
<p>完善 template 相关代码：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class="form-item"&gt;</span><br><span class="line">   &lt;input v-model="picCode" class="inp" maxlength="5" placeholder="请输入图形验证码" type="text"&gt;</span><br><span class="line">   &lt;img v-if="picUrl" :src="picUrl" @click="getPicCode" alt=""&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></tbody></table></figure>
<p>封装登录请求到 api 包下，新建 login.js</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 登录相关接口请求</span></span><br><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">"@/utils/request"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">getPicCode</span> = (<span class="params"></span>) =&gt; {</span><br><span class="line">  <span class="keyword">return</span> request.<span class="title function_">get</span>(<span class="string">"/captcha/image"</span>);</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure>
<p>使用时按需导入。于是到登录页 index.js 中改 <code>import request from '@/utils/request'</code> 为 <code>import { getPicCode } from '@/api/login'</code> 并修改调用语句：</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">methods</span>: {</span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">getPicCode</span> () {</span><br><span class="line">    <span class="keyword">const</span> { <span class="attr">data</span>: { base64, <span class="title class_">Key</span> } } = <span class="keyword">await</span> <span class="title function_">getPicCode</span>()</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">picUrl</span> = base64</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">picKey</span> = <span class="title class_">Key</span></span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>上述语句不会因为重名冲突，我们需要知道的是，如果是引入的 getPicCode 前面是不带 this 的，而自身的 getPicCode 是需要在前面加上 this. 的</p>
<h3 id="toast-轻提示"><a class="markdownIt-Anchor" href="#toast-轻提示"></a> Toast 轻提示</h3>
<p>校验手机号是否输入、是否输入格式正确等并给予提示。</p>
<p>使用 vant 库中的 Toast 轻提示，完成提示显示。需要注意的是他的两种调用方式：</p>
<ol>
<li>Toast (' 提示内容 ');</li>
<li>this.<span class="katex-error" title="ParseError: KaTeX parse error: LaTeX-incompatible input and strict mode is set to 'error': Unicode text character &quot;提&quot; used in math mode [unicodeTextInMathMode] at position 8: toast('提̲示文案');  引入 Toas…">toast (' 提示文案 ');  引入 Toast 组件后，会自动在 Vue 的 prototype 上挂载 `</span>toast` 方法，便于在组件内调用。</li>
</ol>
<p>这两种调用，第一种是任意地方都可以调用显示出提示内容，第二种是只有组件内才可以显示提示内容。Toast 默认采用单例模式，即同一时间只会存在一个 Toast，如果需要在同一时间弹出多个 Toast，可以参考下面的示例：</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Toast</span>.<span class="title function_">allowMultiple</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> toast1 = <span class="title class_">Toast</span>(<span class="string">"第一个 Toast"</span>);</span><br><span class="line"><span class="keyword">const</span> toast2 = <span class="title class_">Toast</span>.<span class="title function_">success</span>(<span class="string">"第二个 Toast"</span>);</span><br><span class="line"></span><br><span class="line">toast1.<span class="title function_">clear</span>();</span><br><span class="line">toast2.<span class="title function_">clear</span>();</span><br></pre></td></tr></tbody></table></figure>
<h3 id="短信验证倒计时"><a class="markdownIt-Anchor" href="#短信验证倒计时"></a> 短信验证倒计时</h3>
<p>点击获取验证码之后要开始倒计时，一分钟只能发送一次。给获取短信验证码的按钮注册点击事件并改写显示文字</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class="form-item"&gt;</span><br><span class="line">   &lt;input class="inp" placeholder="请输入短信验证码" type="text"&gt;</span><br><span class="line">   &lt;button @click="getCode"&gt;{{ totalTime === timeNow ? '获取验证码' : `${timeNow}秒后重试` }}&lt;/button&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></tbody></table></figure>
<p>提供短信验证码获取函数 getCode</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 短信验证码获取</span></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">getCode</span> () {</span><br><span class="line">    <span class="comment">// 只有当计时器处于未开启状态并且当前时间和总时间一致时说明可以开启倒计时</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">timerId</span> &amp;&amp; <span class="variable language_">this</span>.<span class="property">timeNow</span> === <span class="variable language_">this</span>.<span class="property">totalTime</span>) {</span><br><span class="line">      <span class="comment">// 开启计时器</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">timerId</span> = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> {</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">timeNow</span>--</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">timeNow</span> &lt;= <span class="number">0</span>) {</span><br><span class="line">          <span class="comment">// 停止计时器</span></span><br><span class="line">          <span class="built_in">clearInterval</span>(<span class="variable language_">this</span>.<span class="property">timerId</span>)</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">timerId</span> = <span class="literal">null</span></span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">timeNow</span> = <span class="variable language_">this</span>.<span class="property">totalTime</span></span><br><span class="line">        }</span><br><span class="line">      }, <span class="number">1000</span>)</span><br><span class="line">      <span class="comment">// 获取成功给予提示</span></span><br><span class="line">      <span class="title class_">Toast</span>(<span class="string">'获取短信验证码成功'</span>)</span><br><span class="line">    }</span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure>
<p>并考虑到性能问题，于是增加在用户离开登录页面之后清除定时器的功能，实现在 destroy 生命函数</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">destroyed</span> () {</span><br><span class="line">    <span class="comment">// 当用户退出登录页面清除定时器</span></span><br><span class="line">    <span class="built_in">clearInterval</span>(<span class="variable language_">this</span>.<span class="property">timerId</span>)</span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure>
<h3 id="手机号和图形验证码类型校验"><a class="markdownIt-Anchor" href="#手机号和图形验证码类型校验"></a> 手机号和图形验证码类型校验</h3>
<p>由于前端无法校验具体，只能校验数据类型和长度。所以新增两个正则数据和绑定用户输入的手机号：</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 手机号正则 1开头 3-9为第二位 接着9位数字</span></span><br><span class="line">      <span class="attr">reg_phone</span>: <span class="regexp">/^1[3-9]\d{9}$/</span>,</span><br><span class="line">      <span class="attr">reg_picCode</span>: <span class="regexp">/^\w{4}$/</span>, <span class="comment">// 图形正则</span></span><br><span class="line">      <span class="attr">phoneNum</span>: <span class="string">''</span>, <span class="comment">// 用户输入的手机号码</span></span><br></pre></td></tr></tbody></table></figure>
<p>增加校验的函数 validFn</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 校验手机号和图形验证码</span></span><br><span class="line">    <span class="title function_">validFn</span> () {</span><br><span class="line">      <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">reg_phone</span>.<span class="title function_">test</span>(<span class="variable language_">this</span>.<span class="property">phoneNum</span>)) {</span><br><span class="line">        <span class="title class_">Toast</span>(<span class="string">'请输入正确的手机号！'</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">      }</span><br><span class="line">      <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">reg_picCode</span>.<span class="title function_">test</span>(<span class="variable language_">this</span>.<span class="property">picCode</span>)) {</span><br><span class="line">        <span class="title class_">Toast</span>(<span class="string">'图形验证码错误！'</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">      }</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    },</span><br></pre></td></tr></tbody></table></figure>
<p>并在短信验证码获取函数 getCode 中加入一行判断</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 短信验证码获取</span></span><br><span class="line">    <span class="title function_">getCode</span> () {</span><br><span class="line">      <span class="comment">// 校验手机号和图形验证码格式</span></span><br><span class="line">      <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="title function_">validFn</span>()) { <span class="keyword">return</span> }</span><br><span class="line">      ...</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>
<h3 id="封装发送短信验证码请求"><a class="markdownIt-Anchor" href="#封装发送短信验证码请求"></a> 封装发送短信验证码请求</h3>
<p>转到 login.js 中进行封装（结合接口文档）</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">getMsgCode</span> = (<span class="params">captchaCode, captchaKey, mobile</span>) =&gt; {</span><br><span class="line">  <span class="keyword">return</span> request.<span class="title function_">post</span>(<span class="string">"/captcha/sendSmsCaptcha"</span>, {</span><br><span class="line">    <span class="attr">form</span>: {</span><br><span class="line">      captchaCode,</span><br><span class="line">      captchaKey,</span><br><span class="line">      mobile,</span><br><span class="line">    },</span><br><span class="line">  });</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure>
<p>然后在短信验证码获取函数 getCode 中加入调用代码</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 短信验证码获取</span></span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">getCode</span> () {</span><br><span class="line">      <span class="comment">// 发送获取短信验证码的请求</span></span><br><span class="line">      <span class="keyword">await</span> <span class="title function_">getMsgCode</span>(<span class="variable language_">this</span>.<span class="property">picCode</span>, <span class="variable language_">this</span>.<span class="property">picKey</span>, <span class="variable language_">this</span>.<span class="property">phoneNum</span>)</span><br><span class="line">      <span class="comment">// console.log(res)</span></span><br><span class="line">      <span class="title class_">Toast</span>(<span class="string">'短信发送成功，请注意查收'</span>)</span><br><span class="line">      ...</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>
<h3 id="实现登录功能-封装登录接口"><a class="markdownIt-Anchor" href="#实现登录功能-封装登录接口"></a> 实现登录功能 - 封装登录接口</h3>
<p>封装登录请求</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">codeLogin</span> = (<span class="params">mobile, smsCode</span>) =&gt; {</span><br><span class="line">  <span class="keyword">return</span> request.<span class="title function_">post</span>(<span class="string">"/passport/login"</span>, {</span><br><span class="line">    <span class="attr">form</span>: {</span><br><span class="line">      <span class="attr">isParty</span>: <span class="literal">false</span>,</span><br><span class="line">      mobile,</span><br><span class="line">      <span class="attr">partyData</span>: {},</span><br><span class="line">      smsCode,</span><br><span class="line">    },</span><br><span class="line">  });</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure>
<p>绑定登录按钮事件为 login，绑定用户输入的短信验证码为 smsCode（默认短信为 246810）</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 登录功能</span></span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">login</span> () {</span><br><span class="line">      <span class="comment">// 校验手机号和图形验证码格式</span></span><br><span class="line">      <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="title function_">validFn</span>()) { <span class="keyword">return</span> }</span><br><span class="line">      <span class="comment">// 校验输入的短信验证码格式</span></span><br><span class="line">      <span class="keyword">if</span> (!<span class="regexp">/^\d{6}$/</span>.<span class="title function_">test</span>(<span class="variable language_">this</span>.<span class="property">smsCode</span>)) {</span><br><span class="line">        <span class="title class_">Toast</span>(<span class="string">'请输入正确的短信验证码！'</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      }</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">codeLogin</span>(<span class="variable language_">this</span>.<span class="property">phoneNum</span>, <span class="variable language_">this</span>.<span class="property">smsCode</span>)</span><br><span class="line">      <span class="keyword">if</span> (res.<span class="property">status</span> === <span class="number">200</span>) {</span><br><span class="line">        <span class="title class_">Toast</span>(<span class="string">'登录成功'</span>)</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">push</span>(<span class="string">'/home'</span>)</span><br><span class="line">      } <span class="keyword">else</span> {</span><br><span class="line">        <span class="title class_">Toast</span>(<span class="string">'登录失败，请检查手机号和验证码是否正确'</span>)</span><br><span class="line">      }</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>
<p>后面失败的多种情况可以通过响应拦截器进行处理，在这里暂时只考虑成功的情况</p>
<h2 id="响应处理器统一处理错误提示"><a class="markdownIt-Anchor" href="#响应处理器统一处理错误提示"></a> 响应处理器统一处理错误提示</h2>
<p>对 utils 包下的 request 拦截器进行修改</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 响应拦截器</span></span><br><span class="line">instance.<span class="property">interceptors</span>.<span class="property">response</span>.<span class="title function_">use</span>(</span><br><span class="line">  <span class="keyword">function</span> (<span class="params">response</span>) {</span><br><span class="line">    <span class="comment">// 2xx 范围内的状态码都会触发该函数。</span></span><br><span class="line">    <span class="comment">// 对响应数据做点什么 (默认axios会对响应多包装一层data，所以这里需要取出data)</span></span><br><span class="line">    <span class="keyword">const</span> res = response.<span class="property">data</span>;</span><br><span class="line">    <span class="keyword">if</span> (res.<span class="property">status</span> !== <span class="number">200</span>) {</span><br><span class="line">      <span class="title class_">Toast</span>(res.<span class="property">message</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(res.<span class="property">message</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">  },</span><br><span class="line">  <span class="keyword">function</span> (<span class="params">error</span>) {</span><br><span class="line">    <span class="comment">// 超出 2xx 范围的状态码都会触发该函数。</span></span><br><span class="line">    <span class="comment">// 对响应错误做点什么</span></span><br><span class="line">    <span class="keyword">if</span> (error.<span class="property">response</span>) {</span><br><span class="line">      <span class="comment">// 服务器返回了错误响应</span></span><br><span class="line">      <span class="title class_">Toast</span>(<span class="string">`服务器错误: <span class="subst">${error.response.data.status}</span>`</span>);</span><br><span class="line">    } <span class="keyword">else</span> <span class="keyword">if</span> (error.<span class="property">request</span>) {</span><br><span class="line">      <span class="comment">// 请求已发出，但没有收到响应</span></span><br><span class="line">      <span class="title class_">Toast</span>(<span class="string">"请求超时或网络错误"</span>);</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">      <span class="comment">// 其他错误</span></span><br><span class="line">      <span class="title class_">Toast</span>(<span class="string">"请求配置错误"</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error);</span><br><span class="line">  }</span><br><span class="line">);</span><br></pre></td></tr></tbody></table></figure>
<h2 id="登录权证信息存储"><a class="markdownIt-Anchor" href="#登录权证信息存储"></a> 登录权证信息存储</h2>
<p><img src= "/img/loading/loading.gif" onerror="this.onerror=null,this.src=&quot;/img/avatar/emo.webp&quot;" data-lazy-src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202408291344002.png" alt="image-20240829134402875"></p>
<p>使用 vuex 构建 user 模块存储登录权证（token 和 userID）。好处是易获取、响应式，分模块便于管理维护。</p>
<p>在 store 包下新建 modules 包，然后在 modules 包下新建 user.js</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> {</span><br><span class="line">  <span class="attr">namespaced</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="title function_">state</span>(<span class="params"></span>) {</span><br><span class="line">    <span class="keyword">return</span> {</span><br><span class="line">      <span class="comment">// 个人权证</span></span><br><span class="line">      <span class="attr">userInfo</span>: {</span><br><span class="line">        <span class="attr">token</span>: <span class="string">""</span>,</span><br><span class="line">        <span class="attr">userId</span>: <span class="string">""</span>,</span><br><span class="line">      },</span><br><span class="line">    };</span><br><span class="line">  },</span><br><span class="line">  <span class="attr">mutations</span>: {</span><br><span class="line">    <span class="title function_">setUserInfo</span>(<span class="params">state, obj</span>) {</span><br><span class="line">      state.<span class="property">userInfo</span> = obj;</span><br><span class="line">    },</span><br><span class="line">  },</span><br><span class="line">  <span class="attr">actions</span>: {},</span><br><span class="line">  <span class="attr">getters</span>: {},</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure>
<p>然后在 vuex 中进行挂载</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">User</span> <span class="keyword">from</span> <span class="string">"@/store/modules/user"</span>;</span><br><span class="line"></span><br><span class="line"><span class="attr">modules</span>: {</span><br><span class="line">  <span class="title class_">User</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>并在登录页面将要实现跳转到首页的前一刻完成用户权证信息的存储</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="property">$store</span>.<span class="title function_">commit</span>(<span class="string">"User/setUserInfo"</span>, res.<span class="property">data</span>);</span><br></pre></td></tr></tbody></table></figure>
<p><img src= "/img/loading/loading.gif" onerror="this.onerror=null,this.src=&quot;/img/avatar/emo.webp&quot;" data-lazy-src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202408291411700.png" alt="image-20240829141130620"></p>
<h2 id="vuex-持久化处理"><a class="markdownIt-Anchor" href="#vuex-持久化处理"></a> vuex 持久化处理</h2>
<p>vuex 刷新就会丢失信息，于是引入持久化存储。我们将获取、设置和移除信息的操作封装为 storage 模块。</p>
<p>在 utils 包下新建一个 storage.js</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 约定一个通用键名</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">INFO_KEY</span> = <span class="string">"go_shopping_info"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">getInfo</span> = (<span class="params"></span>) =&gt; {</span><br><span class="line">  <span class="keyword">const</span> defaultInfo = {</span><br><span class="line">    <span class="attr">token</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="attr">userId</span>: <span class="string">""</span>,</span><br><span class="line">  };</span><br><span class="line">  <span class="keyword">const</span> info = <span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="variable constant_">INFO_KEY</span>);</span><br><span class="line">  <span class="comment">// 判断info是否有值</span></span><br><span class="line">  <span class="keyword">return</span> info ? <span class="title class_">JSON</span>.<span class="title function_">parse</span>(info) : defaultInfo;</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">setInfo</span> = (<span class="params">obj</span>) =&gt; {</span><br><span class="line">  <span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(<span class="variable constant_">INFO_KEY</span>, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(obj));</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">removeInfo</span> = (<span class="params"></span>) =&gt; {</span><br><span class="line">  <span class="variable language_">localStorage</span>.<span class="title function_">removeItem</span>(<span class="variable constant_">INFO_KEY</span>);</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure>
<p>然后到 vuex 的 user 子模块中进行导入使用即可</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> { getInfo, setInfo } <span class="keyword">from</span> <span class="string">"@/utils/storage"</span>;</span><br></pre></td></tr></tbody></table></figure>
<p><img src= "/img/loading/loading.gif" onerror="this.onerror=null,this.src=&quot;/img/avatar/emo.webp&quot;" data-lazy-src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202408291432317.png" alt="image-20240829143212223"></p>
<h2 id="添加请求-loading-效果"><a class="markdownIt-Anchor" href="#添加请求-loading-效果"></a> 添加请求 Loading 效果</h2>
<p>需求分析：有时候因为网络原因，一次请求的结果可能需要一段时间后才能回来。此时，需要给用户添加 loading 提示。</p>
<p>添加 loading 提示的好处：</p>
<ol>
<li><strong>节流处理</strong>：防止用户在一次请求还没回来之前，多次进行点击，发送无效请求</li>
<li><strong>友好提示</strong>：告知用户，目前是在加载中，请耐心等待，用户体验会更好</li>
</ol>
<p>加在哪呢？可以统一加在拦截器中，这样一来后面也可以复用：</p>
<ol>
<li><strong>请求拦截器</strong>中，每次请求，打开 loading</li>
<li><strong> 响应拦截器</strong>中，每次响应，关闭 loading</li>
</ol>
<p>转到 utils 包下的 request 拦截器，在请求的时候显示 Toast 提示，并设置背景不可点击且使其不会定时消失，只能由我们清除。</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">instance.<span class="property">interceptors</span>.<span class="property">request</span>.<span class="title function_">use</span>(<span class="keyword">function</span> (<span class="params">config</span>) {</span><br><span class="line">  <span class="comment">// 在发送请求之前做些什么</span></span><br><span class="line">  <span class="comment">// 发送请求时显示Toast提示，背景不可点击</span></span><br><span class="line">  <span class="title class_">Toast</span>.<span class="title function_">loading</span>({</span><br><span class="line">    <span class="attr">message</span>: <span class="string">'加载中...'</span>,</span><br><span class="line">    <span class="attr">forbidClick</span>: <span class="literal">true</span>, <span class="comment">// 禁止背景点击</span></span><br><span class="line">    <span class="attr">duration</span>: <span class="number">0</span> <span class="comment">// 值为0时，toast不会自动关闭</span></span><br><span class="line">  })</span><br><span class="line">  <span class="keyword">return</span> config</span><br><span class="line">}, <span class="keyword">function</span> (<span class="params">error</span>) {...})</span><br></pre></td></tr></tbody></table></figure>
<p>在响应拦截器添加清除提示的代码</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 对响应数据做点什么 (默认axios会对响应多包装一层data，所以这里需要取出data)</span></span><br><span class="line"><span class="keyword">const</span> res = response.<span class="property">data</span>;</span><br><span class="line"><span class="keyword">if</span> (res.<span class="property">status</span> !== <span class="number">200</span>) {</span><br><span class="line">  <span class="title class_">Toast</span>(res.<span class="property">message</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(res.<span class="property">message</span>);</span><br><span class="line">} <span class="keyword">else</span> {</span><br><span class="line">  <span class="comment">// 关闭Toast提示</span></span><br><span class="line">  <span class="title class_">Toast</span>.<span class="title function_">clear</span>();</span><br><span class="line">}</span><br><span class="line"><span class="keyword">return</span> res;</span><br></pre></td></tr></tbody></table></figure>
<h2 id="全局路由前置守卫"><a class="markdownIt-Anchor" href="#全局路由前置守卫"></a> 全局路由前置守卫</h2>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://router.vuejs.org/zh/guide/">Vue-router 官网地址</a></p>
<p><img src= "/img/loading/loading.gif" onerror="this.onerror=null,this.src=&quot;/img/avatar/emo.webp&quot;" data-lazy-src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202408291814256.png" alt="image-20240829181413117"><br>
在 router 中编写：</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">'@/store'</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义数组存储需要登录才能访问的路由</span></span><br><span class="line"><span class="keyword">const</span> authNeedRouters = [<span class="string">'/myorder'</span>, <span class="string">'/pay'</span>, <span class="string">'/productdetail/:id'</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建全局路由前置守卫</span></span><br><span class="line">router.<span class="title function_">beforeEach</span>(<span class="function">(<span class="params">to, <span class="keyword">from</span>, next</span>) =&gt;</span> {</span><br><span class="line">  <span class="comment">// 判断to的path是否存在登录的路由数组中</span></span><br><span class="line">  <span class="keyword">if</span> (!authNeedRouters.<span class="title function_">includes</span>(to.<span class="property">path</span>)) {</span><br><span class="line">    <span class="comment">// 不需要登录，直接进入</span></span><br><span class="line">    <span class="title function_">next</span>()</span><br><span class="line">  } <span class="keyword">else</span> {</span><br><span class="line">    <span class="comment">// 判断是否有token（实际上需要调用后端接口校验token）</span></span><br><span class="line">    <span class="keyword">const</span> token = store.<span class="property">state</span>.<span class="property">User</span>.<span class="property">userInfo</span>.<span class="property">token</span></span><br><span class="line">    <span class="keyword">if</span> (token) {</span><br><span class="line">      <span class="comment">// 有token，可以进入</span></span><br><span class="line">      <span class="title function_">next</span>()</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">      <span class="comment">// 没有token，跳转到登录页</span></span><br><span class="line">      <span class="title function_">next</span>(<span class="string">'/login'</span>)</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">})</span><br></pre></td></tr></tbody></table></figure>
<h2 id="首页"><a class="markdownIt-Anchor" href="#首页"></a> 首页</h2>
<h3 id="完成首页静态结构"><a class="markdownIt-Anchor" href="#完成首页静态结构"></a> 完成首页静态结构</h3>
<p>要用到的 vant 组件有</p>
<ul>
<li>search（搜索框）</li>
<li>swipe &amp; swipe-item （轮播图）</li>
<li>grid &amp; grid-item （宫格）</li>
</ul>
<p>grid 宫格主要是使用自定义列数的：<br>
<img src= "/img/loading/loading.gif" onerror="this.onerror=null,this.src=&quot;/img/avatar/emo.webp&quot;" data-lazy-src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202408291915006.png" alt="image-20240829191508887" style="zoom:50%;"></p>
<p>所以在 utils 包下的 vant2-ui.js 中进行添加：</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vant2-ui.js按需导入组件</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">"vue"</span>;</span><br><span class="line"><span class="keyword">import</span> {</span><br><span class="line">  <span class="title class_">Button</span>,</span><br><span class="line">  <span class="title class_">Tabbar</span>,</span><br><span class="line">  <span class="title class_">TabbarItem</span>,</span><br><span class="line">  <span class="title class_">NavBar</span>,</span><br><span class="line">  <span class="title class_">Toast</span>,</span><br><span class="line">  <span class="title class_">Search</span>,</span><br><span class="line">  <span class="title class_">Swipe</span>,</span><br><span class="line">  <span class="title class_">SwipeItem</span>,</span><br><span class="line">  <span class="title class_">Grid</span>,</span><br><span class="line">  <span class="title class_">GridItem</span>,</span><br><span class="line">} <span class="keyword">from</span> <span class="string">"vant"</span>;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">Tabbar</span>);</span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">TabbarItem</span>);</span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">Button</span>);</span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">NavBar</span>);</span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">Toast</span>);</span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">Search</span>);</span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">Swipe</span>);</span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">SwipeItem</span>);</span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">Grid</span>);</span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">GridItem</span>);</span><br></pre></td></tr></tbody></table></figure>
<p>静态结构和样式 <code>layout/home.vue</code></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class="home"&gt;</span><br><span class="line">    &lt;!-- 导航条 --&gt;</span><br><span class="line">    &lt;van-nav-bar title="智慧商城" fixed /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 搜索框 --&gt;</span><br><span class="line">    &lt;van-search</span><br><span class="line">      readonly</span><br><span class="line">      shape="round"</span><br><span class="line">      background="#f1f1f2"</span><br><span class="line">      placeholder="请在此输入搜索关键词"</span><br><span class="line">      @click="$router.push('/search')"</span><br><span class="line">    /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 轮播图 --&gt;</span><br><span class="line">    &lt;van-swipe class="my-swipe" :autoplay="3000" indicator-color="white"&gt;</span><br><span class="line">      &lt;van-swipe-item&gt;</span><br><span class="line">        &lt;img src="@/assets/banner1.jpg" alt="" /&gt;</span><br><span class="line">      &lt;/van-swipe-item&gt;</span><br><span class="line">      &lt;van-swipe-item&gt;</span><br><span class="line">        &lt;img src="@/assets/banner2.jpg" alt="" /&gt;</span><br><span class="line">      &lt;/van-swipe-item&gt;</span><br><span class="line">      &lt;van-swipe-item&gt;</span><br><span class="line">        &lt;img src="@/assets/banner3.jpg" alt="" /&gt;</span><br><span class="line">      &lt;/van-swipe-item&gt;</span><br><span class="line">    &lt;/van-swipe&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 导航 --&gt;</span><br><span class="line">    &lt;van-grid column-num="5" icon-size="40"&gt;</span><br><span class="line">      &lt;van-grid-item</span><br><span class="line">        v-for="item in 10"</span><br><span class="line">        :key="item"</span><br><span class="line">        icon="http://cba.itlike.com/public/uploads/10001/20230320/58a7c1f62df4cb1eb47fe83ff0e566e6.png"</span><br><span class="line">        text="新品首发"</span><br><span class="line">        @click="$router.push('/category')"</span><br><span class="line">      /&gt;</span><br><span class="line">    &lt;/van-grid&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 主会场 --&gt;</span><br><span class="line">    &lt;div class="main"&gt;</span><br><span class="line">      &lt;img src="@/assets/main.png" alt="" /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 猜你喜欢 --&gt;</span><br><span class="line">    &lt;div class="guess"&gt;</span><br><span class="line">      &lt;p class="guess-title"&gt;—— 猜你喜欢 ——&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">      &lt;div class="goods-list"&gt;</span><br><span class="line">        &lt;GoodsItem v-for="item in 10" :key="item"&gt;&lt;/GoodsItem&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import GoodsItem from "@/components/GoodsItem.vue";</span><br><span class="line">export default {</span><br><span class="line">  name: "HomePage",</span><br><span class="line">  components: {</span><br><span class="line">    GoodsItem,</span><br><span class="line">  },</span><br><span class="line">};</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang="less" scoped&gt;</span><br><span class="line">// 主题 padding</span><br><span class="line">.home {</span><br><span class="line">  padding-top: 100px;</span><br><span class="line">  padding-bottom: 50px;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">// 导航条样式定制</span><br><span class="line">.van-nav-bar {</span><br><span class="line">  z-index: 999;</span><br><span class="line">  background-color: #c21401;</span><br><span class="line">  ::v-deep .van-nav-bar__title {</span><br><span class="line">    color: #fff;</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">// 搜索框样式定制</span><br><span class="line">.van-search {</span><br><span class="line">  position: fixed;</span><br><span class="line">  width: 100%;</span><br><span class="line">  top: 46px;</span><br><span class="line">  z-index: 999;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">// 分类导航部分</span><br><span class="line">.my-swipe .van-swipe-item {</span><br><span class="line">  height: 185px;</span><br><span class="line">  color: #fff;</span><br><span class="line">  font-size: 20px;</span><br><span class="line">  text-align: center;</span><br><span class="line">  background-color: #39a9ed;</span><br><span class="line">}</span><br><span class="line">.my-swipe .van-swipe-item img {</span><br><span class="line">  width: 100%;</span><br><span class="line">  height: 185px;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">// 主会场</span><br><span class="line">.main img {</span><br><span class="line">  display: block;</span><br><span class="line">  width: 100%;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">// 猜你喜欢</span><br><span class="line">.guess .guess-title {</span><br><span class="line">  height: 40px;</span><br><span class="line">  line-height: 40px;</span><br><span class="line">  text-align: center;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">// 商品样式</span><br><span class="line">.goods-list {</span><br><span class="line">  background-color: #f6f6f6;</span><br><span class="line">}</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></tbody></table></figure>
<p>其中将商品项封装成组件 GoodsItem.vue 在 components 包下：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class="goods-item" @click="$router.push('/prodetail')"&gt;</span><br><span class="line">    &lt;div class="left"&gt;</span><br><span class="line">      &lt;img src="@/assets/product.jpg" alt="" /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div class="right"&gt;</span><br><span class="line">      &lt;p class="tit text-ellipsis-2"&gt;</span><br><span class="line">        三星手机 SAMSUNG Galaxy S23 8GB+256GB 超视觉夜拍系统 超清夜景 悠雾紫</span><br><span class="line">        5G手机 游戏拍照旗舰机s23</span><br><span class="line">      &lt;/p&gt;</span><br><span class="line">      &lt;p class="count"&gt;已售104件&lt;/p&gt;</span><br><span class="line">      &lt;p class="price"&gt;</span><br><span class="line">        &lt;span class="new"&gt;¥3999.00&lt;/span&gt;</span><br><span class="line">        &lt;span class="old"&gt;¥6699.00&lt;/span&gt;</span><br><span class="line">      &lt;/p&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default {};</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang="less" scoped&gt;</span><br><span class="line">.goods-item {</span><br><span class="line">  height: 148px;</span><br><span class="line">  margin-bottom: 6px;</span><br><span class="line">  padding: 10px;</span><br><span class="line">  background-color: #fff;</span><br><span class="line">  display: flex;</span><br><span class="line">  .left {</span><br><span class="line">    width: 127px;</span><br><span class="line">    img {</span><br><span class="line">      display: block;</span><br><span class="line">      width: 100%;</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">  .right {</span><br><span class="line">    flex: 1;</span><br><span class="line">    font-size: 14px;</span><br><span class="line">    line-height: 1.3;</span><br><span class="line">    padding: 10px;</span><br><span class="line">    display: flex;</span><br><span class="line">    flex-direction: column;</span><br><span class="line">    justify-content: space-evenly;</span><br><span class="line"></span><br><span class="line">    .count {</span><br><span class="line">      color: #999;</span><br><span class="line">      font-size: 12px;</span><br><span class="line">    }</span><br><span class="line">    .price {</span><br><span class="line">      color: #999;</span><br><span class="line">      font-size: 16px;</span><br><span class="line">      .new {</span><br><span class="line">        color: #f03c3c;</span><br><span class="line">        margin-right: 10px;</span><br><span class="line">      }</span><br><span class="line">      .old {</span><br><span class="line">        text-decoration: line-through;</span><br><span class="line">        font-size: 12px;</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></tbody></table></figure>
<h3 id="首页-动态渲染"><a class="markdownIt-Anchor" href="#首页-动态渲染"></a> 首页 - 动态渲染</h3>
<p>根据接口文档封装请求首页数据模块于 api 包下，新建 home.js：</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">"@/utils/request"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取首页数据</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">getHomeData</span> = (<span class="params"></span>) =&gt; {</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(<span class="string">"/page/detail"</span>, {</span><br><span class="line">    <span class="attr">params</span>: {</span><br><span class="line">      <span class="attr">pageId</span>: <span class="number">0</span>,</span><br><span class="line">    },</span><br><span class="line">  });</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure>
<p>接着转到 layout 的 home.vue 处理动态渲染：</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">GoodsItem</span> <span class="keyword">from</span> <span class="string">"@/components/GoodsItem.vue"</span>;</span><br><span class="line"><span class="keyword">import</span> { getHomeData } <span class="keyword">from</span> <span class="string">"@/api/home"</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> {</span><br><span class="line">  <span class="attr">name</span>: <span class="string">"HomePage"</span>,</span><br><span class="line">  <span class="attr">components</span>: {</span><br><span class="line">    <span class="title class_">GoodsItem</span>,</span><br><span class="line">  },</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) {</span><br><span class="line">    <span class="keyword">return</span> {</span><br><span class="line">      <span class="attr">bannerList</span>: [],</span><br><span class="line">      <span class="attr">navList</span>: [],</span><br><span class="line">      <span class="attr">prodsList</span>: [],</span><br><span class="line">    };</span><br><span class="line">  },</span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">created</span>(<span class="params"></span>) {</span><br><span class="line">    <span class="keyword">const</span> {</span><br><span class="line">      <span class="attr">data</span>: { pageData },</span><br><span class="line">    } = <span class="keyword">await</span> <span class="title function_">getHomeData</span>();</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(pageData);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">bannerList</span> = pageData.<span class="property">items</span>[<span class="number">1</span>].<span class="property">data</span>; <span class="comment">// 获取轮播图数据</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">navList</span> = pageData.<span class="property">items</span>[<span class="number">3</span>].<span class="property">data</span>; <span class="comment">// 获取导航组数据</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">prodsList</span> = pageData.<span class="property">items</span>[<span class="number">6</span>].<span class="property">data</span>; <span class="comment">// 获取商品组数据</span></span><br><span class="line">  },</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure>
<p>改造 template 中轮播图和导航部分：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 轮播图 --&gt;</span><br><span class="line">&lt;van-swipe class="my-swipe" :autoplay="3000" indicator-color="white"&gt;</span><br><span class="line">      &lt;van-swipe-item v-for="item in bannerList" :key="item.imgUrl"&gt;</span><br><span class="line">        &lt;img :src="item.imgUrl" alt=""&gt;</span><br><span class="line">      &lt;/van-swipe-item&gt;</span><br><span class="line">    &lt;/van-swipe&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 导航 --&gt;</span><br><span class="line">&lt;van-grid column-num="5" icon-size="40"&gt;</span><br><span class="line">      &lt;van-grid-item</span><br><span class="line">        v-for="item in navList" :key="item.imgUrl"</span><br><span class="line">        :icon="item.imgUrl"</span><br><span class="line">        :text="item.text"</span><br><span class="line">        @click="$router.push('/category')"</span><br><span class="line">      /&gt;</span><br><span class="line">    &lt;/van-grid&gt;</span><br></pre></td></tr></tbody></table></figure>
<p>接着改造商品组：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 猜你喜欢 --&gt;</span><br><span class="line">    &lt;div class="guess"&gt;</span><br><span class="line">      &lt;p class="guess-title"&gt;—— 猜你喜欢 ——&lt;/p&gt;</span><br><span class="line">      &lt;div class="goods-list"&gt;</span><br><span class="line">        &lt;GoodsItem v-for="item in prodsList" :key="item.goods_id" :goods="item"&gt;&lt;/GoodsItem&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br></pre></td></tr></tbody></table></figure>
<p>父传子将 item 整个对象传给 GoodsItem 进行接收：</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> {</span><br><span class="line">  <span class="attr">name</span>: <span class="string">'GoodsItem'</span>,</span><br><span class="line">  <span class="attr">props</span>: {</span><br><span class="line">    <span class="attr">goods</span>: {</span><br><span class="line">      <span class="attr">type</span>: <span class="title class_">Object</span>,</span><br><span class="line">      <span class="attr">default</span>: <span class="function">() =&gt;</span> {</span><br><span class="line">        <span class="keyword">return</span> {}</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  <span class="title function_">data</span> () {</span><br><span class="line">    <span class="keyword">return</span> {</span><br><span class="line">    }</span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure>
<p>然后改造 template</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;div</span><br><span class="line">  class="goods-item"</span><br><span class="line">  v-if="goods.goods_id"</span><br><span class="line">  @click="$router.push(`/prodetail/${goods.goods_id}`)"</span><br><span class="line">&gt;</span><br><span class="line">    &lt;div class="left"&gt;</span><br><span class="line">      &lt;img :src="goods.goods_image" alt="" /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;div class="right"&gt;</span><br><span class="line">      &lt;p class="tit text-ellipsis-2"&gt;</span><br><span class="line">        {{ goods.goods_name }}</span><br><span class="line">      &lt;/p&gt;</span><br><span class="line">      &lt;p class="count"&gt;{{goods.goods_sales}}&lt;/p&gt;</span><br><span class="line">      &lt;p class="price"&gt;</span><br><span class="line">        &lt;span class="new"&gt;{{goods.goods_price_min}}&lt;/span&gt;</span><br><span class="line">        &lt;span class="old"&gt;{{goods.goods_price_max}}&lt;/span&gt;</span><br><span class="line">      &lt;/p&gt;</span><br><span class="line">    &lt;/div&gt;</span><br></pre></td></tr></tbody></table></figure>
<p>注意将商品 id 携带进行跳转时要动态取值使用反引号。</p>
<h2 id="搜索"><a class="markdownIt-Anchor" href="#搜索"></a> 搜索</h2>
<p>页面设计：</p>
<p><img src= "/img/loading/loading.gif" onerror="this.onerror=null,this.src=&quot;/img/avatar/emo.webp&quot;" data-lazy-src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202408292021783.png" alt="image-20230621144449700"></p>
<h3 id="搜索页静态结构"><a class="markdownIt-Anchor" href="#搜索页静态结构"></a> 搜索页静态结构</h3>
<p><code>view/search/index.vue</code>（需要导入 vant 组件 Icon）</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class="search"&gt;</span><br><span class="line">    &lt;van-nav-bar title="商品搜索" left-arrow @click-left="$router.go(-1)" /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;van-search show-action placeholder="请输入搜索关键词" clearable&gt;</span><br><span class="line">      &lt;template #action&gt;</span><br><span class="line">        &lt;div&gt;搜索&lt;/div&gt;</span><br><span class="line">      &lt;/template&gt;</span><br><span class="line">    &lt;/van-search&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 搜索历史 --&gt;</span><br><span class="line">    &lt;div class="search-history" v-if="historyList.length &gt; 0"&gt;</span><br><span class="line">      &lt;div class="title"&gt;</span><br><span class="line">        &lt;span&gt;最近搜索&lt;/span&gt;</span><br><span class="line">        &lt;van-icon name="delete-o" size="16" /&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;div class="list"&gt;</span><br><span class="line">        &lt;div</span><br><span class="line">          class="list-item"</span><br><span class="line">          v-for="item in historyList"</span><br><span class="line">          :key="item"</span><br><span class="line">          @click="$router.push('/searchlist')"</span><br><span class="line">        &gt;</span><br><span class="line">          {{ item }}</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default {</span><br><span class="line">  name: "SearchIndex",</span><br><span class="line">  data() {</span><br><span class="line">    return {</span><br><span class="line">      historyList: ["炒锅", "电视", "冰箱", "手机", "自行车"],</span><br><span class="line">    };</span><br><span class="line">  },</span><br><span class="line">};</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang="less" scoped&gt;</span><br><span class="line">.search {</span><br><span class="line">  .searchBtn {</span><br><span class="line">    background-color: #fa2209;</span><br><span class="line">    color: #fff;</span><br><span class="line">  }</span><br><span class="line">  ::v-deep .van-search__action {</span><br><span class="line">    background-color: #c21401;</span><br><span class="line">    color: #fff;</span><br><span class="line">    padding: 0 20px;</span><br><span class="line">    border-radius: 0 5px 5px 0;</span><br><span class="line">    margin-right: 10px;</span><br><span class="line">  }</span><br><span class="line">  ::v-deep .van-icon-arrow-left {</span><br><span class="line">    color: #333;</span><br><span class="line">  }</span><br><span class="line">  .title {</span><br><span class="line">    height: 40px;</span><br><span class="line">    line-height: 40px;</span><br><span class="line">    font-size: 14px;</span><br><span class="line">    display: flex;</span><br><span class="line">    justify-content: space-between;</span><br><span class="line">    align-items: center;</span><br><span class="line">    padding: 0 15px;</span><br><span class="line">  }</span><br><span class="line">  .list {</span><br><span class="line">    display: flex;</span><br><span class="line">    justify-content: flex-start;</span><br><span class="line">    flex-wrap: wrap;</span><br><span class="line">    padding: 0 10px;</span><br><span class="line">    gap: 5%;</span><br><span class="line">  }</span><br><span class="line">  .list-item {</span><br><span class="line">    width: 25%;</span><br><span class="line">    text-align: center;</span><br><span class="line">    padding: 7px;</span><br><span class="line">    line-height: 15px;</span><br><span class="line">    border-radius: 50px;</span><br><span class="line">    background: #fff;</span><br><span class="line">    font-size: 13px;</span><br><span class="line">    border: 1px solid #efefef;</span><br><span class="line">    overflow: hidden;</span><br><span class="line">    white-space: nowrap;</span><br><span class="line">    text-overflow: ellipsis;</span><br><span class="line">    margin-bottom: 10px;</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></tbody></table></figure>
<h3 id="历史记录管理"><a class="markdownIt-Anchor" href="#历史记录管理"></a> 历史记录管理</h3>
<p>目标：构建搜索页的静态布局，完成历史记录的管理<br>
需求分析：</p>
<ol>
<li>搜索历史基本渲染</li>
<li>点击搜索 (添加历史)</li>
</ol>
<p>添加历史说明：</p>
<p>点击搜索按钮或底下历史记录，都能进行搜索</p>
<ol>
<li>若之前没有相同搜索关键字，则直接追加到最前面</li>
<li>若之前已有相同搜索关键字，将该原有关键字移除，再追加（相当于置顶）</li>
</ol>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class="search"&gt;</span><br><span class="line">    &lt;van-nav-bar title="商品搜索" left-arrow @click-left="$router.go(-1)" /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;van-search</span><br><span class="line">      v-model="search"</span><br><span class="line">      @search="goSearch(search)"</span><br><span class="line">      show-action</span><br><span class="line">      placeholder="请输入搜索关键词"</span><br><span class="line">      clearable</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;template #action&gt;</span><br><span class="line">        &lt;div @click="goSearch(search)"&gt;搜索&lt;/div&gt;</span><br><span class="line">      &lt;/template&gt;</span><br><span class="line">    &lt;/van-search&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 搜索历史 --&gt;</span><br><span class="line">    &lt;div class="search-history" v-if="historyList.length &gt; 0"&gt;</span><br><span class="line">      &lt;div class="title"&gt;</span><br><span class="line">        &lt;span&gt;最近搜索&lt;/span&gt;</span><br><span class="line">        &lt;van-icon name="delete-o" @click="clearHistory" size="16" /&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;div class="list"&gt;</span><br><span class="line">        &lt;div</span><br><span class="line">          class="list-item"</span><br><span class="line">          v-for="item in historyList"</span><br><span class="line">          :key="item"</span><br><span class="line">          @click="goSearch(item)"</span><br><span class="line">        &gt;</span><br><span class="line">          {{ item }}</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import { getHistory, setHistory } from "@/utils/storage";</span><br><span class="line"></span><br><span class="line">export default {</span><br><span class="line">  name: "SearchIndex",</span><br><span class="line">  data() {</span><br><span class="line">    return {</span><br><span class="line">      search: "",</span><br><span class="line">      historyList: getHistory(),</span><br><span class="line">    };</span><br><span class="line">  },</span><br><span class="line">  methods: {</span><br><span class="line">    goSearch(searchContent) {</span><br><span class="line">      // 判断输入的搜索词是否已经在historyList中</span><br><span class="line">      const index = this.historyList.indexOf(searchContent);</span><br><span class="line">      if (index !== -1) {</span><br><span class="line">        // 说明存在，则将其进行删除</span><br><span class="line">        this.historyList.splice(index, 1); // splice语法：splice(index, howMany, item1, ....., itemX)</span><br><span class="line">      }</span><br><span class="line">      // 将搜索词添加到historyList的最前面</span><br><span class="line">      this.historyList.unshift(searchContent);</span><br><span class="line">      setHistory(this.historyList);</span><br><span class="line">      // 跳转到搜索列表页面</span><br><span class="line">      this.$router.push(`/searchlist?search=${searchContent}`);</span><br><span class="line">    },</span><br><span class="line">    clearHistory() {</span><br><span class="line">      this.historyList = [];</span><br><span class="line">      setHistory([]);</span><br><span class="line">    },</span><br><span class="line">  },</span><br><span class="line">};</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">...</span><br></pre></td></tr></tbody></table></figure>
<p>持久化存储代码：</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="variable constant_">HISTORY_KEY</span> = <span class="string">"shopping_history_info"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取搜索历史</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">getHistory</span> = (<span class="params"></span>) =&gt; {</span><br><span class="line">  <span class="keyword">const</span> history = <span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="variable constant_">HISTORY_KEY</span>);</span><br><span class="line">  <span class="keyword">return</span> history ? <span class="title class_">JSON</span>.<span class="title function_">parse</span>(history) : [];</span><br><span class="line">};</span><br><span class="line"><span class="comment">// 设置搜索历史</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">setHistory</span> = (<span class="params">arr</span>) =&gt; {</span><br><span class="line">  <span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(<span class="variable constant_">HISTORY_KEY</span>, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(arr));</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure>
<h3 id="搜索列表页"><a class="markdownIt-Anchor" href="#搜索列表页"></a> 搜索列表页</h3>
<h4 id="静态布局"><a class="markdownIt-Anchor" href="#静态布局"></a> 静态布局</h4>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class="search"&gt;</span><br><span class="line">    &lt;van-nav-bar</span><br><span class="line">      fixed</span><br><span class="line">      title="商品列表"</span><br><span class="line">      left-arrow</span><br><span class="line">      @click-left="$router.go(-1)"</span><br><span class="line">    /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;van-search</span><br><span class="line">      readonly</span><br><span class="line">      shape="round"</span><br><span class="line">      background="#ffffff"</span><br><span class="line">      value="手机"</span><br><span class="line">      show-action</span><br><span class="line">      @click="$router.push('/search')"</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;template #action&gt;</span><br><span class="line">        &lt;van-icon class="tool" name="apps-o" /&gt;</span><br><span class="line">      &lt;/template&gt;</span><br><span class="line">    &lt;/van-search&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 排序选项按钮 --&gt;</span><br><span class="line">    &lt;div class="sort-btns"&gt;</span><br><span class="line">      &lt;div class="sort-item"&gt;综合&lt;/div&gt;</span><br><span class="line">      &lt;div class="sort-item"&gt;销量&lt;/div&gt;</span><br><span class="line">      &lt;div class="sort-item"&gt;价格&lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;div class="goods-list"&gt;</span><br><span class="line">      &lt;GoodsItem v-for="item in 10" :key="item"&gt;&lt;/GoodsItem&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import GoodsItem from "@/components/GoodsItem.vue";</span><br><span class="line">export default {</span><br><span class="line">  name: "SearchIndex",</span><br><span class="line">  components: {</span><br><span class="line">    GoodsItem,</span><br><span class="line">  },</span><br><span class="line">};</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang="less" scoped&gt;</span><br><span class="line">.search {</span><br><span class="line">  padding-top: 46px;</span><br><span class="line">  ::v-deep .van-icon-arrow-left {</span><br><span class="line">    color: #333;</span><br><span class="line">  }</span><br><span class="line">  .tool {</span><br><span class="line">    font-size: 24px;</span><br><span class="line">    height: 40px;</span><br><span class="line">    line-height: 40px;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  .sort-btns {</span><br><span class="line">    display: flex;</span><br><span class="line">    height: 36px;</span><br><span class="line">    line-height: 36px;</span><br><span class="line">    .sort-item {</span><br><span class="line">      text-align: center;</span><br><span class="line">      flex: 1;</span><br><span class="line">      font-size: 16px;</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">// 商品样式</span><br><span class="line">.goods-list {</span><br><span class="line">  background-color: #f6f6f6;</span><br><span class="line">}</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></tbody></table></figure>
<h4 id="渲染"><a class="markdownIt-Anchor" href="#渲染"></a> 渲染</h4>
<p>封装请求获取商品列表 <code>api/product.js</code></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">"../utils/request"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">getProducts</span> = (<span class="params">obj</span>) =&gt; {</span><br><span class="line">  <span class="keyword">const</span> { sortType, sortPrice, categoryId, goodsName, page } = obj;</span><br><span class="line">  <span class="keyword">return</span> request.<span class="title function_">get</span>(<span class="string">"/goods/list"</span>, {</span><br><span class="line">    <span class="attr">params</span>: {</span><br><span class="line">      <span class="comment">// all-按综合搜索(默认)，sales-按销量，price-按价格</span></span><br><span class="line">      sortType,</span><br><span class="line">      <span class="comment">// 0-价格从低到高，1-价格从高到低</span></span><br><span class="line">      sortPrice,</span><br><span class="line">      <span class="comment">// 分类id，示例值：0</span></span><br><span class="line">      categoryId,</span><br><span class="line">      <span class="comment">// 商品名称，示例值：酒</span></span><br><span class="line">      goodsName,</span><br><span class="line">      <span class="comment">// 页码，示例值：1</span></span><br><span class="line">      page,</span><br><span class="line">    },</span><br><span class="line">  });</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure>
<p>基于搜索词进行渲染</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class="search"&gt;</span><br><span class="line">    &lt;van-nav-bar</span><br><span class="line">      fixed</span><br><span class="line">      title="商品列表"</span><br><span class="line">      left-arrow</span><br><span class="line">      @click-left="$router.go(-1)"</span><br><span class="line">    /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;van-search</span><br><span class="line">      readonly</span><br><span class="line">      shape="round"</span><br><span class="line">      background="#ffffff"</span><br><span class="line">      :value="queryParam"</span><br><span class="line">      show-action</span><br><span class="line">      @click="$router.push('/search')"</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;template #action&gt;</span><br><span class="line">        &lt;van-icon class="tool" name="apps-o" /&gt;</span><br><span class="line">      &lt;/template&gt;</span><br><span class="line">    &lt;/van-search&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 排序选项按钮 --&gt;</span><br><span class="line">    &lt;div class="sort-btns"&gt;</span><br><span class="line">      &lt;div</span><br><span class="line">        class="sort-item"</span><br><span class="line">        :class="{ active: currentSortType === 'all' }"</span><br><span class="line">        @click="sortGoods('all')"</span><br><span class="line">      &gt;</span><br><span class="line">        综合</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;div</span><br><span class="line">        class="sort-item"</span><br><span class="line">        :class="{ active: currentSortType === 'sales' }"</span><br><span class="line">        @click="sortGoods('sales')"</span><br><span class="line">      &gt;</span><br><span class="line">        销量</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;div</span><br><span class="line">        class="sort-item"</span><br><span class="line">        :class="{ active: currentSortType === 'price' }"</span><br><span class="line">        @click="sortGoods('price')"</span><br><span class="line">      &gt;</span><br><span class="line">        价格</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;div class="goods-list"&gt;</span><br><span class="line">      &lt;GoodsItem</span><br><span class="line">        v-for="item in productList"</span><br><span class="line">        :key="item.goods_id"</span><br><span class="line">        :goods="item"</span><br><span class="line">      &gt;&lt;/GoodsItem&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import GoodsItem from "@/components/GoodsItem.vue";</span><br><span class="line">import { getProducts } from "@/api/product";</span><br><span class="line">export default {</span><br><span class="line">  name: "SearchIndex",</span><br><span class="line">  components: {</span><br><span class="line">    GoodsItem,</span><br><span class="line">  },</span><br><span class="line">  computed: {</span><br><span class="line">    // 从router的query中拿到查询参数</span><br><span class="line">    queryParam() {</span><br><span class="line">      // console.log(this.$route.query.search)</span><br><span class="line">      // 如果查询参数不存在就返回一个空字符串</span><br><span class="line">      return this.$route.query.search || "";</span><br><span class="line">    },</span><br><span class="line">  },</span><br><span class="line">  async created() {</span><br><span class="line">    // 获取商品列表数据</span><br><span class="line">    const res = await getProducts({</span><br><span class="line">      goodsName: this.queryParam,</span><br><span class="line">      // page: this.page</span><br><span class="line">    });</span><br><span class="line">    this.productList = res.data.list.data;</span><br><span class="line">    console.log(res.data.list);</span><br><span class="line">  },</span><br><span class="line">  data() {</span><br><span class="line">    return {</span><br><span class="line">      currentSortType: "all",</span><br><span class="line">      productList: [],</span><br><span class="line">      page: 1,</span><br><span class="line">    };</span><br><span class="line">  },</span><br><span class="line">  methods: {</span><br><span class="line">    // 排序商品</span><br><span class="line">    async sortGoods(sortType) {</span><br><span class="line">      // console.log(sortType)</span><br><span class="line">      this.currentSortType = sortType; // 更新当前选中的排序类型</span><br><span class="line">      const res = await getProducts({</span><br><span class="line">        goodsName: this.queryParam,</span><br><span class="line">        sortType: sortType,</span><br><span class="line">      });</span><br><span class="line">      this.productList = res.data.list.data;</span><br><span class="line">    },</span><br><span class="line">  },</span><br><span class="line">};</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang="less" scoped&gt;</span><br><span class="line">.search {</span><br><span class="line">  padding-top: 46px;</span><br><span class="line">  ::v-deep .van-icon-arrow-left {</span><br><span class="line">    color: #333;</span><br><span class="line">  }</span><br><span class="line">  .tool {</span><br><span class="line">    font-size: 24px;</span><br><span class="line">    height: 40px;</span><br><span class="line">    line-height: 40px;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  .sort-btns {</span><br><span class="line">    display: flex;</span><br><span class="line">    height: 36px;</span><br><span class="line">    line-height: 36px;</span><br><span class="line">    .sort-item {</span><br><span class="line">      text-align: center;</span><br><span class="line">      flex: 1;</span><br><span class="line">      font-size: 16px;</span><br><span class="line">    }</span><br><span class="line">    .active {</span><br><span class="line">      color: #ee0a24;</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">// 商品样式</span><br><span class="line">.goods-list {</span><br><span class="line">  background-color: #f6f6f6;</span><br><span class="line">}</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></tbody></table></figure>
<h4 id="基于分类页面的分类-id-进行渲染"><a class="markdownIt-Anchor" href="#基于分类页面的分类-id-进行渲染"></a> 基于分类页面的分类 id 进行渲染</h4>
<p>封装请求分类页数据 <code>api/category.js</code></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">"@/utils/request"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取分类页数据</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">getCategoryData</span> = (<span class="params"></span>) =&gt; {</span><br><span class="line">  <span class="keyword">return</span> request.<span class="title function_">get</span>(<span class="string">"/category/list"</span>);</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure>
<p>完成分类页静态结构</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class="category"&gt;</span><br><span class="line">    &lt;!-- 分类 --&gt;</span><br><span class="line">    &lt;van-nav-bar title="全部分类" fixed /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 搜索框 --&gt;</span><br><span class="line">    &lt;van-search</span><br><span class="line">      readonly</span><br><span class="line">      shape="round"</span><br><span class="line">      background="#f1f1f2"</span><br><span class="line">      placeholder="请输入搜索关键词"</span><br><span class="line">      @click="$router.push('/search')"</span><br><span class="line">    /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 分类列表 --&gt;</span><br><span class="line">    &lt;div class="list-box"&gt;</span><br><span class="line">      &lt;div class="left"&gt;</span><br><span class="line">        &lt;van-sidebar v-model="activeKey"&gt;</span><br><span class="line">          &lt;van-sidebar-item</span><br><span class="line">            v-for="(item, index) in list"</span><br><span class="line">            :key="item.category_id"</span><br><span class="line">            :title="item.name"</span><br><span class="line">            :class="{ active: index === activeKey }"</span><br><span class="line">            @click="activeKey = index"</span><br><span class="line">            href="javascript:;"</span><br><span class="line">          /&gt;</span><br><span class="line">        &lt;/van-sidebar&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;div class="right"&gt;</span><br><span class="line">        &lt;div</span><br><span class="line">          @click="$router.push(`/searchlist?categoryId=${item.category_id}`)"</span><br><span class="line">          v-for="item in list[activeKey]?.children"</span><br><span class="line">          :key="item.category_id"</span><br><span class="line">          class="cate-goods"</span><br><span class="line">        &gt;</span><br><span class="line">          &lt;img :src="item.image?.external_url" alt="" /&gt;</span><br><span class="line">          &lt;p&gt;{{ item.name }}&lt;/p&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import { getCategoryData } from "@/api/category";</span><br><span class="line">export default {</span><br><span class="line">  name: "CategoryPage",</span><br><span class="line">  created() {</span><br><span class="line">    this.getCategoryList();</span><br><span class="line">  },</span><br><span class="line">  data() {</span><br><span class="line">    return {</span><br><span class="line">      activeKey: 0,</span><br><span class="line">      list: [],</span><br><span class="line">      activeIndex: 0,</span><br><span class="line">    };</span><br><span class="line">  },</span><br><span class="line">  methods: {</span><br><span class="line">    async getCategoryList() {</span><br><span class="line">      const {</span><br><span class="line">        data: { list },</span><br><span class="line">      } = await getCategoryData();</span><br><span class="line">      this.list = list;</span><br><span class="line">      // console.log(this.list)</span><br><span class="line">    },</span><br><span class="line">  },</span><br><span class="line">};</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang="less" scoped&gt;</span><br><span class="line">// 主题 padding</span><br><span class="line">.category {</span><br><span class="line">  padding-top: 100px;</span><br><span class="line">  padding-bottom: 50px;</span><br><span class="line">  height: 100vh;</span><br><span class="line">  .list-box {</span><br><span class="line">    height: 100%;</span><br><span class="line">    display: flex;</span><br><span class="line">    .left {</span><br><span class="line">      width: 85px;</span><br><span class="line">      height: 100%;</span><br><span class="line">      background-color: #f3f3f3;</span><br><span class="line">      overflow: auto;</span><br><span class="line">      van-sidebar-item {</span><br><span class="line">        display: block;</span><br><span class="line">        height: 45px;</span><br><span class="line">        line-height: 45px;</span><br><span class="line">        text-align: center;</span><br><span class="line">        color: #444444;</span><br><span class="line">        font-size: 12px;</span><br><span class="line">        &amp;.active {</span><br><span class="line">          color: #fb442f;</span><br><span class="line">          background-color: #fff;</span><br><span class="line">        }</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">    .right {</span><br><span class="line">      flex: 1;</span><br><span class="line">      height: 100%;</span><br><span class="line">      background-color: #ffffff;</span><br><span class="line">      display: flex;</span><br><span class="line">      flex-wrap: wrap;</span><br><span class="line">      justify-content: flex-start;</span><br><span class="line">      align-content: flex-start;</span><br><span class="line">      padding: 10px 0;</span><br><span class="line">      overflow: auto;</span><br><span class="line"></span><br><span class="line">      .cate-goods {</span><br><span class="line">        width: 33.3%;</span><br><span class="line">        margin-bottom: 10px;</span><br><span class="line">        img {</span><br><span class="line">          width: 70px;</span><br><span class="line">          height: 70px;</span><br><span class="line">          display: block;</span><br><span class="line">          margin: 5px auto;</span><br><span class="line">        }</span><br><span class="line">        p {</span><br><span class="line">          text-align: center;</span><br><span class="line">          font-size: 12px;</span><br><span class="line">        }</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">// 导航条样式定制</span><br><span class="line">.van-nav-bar {</span><br><span class="line">  z-index: 999;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">// 搜索框样式定制</span><br><span class="line">.van-search {</span><br><span class="line">  position: fixed;</span><br><span class="line">  width: 100%;</span><br><span class="line">  top: 46px;</span><br><span class="line">  z-index: 999;</span><br><span class="line">}</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></tbody></table></figure>
<p>修改搜索页列表的查询参数</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">GoodsItem</span> <span class="keyword">from</span> <span class="string">'@/components/GoodsItem.vue'</span></span><br><span class="line"><span class="keyword">import</span> { getProducts } <span class="keyword">from</span> <span class="string">'@/api/product'</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> {</span><br><span class="line">  <span class="attr">name</span>: <span class="string">'SearchIndex'</span>,</span><br><span class="line">  <span class="attr">components</span>: {</span><br><span class="line">    <span class="title class_">GoodsItem</span></span><br><span class="line">  },</span><br><span class="line">  <span class="attr">computed</span>: {</span><br><span class="line">    <span class="comment">// 从router的query中拿到查询参数</span></span><br><span class="line">    <span class="title function_">querySearch</span> () {</span><br><span class="line">      <span class="comment">// console.log(this.$route.query.search)</span></span><br><span class="line">      <span class="comment">// 如果查询参数不存在就返回一个空字符串</span></span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">$route</span>.<span class="property">query</span>.<span class="property">search</span> || <span class="string">''</span></span><br><span class="line">    },</span><br><span class="line">    <span class="title function_">queryCategory</span> () {</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">$route</span>.<span class="property">query</span>.<span class="property">categoryId</span> || <span class="string">''</span></span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">created</span> () {</span><br><span class="line">    <span class="comment">// 获取商品列表数据</span></span><br><span class="line">    <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">getProducts</span>({</span><br><span class="line">      <span class="attr">categoryId</span>: <span class="variable language_">this</span>.<span class="property">queryCategory</span>,</span><br><span class="line">      <span class="attr">goodsName</span>: <span class="variable language_">this</span>.<span class="property">querySearch</span></span><br><span class="line">      <span class="comment">// page: this.page</span></span><br><span class="line">    })</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">productList</span> = res.<span class="property">data</span>.<span class="property">list</span>.<span class="property">data</span></span><br><span class="line">    <span class="comment">// console.log(res.data.list)</span></span><br><span class="line">    <span class="comment">// console.log(this.querySearch)</span></span><br><span class="line">  },</span><br><span class="line">  <span class="title function_">data</span> () {</span><br><span class="line">    <span class="keyword">return</span> {</span><br><span class="line">      <span class="attr">currentSortType</span>: <span class="string">'all'</span>,</span><br><span class="line">      <span class="attr">productList</span>: [],</span><br><span class="line">      <span class="attr">page</span>: <span class="number">1</span></span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  <span class="attr">methods</span>: {</span><br><span class="line">    <span class="comment">// 排序商品</span></span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">sortGoods</span> (sortType) {</span><br><span class="line">      <span class="comment">// console.log(sortType)</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">currentSortType</span> = sortType <span class="comment">// 更新当前选中的排序类型</span></span><br><span class="line">      <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">getProducts</span>({</span><br><span class="line">        <span class="attr">categoryId</span>: <span class="variable language_">this</span>.<span class="property">queryCategory</span>,</span><br><span class="line">        <span class="attr">goodsName</span>: <span class="variable language_">this</span>.<span class="property">querySearch</span>,</span><br><span class="line">        <span class="attr">sortType</span>: sortType</span><br><span class="line">      })</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">productList</span> = res.<span class="property">data</span>.<span class="property">list</span>.<span class="property">data</span></span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></tbody></table></figure>
<h2 id="商品详情页"><a class="markdownIt-Anchor" href="#商品详情页"></a> 商品详情页</h2>
<h3 id="静态结构"><a class="markdownIt-Anchor" href="#静态结构"></a> 静态结构</h3>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class="prodetail"&gt;</span><br><span class="line">    &lt;van-nav-bar</span><br><span class="line">      fixed</span><br><span class="line">      title="商品详情页"</span><br><span class="line">      left-arrow</span><br><span class="line">      @click-left="$router.go(-1)"</span><br><span class="line">    /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;van-swipe :autoplay="3000" @change="onChange"&gt;</span><br><span class="line">      &lt;van-swipe-item v-for="(image, index) in images" :key="index"&gt;</span><br><span class="line">        &lt;img :src="image" /&gt;</span><br><span class="line">      &lt;/van-swipe-item&gt;</span><br><span class="line"></span><br><span class="line">      &lt;template #indicator&gt;</span><br><span class="line">        &lt;div class="custom-indicator"&gt;</span><br><span class="line">          {{ current + 1 }} / {{ images.length }}</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/template&gt;</span><br><span class="line">    &lt;/van-swipe&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 商品说明 --&gt;</span><br><span class="line">    &lt;div class="info"&gt;</span><br><span class="line">      &lt;div class="title"&gt;</span><br><span class="line">        &lt;div class="price"&gt;</span><br><span class="line">          &lt;span class="now"&gt;￥0.01&lt;/span&gt;</span><br><span class="line">          &lt;span class="oldprice"&gt;￥6699.00&lt;/span&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div class="sellcount"&gt;已售1001件&lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;div class="msg text-ellipsis-2"&gt;</span><br><span class="line">        三星手机 SAMSUNG Galaxy S23 8GB+256GB 超视觉夜拍系统 超清夜景 悠雾紫</span><br><span class="line">        5G手机 游戏拍照旗舰机s23</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">      &lt;div class="service"&gt;</span><br><span class="line">        &lt;div class="left-words"&gt;</span><br><span class="line">          &lt;span&gt;&lt;van-icon name="passed" /&gt;七天无理由退货&lt;/span&gt;</span><br><span class="line">          &lt;span&gt;&lt;van-icon name="passed" /&gt;48小时发货&lt;/span&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div class="right-icon"&gt;</span><br><span class="line">          &lt;van-icon name="arrow" /&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 商品评价 --&gt;</span><br><span class="line">    &lt;div class="comment"&gt;</span><br><span class="line">      &lt;div class="comment-title"&gt;</span><br><span class="line">        &lt;div class="left"&gt;商品评价 (5条)&lt;/div&gt;</span><br><span class="line">        &lt;div class="right"&gt;查看更多 &lt;van-icon name="arrow" /&gt;&lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;div class="comment-list"&gt;</span><br><span class="line">        &lt;div class="comment-item" v-for="item in 3" :key="item"&gt;</span><br><span class="line">          &lt;div class="top"&gt;</span><br><span class="line">            &lt;img</span><br><span class="line">              src="http://cba.itlike.com/public/uploads/10001/20230321/a0db9adb2e666a65bc8dd133fbed7834.png"</span><br><span class="line">              alt=""</span><br><span class="line">            /&gt;</span><br><span class="line">            &lt;div class="name"&gt;神雕大侠&lt;/div&gt;</span><br><span class="line">            &lt;van-rate</span><br><span class="line">              :size="16"</span><br><span class="line">              :value="5"</span><br><span class="line">              color="#ffd21e"</span><br><span class="line">              void-icon="star"</span><br><span class="line">              void-color="#eee"</span><br><span class="line">            /&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">          &lt;div class="content"&gt;质量很不错 挺喜欢的&lt;/div&gt;</span><br><span class="line">          &lt;div class="time"&gt;2023-03-21 15:01:35&lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 商品描述 --&gt;</span><br><span class="line">    &lt;div class="desc"&gt;</span><br><span class="line">      &lt;img</span><br><span class="line">        src="https://uimgproxy.suning.cn/uimg1/sop/commodity/kHgx21fZMWwqirkMhawkAw.jpg"</span><br><span class="line">        alt=""</span><br><span class="line">      /&gt;</span><br><span class="line">      &lt;img</span><br><span class="line">        src="https://uimgproxy.suning.cn/uimg1/sop/commodity/0rRMmncfF0kGjuK5cvLolg.jpg"</span><br><span class="line">        alt=""</span><br><span class="line">      /&gt;</span><br><span class="line">      &lt;img</span><br><span class="line">        src="https://uimgproxy.suning.cn/uimg1/sop/commodity/2P04A4Jn0HKxbKYSHc17kw.jpg"</span><br><span class="line">        alt=""</span><br><span class="line">      /&gt;</span><br><span class="line">      &lt;img</span><br><span class="line">        src="https://uimgproxy.suning.cn/uimg1/sop/commodity/MT4k-mPd0veQXWPPO5yTIw.jpg"</span><br><span class="line">        alt=""</span><br><span class="line">      /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 底部 --&gt;</span><br><span class="line">    &lt;div class="footer"&gt;</span><br><span class="line">      &lt;div class="icon-home"&gt;</span><br><span class="line">        &lt;van-icon name="wap-home-o" /&gt;</span><br><span class="line">        &lt;span&gt;首页&lt;/span&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;div class="icon-cart"&gt;</span><br><span class="line">        &lt;van-icon name="shopping-cart-o" /&gt;</span><br><span class="line">        &lt;span&gt;购物车&lt;/span&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;div class="btn-add"&gt;加入购物车&lt;/div&gt;</span><br><span class="line">      &lt;div class="btn-buy"&gt;立刻购买&lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default {</span><br><span class="line">  name: "ProDetail",</span><br><span class="line">  data() {</span><br><span class="line">    return {</span><br><span class="line">      images: [</span><br><span class="line">        "https://img01.yzcdn.cn/vant/apple-1.jpg",</span><br><span class="line">        "https://img01.yzcdn.cn/vant/apple-2.jpg",</span><br><span class="line">      ],</span><br><span class="line">      current: 0,</span><br><span class="line">    };</span><br><span class="line">  },</span><br><span class="line">  methods: {</span><br><span class="line">    onChange(index) {</span><br><span class="line">      this.current = index;</span><br><span class="line">    },</span><br><span class="line">  },</span><br><span class="line">};</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang="less" scoped&gt;</span><br><span class="line">.prodetail {</span><br><span class="line">  padding-top: 46px;</span><br><span class="line">  ::v-deep .van-icon-arrow-left {</span><br><span class="line">    color: #333;</span><br><span class="line">  }</span><br><span class="line">  img {</span><br><span class="line">    display: block;</span><br><span class="line">    width: 100%;</span><br><span class="line">  }</span><br><span class="line">  .custom-indicator {</span><br><span class="line">    position: absolute;</span><br><span class="line">    right: 10px;</span><br><span class="line">    bottom: 10px;</span><br><span class="line">    padding: 5px 10px;</span><br><span class="line">    font-size: 12px;</span><br><span class="line">    background: rgba(0, 0, 0, 0.1);</span><br><span class="line">    border-radius: 15px;</span><br><span class="line">  }</span><br><span class="line">  .desc {</span><br><span class="line">    width: 100%;</span><br><span class="line">    overflow: scroll;</span><br><span class="line">    ::v-deep img {</span><br><span class="line">      display: block;</span><br><span class="line">      width: 100% !important;</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">  .info {</span><br><span class="line">    padding: 10px;</span><br><span class="line">  }</span><br><span class="line">  .title {</span><br><span class="line">    display: flex;</span><br><span class="line">    justify-content: space-between;</span><br><span class="line">    .now {</span><br><span class="line">      color: #fa2209;</span><br><span class="line">      font-size: 20px;</span><br><span class="line">    }</span><br><span class="line">    .oldprice {</span><br><span class="line">      color: #959595;</span><br><span class="line">      font-size: 16px;</span><br><span class="line">      text-decoration: line-through;</span><br><span class="line">      margin-left: 5px;</span><br><span class="line">    }</span><br><span class="line">    .sellcount {</span><br><span class="line">      color: #959595;</span><br><span class="line">      font-size: 16px;</span><br><span class="line">      position: relative;</span><br><span class="line">      top: 4px;</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">  .msg {</span><br><span class="line">    font-size: 16px;</span><br><span class="line">    line-height: 24px;</span><br><span class="line">    margin-top: 5px;</span><br><span class="line">  }</span><br><span class="line">  .service {</span><br><span class="line">    display: flex;</span><br><span class="line">    justify-content: space-between;</span><br><span class="line">    line-height: 40px;</span><br><span class="line">    margin-top: 10px;</span><br><span class="line">    font-size: 16px;</span><br><span class="line">    background-color: #fafafa;</span><br><span class="line">    .left-words {</span><br><span class="line">      span {</span><br><span class="line">        margin-right: 10px;</span><br><span class="line">      }</span><br><span class="line">      .van-icon {</span><br><span class="line">        margin-right: 4px;</span><br><span class="line">        color: #fa2209;</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  .comment {</span><br><span class="line">    padding: 10px;</span><br><span class="line">  }</span><br><span class="line">  .comment-title {</span><br><span class="line">    display: flex;</span><br><span class="line">    justify-content: space-between;</span><br><span class="line">    .right {</span><br><span class="line">      color: #959595;</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  .comment-item {</span><br><span class="line">    font-size: 16px;</span><br><span class="line">    line-height: 30px;</span><br><span class="line">    .top {</span><br><span class="line">      height: 30px;</span><br><span class="line">      display: flex;</span><br><span class="line">      align-items: center;</span><br><span class="line">      margin-top: 20px;</span><br><span class="line">      img {</span><br><span class="line">        width: 20px;</span><br><span class="line">        height: 20px;</span><br><span class="line">      }</span><br><span class="line">      .name {</span><br><span class="line">        margin: 0 10px;</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">    .time {</span><br><span class="line">      color: #999;</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  .footer {</span><br><span class="line">    position: fixed;</span><br><span class="line">    left: 0;</span><br><span class="line">    bottom: 0;</span><br><span class="line">    width: 100%;</span><br><span class="line">    height: 55px;</span><br><span class="line">    background-color: #fff;</span><br><span class="line">    border-top: 1px solid #ccc;</span><br><span class="line">    display: flex;</span><br><span class="line">    justify-content: space-evenly;</span><br><span class="line">    align-items: center;</span><br><span class="line">    .icon-home,</span><br><span class="line">    .icon-cart {</span><br><span class="line">      display: flex;</span><br><span class="line">      flex-direction: column;</span><br><span class="line">      align-items: center;</span><br><span class="line">      justify-content: center;</span><br><span class="line">      font-size: 14px;</span><br><span class="line">      .van-icon {</span><br><span class="line">        font-size: 24px;</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">    .btn-add,</span><br><span class="line">    .btn-buy {</span><br><span class="line">      height: 36px;</span><br><span class="line">      line-height: 36px;</span><br><span class="line">      width: 120px;</span><br><span class="line">      border-radius: 18px;</span><br><span class="line">      background-color: #ffa900;</span><br><span class="line">      text-align: center;</span><br><span class="line">      color: #fff;</span><br><span class="line">      font-size: 14px;</span><br><span class="line">    }</span><br><span class="line">    .btn-buy {</span><br><span class="line">      background-color: #fe5630;</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">.tips {</span><br><span class="line">  padding: 10px;</span><br><span class="line">}</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></tbody></table></figure>
<p>封装获取商品详情的请求模块 <code>api/goodsDetail.js</code></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">"@/utils/request"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取商品详情</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">getGoodsDetail</span> = (<span class="params">goodsId</span>) =&gt; {</span><br><span class="line">  <span class="keyword">return</span> request.<span class="title function_">get</span>(<span class="string">"/goods/detail"</span>, {</span><br><span class="line">    <span class="attr">params</span>: {</span><br><span class="line">      goodsId,</span><br><span class="line">    },</span><br><span class="line">  });</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure>
<p>获取的一个示例：</p>
<p><img src= "/img/loading/loading.gif" onerror="this.onerror=null,this.src=&quot;/img/avatar/emo.webp&quot;" data-lazy-src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202408301539204.png" alt="image-20240830153951035"></p>
<p>于是进行动态渲染</p>
<h3 id="商品说明动态渲染"><a class="markdownIt-Anchor" href="#商品说明动态渲染"></a> 商品说明动态渲染</h3>
<p>改造 template 中对图片的渲染：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;van-swipe-item v-for="(image, index) in images" :key="index"&gt;</span><br><span class="line">        &lt;img :src="image.external_url" /&gt;</span><br><span class="line">      &lt;/van-swipe-item&gt;</span><br></pre></td></tr></tbody></table></figure>
<p>script 部分如下：</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">import</span> { getGoodsDetail } <span class="keyword">from</span> <span class="string">'@/api/goodsDetail'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> {</span><br><span class="line">  <span class="attr">name</span>: <span class="string">'ProDetail'</span>,</span><br><span class="line">  <span class="attr">computed</span>: {</span><br><span class="line">    <span class="title function_">detailId</span> () {</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">$route</span>.<span class="property">params</span>.<span class="property">id</span></span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">created</span> () {</span><br><span class="line">    <span class="keyword">const</span> goodsId = <span class="variable language_">this</span>.<span class="property">detailId</span></span><br><span class="line">    <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">getGoodsDetail</span>(goodsId)</span><br><span class="line">    <span class="comment">// console.log(res)</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">goodsObj</span> = res.<span class="property">data</span>.<span class="property">detail</span></span><br><span class="line">    <span class="comment">// console.log(this.goodsObj)</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">images</span> = <span class="variable language_">this</span>.<span class="property">goodsObj</span>.<span class="property">goods_images</span></span><br><span class="line">  },</span><br><span class="line">  <span class="title function_">data</span> () {</span><br><span class="line">    <span class="keyword">return</span> {</span><br><span class="line">      <span class="attr">goodsObj</span>: {},</span><br><span class="line">      <span class="attr">images</span>: [],</span><br><span class="line">      <span class="attr">current</span>: <span class="number">0</span></span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  <span class="attr">methods</span>: {</span><br><span class="line">    <span class="title function_">onChange</span> (index) {</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">current</span> = index</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></tbody></table></figure>
<p>修改商品说明进行动态渲染：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 商品说明 --&gt;</span><br><span class="line">    &lt;div class="info"&gt;</span><br><span class="line">      &lt;div class="title"&gt;</span><br><span class="line">        &lt;div class="price"&gt;</span><br><span class="line">          &lt;span class="now"&gt;￥{{ goodsObj.goods_price_min }}&lt;/span&gt;</span><br><span class="line">          &lt;span class="oldprice"&gt;￥{{ goodsObj.goods_price_max }}&lt;/span&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div class="sellcount"&gt;已售{{ goodsObj.goods_sales }}件&lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;div class="msg text-ellipsis-2"&gt;</span><br><span class="line">        {{ goodsObj.goods_name }}</span><br><span class="line">      &lt;/div&gt;</span><br></pre></td></tr></tbody></table></figure>
<p>到这里还没有完成评论区的动态渲染</p>
<h3 id="商品评论区渲染"><a class="markdownIt-Anchor" href="#商品评论区渲染"></a> 商品评论区渲染</h3>
<p>封装请求获取商品评价详情的模块 <code>api/goodsDetail.js</code></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取商品评价详情</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">getGoodsCommentDetail</span> = (<span class="params">obj</span>) =&gt; {</span><br><span class="line">  <span class="keyword">const</span> { scoreType, goodsId, page } = obj;</span><br><span class="line">  <span class="keyword">return</span> request.<span class="title function_">get</span>(<span class="string">"/comment/list"</span>, {</span><br><span class="line">    <span class="attr">params</span>: {</span><br><span class="line">      scoreType,</span><br><span class="line">      goodsId,</span><br><span class="line">      page,</span><br><span class="line">    },</span><br><span class="line">  });</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure>
<p>请求解构：<br>
<img src= "/img/loading/loading.gif" onerror="this.onerror=null,this.src=&quot;/img/avatar/emo.webp&quot;" data-lazy-src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202408301611303.png" alt="image-20240830161142137"></p>
<p>完成商品评价渲染（默认只展示三条评价）</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 商品评价 --&gt;</span><br><span class="line">    &lt;div class="comment"&gt;</span><br><span class="line">      &lt;div class="comment-title"&gt;</span><br><span class="line">        &lt;div class="left"&gt;商品评价 ({{ goodsCommentArray.length }}条)&lt;/div&gt;</span><br><span class="line">        &lt;div class="right" @click="$router.push(`/productComment?id=${detailId}`)"&gt;查看更多 &lt;van-icon name="arrow" /&gt; &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;div class="comment-list"&gt;</span><br><span class="line">        &lt;div class="comment-item" v-for="(item, index) in goodsCommentArray" :key="item.comment_id"&gt;</span><br><span class="line">          &lt;div class="top" v-if="index &lt; 3"&gt;</span><br><span class="line">            &lt;img :src="item.user.avatar_url ? item.user.avatar_url : defaultAvatar" alt=""&gt;</span><br><span class="line">            &lt;div class="name"&gt;{{item.user.nick_name}}&lt;/div&gt;</span><br><span class="line">            &lt;van-rate :size="16" :value="item.score" color="#ffd21e" void-icon="star" void-color="#eee"/&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">          &lt;div class="content" v-if="index &lt; 3"&gt;</span><br><span class="line">            {{item.content}}</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">          &lt;div class="time" v-if="index &lt; 3"&gt;</span><br><span class="line">            {{item.create_time}}</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br></pre></td></tr></tbody></table></figure>
<p>在生命周期钩子 created 中：</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="title function_">created</span> () {</span><br><span class="line">    <span class="comment">// 获取商品详情-说明部分</span></span><br><span class="line">    <span class="keyword">const</span> goodsId = <span class="variable language_">this</span>.<span class="property">detailId</span></span><br><span class="line">    <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">getGoodsDetail</span>(goodsId)</span><br><span class="line">    <span class="comment">// console.log(res)</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">goodsDetailObj</span> = res.<span class="property">data</span>.<span class="property">detail</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">images</span> = <span class="variable language_">this</span>.<span class="property">goodsDetailObj</span>.<span class="property">goods_images</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取商品详情-评价部分</span></span><br><span class="line">    <span class="keyword">const</span> commentRes = <span class="keyword">await</span> <span class="title function_">getGoodsCommentDetail</span>({</span><br><span class="line">      <span class="attr">scoreType</span>: <span class="number">10</span>, <span class="comment">// 默认抓取好评</span></span><br><span class="line">      <span class="attr">goodsId</span>: goodsId,</span><br><span class="line">      <span class="attr">page</span>: <span class="number">1</span></span><br><span class="line">    })</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">goodsCommentArray</span> = commentRes.<span class="property">data</span>.<span class="property">list</span>.<span class="property">data</span></span><br><span class="line">  },</span><br></pre></td></tr></tbody></table></figure>
<p>data 提供：</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">data</span> () {</span><br><span class="line">    <span class="keyword">return</span> {</span><br><span class="line">      <span class="attr">defaultAvatar</span>: <span class="string">'https://.../coding/202408301648039.png'</span>,</span><br><span class="line">      <span class="attr">goodsDetailObj</span>: {}, <span class="comment">// 商品说明</span></span><br><span class="line">      <span class="attr">goodsCommentArray</span>: {}, <span class="comment">// 商品评价</span></span><br><span class="line">      <span class="attr">images</span>: [],</span><br><span class="line">      <span class="attr">current</span>: <span class="number">0</span></span><br><span class="line">    }</span><br><span class="line">  },</span><br></pre></td></tr></tbody></table></figure>
<p>现在剩下商品说明的图片未渲染、商品评论区未渲染</p>
<h3 id="商品说明的图片渲染"><a class="markdownIt-Anchor" href="#商品说明的图片渲染"></a> 商品说明的图片渲染</h3>
<p><img src= "/img/loading/loading.gif" onerror="this.onerror=null,this.src=&quot;/img/avatar/emo.webp&quot;" data-lazy-src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202408310104868.png" alt="image-20240830174412273"><br>
接口返回的数据中 content 就是商品详细说明的图：</p>
<p><img src= "/img/loading/loading.gif" onerror="this.onerror=null,this.src=&quot;/img/avatar/emo.webp&quot;" data-lazy-src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202408310105026.png" alt="image-20240830174505655"></p>
<p>于是再于 data 中提供两个数据用于处理：</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">imgSrcRegex</span>: <span class="regexp">/&lt;img[^&gt;]+src="([^"&gt;]+)"/g</span>, <span class="comment">// 匹配接口数据html中的src图</span></span><br><span class="line"><span class="attr">imgSrcArray</span>: [], <span class="comment">// 商品详细介绍长图</span></span><br></pre></td></tr></tbody></table></figure>
<p>再到 created 中编写：</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="title function_">created</span> () {</span><br><span class="line">    <span class="comment">// 获取商品详情-说明部分</span></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取商品详情-评价部分</span></span><br><span class="line">   ...</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 正则匹配得到商品详细介绍长图</span></span><br><span class="line">    <span class="keyword">const</span> htmlString = <span class="variable language_">this</span>.<span class="property">goodsDetailObj</span>.<span class="property">content</span></span><br><span class="line">    <span class="keyword">const</span> srcArray = []</span><br><span class="line">    <span class="keyword">const</span> regex = <span class="regexp">/&lt;img\s+[^&gt;]*src="([^"]*)"/g</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> match</span><br><span class="line">    <span class="keyword">while</span> ((match = regex.<span class="title function_">exec</span>(htmlString)) !== <span class="literal">null</span>) {</span><br><span class="line">      srcArray.<span class="title function_">push</span>(match[<span class="number">1</span>]) <span class="comment">// 将匹配到的 src URL 添加到数组中</span></span><br><span class="line">    }</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">imgSrcArray</span> = srcArray</span><br><span class="line">    <span class="comment">// console.log(this.imgSrcArray) // 输出结果数组</span></span><br><span class="line">  },</span><br></pre></td></tr></tbody></table></figure>
<p>接下来就剩下完全的评价区渲染了。</p>
<h2 id="商品评价区"><a class="markdownIt-Anchor" href="#商品评价区"></a> 商品评价区</h2>
<p>这是一个新的页面所以直接新建了。<code>views/productdetail/evaluation.vue</code></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class="goodsEvaluation"&gt;</span><br><span class="line">    &lt;van-nav-bar</span><br><span class="line">      fixed</span><br><span class="line">      title="商品评价页"</span><br><span class="line">      left-arrow</span><br><span class="line">      @click-left="$router.go(-1)"</span><br><span class="line">    /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;div class="comment-list"&gt;</span><br><span class="line">      &lt;div</span><br><span class="line">        class="comment-item"</span><br><span class="line">        v-for="item in goodsCommentArray"</span><br><span class="line">        :key="item.comment_id"</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;div class="top"&gt;</span><br><span class="line">          &lt;img :src="item.user.avatar_url || defaultAvatar" alt="" /&gt;</span><br><span class="line">          &lt;div class="name"&gt;{{ item.user.nick_name }}&lt;/div&gt;</span><br><span class="line">          &lt;van-rate</span><br><span class="line">            :size="16"</span><br><span class="line">            :value="item.score"</span><br><span class="line">            color="#ffd21e"</span><br><span class="line">            void-icon="star"</span><br><span class="line">            void-color="#eee"</span><br><span class="line">          /&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div class="content"&gt;</span><br><span class="line">          {{ item.content }}</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div class="time"&gt;</span><br><span class="line">          {{ item.create_time }}</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import { getGoodsCommentDetail } from "@/api/goodsDetail";</span><br><span class="line">export default {</span><br><span class="line">  name: "GoodsEvaluation",</span><br><span class="line">  computed: {</span><br><span class="line">    detailId() {</span><br><span class="line">      return this.$route.params.id;</span><br><span class="line">    },</span><br><span class="line">  },</span><br><span class="line">  async created() {</span><br><span class="line">    try {</span><br><span class="line">      const goodsId = this.detailId;</span><br><span class="line">      const commentRes = await getGoodsCommentDetail({</span><br><span class="line">        scoreType: -1, // 全部评价</span><br><span class="line">        goodsId,</span><br><span class="line">      });</span><br><span class="line">      this.goodsCommentArray = commentRes.data.list.data;</span><br><span class="line">      console.log(this.goodsCommentArray);</span><br><span class="line">    } catch (error) {</span><br><span class="line">      console.error("Failed to fetch goods comments:", error);</span><br><span class="line">      // 可以在这里添加更多的错误处理逻辑，比如显示错误提示</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  data() {</span><br><span class="line">    return {</span><br><span class="line">      defaultAvatar: "https://.../coding/202408301648039.png",</span><br><span class="line">      goodsCommentArray: [], // 商品评价</span><br><span class="line">    };</span><br><span class="line">  },</span><br><span class="line">};</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang="less" scoped&gt;</span><br><span class="line">.goodsEvaluation {</span><br><span class="line">  padding-top: 46px;</span><br><span class="line">  background-color: #f7f7f7;</span><br><span class="line">  min-height: 100vh;</span><br><span class="line">  ::v-deep .van-icon-arrow-left {</span><br><span class="line">    color: #333;</span><br><span class="line">  }</span><br><span class="line">  .comment-list {</span><br><span class="line">    padding: 10px 15px;</span><br><span class="line">  }</span><br><span class="line">  .comment-item {</span><br><span class="line">    background-color: #fff;</span><br><span class="line">    border-radius: 8px;</span><br><span class="line">    padding: 15px;</span><br><span class="line">    margin-bottom: 10px;</span><br><span class="line">    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);</span><br><span class="line">    font-size: 14px;</span><br><span class="line">    line-height: 22px;</span><br><span class="line">    .top {</span><br><span class="line">      display: flex;</span><br><span class="line">      align-items: center;</span><br><span class="line">      margin-bottom: 10px;</span><br><span class="line">      img {</span><br><span class="line">        width: 40px;</span><br><span class="line">        height: 40px;</span><br><span class="line">        border-radius: 50%;</span><br><span class="line">        margin-right: 10px;</span><br><span class="line">        object-fit: cover;</span><br><span class="line">        border: 1px solid #eaeaea;</span><br><span class="line">      }</span><br><span class="line">      .name {</span><br><span class="line">        font-weight: 600;</span><br><span class="line">        color: #333;</span><br><span class="line">        flex-grow: 1;</span><br><span class="line">      }</span><br><span class="line">      .van-rate {</span><br><span class="line">        margin-left: auto;</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">    .content {</span><br><span class="line">      color: #555;</span><br><span class="line">      margin-bottom: 10px;</span><br><span class="line">      white-space: normal;</span><br><span class="line">      word-wrap: break-word;</span><br><span class="line">    }</span><br><span class="line">    .time {</span><br><span class="line">      font-size: 12px;</span><br><span class="line">      color: #999;</span><br><span class="line">      text-align: right;</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></tbody></table></figure>
<p>并转到 router 包下修改路由：</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 配置动态商品id，用于确认将来是哪个商品详情页</span></span><br><span class="line">{ <span class="attr">path</span>: <span class="string">'/productdetail/:id'</span>, <span class="attr">component</span>: <span class="title class_">ProductDetail</span> },</span><br><span class="line">{ <span class="attr">path</span>: <span class="string">'/evaluation/:id'</span>, <span class="attr">component</span>: <span class="title class_">GoodsEvaluation</span> },</span><br><span class="line"></span><br><span class="line"><span class="comment">// 404页面，用于调试</span></span><br><span class="line">{ <span class="attr">path</span>: <span class="string">'*'</span>, <span class="attr">component</span>: <span class="title class_">NotFound</span> }</span><br></pre></td></tr></tbody></table></figure>
<h2 id="加入购物车购买"><a class="markdownIt-Anchor" href="#加入购物车购买"></a> 加入购物车 / 购买</h2>
<p>该功能使用到弹层组件，可以在 vant 组件库中找到 ActionSheet</p>
<p>页面代码如下：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 弹层 --&gt;</span><br><span class="line">&lt;van-action-sheet</span><br><span class="line">  v-model="showPannel"</span><br><span class="line">  :title="mode === 'cart' ? '加入购物车' : '立刻购买'"</span><br><span class="line">&gt;</span><br><span class="line">      &lt;div class="product"&gt;</span><br><span class="line">        &lt;div class="product-title"&gt;</span><br><span class="line">          &lt;div class="left"&gt;</span><br><span class="line">            &lt;img :src="goodsDetailObj.goods_image" alt=""&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">          &lt;div class="right"&gt;</span><br><span class="line">            &lt;div class="price"&gt;</span><br><span class="line">              &lt;span&gt;¥&lt;/span&gt;</span><br><span class="line">              &lt;span class="nowprice"&gt;{{ goodsDetailObj.goods_price_min }}&lt;/span&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;div class="count"&gt;</span><br><span class="line">              &lt;span&gt;库存&lt;/span&gt;</span><br><span class="line">              &lt;span&gt;{{ goodsDetailObj.stock_total }}&lt;/span&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div class="num-box"&gt;</span><br><span class="line">          &lt;span&gt;数量&lt;/span&gt;</span><br><span class="line">          数字框占位</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;!-- 有库存才显示可购买 --&gt;</span><br><span class="line">        &lt;div class="showbtn" v-if="goodsDetailObj.stock_total &gt; 0"&gt;</span><br><span class="line">          &lt;div class="btn" v-if="true"&gt;加入购物车&lt;/div&gt;</span><br><span class="line">          &lt;div class="btn now" v-else&gt;立刻购买&lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div class="btn-none" v-else&gt;该商品已抢完&lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/van-action-sheet&gt;</span><br></pre></td></tr></tbody></table></figure>
<p>样式如下：</p>
<figure class="highlight less"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 弹层样式</span></span><br><span class="line"><span class="selector-class">.product</span> {</span><br><span class="line">  <span class="selector-class">.product-title</span> {</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="selector-class">.left</span> {</span><br><span class="line">      <span class="selector-tag">img</span> {</span><br><span class="line">        <span class="attribute">width</span>: <span class="number">90px</span>;</span><br><span class="line">        <span class="attribute">height</span>: <span class="number">90px</span>;</span><br><span class="line">      }</span><br><span class="line">      <span class="attribute">margin</span>: <span class="number">10px</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="selector-class">.right</span> {</span><br><span class="line">      <span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line">      <span class="attribute">padding</span>: <span class="number">10px</span>;</span><br><span class="line">      <span class="selector-class">.price</span> {</span><br><span class="line">        <span class="attribute">font-size</span>: <span class="number">14px</span>;</span><br><span class="line">        <span class="attribute">color</span>: <span class="number">#fe560a</span>;</span><br><span class="line">        <span class="selector-class">.nowprice</span> {</span><br><span class="line">          <span class="attribute">font-size</span>: <span class="number">24px</span>;</span><br><span class="line">          <span class="attribute">margin</span>: <span class="number">0</span> <span class="number">5px</span>;</span><br><span class="line">        }</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="selector-class">.num-box</span> {</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">justify-content</span>: space-between;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">10px</span>;</span><br><span class="line">    <span class="attribute">align-items</span>: center;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="selector-class">.btn</span>,</span><br><span class="line">  <span class="selector-class">.btn-none</span> {</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">40px</span>;</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="number">40px</span>;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">20px</span>;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">20px</span>;</span><br><span class="line">    <span class="attribute">text-align</span>: center;</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">rgb</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>);</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="built_in">rgb</span>(<span class="number">255</span>, <span class="number">148</span>, <span class="number">2</span>);</span><br><span class="line">  }</span><br><span class="line">  <span class="selector-class">.btn</span><span class="selector-class">.now</span> {</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#fe5630</span>;</span><br><span class="line">  }</span><br><span class="line">  <span class="selector-class">.btn-none</span> {</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#cccccc</span>;</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>data 中提供两个数据：</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">showPannel</span>: <span class="literal">false</span>,</span><br><span class="line"><span class="attr">mode</span>: <span class="string">'cart'</span>, <span class="comment">// 购物车或立即购买</span></span><br></pre></td></tr></tbody></table></figure>
<p>methods 中提供两个方法：</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">addToCart</span> () {</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">showPannel</span> = <span class="literal">true</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">mode</span> = <span class="string">'cart'</span></span><br><span class="line">    },</span><br><span class="line">    <span class="title function_">buyNow</span> () {</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">showPannel</span> = <span class="literal">true</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">mode</span> = <span class="string">'buy'</span></span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>
<p>接下来还需要将弹层中的数量展示封装成数字框组件。</p>
<h2 id="数字框组件封装"><a class="markdownIt-Anchor" href="#数字框组件封装"></a> 数字框组件封装</h2>
<p><img src= "/img/loading/loading.gif" onerror="this.onerror=null,this.src=&quot;/img/avatar/emo.webp&quot;" data-lazy-src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202408310106195.png" alt="image-20240831010611047"><br>
分析：组件名 CountBox</p>
<ol>
<li>静态结构，左中右三部分</li>
<li>数字框的数字，应该是外部传递进来的 (父传子)</li>
<li> 点击 <code>+－</code>号，可以修改数字（子传父)</li>
<li> 使用 <code>v-model</code> 实现封装（<code>:value</code> 和 <code>@input</code> 的简写）</li>
<li>数字不能减到小于 1</li>
</ol>
<p>封装组件 <code>components/CountBox.vue</code></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class="count-box"&gt;</span><br><span class="line">    &lt;button @click="handleSub" class="minus"&gt;-&lt;/button&gt;</span><br><span class="line">    &lt;input :value="value" @change="handleChange" class="inp" type="text" /&gt;</span><br><span class="line">    &lt;button @click="handleAdd" class="add"&gt;+&lt;/button&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default {</span><br><span class="line">  props: {</span><br><span class="line">    value: {</span><br><span class="line">      type: Number,</span><br><span class="line">      default: 1,</span><br><span class="line">    },</span><br><span class="line">  },</span><br><span class="line">  methods: {</span><br><span class="line">    handleSub() {</span><br><span class="line">      if (this.value &lt;= 1) {</span><br><span class="line">        return;</span><br><span class="line">      }</span><br><span class="line">      this.$emit("input", this.value - 1);</span><br><span class="line">    },</span><br><span class="line">    handleAdd() {</span><br><span class="line">      this.$emit("input", this.value + 1);</span><br><span class="line">    },</span><br><span class="line">    handleChange(e) {</span><br><span class="line">      // console.log(e.target.value)</span><br><span class="line">      const num = +e.target.value; // 转数字处理 (1) 数字 (2) NaN</span><br><span class="line"></span><br><span class="line">      // 输入了不合法的文本 或 输入了负值，回退成原来的 value 值</span><br><span class="line">      if (isNaN(num) || num &lt; 1) {</span><br><span class="line">        e.target.value = this.value;</span><br><span class="line">        return;</span><br><span class="line">      }</span><br><span class="line"></span><br><span class="line">      this.$emit("input", num);</span><br><span class="line">    },</span><br><span class="line">  },</span><br><span class="line">};</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang="less" scoped&gt;</span><br><span class="line">.count-box {</span><br><span class="line">  width: 110px;</span><br><span class="line">  display: flex;</span><br><span class="line">  .add,</span><br><span class="line">  .minus {</span><br><span class="line">    width: 30px;</span><br><span class="line">    height: 30px;</span><br><span class="line">    outline: none;</span><br><span class="line">    border: none;</span><br><span class="line">    background-color: #efefef;</span><br><span class="line">  }</span><br><span class="line">  .inp {</span><br><span class="line">    width: 40px;</span><br><span class="line">    height: 30px;</span><br><span class="line">    outline: none;</span><br><span class="line">    border: none;</span><br><span class="line">    margin: 0 5px;</span><br><span class="line">    background-color: #efefef;</span><br><span class="line">    text-align: center;</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></tbody></table></figure>
<p>使用组件</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">CountBox</span> <span class="keyword">from</span> <span class="string">'@/components/CountBox.vue'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> {</span><br><span class="line">  <span class="attr">name</span>: <span class="string">'ProDetail'</span>,</span><br><span class="line">  <span class="attr">components</span>: {</span><br><span class="line">    <span class="title class_">CountBox</span></span><br><span class="line">  },</span><br><span class="line">  <span class="title function_">data</span> () {</span><br><span class="line">    <span class="keyword">return</span> {</span><br><span class="line">      <span class="attr">addCount</span>: <span class="number">1</span></span><br><span class="line">      ...</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">&lt;div <span class="keyword">class</span>=<span class="string">"num-box"</span>&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">span</span>&gt;</span>数量<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">CountBox</span> <span class="attr">v-model</span>=<span class="string">"addCount"</span>&gt;</span><span class="tag">&lt;/<span class="name">CountBox</span>&gt;</span></span></span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></tbody></table></figure>
<h2 id="加入购物车-判断登录状态"><a class="markdownIt-Anchor" href="#加入购物车-判断登录状态"></a> 加入购物车 - 判断登录状态</h2>
<p>需要使用到 vant 的 Dialog 组件</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> { <span class="title class_">Dialog</span> } <span class="keyword">from</span> <span class="string">"vant"</span>;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Dialog</span>({ <span class="attr">message</span>: <span class="string">"提示"</span> });</span><br></pre></td></tr></tbody></table></figure>
<p>给弹层的加入购物车按钮绑定点击事件</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;div <span class="keyword">class</span>=<span class="string">"btn"</span> v-<span class="keyword">if</span>=<span class="string">"this.mode === 'cart'"</span> @click=<span class="string">"addCart"</span>&gt;加入购物车&lt;/div&gt;</span><br></pre></td></tr></tbody></table></figure>
<p>添加 token 鉴权判断，跳转携带回跳地址</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 加入购物车判断登录状态</span></span><br><span class="line">    <span class="title function_">addCart</span> () {</span><br><span class="line">      <span class="comment">// console.log(this.$store.getters.token)</span></span><br><span class="line">      <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">$store</span>.<span class="property">getters</span>.<span class="property">token</span>) {</span><br><span class="line">        <span class="comment">// 说明没有token，没有token就需要提示登录</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">$dialog</span>.<span class="title function_">confirm</span>({</span><br><span class="line">          <span class="attr">message</span>: <span class="string">'当前操作需要登录后才能进行哦'</span>,</span><br><span class="line">          <span class="attr">confirmButtonText</span>: <span class="string">'去登录'</span>,</span><br><span class="line">          <span class="attr">cancelButtonText</span>: <span class="string">'再逛逛'</span></span><br><span class="line">        }).<span class="title function_">then</span>(<span class="function">() =&gt;</span> {</span><br><span class="line">          <span class="comment">// 说明点击了去登录，需要带上backUrl</span></span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">replace</span>({</span><br><span class="line">            <span class="attr">path</span>: <span class="string">'/login'</span>,</span><br><span class="line">            <span class="attr">query</span>: {</span><br><span class="line">              <span class="attr">backUrl</span>: <span class="variable language_">this</span>.<span class="property">$route</span>.<span class="property">fullPath</span> <span class="comment">// 带上当前页面的全路径（包括查询参数）</span></span><br><span class="line">            }</span><br><span class="line">          })</span><br><span class="line">        })</span><br><span class="line">          .<span class="title function_">catch</span>(<span class="function">() =&gt;</span> {</span><br><span class="line">            <span class="comment">// 说明点击了再逛逛，不做任何操作</span></span><br><span class="line">          })</span><br><span class="line">      }</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>
<p>登录后如果有回跳地址则 replace 地回跳回去：</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 判断有无回跳地址</span></span><br><span class="line"><span class="keyword">const</span> url = <span class="variable language_">this</span>.<span class="property">$route</span>.<span class="property">query</span>.<span class="property">backUrl</span> || <span class="string">"/"</span>;</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">replace</span>(url);</span><br></pre></td></tr></tbody></table></figure>
<h2 id="thisrouterreplace和thisrouterpush的区别"><a class="markdownIt-Anchor" href="#thisrouterreplace和thisrouterpush的区别"></a> <code>this.$router.replace</code> 和 <code>this.$router.push</code> 的区别</h2>
<p>假设有 A、B、C 三个页面。</p>
<p>我从 A 点击进入 B 页面，然后在 B 页面需要进行跳转到 C 页面，此时我触发的是 <code>this.$router.replace</code> 进行跳转，那么跳转到 C 之后 C 就会将 B 的访问记录完全覆盖。如果我在 C 页面的操作结束之后，进行返回上一页的操作，就会直接返回到 A 页面而不是 B 页面。</p>
<p>相对的，<code>this.$router.push</code> 则会将记录保持，你的每次访问都是一个累加的过程，不会清除。</p>
<p>如果把页面比作真实的纸张，跳转的过程就像把我们手里的一张纸覆盖到桌子上的另一张纸上面一样，桌子上纸张堆的是已经访问过的页面，桌子上的纸张堆中最上面那一张就是我们现在正在访问的页面，而手里的是将要访问的页面。但覆盖的方式上述两种各有不同：<code>replace</code> 会在覆盖桌子上的纸张之前将桌子上最上面的那一张丢到垃圾桶，然后再将手中的纸张覆盖上去；<code>push</code> 则是简单的将纸张放在桌子上的纸张上面，不进行其他任何操作，最终你的访问记录都在桌子上。</p>
<h2 id="加入购物车-封装接口进行请求"><a class="markdownIt-Anchor" href="#加入购物车-封装接口进行请求"></a> 加入购物车 - 封装接口进行请求</h2>
<p>接口如下：</p>
<p><img src= "/img/loading/loading.gif" onerror="this.onerror=null,this.src=&quot;/img/avatar/emo.webp&quot;" data-lazy-src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202408310106434.png" alt="image-20240830232641136"></p>
<p>封装加入购物车的请求接口模块 <code>api/cart.js</code></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 加入购物车的请求</span></span><br><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">"@/utils/request"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">addCart</span> = (<span class="params">goodsId, goodsNum, goodsSkuId</span>) =&gt; {</span><br><span class="line">  <span class="comment">// goodsId: 商品id, goodsNum: 商品数量, goodsSkuId: 商品规格id 如红色手机</span></span><br><span class="line">  <span class="keyword">return</span> request.<span class="title function_">post</span>(<span class="string">"/cart/add"</span>, {</span><br><span class="line">    goodsId,</span><br><span class="line">    goodsNum,</span><br><span class="line">    goodsSkuId,</span><br><span class="line">  });</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure>
<p>由于需要携带请求头且携带的是鉴权信息，每次请求手动去写比较麻烦，所以直接在请求拦截器中携带 <code>utils/request.js</code></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">"@/store"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 只要有token就在请求中携带，便于请求需要权限的接口</span></span><br><span class="line"><span class="keyword">const</span> token = store.<span class="property">getters</span>.<span class="property">token</span>;</span><br><span class="line"><span class="keyword">if</span> (token) {</span><br><span class="line">  config.<span class="property">headers</span>[<span class="string">"Access-Token"</span>] = token;</span><br><span class="line">  config.<span class="property">headers</span>.<span class="property">platform</span> = <span class="string">"h5"</span>;</span><br><span class="line">}</span><br><span class="line"><span class="keyword">return</span> config;</span><br></pre></td></tr></tbody></table></figure>
<p>修改购物车渲染代码进行购物车内数量角标展示 <code>views/productdetail/index.vue</code></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class="icon-cart"&gt;</span><br><span class="line">        &lt;van-icon :badge="cartTotal || ''" name="shopping-cart-o" /&gt;</span><br><span class="line">        &lt;span&gt;购物车&lt;/span&gt;</span><br><span class="line">      &lt;/div&gt;</span><br></pre></td></tr></tbody></table></figure>
<p>导入并将商品规格赋值给 data 数据</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> { addCart } <span class="keyword">from</span> <span class="string">'@/api/cart'</span></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">created</span> () {</span><br><span class="line">    <span class="comment">// 获取商品详情-说明部分</span></span><br><span class="line">    <span class="keyword">const</span> goodsId = <span class="variable language_">this</span>.<span class="property">detailId</span></span><br><span class="line">    <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">getGoodsDetail</span>(goodsId)</span><br><span class="line">    <span class="comment">// console.log(res)</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">goodsDetailObj</span> = res.<span class="property">data</span>.<span class="property">detail</span></span><br><span class="line">    <span class="comment">// console.log(this.goodsDetailObj)</span></span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">goodsSkuId</span> = <span class="variable language_">this</span>.<span class="property">goodsDetailObj</span>.<span class="property">skuList</span>[<span class="number">0</span>].<span class="property">goods_sku_id</span> <span class="comment">// 得到商品规格id</span></span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">images</span> = <span class="variable language_">this</span>.<span class="property">goodsDetailObj</span>.<span class="property">goods_images</span> <span class="comment">// 得到商品轮播图</span></span><br><span class="line">		...</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>提供 data 数据来接收必要信息</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">addCount</span>: <span class="number">1</span>, <span class="comment">// 加入购物车的商品数量</span></span><br><span class="line"><span class="attr">goodsSkuId</span>: <span class="number">0</span>, <span class="comment">// 商品规格id</span></span><br><span class="line"><span class="attr">cartTotal</span>: <span class="number">0</span>, <span class="comment">// 购物车内商品总数</span></span><br></pre></td></tr></tbody></table></figure>
<p>编写请求代码</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 加入购物车判断登录状态</span></span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">addCart</span> () {</span><br><span class="line">      ...</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 说明有token，可以直接加入购物车</span></span><br><span class="line">      <span class="keyword">const</span> { data } = <span class="keyword">await</span> <span class="title function_">addCart</span>(<span class="variable language_">this</span>.<span class="property">detailId</span>, <span class="variable language_">this</span>.<span class="property">addCount</span>, <span class="variable language_">this</span>.<span class="property">goodsSkuId</span>)</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">cartTotal</span> = data.<span class="property">cartTotal</span></span><br><span class="line">      <span class="variable language_">this</span>.$toast(<span class="string">'加入购物车成功！'</span>)</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">showPannel</span> = <span class="literal">false</span> <span class="comment">// 关闭弹层</span></span><br><span class="line">    }</span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure>
<h2 id="购物车页面"><a class="markdownIt-Anchor" href="#购物车页面"></a> 购物车页面</h2>
<p>需求分析：</p>
<ol>
<li>基本静态结构 (快速实现）</li>
<li>构建 vuexcart 模块，获取数据存储</li>
<li>基于数据居动态渲染购物车列表</li>
<li>封装 getters 实现动态统计</li>
<li>全选反选功能</li>
<li>数字框修改数量功能</li>
<li>编辑切换状态，删除功能</li>
<li>空购物车处理</li>
</ol>
<h3 id="静态页面"><a class="markdownIt-Anchor" href="#静态页面"></a> 静态页面</h3>
<p>修改 <code>layout/cart.vue</code></p>
<p>使用到了 vant 的 Checkbox, CheckboxGroup 组件</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> { <span class="title class_">Checkbox</span>, <span class="title class_">CheckboxGroup</span> } <span class="keyword">from</span> <span class="string">"vant"</span>;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">Checkbox</span>);</span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">CheckboxGroup</span>);</span><br></pre></td></tr></tbody></table></figure>
<p>静态页面如下：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class="cart"&gt;</span><br><span class="line">    &lt;van-nav-bar title="购物车" fixed /&gt;</span><br><span class="line">    &lt;!-- 购物车开头 --&gt;</span><br><span class="line">    &lt;div class="cart-title"&gt;</span><br><span class="line">      &lt;span class="all"&gt;共&lt;i&gt;4&lt;/i&gt;件商品&lt;/span&gt;</span><br><span class="line">      &lt;span class="edit"&gt;</span><br><span class="line">        &lt;van-icon name="edit" /&gt;</span><br><span class="line">        编辑</span><br><span class="line">      &lt;/span&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 购物车列表 --&gt;</span><br><span class="line">    &lt;div class="cart-list"&gt;</span><br><span class="line">      &lt;div class="cart-item" v-for="item in 10" :key="item"&gt;</span><br><span class="line">        &lt;van-checkbox&gt;&lt;/van-checkbox&gt;</span><br><span class="line">        &lt;div class="show"&gt;</span><br><span class="line">          &lt;img</span><br><span class="line">            src="http://cba.itlike.com/public/uploads/10001/20230321/a072ef0eef1648a5c4eae81fad1b7583.jpg"</span><br><span class="line">            alt=""</span><br><span class="line">          /&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div class="info"&gt;</span><br><span class="line">          &lt;span class="tit text-ellipsis-2"</span><br><span class="line">            &gt;新Pad 14英寸 12+128 远峰蓝 M6平板电脑</span><br><span class="line">            智能安卓娱乐十核游戏学习二合一</span><br><span class="line">            低蓝光护眼超清4K全面三星屏5GWIFI全网通 蓝魔快本平板&lt;/span</span><br><span class="line">          &gt;</span><br><span class="line">          &lt;span class="bottom"&gt;</span><br><span class="line">            &lt;div class="price"&gt;¥ &lt;span&gt;1247.04&lt;/span&gt;&lt;/div&gt;</span><br><span class="line">            &lt;div class="count-box"&gt;</span><br><span class="line">              &lt;button class="minus"&gt;-&lt;/button&gt;</span><br><span class="line">              &lt;input class="inp" :value="4" type="text" readonly /&gt;</span><br><span class="line">              &lt;button class="add"&gt;+&lt;/button&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">          &lt;/span&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;div class="footer-fixed"&gt;</span><br><span class="line">      &lt;div class="all-check"&gt;</span><br><span class="line">        &lt;van-checkbox icon-size="18"&gt;&lt;/van-checkbox&gt;</span><br><span class="line">        全选</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">      &lt;div class="all-total"&gt;</span><br><span class="line">        &lt;div class="price"&gt;</span><br><span class="line">          &lt;span&gt;合计：&lt;/span&gt;</span><br><span class="line">          &lt;span&gt;¥ &lt;i class="totalPrice"&gt;99.99&lt;/i&gt;&lt;/span&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div v-if="true" class="goPay"&gt;结算(5)&lt;/div&gt;</span><br><span class="line">        &lt;div v-else class="delete"&gt;删除&lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default {</span><br><span class="line">  name: "CartPage",</span><br><span class="line">};</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang="less" scoped&gt;</span><br><span class="line">// 主题 padding</span><br><span class="line">.cart {</span><br><span class="line">  padding-top: 46px;</span><br><span class="line">  padding-bottom: 100px;</span><br><span class="line">  background-color: #f5f5f5;</span><br><span class="line">  min-height: 100vh;</span><br><span class="line">  .cart-title {</span><br><span class="line">    height: 40px;</span><br><span class="line">    display: flex;</span><br><span class="line">    justify-content: space-between;</span><br><span class="line">    align-items: center;</span><br><span class="line">    padding: 0 10px;</span><br><span class="line">    font-size: 14px;</span><br><span class="line">    .all {</span><br><span class="line">      i {</span><br><span class="line">        font-style: normal;</span><br><span class="line">        margin: 0 2px;</span><br><span class="line">        color: #fa2209;</span><br><span class="line">        font-size: 16px;</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">    .edit {</span><br><span class="line">      .van-icon {</span><br><span class="line">        font-size: 18px;</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  .cart-item {</span><br><span class="line">    margin: 0 10px 10px 10px;</span><br><span class="line">    padding: 10px;</span><br><span class="line">    display: flex;</span><br><span class="line">    justify-content: space-between;</span><br><span class="line">    background-color: #ffffff;</span><br><span class="line">    border-radius: 5px;</span><br><span class="line"></span><br><span class="line">    .show img {</span><br><span class="line">      width: 100px;</span><br><span class="line">      height: 100px;</span><br><span class="line">    }</span><br><span class="line">    .info {</span><br><span class="line">      width: 210px;</span><br><span class="line">      padding: 10px 5px;</span><br><span class="line">      font-size: 14px;</span><br><span class="line">      display: flex;</span><br><span class="line">      flex-direction: column;</span><br><span class="line">      justify-content: space-between;</span><br><span class="line"></span><br><span class="line">      .bottom {</span><br><span class="line">        display: flex;</span><br><span class="line">        justify-content: space-between;</span><br><span class="line">        .price {</span><br><span class="line">          display: flex;</span><br><span class="line">          align-items: flex-end;</span><br><span class="line">          color: #fa2209;</span><br><span class="line">          font-size: 12px;</span><br><span class="line">          span {</span><br><span class="line">            font-size: 16px;</span><br><span class="line">          }</span><br><span class="line">        }</span><br><span class="line">        .count-box {</span><br><span class="line">          display: flex;</span><br><span class="line">          width: 110px;</span><br><span class="line">          .add,</span><br><span class="line">          .minus {</span><br><span class="line">            width: 30px;</span><br><span class="line">            height: 30px;</span><br><span class="line">            outline: none;</span><br><span class="line">            border: none;</span><br><span class="line">          }</span><br><span class="line">          .inp {</span><br><span class="line">            width: 40px;</span><br><span class="line">            height: 30px;</span><br><span class="line">            outline: none;</span><br><span class="line">            border: none;</span><br><span class="line">            background-color: #efefef;</span><br><span class="line">            text-align: center;</span><br><span class="line">            margin: 0 5px;</span><br><span class="line">          }</span><br><span class="line">        }</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">.footer-fixed {</span><br><span class="line">  position: fixed;</span><br><span class="line">  left: 0;</span><br><span class="line">  bottom: 50px;</span><br><span class="line">  height: 50px;</span><br><span class="line">  width: 100%;</span><br><span class="line">  border-bottom: 1px solid #ccc;</span><br><span class="line">  background-color: #fff;</span><br><span class="line">  display: flex;</span><br><span class="line">  justify-content: space-between;</span><br><span class="line">  align-items: center;</span><br><span class="line">  padding: 0 10px;</span><br><span class="line"></span><br><span class="line">  .all-check {</span><br><span class="line">    display: flex;</span><br><span class="line">    align-items: center;</span><br><span class="line">    .van-checkbox {</span><br><span class="line">      margin-right: 5px;</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  .all-total {</span><br><span class="line">    display: flex;</span><br><span class="line">    line-height: 36px;</span><br><span class="line">    .price {</span><br><span class="line">      font-size: 14px;</span><br><span class="line">      margin-right: 10px;</span><br><span class="line">      .totalPrice {</span><br><span class="line">        color: #fa2209;</span><br><span class="line">        font-size: 18px;</span><br><span class="line">        font-style: normal;</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    .goPay,</span><br><span class="line">    .delete {</span><br><span class="line">      min-width: 100px;</span><br><span class="line">      height: 36px;</span><br><span class="line">      line-height: 36px;</span><br><span class="line">      text-align: center;</span><br><span class="line">      background-color: #fa2f21;</span><br><span class="line">      color: #fff;</span><br><span class="line">      border-radius: 18px;</span><br><span class="line">      &amp;.disabled {</span><br><span class="line">        background-color: #ff9779;</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></tbody></table></figure>
<h3 id="构建-vuex-cart-模块"><a class="markdownIt-Anchor" href="#构建-vuex-cart-模块"></a> 构建 vuex cart 模块</h3>
<p>新建子模块 cart：<code>@/store/modules/cart</code></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> { getCartList } <span class="keyword">from</span> <span class="string">"@/api/cart"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> {</span><br><span class="line">  <span class="attr">namespaced</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="title function_">state</span>(<span class="params"></span>) {</span><br><span class="line">    <span class="keyword">return</span> {</span><br><span class="line">      <span class="comment">// 提供一个数组用于存储购物车列表</span></span><br><span class="line">      <span class="attr">cartList</span>: [],</span><br><span class="line">    };</span><br><span class="line">  },</span><br><span class="line">  <span class="attr">mutations</span>: {</span><br><span class="line">    <span class="comment">// 提供方法可以设置购物车列表</span></span><br><span class="line">    <span class="title function_">setCartList</span>(<span class="params">state, newCartList</span>) {</span><br><span class="line">      state.<span class="property">cartList</span> = newCartList;</span><br><span class="line">    },</span><br><span class="line">  },</span><br><span class="line">  <span class="attr">actions</span>: {</span><br><span class="line">    <span class="comment">// 异步获取购物车列表</span></span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">getCartAction</span>(<span class="params">context</span>) {</span><br><span class="line">      <span class="keyword">const</span> { data } = <span class="keyword">await</span> <span class="title function_">getCartList</span>();</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 由于后台返回数据中不包括是否选中的状态，所以本地自己维护，给每一项添加上被选中的状态</span></span><br><span class="line">      data.<span class="property">list</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">element</span>) =&gt;</span> {</span><br><span class="line">        element.<span class="property">isChecked</span> = <span class="literal">true</span>;</span><br><span class="line">      });</span><br><span class="line">      context.<span class="title function_">commit</span>(<span class="string">"setCartList"</span>, data.<span class="property">list</span>);</span><br><span class="line">    },</span><br><span class="line">  },</span><br><span class="line">  <span class="attr">getters</span>: {},</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure>
<p>到 vuex 中挂载：</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Cart</span> <span class="keyword">from</span> <span class="string">'@/store/modules/cart'</span></span><br><span class="line"></span><br><span class="line">	...</span><br><span class="line">  <span class="attr">modules</span>: {</span><br><span class="line">    <span class="title class_">User</span>,</span><br><span class="line">    <span class="title class_">Cart</span></span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure>
<p>购物车页面中使用 created 调用 actions 异步</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">created</span> () {</span><br><span class="line">  <span class="comment">// 判断是否登录</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">$store</span>.<span class="property">getters</span>.<span class="property">token</span>) {</span><br><span class="line">    <span class="comment">// 获取购物车数据</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="title function_">dispatch</span>(<span class="string">'Cart/getCartAction'</span>)</span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure>
<h3 id="动态渲染"><a class="markdownIt-Anchor" href="#动态渲染"></a> 动态渲染</h3>
<p>接口地址：/cart/list</p>
<p><img src= "/img/loading/loading.gif" onerror="this.onerror=null,this.src=&quot;/img/avatar/emo.webp&quot;" data-lazy-src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202408311201545.png" alt="image-20240831120141410"></p>
<p>使用辅助函数映射数组：</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> { mapState } <span class="keyword">from</span> <span class="string">'vuex'</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">  <span class="attr">computed</span>: {</span><br><span class="line">    ...<span class="title function_">mapState</span>(<span class="string">'Cart'</span>, [<span class="string">'cartList'</span>])</span><br><span class="line">  },</span><br></pre></td></tr></tbody></table></figure>
<p>将 template 中对应的地方进行改造：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class="cart-list"&gt;</span><br><span class="line">      &lt;div class="cart-item" v-for="item in cartList" :key="item.goods_id"&gt;</span><br><span class="line">        &lt;van-checkbox :value="item.isChecked"&gt;&lt;/van-checkbox&gt;</span><br><span class="line">        &lt;div class="show"&gt;</span><br><span class="line">          &lt;img :src="item.goods.goods_image" alt=""&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div class="info"&gt;</span><br><span class="line">          &lt;span class="tit text-ellipsis-2"&gt;{{ item.goods.goods_name }}&lt;/span&gt;</span><br><span class="line">          &lt;span class="bottom"&gt;</span><br><span class="line">            &lt;div class="price"&gt;¥ &lt;span&gt;{{ item.goods.goods_price_min }}&lt;/span&gt;&lt;/div&gt;</span><br><span class="line">            &lt;CountBox :value="item.goods_num"&gt;&lt;/CountBox&gt;</span><br><span class="line">          &lt;/span&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br></pre></td></tr></tbody></table></figure>
<p>但未完成其他功能按钮等事件。</p>
<h3 id="封装-getters-实现动态统计"><a class="markdownIt-Anchor" href="#封装-getters-实现动态统计"></a> 封装 getters 实现动态统计</h3>
<ul>
<li>合计商品数量</li>
</ul>
<p>合计商品数量使用到 getters</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">getters</span>: {</span><br><span class="line">  <span class="comment">// 求所有的商品累加总数</span></span><br><span class="line">  <span class="title function_">countCartTotal</span> (state) {</span><br><span class="line">    <span class="keyword">return</span> state.<span class="property">cartList</span>.<span class="title function_">reduce</span>(<span class="function">(<span class="params">sum, item, index</span>) =&gt;</span> sum + item.<span class="property">goods_num</span>, <span class="number">0</span>)</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://segmentfault.com/a/1190000044748736">reduce 函数的 20 个高级用法</a></p>
<ul>
<li>合计价格</li>
<li>结算</li>
</ul>
<p>最终完整结果：</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">getters</span>: {</span><br><span class="line">    <span class="comment">// 求所有的商品累加总数</span></span><br><span class="line">    <span class="title function_">countCartTotal</span> (state) {</span><br><span class="line">      <span class="keyword">return</span> state.<span class="property">cartList</span>.<span class="title function_">reduce</span>(<span class="function">(<span class="params">sum, item, index</span>) =&gt;</span> sum + item.<span class="property">goods_num</span>, <span class="number">0</span>)</span><br><span class="line">    },</span><br><span class="line">    <span class="comment">// 选中的商品项目</span></span><br><span class="line">    <span class="title function_">selectedCartList</span> (state) {</span><br><span class="line">      <span class="comment">// filter只会接收回调结果为true的元素，所以可以不用做其他判断</span></span><br><span class="line">      <span class="keyword">return</span> state.<span class="property">cartList</span>.<span class="title function_">filter</span>(<span class="function"><span class="params">item</span> =&gt;</span> item.<span class="property">isChecked</span>)</span><br><span class="line">    },</span><br><span class="line">    <span class="comment">// 选中的商品项目数量</span></span><br><span class="line">    <span class="title function_">selectedCartCount</span> (state, getters) { <span class="comment">// 这里的getters可以获取到上面定义的getters</span></span><br><span class="line">      <span class="keyword">return</span> <span class="title class_">Array</span>.<span class="title function_">isArray</span>(getters.<span class="property">selectedCartList</span>) ? getters.<span class="property">selectedCartList</span>.<span class="title function_">reduce</span>(<span class="function">(<span class="params">sum, item, index</span>) =&gt;</span> sum + item.<span class="property">goods_num</span>, <span class="number">0</span>) : <span class="number">0</span></span><br><span class="line">    },</span><br><span class="line">    <span class="comment">// 选中的商品总价</span></span><br><span class="line">    <span class="title function_">selectedPrice</span> (state, getters) {</span><br><span class="line">      <span class="comment">// toFixed(2) 保留两位小数</span></span><br><span class="line">      <span class="keyword">return</span> <span class="title class_">Array</span>.<span class="title function_">isArray</span>(getters.<span class="property">selectedCartList</span>) ? getters.<span class="property">selectedCartList</span>.<span class="title function_">reduce</span>(<span class="function">(<span class="params">sum, item, index</span>) =&gt;</span> sum + item.<span class="property">goods_num</span> * item.<span class="property">goods</span>.<span class="property">goods_price_min</span>, <span class="number">0</span>).<span class="title function_">toFixed</span>(<span class="number">2</span>) : <span class="number">0</span></span><br><span class="line">    }</span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure>
<p>修改购物车页面的相关 template</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;span class="all"&gt;共&lt;i&gt;{{ countCartTotal }}&lt;/i&gt;件商品&lt;/span&gt;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">&lt;div class="all-total"&gt;</span><br><span class="line">        &lt;div class="price"&gt;</span><br><span class="line">          &lt;span&gt;合计：&lt;/span&gt;</span><br><span class="line">          &lt;span&gt;¥ &lt;i class="totalPrice"&gt;{{selectedPrice}}&lt;/i&gt;&lt;/span&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div v-if="true" class="goPay" :class="{disabled: selectedCartCount === 0}"&gt;结算({{selectedCartCount}})&lt;/div&gt;</span><br><span class="line">        &lt;div v-else class="delete" :class="{disabled: selectedCartCount === 0}"&gt;删除&lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br></pre></td></tr></tbody></table></figure>
<h3 id="全选反选"><a class="markdownIt-Anchor" href="#全选反选"></a> 全选反选</h3>
<p>提供 mutations 便于修改 state</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"></span><br><span class="line">  <span class="title function_">toggleChecked</span> (state, id) {</span><br><span class="line">    <span class="comment">// 遍历购物车列表，找到对应id的商品，修改其选中状态</span></span><br><span class="line">    state.<span class="property">cartList</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">item</span> =&gt;</span> {</span><br><span class="line">      <span class="keyword">if</span> (item.<span class="property">goods_id</span> === id) {</span><br><span class="line">        item.<span class="property">isChecked</span> = !item.<span class="property">isChecked</span></span><br><span class="line">      }</span><br><span class="line">    })</span><br><span class="line">  },</span><br><span class="line">  <span class="title function_">allToggle</span> (state, flag) {</span><br><span class="line">    <span class="comment">// 遍历购物车列表，修改所有商品的选中状态</span></span><br><span class="line">    state.<span class="property">cartList</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">item</span> =&gt;</span> {</span><br><span class="line">      item.<span class="property">isChecked</span> = flag</span><br><span class="line">    })</span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure>
<p>给全选和商品选择框注册点击事件：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;van-checkbox</span><br><span class="line">  @click="toggleChecked(item.goods_id)"</span><br><span class="line">  :value="item.isChecked"</span><br><span class="line">&gt;&lt;/van-checkbox&gt;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">&lt;div class="all-check"&gt;</span><br><span class="line">        &lt;van-checkbox @click="allToggle" :value="isAllChecked" icon-size="18"&gt;&lt;/van-checkbox&gt;</span><br><span class="line">        全选</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">... methods: { toggleChecked (goodsId) {</span><br><span class="line">this.$store.commit('Cart/toggleChecked', goodsId) }, allToggle () {</span><br><span class="line">this.$store.commit('Cart/allToggle', !this.isAllChecked) } },</span><br></pre></td></tr></tbody></table></figure>
<p>辅助函数导入 isAllChecked</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">...<span class="title function_">mapGetters</span>(<span class="string">'Cart'</span>, [<span class="string">'countCartTotal'</span>, <span class="string">'selectedCartList'</span>, <span class="string">'selectedCartCount'</span>, <span class="string">'selectedPrice'</span>, <span class="string">'isAllChecked'</span>])</span><br></pre></td></tr></tbody></table></figure>
<h3 id="数字框修改数量功能"><a class="markdownIt-Anchor" href="#数字框修改数量功能"></a> 数字框修改数量功能</h3>
<p>提供更新购物车的接口模块：<code>api/cart.js</code></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 更新购物车商品</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">updateCart</span> = (<span class="params">obj</span>) =&gt; {</span><br><span class="line">  <span class="keyword">const</span> { goodsId, goodsNum, goodsSkuId } = obj;</span><br><span class="line">  <span class="keyword">return</span> request.<span class="title function_">post</span>(<span class="string">"/cart/update"</span>, {</span><br><span class="line">    goodsId,</span><br><span class="line">    goodsNum,</span><br><span class="line">    goodsSkuId,</span><br><span class="line">  });</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure>
<p>在 vuex 的 cart 子模块导入使用</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> { getCartList, updateCart } <span class="keyword">from</span> <span class="string">"@/api/cart"</span>;</span><br></pre></td></tr></tbody></table></figure>
<p>cart 子模块增加修改商品数量的 mutations 方法</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">changeCount</span> (state, obj) {</span><br><span class="line">      <span class="comment">// 遍历购物车列表，找到对应id的商品，修改其数量</span></span><br><span class="line">      <span class="keyword">const</span> { goodsId, goodsNum, goodsSkuId } = obj</span><br><span class="line">      state.<span class="property">cartList</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">item</span> =&gt;</span> {</span><br><span class="line">        <span class="keyword">if</span> (item.<span class="property">goods_id</span> === goodsId &amp;&amp; item.<span class="property">goods_sku_id</span> === goodsSkuId) {</span><br><span class="line">          item.<span class="property">goods_num</span> = goodsNum</span><br><span class="line">        }</span><br><span class="line">      })</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>
<p>cart 子模块增加同步购物车到后台的 actions 方法</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 将本地购物车列表同步到服务器（结算时优先调用）</span></span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">syncCartAction</span> (context) {</span><br><span class="line">      <span class="comment">// 接口只接受三个参数：goodsId、goodsNum、goodsSkuId，所以需要遍历本地购物车列表，将选中的商品拆分为三个参数</span></span><br><span class="line">      <span class="keyword">const</span> paramsObj = {}</span><br><span class="line">      context.<span class="property">state</span>.<span class="property">cartList</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">item</span> =&gt;</span> {</span><br><span class="line">        <span class="keyword">if</span> (item.<span class="property">isChecked</span>) {</span><br><span class="line">          paramsObj.<span class="property">goodsId</span> = item.<span class="property">goods_id</span></span><br><span class="line">          paramsObj.<span class="property">goodsNum</span> = item.<span class="property">goods_num</span></span><br><span class="line">          paramsObj.<span class="property">goodsSkuId</span> = item.<span class="property">goods_sku_id</span></span><br><span class="line">          <span class="title function_">updateCart</span>(paramsObj)</span><br><span class="line">        }</span><br><span class="line">      })</span><br><span class="line">      <span class="comment">// 打印console提示，显示本地提交同步的参数对象</span></span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(paramsObj)</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>
<p>给数量框组件添加绑定事件</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;CountBox</span><br><span class="line">  @input="changeCount(item.goods_id, $event, item.goods_sku_id)"</span><br><span class="line">  :value="item.goods_num"</span><br><span class="line">&gt;&lt;/CountBox&gt;</span><br></pre></td></tr></tbody></table></figure>
<p>给结算按钮添加绑定事件</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;div</span><br><span class="line">  v-if="true"</span><br><span class="line">  class="goPay"</span><br><span class="line">  @click="goPay"</span><br><span class="line">  :class="{ disabled: selectedCartCount === 0 }"</span><br><span class="line">&gt;结算({{selectedCartCount}})&lt;/div&gt;</span><br></pre></td></tr></tbody></table></figure>
<p>methods 中提供相对应的方法</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">changeCount</span> (goodsId, e, goodsSkuId) {</span><br><span class="line">      <span class="keyword">const</span> obj = {</span><br><span class="line">        <span class="attr">goodsId</span>: goodsId,</span><br><span class="line">        <span class="attr">goodsNum</span>: e,</span><br><span class="line">        <span class="attr">goodsSkuId</span>: goodsSkuId</span><br><span class="line">      }</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="title function_">commit</span>(<span class="string">'Cart/changeCount'</span>, obj)</span><br><span class="line">    },</span><br><span class="line">    <span class="title function_">goPay</span> () {</span><br><span class="line">      <span class="comment">// 先触发购物车与后台数据的同步</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="title function_">dispatch</span>(<span class="string">'Cart/syncCartAction'</span>)</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 触发真正的结算</span></span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>
<p>真正的结算待做。</p>
<h3 id="编辑切换状态删除功能"><a class="markdownIt-Anchor" href="#编辑切换状态删除功能"></a> 编辑切换状态，删除功能</h3>
<p>点击编辑按钮，结算按钮变为删除按钮。</p>
<p>给购物车页面提供一个数据用于标识是否处于编辑状态</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">data</span> () {</span><br><span class="line">  <span class="keyword">return</span> {</span><br><span class="line">    <span class="attr">isEdit</span>: <span class="literal">false</span></span><br><span class="line">  }</span><br><span class="line">},</span><br></pre></td></tr></tbody></table></figure>
<p>并监视其状态</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">watch</span>: {</span><br><span class="line">  <span class="title function_">isEdit</span> (val) {</span><br><span class="line">    <span class="keyword">if</span> (val) {</span><br><span class="line">      <span class="comment">// 说明进入编辑状态</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="title function_">commit</span>(<span class="string">'Cart/allToggle'</span>, <span class="literal">false</span>)</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">      <span class="comment">// 说明退出编辑状态</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="title function_">commit</span>(<span class="string">'Cart/allToggle'</span>, <span class="literal">true</span>)</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>相对应的对 template 中结算按钮和编辑按钮进行修改</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;span class="edit" @click="isEdit = !isEdit"&gt;</span><br><span class="line">  &lt;van-icon name="edit" /&gt;</span><br><span class="line">  编辑</span><br><span class="line">&lt;/span&gt;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">&lt;/div&gt;</span><br><span class="line">	&lt;div v-if="!isEdit" class="goPay" @click="goPay" :class="{disabled: selectedCartCount === 0}"&gt;结算({{selectedCartCount}})</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></tbody></table></figure>
<p>删除功能待做。</p>
<h3 id="删除商品"><a class="markdownIt-Anchor" href="#删除商品"></a> 删除商品</h3>
<p>封装接口模块 <code>api/cart.js</code></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 删除购物车商品</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">deleteSelected</span> = (<span class="params">cartIds</span>) =&gt; {</span><br><span class="line">  <span class="comment">// cartIds: 要删除的商品id数组</span></span><br><span class="line">  <span class="keyword">return</span> request.<span class="title function_">post</span>(<span class="string">"/cart/clear"</span>, {</span><br><span class="line">    cartIds,</span><br><span class="line">  });</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure>
<p>vuex 子模块 Cart 提供异步方法</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 删除选中的商品</span></span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">delSelCartA</span> (context) {</span><br><span class="line">      <span class="comment">// 获取选中的商品id然后进行删除</span></span><br><span class="line">      <span class="keyword">const</span> ids = context.<span class="property">getters</span>.<span class="property">selectedCartList</span>.<span class="title function_">map</span>(<span class="function"><span class="params">item</span> =&gt;</span> item.<span class="property">id</span>)</span><br><span class="line">      <span class="comment">// console.log(ids)</span></span><br><span class="line">      <span class="title function_">deleteSelected</span>(ids)</span><br><span class="line">      <span class="title class_">Toast</span>(<span class="string">'删除成功'</span>)</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 删除后重新拉取购物车数据</span></span><br><span class="line">      context.<span class="title function_">dispatch</span>(<span class="string">'getCartAction'</span>)</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>
<p>接着修复了一些小 bug：商品详情页初始不显示购物车数量、添加到购物车之后数量不会自动更新、购物车页面编辑状态退出后按钮未恢复到结算按钮。下面是修复后的 <code>store/modules/cart.js</code> 和 <code>views/productdetail.vue</code></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> { getCartList, updateCart, deleteSelected, addCart } <span class="keyword">from</span> <span class="string">"@/api/cart"</span>;</span><br><span class="line"><span class="keyword">import</span> { <span class="title class_">Toast</span> } <span class="keyword">from</span> <span class="string">"vant"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> {</span><br><span class="line">  <span class="attr">namespaced</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="title function_">state</span>(<span class="params"></span>) {</span><br><span class="line">    <span class="keyword">return</span> {</span><br><span class="line">      <span class="comment">// 提供一个数组用于存储购物车列表</span></span><br><span class="line">      <span class="attr">cartList</span>: [],</span><br><span class="line">    };</span><br><span class="line">  },</span><br><span class="line">  <span class="attr">mutations</span>: {</span><br><span class="line">    <span class="comment">// 提供方法可以设置购物车列表</span></span><br><span class="line">    <span class="title function_">setCartList</span>(<span class="params">state, newCartList</span>) {</span><br><span class="line">      state.<span class="property">cartList</span> = newCartList;</span><br><span class="line">    },</span><br><span class="line">    <span class="comment">// 修改商品选中状态</span></span><br><span class="line">    <span class="title function_">toggleChecked</span>(<span class="params">state, id</span>) {</span><br><span class="line">      <span class="comment">// 遍历购物车列表，找到对应id的商品，修改其选中状态</span></span><br><span class="line">      state.<span class="property">cartList</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> {</span><br><span class="line">        <span class="keyword">if</span> (item.<span class="property">goods_id</span> === id) {</span><br><span class="line">          item.<span class="property">isChecked</span> = !item.<span class="property">isChecked</span>;</span><br><span class="line">        }</span><br><span class="line">      });</span><br><span class="line">    },</span><br><span class="line">    <span class="comment">// 全选和反选</span></span><br><span class="line">    <span class="title function_">allToggle</span>(<span class="params">state, flag</span>) {</span><br><span class="line">      <span class="comment">// 遍历购物车列表，修改所有商品的选中状态</span></span><br><span class="line">      state.<span class="property">cartList</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> {</span><br><span class="line">        item.<span class="property">isChecked</span> = flag;</span><br><span class="line">      });</span><br><span class="line">    },</span><br><span class="line">    <span class="comment">// 改变商品数量</span></span><br><span class="line">    <span class="title function_">changeCount</span>(<span class="params">state, obj</span>) {</span><br><span class="line">      <span class="comment">// 遍历购物车列表，找到对应id的商品，修改其数量</span></span><br><span class="line">      <span class="keyword">const</span> { goodsId, goodsNum, goodsSkuId } = obj;</span><br><span class="line">      state.<span class="property">cartList</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> {</span><br><span class="line">        <span class="keyword">if</span> (item.<span class="property">goods_id</span> === goodsId &amp;&amp; item.<span class="property">goods_sku_id</span> === goodsSkuId) {</span><br><span class="line">          item.<span class="property">goods_num</span> = goodsNum;</span><br><span class="line">        }</span><br><span class="line">      });</span><br><span class="line">    },</span><br><span class="line">  },</span><br><span class="line">  <span class="attr">actions</span>: {</span><br><span class="line">    <span class="comment">// 添加商品到购物车</span></span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">addCartAction</span>(<span class="params">context, obj</span>) {</span><br><span class="line">      <span class="comment">// 先判断是否已经存在该商品，如果存在，则只修改商品数量</span></span><br><span class="line">      <span class="keyword">const</span> { goodsId, goodsNum, goodsSkuId } = obj;</span><br><span class="line">      context.<span class="property">state</span>.<span class="property">cartList</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> {</span><br><span class="line">        <span class="keyword">if</span> (item.<span class="property">goods_id</span> === goodsId &amp;&amp; item.<span class="property">goods_sku_id</span> === goodsSkuId) {</span><br><span class="line">          item.<span class="property">goods_num</span> += goodsNum;</span><br><span class="line">        }</span><br><span class="line">      });</span><br><span class="line">      <span class="comment">// 如果不存在，则添加到购物车列表</span></span><br><span class="line">      <span class="keyword">await</span> <span class="title function_">addCart</span>(goodsId, goodsNum, goodsSkuId);</span><br><span class="line">      <span class="keyword">await</span> context.<span class="title function_">dispatch</span>(<span class="string">"getCartAction"</span>); <span class="comment">// 重新拉取购物车信息</span></span><br><span class="line">      <span class="title class_">Toast</span>(<span class="string">"添加成功"</span>);</span><br><span class="line">    },</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 异步获取购物车列表</span></span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">getCartAction</span>(<span class="params">context</span>) {</span><br><span class="line">      <span class="keyword">const</span> { data } = <span class="keyword">await</span> <span class="title function_">getCartList</span>();</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 由于后台返回数据中不包括是否选中的状态，所以本地自己维护，给每一项添加上被选中的状态</span></span><br><span class="line">      data.<span class="property">list</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">element</span>) =&gt;</span> {</span><br><span class="line">        element.<span class="property">isChecked</span> = <span class="literal">true</span>;</span><br><span class="line">      });</span><br><span class="line">      context.<span class="title function_">commit</span>(<span class="string">"setCartList"</span>, data.<span class="property">list</span>);</span><br><span class="line">    },</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将本地购物车列表同步到服务器（结算或者离开购物车页面立刻同步）</span></span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">syncCartAction</span>(<span class="params">context</span>) {</span><br><span class="line">      <span class="comment">// 接口只接受三个参数：goodsId、goodsNum、goodsSkuId，所以需要遍历本地购物车列表，将选中的商品拆分为三个参数</span></span><br><span class="line">      <span class="keyword">const</span> paramsObj = {};</span><br><span class="line">      context.<span class="property">state</span>.<span class="property">cartList</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> {</span><br><span class="line">        <span class="keyword">if</span> (item.<span class="property">isChecked</span>) {</span><br><span class="line">          paramsObj.<span class="property">goodsId</span> = item.<span class="property">goods_id</span>;</span><br><span class="line">          paramsObj.<span class="property">goodsNum</span> = item.<span class="property">goods_num</span>;</span><br><span class="line">          paramsObj.<span class="property">goodsSkuId</span> = item.<span class="property">goods_sku_id</span>;</span><br><span class="line">          <span class="title function_">updateCart</span>(paramsObj);</span><br><span class="line">        }</span><br><span class="line">      });</span><br><span class="line">      <span class="comment">// console.log(paramsObj)</span></span><br><span class="line">    },</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 删除选中的商品</span></span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">delSelCartA</span>(<span class="params">context</span>) {</span><br><span class="line">      <span class="comment">// 获取选中的商品id然后进行删除</span></span><br><span class="line">      <span class="keyword">const</span> ids = context.<span class="property">getters</span>.<span class="property">selectedCartList</span>.<span class="title function_">map</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> item.<span class="property">id</span>);</span><br><span class="line">      <span class="comment">// console.log(ids)</span></span><br><span class="line">      <span class="title function_">deleteSelected</span>(ids);</span><br><span class="line">      <span class="title class_">Toast</span>(<span class="string">"删除成功"</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 删除后重新拉取购物车数据</span></span><br><span class="line">      context.<span class="title function_">dispatch</span>(<span class="string">"getCartAction"</span>);</span><br><span class="line">    },</span><br><span class="line">  },</span><br><span class="line">  <span class="attr">getters</span>: {</span><br><span class="line">    <span class="comment">// 求所有的商品累加总数</span></span><br><span class="line">    <span class="title function_">countCartTotal</span>(<span class="params">state</span>) {</span><br><span class="line">      <span class="keyword">return</span> state.<span class="property">cartList</span>.<span class="title function_">reduce</span>(</span><br><span class="line">        <span class="function">(<span class="params">sum, item, index</span>) =&gt;</span> sum + item.<span class="property">goods_num</span>,</span><br><span class="line">        <span class="number">0</span></span><br><span class="line">      );</span><br><span class="line">    },</span><br><span class="line">    <span class="comment">// 选中的商品项目</span></span><br><span class="line">    <span class="title function_">selectedCartList</span>(<span class="params">state</span>) {</span><br><span class="line">      <span class="comment">// filter只会接收回调结果为true的元素，所以可以不用做其他判断</span></span><br><span class="line">      <span class="keyword">return</span> state.<span class="property">cartList</span>.<span class="title function_">filter</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> item.<span class="property">isChecked</span>);</span><br><span class="line">    },</span><br><span class="line">    <span class="comment">// 选中的商品项目数量</span></span><br><span class="line">    <span class="title function_">selectedCartCount</span>(<span class="params">state, getters</span>) {</span><br><span class="line">      <span class="comment">// 这里的getters可以获取到上面定义的getters</span></span><br><span class="line">      <span class="keyword">return</span> <span class="title class_">Array</span>.<span class="title function_">isArray</span>(getters.<span class="property">selectedCartList</span>)</span><br><span class="line">        ? getters.<span class="property">selectedCartList</span>.<span class="title function_">reduce</span>(</span><br><span class="line">            <span class="function">(<span class="params">sum, item, index</span>) =&gt;</span> sum + item.<span class="property">goods_num</span>,</span><br><span class="line">            <span class="number">0</span></span><br><span class="line">          )</span><br><span class="line">        : <span class="number">0</span>;</span><br><span class="line">    },</span><br><span class="line">    <span class="comment">// 选中的商品总价</span></span><br><span class="line">    <span class="title function_">selectedPrice</span>(<span class="params">state, getters</span>) {</span><br><span class="line">      <span class="comment">// toFixed(2) 保留两位小数</span></span><br><span class="line">      <span class="keyword">return</span> <span class="title class_">Array</span>.<span class="title function_">isArray</span>(getters.<span class="property">selectedCartList</span>)</span><br><span class="line">        ? getters.<span class="property">selectedCartList</span></span><br><span class="line">            .<span class="title function_">reduce</span>(</span><br><span class="line">              <span class="function">(<span class="params">sum, item, index</span>) =&gt;</span></span><br><span class="line">                sum + item.<span class="property">goods_num</span> * item.<span class="property">goods</span>.<span class="property">goods_price_min</span>,</span><br><span class="line">              <span class="number">0</span></span><br><span class="line">            )</span><br><span class="line">            .<span class="title function_">toFixed</span>(<span class="number">2</span>)</span><br><span class="line">        : <span class="number">0</span>;</span><br><span class="line">    },</span><br><span class="line">    <span class="comment">// 是否全选</span></span><br><span class="line">    <span class="title function_">isAllChecked</span>(<span class="params">state</span>) {</span><br><span class="line">      <span class="comment">// every返回true，说明数组中每一项都为true，否则为false</span></span><br><span class="line">      <span class="keyword">return</span> state.<span class="property">cartList</span>.<span class="title function_">every</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> item.<span class="property">isChecked</span>);</span><br><span class="line">    },</span><br><span class="line">  },</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure>
<p>商品详情页增加：</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> { mapGetters, mapActions } <span class="keyword">from</span> <span class="string">'vuex'</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"><span class="attr">computed</span>: {</span><br><span class="line">    ...<span class="title function_">mapGetters</span>(<span class="string">'Cart'</span>, [<span class="string">'countCartTotal'</span>]),</span><br><span class="line">    ...<span class="title function_">mapActions</span>(<span class="string">'Cart'</span>, [<span class="string">'getCartAction'</span>]),</span><br><span class="line">    <span class="title function_">detailId</span> () {</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">$route</span>.<span class="property">params</span>.<span class="property">id</span></span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> match  <span class="comment">// 此为created内</span></span><br><span class="line">    <span class="keyword">while</span> ((match = regex.<span class="title function_">exec</span>(htmlString)) !== <span class="literal">null</span>) {</span><br><span class="line">      srcArray.<span class="title function_">push</span>(match[<span class="number">1</span>]) <span class="comment">// 将匹配到的 src URL 添加到数组中</span></span><br><span class="line">    }</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">imgSrcArray</span> = srcArray</span><br><span class="line">    <span class="comment">// console.log(this.imgSrcArray) // 输出结果数组</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 异步获取购物车列表</span></span><br><span class="line">    <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">getCartAction</span></span><br><span class="line">    <span class="comment">// 获取购物车商品总数</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">cartTotal</span> = <span class="variable language_">this</span>.<span class="property">countCartTotal</span></span><br><span class="line">    <span class="comment">// console.log(this.cartTotal)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">// 说明有token，可以直接加入购物车</span></span><br><span class="line">      <span class="keyword">const</span> obj = { <span class="comment">// 此为添加到购物车的点击事件</span></span><br><span class="line">        <span class="attr">goodsId</span>: <span class="variable language_">this</span>.<span class="property">detailId</span>,</span><br><span class="line">        <span class="attr">goodsNum</span>: <span class="variable language_">this</span>.<span class="property">addCount</span>,</span><br><span class="line">        <span class="attr">goodsSkuId</span>: <span class="variable language_">this</span>.<span class="property">goodsSkuId</span></span><br><span class="line">      }</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="title function_">dispatch</span>(<span class="string">'Cart/addCartAction'</span>, obj)</span><br><span class="line">      <span class="comment">// 获取购物车商品总数</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">cartTotal</span> = <span class="variable language_">this</span>.<span class="property">countCartTotal</span></span><br><span class="line">      <span class="variable language_">this</span>.$toast(<span class="string">'加入购物车成功！'</span>)</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">showPannel</span> = <span class="literal">false</span> <span class="comment">// 关闭弹层</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="attr">watch</span>: {</span><br><span class="line">    <span class="comment">// 监听 countCartTotal 的变化，自动更新 cartTotal</span></span><br><span class="line">    <span class="title function_">countCartTotal</span> (newVal) {</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">cartTotal</span> = newVal</span><br><span class="line">    }</span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure>
<h3 id="空购物车处理"><a class="markdownIt-Anchor" href="#空购物车处理"></a> 空购物车处理</h3>
<p>将除标题以外的盒子用大盒子包裹起来：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class="cart"&gt;</span><br><span class="line">    &lt;van-nav-bar title="购物车" fixed /&gt;</span><br><span class="line">    &lt;!-- 判断登录，且购物车列表不为空才渲染 --&gt;</span><br><span class="line">    &lt;div v-if="isLogin &amp;&amp; cartList.length &gt; 0"&gt;...&lt;/div&gt;</span><br><span class="line">    &lt;!-- 未登录或购物车列表为空时渲染提示页面 --&gt;</span><br><span class="line">    &lt;van-empty v-else description="空空如也，快去逛逛吧~"&gt;</span><br><span class="line">      &lt;van-button</span><br><span class="line">        round</span><br><span class="line">        type="danger"</span><br><span class="line">        class="bottom-button"</span><br><span class="line">        @click="$router.push('/home')"</span><br><span class="line">        &gt;去逛逛&lt;/van-button</span><br><span class="line">      &gt;</span><br><span class="line">    &lt;/van-empty&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></tbody></table></figure>
<p>并提供计算属性</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">isLogin</span> () {</span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="property">getters</span>.<span class="property">token</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>并引入对应 Empty 组件的 css 样式</p>
<figure class="highlight css"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.bottom-button</span> {</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">160px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">40px</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h2 id="地址管理"><a class="markdownIt-Anchor" href="#地址管理"></a> 地址管理</h2>
<blockquote>
<p>地址选择里面涉及到一个地区选择器，可以自行定义数据也可以使用官方的数据。可以参考：Vant 使用 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://blog.csdn.net/qq_51055690/article/details/126281265">Vant Area Data</a></p>
</blockquote>
<h3 id="配置"><a class="markdownIt-Anchor" href="#配置"></a> 配置</h3>
<p>封装 api 接口：<code>api/address.js</code></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">"@/utils/request"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取地址列表</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">getAddressList</span> = (<span class="params"></span>) =&gt; {</span><br><span class="line">  <span class="keyword">return</span> request.<span class="title function_">get</span>(<span class="string">"/address/list"</span>);</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取某个地址的详情</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">getAddressDetail</span> = (<span class="params">addressId</span>) =&gt; {</span><br><span class="line">  <span class="keyword">return</span> request.<span class="title function_">get</span>(<span class="string">"/address/detail"</span>, {</span><br><span class="line">    <span class="attr">params</span>: {</span><br><span class="line">      <span class="attr">addressId</span>: addressId,</span><br><span class="line">    },</span><br><span class="line">  });</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加收货地址</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">addAddress</span> = (<span class="params">dataObj</span>) =&gt; {</span><br><span class="line">  <span class="comment">// console.log('api_dataObj', dataObj)</span></span><br><span class="line">  <span class="comment">// 直接使用dataObj中的数据</span></span><br><span class="line">  <span class="keyword">return</span> request.<span class="title function_">post</span>(<span class="string">"/address/add"</span>, {</span><br><span class="line">    <span class="attr">form</span>: {</span><br><span class="line">      <span class="attr">name</span>: dataObj.<span class="property">name</span>,</span><br><span class="line">      <span class="attr">phone</span>: dataObj.<span class="property">phone</span>,</span><br><span class="line">      <span class="attr">region</span>: dataObj.<span class="property">region</span>,</span><br><span class="line">      <span class="attr">detail</span>: dataObj.<span class="property">detail</span>,</span><br><span class="line">    },</span><br><span class="line">  });</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="comment">// 更新收货地址</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">updateAddress</span> = (<span class="params">dataObj</span>) =&gt; {</span><br><span class="line">  <span class="comment">// 直接使用dataObj中的数据</span></span><br><span class="line">  <span class="keyword">return</span> request.<span class="title function_">post</span>(<span class="string">"/address/edit"</span>, {</span><br><span class="line">    <span class="attr">addressId</span>: dataObj.<span class="property">address_id</span>,</span><br><span class="line">    <span class="attr">form</span>: dataObj.<span class="property">form</span>,</span><br><span class="line">  });</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置默认地址</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">setDefaultAddress</span> = (<span class="params">addressId</span>) =&gt; {</span><br><span class="line">  <span class="keyword">return</span> request.<span class="title function_">post</span>(<span class="string">"/address/setDefault"</span>, { addressId });</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="comment">// 删除收货地址</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">deleteAddress</span> = (<span class="params">addressId</span>) =&gt; {</span><br><span class="line">  <span class="keyword">return</span> request.<span class="title function_">post</span>(<span class="string">"/address/remove"</span>, { addressId });</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure>
<p>Vuex 子模块：<code>store/modules/address.js</code></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> {</span><br><span class="line">  getAddressList,</span><br><span class="line">  updateAddress,</span><br><span class="line">  deleteAddress,</span><br><span class="line">  getAddressDetail,</span><br><span class="line">  addAddress,</span><br><span class="line">  setDefaultAddress,</span><br><span class="line">} <span class="keyword">from</span> <span class="string">"@/api/address"</span>;</span><br><span class="line"><span class="comment">// import {Toast} from 'vant'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> {</span><br><span class="line">  <span class="attr">namespaced</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="title function_">state</span>(<span class="params"></span>) {</span><br><span class="line">    <span class="keyword">return</span> {</span><br><span class="line">      <span class="title class_">AddressList</span>: [],</span><br><span class="line">      <span class="comment">// 初始化时从 localStorage 中获取默认地址 ID</span></span><br><span class="line">      <span class="attr">defaultAddressId</span>: <span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">"defaultAddressId"</span>) || <span class="string">""</span>,</span><br><span class="line">    };</span><br><span class="line">  },</span><br><span class="line">  <span class="attr">mutations</span>: {</span><br><span class="line">    <span class="comment">// 编辑地址</span></span><br><span class="line">    <span class="title function_">editAddress</span>(<span class="params">state, newAddress</span>) {</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">AddressList</span> = newAddress;</span><br><span class="line">    },</span><br><span class="line">    <span class="comment">// 更新默认地址的 ID 并保存到 localStorage</span></span><br><span class="line">    <span class="title function_">setDefaultAddressId</span>(<span class="params">state, addressId</span>) {</span><br><span class="line">      state.<span class="property">defaultAddressId</span> = addressId;</span><br><span class="line">      <span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">"defaultAddressId"</span>, addressId); <span class="comment">// 保存到 localStorage</span></span><br><span class="line">    },</span><br><span class="line">  },</span><br><span class="line">  <span class="attr">actions</span>: {</span><br><span class="line">    <span class="comment">// 获取地址列表</span></span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">getAddressList</span>(<span class="params"></span>) {</span><br><span class="line">      <span class="keyword">const</span> { data } = <span class="keyword">await</span> <span class="title function_">getAddressList</span>();</span><br><span class="line">      <span class="keyword">return</span> data;</span><br><span class="line">    },</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取某个地址的详情</span></span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">getAddressDetail</span>(<span class="params">context, addressId</span>) {</span><br><span class="line">      <span class="keyword">if</span> (!addressId) {</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">"Address ID is required"</span>);</span><br><span class="line">      }</span><br><span class="line">      <span class="comment">// console.log('getAddressDetail被调用，addressId：', addressId)</span></span><br><span class="line">      <span class="keyword">const</span> data = <span class="keyword">await</span> <span class="title function_">getAddressDetail</span>(addressId);</span><br><span class="line">      <span class="comment">// console.log('getAddressDetail返回的数据：', data)</span></span><br><span class="line">      <span class="keyword">return</span> data;</span><br><span class="line">    },</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 添加地址</span></span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">addAddress</span>(<span class="params">context, dataObj</span>) {</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">"vuex_dataObj:"</span>, dataObj);</span><br><span class="line">      <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">addAddress</span>(dataObj);</span><br><span class="line">      <span class="keyword">if</span> (res.<span class="property">status</span> === <span class="number">200</span>) {</span><br><span class="line">        <span class="comment">// 成功后，重新通过上面的actions方法拉取地址列表</span></span><br><span class="line">        context.<span class="title function_">dispatch</span>(<span class="string">"getAddressList"</span>);</span><br><span class="line">      }</span><br><span class="line">    },</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置默认地址(无用的接口，设置后拉取列表，其中不包含默认地址是否设置的状态)</span></span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">setDefaultAddress</span>(<span class="params">context, addressId</span>) {</span><br><span class="line">      <span class="comment">// 发送请求</span></span><br><span class="line">      <span class="keyword">await</span> <span class="title function_">setDefaultAddress</span>(addressId);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 成功后，重新拉取地址列表</span></span><br><span class="line">      <span class="title function_">getAddressList</span>();</span><br><span class="line">    },</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 更新地址</span></span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">updateAddress</span>(<span class="params">context, dataObj</span>) {</span><br><span class="line">      <span class="comment">// 发送更新请求</span></span><br><span class="line">      <span class="keyword">await</span> <span class="title function_">updateAddress</span>(dataObj);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 更新之后，重新拉取地址列表</span></span><br><span class="line">      <span class="title function_">getAddressList</span>();</span><br><span class="line">    },</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 删除地址</span></span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">deleteAddress</span>(<span class="params">context, addressId</span>) {</span><br><span class="line">      <span class="comment">// 发送删除请求</span></span><br><span class="line">      <span class="keyword">await</span> <span class="title function_">deleteAddress</span>(addressId);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 删除成功后，重新拉取地址列表</span></span><br><span class="line">      <span class="title function_">getAddressList</span>();</span><br><span class="line">    },</span><br><span class="line">  },</span><br><span class="line">  <span class="attr">getters</span>: {</span><br><span class="line">    <span class="comment">// 获取默认地址 ID（优先从 Vuex 中获取，否则从 localStorage 中获取）</span></span><br><span class="line">    <span class="attr">getDefaultAddressId</span>: <span class="function">(<span class="params">state</span>) =&gt;</span></span><br><span class="line">      state.<span class="property">defaultAddressId</span> || <span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">"defaultAddressId"</span>),</span><br><span class="line">  },</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure>
<p>Vuex 子模块 addressMap 处理引入的 vant 官方地区数据：<code>store/modules/addressMap.js</code></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> { areaList } <span class="keyword">from</span> <span class="string">"@vant/area-data"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> state = {</span><br><span class="line">  <span class="comment">// 代码到名称的映射</span></span><br><span class="line">  <span class="attr">codeToNameMap</span>: {</span><br><span class="line">    <span class="attr">provinceMap</span>: {},</span><br><span class="line">    <span class="attr">cityMap</span>: {},</span><br><span class="line">    <span class="attr">countyMap</span>: {},</span><br><span class="line">  },</span><br><span class="line">  <span class="comment">// 名称到代码的映射</span></span><br><span class="line">  <span class="attr">nameToCodeMap</span>: {</span><br><span class="line">    <span class="attr">provinceMap</span>: {},</span><br><span class="line">    <span class="attr">cityMap</span>: {},</span><br><span class="line">    <span class="attr">countyMap</span>: {},</span><br><span class="line">  },</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> getters = {</span><br><span class="line">  <span class="comment">// 根据名称获取代码</span></span><br><span class="line">  <span class="attr">nameToCode</span>: <span class="function">(<span class="params">state</span>) =&gt;</span> <span class="function">(<span class="params">name</span>) =&gt;</span> {</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      state.<span class="property">nameToCodeMap</span>.<span class="property">provinceMap</span>[name] ||</span><br><span class="line">      state.<span class="property">nameToCodeMap</span>.<span class="property">cityMap</span>[name] ||</span><br><span class="line">      state.<span class="property">nameToCodeMap</span>.<span class="property">countyMap</span>[name] ||</span><br><span class="line">      <span class="literal">null</span></span><br><span class="line">    );</span><br><span class="line">  },</span><br><span class="line">  <span class="comment">// 根据代码获取名称</span></span><br><span class="line">  <span class="attr">codeToName</span>: <span class="function">(<span class="params">state</span>) =&gt;</span> <span class="function">(<span class="params">code</span>) =&gt;</span> {</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      state.<span class="property">codeToNameMap</span>.<span class="property">provinceMap</span>[code] ||</span><br><span class="line">      state.<span class="property">codeToNameMap</span>.<span class="property">cityMap</span>[code] ||</span><br><span class="line">      state.<span class="property">codeToNameMap</span>.<span class="property">countyMap</span>[code] ||</span><br><span class="line">      <span class="literal">null</span></span><br><span class="line">    );</span><br><span class="line">  },</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mutations = {</span><br><span class="line">  <span class="title function_">SET_CODE_TO_NAME_MAP</span>(<span class="params">state, { map, type }</span>) {</span><br><span class="line">    state.<span class="property">codeToNameMap</span>[type] = map;</span><br><span class="line">  },</span><br><span class="line">  <span class="title function_">SET_NAME_TO_CODE_MAP</span>(<span class="params">state, { map, type }</span>) {</span><br><span class="line">    state.<span class="property">nameToCodeMap</span>[type] = map;</span><br><span class="line">  },</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> actions = {</span><br><span class="line">  <span class="comment">// 构建映射表</span></span><br><span class="line">  <span class="title function_">buildReverseMaps</span>(<span class="params">{ commit }</span>) {</span><br><span class="line">    <span class="keyword">const</span> provinceCodeToNameMap = <span class="title function_">buildCodeToNameMap</span>(areaList.<span class="property">province_list</span>);</span><br><span class="line">    <span class="keyword">const</span> cityCodeToNameMap = <span class="title function_">buildCodeToNameMap</span>(areaList.<span class="property">city_list</span>);</span><br><span class="line">    <span class="keyword">const</span> countyCodeToNameMap = <span class="title function_">buildCodeToNameMap</span>(areaList.<span class="property">county_list</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> provinceNameToCodeMap = <span class="title function_">buildNameToCodeMap</span>(areaList.<span class="property">province_list</span>);</span><br><span class="line">    <span class="keyword">const</span> cityNameToCodeMap = <span class="title function_">buildNameToCodeMap</span>(areaList.<span class="property">city_list</span>);</span><br><span class="line">    <span class="keyword">const</span> countyNameToCodeMap = <span class="title function_">buildNameToCodeMap</span>(areaList.<span class="property">county_list</span>);</span><br><span class="line"></span><br><span class="line">    <span class="title function_">commit</span>(<span class="string">"SET_CODE_TO_NAME_MAP"</span>, {</span><br><span class="line">      <span class="attr">map</span>: provinceCodeToNameMap,</span><br><span class="line">      <span class="attr">type</span>: <span class="string">"provinceMap"</span>,</span><br><span class="line">    });</span><br><span class="line">    <span class="title function_">commit</span>(<span class="string">"SET_CODE_TO_NAME_MAP"</span>, { <span class="attr">map</span>: cityCodeToNameMap, <span class="attr">type</span>: <span class="string">"cityMap"</span> });</span><br><span class="line">    <span class="title function_">commit</span>(<span class="string">"SET_CODE_TO_NAME_MAP"</span>, {</span><br><span class="line">      <span class="attr">map</span>: countyCodeToNameMap,</span><br><span class="line">      <span class="attr">type</span>: <span class="string">"countyMap"</span>,</span><br><span class="line">    });</span><br><span class="line"></span><br><span class="line">    <span class="title function_">commit</span>(<span class="string">"SET_NAME_TO_CODE_MAP"</span>, {</span><br><span class="line">      <span class="attr">map</span>: provinceNameToCodeMap,</span><br><span class="line">      <span class="attr">type</span>: <span class="string">"provinceMap"</span>,</span><br><span class="line">    });</span><br><span class="line">    <span class="title function_">commit</span>(<span class="string">"SET_NAME_TO_CODE_MAP"</span>, { <span class="attr">map</span>: cityNameToCodeMap, <span class="attr">type</span>: <span class="string">"cityMap"</span> });</span><br><span class="line">    <span class="title function_">commit</span>(<span class="string">"SET_NAME_TO_CODE_MAP"</span>, {</span><br><span class="line">      <span class="attr">map</span>: countyNameToCodeMap,</span><br><span class="line">      <span class="attr">type</span>: <span class="string">"countyMap"</span>,</span><br><span class="line">    });</span><br><span class="line">  },</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="comment">// 构建代码到名称的映射</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">buildCodeToNameMap</span>(<span class="params">list</span>) {</span><br><span class="line">  <span class="keyword">const</span> map = {};</span><br><span class="line">  <span class="title class_">Object</span>.<span class="title function_">keys</span>(list).<span class="title function_">forEach</span>(<span class="function">(<span class="params">code</span>) =&gt;</span> {</span><br><span class="line">    map[code] = list[code]; <span class="comment">// 代码作为键，名称作为值</span></span><br><span class="line">  });</span><br><span class="line">  <span class="keyword">return</span> map;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 构建名称到代码的映射</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">buildNameToCodeMap</span>(<span class="params">list</span>) {</span><br><span class="line">  <span class="keyword">const</span> map = {};</span><br><span class="line">  <span class="title class_">Object</span>.<span class="title function_">keys</span>(list).<span class="title function_">forEach</span>(<span class="function">(<span class="params">code</span>) =&gt;</span> {</span><br><span class="line">    map[list[code]] = code; <span class="comment">// 名称作为键，代码作为值</span></span><br><span class="line">  });</span><br><span class="line">  <span class="keyword">return</span> map;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> {</span><br><span class="line">  <span class="attr">namespaced</span>: <span class="literal">true</span>,</span><br><span class="line">  state,</span><br><span class="line">  getters,</span><br><span class="line">  mutations,</span><br><span class="line">  actions,</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure>
<p>配置路由并新增守卫规则：<code>router/index.js</code></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Address</span> <span class="keyword">from</span> <span class="string">'@/views/address/index.vue'</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">AddressEdit</span> <span class="keyword">from</span> <span class="string">'@/views/address/edit.vue'</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">  { <span class="attr">path</span>: <span class="string">'/address/manage'</span>, <span class="attr">component</span>: <span class="title class_">Address</span> },</span><br><span class="line">  { <span class="attr">path</span>: <span class="string">'/address/edit'</span>, <span class="attr">component</span>: <span class="title class_">AddressEdit</span> },</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义数组存储需要登录才能访问的路由</span></span><br><span class="line"><span class="keyword">const</span> authNeedRouters = [<span class="string">'/myorder'</span>, <span class="string">'/pay'</span>, <span class="string">'/address'</span>, <span class="string">'/address/edit'</span>, <span class="string">'/address/manage'</span>]</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h3 id="地址列表"><a class="markdownIt-Anchor" href="#地址列表"></a> 地址列表</h3>
<p>地址列表代码：<code>views/address/index.vue</code></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class="address-list"&gt;</span><br><span class="line">    &lt;van-nav-bar</span><br><span class="line">      fixed</span><br><span class="line">      title="地址列表"</span><br><span class="line">      left-arrow</span><br><span class="line">      @click-left="$router.go(-1)"</span><br><span class="line">    /&gt;</span><br><span class="line">    &lt;div v-if="list.length &gt; 0"&gt;</span><br><span class="line">      &lt;!-- 用于区分的文字 --&gt;</span><br><span class="line">      &lt;div class="address-list-header"&gt;</span><br><span class="line">        &lt;p class="header-text"&gt;请选择或管理收货地址&lt;/p&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">      &lt;!-- 地址列表 --&gt;</span><br><span class="line">      &lt;van-address-list</span><br><span class="line">        v-model="chosenAddressId"</span><br><span class="line">        :switchable="true"</span><br><span class="line">        :list="list"</span><br><span class="line">        :disabled-list="disabledList"</span><br><span class="line">        :disabled-text="disabledText"</span><br><span class="line">        default-tag-text="默认"</span><br><span class="line">        @add="onAdd"</span><br><span class="line">        @edit="onEdit"</span><br><span class="line">      /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;van-empty v-else description="空空如也"&gt;</span><br><span class="line">      &lt;van-button round type="danger" class="bottom-button" @click="onAdd"</span><br><span class="line">        &gt;添加地址&lt;/van-button</span><br><span class="line">      &gt;</span><br><span class="line">    &lt;/van-empty&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import { Toast } from "vant";</span><br><span class="line">import { mapActions, mapGetters } from "vuex";</span><br><span class="line"></span><br><span class="line">export default {</span><br><span class="line">  name: "AddressList",</span><br><span class="line">  data() {</span><br><span class="line">    return {</span><br><span class="line">      // 默认选中的地址id</span><br><span class="line">      chosenAddressId: "",</span><br><span class="line">      // 地址列表</span><br><span class="line">      list: [],</span><br><span class="line">      // 禁用状态的地址列表（超出快递范围）</span><br><span class="line">      disabledList: [],</span><br><span class="line">    };</span><br><span class="line">  },</span><br><span class="line">  computed: {</span><br><span class="line">    ...mapGetters("AddressMap", ["codeToName"]),</span><br><span class="line">    ...mapGetters("Address", ["getDefaultAddressId"]),</span><br><span class="line">    disabledText() {</span><br><span class="line">      return this.disabledList.length &gt; 0 ? "以下地址超出配送范围" : "";</span><br><span class="line">    },</span><br><span class="line">  },</span><br><span class="line">  async created() {</span><br><span class="line">    try {</span><br><span class="line">      // 构建地区映射表</span><br><span class="line">      await this.buildReverseMaps();</span><br><span class="line"></span><br><span class="line">      // 获取地址列表</span><br><span class="line">      const response = await this.getAddressList();</span><br><span class="line">      // console.log('获取地址列表成功：', response)</span><br><span class="line">      const addressData = response.list || [];</span><br><span class="line">      // console.log('地址数据：', addressData)</span><br><span class="line"></span><br><span class="line">      // 格式化地址列表数据</span><br><span class="line">      this.list = addressData</span><br><span class="line">        .filter((item) =&gt; !item.is_disabled) // 过滤掉禁用的地址</span><br><span class="line">        .map((item) =&gt; ({</span><br><span class="line">          id: item.address_id,</span><br><span class="line">          name: item.name,</span><br><span class="line">          tel: item.phone,</span><br><span class="line">          address: this.formatAddress(item),</span><br><span class="line">          isDefault: item.is_default || false,</span><br><span class="line">        }));</span><br><span class="line"></span><br><span class="line">      // 从Vuex中获取默认地址的id</span><br><span class="line">      const defaultAddressId = this.getDefaultAddressId;</span><br><span class="line">      console.log("默认地址id：", defaultAddressId);</span><br><span class="line"></span><br><span class="line">      if (Number(defaultAddressId) !== -1) {</span><br><span class="line">        // 遍历比对列表每一项的id是否与defaultAddressId相等，找到后返回索引（强等于比较，注意类型）</span><br><span class="line">        const defaultIndex = this.list.findIndex(</span><br><span class="line">          (item) =&gt; Number(item.id) === Number(defaultAddressId)</span><br><span class="line">        );</span><br><span class="line">        if (Number(defaultIndex) !== -1) {</span><br><span class="line">          // 找到后设置为默认地址</span><br><span class="line">          this.list[defaultIndex].isDefault = true;</span><br><span class="line">          this.chosenAddressId = Number(defaultAddressId);</span><br><span class="line">        }</span><br><span class="line">      } else {</span><br><span class="line">        // Vuex没有默认地址，则默认选中第一个地址</span><br><span class="line">        Toast("小主还没有默认地址哦\n快来设置一个吧❤️");</span><br><span class="line">        console.log("未找到有效的默认地址");</span><br><span class="line">        this.chosenAddressId = this.list[0].id || "";</span><br><span class="line">      }</span><br><span class="line">      // 设置禁用的地址列表</span><br><span class="line">      this.disabledList = addressData</span><br><span class="line">        .filter((item) =&gt; item.is_disabled)</span><br><span class="line">        .map((item) =&gt; ({</span><br><span class="line">          id: item.address_id,</span><br><span class="line">          name: item.name,</span><br><span class="line">          tel: item.phone,</span><br><span class="line">          address: this.formatAddress(item),</span><br><span class="line">          isDefault: item.is_default || false,</span><br><span class="line">        }));</span><br><span class="line">    } catch (error) {</span><br><span class="line">      // console.error('获取地址列表失败：', error)</span><br><span class="line">      Toast.fail("获取地址列表失败");</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  methods: {</span><br><span class="line">    ...mapActions("Address", ["getAddressList"]),</span><br><span class="line">    ...mapActions("AddressMap", ["buildReverseMaps"]),</span><br><span class="line">    // 格式化地址：</span><br><span class="line">    formatAddress(item) {</span><br><span class="line">      const provinceName = this.codeToName(item.province_id) || "";</span><br><span class="line">      const cityName = this.codeToName(item.city_id) || "";</span><br><span class="line">      const countyName = this.codeToName(item.county_id) || "";</span><br><span class="line">      const detailAddress = item.detail || "";</span><br><span class="line">      const result = `${provinceName}${cityName}${countyName}${detailAddress}`;</span><br><span class="line">      // console.log('codeToname：', this.codeToName(item.province_id))</span><br><span class="line">      return result;</span><br><span class="line">    },</span><br><span class="line">    onAdd() {</span><br><span class="line">      this.$router.push("/address/edit?adsid=");</span><br><span class="line">    },</span><br><span class="line">    onEdit(item) {</span><br><span class="line">      // console.log('跳转到编辑：', item)</span><br><span class="line">      this.$router.push(`/address/edit?adsid=${item.id}`);</span><br><span class="line">    },</span><br><span class="line">  },</span><br><span class="line">};</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped lang="less"&gt;</span><br><span class="line">.custom-nav-bar {</span><br><span class="line">  background-color: #ffffff; // 导航栏背景色</span><br><span class="line">  height: 50px; // 设置导航栏的高度</span><br><span class="line">  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1); // 添加阴影效果</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">.address-list {</span><br><span class="line">  padding-top: 60px; // 增加顶部内边距，以避免内容被导航栏遮挡</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">.address-list-header {</span><br><span class="line">  padding: 10px 16px;</span><br><span class="line">  background-color: #f8f8f8;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">.header-text {</span><br><span class="line">  font-size: 16px;</span><br><span class="line">  color: #333;</span><br><span class="line">  text-align: left;</span><br><span class="line">  margin: 0;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">/* 地址列表项样式 */</span><br><span class="line">.van-address-list__item {</span><br><span class="line">  margin-bottom: 10px; // 每一项之间的间距</span><br><span class="line">  padding: 10px 16px; // 内边距，使内容不贴边</span><br><span class="line">  border: 1px solid #ddd; // 边框颜色</span><br><span class="line">  border-radius: 4px; // 圆角边框</span><br><span class="line">  background-color: #fff; // 背景色</span><br><span class="line"></span><br><span class="line">  .van-cell__title,</span><br><span class="line">  .van-cell__label {</span><br><span class="line">    white-space: normal; // 允许内容换行</span><br><span class="line">    word-wrap: break-word; // 自动换行</span><br><span class="line">    word-break: break-all; // 长单词换行</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">/* 禁用状态的地址项样式 */</span><br><span class="line">.van-address-list__item--disabled {</span><br><span class="line">  background-color: #f5f5f5; // 禁用项的背景色</span><br><span class="line">  color: #999; // 禁用项的文字颜色</span><br><span class="line">}</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></tbody></table></figure>
<h3 id="地址编辑"><a class="markdownIt-Anchor" href="#地址编辑"></a> 地址编辑</h3>
<p>地址编辑可以是新建也可以是更新操作：<code>views/address/edit.vue</code></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;!-- 可编辑也可以作为添加地址的页面 --&gt;</span><br><span class="line">  &lt;div class="address-list"&gt;</span><br><span class="line">    &lt;van-nav-bar</span><br><span class="line">      fixed</span><br><span class="line">      title="地址编辑"</span><br><span class="line">      left-arrow</span><br><span class="line">      @click-left="$router.go(-1)"</span><br><span class="line">    /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;div class="address-edit"&gt;</span><br><span class="line">      &lt;van-address-edit</span><br><span class="line">        :address-info="addressInfo"</span><br><span class="line">        :area-list="areaList"</span><br><span class="line">        show-delete</span><br><span class="line">        :show-set-default="this.adsId != -1 ? true : false"</span><br><span class="line">        show-search-result</span><br><span class="line">        :search-result="searchResult"</span><br><span class="line">        :area-columns-placeholder="['请选择', '请选择', '请选择']"</span><br><span class="line">        :detail-maxlength="20"</span><br><span class="line">        @save="onSave"</span><br><span class="line">        @delete="onDelete"</span><br><span class="line">        @change-default="onChangeDefault"</span><br><span class="line">      /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import { Toast } from "vant";</span><br><span class="line">import { mapActions, mapGetters } from "vuex";</span><br><span class="line">import { areaList } from "@vant/area-data"; // 引入vant官方的地区数据</span><br><span class="line"></span><br><span class="line">export default {</span><br><span class="line">  name: "AddressEdit",</span><br><span class="line">  data() {</span><br><span class="line">    return {</span><br><span class="line">      adsId: 0, // 地址id</span><br><span class="line">      addressInfo: {}, // 初始地址详情对象，若是新建地址则为空对象</span><br><span class="line">      areaList: areaList, // 地区列表</span><br><span class="line">      searchResult: [], // 详细地址搜索结果</span><br><span class="line">      checkDefault: false, // 默认地址的标识，数据内的isDefault会随着设置按钮而改变，此字段标识数据原始状态</span><br><span class="line">    };</span><br><span class="line">  },</span><br><span class="line">  computed: {</span><br><span class="line">    ...mapGetters("AddressMap", ["nameToCode", "codeToName"]),</span><br><span class="line">    // 获取要进行编辑的地址id，如果为空则赋值为-1表示为新建地址</span><br><span class="line">    getAdsId() {</span><br><span class="line">      return this.$route.query.adsid || -1;</span><br><span class="line">    },</span><br><span class="line">  },</span><br><span class="line">  async created() {</span><br><span class="line">    // 构建映射表</span><br><span class="line">    await this.buildReverseMaps();</span><br><span class="line"></span><br><span class="line">    // 获取要进行编辑的地址id，如果为空则赋值为-1表示为新建地址</span><br><span class="line">    this.adsId = this.getAdsId;</span><br><span class="line">    // console.log('adsId:', this.adsId)</span><br><span class="line"></span><br><span class="line">    // 如果adsId不等于-1，则进行地址详情的拉取</span><br><span class="line">    if (this.adsId !== -1) {</span><br><span class="line">      // 说明是编辑地址，则需要拉取地址详情</span><br><span class="line">      const {</span><br><span class="line">        data: { detail },</span><br><span class="line">      } = await this.getAddressDetail(this.adsId);</span><br><span class="line">      this.addressInfo = {</span><br><span class="line">        id: detail.address_id,</span><br><span class="line">        name: detail.name,</span><br><span class="line">        tel: detail.phone,</span><br><span class="line">        province: this.codeToName(detail.province_id) || "",</span><br><span class="line">        city: this.codeToName(detail.city_id) || "",</span><br><span class="line">        county: this.codeToName(detail.county_id) || "",</span><br><span class="line">        addressDetail: detail.detail,</span><br><span class="line">        areaCode: String(detail.region_id),</span><br><span class="line">        isDefault: this.isDefault,</span><br><span class="line">      };</span><br><span class="line">      // 从Vuex得到默认地址的id</span><br><span class="line">      const defaultAddressId = this.$store.state.Address.defaultAddressId;</span><br><span class="line">      // 比对当前地址是否为默认地址</span><br><span class="line">      if (Number(defaultAddressId) === Number(detail.address_id)) {</span><br><span class="line">        console.log("当前地址为默认地址");</span><br><span class="line">        this.addressInfo.isDefault = true; // 设置默认按钮为打开状态</span><br><span class="line">        this.checkDefault = true; // 为真说明该地址获取的时候就是默认地址</span><br><span class="line">      } else {</span><br><span class="line">        // 说明当前地址不是默认地址</span><br><span class="line">        console.log("当前地址不是默认地址");</span><br><span class="line">        this.addressInfo.isDefault = false; // 设置默认按钮为关闭状态</span><br><span class="line">        this.checkDefault = false; // 为假说明该地址获取的时候不是默认地址</span><br><span class="line">      }</span><br><span class="line">    } else {</span><br><span class="line">      // 说明是新建地址，不做操作</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  methods: {</span><br><span class="line">    ...mapActions("Address", [</span><br><span class="line">      "getAddressDetail",</span><br><span class="line">      "addAddress",</span><br><span class="line">      "updateAddress",</span><br><span class="line">    ]),</span><br><span class="line">    ...mapActions("AddressMap", ["buildReverseMaps"]),</span><br><span class="line"></span><br><span class="line">    // 保存地址</span><br><span class="line">    async onSave(content) {</span><br><span class="line">      // 判断是新建地址还是编辑地址</span><br><span class="line">      if (this.adsId === -1) {</span><br><span class="line">        // 新建地址</span><br><span class="line">        content.country = "中国";</span><br><span class="line">        this.addressInfo = content;</span><br><span class="line"></span><br><span class="line">        // 使用映射表进行地区数据处理</span><br><span class="line">        const region = [</span><br><span class="line">          {</span><br><span class="line">            value: Number(this.nameToCode(content.province)) || "",</span><br><span class="line">            label: content.province,</span><br><span class="line">          },</span><br><span class="line">          {</span><br><span class="line">            value: Number(this.nameToCode(content.city)) || "",</span><br><span class="line">            label: content.city,</span><br><span class="line">          },</span><br><span class="line">          {</span><br><span class="line">            value: Number(this.nameToCode(content.county)) || "",</span><br><span class="line">            label: content.county,</span><br><span class="line">          },</span><br><span class="line">        ];</span><br><span class="line"></span><br><span class="line">        // 封装数据对象</span><br><span class="line">        const dataObj = {</span><br><span class="line">          name: this.addressInfo.name,</span><br><span class="line">          phone: this.addressInfo.tel,</span><br><span class="line">          region: region,</span><br><span class="line">          detail: this.addressInfo.addressDetail,</span><br><span class="line">        };</span><br><span class="line"></span><br><span class="line">        // 调用接口进行地址的保存</span><br><span class="line">        await this.addAddress(dataObj);</span><br><span class="line">        Toast("保存成功");</span><br><span class="line">        this.$router.replace({ path: "/address/manage" }); // 保存成功后返回地址列表页面</span><br><span class="line">      } else {</span><br><span class="line">        // 编辑地址</span><br><span class="line">        // console.log('编辑地址的content:', content)</span><br><span class="line">        this.addressInfo = content;</span><br><span class="line">        // 封装对象，用于发送请求</span><br><span class="line">        const dataObj = {</span><br><span class="line">          address_id: this.addressInfo.id,</span><br><span class="line">          form: {</span><br><span class="line">            name: this.addressInfo.name,</span><br><span class="line">            phone: this.addressInfo.tel,</span><br><span class="line">            region: [</span><br><span class="line">              {</span><br><span class="line">                label: this.addressInfo.province,</span><br><span class="line">                value: Number(this.nameToCode(this.addressInfo.province)) || "",</span><br><span class="line">              },</span><br><span class="line">              {</span><br><span class="line">                label: this.addressInfo.city,</span><br><span class="line">                value: Number(this.nameToCode(this.addressInfo.city)) || "",</span><br><span class="line">              },</span><br><span class="line">              {</span><br><span class="line">                label: this.addressInfo.county,</span><br><span class="line">                value: Number(this.nameToCode(this.addressInfo.county)) || "",</span><br><span class="line">              },</span><br><span class="line">            ],</span><br><span class="line">            detail: this.addressInfo.addressDetail,</span><br><span class="line">          },</span><br><span class="line">        };</span><br><span class="line">        // console.log('dataObj:', dataObj)</span><br><span class="line">        await this.updateAddress(dataObj);</span><br><span class="line">        Toast("保存成功");</span><br><span class="line"></span><br><span class="line">        // 处理默认地址的标识问题</span><br><span class="line">        if (this.checkDefault) {</span><br><span class="line">          // 为真说明当前编辑的是默认地址</span><br><span class="line">          console.log("当前是默认地址，content:", content);</span><br><span class="line">          console.log("当前是默认地址，this.adressInfo:", this.addressInfo);</span><br><span class="line"></span><br><span class="line">          if (content.isDefault !== this.checkDefault) {</span><br><span class="line">            // 说明用户取消了这个默认地址，需要将Vuex的默认地址id赋值为-1</span><br><span class="line">            this.$store.commit("Address/setDefaultAddressId", -1);</span><br><span class="line">          }</span><br><span class="line">          // 否则什么也不做</span><br><span class="line">        } else {</span><br><span class="line">          // 说明当前编辑的不是默认地址</span><br><span class="line">          console.log("当前不是默认地址，content:", content);</span><br><span class="line">          console.log("当前不是默认地址，this.adressInfo:", this.addressInfo);</span><br><span class="line"></span><br><span class="line">          if (content.isDefault !== this.checkDefault) {</span><br><span class="line">            // 说明用户将当前不是默认地址的地址设置为默认地址</span><br><span class="line">            this.$store.commit(</span><br><span class="line">              "Address/setDefaultAddressId",</span><br><span class="line">              this.addressInfo.id</span><br><span class="line">            );</span><br><span class="line">          }</span><br><span class="line">          // 否则什么也不做</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        // 处理完成后跳转会地址列表页</span><br><span class="line">        this.$router.replace({ path: "/address/manage" });</span><br><span class="line">      }</span><br><span class="line">    },</span><br><span class="line">    async onDelete() {</span><br><span class="line">      // 判断是否删除的是默认地址，如果是，则将Vuex的默认地址id赋值为-1</span><br><span class="line">      if (this.checkDefault) {</span><br><span class="line">        this.$store.commit("Address/setDefaultAddressId", -1);</span><br><span class="line">        console.log(</span><br><span class="line">          "删除默认地址, Vuex的默认地址id:",</span><br><span class="line">          this.$store.state.Address.defaultAddressId</span><br><span class="line">        );</span><br><span class="line">      }</span><br><span class="line">      await this.$store.dispatch("Address/deleteAddress", this.addressInfo.id);</span><br><span class="line">      Toast("删除成功");</span><br><span class="line">      setTimeout(() =&gt; {</span><br><span class="line">        this.$router.replace("/address/manage");</span><br><span class="line">      }, 1000);</span><br><span class="line">    },</span><br><span class="line">    // 设置默认地址</span><br><span class="line">    onChangeDefault(val) {</span><br><span class="line">      // console.log(val)</span><br><span class="line">      // 只有编辑才可以设置默认地址</span><br><span class="line">      this.addressInfo.isDefault = val;</span><br><span class="line">      console.log(</span><br><span class="line">        "设置默认地址的按钮被触发, this.addressInfo.isDefault:",</span><br><span class="line">        this.addressInfo.isDefault</span><br><span class="line">      );</span><br><span class="line">    },</span><br><span class="line">  },</span><br><span class="line">};</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped lang="less"&gt;</span><br><span class="line">.address-list {</span><br><span class="line">  padding-top: 60px; /* 增加与导航栏等高的内边距，避免内容被导航栏覆盖 */</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">.address-edit {</span><br><span class="line">  padding: 10px 16px; /* 给地址编辑区域增加一些内边距，使内容不贴边 */</span><br><span class="line">  background-color: #fff; /* 设置背景色为白色 */</span><br><span class="line">}</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></tbody></table></figure>
<p>导入 vant 组件略过。</p>
<h2 id="订单结算台"><a class="markdownIt-Anchor" href="#订单结算台"></a> 订单结算台</h2>
<h3 id="静态结构-2"><a class="markdownIt-Anchor" href="#静态结构-2"></a> 静态结构</h3>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class="pay"&gt;</span><br><span class="line">    &lt;van-nav-bar</span><br><span class="line">      fixed</span><br><span class="line">      title="订单结算台"</span><br><span class="line">      left-arrow</span><br><span class="line">      @click-left="$router.go(-1)"</span><br><span class="line">    /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 地址相关 --&gt;</span><br><span class="line">    &lt;div class="address"&gt;</span><br><span class="line">      &lt;div class="left-icon"&gt;</span><br><span class="line">        &lt;van-icon name="logistics" /&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">      &lt;div class="info" v-if="true"&gt;</span><br><span class="line">        &lt;div class="info-content"&gt;</span><br><span class="line">          &lt;span class="name"&gt;小红&lt;/span&gt;</span><br><span class="line">          &lt;span class="mobile"&gt;13811112222&lt;/span&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div class="info-address"&gt;江苏省 无锡市 南长街 110号 504&lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">      &lt;div class="info" v-else&gt;请选择配送地址&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">      &lt;div class="right-icon"&gt;</span><br><span class="line">        &lt;van-icon name="arrow" /&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 订单明细 --&gt;</span><br><span class="line">    &lt;div class="pay-list"&gt;</span><br><span class="line">      &lt;div class="list"&gt;</span><br><span class="line">        &lt;div class="goods-item"&gt;</span><br><span class="line">          &lt;div class="left"&gt;</span><br><span class="line">            &lt;img</span><br><span class="line">              src="http://cba.itlike.com/public/uploads/10001/20230321/8f505c6c437fc3d4b4310b57b1567544.jpg"</span><br><span class="line">              alt=""</span><br><span class="line">            /&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">          &lt;div class="right"&gt;</span><br><span class="line">            &lt;p class="tit text-ellipsis-2"&gt;</span><br><span class="line">              三星手机 SAMSUNG Galaxy S23 8GB+256GB 超视觉夜拍系统 超清夜景</span><br><span class="line">              悠雾紫 5G手机 游戏拍照旗舰机s23</span><br><span class="line">            &lt;/p&gt;</span><br><span class="line">            &lt;p class="info"&gt;</span><br><span class="line">              &lt;span class="count"&gt;x3&lt;/span&gt;</span><br><span class="line">              &lt;span class="price"&gt;¥9.99&lt;/span&gt;</span><br><span class="line">            &lt;/p&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">      &lt;div class="flow-num-box"&gt;</span><br><span class="line">        &lt;span&gt;共 12 件商品，合计：&lt;/span&gt;</span><br><span class="line">        &lt;span class="money"&gt;￥1219.00&lt;/span&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">      &lt;div class="pay-detail"&gt;</span><br><span class="line">        &lt;div class="pay-cell"&gt;</span><br><span class="line">          &lt;span&gt;订单总金额：&lt;/span&gt;</span><br><span class="line">          &lt;span class="red"&gt;￥1219.00&lt;/span&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">        &lt;div class="pay-cell"&gt;</span><br><span class="line">          &lt;span&gt;优惠券：&lt;/span&gt;</span><br><span class="line">          &lt;span&gt;无优惠券可用&lt;/span&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">        &lt;div class="pay-cell"&gt;</span><br><span class="line">          &lt;span&gt;配送费用：&lt;/span&gt;</span><br><span class="line">          &lt;span v-if="false"&gt;请先选择配送地址&lt;/span&gt;</span><br><span class="line">          &lt;span v-else class="red"&gt;+￥0.00&lt;/span&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">      &lt;!-- 支付方式 --&gt;</span><br><span class="line">      &lt;div class="pay-way"&gt;</span><br><span class="line">        &lt;span class="tit"&gt;支付方式&lt;/span&gt;</span><br><span class="line">        &lt;div class="pay-cell"&gt;</span><br><span class="line">          &lt;span</span><br><span class="line">            &gt;&lt;van-icon name="balance-o" /&gt;余额支付（可用 ¥ 999919.00 元）&lt;/span</span><br><span class="line">          &gt;</span><br><span class="line">          &lt;!-- &lt;span&gt;请先选择配送地址&lt;/span&gt; --&gt;</span><br><span class="line">          &lt;span class="red"&gt;&lt;van-icon name="passed" /&gt;&lt;/span&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">      &lt;!-- 买家留言 --&gt;</span><br><span class="line">      &lt;div class="buytips"&gt;</span><br><span class="line">        &lt;textarea</span><br><span class="line">          placeholder="选填：买家留言（50字内）"</span><br><span class="line">          name=""</span><br><span class="line">          id=""</span><br><span class="line">          cols="30"</span><br><span class="line">          rows="10"</span><br><span class="line">        &gt;&lt;/textarea&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 底部提交 --&gt;</span><br><span class="line">    &lt;div class="footer-fixed"&gt;</span><br><span class="line">      &lt;div class="left"&gt;实付款：&lt;span&gt;￥999919&lt;/span&gt;&lt;/div&gt;</span><br><span class="line">      &lt;div class="tipsbtn"&gt;提交订单&lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default {</span><br><span class="line">  name: "PayIndex",</span><br><span class="line">  data() {</span><br><span class="line">    return {};</span><br><span class="line">  },</span><br><span class="line">  methods: {},</span><br><span class="line">};</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang="less" scoped&gt;</span><br><span class="line">.pay {</span><br><span class="line">  padding-top: 46px;</span><br><span class="line">  padding-bottom: 46px;</span><br><span class="line">  ::v-deep {</span><br><span class="line">    .van-nav-bar__arrow {</span><br><span class="line">      color: #333;</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">.address {</span><br><span class="line">  display: flex;</span><br><span class="line">  align-items: center;</span><br><span class="line">  justify-content: flex-start;</span><br><span class="line">  padding: 20px;</span><br><span class="line">  font-size: 14px;</span><br><span class="line">  color: #666;</span><br><span class="line">  position: relative;</span><br><span class="line">  background: url(@/assets/border-line.png) bottom repeat-x;</span><br><span class="line">  background-size: 60px auto;</span><br><span class="line">  .left-icon {</span><br><span class="line">    margin-right: 20px;</span><br><span class="line">  }</span><br><span class="line">  .right-icon {</span><br><span class="line">    position: absolute;</span><br><span class="line">    right: 20px;</span><br><span class="line">    top: 50%;</span><br><span class="line">    transform: translateY(-7px);</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">.goods-item {</span><br><span class="line">  height: 100px;</span><br><span class="line">  margin-bottom: 6px;</span><br><span class="line">  padding: 10px;</span><br><span class="line">  background-color: #fff;</span><br><span class="line">  display: flex;</span><br><span class="line">  .left {</span><br><span class="line">    width: 100px;</span><br><span class="line">    img {</span><br><span class="line">      display: block;</span><br><span class="line">      width: 80px;</span><br><span class="line">      margin: 10px auto;</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">  .right {</span><br><span class="line">    flex: 1;</span><br><span class="line">    font-size: 14px;</span><br><span class="line">    line-height: 1.3;</span><br><span class="line">    padding: 10px;</span><br><span class="line">    padding-right: 0px;</span><br><span class="line">    display: flex;</span><br><span class="line">    flex-direction: column;</span><br><span class="line">    justify-content: space-evenly;</span><br><span class="line">    color: #333;</span><br><span class="line">    .info {</span><br><span class="line">      margin-top: 5px;</span><br><span class="line">      display: flex;</span><br><span class="line">      justify-content: space-between;</span><br><span class="line">      .price {</span><br><span class="line">        color: #fa2209;</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">.flow-num-box {</span><br><span class="line">  display: flex;</span><br><span class="line">  justify-content: flex-end;</span><br><span class="line">  padding: 10px 10px;</span><br><span class="line">  font-size: 14px;</span><br><span class="line">  border-bottom: 1px solid #efefef;</span><br><span class="line">  .money {</span><br><span class="line">    color: #fa2209;</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">.pay-cell {</span><br><span class="line">  font-size: 14px;</span><br><span class="line">  padding: 10px 12px;</span><br><span class="line">  color: #333;</span><br><span class="line">  display: flex;</span><br><span class="line">  justify-content: space-between;</span><br><span class="line">  .red {</span><br><span class="line">    color: #fa2209;</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">.pay-detail {</span><br><span class="line">  border-bottom: 1px solid #efefef;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">.pay-way {</span><br><span class="line">  font-size: 14px;</span><br><span class="line">  padding: 10px 12px;</span><br><span class="line">  border-bottom: 1px solid #efefef;</span><br><span class="line">  color: #333;</span><br><span class="line">  .tit {</span><br><span class="line">    line-height: 30px;</span><br><span class="line">  }</span><br><span class="line">  .pay-cell {</span><br><span class="line">    padding: 10px 0;</span><br><span class="line">  }</span><br><span class="line">  .van-icon {</span><br><span class="line">    font-size: 20px;</span><br><span class="line">    margin-right: 5px;</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">.buytips {</span><br><span class="line">  display: block;</span><br><span class="line">  textarea {</span><br><span class="line">    display: block;</span><br><span class="line">    width: 100%;</span><br><span class="line">    border: none;</span><br><span class="line">    font-size: 14px;</span><br><span class="line">    padding: 12px;</span><br><span class="line">    height: 100px;</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">.footer-fixed {</span><br><span class="line">  position: fixed;</span><br><span class="line">  background-color: #fff;</span><br><span class="line">  left: 0;</span><br><span class="line">  bottom: 0;</span><br><span class="line">  width: 100%;</span><br><span class="line">  height: 46px;</span><br><span class="line">  line-height: 46px;</span><br><span class="line">  border-top: 1px solid #efefef;</span><br><span class="line">  font-size: 14px;</span><br><span class="line">  display: flex;</span><br><span class="line">  .left {</span><br><span class="line">    flex: 1;</span><br><span class="line">    padding-left: 12px;</span><br><span class="line">    color: #666;</span><br><span class="line">    span {</span><br><span class="line">      color: #fa2209;</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">  .tipsbtn {</span><br><span class="line">    width: 121px;</span><br><span class="line">    background: linear-gradient(90deg, #f9211c, #ff6335);</span><br><span class="line">    color: #fff;</span><br><span class="line">    text-align: center;</span><br><span class="line">    line-height: 46px;</span><br><span class="line">    display: block;</span><br><span class="line">    font-size: 14px;</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></tbody></table></figure>
<h3 id="渲染-2"><a class="markdownIt-Anchor" href="#渲染-2"></a> 渲染</h3>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class="pay"&gt;</span><br><span class="line">    &lt;van-nav-bar</span><br><span class="line">      fixed</span><br><span class="line">      title="订单结算台"</span><br><span class="line">      left-arrow</span><br><span class="line">      @click-left="$router.go(-1)"</span><br><span class="line">    /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 地址相关 --&gt;</span><br><span class="line">    &lt;div class="address"&gt;</span><br><span class="line">      &lt;div class="left-icon"&gt;</span><br><span class="line">        &lt;van-icon name="logistics" /&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">      &lt;div class="info" v-if="addressList.length &gt; 0"&gt;</span><br><span class="line">        &lt;div class="info-content"&gt;</span><br><span class="line">          &lt;span class="name"&gt;{{ chosenAddress.name }} &lt;/span&gt;</span><br><span class="line">          &lt;span class="mobile"&gt;{{ chosenAddress.phone }}&lt;/span&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div class="info-address"&gt;</span><br><span class="line">          {{ regionName.province }} {{ regionName.city }}</span><br><span class="line">          {{ regionName.county }} {{ chosenAddress.detail }}</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">      &lt;div class="info" v-else&gt;还没有地址哦，点击右侧按钮添加吧&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">      &lt;div class="right-icon" @click="$router.push('/address/manage')"&gt;</span><br><span class="line">        &lt;van-icon name="arrow" /&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 订单明细 --&gt;</span><br><span class="line">    &lt;div class="pay-list"&gt;</span><br><span class="line">      &lt;div class="list"&gt;</span><br><span class="line">        &lt;div class="goods-item" v-for="item in cartList" :key="item.id"&gt;</span><br><span class="line">          &lt;div class="left"&gt;</span><br><span class="line">            &lt;img :src="item.goods.goods_image" alt="" /&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">          &lt;div class="right"&gt;</span><br><span class="line">            &lt;p class="tit text-ellipsis-2"&gt;</span><br><span class="line">              {{ item.goods.goods_name }}</span><br><span class="line">            &lt;/p&gt;</span><br><span class="line">            &lt;p class="info"&gt;</span><br><span class="line">              &lt;span class="count"&gt;共{{ item.goods_num }}件&lt;/span&gt;</span><br><span class="line">              &lt;span class="price"</span><br><span class="line">                &gt;¥{{ item.goods.goods_price_min * item.goods_num }}&lt;/span</span><br><span class="line">              &gt;</span><br><span class="line">            &lt;/p&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">      &lt;div class="flow-num-box"&gt;</span><br><span class="line">        &lt;span&gt;共 {{ selectedCartCount() }} 件商品，合计：&lt;/span&gt;</span><br><span class="line">        &lt;span class="money"&gt;￥{{ selectedPrice() }}&lt;/span&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">      &lt;div class="pay-detail"&gt;</span><br><span class="line">        &lt;div class="pay-cell"&gt;</span><br><span class="line">          &lt;span&gt;订单总金额：&lt;/span&gt;</span><br><span class="line">          &lt;span class="red"&gt;￥{{ selectedPrice() }}&lt;/span&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">        &lt;div class="pay-cell"&gt;</span><br><span class="line">          &lt;span&gt;优惠券：&lt;/span&gt;</span><br><span class="line">          &lt;span&gt;无优惠券可用&lt;/span&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">        &lt;div class="pay-cell"&gt;</span><br><span class="line">          &lt;span&gt;配送费用：&lt;/span&gt;</span><br><span class="line">          &lt;span v-if="false"&gt;请先选择配送地址&lt;/span&gt;</span><br><span class="line">          &lt;span v-else class="red"&gt;+￥0.00&lt;/span&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">      &lt;!-- 支付方式 --&gt;</span><br><span class="line">      &lt;div class="pay-way"&gt;</span><br><span class="line">        &lt;span class="tit"&gt;支付方式&lt;/span&gt;</span><br><span class="line">        &lt;div class="pay-cell"&gt;</span><br><span class="line">          &lt;span</span><br><span class="line">            &gt;&lt;van-icon name="balance-o" /&gt;余额支付（可用 ¥ 999919.00 元）&lt;/span</span><br><span class="line">          &gt;</span><br><span class="line">          &lt;!-- &lt;span&gt;请先选择配送地址&lt;/span&gt; --&gt;</span><br><span class="line">          &lt;span class="red"&gt;&lt;van-icon name="passed" /&gt;&lt;/span&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">      &lt;!-- 买家留言 --&gt;</span><br><span class="line">      &lt;div class="buytips"&gt;</span><br><span class="line">        &lt;textarea</span><br><span class="line">          placeholder="选填：买家留言（50字内）"</span><br><span class="line">          name=""</span><br><span class="line">          id=""</span><br><span class="line">          cols="30"</span><br><span class="line">          rows="10"</span><br><span class="line">        &gt;&lt;/textarea&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 底部提交 --&gt;</span><br><span class="line">    &lt;div class="footer-fixed"&gt;</span><br><span class="line">      &lt;div class="left"&gt;</span><br><span class="line">        实付款：&lt;span&gt;￥{{ selectedPrice() }}&lt;/span&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;div class="tipsbtn" @click="$router.push('/order/confirm')"&gt;</span><br><span class="line">        提交订单</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import { mapActions, mapGetters } from "vuex";</span><br><span class="line"></span><br><span class="line">export default {</span><br><span class="line">  name: "PayIndex",</span><br><span class="line">  async created() {</span><br><span class="line">    // 构建地区映射表</span><br><span class="line">    await this.buildReverseMaps();</span><br><span class="line"></span><br><span class="line">    // 处理购物车详情展示</span><br><span class="line">    // 拉取购物车列表</span><br><span class="line">    await this.getCartAction();</span><br><span class="line">    this.cartList = this.selectedCartList();</span><br><span class="line">    console.log("购物车列表：", this.cartList);</span><br><span class="line"></span><br><span class="line">    // 获取地址列表</span><br><span class="line">    const { list } = await this.getAddressList();</span><br><span class="line">    this.addressList = list;</span><br><span class="line">    console.log("地址列表：", this.addressList);</span><br><span class="line"></span><br><span class="line">    // 从Vuex中获取默认地址的id</span><br><span class="line">    const defaultAddressId = this.getDefaultAddressId();</span><br><span class="line">    console.log("默认地址id：", defaultAddressId);</span><br><span class="line"></span><br><span class="line">    if (this.addressList.length &gt; 0) {</span><br><span class="line">      // 如果有地址查询参数?adsid，则说明进行了地址切换</span><br><span class="line">      console.log("地址切换参数：", this.getadsid);</span><br><span class="line">      if (this.getadsid) {</span><br><span class="line">        // chosenAddress被赋值为切换的id的地址</span><br><span class="line">        const address = this.addressList.find(</span><br><span class="line">          (item) =&gt; String(item.address_id) === String(this.getadsid)</span><br><span class="line">        );</span><br><span class="line">        this.chosenAddress = address;</span><br><span class="line">        console.log("切换后的地址：", this.chosenAddress);</span><br><span class="line">      } else {</span><br><span class="line">        // 如果没有地址切换参数，则说明没有切换地址</span><br><span class="line">        if (Number(defaultAddressId) !== -1) {</span><br><span class="line">          // 遍历比对列表每一项的id是否与defaultAddressId相等，找到后返回索引（强等于比较，注意类型）</span><br><span class="line">          const defaultIndex = this.addressList.findIndex(</span><br><span class="line">            (item) =&gt; String(item.address_id) === String(defaultAddressId)</span><br><span class="line">          );</span><br><span class="line">          // console.log('默认地址索引：', defaultIndex)</span><br><span class="line">          if (Number(defaultIndex) !== -1) {</span><br><span class="line">            // 找到后将数组数据转对象赋值给chosenAddress属性</span><br><span class="line">            this.chosenAddress = this.addressList[defaultIndex];</span><br><span class="line"></span><br><span class="line">            // 处理地址Code转为Name</span><br><span class="line">            const regionId = String(this.chosenAddress.region_id);</span><br><span class="line">            // 调用 getFullAddressInfo 方法</span><br><span class="line">            this.regionName = await this.fetchFullAddressName(regionId);</span><br><span class="line">          } else {</span><br><span class="line">            console.log("未找到有效的默认地址索引");</span><br><span class="line">          }</span><br><span class="line">        } else {</span><br><span class="line">          // Vuex没有默认地址，则默认选中第一个地址</span><br><span class="line">          // 设置chosenAddress属性为addressList的第一个地址</span><br><span class="line">          this.chosenAddress = this.addressList[0];</span><br><span class="line">          const regionId = String(this.chosenAddress.region_id);</span><br><span class="line">          this.regionName = await this.fetchFullAddressName(regionId);</span><br><span class="line">          console.log(</span><br><span class="line">            "无默认地址，展示数据chosenAddress：",</span><br><span class="line">            this.chosenAddress</span><br><span class="line">          );</span><br><span class="line">        }</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  data() {</span><br><span class="line">    return {</span><br><span class="line">      addressList: [], // 地址列表</span><br><span class="line">      chosenAddress: {}, // 被选择进行展示的地址</span><br><span class="line">      regionName: {}, // 将地址Code转为Name</span><br><span class="line">      cartList: [], // 购物车列表</span><br><span class="line">    };</span><br><span class="line">  },</span><br><span class="line">  computed: {</span><br><span class="line">    getadsid() {</span><br><span class="line">      return this.$route.query.adsid;</span><br><span class="line">    },</span><br><span class="line">  },</span><br><span class="line">  methods: {</span><br><span class="line">    ...mapActions("Address", ["getAddressList", "getAddressDetail"]),</span><br><span class="line">    ...mapGetters("Address", ["getDefaultAddressId"]),</span><br><span class="line">    ...mapActions("AddressMap", ["buildReverseMaps", "fetchFullAddressName"]),</span><br><span class="line">    ...mapActions("Cart", ["getCartAction"]),</span><br><span class="line">    ...mapGetters("Cart", [</span><br><span class="line">      "selectedCartList",</span><br><span class="line">      "selectedCartCount",</span><br><span class="line">      "selectedPrice",</span><br><span class="line">    ]),</span><br><span class="line">  },</span><br><span class="line">};</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang="less" scoped&gt;</span><br><span class="line">.pay {</span><br><span class="line">  padding-top: 46px;</span><br><span class="line">  padding-bottom: 46px;</span><br><span class="line">  ::v-deep {</span><br><span class="line">    .van-nav-bar__arrow {</span><br><span class="line">      color: #333;</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">.address {</span><br><span class="line">  display: flex;</span><br><span class="line">  align-items: center;</span><br><span class="line">  justify-content: flex-start;</span><br><span class="line">  padding: 20px;</span><br><span class="line">  font-size: 14px;</span><br><span class="line">  color: #666;</span><br><span class="line">  position: relative;</span><br><span class="line">  background: url(@/assets/border-line.png) bottom repeat-x;</span><br><span class="line">  background-size: 60px auto;</span><br><span class="line">  .left-icon {</span><br><span class="line">    margin-right: 20px;</span><br><span class="line">  }</span><br><span class="line">  .right-icon {</span><br><span class="line">    position: absolute;</span><br><span class="line">    right: 20px;</span><br><span class="line">    top: 50%;</span><br><span class="line">    transform: translateY(-7px);</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">.goods-item {</span><br><span class="line">  height: 100px;</span><br><span class="line">  margin-bottom: 6px;</span><br><span class="line">  padding: 10px;</span><br><span class="line">  background-color: #fff;</span><br><span class="line">  display: flex;</span><br><span class="line">  .left {</span><br><span class="line">    width: 100px;</span><br><span class="line">    img {</span><br><span class="line">      display: block;</span><br><span class="line">      width: 80px;</span><br><span class="line">      margin: 10px auto;</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">  .right {</span><br><span class="line">    flex: 1;</span><br><span class="line">    font-size: 14px;</span><br><span class="line">    line-height: 1.3;</span><br><span class="line">    padding: 10px;</span><br><span class="line">    padding-right: 0px;</span><br><span class="line">    display: flex;</span><br><span class="line">    flex-direction: column;</span><br><span class="line">    justify-content: space-evenly;</span><br><span class="line">    color: #333;</span><br><span class="line">    .info {</span><br><span class="line">      margin-top: 5px;</span><br><span class="line">      display: flex;</span><br><span class="line">      justify-content: space-between;</span><br><span class="line">      .price {</span><br><span class="line">        color: #fa2209;</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">.flow-num-box {</span><br><span class="line">  display: flex;</span><br><span class="line">  justify-content: flex-end;</span><br><span class="line">  padding: 10px 10px;</span><br><span class="line">  font-size: 14px;</span><br><span class="line">  border-bottom: 1px solid #efefef;</span><br><span class="line">  .money {</span><br><span class="line">    color: #fa2209;</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">.pay-cell {</span><br><span class="line">  font-size: 14px;</span><br><span class="line">  padding: 10px 12px;</span><br><span class="line">  color: #333;</span><br><span class="line">  display: flex;</span><br><span class="line">  justify-content: space-between;</span><br><span class="line">  .red {</span><br><span class="line">    color: #fa2209;</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">.pay-detail {</span><br><span class="line">  border-bottom: 1px solid #efefef;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">.pay-way {</span><br><span class="line">  font-size: 14px;</span><br><span class="line">  padding: 10px 12px;</span><br><span class="line">  border-bottom: 1px solid #efefef;</span><br><span class="line">  color: #333;</span><br><span class="line">  .tit {</span><br><span class="line">    line-height: 30px;</span><br><span class="line">  }</span><br><span class="line">  .pay-cell {</span><br><span class="line">    padding: 10px 0;</span><br><span class="line">  }</span><br><span class="line">  .van-icon {</span><br><span class="line">    font-size: 20px;</span><br><span class="line">    margin-right: 5px;</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">.buytips {</span><br><span class="line">  display: block;</span><br><span class="line">  textarea {</span><br><span class="line">    display: block;</span><br><span class="line">    width: 100%;</span><br><span class="line">    border: none;</span><br><span class="line">    font-size: 14px;</span><br><span class="line">    padding: 12px;</span><br><span class="line">    height: 100px;</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">.footer-fixed {</span><br><span class="line">  position: fixed;</span><br><span class="line">  background-color: #fff;</span><br><span class="line">  left: 0;</span><br><span class="line">  bottom: 0;</span><br><span class="line">  width: 100%;</span><br><span class="line">  height: 46px;</span><br><span class="line">  line-height: 46px;</span><br><span class="line">  border-top: 1px solid #efefef;</span><br><span class="line">  font-size: 14px;</span><br><span class="line">  display: flex;</span><br><span class="line">  .left {</span><br><span class="line">    flex: 1;</span><br><span class="line">    padding-left: 12px;</span><br><span class="line">    color: #666;</span><br><span class="line">    span {</span><br><span class="line">      color: #fa2209;</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">  .tipsbtn {</span><br><span class="line">    width: 121px;</span><br><span class="line">    background: linear-gradient(90deg, #f9211c, #ff6335);</span><br><span class="line">    color: #fff;</span><br><span class="line">    text-align: center;</span><br><span class="line">    line-height: 46px;</span><br><span class="line">    display: block;</span><br><span class="line">    font-size: 14px;</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></tbody></table></figure>
<h2 id="订单结算"><a class="markdownIt-Anchor" href="#订单结算"></a> 订单结算</h2>
<p>购物车携带参数：</p>
<p><img src= "/img/loading/loading.gif" onerror="this.onerror=null,this.src=&quot;/img/avatar/emo.webp&quot;" data-lazy-src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202409020134925.png" alt="image-20240902013448659"></p>
<h2 id="文件上传unfinished"><a class="markdownIt-Anchor" href="#文件上传unfinished"></a> 文件上传 ——unfinished</h2>
<h3 id="图片上传"><a class="markdownIt-Anchor" href="#图片上传"></a> 图片上传</h3>
<blockquote>
<p>接口要求：POST <code>/upload/image</code></p>
<p>Header 参数：</p>
<ul>
<li>Access-Token (String) 示例：<code>1741f74aed758a688515f72572dc8e37</code></li>
<li>platform (String) 示例值：H5</li>
</ul>
<p>Body 参数：<code>multipart/form-data</code></p>
<ul>
<li>file 对象</li>
</ul>
</blockquote>
<p>上传图片通常涉及到裁剪操作，于是使用 vue-cropper 插件辅助完成。</p>
<h4 id="安装-vue-cropper"><a class="markdownIt-Anchor" href="#安装-vue-cropper"></a> 安装 vue-cropper</h4>
<figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install vue-cropper --save</span><br></pre></td></tr></tbody></table></figure>
<h4 id="在组件中使用-vue-cropper"><a class="markdownIt-Anchor" href="#在组件中使用-vue-cropper"></a> 在组件中使用 <code>vue-cropper</code></h4>
<p>创建上传的组件，允许用户选择图片、裁剪图片并实时预览裁剪效果，然后上传裁剪后的图片。</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class="avatar-upload"&gt;</span><br><span class="line">    &lt;vue-cropper</span><br><span class="line">      v-if="showCropper"</span><br><span class="line">      ref="cropper"</span><br><span class="line">      :img="imageSrc"</span><br><span class="line">      :output-size="{ width: 200, height: 200 }"</span><br><span class="line">      :output-type="'jpeg'"</span><br><span class="line">      :can-move-box="true"</span><br><span class="line">      :auto-crop="true"</span><br><span class="line">      :fixed-box="true"</span><br><span class="line">      :fixed="true"</span><br><span class="line">      :center-box="true"</span><br><span class="line">    &gt;&lt;/vue-cropper&gt;</span><br><span class="line"></span><br><span class="line">    &lt;div v-else&gt;</span><br><span class="line">      &lt;img</span><br><span class="line">        :src="avatarUrl"</span><br><span class="line">        alt="Avatar"</span><br><span class="line">        v-if="avatarUrl"</span><br><span class="line">        class="avatar-preview"</span><br><span class="line">      /&gt;</span><br><span class="line">      &lt;input type="file" @change="onAvatarChange" /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;div v-if="showCropper" class="cropper-controls"&gt;</span><br><span class="line">      &lt;button @click="cropImage"&gt;裁剪并上传&lt;/button&gt;</span><br><span class="line">      &lt;button @click="cancelCrop"&gt;取消&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import VueCropper from "vue-cropper";</span><br><span class="line">import { uploadImage } from "@/api/upload";</span><br><span class="line"></span><br><span class="line">export default {</span><br><span class="line">  components: {</span><br><span class="line">    VueCropper,</span><br><span class="line">  },</span><br><span class="line">  data() {</span><br><span class="line">    return {</span><br><span class="line">      avatarUrl: "", // 存储裁剪后的头像URL</span><br><span class="line">      imageSrc: "", // 存储用户选择的图片的URL</span><br><span class="line">      showCropper: false, // 控制是否显示裁剪器</span><br><span class="line">    };</span><br><span class="line">  },</span><br><span class="line">  methods: {</span><br><span class="line">    onAvatarChange(event) {</span><br><span class="line">      const file = event.target.files[0];</span><br><span class="line">      if (file) {</span><br><span class="line">        this.imageSrc = URL.createObjectURL(file);</span><br><span class="line">        this.showCropper = true;</span><br><span class="line">      }</span><br><span class="line">    },</span><br><span class="line">    async cropImage() {</span><br><span class="line">      // 获取裁剪后的图片数据</span><br><span class="line">      this.$refs.cropper.getCropBlob(async (blob) =&gt; {</span><br><span class="line">        // 上传裁剪后的图片</span><br><span class="line">        try {</span><br><span class="line">          const formData = new FormData();</span><br><span class="line">          formData.append("file", blob);</span><br><span class="line">          const response = await uploadImage(blob);</span><br><span class="line">          if (response.status === 200) {</span><br><span class="line">            this.avatarUrl = response.data.fileInfo.preview_url;</span><br><span class="line">            this.showCropper = false;</span><br><span class="line">          } else {</span><br><span class="line">            this.$toast.fail("上传失败，请重试");</span><br><span class="line">          }</span><br><span class="line">        } catch (error) {</span><br><span class="line">          this.$toast.fail("上传失败，请重试");</span><br><span class="line">          console.error(error);</span><br><span class="line">        }</span><br><span class="line">      });</span><br><span class="line">    },</span><br><span class="line">    cancelCrop() {</span><br><span class="line">      this.showCropper = false;</span><br><span class="line">      this.imageSrc = "";</span><br><span class="line">    },</span><br><span class="line">  },</span><br><span class="line">};</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line">.avatar-upload {</span><br><span class="line">  display: flex;</span><br><span class="line">  flex-direction: column;</span><br><span class="line">  align-items: center;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">.avatar-preview {</span><br><span class="line">  width: 200px;</span><br><span class="line">  height: 200px;</span><br><span class="line">  border-radius: 50%;</span><br><span class="line">  object-fit: cover;</span><br><span class="line">  margin-bottom: 10px;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">.cropper-controls {</span><br><span class="line">  margin-top: 10px;</span><br><span class="line">  display: flex;</span><br><span class="line">  gap: 10px;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">.cropper-controls button {</span><br><span class="line">  padding: 5px 10px;</span><br><span class="line">  background-color: #ff3e47;</span><br><span class="line">  color: white;</span><br><span class="line">  border: none;</span><br><span class="line">  border-radius: 5px;</span><br><span class="line">  cursor: pointer;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">.cropper-controls button:hover {</span><br><span class="line">  background-color: #e0363d;</span><br><span class="line">}</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></tbody></table></figure>
<h2 id="打包优化"><a class="markdownIt-Anchor" href="#打包优化"></a> 打包优化</h2>
<h3 id="优化访问路径"><a class="markdownIt-Anchor" href="#优化访问路径"></a> 优化访问路径</h3>
<p>打包命令：<code>yarn build</code> 或者 <code>npm run build</code></p>
<p>打包如果没有配置 vue.config.js 的 <code>publicPath</code>，默认生成的匹配文件的写法是绝对路径，这意味着将来的可移植性降低。于是配置：</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> { defineConfig } = <span class="built_in">require</span>(<span class="string">"@vue/cli-service"</span>);</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title function_">defineConfig</span>({</span><br><span class="line">  <span class="attr">publicPath</span>: <span class="string">"./"</span>, <span class="comment">// 默认为'/'</span></span><br><span class="line">  <span class="attr">transpileDependencies</span>: <span class="literal">true</span>,</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure>
<h3 id="懒加载"><a class="markdownIt-Anchor" href="#懒加载"></a> 懒加载</h3>
<p>打包实际上将多个文件多合一，如果一次性加载所有的 js 文件是非常消耗性能的，因此推荐配置懒加载。</p>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://router.vuejs.org/zh/guide/advanced/lazy-loading.html">路由懒加载</a></p>
<ul>
<li>异步组件改造 </li>
</ul>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">ProDetail</span> = (<span class="params"></span>) =&gt; <span class="keyword">import</span>(<span class="string">'@/views/prodetail'</span>)</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">Pay</span> = (<span class="params"></span>) =&gt; <span class="keyword">import</span>(<span class="string">'@/views/pay'</span>)</span><br><span class="line">...</span><br></pre></td></tr></tbody></table></figure>
<ul>
<li>路由中应用 </li>
</ul>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> <span class="title class_">VueRouter</span>({</span><br><span class="line">  <span class="attr">routes</span>: [</span><br><span class="line">    ...</span><br><span class="line">    {<span class="attr">path</span>:<span class="string">'prodetail/:id'</span>, <span class="attr">component</span>: <span class="title class_">ProDetail</span>},</span><br><span class="line">    {<span class="title class_">Path</span>:<span class="string">'/Pay'</span>, <span class="attr">component</span>: <span class="title class_">Pay</span>},</span><br><span class="line">    ...</span><br><span class="line">  ]</span><br><span class="line">})</span><br></pre></td></tr></tbody></table></figure>
<p>对比：</p>
<p><img src= "/img/loading/loading.gif" onerror="this.onerror=null,this.src=&quot;/img/avatar/emo.webp&quot;" data-lazy-src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202409030451734.png" alt="image-20240903045130463"></p>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script></article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "/img/loading/loading.gif" onerror="this.onerror=null,this.src=&quot;/img/avatar/emo.webp&quot;" data-lazy-src="https://ali-4rozen-oss.oss-cn-guangzhou.aliyuncs.com/blog/avatar/avatar.jpg" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "/img/loading/loading.gif" onerror="this.onerror=null,this.src=&quot;/img/avatar/emo.webp&quot;" data-lazy-src="https://ali-4rozen-oss.oss-cn-guangzhou.aliyuncs.com/blog/avatar/avatar.jpg" title="头像" alt="头像"></a><div class="post-copyright__author_name">4rozeN</div><div class="post-copyright__author_desc">历历浮生，无非败而后成。</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="https://4rozen.github.io/posts/47412">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('https://4rozen.github.io/posts/47412')">GO-SHOPPING 商城项目笔记</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"><div class="post-reward" onclick="anzhiyu.addRewardMask()"><div class="reward-button button--animated" title="赞赏作者"><i class="anzhiyufont anzhiyu-icon-hand-heart-fill"></i>打赏作者</div><div class="reward-main"><div class="reward-all"><span class="reward-title">感谢你赐予我前进的力量</span><ul class="reward-group"><li class="reward-item"><a href="https://ali-4rozen-oss.oss-cn-guangzhou.aliyuncs.com/blog/loveU/wx_zanshang.jpg" rel="external nofollow noreferrer" target="_blank"><img class="post-qr-code-img" src= "/img/loading/loading.gif" onerror="this.onerror=null,this.src=&quot;/img/avatar/emo.webp&quot;" data-lazy-src="https://ali-4rozen-oss.oss-cn-guangzhou.aliyuncs.com/blog/loveU/wx_zanshang.jpg" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://ali-4rozen-oss.oss-cn-guangzhou.aliyuncs.com/blog/loveU/alipay_zanshang.jpg" rel="external nofollow noreferrer" target="_blank"><img class="post-qr-code-img" src= "/img/loading/loading.gif" onerror="this.onerror=null,this.src=&quot;/img/avatar/emo.webp&quot;" data-lazy-src="https://ali-4rozen-oss.oss-cn-guangzhou.aliyuncs.com/blog/loveU/alipay_zanshang.jpg" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul><a class="reward-main-btn" href="/about/#about-reward" target="_blank"><div class="reward-text">赞赏者名单</div><div class="reward-dec">因为你们的支持让我意识到写文章的价值🙏</div></a></div></div></div><div id="quit-box" onclick="anzhiyu.removeRewardMask()" style="display: none"></div></div><div class="shareRight"><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noreferrer" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://4rozeN.github.io" target="_blank">林之介4rozeN</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/%E7%AC%94%E8%AE%B0/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>笔记<span class="tagsPageCount">4</span></a></div></div></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/31657"><img class="prev-cover" src= "/img/loading/loading.gif" onerror="this.onerror=null,this.src=&quot;/img/avatar/emo.webp&quot;" data-lazy-src="https://ali-4rozen-oss.oss-cn-guangzhou.aliyuncs.com/blog/cover/%E5%89%8D%E7%AB%AF/vue%E7%AC%94%E8%AE%B0.webp" onerror="onerror=null;src='/img/avatar/emo.webp'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Vue 项目打包并部署到 GitHub 为 demo</div></div></a></div><div class="next-post pull-right"><a href="/posts/36922"><img class="next-cover" src= "/img/loading/loading.gif" onerror="this.onerror=null,this.src=&quot;/img/avatar/emo.webp&quot;" data-lazy-src="https://ali-4rozen-oss.oss-cn-guangzhou.aliyuncs.com/blog/cover/%E5%89%8D%E7%AB%AF/react%E7%AC%94%E8%AE%B0.webp" onerror="onerror=null;src='/img/avatar/emo.webp'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">React18 学习笔记 (未完成)</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>喜欢这篇文章的人也看了</span></div><div class="relatedPosts-list"><div><a href="/posts/31657" title="Vue 项目打包并部署到 GitHub 为 demo"><img class="cover" src= "/img/loading/loading.gif" onerror="this.onerror=null,this.src=&quot;/img/avatar/emo.webp&quot;" data-lazy-src="https://ali-4rozen-oss.oss-cn-guangzhou.aliyuncs.com/blog/cover/%E5%89%8D%E7%AB%AF/vue%E7%AC%94%E8%AE%B0.webp" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-10-26</div><div class="title">Vue 项目打包并部署到 GitHub 为 demo</div></div></a></div><div><a href="/posts/7498" title="uni-app 涉及到的生命周期小结"><img class="cover" src= "/img/loading/loading.gif" onerror="this.onerror=null,this.src=&quot;/img/avatar/emo.webp&quot;" data-lazy-src="https://ali-4rozen-oss.oss-cn-guangzhou.aliyuncs.com/blog/cover/%E5%89%8D%E7%AB%AF/uniapp%E7%AC%94%E8%AE%B0.webp" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-09-06</div><div class="title">uni-app 涉及到的生命周期小结</div></div></a></div><div><a href="/posts/35829" title="理解防抖"><img class="cover" src= "/img/loading/loading.gif" onerror="this.onerror=null,this.src=&quot;/img/avatar/emo.webp&quot;" data-lazy-src="https://ali-4rozen-oss.oss-cn-guangzhou.aliyuncs.com/blog/cover/%E5%89%8D%E7%AB%AF/%E9%98%B2%E6%8A%96.webp" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-07-06</div><div class="title">理解防抖</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="anzhiyufont anzhiyu-icon-comments"></i><span> 评论</span></div><div class="comment-randomInfo"><a onclick="anzhiyu.addRandomCommentInfo()" href="javascript:void(0)" rel="external nofollow noreferrer">匿名评论</a><a href="/privacy" style="margin-left: 4px">隐私政策</a></div><div class="comment-tips" id="comment-tips"><span>✅ 你无需删除空行，直接评论以获取最佳展示效果</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div><div class="comment-barrage"></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info-avatar"><img class="avatar-img" src= "/img/loading/loading.gif" onerror="this.onerror=null,this.src=&quot;/img/avatar/emo.webp&quot;" data-lazy-src="https://ali-4rozen-oss.oss-cn-guangzhou.aliyuncs.com/blog/avatar/avatar.jpg" onerror="this.onerror=null;this.src='/img/avatar/emo.webp'" alt="avatar"/></div><div class="author-info__description"><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">这有关于<b style="color:#fff">设计、开发</b>相关的问题和看法，还有<b style="color:#fff">其他文章</b>和<b style="color:#fff">分享</b>。</div><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">相信你可以在这里找到对你有用的<b style="color:#fff">知识</b>和<b style="color:#fff">教程</b>。</div></div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/about"><h1 class="author-info__name">4rozeN</h1><div class="author-info__desc">历历浮生，无非败而后成。</div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/4rozeN" rel="external nofollow noreferrer" target="_blank" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a><a class="social-icon faa-parent animated-hover" href="mailto:mail4chen@foxmail.com" rel="external nofollow noreferrer" target="_blank" title="Email"><i class="anzhiyufont anzhiyu-icon-envelope"></i></a></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84"><span class="toc-number">1.</span> <span class="toc-text"> 项目结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E7%BA%A7%E8%B7%AF%E7%94%B1%E9%85%8D%E7%BD%AE"><span class="toc-number">2.</span> <span class="toc-text"> 二级路由配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E5%BA%95%E9%83%A8%E5%AF%BC%E8%88%AA%E6%A0%8F-tabbar"><span class="toc-number">2.1.</span> <span class="toc-text"> 实现底部导航栏 Tabbar</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E4%BA%8C%E7%BA%A7%E8%B7%AF%E7%94%B1%E9%85%8D%E7%BD%AE"><span class="toc-number">2.2.</span> <span class="toc-text"> 实现二级路由配置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%99%BB%E5%BD%95%E9%9D%99%E6%80%81%E9%A1%B5"><span class="toc-number">3.</span> <span class="toc-text"> 登录静态页</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E5%A4%B4%E9%83%A8-navbar"><span class="toc-number">3.1.</span> <span class="toc-text"> 配置头部 NavBar</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%8C%E5%96%84%E4%B8%BB%E4%BD%93"><span class="toc-number">3.2.</span> <span class="toc-text"> 完善主体</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%8C%E5%96%84%E7%99%BB%E5%BD%95%E9%80%BB%E8%BE%91"><span class="toc-number">3.3.</span> <span class="toc-text"> 完善登录逻辑</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E6%9E%90-base64-%E5%B9%B6%E5%AE%8C%E5%96%84%E7%82%B9%E5%87%BB%E5%88%B7%E6%96%B0%E5%9B%BE%E7%89%87%E9%AA%8C%E8%AF%81%E7%A0%81"><span class="toc-number">3.3.1.</span> <span class="toc-text"> 解析 base64 并完善点击刷新图片验证码</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#toast-%E8%BD%BB%E6%8F%90%E7%A4%BA"><span class="toc-number">3.4.</span> <span class="toc-text"> Toast 轻提示</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9F%AD%E4%BF%A1%E9%AA%8C%E8%AF%81%E5%80%92%E8%AE%A1%E6%97%B6"><span class="toc-number">3.5.</span> <span class="toc-text"> 短信验证倒计时</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%8B%E6%9C%BA%E5%8F%B7%E5%92%8C%E5%9B%BE%E5%BD%A2%E9%AA%8C%E8%AF%81%E7%A0%81%E7%B1%BB%E5%9E%8B%E6%A0%A1%E9%AA%8C"><span class="toc-number">3.6.</span> <span class="toc-text"> 手机号和图形验证码类型校验</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%81%E8%A3%85%E5%8F%91%E9%80%81%E7%9F%AD%E4%BF%A1%E9%AA%8C%E8%AF%81%E7%A0%81%E8%AF%B7%E6%B1%82"><span class="toc-number">3.7.</span> <span class="toc-text"> 封装发送短信验证码请求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E7%99%BB%E5%BD%95%E5%8A%9F%E8%83%BD-%E5%B0%81%E8%A3%85%E7%99%BB%E5%BD%95%E6%8E%A5%E5%8F%A3"><span class="toc-number">3.8.</span> <span class="toc-text"> 实现登录功能 - 封装登录接口</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%93%8D%E5%BA%94%E5%A4%84%E7%90%86%E5%99%A8%E7%BB%9F%E4%B8%80%E5%A4%84%E7%90%86%E9%94%99%E8%AF%AF%E6%8F%90%E7%A4%BA"><span class="toc-number">4.</span> <span class="toc-text"> 响应处理器统一处理错误提示</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%99%BB%E5%BD%95%E6%9D%83%E8%AF%81%E4%BF%A1%E6%81%AF%E5%AD%98%E5%82%A8"><span class="toc-number">5.</span> <span class="toc-text"> 登录权证信息存储</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#vuex-%E6%8C%81%E4%B9%85%E5%8C%96%E5%A4%84%E7%90%86"><span class="toc-number">6.</span> <span class="toc-text"> vuex 持久化处理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E8%AF%B7%E6%B1%82-loading-%E6%95%88%E6%9E%9C"><span class="toc-number">7.</span> <span class="toc-text"> 添加请求 Loading 效果</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%A8%E5%B1%80%E8%B7%AF%E7%94%B1%E5%89%8D%E7%BD%AE%E5%AE%88%E5%8D%AB"><span class="toc-number">8.</span> <span class="toc-text"> 全局路由前置守卫</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A6%96%E9%A1%B5"><span class="toc-number">9.</span> <span class="toc-text"> 首页</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%8C%E6%88%90%E9%A6%96%E9%A1%B5%E9%9D%99%E6%80%81%E7%BB%93%E6%9E%84"><span class="toc-number">9.1.</span> <span class="toc-text"> 完成首页静态结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A6%96%E9%A1%B5-%E5%8A%A8%E6%80%81%E6%B8%B2%E6%9F%93"><span class="toc-number">9.2.</span> <span class="toc-text"> 首页 - 动态渲染</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%90%9C%E7%B4%A2"><span class="toc-number">10.</span> <span class="toc-text"> 搜索</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%90%9C%E7%B4%A2%E9%A1%B5%E9%9D%99%E6%80%81%E7%BB%93%E6%9E%84"><span class="toc-number">10.1.</span> <span class="toc-text"> 搜索页静态结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%86%E5%8F%B2%E8%AE%B0%E5%BD%95%E7%AE%A1%E7%90%86"><span class="toc-number">10.2.</span> <span class="toc-text"> 历史记录管理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%90%9C%E7%B4%A2%E5%88%97%E8%A1%A8%E9%A1%B5"><span class="toc-number">10.3.</span> <span class="toc-text"> 搜索列表页</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E5%B8%83%E5%B1%80"><span class="toc-number">10.3.1.</span> <span class="toc-text"> 静态布局</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B8%B2%E6%9F%93"><span class="toc-number">10.3.2.</span> <span class="toc-text"> 渲染</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E5%88%86%E7%B1%BB%E9%A1%B5%E9%9D%A2%E7%9A%84%E5%88%86%E7%B1%BB-id-%E8%BF%9B%E8%A1%8C%E6%B8%B2%E6%9F%93"><span class="toc-number">10.3.3.</span> <span class="toc-text"> 基于分类页面的分类 id 进行渲染</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%95%86%E5%93%81%E8%AF%A6%E6%83%85%E9%A1%B5"><span class="toc-number">11.</span> <span class="toc-text"> 商品详情页</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E7%BB%93%E6%9E%84"><span class="toc-number">11.1.</span> <span class="toc-text"> 静态结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%95%86%E5%93%81%E8%AF%B4%E6%98%8E%E5%8A%A8%E6%80%81%E6%B8%B2%E6%9F%93"><span class="toc-number">11.2.</span> <span class="toc-text"> 商品说明动态渲染</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%95%86%E5%93%81%E8%AF%84%E8%AE%BA%E5%8C%BA%E6%B8%B2%E6%9F%93"><span class="toc-number">11.3.</span> <span class="toc-text"> 商品评论区渲染</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%95%86%E5%93%81%E8%AF%B4%E6%98%8E%E7%9A%84%E5%9B%BE%E7%89%87%E6%B8%B2%E6%9F%93"><span class="toc-number">11.4.</span> <span class="toc-text"> 商品说明的图片渲染</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%95%86%E5%93%81%E8%AF%84%E4%BB%B7%E5%8C%BA"><span class="toc-number">12.</span> <span class="toc-text"> 商品评价区</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8A%A0%E5%85%A5%E8%B4%AD%E7%89%A9%E8%BD%A6%E8%B4%AD%E4%B9%B0"><span class="toc-number">13.</span> <span class="toc-text"> 加入购物车 &#x2F; 购买</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E5%AD%97%E6%A1%86%E7%BB%84%E4%BB%B6%E5%B0%81%E8%A3%85"><span class="toc-number">14.</span> <span class="toc-text"> 数字框组件封装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8A%A0%E5%85%A5%E8%B4%AD%E7%89%A9%E8%BD%A6-%E5%88%A4%E6%96%AD%E7%99%BB%E5%BD%95%E7%8A%B6%E6%80%81"><span class="toc-number">15.</span> <span class="toc-text"> 加入购物车 - 判断登录状态</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#thisrouterreplace%E5%92%8Cthisrouterpush%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">16.</span> <span class="toc-text"> this.$router.replace 和 this.$router.push 的区别</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8A%A0%E5%85%A5%E8%B4%AD%E7%89%A9%E8%BD%A6-%E5%B0%81%E8%A3%85%E6%8E%A5%E5%8F%A3%E8%BF%9B%E8%A1%8C%E8%AF%B7%E6%B1%82"><span class="toc-number">17.</span> <span class="toc-text"> 加入购物车 - 封装接口进行请求</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B4%AD%E7%89%A9%E8%BD%A6%E9%A1%B5%E9%9D%A2"><span class="toc-number">18.</span> <span class="toc-text"> 购物车页面</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E9%A1%B5%E9%9D%A2"><span class="toc-number">18.1.</span> <span class="toc-text"> 静态页面</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%84%E5%BB%BA-vuex-cart-%E6%A8%A1%E5%9D%97"><span class="toc-number">18.2.</span> <span class="toc-text"> 构建 vuex cart 模块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E6%B8%B2%E6%9F%93"><span class="toc-number">18.3.</span> <span class="toc-text"> 动态渲染</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%81%E8%A3%85-getters-%E5%AE%9E%E7%8E%B0%E5%8A%A8%E6%80%81%E7%BB%9F%E8%AE%A1"><span class="toc-number">18.4.</span> <span class="toc-text"> 封装 getters 实现动态统计</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%A8%E9%80%89%E5%8F%8D%E9%80%89"><span class="toc-number">18.5.</span> <span class="toc-text"> 全选反选</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E5%AD%97%E6%A1%86%E4%BF%AE%E6%94%B9%E6%95%B0%E9%87%8F%E5%8A%9F%E8%83%BD"><span class="toc-number">18.6.</span> <span class="toc-text"> 数字框修改数量功能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E8%BE%91%E5%88%87%E6%8D%A2%E7%8A%B6%E6%80%81%E5%88%A0%E9%99%A4%E5%8A%9F%E8%83%BD"><span class="toc-number">18.7.</span> <span class="toc-text"> 编辑切换状态，删除功能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E5%95%86%E5%93%81"><span class="toc-number">18.8.</span> <span class="toc-text"> 删除商品</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A9%BA%E8%B4%AD%E7%89%A9%E8%BD%A6%E5%A4%84%E7%90%86"><span class="toc-number">18.9.</span> <span class="toc-text"> 空购物车处理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9C%B0%E5%9D%80%E7%AE%A1%E7%90%86"><span class="toc-number">19.</span> <span class="toc-text"> 地址管理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE"><span class="toc-number">19.1.</span> <span class="toc-text"> 配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%B0%E5%9D%80%E5%88%97%E8%A1%A8"><span class="toc-number">19.2.</span> <span class="toc-text"> 地址列表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%B0%E5%9D%80%E7%BC%96%E8%BE%91"><span class="toc-number">19.3.</span> <span class="toc-text"> 地址编辑</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%A2%E5%8D%95%E7%BB%93%E7%AE%97%E5%8F%B0"><span class="toc-number">20.</span> <span class="toc-text"> 订单结算台</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E7%BB%93%E6%9E%84-2"><span class="toc-number">20.1.</span> <span class="toc-text"> 静态结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B8%B2%E6%9F%93-2"><span class="toc-number">20.2.</span> <span class="toc-text"> 渲染</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%A2%E5%8D%95%E7%BB%93%E7%AE%97"><span class="toc-number">21.</span> <span class="toc-text"> 订单结算</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0unfinished"><span class="toc-number">22.</span> <span class="toc-text"> 文件上传 ——unfinished</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%BE%E7%89%87%E4%B8%8A%E4%BC%A0"><span class="toc-number">22.1.</span> <span class="toc-text"> 图片上传</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-vue-cropper"><span class="toc-number">22.1.1.</span> <span class="toc-text"> 安装 vue-cropper</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%A8%E7%BB%84%E4%BB%B6%E4%B8%AD%E4%BD%BF%E7%94%A8-vue-cropper"><span class="toc-number">22.1.2.</span> <span class="toc-text"> 在组件中使用 vue-cropper</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%93%E5%8C%85%E4%BC%98%E5%8C%96"><span class="toc-number">23.</span> <span class="toc-text"> 打包优化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%98%E5%8C%96%E8%AE%BF%E9%97%AE%E8%B7%AF%E5%BE%84"><span class="toc-number">23.1.</span> <span class="toc-text"> 优化访问路径</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%87%92%E5%8A%A0%E8%BD%BD"><span class="toc-number">23.2.</span> <span class="toc-text"> 懒加载</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/24974" title="从 JS 属性描述符再看 Vue 数据响应式原理"><img src= "/img/loading/loading.gif" onerror="this.onerror=null,this.src=&quot;/img/avatar/emo.webp&quot;" data-lazy-src="https://ali-4rozen-oss.oss-cn-guangzhou.aliyuncs.com/blog/cover/%E5%89%8D%E7%AB%AF/Vue%E6%95%B0%E6%8D%AE%E5%93%8D%E5%BA%94%E5%BC%8F%E5%8E%9F%E7%90%86v2.webp" onerror="this.onerror=null;this.src='/img/avatar/emo.webp'" alt="从 JS 属性描述符再看 Vue 数据响应式原理"/></a><div class="content"><a class="title" href="/posts/24974" title="从 JS 属性描述符再看 Vue 数据响应式原理">从 JS 属性描述符再看 Vue 数据响应式原理</a><time datetime="2025-09-04T03:46:56.828Z" title="发表于 2025-09-04 11:46:56">2025-09-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/1303" title="浏览器渲染原理"><img src= "/img/loading/loading.gif" onerror="this.onerror=null,this.src=&quot;/img/avatar/emo.webp&quot;" data-lazy-src="https://ali-4rozen-oss.oss-cn-guangzhou.aliyuncs.com/blog/cover/%E5%89%8D%E7%AB%AF/%E6%B5%8F%E8%A7%88%E5%99%A8%E6%B8%B2%E6%9F%93%E5%8E%9F%E7%90%86.webp" onerror="this.onerror=null;this.src='/img/avatar/emo.webp'" alt="浏览器渲染原理"/></a><div class="content"><a class="title" href="/posts/1303" title="浏览器渲染原理">浏览器渲染原理</a><time datetime="2025-09-01T12:09:13.000Z" title="发表于 2025-09-01 20:09:13">2025-09-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/13214" title="事件循环"><img src= "/img/loading/loading.gif" onerror="this.onerror=null,this.src=&quot;/img/avatar/emo.webp&quot;" data-lazy-src="https://ali-4rozen-oss.oss-cn-guangzhou.aliyuncs.com/blog/cover/%E5%89%8D%E7%AB%AF/%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF.webp" onerror="this.onerror=null;this.src='/img/avatar/emo.webp'" alt="事件循环"/></a><div class="content"><a class="title" href="/posts/13214" title="事件循环">事件循环</a><time datetime="2025-09-01T04:50:13.000Z" title="发表于 2025-09-01 12:50:13">2025-09-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/1" title="JS 属性描述符"><img src= "/img/loading/loading.gif" onerror="this.onerror=null,this.src=&quot;/img/avatar/emo.webp&quot;" data-lazy-src="https://ali-4rozen-oss.oss-cn-guangzhou.aliyuncs.com/blog/cover/%E5%89%8D%E7%AB%AF/%E5%B1%9E%E6%80%A7%E6%8F%8F%E8%BF%B0%E7%AC%A6.webp" onerror="this.onerror=null;this.src='/img/avatar/emo.webp'" alt="JS 属性描述符"/></a><div class="content"><a class="title" href="/posts/1" title="JS 属性描述符">JS 属性描述符</a><time datetime="2025-09-01T03:50:13.000Z" title="发表于 2025-09-01 11:50:13">2025-09-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/9104" title="js+css 实现 Hexo 博客 ripple 水波切换主题效果"><img src= "/img/loading/loading.gif" onerror="this.onerror=null,this.src=&quot;/img/avatar/emo.webp&quot;" data-lazy-src="https://ali-4rozen-oss.oss-cn-guangzhou.aliyuncs.com/blog/cover/Hexo/Hexo%E7%BE%8E%E5%8C%96.webp" onerror="this.onerror=null;this.src='/img/avatar/emo.webp'" alt="js+css 实现 Hexo 博客 ripple 水波切换主题效果"/></a><div class="content"><a class="title" href="/posts/9104" title="js+css 实现 Hexo 博客 ripple 水波切换主题效果">js+css 实现 Hexo 博客 ripple 水波切换主题效果</a><time datetime="2025-07-22T02:50:13.000Z" title="发表于 2025-07-22 10:50:13">2025-07-22</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div id="footer_deal"><a class="deal_link" href="mailto:mail4chen@foxmail.com" rel="external nofollow noreferrer" title="email"><i class="anzhiyufont anzhiyu-icon-envelope"></i></a><a class="deal_link" href="/rss2.xml" title="RSS"><i class="anzhiyufont anzhiyu-icon-rss"></i></a><img class="footer_mini_logo" title="返回顶部" alt="返回顶部" onclick="anzhiyu.scrollToDest(0, 500)" src= "/img/loading/loading.gif" onerror="this.onerror=null,this.src=&quot;/img/avatar/emo.webp&quot;" data-lazy-src="https://ali-4rozen-oss.oss-cn-guangzhou.aliyuncs.com/blog/avatar/avatar.jpg" size="50px"/><a class="deal_link" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/4rozeN" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a><a class="deal_link" href="/copyright" title="CC"><i class="anzhiyufont anzhiyu-icon-copyright-line"></i></a></div><div id="anzhiyu-footer"><div class="footer-group"><div class="footer-title">服务</div><div class="footer-links"><a class="footer-item" title="十年之约" target="_blank" rel="noopener external nofollow noreferrer" href="https://www.foreverblog.cn/">十年之约</a><a class="footer-item" title="开往" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/travellings-link/travellings">开往</a></div></div><div class="footer-group"><div class="footer-title">主题</div><div class="footer-links"><a class="footer-item" title="文档" target="_blank" rel="noopener external nofollow noreferrer" href="https://docs.anheyu.com/global/base.html">文档</a><a class="footer-item" title="源码" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu/tree/main">源码</a><a class="footer-item" title="更新日志" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu/releases">更新日志</a></div></div><div class="footer-group"><div class="footer-title">导航</div><div class="footer-links"><a class="footer-item" title="友链文章" href="/fcircle/">友链文章</a><a class="footer-item" title="Static Badge" target="_blank" rel="noopener external nofollow noreferrer" href="https://shields.io/badges">Static Badge</a></div></div><div class="footer-group"><div class="footer-title">协议</div><div class="footer-links"><a class="footer-item" title="隐私协议" href="/privacy/">隐私协议</a><a class="footer-item" title="Cookies" href="/cookies/">Cookies</a><a class="footer-item" title="版权协议" href="/copyright/">版权协议</a></div></div><div class="footer-group"><div class="footer-title-group"><div class="footer-title">友链</div><a class="random-friends-btn" id="footer-random-friends-btn" href="javascript:addFriendLinksInFooter();" rel="external nofollow noreferrer" title="换一批友情链接"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right"></i></a></div><div class="footer-links" id="friend-links-in-footer"></div></div></div><p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" rel="external nofollow noreferrer" style="margin-inline:5px" data-title="博客框架为Hexo_v5.4.0" title="博客框架为Hexo_v5.4.0"><img src= "/img/loading/loading.gif" onerror="this.onerror=null,this.src=&quot;/img/avatar/emo.webp&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.1.5/img/badge/Frame-Hexo.svg" alt="博客框架为Hexo_v5.4.0"/></a><a class="github-badge" target="_blank" href="https://blog.anheyu.com/" rel="external nofollow noreferrer" style="margin-inline:5px" data-title="本站使用AnZhiYu主题" title="本站使用AnZhiYu主题"><img src= "/img/loading/loading.gif" onerror="this.onerror=null,this.src=&quot;/img/avatar/emo.webp&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.9/img/Theme-AnZhiYu-2E67D3.svg" alt="本站使用AnZhiYu主题"/></a><a class="github-badge" target="_blank" href="https://www.zstatic.net/" rel="external nofollow noreferrer" style="margin-inline:5px" data-title="本站使用Zstatic为静态资源提供CDN加速" title="本站使用Zstatic为静态资源提供CDN加速"><img src= "/img/loading/loading.gif" onerror="this.onerror=null,this.src=&quot;/img/avatar/emo.webp&quot;" data-lazy-src="https://gitee.com/CSJ021005/new-pic-bed/raw/main/img/202509151905840.svg" alt="本站使用Zstatic为静态资源提供CDN加速"/></a><a class="github-badge" target="_blank" href="https://github.com/" rel="external nofollow noreferrer" style="margin-inline:5px" data-title="本站项目由Github托管" title="本站项目由Github托管"><img src= "/img/loading/loading.gif" onerror="this.onerror=null,this.src=&quot;/img/avatar/emo.webp&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.1.5/img/badge/Source-Github.svg" alt="本站项目由Github托管"/></a><a class="github-badge" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noreferrer" style="margin-inline:5px" data-title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可" title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可"><img src= "/img/loading/loading.gif" onerror="this.onerror=null,this.src=&quot;/img/avatar/emo.webp&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.2.0/img/badge/Copyright-BY-NC-SA.svg" alt="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可"/></a></p></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2024 - 2025 By <a class="footer-bar-link" href="/" title="4rozeN" target="_blank">4rozeN</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a><a class="footer-bar-link" target="_blank" rel="noopener external nofollow noreferrer" href="https://icp.gov.moe/?keyword=20254070" title="萌ICP备-20254070号">萌ICP备-20254070号</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">35</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">58</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">7</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" rel="external nofollow noreferrer" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://4rozen.github.com/" title="我的博客"><img class="back-menu-item-icon" src= "/img/loading/loading.gif" onerror="this.onerror=null,this.src=&quot;/img/avatar/emo.webp&quot;" data-lazy-src="https://ali-4rozen-oss.oss-cn-guangzhou.aliyuncs.com/blog/ico/favicon.ico" alt="我的博客"/><span class="back-menu-item-text">我的博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/4rozeN/Simple-Animated-Guns-Fixed" title="MC枪械模组"><img class="back-menu-item-icon" src= "/img/loading/loading.gif" onerror="this.onerror=null,this.src=&quot;/img/avatar/emo.webp&quot;" data-lazy-src="https://ali-4rozen-oss.oss-cn-guangzhou.aliyuncs.com/blog/cover/%E6%88%91%E7%9A%84%E9%A1%B9%E7%9B%AE/SAG.jpg" alt="MC枪械模组"/><span class="back-menu-item-text">MC枪械模组</span></a><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/4rozeN/Datapack_S.A.G" title="SAG数据包"><img class="back-menu-item-icon" src= "/img/loading/loading.gif" onerror="this.onerror=null,this.src=&quot;/img/avatar/emo.webp&quot;" data-lazy-src="https://ali-4rozen-oss.oss-cn-guangzhou.aliyuncs.com/blog/cover/%E6%88%91%E7%9A%84%E9%A1%B9%E7%9B%AE/SAG.jpg" alt="SAG数据包"/><span class="back-menu-item-text">SAG数据包</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 文章归档</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 文章分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 文章标签</span></a></li></ul></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/link/"><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()" rel="external nofollow noreferrer"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> 随便逛逛</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/API/" style="font-size: 0.88rem;">API<sup>1</sup></a><a href="/tags/Bootstrap/" style="font-size: 0.88rem;">Bootstrap<sup>1</sup></a><a href="/tags/CSS/" style="font-size: 0.88rem;">CSS<sup>2</sup></a><a href="/tags/CTF-WP/" style="font-size: 0.88rem;">CTF-WP<sup>1</sup></a><a href="/tags/DOH/" style="font-size: 0.88rem;">DOH<sup>1</sup></a><a href="/tags/Fabric/" style="font-size: 0.88rem;">Fabric<sup>3</sup></a><a href="/tags/Fluid/" style="font-size: 0.88rem;">Fluid<sup>1</sup></a><a href="/tags/Git/" style="font-size: 0.88rem;">Git<sup>1</sup></a><a href="/tags/GitHubActions/" style="font-size: 0.88rem;">GitHubActions<sup>1</sup></a><a href="/tags/Hexo/" style="font-size: 0.88rem;">Hexo<sup>6</sup></a><a href="/tags/JavaScript/" style="font-size: 0.88rem;">JavaScript<sup>5</sup></a><a href="/tags/Minecraft/" style="font-size: 0.88rem;">Minecraft<sup>5</sup></a><a href="/tags/Modding/" style="font-size: 0.88rem;">Modding<sup>1</sup></a><a href="/tags/Strapi/" style="font-size: 0.88rem;">Strapi<sup>1</sup></a><a href="/tags/Vue/" style="font-size: 0.88rem;">Vue<sup>2</sup></a><a href="/tags/ejs/" style="font-size: 0.88rem;">ejs<sup>1</sup></a><a href="/tags/fluid/" style="font-size: 0.88rem;">fluid<sup>2</sup></a><a href="/tags/git/" style="font-size: 0.88rem;">git<sup>1</sup></a><a href="/tags/github/" style="font-size: 0.88rem;">github<sup>1</sup></a><a href="/tags/http/" style="font-size: 0.88rem;">http<sup>1</sup></a><a href="/tags/indexnow/" style="font-size: 0.88rem;">indexnow<sup>1</sup></a><a href="/tags/python/" style="font-size: 0.88rem;">python<sup>1</sup></a><a href="/tags/ssh/" style="font-size: 0.88rem;">ssh<sup>1</sup></a><a href="/tags/styl/" style="font-size: 0.88rem;">styl<sup>1</sup></a><a href="/tags/%E5%85%A8%E6%88%90%E5%B0%B1%E5%B8%AE%E6%89%8B/" style="font-size: 0.88rem;">全成就帮手<sup>1</sup></a><a href="/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" style="font-size: 0.88rem;">反序列化<sup>1</sup></a><a href="/tags/%E6%97%A5%E5%A4%9C%E5%88%87%E6%8D%A2%E8%83%8C%E6%99%AF/" style="font-size: 0.88rem;">日夜切换背景<sup>1</sup></a><a href="/tags/%E6%A8%A1%E7%BB%84%E5%BC%80%E5%8F%91/" style="font-size: 0.88rem;">模组开发<sup>1</sup></a><a href="/tags/%E7%AC%94%E8%AE%B0/" style="font-size: 0.88rem;">笔记<sup>4</sup></a><a href="/tags/%E7%BE%8E%E5%8C%96/" style="font-size: 0.88rem;">美化<sup>3</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="anzhiyufont anzhiyu-icon-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="438394768" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.2"></meting-js></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="is-center" id="loading-database"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-pulse-icon"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://music.163.com/playlist&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://s4.zstatic.net/ajax/libs/fancyapps-ui/6.0.30/fancybox/fancybox.umd.js"></script><script src="https://s4.zstatic.net/ajax/libs/instant.page/5.2.0/instantpage.min.js" type="module"></script><script src="https://s4.zstatic.net/ajax/libs/vanilla-lazyload/19.1.3/lazyload.min.js"></script><script src="https://s4.zstatic.net/ajax/libs/node-snackbar/0.1.16/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu@4.0.7/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><script async src="/anzhiyu/random.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>(() => {
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://4rozen-blog.netlify.app/.netlify/functions/twikoo',
      region: '',
      onCommentLoaded: () => {
        anzhiyu.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') setTimeout(runFn,0)
    else getScript('https://s4.zstatic.net/ajax/libs/twikoo/1.6.44/twikoo.min.js').then(runFn)
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://4rozen-blog.netlify.app/.netlify/functions/twikoo',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const runFn = () => {
    init();
    
  }

  if ('Twikoo' === 'Twikoo' || !true) {
    if (true) anzhiyu.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else {
      loadTwikoo()
    }
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script><input type="hidden" name="page-type" id="page-type" value="post"></div><script>var visitorMail = "";
</script><script async data-pjax src="https://cdn.jsdelivr.net/npm/anzhiyu-theme-static@1.0.0/waterfall/waterfall.min.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><script src="/js/anzhiyu/right_click_menu.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.min.css"><link rel="stylesheet" href="https://s4.zstatic.net/ajax/libs/aplayer/1.10.1/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://s4.zstatic.net/ajax/libs/aplayer/1.10.1/APlayer.min.js"></script><script src="https://s4.zstatic.net/ajax/libs/meting/2.0.1/Meting.min.js"></script><script charset="UTF-8" src="https://cdn.jsdelivr.net/npm/anzhiyu-theme-static@1.1.5/accesskey/accesskey.min.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>