let colorToggleButton=document.querySelector("#color-toggle-btn .nav-link"),backgroundContainer=document.querySelector("#web_bg"),BACKGROUND_IMAGES={dark:{desktop:"https://ali-4rozen-oss.oss-cn-guangzhou.aliyuncs.com/blog/sunset-night.webp",mobile:"https://ali-4rozen-oss.oss-cn-guangzhou.aliyuncs.com/blog/eva_mobile.webp"},light:{desktop:"https://ali-4rozen-oss.oss-cn-guangzhou.aliyuncs.com/blog/ruanmei.webp",mobile:"https://ali-4rozen-oss.oss-cn-guangzhou.aliyuncs.com/blog/eva_mobile.webp"},fallback:"https://ali-4rozen-oss.oss-cn-guangzhou.aliyuncs.com/blog/eva.webp"},PAGE_EXCLUSIONS=["/links/","/about/","/categories/","/tags/","/collections/"],isExcludedPage=o=>"/"===o||PAGE_EXCLUSIONS.some(e=>o.startsWith(e)),isMobileViewport=()=>window.innerWidth<768,removeBannerMask=()=>{var e=document.querySelector("#banner .mask");e&&(e.style.backgroundColor="rgba(0,0,0,0)")},preloadBackgroundImages=()=>{let o=new Set;Object.values(BACKGROUND_IMAGES).forEach(e=>{"object"==typeof e?(o.add(e.desktop),o.add(e.mobile)):o.add(e)}),o.forEach(e=>{(new Image).src=e})},applyBackgroundImage=(e,o)=>{var a=isMobileViewport();let r;r=o||(null!==e&&!isExcludedPage(location.pathname)&&e?a?BACKGROUND_IMAGES[e].mobile:BACKGROUND_IMAGES[e].desktop:a?BACKGROUND_IMAGES.dark.mobile:BACKGROUND_IMAGES.fallback),backgroundContainer.style.backgroundImage=`url(${r})`},getUserColorScheme=()=>"dark"===document.documentElement.getAttribute("data-user-color-scheme")?"dark":"light",handleColorSchemeToggle=()=>{var e=getUserColorScheme();isExcludedPage(location.pathname)||applyBackgroundImage(e),removeBannerMask()},resizeTimer,handleViewportResize=()=>{clearTimeout(resizeTimer),resizeTimer=setTimeout(()=>{applyBackgroundImage(getUserColorScheme())},200)},observeColorSchemeChange=()=>{var e=document.documentElement;new MutationObserver(e=>{for(var o of e)"attributes"===o.type&&"data-user-color-scheme"===o.attributeName&&handleColorSchemeToggle()}).observe(e,{attributes:!0,attributeFilter:["data-user-color-scheme"]})},initializeBackgrounds=()=>{preloadBackgroundImages();var e=location.pathname,o=getUserColorScheme();PAGE_EXCLUSIONS.includes(e)?applyBackgroundImage(null):applyBackgroundImage(o),removeBannerMask()};colorToggleButton||console.warn("未找到颜色模式切换按钮"),observeColorSchemeChange(),window.addEventListener("resize",handleViewportResize,{passive:!0}),window.addEventListener("DOMContentLoaded",()=>{console.log("DOM 完成，开始初始化背景图。"),initializeBackgrounds()});